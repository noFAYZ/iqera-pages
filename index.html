<html><head>
    <meta charset="UTF-8">
    <base target="_parent">
    <style>/* BASICS */

.CodeMirror {
  /* Set height, width, borders, and global font properties here */
  font-family: monospace;
  height: 300px;
  color: black;
  direction: ltr;
}

/* PADDING */

.CodeMirror-lines {
  padding: 4px 0; /* Vertical padding around content */
}
.CodeMirror pre.CodeMirror-line,
.CodeMirror pre.CodeMirror-line-like {
  padding: 0 4px; /* Horizontal padding of content */
}

.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {
  background-color: white; /* The little square between H and V scrollbars */
}

/* GUTTER */

.CodeMirror-gutters {
  border-right: 1px solid #ddd;
  background-color: #f7f7f7;
  white-space: nowrap;
}
.CodeMirror-linenumbers {}
.CodeMirror-linenumber {
  padding: 0 3px 0 5px;
  min-width: 20px;
  text-align: right;
  color: #999;
  white-space: nowrap;
}

.CodeMirror-guttermarker { color: black; }
.CodeMirror-guttermarker-subtle { color: #999; }

/* CURSOR */

.CodeMirror-cursor {
  border-left: 1px solid black;
  border-right: none;
  width: 0;
}
/* Shown when moving in bi-directional text */
.CodeMirror div.CodeMirror-secondarycursor {
  border-left: 1px solid silver;
}
.cm-fat-cursor .CodeMirror-cursor {
  width: auto;
  border: 0 !important;
  background: #7e7;
}
.cm-fat-cursor div.CodeMirror-cursors {
  z-index: 1;
}
.cm-fat-cursor-mark {
  background-color: rgba(20, 255, 20, 0.5);
  -webkit-animation: blink 1.06s steps(1) infinite;
  -moz-animation: blink 1.06s steps(1) infinite;
  animation: blink 1.06s steps(1) infinite;
}
.cm-animate-fat-cursor {
  width: auto;
  -webkit-animation: blink 1.06s steps(1) infinite;
  -moz-animation: blink 1.06s steps(1) infinite;
  animation: blink 1.06s steps(1) infinite;
  background-color: #7e7;
}
@-moz-keyframes blink {
  0% {}
  50% { background-color: transparent; }
  100% {}
}
@-webkit-keyframes blink {
  0% {}
  50% { background-color: transparent; }
  100% {}
}
@keyframes blink {
  0% {}
  50% { background-color: transparent; }
  100% {}
}

/* Can style cursor different in overwrite (non-insert) mode */
.CodeMirror-overwrite .CodeMirror-cursor {}

.cm-tab { display: inline-block; text-decoration: inherit; }

.CodeMirror-rulers {
  position: absolute;
  left: 0; right: 0; top: -50px; bottom: 0;
  overflow: hidden;
}
.CodeMirror-ruler {
  border-left: 1px solid #ccc;
  top: 0; bottom: 0;
  position: absolute;
}

/* DEFAULT THEME */

.cm-s-default .cm-header {color: blue;}
.cm-s-default .cm-quote {color: #090;}
.cm-negative {color: #d44;}
.cm-positive {color: #292;}
.cm-header, .cm-strong {font-weight: bold;}
.cm-em {font-style: italic;}
.cm-link {text-decoration: underline;}
.cm-strikethrough {text-decoration: line-through;}

.cm-s-default .cm-keyword {color: #708;}
.cm-s-default .cm-atom {color: #219;}
.cm-s-default .cm-number {color: #164;}
.cm-s-default .cm-def {color: #00f;}
.cm-s-default .cm-variable,
.cm-s-default .cm-punctuation,
.cm-s-default .cm-property,
.cm-s-default .cm-operator {}
.cm-s-default .cm-variable-2 {color: #05a;}
.cm-s-default .cm-variable-3, .cm-s-default .cm-type {color: #085;}
.cm-s-default .cm-comment {color: #a50;}
.cm-s-default .cm-string {color: #a11;}
.cm-s-default .cm-string-2 {color: #f50;}
.cm-s-default .cm-meta {color: #555;}
.cm-s-default .cm-qualifier {color: #555;}
.cm-s-default .cm-builtin {color: #30a;}
.cm-s-default .cm-bracket {color: #997;}
.cm-s-default .cm-tag {color: #170;}
.cm-s-default .cm-attribute {color: #00c;}
.cm-s-default .cm-hr {color: #999;}
.cm-s-default .cm-link {color: #00c;}

.cm-s-default .cm-error {color: #f00;}
.cm-invalidchar {color: #f00;}

.CodeMirror-composing { border-bottom: 2px solid; }

/* Default styles for common addons */

div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}
div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}
.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }
.CodeMirror-activeline-background {background: #e8f2ff;}

/* STOP */

/* The rest of this file contains styles related to the mechanics of
   the editor. You probably shouldn't touch them. */

.CodeMirror {
  position: relative;
  overflow: hidden;
  background: white;
}

.CodeMirror-scroll {
  overflow: scroll !important; /* Things will break if this is overridden */
  /* 50px is the magic margin used to hide the element's real scrollbars */
  /* See overflow: hidden in .CodeMirror */
  margin-bottom: -50px; margin-right: -50px;
  padding-bottom: 50px;
  height: 100%;
  outline: none; /* Prevent dragging from highlighting the element */
  position: relative;
}
.CodeMirror-sizer {
  position: relative;
  border-right: 50px solid transparent;
}

/* The fake, visible scrollbars. Used to force redraw during scrolling
   before actual scrolling happens, thus preventing shaking and
   flickering artifacts. */
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {
  position: absolute;
  z-index: 6;
  display: none;
  outline: none;
}
.CodeMirror-vscrollbar {
  right: 0; top: 0;
  overflow-x: hidden;
  overflow-y: scroll;
}
.CodeMirror-hscrollbar {
  bottom: 0; left: 0;
  overflow-y: hidden;
  overflow-x: scroll;
}
.CodeMirror-scrollbar-filler {
  right: 0; bottom: 0;
}
.CodeMirror-gutter-filler {
  left: 0; bottom: 0;
}

.CodeMirror-gutters {
  position: absolute; left: 0; top: 0;
  min-height: 100%;
  z-index: 3;
}
.CodeMirror-gutter {
  white-space: normal;
  height: 100%;
  display: inline-block;
  vertical-align: top;
  margin-bottom: -50px;
}
.CodeMirror-gutter-wrapper {
  position: absolute;
  z-index: 4;
  background: none !important;
  border: none !important;
}
.CodeMirror-gutter-background {
  position: absolute;
  top: 0; bottom: 0;
  z-index: 4;
}
.CodeMirror-gutter-elt {
  position: absolute;
  cursor: default;
  z-index: 4;
}
.CodeMirror-gutter-wrapper ::selection { background-color: transparent }
.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }

.CodeMirror-lines {
  cursor: text;
  min-height: 1px; /* prevents collapsing before first draw */
}
.CodeMirror pre.CodeMirror-line,
.CodeMirror pre.CodeMirror-line-like {
  /* Reset some styles that the rest of the page might have set */
  -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0;
  border-width: 0;
  background: transparent;
  font-family: inherit;
  font-size: inherit;
  margin: 0;
  white-space: pre;
  word-wrap: normal;
  line-height: inherit;
  color: inherit;
  z-index: 2;
  position: relative;
  overflow: visible;
  -webkit-tap-highlight-color: transparent;
  -webkit-font-variant-ligatures: contextual;
  font-variant-ligatures: contextual;
}
.CodeMirror-wrap pre.CodeMirror-line,
.CodeMirror-wrap pre.CodeMirror-line-like {
  word-wrap: break-word;
  white-space: pre-wrap;
  word-break: normal;
}

.CodeMirror-linebackground {
  position: absolute;
  left: 0; right: 0; top: 0; bottom: 0;
  z-index: 0;
}

.CodeMirror-linewidget {
  position: relative;
  z-index: 2;
  padding: 0.1px; /* Force widget margins to stay inside of the container */
}

.CodeMirror-widget {}

.CodeMirror-rtl pre { direction: rtl; }

.CodeMirror-code {
  outline: none;
}

/* Force content-box sizing for the elements where we expect it */
.CodeMirror-scroll,
.CodeMirror-sizer,
.CodeMirror-gutter,
.CodeMirror-gutters,
.CodeMirror-linenumber {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
}

.CodeMirror-measure {
  position: absolute;
  width: 100%;
  height: 0;
  overflow: hidden;
  visibility: hidden;
}

.CodeMirror-cursor {
  position: absolute;
  pointer-events: none;
}
.CodeMirror-measure pre { position: static; }

div.CodeMirror-cursors {
  visibility: hidden;
  position: relative;
  z-index: 3;
}
div.CodeMirror-dragcursors {
  visibility: visible;
}

.CodeMirror-focused div.CodeMirror-cursors {
  visibility: visible;
}

.CodeMirror-selected { background: #d9d9d9; }
.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }
.CodeMirror-crosshair { cursor: crosshair; }
.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }
.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }

.cm-searching {
  background-color: #ffa;
  background-color: rgba(255, 255, 0, .4);
}

/* Used to force a border model for a node */
.cm-force-border { padding-right: .1px; }

@media print {
  /* Hide the cursor when printing */
  .CodeMirror div.CodeMirror-cursors {
    visibility: hidden;
  }
}

/* See issue #2901 */
.cm-tab-wrap-hack:after { content: ''; }

/* Help users use markselection to safely style text background */
span.CodeMirror-selectedtext { background: none; }
</style>
    <style>.CodeMirror-dialog {
  position: absolute;
  left: 0; right: 0;
  background: inherit;
  z-index: 15;
  padding: .1em .8em;
  overflow: hidden;
  color: inherit;
}

.CodeMirror-dialog-top {
  border-bottom: 1px solid #eee;
  top: 0;
}

.CodeMirror-dialog-bottom {
  border-top: 1px solid #eee;
  bottom: 0;
}

.CodeMirror-dialog input {
  border: none;
  outline: none;
  background: transparent;
  width: 20em;
  color: inherit;
  font-family: monospace;
}

.CodeMirror-dialog button {
  font-size: 70%;
}
</style>
    <style>.CodeMirror-hints {
  position: absolute;
  z-index: 10;
  overflow: hidden;
  list-style: none;

  margin: 0;
  padding: 2px;

  -webkit-box-shadow: 2px 3px 5px rgba(0,0,0,.2);
  -moz-box-shadow: 2px 3px 5px rgba(0,0,0,.2);
  box-shadow: 2px 3px 5px rgba(0,0,0,.2);
  border-radius: 3px;
  border: 1px solid silver;

  background: white;
  font-size: 90%;
  font-family: monospace;

  max-height: 20em;
  overflow-y: auto;
}

.CodeMirror-hint {
  margin: 0;
  padding: 0 4px;
  border-radius: 2px;
  white-space: pre;
  color: black;
  cursor: pointer;
}

li.CodeMirror-hint-active {
  background: #08f;
  color: white;
}
</style>
    <style>/*!
Chosen, a Select Box Enhancer for jQuery and Prototype
by Patrick Filler for Harvest, http://getharvest.com

Version 1.8.7
Full source at https://github.com/harvesthq/chosen
Copyright (c) 2011-2018 Harvest http://getharvest.com

MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md
This file is generated by `grunt build`, do not edit it by hand.
*/

/* @group Base */
.chosen-container {
  position: relative;
  display: inline-block;
  vertical-align: middle;
  font-size: 13px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.chosen-container * {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}

.chosen-container .chosen-drop {
  position: absolute;
  top: 100%;
  z-index: 1010;
  width: 100%;
  border: 1px solid #aaa;
  border-top: 0;
  background: #fff;
  -webkit-box-shadow: 0 4px 5px rgba(0, 0, 0, 0.15);
          box-shadow: 0 4px 5px rgba(0, 0, 0, 0.15);
  clip: rect(0, 0, 0, 0);
  -webkit-clip-path: inset(100% 100%);
          clip-path: inset(100% 100%);
}

.chosen-container.chosen-with-drop .chosen-drop {
  clip: auto;
  -webkit-clip-path: none;
          clip-path: none;
}

.chosen-container a {
  cursor: pointer;
}

.chosen-container .search-choice .group-name, .chosen-container .chosen-single .group-name {
  margin-right: 4px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  font-weight: normal;
  color: #999999;
}

.chosen-container .search-choice .group-name:after, .chosen-container .chosen-single .group-name:after {
  content: ":";
  padding-left: 2px;
  vertical-align: top;
}

/* @end */
/* @group Single Chosen */
.chosen-container-single .chosen-single {
  position: relative;
  display: block;
  overflow: hidden;
  padding: 0 0 0 8px;
  height: 25px;
  border: 1px solid #aaa;
  border-radius: 5px;
  background-color: #fff;
  background: -webkit-gradient(linear, left top, left bottom, color-stop(20%, #fff), color-stop(50%, #f6f6f6), color-stop(52%, #eee), to(#f4f4f4));
  background: linear-gradient(#fff 20%, #f6f6f6 50%, #eee 52%, #f4f4f4 100%);
  background-clip: padding-box;
  -webkit-box-shadow: 0 0 3px #fff inset, 0 1px 1px rgba(0, 0, 0, 0.1);
          box-shadow: 0 0 3px #fff inset, 0 1px 1px rgba(0, 0, 0, 0.1);
  color: #444;
  text-decoration: none;
  white-space: nowrap;
  line-height: 24px;
}

.chosen-container-single .chosen-default {
  color: #999;
}

.chosen-container-single .chosen-single span {
  display: block;
  overflow: hidden;
  margin-right: 26px;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.chosen-container-single .chosen-single-with-deselect span {
  margin-right: 38px;
}

.chosen-container-single .chosen-single abbr {
  position: absolute;
  top: 6px;
  right: 26px;
  display: block;
  width: 12px;
  height: 12px;
  background: url("chosen-sprite.png") -42px 1px no-repeat;
  font-size: 1px;
}

.chosen-container-single .chosen-single abbr:hover {
  background-position: -42px -10px;
}

.chosen-container-single.chosen-disabled .chosen-single abbr:hover {
  background-position: -42px -10px;
}

.chosen-container-single .chosen-single div {
  position: absolute;
  top: 0;
  right: 0;
  display: block;
  width: 18px;
  height: 100%;
}

.chosen-container-single .chosen-single div b {
  display: block;
  width: 100%;
  height: 100%;
  background: url("chosen-sprite.png") no-repeat 0px 2px;
}

.chosen-container-single .chosen-search {
  position: relative;
  z-index: 1010;
  margin: 0;
  padding: 3px 4px;
  white-space: nowrap;
}

.chosen-container-single .chosen-search input[type="text"] {
  margin: 1px 0;
  padding: 4px 20px 4px 5px;
  width: 100%;
  height: auto;
  outline: 0;
  border: 1px solid #aaa;
  background: url("chosen-sprite.png") no-repeat 100% -20px;
  font-size: 1em;
  font-family: sans-serif;
  line-height: normal;
  border-radius: 0;
}

.chosen-container-single .chosen-drop {
  margin-top: -1px;
  border-radius: 0 0 4px 4px;
  background-clip: padding-box;
}

.chosen-container-single.chosen-container-single-nosearch .chosen-search {
  position: absolute;
  clip: rect(0, 0, 0, 0);
  -webkit-clip-path: inset(100% 100%);
          clip-path: inset(100% 100%);
}

/* @end */
/* @group Results */
.chosen-container .chosen-results {
  color: #444;
  position: relative;
  overflow-x: hidden;
  overflow-y: auto;
  margin: 0 4px 4px 0;
  padding: 0 0 0 4px;
  max-height: 240px;
  -webkit-overflow-scrolling: touch;
}

.chosen-container .chosen-results li {
  display: none;
  margin: 0;
  padding: 5px 6px;
  list-style: none;
  line-height: 15px;
  word-wrap: break-word;
  -webkit-touch-callout: none;
}

.chosen-container .chosen-results li.active-result {
  display: list-item;
  cursor: pointer;
}

.chosen-container .chosen-results li.disabled-result {
  display: list-item;
  color: #ccc;
  cursor: default;
}

.chosen-container .chosen-results li.highlighted {
  background-color: #3875d7;
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(20%, #3875d7), color-stop(90%, #2a62bc));
  background-image: linear-gradient(#3875d7 20%, #2a62bc 90%);
  color: #fff;
}

.chosen-container .chosen-results li.no-results {
  color: #777;
  display: list-item;
  background: #f4f4f4;
}

.chosen-container .chosen-results li.group-result {
  display: list-item;
  font-weight: bold;
  cursor: default;
}

.chosen-container .chosen-results li.group-option {
  padding-left: 15px;
}

.chosen-container .chosen-results li em {
  font-style: normal;
  text-decoration: underline;
}

/* @end */
/* @group Multi Chosen */
.chosen-container-multi .chosen-choices {
  position: relative;
  overflow: hidden;
  margin: 0;
  padding: 0 5px;
  width: 100%;
  height: auto;
  border: 1px solid #aaa;
  background-color: #fff;
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(1%, #eee), color-stop(15%, #fff));
  background-image: linear-gradient(#eee 1%, #fff 15%);
  cursor: text;
}

.chosen-container-multi .chosen-choices li {
  float: left;
  list-style: none;
}

.chosen-container-multi .chosen-choices li.search-field {
  margin: 0;
  padding: 0;
  white-space: nowrap;
}

.chosen-container-multi .chosen-choices li.search-field input[type="text"] {
  margin: 1px 0;
  padding: 0;
  height: 25px;
  outline: 0;
  border: 0 !important;
  background: transparent !important;
  -webkit-box-shadow: none;
          box-shadow: none;
  color: #999;
  font-size: 100%;
  font-family: sans-serif;
  line-height: normal;
  border-radius: 0;
  width: 25px;
}

.chosen-container-multi .chosen-choices li.search-choice {
  position: relative;
  margin: 3px 5px 3px 0;
  padding: 3px 20px 3px 5px;
  border: 1px solid #aaa;
  max-width: 100%;
  border-radius: 3px;
  background-color: #eeeeee;
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(20%, #f4f4f4), color-stop(50%, #f0f0f0), color-stop(52%, #e8e8e8), to(#eee));
  background-image: linear-gradient(#f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eee 100%);
  background-size: 100% 19px;
  background-repeat: repeat-x;
  background-clip: padding-box;
  -webkit-box-shadow: 0 0 2px #fff inset, 0 1px 0 rgba(0, 0, 0, 0.05);
          box-shadow: 0 0 2px #fff inset, 0 1px 0 rgba(0, 0, 0, 0.05);
  color: #333;
  line-height: 13px;
  cursor: default;
}

.chosen-container-multi .chosen-choices li.search-choice span {
  word-wrap: break-word;
}

.chosen-container-multi .chosen-choices li.search-choice .search-choice-close {
  position: absolute;
  top: 4px;
  right: 3px;
  display: block;
  width: 12px;
  height: 12px;
  background: url("chosen-sprite.png") -42px 1px no-repeat;
  font-size: 1px;
}

.chosen-container-multi .chosen-choices li.search-choice .search-choice-close:hover {
  background-position: -42px -10px;
}

.chosen-container-multi .chosen-choices li.search-choice-disabled {
  padding-right: 5px;
  border: 1px solid #ccc;
  background-color: #e4e4e4;
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(20%, #f4f4f4), color-stop(50%, #f0f0f0), color-stop(52%, #e8e8e8), to(#eee));
  background-image: linear-gradient(#f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eee 100%);
  color: #666;
}

.chosen-container-multi .chosen-choices li.search-choice-focus {
  background: #d4d4d4;
}

.chosen-container-multi .chosen-choices li.search-choice-focus .search-choice-close {
  background-position: -42px -10px;
}

.chosen-container-multi .chosen-results {
  margin: 0;
  padding: 0;
}

.chosen-container-multi .chosen-drop .result-selected {
  display: list-item;
  color: #ccc;
  cursor: default;
}

/* @end */
/* @group Active  */
.chosen-container-active .chosen-single {
  border: 1px solid #5897fb;
  -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}

.chosen-container-active.chosen-with-drop .chosen-single {
  border: 1px solid #aaa;
  border-bottom-right-radius: 0;
  border-bottom-left-radius: 0;
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(20%, #eee), color-stop(80%, #fff));
  background-image: linear-gradient(#eee 20%, #fff 80%);
  -webkit-box-shadow: 0 1px 0 #fff inset;
          box-shadow: 0 1px 0 #fff inset;
}

.chosen-container-active.chosen-with-drop .chosen-single div {
  border-left: none;
  background: transparent;
}

.chosen-container-active.chosen-with-drop .chosen-single div b {
  background-position: -18px 2px;
}

.chosen-container-active .chosen-choices {
  border: 1px solid #5897fb;
  -webkit-box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}

.chosen-container-active .chosen-choices li.search-field input[type="text"] {
  color: #222 !important;
}

/* @end */
/* @group Disabled Support */
.chosen-disabled {
  opacity: 0.5 !important;
  cursor: default;
}

.chosen-disabled .chosen-single {
  cursor: default;
}

.chosen-disabled .chosen-choices .search-choice .search-choice-close {
  cursor: default;
}

/* @end */
/* @group Right to Left */
.chosen-rtl {
  text-align: right;
}

.chosen-rtl .chosen-single {
  overflow: visible;
  padding: 0 8px 0 0;
}

.chosen-rtl .chosen-single span {
  margin-right: 0;
  margin-left: 26px;
  direction: rtl;
}

.chosen-rtl .chosen-single-with-deselect span {
  margin-left: 38px;
}

.chosen-rtl .chosen-single div {
  right: auto;
  left: 3px;
}

.chosen-rtl .chosen-single abbr {
  right: auto;
  left: 26px;
}

.chosen-rtl .chosen-choices li {
  float: right;
}

.chosen-rtl .chosen-choices li.search-field input[type="text"] {
  direction: rtl;
}

.chosen-rtl .chosen-choices li.search-choice {
  margin: 3px 5px 3px 0;
  padding: 3px 5px 3px 19px;
}

.chosen-rtl .chosen-choices li.search-choice .search-choice-close {
  right: auto;
  left: 4px;
}

.chosen-rtl.chosen-container-single .chosen-results {
  margin: 0 0 4px 4px;
  padding: 0 4px 0 0;
}

.chosen-rtl .chosen-results li.group-option {
  padding-right: 15px;
  padding-left: 0;
}

.chosen-rtl.chosen-container-active.chosen-with-drop .chosen-single div {
  border-right: none;
}

.chosen-rtl .chosen-search input[type="text"] {
  padding: 4px 5px 4px 20px;
  background: url("chosen-sprite.png") no-repeat -30px -20px;
  direction: rtl;
}

.chosen-rtl.chosen-container-single .chosen-single div b {
  background-position: 6px 2px;
}

.chosen-rtl.chosen-container-single.chosen-with-drop .chosen-single div b {
  background-position: -12px 2px;
}

/* @end */
/* @group Retina compatibility */
@media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min-resolution: 144dpi), only screen and (min-resolution: 1.5dppx) {
  .chosen-rtl .chosen-search input[type="text"],
  .chosen-container-single .chosen-single abbr,
  .chosen-container-single .chosen-single div b,
  .chosen-container-single .chosen-search input[type="text"],
  .chosen-container-multi .chosen-choices .search-choice .search-choice-close,
  .chosen-container .chosen-results-scroll-down span,
  .chosen-container .chosen-results-scroll-up span {
    background-image: url("chosen-sprite@2x.png") !important;
    background-size: 52px 37px !important;
    background-repeat: no-repeat !important;
  }
}

/* @end */
</style>
    <style>/*
 * This file should contain generally useful css classes - "round the corners", "add the font", etc.
 * Where possible, css for certain elements should be moved out, although there are clearly some exceptions.
 */

.all-but-hidden {
  max-height: 0;
  max-width:  0;
  opacity:    0;
}

.hidden {
  display: none;
}

.rounded {
  border-radius: 10px;
}

.contained {
  height: 92%;
  min-height: 92%;
}

.normal_font {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
}

.monospace_font {
  font-family: "Courier New", Courier, monospace;
}

.invisible {
  opacity:0;
  width: 0;
  z-index: -1;
}

.text_input_margin {
  margin-top: 10px;
  margin-right: 15px;
}

.center {
  display: block;
  margin: auto;
}

.spacious-entry {
  padding: 8px 8px;
}

.index-button {
  margin: 2%;
  border: 2px solid #347999;
  border-radius: 6px;
  background-color: #DDF4FB;
  transition: background-color 0.25s;
  text-align: center;
}

.index-button:hover {
  background-color: #E8FFFF;
}

.index-button > h2 {
  margin-top: 3%;
  margin-bottom: 0;
}

.icon-button {
  display: block;
  width: 100%;
  height: auto;
  max-width: 256px;
  max-height: 256px;
  margin: auto;
}

.index-link {
  max-width: 300px;
  min-width: 200px;
  text-decoration: none !important;
  color: inherit;
}

.index-link:hover {
  text-decoration: none;
  color: inherit;
}

.properties-list {
  margin-left: 0;
  padding-left: 0;
  list-style: none;
  margin-bottom: 0;
}

.properties-list > li {
  margin: auto;
  padding-left: 0;
  padding-top: 10px;
  padding-bottom: 10px;
  border-top: 1px solid #5499B9;
}

.server-error {
  margin-top: 20px;
  font-size: 20px;
  line-height: 25px;
  text-align: center;
}

div.link-header {
  margin-left: -27px;
  margin-bottom: 20px;
  display: flex;
  flex-direction: row;
  align-items: center;
}

.anchor-header {
  visibility: hidden;
  display: block;
  margin-top: -20px;
  padding-bottom: 20px;
}

.anchor-header:target {
  margin-top: -40px;
  padding-bottom: 40px;
}

div.link-header:hover > a > img.link-img {
  visibility: visible;
}

div.link-header > h2 {
  margin-top: 0;
  margin-bottom: 0;
}

img.link-img {
  top: 50%;
  max-width: 20px;
  visibility: hidden;
}

/*

 Flexbox stuff

 Much of this could be inlined in styles, but we do this to allow the autoprefixer access to it --JAB 3/30/15

 */

.dynamic-row {
  align-items: center;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
}

.dynamic-column-holder {
  align-items: center;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
}

.flex1 {
  flex: 1;
}

.flex2 {
  flex: 2;
}

.flex3 {
  flex: 3;
}

.flex-column {
  display: flex;
  flex-direction: column;
}

.flex-row {
  display: flex;
  flex-direction: row;
  align-items: center;
}
</style>
    <style>/*
 * General-purpose widget styles, applied regardless of what the widget "theme" is
 */

.netlogo-model {
    display: flex;
    padding: 20px;
    flex-flow: column;
    font-size: 12px;
    font-family: "Lucida Grande", sans-serif;
    outline: none;
}

.netlogo-display-vertical {
  display: flex;
  flex-flow: column;
}

.netlogo-display-horizontal {
  display: flex !important;
  flex-flow: row !important;
  flex-direction: row !important;
  align-items: unset !important;
}

.netlogo-header {
    display: flex;
    flex-flow: row;
    align-items: center;
    justify-content: space-between;
}

.netlogo-widget {
    box-sizing: border-box;
    background-color: #CCC;
    border-radius: 4px;
    overflow: hidden;
}

.netlogo-command,.netlogo-input {
    user-select:      none;
    -moz-user-select: none;
}

.netlogo-command:hover,.netlogo-input:hover {
  box-shadow: 0 0 6px 3px rgba(15, 15, 15, .40);
  cursor:     pointer;
  z-index:    3;
}

.netlogo-command.netlogo-disabled:hover {
  box-shadow: none;
  cursor:     default;
}

.netlogo-tab-area {
  margin: 25px 10px;
  border: 2px solid;
  border-radius: 10px;
  overflow: hidden;
}

.netlogo-tab {
  display: block;
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyIDEiPjxwb2x5Z29uIHBvaW50cz0iMCwwIDIsMCAxLDEiIGZpbGw9InJnYig4Myw4Myw4MykiLz4gPC9zdmc+");
  background-position: 97% 50%;
  background-repeat: no-repeat;
  background-size: 20px 20px;
  padding: 7px;
  text-align: center;
  cursor: pointer;
}

.netlogo-tab.netlogo-active {
  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyIDEiPjxwb2x5Z29uIHBvaW50cz0iMCwxIDIsMSAxLDAiIGZpbGw9InJnYig4Myw4Myw4MykiLz4gPC9zdmc+");
}

.netlogo-tab:not(:last-child) {
  border-bottom: 1px solid;
  border-bottom-color: inherit;
}

.netlogo-tab input[type=checkbox] {
  display: none;
}

.netlogo-tab-text {
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  user-select: none;
  -moz-user-select: none;
}

.netlogo-tab-content {
  margin-top: 0;
  border: 0 solid #242479;
}

.unselectable {
  user-select:      none;
  -moz-user-select: none;
}

.growing {
  animation-name: grow;
  animation-duration: 0.4s;
  animation-timing-function: ease-out;
}

.shrinking {
  animation-name: grow;
  animation-direction: reverse;
  animation-duration: 0.4s;
  animation-timing-function: ease-in;
}

@keyframes grow {
  0% {
    max-height: 0;
  }
  100% {
    max-height: 100%;
  }
}

.netlogo-model-text {
  background-color: white;
}

.netlogo-model-masthead {
  flex-grow: 1;
  margin: 0 10px 0 0;
  width: 350px;
}

.netlogo-model-masthead > form {
  margin: 0 auto;
}

.netlogo-model-title-wrapper {
  justify-content: center;
  height: 30px;
  line-height: 30px;
}

.netlogo-model-title {
  background-color: initial;
  margin: 0 70px;
  overflow: hidden;
  padding: 0 8px;
  text-align: center;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.hidden {
  visibility: hidden;
}

.netlogo-title-input {
  font-size: 1.5em;
  font-weight: bold;
  letter-spacing: normal;
  margin: 0 5%;
  text-align: center;
  width: 350px;
}

.netlogo-code-container {
  background-color: white;
  margin-top: 0;
}

.netlogo-ugly-button {
  color:      black;
  text-align: center;
  background-color: rgb(240, 240, 240);
  border-color: rgb(238, 238, 238);
}

.netlogo-ugly-button:disabled {
  color: rgb(150, 150, 150);
}

.netlogo-recompilation-button {
  width: 30%;
  margin: 12px auto;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}

.netlogo-procedurenames-dropdown {
  width: 30%;
  margin: 12px auto;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
}

.netlogo-codetab-widget-list {
  padding: 0;
  margin: 12px 12px;
  display: inline;
}

.netlogo-codetab-widget-listitem {
  display: inline;
  padding: 6px;
}

.netlogo-autocomplete-label {
  font-size: 16px;
}

.netlogo-autocomplete-checkbox {
  width: 14px;
  height: 14px;
}

.netlogo-codeusage-popup {
  position:absolute;
  z-index: 10;
  border:1px solid #B2B2B2;
  background: white;
  box-shadow: 3px 3px 2px #E9E9E9;
  border-radius:4px;
  max-height: 15em;
  overflow-y: auto;
}

.netlogo-codeusage-list {
  list-style:none;
  margin-top:1px;
  padding: 1px;
  font-size:90%;
  font-family: monospace;
}

.netlogo-codeusage-item {
  padding: 1px;
}

.netlogo-codeusage-item:hover {
  color: white;
  background:#284570;
  border-radius:2px;
}

.netlogo-info-editor {
  border: 1px solid black;
  height: 500px;
}

.netlogo-info {
  flex: 1;
  margin-top: 0;
  padding-top: 10px;
  padding: 15px;
}

.netlogo-command-center {
  flex: 1;
  display: flex;
  flex-direction: column;
  height: 175px;
  padding: 6px 8px;
  border-bottom: 1px solid;
  border-bottom-color: inherit;
}

/* I don't actually understand why setting `width` here does what it does.  Without it, if you fill up the Command
 * Center with text, instead of becoming horizontally scrollable, the input grows in width, even if it means becoming
 * larger than the input's container.  So the input (rather than the text) just flows off the side of the screen.
 * If I go down a level in the CSS and set the width on the CodeMirror instance directly, that kind of fixes the
 * problem, but only if I know the expect width that I want (which I don't).  However, if I come here and set the
 * width to *any* numeric value, the input always fits exactly the amount of space it's supposed to use.  Fricken weird.
 * --JAB (10/12/17)
 */
.netlogo-command-center-editor {
  height: 1.25em;
  flex-grow: 1;
  width: 42px; /* Arbitrary as hell; see comment above. --JAB (10/12/17) */
}

.netlogo-command-center-editor .CodeMirror {
  border: 1px solid #111;
  height: auto;
}

.netlogo-output-widget {
  display: flex;
  padding: 5px;
}

.netlogo-output-area {
  flex-grow: 1;
  flex-direction: column;
  background-color: white;
  margin: 0px;
  overflow: auto;
}

.netlogo-command-center-input {
  display: flex;
  flex-shrink: 0;
}

.netlogo-speed-slider {
  background-color: transparent;
  border: none;
  display: flex;
  flex-direction: column;
  margin: 15px auto 0 auto;
  width: 75%;
}

.netlogo-widget input[type=range]::-ms-tooltip {
  display: none;
}

.netlogo-speed-slider input {
  border: none;
  width: 100%;
}

.netlogo-model input[type=range] {
    cursor: pointer;
    cursor: grab;
}

.netlogo-model input[type=range]:active {
    cursor: pointer;
    cursor: grabbing;
}

.netlogo-tick-counter {
    background-color: #F4F4F4;
    font-size: 13px;
    margin: 3px;
    border: none;
    height: 15px;
}

.netlogo-button {
    border:  inherit;
    color:   black;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 0px;
}

.netlogo-button:disabled {
  color: rgb(150, 150, 150);
}

.netlogo-disabled, .interface-unlocked {
  color: #707070;
}

.netlogo-button.clear-button {
    padding: 5px;
}

.netlogo-button .netlogo-label {
    /* For some reason, Safari doesn't like justify-content in buttons,
       we have to resort to putting a span in the button that can then be
       centered.
       BCH 11/14/2014 */
    margin: auto;
}

.netlogo-action-key {
  color:    grey;
  position: absolute;
  right:    6px;
  top:      5px;
}

.netlogo-action-key.netlogo-focus {
  color: black;
}

.netlogo-button:active, .netlogo-forever-button.netlogo-active {
    background-color: gray;
    color: white;
}

.netlogo-forever-button .netlogo-forever-icon {
  background-image:  url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDQzOC41NDIgNDM4LjU0MiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDM4LjU0MiA0MzguNTQyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTQyNy40MDgsMTkuNjk3Yy03LjgwMy0zLjIzLTE0LjQ2My0xLjkwMi0xOS45ODYsMy45OTlsLTM3LjExNiwzNi44MzRDMzQ5Ljk0LDQxLjMwNSwzMjYuNjcyLDI2LjQxMiwzMDAuNSwxNS44NDggICBDMjc0LjMyOCw1LjI4NSwyNDcuMjUxLDAuMDAzLDIxOS4yNzEsMC4wMDNjLTI5LjY5MiwwLTU4LjA1Miw1LjgwOC04NS4wOCwxNy40MTdjLTI3LjAzLDExLjYxLTUwLjM0NywyNy4yMTUtNjkuOTUxLDQ2LjgyICAgYy0xOS42MDUsMTkuNjA3LTM1LjIxNCw0Mi45MjEtNDYuODI0LDY5Ljk0OUM1LjgwNywxNjEuMjE5LDAsMTg5LjU3NSwwLDIxOS4yNzFjMCwyOS42ODcsNS44MDcsNTguMDUsMTcuNDE3LDg1LjA3OSAgIGMxMS42MTMsMjcuMDMxLDI3LjIxOCw1MC4zNDcsNDYuODI0LDY5Ljk1MmMxOS42MDQsMTkuNTk5LDQyLjkyMSwzNS4yMDcsNjkuOTUxLDQ2LjgxOGMyNy4wMjgsMTEuNjExLDU1LjM4OCwxNy40MTksODUuMDgsMTcuNDE5ICAgYzMyLjczNiwwLDYzLjg2NS02Ljg5OSw5My4zNjMtMjAuN2MyOS41LTEzLjc5NSw1NC42MjUtMzMuMjYsNzUuMzc3LTU4LjM4NmMxLjUyLTEuOTAzLDIuMjM0LTQuMDQ1LDIuMTM2LTYuNDI0ICAgYy0wLjA4OS0yLjM3OC0wLjk5OS00LjMyOS0yLjcxMS01Ljg1MmwtMzkuMTA4LTM5LjM5OWMtMi4xMDEtMS43MTEtNC40NzMtMi41NjYtNy4xMzktMi41NjZjLTMuMDQ1LDAuMzgtNS4yMzIsMS41MjYtNi41NjYsMy40MjkgICBjLTEzLjg5NSwxOC4wODYtMzAuOTMsMzIuMDcyLTUxLjEwNyw0MS45NzdjLTIwLjE3Myw5Ljg5NC00MS41ODYsMTQuODM5LTY0LjIzNywxNC44MzljLTE5Ljc5MiwwLTM4LjY4NC0zLjg1NC01Ni42NzEtMTEuNTY0ICAgYy0xNy45ODktNy43MDYtMzMuNTUxLTE4LjEyNy00Ni42ODItMzEuMjYxYy0xMy4xMy0xMy4xMzUtMjMuNTUxLTI4LjY5MS0zMS4yNjEtNDYuNjgyYy03LjcwOC0xNy45ODctMTEuNTYzLTM2Ljg3NC0xMS41NjMtNTYuNjcxICAgYzAtMTkuNzk1LDMuODU4LTM4LjY5MSwxMS41NjMtNTYuNjc0YzcuNzA3LTE3Ljk4NSwxOC4xMjctMzMuNTQ3LDMxLjI2MS00Ni42NzhjMTMuMTM1LTEzLjEzNCwyOC42OTMtMjMuNTU1LDQ2LjY4Mi0zMS4yNjUgICBjMTcuOTgzLTcuNzA3LDM2Ljg3OS0xMS41NjMsNTYuNjcxLTExLjU2M2MzOC4yNTksMCw3MS40NzUsMTMuMDM5LDk5LjY0NiwzOS4xMTZsLTM5LjQwOSwzOS4zOTQgICBjLTUuOTAzLDUuNzExLTcuMjMxLDEyLjI3OS00LjAwMSwxOS43MDFjMy4yNDEsNy42MTQsOC44NTYsMTEuNDIsMTYuODU0LDExLjQyaDEyNy45MDZjNC45NDksMCw5LjIzLTEuODA3LDEyLjg0OC01LjQyNCAgIGMzLjYxMy0zLjYxNiw1LjQyLTcuODk4LDUuNDItMTIuODQ3VjM2LjU1QzQzOC41NDIsMjguNTU4LDQzNC44NCwyMi45NDMsNDI3LjQwOCwxOS42OTd6IiBmaWxsPSIjMDAwMDAwIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==);
  background-repeat: no-repeat;
  background-size:   10px 10px;
  bottom:            5px;
  height:            10px;
  position:          absolute;
  right:             5px;
  width:             10px;
}

.netlogo-disabled .netlogo-forever-icon {
  background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDQzOC41NDIgNDM4LjU0MiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDM4LjU0MiA0MzguNTQyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTQyNy40MDgsMTkuNjk3Yy03LjgwMy0zLjIzLTE0LjQ2My0xLjkwMi0xOS45ODYsMy45OTlsLTM3LjExNiwzNi44MzRDMzQ5Ljk0LDQxLjMwNSwzMjYuNjcyLDI2LjQxMiwzMDAuNSwxNS44NDggICBDMjc0LjMyOCw1LjI4NSwyNDcuMjUxLDAuMDAzLDIxOS4yNzEsMC4wMDNjLTI5LjY5MiwwLTU4LjA1Miw1LjgwOC04NS4wOCwxNy40MTdjLTI3LjAzLDExLjYxLTUwLjM0NywyNy4yMTUtNjkuOTUxLDQ2LjgyICAgYy0xOS42MDUsMTkuNjA3LTM1LjIxNCw0Mi45MjEtNDYuODI0LDY5Ljk0OUM1LjgwNywxNjEuMjE5LDAsMTg5LjU3NSwwLDIxOS4yNzFjMCwyOS42ODcsNS44MDcsNTguMDUsMTcuNDE3LDg1LjA3OSAgIGMxMS42MTMsMjcuMDMxLDI3LjIxOCw1MC4zNDcsNDYuODI0LDY5Ljk1MmMxOS42MDQsMTkuNTk5LDQyLjkyMSwzNS4yMDcsNjkuOTUxLDQ2LjgxOGMyNy4wMjgsMTEuNjExLDU1LjM4OCwxNy40MTksODUuMDgsMTcuNDE5ICAgYzMyLjczNiwwLDYzLjg2NS02Ljg5OSw5My4zNjMtMjAuN2MyOS41LTEzLjc5NSw1NC42MjUtMzMuMjYsNzUuMzc3LTU4LjM4NmMxLjUyLTEuOTAzLDIuMjM0LTQuMDQ1LDIuMTM2LTYuNDI0ICAgYy0wLjA4OS0yLjM3OC0wLjk5OS00LjMyOS0yLjcxMS01Ljg1MmwtMzkuMTA4LTM5LjM5OWMtMi4xMDEtMS43MTEtNC40NzMtMi41NjYtNy4xMzktMi41NjZjLTMuMDQ1LDAuMzgtNS4yMzIsMS41MjYtNi41NjYsMy40MjkgICBjLTEzLjg5NSwxOC4wODYtMzAuOTMsMzIuMDcyLTUxLjEwNyw0MS45NzdjLTIwLjE3Myw5Ljg5NC00MS41ODYsMTQuODM5LTY0LjIzNywxNC44MzljLTE5Ljc5MiwwLTM4LjY4NC0zLjg1NC01Ni42NzEtMTEuNTY0ICAgYy0xNy45ODktNy43MDYtMzMuNTUxLTE4LjEyNy00Ni42ODItMzEuMjYxYy0xMy4xMy0xMy4xMzUtMjMuNTUxLTI4LjY5MS0zMS4yNjEtNDYuNjgyYy03LjcwOC0xNy45ODctMTEuNTYzLTM2Ljg3NC0xMS41NjMtNTYuNjcxICAgYzAtMTkuNzk1LDMuODU4LTM4LjY5MSwxMS41NjMtNTYuNjc0YzcuNzA3LTE3Ljk4NSwxOC4xMjctMzMuNTQ3LDMxLjI2MS00Ni42NzhjMTMuMTM1LTEzLjEzNCwyOC42OTMtMjMuNTU1LDQ2LjY4Mi0zMS4yNjUgICBjMTcuOTgzLTcuNzA3LDM2Ljg3OS0xMS41NjMsNTYuNjcxLTExLjU2M2MzOC4yNTksMCw3MS40NzUsMTMuMDM5LDk5LjY0NiwzOS4xMTZsLTM5LjQwOSwzOS4zOTQgICBjLTUuOTAzLDUuNzExLTcuMjMxLDEyLjI3OS00LjAwMSwxOS43MDFjMy4yNDEsNy42MTQsOC44NTYsMTEuNDIsMTYuODU0LDExLjQyaDEyNy45MDZjNC45NDksMCw5LjIzLTEuODA3LDEyLjg0OC01LjQyNCAgIGMzLjYxMy0zLjYxNiw1LjQyLTcuODk4LDUuNDItMTIuODQ3VjM2LjU1QzQzOC41NDIsMjguNTU4LDQzNC44NCwyMi45NDMsNDI3LjQwOCwxOS42OTd6IiBmaWxsPSIjODA4MDgwIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==);
}

.netlogo-button-agent-context {
  font-size: 11px;
  left:      8px;
  position:  absolute;
  top:       5px;
}

.netlogo-disabled .netlogo-button-agent-content {
  color: #808080;
}

.netlogo-text-box {
    background-color: white;
    border: none;
    margin: 0;
    white-space: pre-wrap;
    font-family: "Lucida Grande", sans-serif;
}

.netlogo-switcher {
    display: flex;
    align-items: center;
}

.netlogo-slider {
    padding-left: 3px;
    padding-right: 3px;
}

.netlogo-slider:hover {
    cursor: default;
}

.netlogo-slider input[type=range] {
  background-color: transparent;
  height: 22px;
  margin: 0px;
  margin-bottom: -3px;
  margin-top: -1px;
  padding: 0px;
  width: 100%;
}

.netlogo-label {
  margin: 0 auto;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.netlogo-slider-label {
  display: flex;
  justify-content: space-between;
}

.netlogo-slider-label .netlogo-label {
  flex: 1 1 auto;
  min-width: 0;
}

.netlogo-slider-label .netlogo-slider-value {
  flex: 0 0 auto;
}

.netlogo-slider-label input[type=number] {
    margin: 0px;
    border: 1px;
    padding: 0px;
}

.netlogo-monitor {
    padding: 2px 4px;
    display: flex;
    flex-flow: column;
    justify-content: space-around;
}

.netlogo-monitor > .netlogo-value {
  background-color: white;
  min-height: 11px;
  padding: 2px 2px;
}

.netlogo-value {
    overflow: hidden;
}

.netlogo-code {
  border: 1px solid black;
}

.netlogo-code-tab {
  height: 500px;
}

.netlogo-input-box {
    padding: 2px 4px;
    display: flex;
    flex-flow: column;
    justify-content: space-around;
}

.netlogo-multiline-input {
  flex-grow: 1;
  height:    0; /* This is a hack to get Input widget labels the right heights in Firefox --JAB (11/23/17) */
  width:     auto; /* This is a hack to get input type="number" widgets sized correctly in Firefox -JMB Jan 2018 */
  margin:    4px;
  resize:    none;
}

.netlogo-chooser {
    padding: 2px 4px;
    display: flex;
    flex-flow: column;
    justify-content: space-around;
}

.netlogo-plot {
    box-sizing: content-box; /* otherwise border gets cut off -- BCH 11/9/2014 */
    border: 1px solid black;
    overflow: visible; /* must come after the .netlogo-widget declaration - JMB November 2017 */
}

.highcharts-container {
  overflow: visible !important; /* Let our context-menus be free - JMB November 2017 */
}

.netlogo-forever-button > input {
    display: none;
}

.netlogo-subheader {
  align-items: center;
  display: flex;
  flex-flow: column;
  flex-grow: 0;
  white-space: nowrap;
}

.netlogo-export-wrapper {
  align-items: center;
  display: flex;
  flex-grow: 0;
  white-space: nowrap;
}

.netlogo-widget-error {
  color: red;
}

.netlogo-widget-error:hover {
  cursor: pointer;
}

.CodeMirror {
  height: auto;
}

.CodeMirror-scroll.cm-disabled {
  background-color: #ebebe4;
}

.help-popup {
  background-color: white;
  border:           1px solid black;
  border-radius:    5px;
  box-shadow:       0 0 10px rgba(0,0,0,0.5);
  font-size:        20px;
  padding:          30px 15px;
  position:         absolute;
  outline:          none;
  z-index:          200;
}

/* Credit for this keyboard table CSS goes to the fine folks at GitHub
 * Their code is released under the MIT license. Copyright (c) 2018 GitHub Inc.
 * https://assets-cdn.github.com/assets/github-ef9e6df593c3136722bd837c0437786d.css
 * JAB (5/7/18)
 */
.help-key-table .help-keys {
  padding-right: 10px;
  text-align:    right;
  white-space:   nowrap;
}

.help-key-table td {
  font-size: 16px;
  padding:   3px 0;
}

.help-key-table kbd {
  background-color:    #fafbfc;
  border-bottom-color: #c6cbd1;
  border-radius:       3px;
  border:              solid 1px #d1d5da;
  box-shadow:          inset 0 -1px 0 #c6cbd1;
  color:               #3b793a;
  display:             inline-block;
  font:                16px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
  line-height:         15px;
  padding:             3px 5px;
  vertical-align:      middle;
}

.modal-overlay {
  background-color: rgba(200,200,200,0.7);
  bottom:           0;
  left:             0;
  position:         absolute;
  right:            0;
  top:              0;
  z-index:          99;
}

.async-popup {
  background-color: white;
  border:           1px solid black;
  border-radius:    5px;
  box-shadow:       0 0 10px rgba(0,0,0,0.5);
  min-width:        120px;
  padding:          10px 10px 0 14px;
  position:         absolute;
  outline:          none;
  z-index:          90;
}

.async-dialog-message {
  font-size:  16px;
  margin-top: 20px;
  word-break: break-word;
}

.async-dialog-button-row {
  align-items:     center;
  display:         flex;
  flex-direction:  row;
  justify-content: flex-end;
  margin:          10px 0;
}

.async-dialog-controls {
  margin: 8px 4px 0 0;
}

.async-dialog-text-input {
  width: 100%;
}

.h-center-flexbox {
  align-items:     center;
  display:         flex;
  flex-direction:  row;
  justify-content: center;
}
</style>
    <style>/*
 * Style for things relevant to the widget/interface editor
 */

.editor-overlay {
  z-index: 50;
}

.editor-overlay.selected {
  z-index: 55;
}

.netlogo-toggle-text {
  font-size:   14px;
  margin-top:   3px;
  user-select: none;
  -moz-user-select: none;
}

.netlogo-toggle-container {
  align-items:    center;
  color:          #4f4f4f;
  display:        flex;
  flex-direction: row;
  flex:           none;
  width:          auto;
  margin:         0px 10px;
}

.netlogo-toggle-container.enabled:hover {
  color:  #000000;
  cursor: pointer;
}

.netlogo-interface-unlocker {
  height: 20px;
  margin: auto 0;
  outline: none;
  width: 20px;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADu0lEQVR4Xu1b0VHcMBDddQMhFeRSQUgFOTo4KgiW+A+pAKgg8I+sUAGXCnJXQUgFuXRAGvBmlhGZA05aS9YZz0WaYRjGsqx92n270hMIAzVr7T4AfGjbdoqIEwDgv9fbLRGtqqpaAMCyruvbIaaG2/yItXYPAD4R0REAsNExbYWIXwHgsq7ru5gXY/puDQBr7SkRnQAAg9Cn3SHiRV3X530G8b2bHQB2dSK6SVhxyT72iMPcoZEVAGPMESJayZI+z4mo1lpzaGRp2QBwLn+WZVbCIIh4lisksgAwxMo/xSSXJ/QG4OrqalZVFcd8p0ZEvxFxTkTM7Cv+jYj7iLhHRDNEfNNpIABo2/bw+Ph43rX/pn69AOA0R0S/OjL9EhFPJBJzJHrBNUMHwxi8t33SZC8AjDE3iDgLTZSI/lRVNavrmguczs1aO23bdo6Ir4Tx51rrw84DP+mYDABPkIi+C5P7WVXVNHWF2MPatl0g4rvQdxDxIBbgh/GSAWiaho2f+iZGRL2Mfxi3IwgLpdRBihckAWCtnbjY3/hN5/a88lnqeeYF5wnecHBcsIoFIQkAY8wJIn4JrP651jprTWCMOUPE08A3P2utmTyjWhIATdMwoW1kabf6k9S4983ehQKXwz4vWCqlvCHpGzcVAArAfK2U4t1f9tY0DZfAH30DK6Wi7Yl+weXpH75J5ChOfGNLRRcivo/lnRQAgukPEV/ndv+1jBAk35R0mB2AFDeMiZWmabzhNwgAUgZ4SQCIKDoTRHuAlI5eGIDo9FsAiIk/7ls8QKjISggkFCMxXhjKAkRUOCB2D1JIMMb9/ksSdCe+6xsQlrhCMlfU0VfsAoQOYfiQ1f3cD0tE15KGIIaAlPYSDBjslS6kWACQlqN4gFD4SAC+5PMSAh0Ko8IBkosWDtgeB1wS0b1uwOIoX6WRFiP2+Sg5gNVhpxU+Ek2c+MFaYGd1WAJklACEzu266I2S0evPRwcA64Va66fX4x7ZZIxh8SOLF4wOAAD4ppQKyukh1Slm9d1eQDwfGDoNivLVrgPAjO8VTiTVeRc8gLeo3hsd0p2DnQDAGfFMQJWEz1jjx8oBDwcVz8hpGxXnGLNAAYAR2CShS9L3ToXApmowdxU4ag7YdJFBunixUx7gk89Cqk8BIAGBUWaB0IbIGHMr3QqNwWGUAPA/RPmus+XcB4yZBPmavO8GKW+V+/6P0T8nGasHxHhxr74FgHIsLl+YGPpApJdLx75cQqCEQAmB0R2KxoZxr/6FAzpwwF8eSx5uwugU8AAAAABJRU5ErkJggg==');
  background-size: contain;
}

.netlogo-toggle-container.enabled:hover .netlogo-interface-unlocker {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADQElEQVR4Xu2a8bFNMRDGv1cBKuBVgArQARWgAlSAClABKkAFngpQATqgAubn5c7cuXOym01yzsu7k515f7y5e5Lsl91vN9mcaDu5JemOpLuSbkji/335JumnpDNJXyTx/+pysvIMVyU9kfQoGR2ZDjDeSXoj6Xfkw4jumgA8l/RUEiC0CMa/lvSyZZDct2sAgGt/qNhxzz484kHv0OgNAK7+1rOk8ffHKTQahzn/vCcAuPyLLqvyB2GeLiHRC4Atdv4Qli6e0AOA+ynm/X071/gl6WNiduIakoM3IEvGul46UOIExqqWVgBY9I9Cpie3kxW8/A4YsD41gyeAd9qSJlsBgO3ZNUv+JB0KnIhQMLG7V5yP0CE7VEkLACzwszPr91T51RYyeBjA3XTmuZf0wiC0AIDxgJCTVuN345aAAEiAEJZaAKjlif2c4PaA48V76YLhBYy0wgEugFRDUgsAZPbKmIkc3bsmYDxqjZw8S+S5CQDsRo6l2X08pDbucwYQCuxwzgvIMlZILo5b6wF/DZjfp9NfaCcKlTkdPjR0w/aEP0hFy1djEaSkpuLEGNsrum5HeacGAC/9XVvB/XeYeOQbTodrAFAzZmEE/Fezwm8TALwMcJEAhDNBzWK9dFQzZi8PCKffmsVOAJyCpAbU6QEBBCwSnCEQLcFr3HVywOQA+1RW41UBCjALoVU4gBvf/QMI5Sh/OYlefUWMR9c68XFa3L8T4GDGASorJbvlxXzUgC31XY+YABRsx/QAh/ULMLwwlRkCXmE0OaDAOScHrMQBPH3Z9Q249+cpTW8ZkgPoDnO5edg0AQQuUyPdYQ+wIQGw7u28C1fP4MPfhwOAfuHh87jDRVPK9vKC4QD4VNBOt7pOl94DStpXRw0AO2g1TrzGx6X3AAywXnR4bw6OAgCMWGqgeo3PqPHoD0eCOyOWFrZGxTkBGPUwtNRC91rfRxUCS9Vg7ypwaA5YeshAhWg9vDgqD8jdQ1htrwlABQJDZgHrQMQR2XsVGsFhSACs80DPc8CwJMj7wdwL0t2z+cguW7pDekAv40rGmQCMWgmW7F4PnekB0wOcV+uzM1QQaGuc0wum7aIyOWBygMMB/wCoI9hBlHmMqwAAAABJRU5ErkJggg==');
}

.netlogo-interface-unlocker.interface-unlocked {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAADbklEQVR4Xu2b4VXbMBSFdbVA2w3aCZpOUJgAOkGRPABlgtIJSv9HMp0AMkHDBIUJChuEAcjreSGhqWPJsi2wfSyfk3+SrPfp6j5ZUiBG/mDk8YsEIClgYASstR+5ywAmQojXRHQrhLgFcK+Uuq4bTu+nQJ7nHOQBER0COKwI8JaI5gAutdazEBi9BpDn+TERnfJIhwRTKHMN4EQpNffV7SWAPM8nRHQhhHjbIPBiFVbEJ6XUoqyt3gEwxhwByCMEvt0EewRD2PGIXgEwxnwB8D1y8JvmFgD2ixB6A6DuyBPRHQA2vQmAV4HQGMIHpRRnjtXTCwDrOf/LZ3ZEdA/gnH/FUeRM8fDwsCel5CzxuQIGmyMrYeUJvQBgrf0thOC87npmAI5cRrZdKc/zveVyeQbgvasxIvqWZRlnl+4BVEmfiFSWZeeBEl8VW68duM6Box5PhXcMtHMFWGv/uNIdEZ1kWXZWJ/jtssYYlrtLCT+11kedAmC5EhHP/bJnprWuWvl52bASlsslp8Ayk1xord90CsBay6N7XLpAeZTok1u3UMEpgK+Od+x3DcAl/9ajX5gKPOfLVPCjawBUNjJNjM+nEGvtpcMQrzoDsM79nP52nrVDt5b/pmFjjGsadArAaYBa66gDM51OD6WU/HG1C7upubSt58sAsQH43hWVdB0oCYBnDZAUENkD0hTwqC15QB3jilm2Nya42WePGVxIW7yvT0SuL729TRsA7tp+E3g9wFpbuhwNCeIlymxvXjR9XwLwuM1eqjaMQQE+5SQASQEjMMEXmwJEdANgUfOwwmvuMbLAswPgwKWUvG//dPbm2YSolc16D4BPbKSUk7LFim/TM5RC7wEIIZwbmBXb3kEMeg+gqoNts0xV+0EUPYVirANWJyxl7/BtfIZ2fAgA+MISHznvXD4wxlwE3OsZfhYQQuycu8cwQCYzCAVwR4sqsNby5aTVlbY2z2AAFDcyR6eAIoDRLITW8/Qmy7L/bnhUXXwInRZDmQJXWuunbSwOLsYiaEgmuLMWGBUAl0zbrgIHo4DRAwg1tCblhmKCTWILqpMAbF1qDCJWs1CMr8Gar6xXPCkgKeDfvd562gkrnaZAjMVKGOtmpZ7dA/irrVnXXqaWlHJe9cenNj3p7IZIm07HrJsAxKQ5xLZGr4C/ICqoLrwEHLcAAAAASUVORK5CYII=')
}

.netlogo-toggle-container.enabled:hover .netlogo-interface-unlocker.interface-unlocked {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAC3klEQVR4Xu2b8TUEMRDGv6sAHVABKuAqQAWoABWgAlSAClABVwEqQAdUwPtW1tu3l2STzaxNLsl7+5cke/ObL5PZSUyQeZtkbj8KgKKA9AhsqZ+8AWAZwLt6vgC8+JqTwhKgkTsAdtVjs5EwngDcA3hwgRE7gCMAZ8rTLvY0+1ANJwqIcWysACjvOwCrvlZr+lMRewA+dXPFCOAAwLWA4c0puDQIYS5GxAbgGMCFsPH1dFTAtA0hJgC+nv9Q0Z/LZckRGiFsqnHVkFgA0IjHjmDHbe5GPW0pc6fYVrvEfgcMjqUSqpgQC4BnAIRgatzSqBBtIGsNIohLAOuW+c7V7hIFgC7pHyqvO6q86kZFUC3MH3SNINcINAYFvFm2O+7j9GbfRrmblHBLVY0NgHLl2tc1yp7ZX0irU2VdkKQKVsYGQO8y29M1SpT7d2hjJnlqmGQ6NgCT/CW837SZ3tap4GpsAN8Gz/QJfDal8ONIFxBnYwLgtsftb0j513OblsGoAGwBUNoxDKb8uJpr0i/yCVj/CcD4rgLAx2XCfYsCLEmQtDLLEjDBlibts0rKEohlCdR1dh/vSfRlImT60qM66lZXfkLeaY0BpnQ05IWSY/+KFwGTZg/AqDYGwRwUYBRPAVAUUJaAaAx4VaVrn8OKruAusQsMHgNoOMvbzQMLWy2uy+jm36MHwBMbelxXwLQVPV0hRA/AVsC05fsLA6DLQ6F5Rtf8riC1/STygOqExfArbIVP1x8ePQAawiNn3QUlFiJDT3eSADB37q6+9EynPq7eZ78kAOhUwLs5Ep/ayQBoV5cktsCkFNAGkE0iRC8xE2zf8Oi6+OAaB5JYAjN1R6dplEQSlMwS0OUCWQEwyTQ0C0xGAdkDcA1offolEQT7GOY6pgCoLzW6EvPpJ/E16PO+Pn2LAooCfv9rZJBWlkA5GBlQXkKaZV2BzyBtzBsigxjkO2kB4Ets0fpnr4Af4sW1RwixQEAAAAAASUVORK5CYII=')
}

.netlogo-widget.interface-unlocked {
  user-select:      none;
  -moz-user-select: none;
}

.netlogo-widget.interface-unlocked:hover, .editor-overlay:hover + .netlogo-widget.interface-unlocked {
  box-shadow: 0 0 6px 3px rgba(15, 15, 15, .40);
  cursor:     default;
  z-index:    3;
}

.netlogo-widget.selected {
  z-index: 53;
}

.netlogo-widget-container.interface-unlocked {
  background-color: rgb(234, 255, 225);
}

.context-menu-item {
  border-bottom: solid 1px #dfdfdf;
  color:         #0066aa;
  cursor:        pointer;
  font-size:     18px;
  padding:       5px;
  user-select:   none;
  -moz-user-select: none;
}

.context-menu-item.disabled {
  color:  #999;
  cursor: default;
}

.context-menu-item:hover:not(.disabled) {
  background-color: #0066aa;
  color:            white;
}

.context-menu-item:last-child {
  border-bottom: none;
}

.context-menu-list {
  list-style: none;
  margin:     0;
  padding:    0;
}

.widget-context-menu {
  background-color: white;
  border:           solid 1px #dfdfdf;
  box-shadow:       1px 1px 2px #cfcfcf;
  margin:           0;
  padding:          8px 10px;
  position:         absolute;
  width:            200px;
  z-index:          80;
}

.widget-edit-popup {
  background-color: white;
  border:           1px solid black;
  border-radius:    5px;
  box-shadow:       0 0 10px rgba(0,0,0,0.5);
  padding:          10px 10px 0 10px;
  position:         absolute;
  outline:          none;
  width:            450px;
  z-index:          100;
}

.widget-edit-form {
  color:         #1d1d1d;
  margin-bottom: 10px;
}

.widget-edit-form label {
  user-select:      none;
  -moz-user-select: none;
}

.widget-edit-form-overlay {
  background-color: rgba(0, 0, 0, 0.5);
  height: 100%;
  position: relative;
  width: 100%;
  z-index: 95;
}

.widget-edit-form-title {
  color:         #111111;
  cursor:        default;
  font-weight:   bold;
  margin-bottom: 10px;
  text-align:    center;
  user-select:   none;
  -moz-user-select: none;
}

.widget-edit-form-button-container {
  margin-top: 10px;
  text-align: center;
}

.widget-edit-closer {
  color:       #7F7F7F;
  cursor:      pointer;
  font-weight: bold;
  position:    absolute;
  right:       10px;
  top:         10px;
  user-select: none;
  -moz-user-select: none;
}

.widget-edit-closer:hover {
  color: black;
}

.widget-edit-text {
  font-size: 20px;
}

.widget-edit-checkbox-wrapper {
  white-space: nowrap;
}

.widget-edit-checkbox {
  height: 13px;
}

.widget-edit-input-label {
  margin-right: 10px;
  white-space:  nowrap;
}

.widget-edit-input {
  width: 100%;
}

.widget-edit-input[type="number"] {
  text-align: right;
}

.widget-edit-hint-text {
  color:       #4a4a4a;
  font-size:   15px;
  margin:      2px 0 8px 0;
  user-select: none;
}

.widget-edit-dropdown {
  font-size: 14px;
  height:    30px;
  margin:    0 10px;
}

.widget-edit-inputbox {
  font-size:   20px;
  height:      33px;
  margin-left: 10px;
  padding:      4px;
}

.widget-edit-textbox {
  font-size: 14px;
  height:    115px;
  max-width: 100%;
  min-width: 100%;
}

.widget-edit-fieldset {
  border-radius: 8px;
}

.widget-edit-legend {
  user-select: none;
  -moz-user-select: none;
}

.widget-resize-handle {
  background-color: #727272;
  height:           10px;
  width:            10px;
  position:         absolute;
  z-index:          60;
}

.initial-color {
  color: initial;
}
</style>
    <style>.netlogo-command {
  background-color: #BACFF3;
}
.netlogo-command.netlogo-active, .netlogo-command:active {
  background-color: #1F6A99;
  color: #BACFF3;
}
.netlogo-button.netlogo-disabled:active, .netlogo-forever-button.netlogo-disabled.netlogo-active {
  background-color: #BCBCE5;
  color: #888888;
}
.netlogo-button.interface-unlocked:active {
  background-color: #BACFF3;
  color: #707070
}
.netlogo-input {
  background-color: #8FE585;
}
.netlogo-output {
  background-color: #FFFF9A;
  border: 1px solid #E7E741;
}

.netlogo-slider-label .netlogo-label {
  background-color: #8FE585;
}

.netlogo-slider-label .netlogo-slider-value {
  background-color: #8FE585;
}

.netlogo-tab-area {
  border-color: #242479;
}

.netlogo-tab {
  background-color: #BCBCE5;
  border-color: #242479;
  font-size: 16px;
}

.netlogo-tab.netlogo-active {
  background-color: #7C76fD;
}

.netlogo-tab:active {
  background-color: #7C76fD;
}

.netlogo-tab:hover  {
  background-color: #D3D3EE;
}

.netlogo-tab.netlogo-active:hover  {
  background-color: #9E99FD;
}

.netlogo-view-container {
  background-color: #F4F4F4;
  border: 1px solid #CCCCCC;
}
</style>
    <style>.cm-s-netlogo-default .cm-reporter {
    color: #660096;
}
.cm-s-netlogo-default .cm-command {
    color: #0000AA;
}
.cm-s-netlogo-default .cm-keyword {
    color: #007F69;
}
.cm-s-netlogo-default .cm-comment {
    color: #5A5A5A;
}
.cm-s-netlogo-default .cm-string,
.cm-s-netlogo-default .cm-number,
.cm-s-netlogo-default .cm-constant {
    color: #963700;
}
</style>
    <style>/*
 * Styles for that sweet loading spinner with turtles
 */

#loading-overlay {
  display: flex;
  align-items: center;
  justify-content: center;
}

.spinner-img {
  height: auto;
  width: 10px;
  z-index: 11;
  position: absolute;
}

#spinner {
  height: 50px;
  width:  50px;
  transform-origin: 60% 60%;
  animation-name: spin;
  animation-duration: 1.75s;
  animation-iteration-count: infinite;
  animation-direction: normal;
  animation-timing-function: linear;
  animation-fill-mode: forwards;
  animation-delay: 0s;
  animation-play-state: running;
  z-index: 11;
}

.turtle1 {
  top: 29%;
  left: 29%;
}

.turtle2 {
  top: 20%;
  left: 50%;
}

.turtle3 {
  top: 29%;
  left: 71%;
}

.turtle4 {
  top:  50%;
  left: 80%;
}

.turtle5 {
  top:  71%;
  left: 71%;
}

.turtle6 {
  top:  80%;
  left: 50%;
}

.turtle7 {
  top:  71%;
  left: 29%;
}

.turtle8 {
  top: 50%;
  left: 20%;
}

@keyframes spin {
  from {
      transform: rotate(0deg);
  }
  to {
      transform: rotate(360deg);
  }
}
</style>
    <style>/*
 * styles to use with the "error alert" component
 */

.dark-overlay {
  background-color: rgba(0, 0, 0, 0.7);
  width: 100%;
  height: 100%;
  z-index: 3500;
  top: 0;
  left: 0;
  position: fixed;
}

.alert-overlay {
  display: flex;
  align-items: center;
  align-items: center;
  justify-content: center;
}

.alert-dialog {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  background-color: whitesmoke;
  border: 2px black solid;
  border-radius: 20px;
  opacity: 1;
  overflow: hidden;
  width: fit-content;
  min-width: 450px;
  max-width: 1000px;
}

#alert-title {
  text-align: center;
  margin-bottom: 5px;
}

.alert-text {
  text-align: left;
  padding: 10px;
  font-size: 16px;
  overflow: scroll;
}

.standalone-text {
  color: #555555;
  display: none;
  text-align: center;
}

#alert-dismiss-container {
  border-top: 1px solid lightgray;
  width: 100%;
  text-align: center;
  padding: 10px 0;
}

.alert-button {
  font-size: 14px;
  height: 25px;
  min-width: 50%;
  border-radius: 3px;
  border: 1px solid lightgray;
  background-color: #e6e6e6;
}
</style>
  </head>
  <body style="margin: 0px;">
    <div class="dark-overlay" id="loading-overlay">
  <div id="spinner">
    
      <svg class="spinner-img turtle1" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 55">
        <polygon points="22,0 0,49 22,40 44,49" style="fill: rgba(255, 255, 255, 0.125);" transform="rotate(45.0, 22, 24)">
        </polygon>
      </svg>
    
      <svg class="spinner-img turtle2" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 55">
        <polygon points="22,0 0,49 22,40 44,49" style="fill: rgba(255, 255, 255, 0.25);" transform="rotate(90.0, 22, 24)">
        </polygon>
      </svg>
    
      <svg class="spinner-img turtle3" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 55">
        <polygon points="22,0 0,49 22,40 44,49" style="fill: rgba(255, 255, 255, 0.375);" transform="rotate(135.0, 22, 24)">
        </polygon>
      </svg>
    
      <svg class="spinner-img turtle4" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 55">
        <polygon points="22,0 0,49 22,40 44,49" style="fill: rgba(255, 255, 255, 0.5);" transform="rotate(180.0, 22, 24)">
        </polygon>
      </svg>
    
      <svg class="spinner-img turtle5" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 55">
        <polygon points="22,0 0,49 22,40 44,49" style="fill: rgba(255, 255, 255, 0.625);" transform="rotate(225.0, 22, 24)">
        </polygon>
      </svg>
    
      <svg class="spinner-img turtle6" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 55">
        <polygon points="22,0 0,49 22,40 44,49" style="fill: rgba(255, 255, 255, 0.75);" transform="rotate(270.0, 22, 24)">
        </polygon>
      </svg>
    
      <svg class="spinner-img turtle7" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 55">
        <polygon points="22,0 0,49 22,40 44,49" style="fill: rgba(255, 255, 255, 0.875);" transform="rotate(315.0, 22, 24)">
        </polygon>
      </svg>
    
      <svg class="spinner-img turtle8" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 50 55">
        <polygon points="22,0 0,49 22,40 44,49" style="fill: rgba(255, 255, 255, 1.0);" transform="rotate(360.0, 22, 24)">
        </polygon>
      </svg>
    
  </div>
</div>

    <div id="alert-container"></div>
    <div id="netlogo-model-container" style="display: inline-block;"></div>
    <script>/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
</script>
    <script>(function() {
  var $, AbstractChosen, Chosen, SelectParser,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  SelectParser = (function() {
    function SelectParser() {
      this.options_index = 0;
      this.parsed = [];
    }

    SelectParser.prototype.add_node = function(child) {
      if (child.nodeName.toUpperCase() === "OPTGROUP") {
        return this.add_group(child);
      } else {
        return this.add_option(child);
      }
    };

    SelectParser.prototype.add_group = function(group) {
      var group_position, i, len, option, ref, results1;
      group_position = this.parsed.length;
      this.parsed.push({
        array_index: group_position,
        group: true,
        label: group.label,
        title: group.title ? group.title : void 0,
        children: 0,
        disabled: group.disabled,
        classes: group.className
      });
      ref = group.childNodes;
      results1 = [];
      for (i = 0, len = ref.length; i < len; i++) {
        option = ref[i];
        results1.push(this.add_option(option, group_position, group.disabled));
      }
      return results1;
    };

    SelectParser.prototype.add_option = function(option, group_position, group_disabled) {
      if (option.nodeName.toUpperCase() === "OPTION") {
        if (option.text !== "") {
          if (group_position != null) {
            this.parsed[group_position].children += 1;
          }
          this.parsed.push({
            array_index: this.parsed.length,
            options_index: this.options_index,
            value: option.value,
            text: option.text,
            html: option.innerHTML,
            title: option.title ? option.title : void 0,
            selected: option.selected,
            disabled: group_disabled === true ? group_disabled : option.disabled,
            group_array_index: group_position,
            group_label: group_position != null ? this.parsed[group_position].label : null,
            classes: option.className,
            style: option.style.cssText
          });
        } else {
          this.parsed.push({
            array_index: this.parsed.length,
            options_index: this.options_index,
            empty: true
          });
        }
        return this.options_index += 1;
      }
    };

    return SelectParser;

  })();

  SelectParser.select_to_array = function(select) {
    var child, i, len, parser, ref;
    parser = new SelectParser();
    ref = select.childNodes;
    for (i = 0, len = ref.length; i < len; i++) {
      child = ref[i];
      parser.add_node(child);
    }
    return parser.parsed;
  };

  AbstractChosen = (function() {
    function AbstractChosen(form_field, options1) {
      this.form_field = form_field;
      this.options = options1 != null ? options1 : {};
      this.label_click_handler = bind(this.label_click_handler, this);
      if (!AbstractChosen.browser_is_supported()) {
        return;
      }
      this.is_multiple = this.form_field.multiple;
      this.set_default_text();
      this.set_default_values();
      this.setup();
      this.set_up_html();
      this.register_observers();
      this.on_ready();
    }

    AbstractChosen.prototype.set_default_values = function() {
      this.click_test_action = (function(_this) {
        return function(evt) {
          return _this.test_active_click(evt);
        };
      })(this);
      this.activate_action = (function(_this) {
        return function(evt) {
          return _this.activate_field(evt);
        };
      })(this);
      this.active_field = false;
      this.mouse_on_container = false;
      this.results_showing = false;
      this.result_highlighted = null;
      this.is_rtl = this.options.rtl || /\bchosen-rtl\b/.test(this.form_field.className);
      this.allow_single_deselect = (this.options.allow_single_deselect != null) && (this.form_field.options[0] != null) && this.form_field.options[0].text === "" ? this.options.allow_single_deselect : false;
      this.disable_search_threshold = this.options.disable_search_threshold || 0;
      this.disable_search = this.options.disable_search || false;
      this.enable_split_word_search = this.options.enable_split_word_search != null ? this.options.enable_split_word_search : true;
      this.group_search = this.options.group_search != null ? this.options.group_search : true;
      this.search_contains = this.options.search_contains || false;
      this.single_backstroke_delete = this.options.single_backstroke_delete != null ? this.options.single_backstroke_delete : true;
      this.max_selected_options = this.options.max_selected_options || Infinity;
      this.inherit_select_classes = this.options.inherit_select_classes || false;
      this.display_selected_options = this.options.display_selected_options != null ? this.options.display_selected_options : true;
      this.display_disabled_options = this.options.display_disabled_options != null ? this.options.display_disabled_options : true;
      this.include_group_label_in_selected = this.options.include_group_label_in_selected || false;
      this.max_shown_results = this.options.max_shown_results || Number.POSITIVE_INFINITY;
      this.case_sensitive_search = this.options.case_sensitive_search || false;
      return this.hide_results_on_select = this.options.hide_results_on_select != null ? this.options.hide_results_on_select : true;
    };

    AbstractChosen.prototype.set_default_text = function() {
      if (this.form_field.getAttribute("data-placeholder")) {
        this.default_text = this.form_field.getAttribute("data-placeholder");
      } else if (this.is_multiple) {
        this.default_text = this.options.placeholder_text_multiple || this.options.placeholder_text || AbstractChosen.default_multiple_text;
      } else {
        this.default_text = this.options.placeholder_text_single || this.options.placeholder_text || AbstractChosen.default_single_text;
      }
      this.default_text = this.escape_html(this.default_text);
      return this.results_none_found = this.form_field.getAttribute("data-no_results_text") || this.options.no_results_text || AbstractChosen.default_no_result_text;
    };

    AbstractChosen.prototype.choice_label = function(item) {
      if (this.include_group_label_in_selected && (item.group_label != null)) {
        return "<b class='group-name'>" + (this.escape_html(item.group_label)) + "</b>" + item.html;
      } else {
        return item.html;
      }
    };

    AbstractChosen.prototype.mouse_enter = function() {
      return this.mouse_on_container = true;
    };

    AbstractChosen.prototype.mouse_leave = function() {
      return this.mouse_on_container = false;
    };

    AbstractChosen.prototype.input_focus = function(evt) {
      if (this.is_multiple) {
        if (!this.active_field) {
          return setTimeout(((function(_this) {
            return function() {
              return _this.container_mousedown();
            };
          })(this)), 50);
        }
      } else {
        if (!this.active_field) {
          return this.activate_field();
        }
      }
    };

    AbstractChosen.prototype.input_blur = function(evt) {
      if (!this.mouse_on_container) {
        this.active_field = false;
        return setTimeout(((function(_this) {
          return function() {
            return _this.blur_test();
          };
        })(this)), 100);
      }
    };

    AbstractChosen.prototype.label_click_handler = function(evt) {
      if (this.is_multiple) {
        return this.container_mousedown(evt);
      } else {
        return this.activate_field();
      }
    };

    AbstractChosen.prototype.results_option_build = function(options) {
      var content, data, data_content, i, len, ref, shown_results;
      content = '';
      shown_results = 0;
      ref = this.results_data;
      for (i = 0, len = ref.length; i < len; i++) {
        data = ref[i];
        data_content = '';
        if (data.group) {
          data_content = this.result_add_group(data);
        } else {
          data_content = this.result_add_option(data);
        }
        if (data_content !== '') {
          shown_results++;
          content += data_content;
        }
        if (options != null ? options.first : void 0) {
          if (data.selected && this.is_multiple) {
            this.choice_build(data);
          } else if (data.selected && !this.is_multiple) {
            this.single_set_selected_text(this.choice_label(data));
          }
        }
        if (shown_results >= this.max_shown_results) {
          break;
        }
      }
      return content;
    };

    AbstractChosen.prototype.result_add_option = function(option) {
      var classes, option_el;
      if (!option.search_match) {
        return '';
      }
      if (!this.include_option_in_results(option)) {
        return '';
      }
      classes = [];
      if (!option.disabled && !(option.selected && this.is_multiple)) {
        classes.push("active-result");
      }
      if (option.disabled && !(option.selected && this.is_multiple)) {
        classes.push("disabled-result");
      }
      if (option.selected) {
        classes.push("result-selected");
      }
      if (option.group_array_index != null) {
        classes.push("group-option");
      }
      if (option.classes !== "") {
        classes.push(option.classes);
      }
      option_el = document.createElement("li");
      option_el.className = classes.join(" ");
      if (option.style) {
        option_el.style.cssText = option.style;
      }
      option_el.setAttribute("data-option-array-index", option.array_index);
      option_el.innerHTML = option.highlighted_html || option.html;
      if (option.title) {
        option_el.title = option.title;
      }
      return this.outerHTML(option_el);
    };

    AbstractChosen.prototype.result_add_group = function(group) {
      var classes, group_el;
      if (!(group.search_match || group.group_match)) {
        return '';
      }
      if (!(group.active_options > 0)) {
        return '';
      }
      classes = [];
      classes.push("group-result");
      if (group.classes) {
        classes.push(group.classes);
      }
      group_el = document.createElement("li");
      group_el.className = classes.join(" ");
      group_el.innerHTML = group.highlighted_html || this.escape_html(group.label);
      if (group.title) {
        group_el.title = group.title;
      }
      return this.outerHTML(group_el);
    };

    AbstractChosen.prototype.results_update_field = function() {
      this.set_default_text();
      if (!this.is_multiple) {
        this.results_reset_cleanup();
      }
      this.result_clear_highlight();
      this.results_build();
      if (this.results_showing) {
        return this.winnow_results();
      }
    };

    AbstractChosen.prototype.reset_single_select_options = function() {
      var i, len, ref, result, results1;
      ref = this.results_data;
      results1 = [];
      for (i = 0, len = ref.length; i < len; i++) {
        result = ref[i];
        if (result.selected) {
          results1.push(result.selected = false);
        } else {
          results1.push(void 0);
        }
      }
      return results1;
    };

    AbstractChosen.prototype.results_toggle = function() {
      if (this.results_showing) {
        return this.results_hide();
      } else {
        return this.results_show();
      }
    };

    AbstractChosen.prototype.results_search = function(evt) {
      if (this.results_showing) {
        return this.winnow_results();
      } else {
        return this.results_show();
      }
    };

    AbstractChosen.prototype.winnow_results = function(options) {
      var escapedQuery, fix, i, len, option, prefix, query, ref, regex, results, results_group, search_match, startpos, suffix, text;
      this.no_results_clear();
      results = 0;
      query = this.get_search_text();
      escapedQuery = query.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
      regex = this.get_search_regex(escapedQuery);
      ref = this.results_data;
      for (i = 0, len = ref.length; i < len; i++) {
        option = ref[i];
        option.search_match = false;
        results_group = null;
        search_match = null;
        option.highlighted_html = '';
        if (this.include_option_in_results(option)) {
          if (option.group) {
            option.group_match = false;
            option.active_options = 0;
          }
          if ((option.group_array_index != null) && this.results_data[option.group_array_index]) {
            results_group = this.results_data[option.group_array_index];
            if (results_group.active_options === 0 && results_group.search_match) {
              results += 1;
            }
            results_group.active_options += 1;
          }
          text = option.group ? option.label : option.text;
          if (!(option.group && !this.group_search)) {
            search_match = this.search_string_match(text, regex);
            option.search_match = search_match != null;
            if (option.search_match && !option.group) {
              results += 1;
            }
            if (option.search_match) {
              if (query.length) {
                startpos = search_match.index;
                prefix = text.slice(0, startpos);
                fix = text.slice(startpos, startpos + query.length);
                suffix = text.slice(startpos + query.length);
                option.highlighted_html = (this.escape_html(prefix)) + "<em>" + (this.escape_html(fix)) + "</em>" + (this.escape_html(suffix));
              }
              if (results_group != null) {
                results_group.group_match = true;
              }
            } else if ((option.group_array_index != null) && this.results_data[option.group_array_index].search_match) {
              option.search_match = true;
            }
          }
        }
      }
      this.result_clear_highlight();
      if (results < 1 && query.length) {
        this.update_results_content("");
        return this.no_results(query);
      } else {
        this.update_results_content(this.results_option_build());
        if (!(options != null ? options.skip_highlight : void 0)) {
          return this.winnow_results_set_highlight();
        }
      }
    };

    AbstractChosen.prototype.get_search_regex = function(escaped_search_string) {
      var regex_flag, regex_string;
      regex_string = this.search_contains ? escaped_search_string : "(^|\\s|\\b)" + escaped_search_string + "[^\\s]*";
      if (!(this.enable_split_word_search || this.search_contains)) {
        regex_string = "^" + regex_string;
      }
      regex_flag = this.case_sensitive_search ? "" : "i";
      return new RegExp(regex_string, regex_flag);
    };

    AbstractChosen.prototype.search_string_match = function(search_string, regex) {
      var match;
      match = regex.exec(search_string);
      if (!this.search_contains && (match != null ? match[1] : void 0)) {
        match.index += 1;
      }
      return match;
    };

    AbstractChosen.prototype.choices_count = function() {
      var i, len, option, ref;
      if (this.selected_option_count != null) {
        return this.selected_option_count;
      }
      this.selected_option_count = 0;
      ref = this.form_field.options;
      for (i = 0, len = ref.length; i < len; i++) {
        option = ref[i];
        if (option.selected) {
          this.selected_option_count += 1;
        }
      }
      return this.selected_option_count;
    };

    AbstractChosen.prototype.choices_click = function(evt) {
      evt.preventDefault();
      this.activate_field();
      if (!(this.results_showing || this.is_disabled)) {
        return this.results_show();
      }
    };

    AbstractChosen.prototype.keydown_checker = function(evt) {
      var ref, stroke;
      stroke = (ref = evt.which) != null ? ref : evt.keyCode;
      this.search_field_scale();
      if (stroke !== 8 && this.pending_backstroke) {
        this.clear_backstroke();
      }
      switch (stroke) {
        case 8:
          this.backstroke_length = this.get_search_field_value().length;
          break;
        case 9:
          if (this.results_showing && !this.is_multiple) {
            this.result_select(evt);
          }
          this.mouse_on_container = false;
          break;
        case 13:
          if (this.results_showing) {
            evt.preventDefault();
          }
          break;
        case 27:
          if (this.results_showing) {
            evt.preventDefault();
          }
          break;
        case 32:
          if (this.disable_search) {
            evt.preventDefault();
          }
          break;
        case 38:
          evt.preventDefault();
          this.keyup_arrow();
          break;
        case 40:
          evt.preventDefault();
          this.keydown_arrow();
          break;
      }
    };

    AbstractChosen.prototype.keyup_checker = function(evt) {
      var ref, stroke;
      stroke = (ref = evt.which) != null ? ref : evt.keyCode;
      this.search_field_scale();
      switch (stroke) {
        case 8:
          if (this.is_multiple && this.backstroke_length < 1 && this.choices_count() > 0) {
            this.keydown_backstroke();
          } else if (!this.pending_backstroke) {
            this.result_clear_highlight();
            this.results_search();
          }
          break;
        case 13:
          evt.preventDefault();
          if (this.results_showing) {
            this.result_select(evt);
          }
          break;
        case 27:
          if (this.results_showing) {
            this.results_hide();
          }
          break;
        case 9:
        case 16:
        case 17:
        case 18:
        case 38:
        case 40:
        case 91:
          break;
        default:
          this.results_search();
          break;
      }
    };

    AbstractChosen.prototype.clipboard_event_checker = function(evt) {
      if (this.is_disabled) {
        return;
      }
      return setTimeout(((function(_this) {
        return function() {
          return _this.results_search();
        };
      })(this)), 50);
    };

    AbstractChosen.prototype.container_width = function() {
      if (this.options.width != null) {
        return this.options.width;
      } else {
        return this.form_field.offsetWidth + "px";
      }
    };

    AbstractChosen.prototype.include_option_in_results = function(option) {
      if (this.is_multiple && (!this.display_selected_options && option.selected)) {
        return false;
      }
      if (!this.display_disabled_options && option.disabled) {
        return false;
      }
      if (option.empty) {
        return false;
      }
      return true;
    };

    AbstractChosen.prototype.search_results_touchstart = function(evt) {
      this.touch_started = true;
      return this.search_results_mouseover(evt);
    };

    AbstractChosen.prototype.search_results_touchmove = function(evt) {
      this.touch_started = false;
      return this.search_results_mouseout(evt);
    };

    AbstractChosen.prototype.search_results_touchend = function(evt) {
      if (this.touch_started) {
        return this.search_results_mouseup(evt);
      }
    };

    AbstractChosen.prototype.outerHTML = function(element) {
      var tmp;
      if (element.outerHTML) {
        return element.outerHTML;
      }
      tmp = document.createElement("div");
      tmp.appendChild(element);
      return tmp.innerHTML;
    };

    AbstractChosen.prototype.get_single_html = function() {
      return "<a class=\"chosen-single chosen-default\">\n  <span>" + this.default_text + "</span>\n  <div><b></b></div>\n</a>\n<div class=\"chosen-drop\">\n  <div class=\"chosen-search\">\n    <input class=\"chosen-search-input\" type=\"text\" autocomplete=\"off\" />\n  </div>\n  <ul class=\"chosen-results\"></ul>\n</div>";
    };

    AbstractChosen.prototype.get_multi_html = function() {
      return "<ul class=\"chosen-choices\">\n  <li class=\"search-field\">\n    <input class=\"chosen-search-input\" type=\"text\" autocomplete=\"off\" value=\"" + this.default_text + "\" />\n  </li>\n</ul>\n<div class=\"chosen-drop\">\n  <ul class=\"chosen-results\"></ul>\n</div>";
    };

    AbstractChosen.prototype.get_no_results_html = function(terms) {
      return "<li class=\"no-results\">\n  " + this.results_none_found + " <span>" + (this.escape_html(terms)) + "</span>\n</li>";
    };

    AbstractChosen.browser_is_supported = function() {
      if ("Microsoft Internet Explorer" === window.navigator.appName) {
        return document.documentMode >= 8;
      }
      if (/iP(od|hone)/i.test(window.navigator.userAgent) || /IEMobile/i.test(window.navigator.userAgent) || /Windows Phone/i.test(window.navigator.userAgent) || /BlackBerry/i.test(window.navigator.userAgent) || /BB10/i.test(window.navigator.userAgent) || /Android.*Mobile/i.test(window.navigator.userAgent)) {
        return false;
      }
      return true;
    };

    AbstractChosen.default_multiple_text = "Select Some Options";

    AbstractChosen.default_single_text = "Select an Option";

    AbstractChosen.default_no_result_text = "No results match";

    return AbstractChosen;

  })();

  $ = jQuery;

  $.fn.extend({
    chosen: function(options) {
      if (!AbstractChosen.browser_is_supported()) {
        return this;
      }
      return this.each(function(input_field) {
        var $this, chosen;
        $this = $(this);
        chosen = $this.data('chosen');
        if (options === 'destroy') {
          if (chosen instanceof Chosen) {
            chosen.destroy();
          }
          return;
        }
        if (!(chosen instanceof Chosen)) {
          $this.data('chosen', new Chosen(this, options));
        }
      });
    }
  });

  Chosen = (function(superClass) {
    extend(Chosen, superClass);

    function Chosen() {
      return Chosen.__super__.constructor.apply(this, arguments);
    }

    Chosen.prototype.setup = function() {
      this.form_field_jq = $(this.form_field);
      return this.current_selectedIndex = this.form_field.selectedIndex;
    };

    Chosen.prototype.set_up_html = function() {
      var container_classes, container_props;
      container_classes = ["chosen-container"];
      container_classes.push("chosen-container-" + (this.is_multiple ? "multi" : "single"));
      if (this.inherit_select_classes && this.form_field.className) {
        container_classes.push(this.form_field.className);
      }
      if (this.is_rtl) {
        container_classes.push("chosen-rtl");
      }
      container_props = {
        'class': container_classes.join(' '),
        'title': this.form_field.title
      };
      if (this.form_field.id.length) {
        container_props.id = this.form_field.id.replace(/[^\w]/g, '_') + "_chosen";
      }
      this.container = $("<div />", container_props);
      this.container.width(this.container_width());
      if (this.is_multiple) {
        this.container.html(this.get_multi_html());
      } else {
        this.container.html(this.get_single_html());
      }
      this.form_field_jq.hide().after(this.container);
      this.dropdown = this.container.find('div.chosen-drop').first();
      this.search_field = this.container.find('input').first();
      this.search_results = this.container.find('ul.chosen-results').first();
      this.search_field_scale();
      this.search_no_results = this.container.find('li.no-results').first();
      if (this.is_multiple) {
        this.search_choices = this.container.find('ul.chosen-choices').first();
        this.search_container = this.container.find('li.search-field').first();
      } else {
        this.search_container = this.container.find('div.chosen-search').first();
        this.selected_item = this.container.find('.chosen-single').first();
      }
      this.results_build();
      this.set_tab_index();
      return this.set_label_behavior();
    };

    Chosen.prototype.on_ready = function() {
      return this.form_field_jq.trigger("chosen:ready", {
        chosen: this
      });
    };

    Chosen.prototype.register_observers = function() {
      this.container.on('touchstart.chosen', (function(_this) {
        return function(evt) {
          _this.container_mousedown(evt);
        };
      })(this));
      this.container.on('touchend.chosen', (function(_this) {
        return function(evt) {
          _this.container_mouseup(evt);
        };
      })(this));
      this.container.on('mousedown.chosen', (function(_this) {
        return function(evt) {
          _this.container_mousedown(evt);
        };
      })(this));
      this.container.on('mouseup.chosen', (function(_this) {
        return function(evt) {
          _this.container_mouseup(evt);
        };
      })(this));
      this.container.on('mouseenter.chosen', (function(_this) {
        return function(evt) {
          _this.mouse_enter(evt);
        };
      })(this));
      this.container.on('mouseleave.chosen', (function(_this) {
        return function(evt) {
          _this.mouse_leave(evt);
        };
      })(this));
      this.search_results.on('mouseup.chosen', (function(_this) {
        return function(evt) {
          _this.search_results_mouseup(evt);
        };
      })(this));
      this.search_results.on('mouseover.chosen', (function(_this) {
        return function(evt) {
          _this.search_results_mouseover(evt);
        };
      })(this));
      this.search_results.on('mouseout.chosen', (function(_this) {
        return function(evt) {
          _this.search_results_mouseout(evt);
        };
      })(this));
      this.search_results.on('mousewheel.chosen DOMMouseScroll.chosen', (function(_this) {
        return function(evt) {
          _this.search_results_mousewheel(evt);
        };
      })(this));
      this.search_results.on('touchstart.chosen', (function(_this) {
        return function(evt) {
          _this.search_results_touchstart(evt);
        };
      })(this));
      this.search_results.on('touchmove.chosen', (function(_this) {
        return function(evt) {
          _this.search_results_touchmove(evt);
        };
      })(this));
      this.search_results.on('touchend.chosen', (function(_this) {
        return function(evt) {
          _this.search_results_touchend(evt);
        };
      })(this));
      this.form_field_jq.on("chosen:updated.chosen", (function(_this) {
        return function(evt) {
          _this.results_update_field(evt);
        };
      })(this));
      this.form_field_jq.on("chosen:activate.chosen", (function(_this) {
        return function(evt) {
          _this.activate_field(evt);
        };
      })(this));
      this.form_field_jq.on("chosen:open.chosen", (function(_this) {
        return function(evt) {
          _this.container_mousedown(evt);
        };
      })(this));
      this.form_field_jq.on("chosen:close.chosen", (function(_this) {
        return function(evt) {
          _this.close_field(evt);
        };
      })(this));
      this.search_field.on('blur.chosen', (function(_this) {
        return function(evt) {
          _this.input_blur(evt);
        };
      })(this));
      this.search_field.on('keyup.chosen', (function(_this) {
        return function(evt) {
          _this.keyup_checker(evt);
        };
      })(this));
      this.search_field.on('keydown.chosen', (function(_this) {
        return function(evt) {
          _this.keydown_checker(evt);
        };
      })(this));
      this.search_field.on('focus.chosen', (function(_this) {
        return function(evt) {
          _this.input_focus(evt);
        };
      })(this));
      this.search_field.on('cut.chosen', (function(_this) {
        return function(evt) {
          _this.clipboard_event_checker(evt);
        };
      })(this));
      this.search_field.on('paste.chosen', (function(_this) {
        return function(evt) {
          _this.clipboard_event_checker(evt);
        };
      })(this));
      if (this.is_multiple) {
        return this.search_choices.on('click.chosen', (function(_this) {
          return function(evt) {
            _this.choices_click(evt);
          };
        })(this));
      } else {
        return this.container.on('click.chosen', function(evt) {
          evt.preventDefault();
        });
      }
    };

    Chosen.prototype.destroy = function() {
      $(this.container[0].ownerDocument).off('click.chosen', this.click_test_action);
      if (this.form_field_label.length > 0) {
        this.form_field_label.off('click.chosen');
      }
      if (this.search_field[0].tabIndex) {
        this.form_field_jq[0].tabIndex = this.search_field[0].tabIndex;
      }
      this.container.remove();
      this.form_field_jq.removeData('chosen');
      return this.form_field_jq.show();
    };

    Chosen.prototype.search_field_disabled = function() {
      this.is_disabled = this.form_field.disabled || this.form_field_jq.parents('fieldset').is(':disabled');
      this.container.toggleClass('chosen-disabled', this.is_disabled);
      this.search_field[0].disabled = this.is_disabled;
      if (!this.is_multiple) {
        this.selected_item.off('focus.chosen', this.activate_field);
      }
      if (this.is_disabled) {
        return this.close_field();
      } else if (!this.is_multiple) {
        return this.selected_item.on('focus.chosen', this.activate_field);
      }
    };

    Chosen.prototype.container_mousedown = function(evt) {
      var ref;
      if (this.is_disabled) {
        return;
      }
      if (evt && ((ref = evt.type) === 'mousedown' || ref === 'touchstart') && !this.results_showing) {
        evt.preventDefault();
      }
      if (!((evt != null) && ($(evt.target)).hasClass("search-choice-close"))) {
        if (!this.active_field) {
          if (this.is_multiple) {
            this.search_field.val("");
          }
          $(this.container[0].ownerDocument).on('click.chosen', this.click_test_action);
          this.results_show();
        } else if (!this.is_multiple && evt && (($(evt.target)[0] === this.selected_item[0]) || $(evt.target).parents("a.chosen-single").length)) {
          evt.preventDefault();
          this.results_toggle();
        }
        return this.activate_field();
      }
    };

    Chosen.prototype.container_mouseup = function(evt) {
      if (evt.target.nodeName === "ABBR" && !this.is_disabled) {
        return this.results_reset(evt);
      }
    };

    Chosen.prototype.search_results_mousewheel = function(evt) {
      var delta;
      if (evt.originalEvent) {
        delta = evt.originalEvent.deltaY || -evt.originalEvent.wheelDelta || evt.originalEvent.detail;
      }
      if (delta != null) {
        evt.preventDefault();
        if (evt.type === 'DOMMouseScroll') {
          delta = delta * 40;
        }
        return this.search_results.scrollTop(delta + this.search_results.scrollTop());
      }
    };

    Chosen.prototype.blur_test = function(evt) {
      if (!this.active_field && this.container.hasClass("chosen-container-active")) {
        return this.close_field();
      }
    };

    Chosen.prototype.close_field = function() {
      $(this.container[0].ownerDocument).off("click.chosen", this.click_test_action);
      this.active_field = false;
      this.results_hide();
      this.container.removeClass("chosen-container-active");
      this.clear_backstroke();
      this.show_search_field_default();
      this.search_field_scale();
      return this.search_field.blur();
    };

    Chosen.prototype.activate_field = function() {
      if (this.is_disabled) {
        return;
      }
      this.container.addClass("chosen-container-active");
      this.active_field = true;
      this.search_field.val(this.search_field.val());
      return this.search_field.focus();
    };

    Chosen.prototype.test_active_click = function(evt) {
      var active_container;
      active_container = $(evt.target).closest('.chosen-container');
      if (active_container.length && this.container[0] === active_container[0]) {
        return this.active_field = true;
      } else {
        return this.close_field();
      }
    };

    Chosen.prototype.results_build = function() {
      this.parsing = true;
      this.selected_option_count = null;
      this.results_data = SelectParser.select_to_array(this.form_field);
      if (this.is_multiple) {
        this.search_choices.find("li.search-choice").remove();
      } else {
        this.single_set_selected_text();
        if (this.disable_search || this.form_field.options.length <= this.disable_search_threshold) {
          this.search_field[0].readOnly = true;
          this.container.addClass("chosen-container-single-nosearch");
        } else {
          this.search_field[0].readOnly = false;
          this.container.removeClass("chosen-container-single-nosearch");
        }
      }
      this.update_results_content(this.results_option_build({
        first: true
      }));
      this.search_field_disabled();
      this.show_search_field_default();
      this.search_field_scale();
      return this.parsing = false;
    };

    Chosen.prototype.result_do_highlight = function(el) {
      var high_bottom, high_top, maxHeight, visible_bottom, visible_top;
      if (el.length) {
        this.result_clear_highlight();
        this.result_highlight = el;
        this.result_highlight.addClass("highlighted");
        maxHeight = parseInt(this.search_results.css("maxHeight"), 10);
        visible_top = this.search_results.scrollTop();
        visible_bottom = maxHeight + visible_top;
        high_top = this.result_highlight.position().top + this.search_results.scrollTop();
        high_bottom = high_top + this.result_highlight.outerHeight();
        if (high_bottom >= visible_bottom) {
          return this.search_results.scrollTop((high_bottom - maxHeight) > 0 ? high_bottom - maxHeight : 0);
        } else if (high_top < visible_top) {
          return this.search_results.scrollTop(high_top);
        }
      }
    };

    Chosen.prototype.result_clear_highlight = function() {
      if (this.result_highlight) {
        this.result_highlight.removeClass("highlighted");
      }
      return this.result_highlight = null;
    };

    Chosen.prototype.results_show = function() {
      if (this.is_multiple && this.max_selected_options <= this.choices_count()) {
        this.form_field_jq.trigger("chosen:maxselected", {
          chosen: this
        });
        return false;
      }
      this.container.addClass("chosen-with-drop");
      this.results_showing = true;
      this.search_field.focus();
      this.search_field.val(this.get_search_field_value());
      this.winnow_results();
      return this.form_field_jq.trigger("chosen:showing_dropdown", {
        chosen: this
      });
    };

    Chosen.prototype.update_results_content = function(content) {
      return this.search_results.html(content);
    };

    Chosen.prototype.results_hide = function() {
      if (this.results_showing) {
        this.result_clear_highlight();
        this.container.removeClass("chosen-with-drop");
        this.form_field_jq.trigger("chosen:hiding_dropdown", {
          chosen: this
        });
      }
      return this.results_showing = false;
    };

    Chosen.prototype.set_tab_index = function(el) {
      var ti;
      if (this.form_field.tabIndex) {
        ti = this.form_field.tabIndex;
        this.form_field.tabIndex = -1;
        return this.search_field[0].tabIndex = ti;
      }
    };

    Chosen.prototype.set_label_behavior = function() {
      this.form_field_label = this.form_field_jq.parents("label");
      if (!this.form_field_label.length && this.form_field.id.length) {
        this.form_field_label = $("label[for='" + this.form_field.id + "']");
      }
      if (this.form_field_label.length > 0) {
        return this.form_field_label.on('click.chosen', this.label_click_handler);
      }
    };

    Chosen.prototype.show_search_field_default = function() {
      if (this.is_multiple && this.choices_count() < 1 && !this.active_field) {
        this.search_field.val(this.default_text);
        return this.search_field.addClass("default");
      } else {
        this.search_field.val("");
        return this.search_field.removeClass("default");
      }
    };

    Chosen.prototype.search_results_mouseup = function(evt) {
      var target;
      target = $(evt.target).hasClass("active-result") ? $(evt.target) : $(evt.target).parents(".active-result").first();
      if (target.length) {
        this.result_highlight = target;
        this.result_select(evt);
        return this.search_field.focus();
      }
    };

    Chosen.prototype.search_results_mouseover = function(evt) {
      var target;
      target = $(evt.target).hasClass("active-result") ? $(evt.target) : $(evt.target).parents(".active-result").first();
      if (target) {
        return this.result_do_highlight(target);
      }
    };

    Chosen.prototype.search_results_mouseout = function(evt) {
      if ($(evt.target).hasClass("active-result") || $(evt.target).parents('.active-result').first()) {
        return this.result_clear_highlight();
      }
    };

    Chosen.prototype.choice_build = function(item) {
      var choice, close_link;
      choice = $('<li />', {
        "class": "search-choice"
      }).html("<span>" + (this.choice_label(item)) + "</span>");
      if (item.disabled) {
        choice.addClass('search-choice-disabled');
      } else {
        close_link = $('<a />', {
          "class": 'search-choice-close',
          'data-option-array-index': item.array_index
        });
        close_link.on('click.chosen', (function(_this) {
          return function(evt) {
            return _this.choice_destroy_link_click(evt);
          };
        })(this));
        choice.append(close_link);
      }
      return this.search_container.before(choice);
    };

    Chosen.prototype.choice_destroy_link_click = function(evt) {
      evt.preventDefault();
      evt.stopPropagation();
      if (!this.is_disabled) {
        return this.choice_destroy($(evt.target));
      }
    };

    Chosen.prototype.choice_destroy = function(link) {
      if (this.result_deselect(link[0].getAttribute("data-option-array-index"))) {
        if (this.active_field) {
          this.search_field.focus();
        } else {
          this.show_search_field_default();
        }
        if (this.is_multiple && this.choices_count() > 0 && this.get_search_field_value().length < 1) {
          this.results_hide();
        }
        link.parents('li').first().remove();
        return this.search_field_scale();
      }
    };

    Chosen.prototype.results_reset = function() {
      this.reset_single_select_options();
      this.form_field.options[0].selected = true;
      this.single_set_selected_text();
      this.show_search_field_default();
      this.results_reset_cleanup();
      this.trigger_form_field_change();
      if (this.active_field) {
        return this.results_hide();
      }
    };

    Chosen.prototype.results_reset_cleanup = function() {
      this.current_selectedIndex = this.form_field.selectedIndex;
      return this.selected_item.find("abbr").remove();
    };

    Chosen.prototype.result_select = function(evt) {
      var high, item;
      if (this.result_highlight) {
        high = this.result_highlight;
        this.result_clear_highlight();
        if (this.is_multiple && this.max_selected_options <= this.choices_count()) {
          this.form_field_jq.trigger("chosen:maxselected", {
            chosen: this
          });
          return false;
        }
        if (this.is_multiple) {
          high.removeClass("active-result");
        } else {
          this.reset_single_select_options();
        }
        high.addClass("result-selected");
        item = this.results_data[high[0].getAttribute("data-option-array-index")];
        item.selected = true;
        this.form_field.options[item.options_index].selected = true;
        this.selected_option_count = null;
        if (this.is_multiple) {
          this.choice_build(item);
        } else {
          this.single_set_selected_text(this.choice_label(item));
        }
        if (this.is_multiple && (!this.hide_results_on_select || (evt.metaKey || evt.ctrlKey))) {
          if (evt.metaKey || evt.ctrlKey) {
            this.winnow_results({
              skip_highlight: true
            });
          } else {
            this.search_field.val("");
            this.winnow_results();
          }
        } else {
          this.results_hide();
          this.show_search_field_default();
        }
        if (this.is_multiple || this.form_field.selectedIndex !== this.current_selectedIndex) {
          this.trigger_form_field_change({
            selected: this.form_field.options[item.options_index].value
          });
        }
        this.current_selectedIndex = this.form_field.selectedIndex;
        evt.preventDefault();
        return this.search_field_scale();
      }
    };

    Chosen.prototype.single_set_selected_text = function(text) {
      if (text == null) {
        text = this.default_text;
      }
      if (text === this.default_text) {
        this.selected_item.addClass("chosen-default");
      } else {
        this.single_deselect_control_build();
        this.selected_item.removeClass("chosen-default");
      }
      return this.selected_item.find("span").html(text);
    };

    Chosen.prototype.result_deselect = function(pos) {
      var result_data;
      result_data = this.results_data[pos];
      if (!this.form_field.options[result_data.options_index].disabled) {
        result_data.selected = false;
        this.form_field.options[result_data.options_index].selected = false;
        this.selected_option_count = null;
        this.result_clear_highlight();
        if (this.results_showing) {
          this.winnow_results();
        }
        this.trigger_form_field_change({
          deselected: this.form_field.options[result_data.options_index].value
        });
        this.search_field_scale();
        return true;
      } else {
        return false;
      }
    };

    Chosen.prototype.single_deselect_control_build = function() {
      if (!this.allow_single_deselect) {
        return;
      }
      if (!this.selected_item.find("abbr").length) {
        this.selected_item.find("span").first().after("<abbr class=\"search-choice-close\"></abbr>");
      }
      return this.selected_item.addClass("chosen-single-with-deselect");
    };

    Chosen.prototype.get_search_field_value = function() {
      return this.search_field.val();
    };

    Chosen.prototype.get_search_text = function() {
      return $.trim(this.get_search_field_value());
    };

    Chosen.prototype.escape_html = function(text) {
      return $('<div/>').text(text).html();
    };

    Chosen.prototype.winnow_results_set_highlight = function() {
      var do_high, selected_results;
      selected_results = !this.is_multiple ? this.search_results.find(".result-selected.active-result") : [];
      do_high = selected_results.length ? selected_results.first() : this.search_results.find(".active-result").first();
      if (do_high != null) {
        return this.result_do_highlight(do_high);
      }
    };

    Chosen.prototype.no_results = function(terms) {
      var no_results_html;
      no_results_html = this.get_no_results_html(terms);
      this.search_results.append(no_results_html);
      return this.form_field_jq.trigger("chosen:no_results", {
        chosen: this
      });
    };

    Chosen.prototype.no_results_clear = function() {
      return this.search_results.find(".no-results").remove();
    };

    Chosen.prototype.keydown_arrow = function() {
      var next_sib;
      if (this.results_showing && this.result_highlight) {
        next_sib = this.result_highlight.nextAll("li.active-result").first();
        if (next_sib) {
          return this.result_do_highlight(next_sib);
        }
      } else {
        return this.results_show();
      }
    };

    Chosen.prototype.keyup_arrow = function() {
      var prev_sibs;
      if (!this.results_showing && !this.is_multiple) {
        return this.results_show();
      } else if (this.result_highlight) {
        prev_sibs = this.result_highlight.prevAll("li.active-result");
        if (prev_sibs.length) {
          return this.result_do_highlight(prev_sibs.first());
        } else {
          if (this.choices_count() > 0) {
            this.results_hide();
          }
          return this.result_clear_highlight();
        }
      }
    };

    Chosen.prototype.keydown_backstroke = function() {
      var next_available_destroy;
      if (this.pending_backstroke) {
        this.choice_destroy(this.pending_backstroke.find("a").first());
        return this.clear_backstroke();
      } else {
        next_available_destroy = this.search_container.siblings("li.search-choice").last();
        if (next_available_destroy.length && !next_available_destroy.hasClass("search-choice-disabled")) {
          this.pending_backstroke = next_available_destroy;
          if (this.single_backstroke_delete) {
            return this.keydown_backstroke();
          } else {
            return this.pending_backstroke.addClass("search-choice-focus");
          }
        }
      }
    };

    Chosen.prototype.clear_backstroke = function() {
      if (this.pending_backstroke) {
        this.pending_backstroke.removeClass("search-choice-focus");
      }
      return this.pending_backstroke = null;
    };

    Chosen.prototype.search_field_scale = function() {
      var div, i, len, style, style_block, styles, width;
      if (!this.is_multiple) {
        return;
      }
      style_block = {
        position: 'absolute',
        left: '-1000px',
        top: '-1000px',
        display: 'none',
        whiteSpace: 'pre'
      };
      styles = ['fontSize', 'fontStyle', 'fontWeight', 'fontFamily', 'lineHeight', 'textTransform', 'letterSpacing'];
      for (i = 0, len = styles.length; i < len; i++) {
        style = styles[i];
        style_block[style] = this.search_field.css(style);
      }
      div = $('<div />').css(style_block);
      div.text(this.get_search_field_value());
      $('body').append(div);
      width = div.width() + 25;
      div.remove();
      if (this.container.is(':visible')) {
        width = Math.min(this.container.outerWidth() - 10, width);
      }
      return this.search_field.width(width);
    };

    Chosen.prototype.trigger_form_field_change = function(extra) {
      this.form_field_jq.trigger("input", extra);
      return this.form_field_jq.trigger("change", extra);
    };

    return Chosen;

  })(AbstractChosen);

}).call(this);
</script>
    <script>(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof module&&(module.exports=g)});

//# sourceMappingURL=FileSaver.min.js.map</script>
    <script>var URI=function(){function parse(uriStr){var m=(""+uriStr).match(URI_RE_);if(!m){return null}return new URI(nullIfAbsent(m[1]),nullIfAbsent(m[2]),nullIfAbsent(m[3]),nullIfAbsent(m[4]),nullIfAbsent(m[5]),nullIfAbsent(m[6]),nullIfAbsent(m[7]))}function create(scheme,credentials,domain,port,path,query,fragment){var uri=new URI(encodeIfExists2(scheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists2(credentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists(domain),port>0?port.toString():null,encodeIfExists2(path,URI_DISALLOWED_IN_PATH_),null,encodeIfExists(fragment));if(query){if("string"===typeof query){uri.setRawQuery(query.replace(/[^?&=0-9A-Za-z_\-~.%]/g,encodeOne))}else{uri.setAllParameters(query)}}return uri}function encodeIfExists(unescapedPart){if("string"==typeof unescapedPart){return encodeURIComponent(unescapedPart)}return null}function encodeIfExists2(unescapedPart,extra){if("string"==typeof unescapedPart){return encodeURI(unescapedPart).replace(extra,encodeOne)}return null}function encodeOne(ch){var n=ch.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(n>>4&15)+"0123456789ABCDEF".charAt(n&15)}function normPath(path){return path.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}var PARENT_DIRECTORY_HANDLER=new RegExp(""+"(/|^)"+"(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)"+"/\\.\\.(?:/|$)");var PARENT_DIRECTORY_HANDLER_RE=new RegExp(PARENT_DIRECTORY_HANDLER);var EXTRA_PARENT_PATHS_RE=/^(?:\.\.\/)*(?:\.\.$)?/;function collapse_dots(path){if(path===null){return null}var p=normPath(path);var r=PARENT_DIRECTORY_HANDLER_RE;for(var q;(q=p.replace(r,"$1"))!=p;p=q){}return p}function resolve(baseUri,relativeUri){var absoluteUri=baseUri.clone();var overridden=relativeUri.hasScheme();if(overridden){absoluteUri.setRawScheme(relativeUri.getRawScheme())}else{overridden=relativeUri.hasCredentials()}if(overridden){absoluteUri.setRawCredentials(relativeUri.getRawCredentials())}else{overridden=relativeUri.hasDomain()}if(overridden){absoluteUri.setRawDomain(relativeUri.getRawDomain())}else{overridden=relativeUri.hasPort()}var rawPath=relativeUri.getRawPath();var simplifiedPath=collapse_dots(rawPath);if(overridden){absoluteUri.setPort(relativeUri.getPort());simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,"")}else{overridden=!!rawPath;if(overridden){if(simplifiedPath.charCodeAt(0)!==47){var absRawPath=collapse_dots(absoluteUri.getRawPath()||"").replace(EXTRA_PARENT_PATHS_RE,"");var slash=absRawPath.lastIndexOf("/")+1;simplifiedPath=collapse_dots((slash?absRawPath.substring(0,slash):"")+collapse_dots(rawPath)).replace(EXTRA_PARENT_PATHS_RE,"")}}else{simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,"");if(simplifiedPath!==rawPath){absoluteUri.setRawPath(simplifiedPath)}}}if(overridden){absoluteUri.setRawPath(simplifiedPath)}else{overridden=relativeUri.hasQuery()}if(overridden){absoluteUri.setRawQuery(relativeUri.getRawQuery())}else{overridden=relativeUri.hasFragment()}if(overridden){absoluteUri.setRawFragment(relativeUri.getRawFragment())}return absoluteUri}function URI(rawScheme,rawCredentials,rawDomain,port,rawPath,rawQuery,rawFragment){this.scheme_=rawScheme;this.credentials_=rawCredentials;this.domain_=rawDomain;this.port_=port;this.path_=rawPath;this.query_=rawQuery;this.fragment_=rawFragment;this.paramCache_=null}URI.prototype.toString=function(){var out=[];if(null!==this.scheme_){out.push(this.scheme_,":")}if(null!==this.domain_){out.push("//");if(null!==this.credentials_){out.push(this.credentials_,"@")}out.push(this.domain_);if(null!==this.port_){out.push(":",this.port_.toString())}}if(null!==this.path_){out.push(this.path_)}if(null!==this.query_){out.push("?",this.query_)}if(null!==this.fragment_){out.push("#",this.fragment_)}return out.join("")};URI.prototype.clone=function(){return new URI(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)};URI.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()};URI.prototype.getRawScheme=function(){return this.scheme_};URI.prototype.setScheme=function(newScheme){this.scheme_=encodeIfExists2(newScheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);return this};URI.prototype.setRawScheme=function(newScheme){this.scheme_=newScheme?newScheme:null;return this};URI.prototype.hasScheme=function(){return null!==this.scheme_};URI.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)};URI.prototype.getRawCredentials=function(){return this.credentials_};URI.prototype.setCredentials=function(newCredentials){this.credentials_=encodeIfExists2(newCredentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);return this};URI.prototype.setRawCredentials=function(newCredentials){this.credentials_=newCredentials?newCredentials:null;return this};URI.prototype.hasCredentials=function(){return null!==this.credentials_};URI.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)};URI.prototype.getRawDomain=function(){return this.domain_};URI.prototype.setDomain=function(newDomain){return this.setRawDomain(newDomain&&encodeURIComponent(newDomain))};URI.prototype.setRawDomain=function(newDomain){this.domain_=newDomain?newDomain:null;return this.setRawPath(this.path_)};URI.prototype.hasDomain=function(){return null!==this.domain_};URI.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)};URI.prototype.setPort=function(newPort){if(newPort){newPort=Number(newPort);if(newPort!==(newPort&65535)){throw new Error("Bad port number "+newPort)}this.port_=""+newPort}else{this.port_=null}return this};URI.prototype.hasPort=function(){return null!==this.port_};URI.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)};URI.prototype.getRawPath=function(){return this.path_};URI.prototype.setPath=function(newPath){return this.setRawPath(encodeIfExists2(newPath,URI_DISALLOWED_IN_PATH_))};URI.prototype.setRawPath=function(newPath){if(newPath){newPath=String(newPath);this.path_=!this.domain_||/^\//.test(newPath)?newPath:"/"+newPath}else{this.path_=null}return this};URI.prototype.hasPath=function(){return null!==this.path_};URI.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")};URI.prototype.getRawQuery=function(){return this.query_};URI.prototype.setQuery=function(newQuery){this.paramCache_=null;this.query_=encodeIfExists(newQuery);return this};URI.prototype.setRawQuery=function(newQuery){this.paramCache_=null;this.query_=newQuery?newQuery:null;return this};URI.prototype.hasQuery=function(){return null!==this.query_};URI.prototype.setAllParameters=function(params){if(typeof params==="object"){if(!(params instanceof Array)&&(params instanceof Object||Object.prototype.toString.call(params)!=="[object Array]")){var newParams=[];var i=-1;for(var k in params){var v=params[k];if("string"===typeof v){newParams[++i]=k;newParams[++i]=v}}params=newParams}}this.paramCache_=null;var queryBuf=[];var separator="";for(var j=0;j<params.length;){var k=params[j++];var v=params[j++];queryBuf.push(separator,encodeURIComponent(k.toString()));separator="&";if(v){queryBuf.push("=",encodeURIComponent(v.toString()))}}this.query_=queryBuf.join("");return this};URI.prototype.checkParameterCache_=function(){if(!this.paramCache_){var q=this.query_;if(!q){this.paramCache_=[]}else{var cgiParams=q.split(/[&\?]/);var out=[];var k=-1;for(var i=0;i<cgiParams.length;++i){var m=cgiParams[i].match(/^([^=]*)(?:=(.*))?$/);out[++k]=decodeURIComponent(m[1]).replace(/\+/g," ");out[++k]=decodeURIComponent(m[2]||"").replace(/\+/g," ")}this.paramCache_=out}}};URI.prototype.setParameterValues=function(key,values){if(typeof values==="string"){values=[values]}this.checkParameterCache_();var newValueIndex=0;var pc=this.paramCache_;var params=[];for(var i=0,k=0;i<pc.length;i+=2){if(key===pc[i]){if(newValueIndex<values.length){params.push(key,values[newValueIndex++])}}else{params.push(pc[i],pc[i+1])}}while(newValueIndex<values.length){params.push(key,values[newValueIndex++])}this.setAllParameters(params);return this};URI.prototype.removeParameter=function(key){return this.setParameterValues(key,[])};URI.prototype.getAllParameters=function(){this.checkParameterCache_();return this.paramCache_.slice(0,this.paramCache_.length)};URI.prototype.getParameterValues=function(paramNameUnescaped){this.checkParameterCache_();var values=[];for(var i=0;i<this.paramCache_.length;i+=2){if(paramNameUnescaped===this.paramCache_[i]){values.push(this.paramCache_[i+1])}}return values};URI.prototype.getParameterMap=function(paramNameUnescaped){this.checkParameterCache_();var paramMap={};for(var i=0;i<this.paramCache_.length;i+=2){var key=this.paramCache_[i++],value=this.paramCache_[i++];if(!(key in paramMap)){paramMap[key]=[value]}else{paramMap[key].push(value)}}return paramMap};URI.prototype.getParameterValue=function(paramNameUnescaped){this.checkParameterCache_();for(var i=0;i<this.paramCache_.length;i+=2){if(paramNameUnescaped===this.paramCache_[i]){return this.paramCache_[i+1]}}return null};URI.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)};URI.prototype.getRawFragment=function(){return this.fragment_};URI.prototype.setFragment=function(newFragment){this.fragment_=newFragment?encodeURIComponent(newFragment):null;return this};URI.prototype.setRawFragment=function(newFragment){this.fragment_=newFragment?newFragment:null;return this};URI.prototype.hasFragment=function(){return null!==this.fragment_};function nullIfAbsent(matchPart){return"string"==typeof matchPart&&matchPart.length>0?matchPart:null}var URI_RE_=new RegExp("^"+"(?:"+"([^:/?#]+)"+":)?"+"(?://"+"(?:([^/?#]*)@)?"+"([^/?#:@]*)"+"(?::([0-9]+))?"+")?"+"([^?#]+)?"+"(?:\\?([^#]*))?"+"(?:#(.*))?"+"$");var URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_=/[#\/\?@]/g;var URI_DISALLOWED_IN_PATH_=/[\#\?]/g;URI.parse=parse;URI.create=create;URI.resolve=resolve;URI.collapse_dots=collapse_dots;URI.utils={mimeTypeOf:function(uri){var uriObj=parse(uri);if(/\.html$/.test(uriObj.getPath())){return"text/html"}else{return"application/javascript"}},resolve:function(base,uri){if(base){return resolve(parse(base),parse(uri)).toString()}else{return""+uri}}};return URI}();if(typeof window!=="undefined"){window["URI"]=URI}var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13};html4["atype"]=html4.atype;html4.ATTRIBS={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::optimum":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0};html4["ATTRIBS"]=html4.ATTRIBS;html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256};html4["eflags"]=html4.eflags;html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:4,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2};html4["ELEMENTS"]=html4.ELEMENTS;html4.ELEMENT_DOM_INTERFACES={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"};html4["ELEMENT_DOM_INTERFACES"]=html4.ELEMENT_DOM_INTERFACES;html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};html4["ueffects"]=html4.ueffects;html4.URIEFFECTS={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1,"video::src":1};html4["URIEFFECTS"]=html4.URIEFFECTS;html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0};html4["ltypes"]=html4.ltypes;html4.LOADERTYPES={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2};html4["LOADERTYPES"]=html4.LOADERTYPES;if(typeof window!=="undefined"){window["html4"]=html4}if("I".toLowerCase()!=="i"){throw"I/i problem"}var defs={};defs.TagPolicyDecision;defs.TagPolicy;var html=function(html4){var parseCssDeclarations,sanitizeCssProperty,cssSchema;if("undefined"!==typeof window){parseCssDeclarations=window["parseCssDeclarations"];sanitizeCssProperty=window["sanitizeCssProperty"];cssSchema=window["cssSchema"]}var ENTITIES={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:" "};var decimalEscapeRe=/^#(\d+)$/;var hexEscapeRe=/^#x([0-9A-Fa-f]+)$/;var safeEntityNameRe=/^[A-Za-z][A-za-z0-9]+$/;var entityLookupElement="undefined"!==typeof window&&window["document"]?window["document"].createElement("textarea"):null;function lookupEntity(name){if(ENTITIES.hasOwnProperty(name)){return ENTITIES[name]}var m=name.match(decimalEscapeRe);if(m){return String.fromCharCode(parseInt(m[1],10))}else if(!!(m=name.match(hexEscapeRe))){return String.fromCharCode(parseInt(m[1],16))}else if(entityLookupElement&&safeEntityNameRe.test(name)){entityLookupElement.innerHTML="&"+name+";";var text=entityLookupElement.textContent;ENTITIES[name]=text;return text}else{return"&"+name+";"}}function decodeOneEntity(_,name){return lookupEntity(name)}var nulRe=/\0/g;function stripNULs(s){return s.replace(nulRe,"")}var ENTITY_RE_1=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g;var ENTITY_RE_2=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/;function unescapeEntities(s){return s.replace(ENTITY_RE_1,decodeOneEntity)}var ampRe=/&/g;var looseAmpRe=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;var ltRe=/[<]/g;var gtRe=/>/g;var quotRe=/\"/g;function escapeAttrib(s){return(""+s).replace(ampRe,"&amp;").replace(ltRe,"&lt;").replace(gtRe,"&gt;").replace(quotRe,"&#34;")}function normalizeRCData(rcdata){return rcdata.replace(looseAmpRe,"&amp;$1").replace(ltRe,"&lt;").replace(gtRe,"&gt;")}var ATTR_RE=new RegExp("^\\s*"+"([-.:\\w]+)"+"(?:"+("\\s*(=)\\s*"+"("+('(")[^"]*("|$)'+"|"+"(')[^']*('|$)"+"|"+"(?=[a-z][-\\w]*\\s*=)"+"|"+"[^\"'\\s]*")+")")+")?","i");var splitWillCapture="a,b".split(/(,)/).length===3;var EFLAGS_TEXT=html4.eflags["CDATA"]|html4.eflags["RCDATA"];function makeSaxParser(handler){var hcopy={cdata:handler.cdata||handler["cdata"],comment:handler.comment||handler["comment"],endDoc:handler.endDoc||handler["endDoc"],endTag:handler.endTag||handler["endTag"],pcdata:handler.pcdata||handler["pcdata"],rcdata:handler.rcdata||handler["rcdata"],startDoc:handler.startDoc||handler["startDoc"],startTag:handler.startTag||handler["startTag"]};return function(htmlText,param){return parse(htmlText,hcopy,param)}}var continuationMarker={};function parse(htmlText,handler,param){var m,p,tagName;var parts=htmlSplit(htmlText);var state={noMoreGT:false,noMoreEndComments:false};parseCPS(handler,parts,0,state,param)}function continuationMaker(h,parts,initial,state,param){return function(){parseCPS(h,parts,initial,state,param)}}function parseCPS(h,parts,initial,state,param){try{if(h.startDoc&&initial==0){h.startDoc(param)}var m,p,tagName;for(var pos=initial,end=parts.length;pos<end;){var current=parts[pos++];var next=parts[pos];switch(current){case"&":if(ENTITY_RE_2.test(next)){if(h.pcdata){h.pcdata("&"+next,param,continuationMarker,continuationMaker(h,parts,pos,state,param))}pos++}else{if(h.pcdata){h.pcdata("&amp;",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}break;case"</":if(m=/^([-\w:]+)[^\'\"]*/.exec(next)){if(m[0].length===next.length&&parts[pos+1]===">"){pos+=2;tagName=m[1].toLowerCase();if(h.endTag){h.endTag(tagName,param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}else{pos=parseEndTag(parts,pos,h,param,continuationMarker,state)}}else{if(h.pcdata){h.pcdata("&lt;/",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}break;case"<":if(m=/^([-\w:]+)\s*\/?/.exec(next)){if(m[0].length===next.length&&parts[pos+1]===">"){pos+=2;tagName=m[1].toLowerCase();if(h.startTag){h.startTag(tagName,[],param,continuationMarker,continuationMaker(h,parts,pos,state,param))}var eflags=html4.ELEMENTS[tagName];if(eflags&EFLAGS_TEXT){var tag={name:tagName,next:pos,eflags:eflags};pos=parseText(parts,tag,h,param,continuationMarker,state)}}else{pos=parseStartTag(parts,pos,h,param,continuationMarker,state)}}else{if(h.pcdata){h.pcdata("&lt;",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}break;case"<!--":if(!state.noMoreEndComments){for(p=pos+1;p<end;p++){if(parts[p]===">"&&/--$/.test(parts[p-1])){break}}if(p<end){if(h.comment){var comment=parts.slice(pos,p).join("");h.comment(comment.substr(0,comment.length-2),param,continuationMarker,continuationMaker(h,parts,p+1,state,param))}pos=p+1}else{state.noMoreEndComments=true}}if(state.noMoreEndComments){if(h.pcdata){h.pcdata("&lt;!--",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}break;case"<!":if(!/^\w/.test(next)){if(h.pcdata){h.pcdata("&lt;!",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}else{if(!state.noMoreGT){for(p=pos+1;p<end;p++){if(parts[p]===">"){break}}if(p<end){pos=p+1}else{state.noMoreGT=true}}if(state.noMoreGT){if(h.pcdata){h.pcdata("&lt;!",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}}break;case"<?":if(!state.noMoreGT){for(p=pos+1;p<end;p++){if(parts[p]===">"){break}}if(p<end){pos=p+1}else{state.noMoreGT=true}}if(state.noMoreGT){if(h.pcdata){h.pcdata("&lt;?",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}break;case">":if(h.pcdata){h.pcdata("&gt;",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}break;case"":break;default:if(h.pcdata){h.pcdata(current,param,continuationMarker,continuationMaker(h,parts,pos,state,param))}break}}if(h.endDoc){h.endDoc(param)}}catch(e){if(e!==continuationMarker){throw e}}}function htmlSplit(str){var re=/(<\/|<\!--|<[!?]|[&<>])/g;str+="";if(splitWillCapture){return str.split(re)}else{var parts=[];var lastPos=0;var m;while((m=re.exec(str))!==null){parts.push(str.substring(lastPos,m.index));parts.push(m[0]);lastPos=m.index+m[0].length}parts.push(str.substring(lastPos));return parts}}function parseEndTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);if(!tag){return parts.length}if(h.endTag){h.endTag(tag.name,param,continuationMarker,continuationMaker(h,parts,pos,state,param))}return tag.next}function parseStartTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);if(!tag){return parts.length}if(h.startTag){h.startTag(tag.name,tag.attrs,param,continuationMarker,continuationMaker(h,parts,tag.next,state,param))}if(tag.eflags&EFLAGS_TEXT){return parseText(parts,tag,h,param,continuationMarker,state)}else{return tag.next}}var endTagRe={};function parseText(parts,tag,h,param,continuationMarker,state){var end=parts.length;if(!endTagRe.hasOwnProperty(tag.name)){endTagRe[tag.name]=new RegExp("^"+tag.name+"(?:[\\s\\/]|$)","i")}var re=endTagRe[tag.name];var first=tag.next;var p=tag.next+1;for(;p<end;p++){if(parts[p-1]==="</"&&re.test(parts[p])){break}}if(p<end){p-=1}var buf=parts.slice(first,p).join("");if(tag.eflags&html4.eflags["CDATA"]){if(h.cdata){h.cdata(buf,param,continuationMarker,continuationMaker(h,parts,p,state,param))}}else if(tag.eflags&html4.eflags["RCDATA"]){if(h.rcdata){h.rcdata(normalizeRCData(buf),param,continuationMarker,continuationMaker(h,parts,p,state,param))}}else{throw new Error("bug")}return p}function parseTagAndAttrs(parts,pos){var m=/^([-\w:]+)/.exec(parts[pos]);var tag={};tag.name=m[1].toLowerCase();tag.eflags=html4.ELEMENTS[tag.name];var buf=parts[pos].substr(m[0].length);var p=pos+1;var end=parts.length;for(;p<end;p++){if(parts[p]===">"){break}buf+=parts[p]}if(end<=p){return void 0}var attrs=[];while(buf!==""){m=ATTR_RE.exec(buf);if(!m){buf=buf.replace(/^[\s\S][^a-z\s]*/,"")}else if(m[4]&&!m[5]||m[6]&&!m[7]){var quote=m[4]||m[6];var sawQuote=false;var abuf=[buf,parts[p++]];for(;p<end;p++){if(sawQuote){if(parts[p]===">"){break}}else if(0<=parts[p].indexOf(quote)){sawQuote=true}abuf.push(parts[p])}if(end<=p){break}buf=abuf.join("");continue}else{var aName=m[1].toLowerCase();var aValue=m[2]?decodeValue(m[3]):"";attrs.push(aName,aValue);buf=buf.substr(m[0].length)}}tag.attrs=attrs;tag.next=p+1;return tag}function decodeValue(v){var q=v.charCodeAt(0);if(q===34||q===39){v=v.substr(1,v.length-2)}return unescapeEntities(stripNULs(v))}function makeHtmlSanitizer(tagPolicy){var stack;var ignoring;var emit=function(text,out){if(!ignoring){out.push(text)}};return makeSaxParser({startDoc:function(_){stack=[];ignoring=false},startTag:function(tagNameOrig,attribs,out){if(ignoring){return}if(!html4.ELEMENTS.hasOwnProperty(tagNameOrig)){return}var eflagsOrig=html4.ELEMENTS[tagNameOrig];if(eflagsOrig&html4.eflags["FOLDABLE"]){return}var decision=tagPolicy(tagNameOrig,attribs);if(!decision){ignoring=!(eflagsOrig&html4.eflags["EMPTY"]);return}else if(typeof decision!=="object"){throw new Error("tagPolicy did not return object (old API?)")}if("attribs"in decision){attribs=decision["attribs"]}else{throw new Error("tagPolicy gave no attribs")}var eflagsRep;var tagNameRep;if("tagName"in decision){tagNameRep=decision["tagName"];eflagsRep=html4.ELEMENTS[tagNameRep]}else{tagNameRep=tagNameOrig;eflagsRep=eflagsOrig}if(eflagsOrig&html4.eflags["OPTIONAL_ENDTAG"]){var onStack=stack[stack.length-1];if(onStack&&onStack.orig===tagNameOrig&&(onStack.rep!==tagNameRep||tagNameOrig!==tagNameRep)){out.push("</",onStack.rep,">")}}if(!(eflagsOrig&html4.eflags["EMPTY"])){stack.push({orig:tagNameOrig,rep:tagNameRep})}out.push("<",tagNameRep);for(var i=0,n=attribs.length;i<n;i+=2){var attribName=attribs[i],value=attribs[i+1];if(value!==null&&value!==void 0){out.push(" ",attribName,'="',escapeAttrib(value),'"')}}out.push(">");if(eflagsOrig&html4.eflags["EMPTY"]&&!(eflagsRep&html4.eflags["EMPTY"])){out.push("</",tagNameRep,">")}},endTag:function(tagName,out){if(ignoring){ignoring=false;return}if(!html4.ELEMENTS.hasOwnProperty(tagName)){return}var eflags=html4.ELEMENTS[tagName];if(!(eflags&(html4.eflags["EMPTY"]|html4.eflags["FOLDABLE"]))){var index;if(eflags&html4.eflags["OPTIONAL_ENDTAG"]){for(index=stack.length;--index>=0;){var stackElOrigTag=stack[index].orig;if(stackElOrigTag===tagName){break}if(!(html4.ELEMENTS[stackElOrigTag]&html4.eflags["OPTIONAL_ENDTAG"])){return}}}else{for(index=stack.length;--index>=0;){if(stack[index].orig===tagName){break}}}if(index<0){return}for(var i=stack.length;--i>index;){var stackElRepTag=stack[i].rep;if(!(html4.ELEMENTS[stackElRepTag]&html4.eflags["OPTIONAL_ENDTAG"])){out.push("</",stackElRepTag,">")}}if(index<stack.length){tagName=stack[index].rep}stack.length=index;out.push("</",tagName,">")}},pcdata:emit,rcdata:emit,cdata:emit,endDoc:function(out){for(;stack.length;stack.length--){out.push("</",stack[stack.length-1].rep,">")}}})}var ALLOWED_URI_SCHEMES=/^(?:https?|mailto)$/i;function safeUri(uri,effect,ltype,hints,naiveUriRewriter){if(!naiveUriRewriter){return null}try{var parsed=URI.parse(""+uri);if(parsed){if(!parsed.hasScheme()||ALLOWED_URI_SCHEMES.test(parsed.getScheme())){var safe=naiveUriRewriter(parsed,effect,ltype,hints);return safe?safe.toString():null}}}catch(e){return null}return null}function log(logger,tagName,attribName,oldValue,newValue){if(!attribName){logger(tagName+" removed",{change:"removed",tagName:tagName})}if(oldValue!==newValue){var changed="changed";if(oldValue&&!newValue){
changed="removed"}else if(!oldValue&&newValue){changed="added"}logger(tagName+"."+attribName+" "+changed,{change:changed,tagName:tagName,attribName:attribName,oldValue:oldValue,newValue:newValue})}}function lookupAttribute(map,tagName,attribName){var attribKey;attribKey=tagName+"::"+attribName;if(map.hasOwnProperty(attribKey)){return map[attribKey]}attribKey="*::"+attribName;if(map.hasOwnProperty(attribKey)){return map[attribKey]}return void 0}function getAttributeType(tagName,attribName){return lookupAttribute(html4.ATTRIBS,tagName,attribName)}function getLoaderType(tagName,attribName){return lookupAttribute(html4.LOADERTYPES,tagName,attribName)}function getUriEffect(tagName,attribName){return lookupAttribute(html4.URIEFFECTS,tagName,attribName)}function sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){for(var i=0;i<attribs.length;i+=2){var attribName=attribs[i];var value=attribs[i+1];var oldValue=value;var atype=null,attribKey;if((attribKey=tagName+"::"+attribName,html4.ATTRIBS.hasOwnProperty(attribKey))||(attribKey="*::"+attribName,html4.ATTRIBS.hasOwnProperty(attribKey))){atype=html4.ATTRIBS[attribKey]}if(atype!==null){switch(atype){case html4.atype["NONE"]:break;case html4.atype["SCRIPT"]:value=null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value)}break;case html4.atype["STYLE"]:if("undefined"===typeof parseCssDeclarations){value=null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value)}break}var sanitizedDeclarations=[];parseCssDeclarations(value,{declaration:function(property,tokens){var normProp=property.toLowerCase();sanitizeCssProperty(normProp,tokens,opt_naiveUriRewriter?function(url){return safeUri(url,html4.ueffects.SAME_DOCUMENT,html4.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:normProp},opt_naiveUriRewriter)}:null);if(tokens.length){sanitizedDeclarations.push(normProp+": "+tokens.join(" "))}}});value=sanitizedDeclarations.length>0?sanitizedDeclarations.join(" ; "):null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value)}break;case html4.atype["ID"]:case html4.atype["IDREF"]:case html4.atype["IDREFS"]:case html4.atype["GLOBAL_NAME"]:case html4.atype["LOCAL_NAME"]:case html4.atype["CLASSES"]:value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value)}break;case html4.atype["URI"]:value=safeUri(value,getUriEffect(tagName,attribName),getLoaderType(tagName,attribName),{TYPE:"MARKUP",XML_ATTR:attribName,XML_TAG:tagName},opt_naiveUriRewriter);if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value)}break;case html4.atype["URI_FRAGMENT"]:if(value&&"#"===value.charAt(0)){value=value.substring(1);value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;if(value!==null&&value!==void 0){value="#"+value}}else{value=null}if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value)}break;default:value=null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value)}break}}else{value=null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value)}}attribs[i+1]=value}return attribs}function makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){return function(tagName,attribs){if(!(html4.ELEMENTS[tagName]&html4.eflags["UNSAFE"])){return{attribs:sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger)}}else{if(opt_logger){log(opt_logger,tagName,undefined,undefined,undefined)}}}}function sanitizeWithPolicy(inputHtml,tagPolicy){var outputArray=[];makeHtmlSanitizer(tagPolicy)(inputHtml,outputArray);return outputArray.join("")}function sanitize(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){var tagPolicy=makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger);return sanitizeWithPolicy(inputHtml,tagPolicy)}var html={};html.escapeAttrib=html["escapeAttrib"]=escapeAttrib;html.makeHtmlSanitizer=html["makeHtmlSanitizer"]=makeHtmlSanitizer;html.makeSaxParser=html["makeSaxParser"]=makeSaxParser;html.makeTagPolicy=html["makeTagPolicy"]=makeTagPolicy;html.normalizeRCData=html["normalizeRCData"]=normalizeRCData;html.sanitize=html["sanitize"]=sanitize;html.sanitizeAttribs=html["sanitizeAttribs"]=sanitizeAttribs;html.sanitizeWithPolicy=html["sanitizeWithPolicy"]=sanitizeWithPolicy;html.unescapeEntities=html["unescapeEntities"]=unescapeEntities;return html}(html4);var html_sanitize=html["sanitize"];if(typeof window!=="undefined"){window["html"]=html;window["html_sanitize"]=html_sanitize}</script>
    <script>// Released under MIT license
// Copyright (c) 2009-2010 Dominic Baggott
// Copyright (c) 2009-2010 Ash Berlin
// Copyright (c) 2011 Christoph Dorn <christoph@christophdorn.com> (http://www.christophdorn.com)

/*jshint browser:true, devel:true */

(function( expose ) {

/**
 *  class Markdown
 *
 *  Markdown processing in Javascript done right. We have very particular views
 *  on what constitutes 'right' which include:
 *
 *  - produces well-formed HTML (this means that em and strong nesting is
 *    important)
 *
 *  - has an intermediate representation to allow processing of parsed data (We
 *    in fact have two, both as [JsonML]: a markdown tree and an HTML tree).
 *
 *  - is easily extensible to add new dialects without having to rewrite the
 *    entire parsing mechanics
 *
 *  - has a good test suite
 *
 *  This implementation fulfills all of these (except that the test suite could
 *  do with expanding to automatically run all the fixtures from other Markdown
 *  implementations.)
 *
 *  ##### Intermediate Representation
 *
 *  *TODO* Talk about this :) Its JsonML, but document the node names we use.
 *
 *  [JsonML]: http://jsonml.org/ "JSON Markup Language"
 **/
var Markdown = expose.Markdown = function(dialect) {
  switch (typeof dialect) {
    case "undefined":
      this.dialect = Markdown.dialects.Gruber;
      break;
    case "object":
      this.dialect = dialect;
      break;
    default:
      if ( dialect in Markdown.dialects ) {
        this.dialect = Markdown.dialects[dialect];
      }
      else {
        throw new Error("Unknown Markdown dialect '" + String(dialect) + "'");
      }
      break;
  }
  this.em_state = [];
  this.strong_state = [];
  this.debug_indent = "";
};

/**
 *  parse( markdown, [dialect] ) -> JsonML
 *  - markdown (String): markdown string to parse
 *  - dialect (String | Dialect): the dialect to use, defaults to gruber
 *
 *  Parse `markdown` and return a markdown document as a Markdown.JsonML tree.
 **/
expose.parse = function( source, dialect ) {
  // dialect will default if undefined
  var md = new Markdown( dialect );
  return md.toTree( source );
};

/**
 *  toHTML( markdown, [dialect]  ) -> String
 *  toHTML( md_tree ) -> String
 *  - markdown (String): markdown string to parse
 *  - md_tree (Markdown.JsonML): parsed markdown tree
 *
 *  Take markdown (either as a string or as a JsonML tree) and run it through
 *  [[toHTMLTree]] then turn it into a well-formated HTML fragment.
 **/
expose.toHTML = function toHTML( source , dialect , options ) {
  var input = expose.toHTMLTree( source , dialect , options );

  return expose.renderJsonML( input );
};

/**
 *  toHTMLTree( markdown, [dialect] ) -> JsonML
 *  toHTMLTree( md_tree ) -> JsonML
 *  - markdown (String): markdown string to parse
 *  - dialect (String | Dialect): the dialect to use, defaults to gruber
 *  - md_tree (Markdown.JsonML): parsed markdown tree
 *
 *  Turn markdown into HTML, represented as a JsonML tree. If a string is given
 *  to this function, it is first parsed into a markdown tree by calling
 *  [[parse]].
 **/
expose.toHTMLTree = function toHTMLTree( input, dialect , options ) {
  // convert string input to an MD tree
  if ( typeof input ==="string" ) input = this.parse( input, dialect );

  // Now convert the MD tree to an HTML tree

  // remove references from the tree
  var attrs = extract_attr( input ),
      refs = {};

  if ( attrs && attrs.references ) {
    refs = attrs.references;
  }

  var html = convert_tree_to_html( input, refs , options );
  merge_text_nodes( html );
  return html;
};

// For Spidermonkey based engines
function mk_block_toSource() {
  return "Markdown.mk_block( " +
          uneval(this.toString()) +
          ", " +
          uneval(this.trailing) +
          ", " +
          uneval(this.lineNumber) +
          " )";
}

// node
function mk_block_inspect() {
  var util = require("util");
  return "Markdown.mk_block( " +
          util.inspect(this.toString()) +
          ", " +
          util.inspect(this.trailing) +
          ", " +
          util.inspect(this.lineNumber) +
          " )";

}

var mk_block = Markdown.mk_block = function(block, trail, line) {
  // Be helpful for default case in tests.
  if ( arguments.length == 1 ) trail = "\n\n";

  var s = new String(block);
  s.trailing = trail;
  // To make it clear its not just a string
  s.inspect = mk_block_inspect;
  s.toSource = mk_block_toSource;

  if ( line != undefined )
    s.lineNumber = line;

  return s;
};

function count_lines( str ) {
  var n = 0, i = -1;
  while ( ( i = str.indexOf("\n", i + 1) ) !== -1 ) n++;
  return n;
}

// Internal - split source into rough blocks
Markdown.prototype.split_blocks = function splitBlocks( input, startLine ) {
  input = input.replace(/(\r\n|\n|\r)/g, "\n");
  // [\s\S] matches _anything_ (newline or space)
  // [^] is equivalent but doesn't work in IEs.
  var re = /([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,
      blocks = [],
      m;

  var line_no = 1;

  if ( ( m = /^(\s*\n)/.exec(input) ) != null ) {
    // skip (but count) leading blank lines
    line_no += count_lines( m[0] );
    re.lastIndex = m[0].length;
  }

  while ( ( m = re.exec(input) ) !== null ) {
    if (m[2] == "\n#") {
      m[2] = "\n";
      re.lastIndex--;
    }
    blocks.push( mk_block( m[1], m[2], line_no ) );
    line_no += count_lines( m[0] );
  }

  return blocks;
};

/**
 *  Markdown#processBlock( block, next ) -> undefined | [ JsonML, ... ]
 *  - block (String): the block to process
 *  - next (Array): the following blocks
 *
 * Process `block` and return an array of JsonML nodes representing `block`.
 *
 * It does this by asking each block level function in the dialect to process
 * the block until one can. Succesful handling is indicated by returning an
 * array (with zero or more JsonML nodes), failure by a false value.
 *
 * Blocks handlers are responsible for calling [[Markdown#processInline]]
 * themselves as appropriate.
 *
 * If the blocks were split incorrectly or adjacent blocks need collapsing you
 * can adjust `next` in place using shift/splice etc.
 *
 * If any of this default behaviour is not right for the dialect, you can
 * define a `__call__` method on the dialect that will get invoked to handle
 * the block processing.
 */
Markdown.prototype.processBlock = function processBlock( block, next ) {
  var cbs = this.dialect.block,
      ord = cbs.__order__;

  if ( "__call__" in cbs ) {
    return cbs.__call__.call(this, block, next);
  }

  for ( var i = 0; i < ord.length; i++ ) {
    //D:this.debug( "Testing", ord[i] );
    var res = cbs[ ord[i] ].call( this, block, next );
    if ( res ) {
      //D:this.debug("  matched");
      if ( !isArray(res) || ( res.length > 0 && !( isArray(res[0]) ) ) )
        this.debug(ord[i], "didn't return a proper array");
      //D:this.debug( "" );
      return res;
    }
  }

  // Uhoh! no match! Should we throw an error?
  return [];
};

Markdown.prototype.processInline = function processInline( block ) {
  return this.dialect.inline.__call__.call( this, String( block ) );
};

/**
 *  Markdown#toTree( source ) -> JsonML
 *  - source (String): markdown source to parse
 *
 *  Parse `source` into a JsonML tree representing the markdown document.
 **/
// custom_tree means set this.tree to `custom_tree` and restore old value on return
Markdown.prototype.toTree = function toTree( source, custom_root ) {
  var blocks = source instanceof Array ? source : this.split_blocks( source );

  // Make tree a member variable so its easier to mess with in extensions
  var old_tree = this.tree;
  try {
    this.tree = custom_root || this.tree || [ "markdown" ];

    blocks:
    while ( blocks.length ) {
      var b = this.processBlock( blocks.shift(), blocks );

      // Reference blocks and the like won't return any content
      if ( !b.length ) continue blocks;

      this.tree.push.apply( this.tree, b );
    }
    return this.tree;
  }
  finally {
    if ( custom_root ) {
      this.tree = old_tree;
    }
  }
};

// Noop by default
Markdown.prototype.debug = function () {
  var args = Array.prototype.slice.call( arguments);
  args.unshift(this.debug_indent);
  if ( typeof print !== "undefined" )
      print.apply( print, args );
  if ( typeof console !== "undefined" && typeof console.log !== "undefined" )
      console.log.apply( null, args );
}

Markdown.prototype.loop_re_over_block = function( re, block, cb ) {
  // Dont use /g regexps with this
  var m,
      b = block.valueOf();

  while ( b.length && (m = re.exec(b) ) != null ) {
    b = b.substr( m[0].length );
    cb.call(this, m);
  }
  return b;
};

/**
 * Markdown.dialects
 *
 * Namespace of built-in dialects.
 **/
Markdown.dialects = {};

/**
 * Markdown.dialects.Gruber
 *
 * The default dialect that follows the rules set out by John Gruber's
 * markdown.pl as closely as possible. Well actually we follow the behaviour of
 * that script which in some places is not exactly what the syntax web page
 * says.
 **/
Markdown.dialects.Gruber = {
  block: {
    atxHeader: function atxHeader( block, next ) {
      var m = block.match( /^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/ );

      if ( !m ) return undefined;

      var header = [ "header", { level: m[ 1 ].length } ];
      Array.prototype.push.apply(header, this.processInline(m[ 2 ]));

      if ( m[0].length < block.length )
        next.unshift( mk_block( block.substr( m[0].length ), block.trailing, block.lineNumber + 2 ) );

      return [ header ];
    },

    setextHeader: function setextHeader( block, next ) {
      var m = block.match( /^(.*)\n([-=])\2\2+(?:\n|$)/ );

      if ( !m ) return undefined;

      var level = ( m[ 2 ] === "=" ) ? 1 : 2;
      var header = [ "header", { level : level }, m[ 1 ] ];

      if ( m[0].length < block.length )
        next.unshift( mk_block( block.substr( m[0].length ), block.trailing, block.lineNumber + 2 ) );

      return [ header ];
    },

    code: function code( block, next ) {
      // |    Foo
      // |bar
      // should be a code block followed by a paragraph. Fun
      //
      // There might also be adjacent code block to merge.

      var ret = [],
          re = /^(?: {0,3}\t| {4})(.*)\n?/,
          lines;

      // 4 spaces + content
      if ( !block.match( re ) ) return undefined;

      block_search:
      do {
        // Now pull out the rest of the lines
        var b = this.loop_re_over_block(
                  re, block.valueOf(), function( m ) { ret.push( m[1] ); } );

        if ( b.length ) {
          // Case alluded to in first comment. push it back on as a new block
          next.unshift( mk_block(b, block.trailing) );
          break block_search;
        }
        else if ( next.length ) {
          // Check the next block - it might be code too
          if ( !next[0].match( re ) ) break block_search;

          // Pull how how many blanks lines follow - minus two to account for .join
          ret.push ( block.trailing.replace(/[^\n]/g, "").substring(2) );

          block = next.shift();
        }
        else {
          break block_search;
        }
      } while ( true );

      return [ [ "code_block", ret.join("\n") ] ];
    },

    horizRule: function horizRule( block, next ) {
      // this needs to find any hr in the block to handle abutting blocks
      var m = block.match( /^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/ );

      if ( !m ) {
        return undefined;
      }

      var jsonml = [ [ "hr" ] ];

      // if there's a leading abutting block, process it
      if ( m[ 1 ] ) {
        jsonml.unshift.apply( jsonml, this.processBlock( m[ 1 ], [] ) );
      }

      // if there's a trailing abutting block, stick it into next
      if ( m[ 3 ] ) {
        next.unshift( mk_block( m[ 3 ] ) );
      }

      return jsonml;
    },

    // There are two types of lists. Tight and loose. Tight lists have no whitespace
    // between the items (and result in text just in the <li>) and loose lists,
    // which have an empty line between list items, resulting in (one or more)
    // paragraphs inside the <li>.
    //
    // There are all sorts weird edge cases about the original markdown.pl's
    // handling of lists:
    //
    // * Nested lists are supposed to be indented by four chars per level. But
    //   if they aren't, you can get a nested list by indenting by less than
    //   four so long as the indent doesn't match an indent of an existing list
    //   item in the 'nest stack'.
    //
    // * The type of the list (bullet or number) is controlled just by the
    //    first item at the indent. Subsequent changes are ignored unless they
    //    are for nested lists
    //
    lists: (function( ) {
      // Use a closure to hide a few variables.
      var any_list = "[*+-]|\\d+\\.",
          bullet_list = /[*+-]/,
          number_list = /\d+\./,
          // Capture leading indent as it matters for determining nested lists.
          is_list_re = new RegExp( "^( {0,3})(" + any_list + ")[ \t]+" ),
          indent_re = "(?: {0,3}\\t| {4})";

      // TODO: Cache this regexp for certain depths.
      // Create a regexp suitable for matching an li for a given stack depth
      function regex_for_depth( depth ) {

        return new RegExp(
          // m[1] = indent, m[2] = list_type
          "(?:^(" + indent_re + "{0," + depth + "} {0,3})(" + any_list + ")\\s+)|" +
          // m[3] = cont
          "(^" + indent_re + "{0," + (depth-1) + "}[ ]{0,4})"
        );
      }
      function expand_tab( input ) {
        return input.replace( / {0,3}\t/g, "    " );
      }

      // Add inline content `inline` to `li`. inline comes from processInline
      // so is an array of content
      function add(li, loose, inline, nl) {
        if ( loose ) {
          li.push( [ "para" ].concat(inline) );
          return;
        }
        // Hmmm, should this be any block level element or just paras?
        var add_to = li[li.length -1] instanceof Array && li[li.length - 1][0] == "para"
                   ? li[li.length -1]
                   : li;

        // If there is already some content in this list, add the new line in
        if ( nl && li.length > 1 ) inline.unshift(nl);

        for ( var i = 0; i < inline.length; i++ ) {
          var what = inline[i],
              is_str = typeof what == "string";
          if ( is_str && add_to.length > 1 && typeof add_to[add_to.length-1] == "string" ) {
            add_to[ add_to.length-1 ] += what;
          }
          else {
            add_to.push( what );
          }
        }
      }

      // contained means have an indent greater than the current one. On
      // *every* line in the block
      function get_contained_blocks( depth, blocks ) {

        var re = new RegExp( "^(" + indent_re + "{" + depth + "}.*?\\n?)*$" ),
            replace = new RegExp("^" + indent_re + "{" + depth + "}", "gm"),
            ret = [];

        while ( blocks.length > 0 ) {
          if ( re.exec( blocks[0] ) ) {
            var b = blocks.shift(),
                // Now remove that indent
                x = b.replace( replace, "");

            ret.push( mk_block( x, b.trailing, b.lineNumber ) );
          }
          else {
            break;
          }
        }
        return ret;
      }

      // passed to stack.forEach to turn list items up the stack into paras
      function paragraphify(s, i, stack) {
        var list = s.list;
        var last_li = list[list.length-1];

        if ( last_li[1] instanceof Array && last_li[1][0] == "para" ) {
          return;
        }
        if ( i + 1 == stack.length ) {
          // Last stack frame
          // Keep the same array, but replace the contents
          last_li.push( ["para"].concat( last_li.splice(1, last_li.length - 1) ) );
        }
        else {
          var sublist = last_li.pop();
          last_li.push( ["para"].concat( last_li.splice(1, last_li.length - 1) ), sublist );
        }
      }

      // The matcher function
      return function( block, next ) {
        var m = block.match( is_list_re );
        if ( !m ) return undefined;

        function make_list( m ) {
          var list = bullet_list.exec( m[2] )
                   ? ["bulletlist"]
                   : ["numberlist"];

          stack.push( { list: list, indent: m[1] } );
          return list;
        }


        var stack = [], // Stack of lists for nesting.
            list = make_list( m ),
            last_li,
            loose = false,
            ret = [ stack[0].list ],
            i;

        // Loop to search over block looking for inner block elements and loose lists
        loose_search:
        while ( true ) {
          // Split into lines preserving new lines at end of line
          var lines = block.split( /(?=\n)/ );

          // We have to grab all lines for a li and call processInline on them
          // once as there are some inline things that can span lines.
          var li_accumulate = "";

          // Loop over the lines in this block looking for tight lists.
          tight_search:
          for ( var line_no = 0; line_no < lines.length; line_no++ ) {
            var nl = "",
                l = lines[line_no].replace(/^\n/, function(n) { nl = n; return ""; });

            // TODO: really should cache this
            var line_re = regex_for_depth( stack.length );

            m = l.match( line_re );
            //print( "line:", uneval(l), "\nline match:", uneval(m) );

            // We have a list item
            if ( m[1] !== undefined ) {
              // Process the previous list item, if any
              if ( li_accumulate.length ) {
                add( last_li, loose, this.processInline( li_accumulate ), nl );
                // Loose mode will have been dealt with. Reset it
                loose = false;
                li_accumulate = "";
              }

              m[1] = expand_tab( m[1] );
              var wanted_depth = Math.floor(m[1].length/4)+1;
              //print( "want:", wanted_depth, "stack:", stack.length);
              if ( wanted_depth > stack.length ) {
                // Deep enough for a nested list outright
                //print ( "new nested list" );
                list = make_list( m );
                last_li.push( list );
                last_li = list[1] = [ "listitem" ];
              }
              else {
                // We aren't deep enough to be strictly a new level. This is
                // where Md.pl goes nuts. If the indent matches a level in the
                // stack, put it there, else put it one deeper then the
                // wanted_depth deserves.
                var found = false;
                for ( i = 0; i < stack.length; i++ ) {
                  if ( stack[ i ].indent != m[1] ) continue;
                  list = stack[ i ].list;
                  stack.splice( i+1, stack.length - (i+1) );
                  found = true;
                  break;
                }

                if (!found) {
                  //print("not found. l:", uneval(l));
                  wanted_depth++;
                  if ( wanted_depth <= stack.length ) {
                    stack.splice(wanted_depth, stack.length - wanted_depth);
                    //print("Desired depth now", wanted_depth, "stack:", stack.length);
                    list = stack[wanted_depth-1].list;
                    //print("list:", uneval(list) );
                  }
                  else {
                    //print ("made new stack for messy indent");
                    list = make_list(m);
                    last_li.push(list);
                  }
                }

                //print( uneval(list), "last", list === stack[stack.length-1].list );
                last_li = [ "listitem" ];
                list.push(last_li);
              } // end depth of shenegains
              nl = "";
            }

            // Add content
            if ( l.length > m[0].length ) {
              li_accumulate += nl + l.substr( m[0].length );
            }
          } // tight_search

          if ( li_accumulate.length ) {
            add( last_li, loose, this.processInline( li_accumulate ), nl );
            // Loose mode will have been dealt with. Reset it
            loose = false;
            li_accumulate = "";
          }

          // Look at the next block - we might have a loose list. Or an extra
          // paragraph for the current li
          var contained = get_contained_blocks( stack.length, next );

          // Deal with code blocks or properly nested lists
          if ( contained.length > 0 ) {
            // Make sure all listitems up the stack are paragraphs
            forEach( stack, paragraphify, this);

            last_li.push.apply( last_li, this.toTree( contained, [] ) );
          }

          var next_block = next[0] && next[0].valueOf() || "";

          if ( next_block.match(is_list_re) || next_block.match( /^ / ) ) {
            block = next.shift();

            // Check for an HR following a list: features/lists/hr_abutting
            var hr = this.dialect.block.horizRule( block, next );

            if ( hr ) {
              ret.push.apply(ret, hr);
              break;
            }

            // Make sure all listitems up the stack are paragraphs
            forEach( stack, paragraphify, this);

            loose = true;
            continue loose_search;
          }
          break;
        } // loose_search

        return ret;
      };
    })(),

    blockquote: function blockquote( block, next ) {
      if ( !block.match( /^>/m ) )
        return undefined;

      var jsonml = [];

      // separate out the leading abutting block, if any. I.e. in this case:
      //
      //  a
      //  > b
      //
      if ( block[ 0 ] != ">" ) {
        var lines = block.split( /\n/ ),
            prev = [],
            line_no = block.lineNumber;

        // keep shifting lines until you find a crotchet
        while ( lines.length && lines[ 0 ][ 0 ] != ">" ) {
            prev.push( lines.shift() );
            line_no++;
        }

        var abutting = mk_block( prev.join( "\n" ), "\n", block.lineNumber );
        jsonml.push.apply( jsonml, this.processBlock( abutting, [] ) );
        // reassemble new block of just block quotes!
        block = mk_block( lines.join( "\n" ), block.trailing, line_no );
      }


      // if the next block is also a blockquote merge it in
      while ( next.length && next[ 0 ][ 0 ] == ">" ) {
        var b = next.shift();
        block = mk_block( block + block.trailing + b, b.trailing, block.lineNumber );
      }

      // Strip off the leading "> " and re-process as a block.
      var input = block.replace( /^> ?/gm, "" ),
          old_tree = this.tree,
          processedBlock = this.toTree( input, [ "blockquote" ] ),
          attr = extract_attr( processedBlock );

      // If any link references were found get rid of them
      if ( attr && attr.references ) {
        delete attr.references;
        // And then remove the attribute object if it's empty
        if ( isEmpty( attr ) ) {
          processedBlock.splice( 1, 1 );
        }
      }

      jsonml.push( processedBlock );
      return jsonml;
    },

    referenceDefn: function referenceDefn( block, next) {
      var re = /^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;
      // interesting matches are [ , ref_id, url, , title, title ]

      if ( !block.match(re) )
        return undefined;

      // make an attribute node if it doesn't exist
      if ( !extract_attr( this.tree ) ) {
        this.tree.splice( 1, 0, {} );
      }

      var attrs = extract_attr( this.tree );

      // make a references hash if it doesn't exist
      if ( attrs.references === undefined ) {
        attrs.references = {};
      }

      var b = this.loop_re_over_block(re, block, function( m ) {

        if ( m[2] && m[2][0] == "<" && m[2][m[2].length-1] == ">" )
          m[2] = m[2].substring( 1, m[2].length - 1 );

        var ref = attrs.references[ m[1].toLowerCase() ] = {
          href: m[2]
        };

        if ( m[4] !== undefined )
          ref.title = m[4];
        else if ( m[5] !== undefined )
          ref.title = m[5];

      } );

      if ( b.length )
        next.unshift( mk_block( b, block.trailing ) );

      return [];
    },

    para: function para( block, next ) {
      // everything's a para!
      return [ ["para"].concat( this.processInline( block ) ) ];
    }
  }
};

Markdown.dialects.Gruber.inline = {

    __oneElement__: function oneElement( text, patterns_or_re, previous_nodes ) {
      var m,
          res,
          lastIndex = 0;

      patterns_or_re = patterns_or_re || this.dialect.inline.__patterns__;
      var re = new RegExp( "([\\s\\S]*?)(" + (patterns_or_re.source || patterns_or_re) + ")" );

      m = re.exec( text );
      if (!m) {
        // Just boring text
        return [ text.length, text ];
      }
      else if ( m[1] ) {
        // Some un-interesting text matched. Return that first
        return [ m[1].length, m[1] ];
      }

      var res;
      if ( m[2] in this.dialect.inline ) {
        res = this.dialect.inline[ m[2] ].call(
                  this,
                  text.substr( m.index ), m, previous_nodes || [] );
      }
      // Default for now to make dev easier. just slurp special and output it.
      res = res || [ m[2].length, m[2] ];
      return res;
    },

    __call__: function inline( text, patterns ) {

      var out = [],
          res;

      function add(x) {
        //D:self.debug("  adding output", uneval(x));
        if ( typeof x == "string" && typeof out[out.length-1] == "string" )
          out[ out.length-1 ] += x;
        else
          out.push(x);
      }

      while ( text.length > 0 ) {
        res = this.dialect.inline.__oneElement__.call(this, text, patterns, out );
        text = text.substr( res.shift() );
        forEach(res, add )
      }

      return out;
    },

    // These characters are intersting elsewhere, so have rules for them so that
    // chunks of plain text blocks don't include them
    "]": function () {},
    "}": function () {},

    __escape__ : /^\\[\\`\*_{}\[\]()#\+.!\-]/,

    "\\": function escaped( text ) {
      // [ length of input processed, node/children to add... ]
      // Only esacape: \ ` * _ { } [ ] ( ) # * + - . !
      if ( this.dialect.inline.__escape__.exec( text ) )
        return [ 2, text.charAt( 1 ) ];
      else
        // Not an esacpe
        return [ 1, "\\" ];
    },

    "![": function image( text ) {

      // Unlike images, alt text is plain text only. no other elements are
      // allowed in there

      // ![Alt text](/path/to/img.jpg "Optional title")
      //      1          2            3       4         <--- captures
      var m = text.match( /^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/ );

      if ( m ) {
        if ( m[2] && m[2][0] == "<" && m[2][m[2].length-1] == ">" )
          m[2] = m[2].substring( 1, m[2].length - 1 );

        m[2] = this.dialect.inline.__call__.call( this, m[2], /\\/ )[0];

        var attrs = { alt: m[1], href: m[2] || "" };
        if ( m[4] !== undefined)
          attrs.title = m[4];

        return [ m[0].length, [ "img", attrs ] ];
      }

      // ![Alt text][id]
      m = text.match( /^!\[(.*?)\][ \t]*\[(.*?)\]/ );

      if ( m ) {
        // We can't check if the reference is known here as it likely wont be
        // found till after. Check it in md tree->hmtl tree conversion
        return [ m[0].length, [ "img_ref", { alt: m[1], ref: m[2].toLowerCase(), original: m[0] } ] ];
      }

      // Just consume the '!['
      return [ 2, "![" ];
    },

    "[": function link( text ) {

      var orig = String(text);
      // Inline content is possible inside `link text`
      var res = Markdown.DialectHelpers.inline_until_char.call( this, text.substr(1), "]" );

      // No closing ']' found. Just consume the [
      if ( !res ) return [ 1, "[" ];

      var consumed = 1 + res[ 0 ],
          children = res[ 1 ],
          link,
          attrs;

      // At this point the first [...] has been parsed. See what follows to find
      // out which kind of link we are (reference or direct url)
      text = text.substr( consumed );

      // [link text](/path/to/img.jpg "Optional title")
      //                 1            2       3         <--- captures
      // This will capture up to the last paren in the block. We then pull
      // back based on if there a matching ones in the url
      //    ([here](/url/(test))
      // The parens have to be balanced
      var m = text.match( /^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/ );
      if ( m ) {
        var url = m[1];
        consumed += m[0].length;

        if ( url && url[0] == "<" && url[url.length-1] == ">" )
          url = url.substring( 1, url.length - 1 );

        // If there is a title we don't have to worry about parens in the url
        if ( !m[3] ) {
          var open_parens = 1; // One open that isn't in the capture
          for ( var len = 0; len < url.length; len++ ) {
            switch ( url[len] ) {
            case "(":
              open_parens++;
              break;
            case ")":
              if ( --open_parens == 0) {
                consumed -= url.length - len;
                url = url.substring(0, len);
              }
              break;
            }
          }
        }

        // Process escapes only
        url = this.dialect.inline.__call__.call( this, url, /\\/ )[0];

        attrs = { href: url || "" };
        if ( m[3] !== undefined)
          attrs.title = m[3];

        link = [ "link", attrs ].concat( children );
        return [ consumed, link ];
      }

      // [Alt text][id]
      // [Alt text] [id]
      m = text.match( /^\s*\[(.*?)\]/ );

      if ( m ) {

        consumed += m[ 0 ].length;

        // [links][] uses links as its reference
        attrs = { ref: ( m[ 1 ] || String(children) ).toLowerCase(),  original: orig.substr( 0, consumed ) };

        link = [ "link_ref", attrs ].concat( children );

        // We can't check if the reference is known here as it likely wont be
        // found till after. Check it in md tree->hmtl tree conversion.
        // Store the original so that conversion can revert if the ref isn't found.
        return [ consumed, link ];
      }

      // [id]
      // Only if id is plain (no formatting.)
      if ( children.length == 1 && typeof children[0] == "string" ) {

        attrs = { ref: children[0].toLowerCase(),  original: orig.substr( 0, consumed ) };
        link = [ "link_ref", attrs, children[0] ];
        return [ consumed, link ];
      }

      // Just consume the "["
      return [ 1, "[" ];
    },


    "<": function autoLink( text ) {
      var m;

      if ( ( m = text.match( /^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/ ) ) != null ) {
        if ( m[3] ) {
          return [ m[0].length, [ "link", { href: "mailto:" + m[3] }, m[3] ] ];

        }
        else if ( m[2] == "mailto" ) {
          return [ m[0].length, [ "link", { href: m[1] }, m[1].substr("mailto:".length ) ] ];
        }
        else
          return [ m[0].length, [ "link", { href: m[1] }, m[1] ] ];
      }

      return [ 1, "<" ];
    },

    "`": function inlineCode( text ) {
      // Inline code block. as many backticks as you like to start it
      // Always skip over the opening ticks.
      var m = text.match( /(`+)(([\s\S]*?)\1)/ );

      if ( m && m[2] )
        return [ m[1].length + m[2].length, [ "inlinecode", m[3] ] ];
      else {
        // TODO: No matching end code found - warn!
        return [ 1, "`" ];
      }
    },

    "  \n": function lineBreak( text ) {
      return [ 3, [ "linebreak" ] ];
    }

};

// Meta Helper/generator method for em and strong handling
function strong_em( tag, md ) {

  var state_slot = tag + "_state",
      other_slot = tag == "strong" ? "em_state" : "strong_state";

  function CloseTag(len) {
    this.len_after = len;
    this.name = "close_" + md;
  }

  return function ( text, orig_match ) {

    if ( this[state_slot][0] == md ) {
      // Most recent em is of this type
      //D:this.debug("closing", md);
      this[state_slot].shift();

      // "Consume" everything to go back to the recrusion in the else-block below
      return[ text.length, new CloseTag(text.length-md.length) ];
    }
    else {
      // Store a clone of the em/strong states
      var other = this[other_slot].slice(),
          state = this[state_slot].slice();

      this[state_slot].unshift(md);

      //D:this.debug_indent += "  ";

      // Recurse
      var res = this.processInline( text.substr( md.length ) );
      //D:this.debug_indent = this.debug_indent.substr(2);

      var last = res[res.length - 1];

      //D:this.debug("processInline from", tag + ": ", uneval( res ) );

      var check = this[state_slot].shift();
      if ( last instanceof CloseTag ) {
        res.pop();
        // We matched! Huzzah.
        var consumed = text.length - last.len_after;
        return [ consumed, [ tag ].concat(res) ];
      }
      else {
        // Restore the state of the other kind. We might have mistakenly closed it.
        this[other_slot] = other;
        this[state_slot] = state;

        // We can't reuse the processed result as it could have wrong parsing contexts in it.
        return [ md.length, md ];
      }
    }
  }; // End returned function
}

Markdown.dialects.Gruber.inline["**"] = strong_em("strong", "**");
Markdown.dialects.Gruber.inline["__"] = strong_em("strong", "__");
Markdown.dialects.Gruber.inline["*"]  = strong_em("em", "*");
Markdown.dialects.Gruber.inline["_"]  = strong_em("em", "_");


// Build default order from insertion order.
Markdown.buildBlockOrder = function(d) {
  var ord = [];
  for ( var i in d ) {
    if ( i == "__order__" || i == "__call__" ) continue;
    ord.push( i );
  }
  d.__order__ = ord;
};

// Build patterns for inline matcher
Markdown.buildInlinePatterns = function(d) {
  var patterns = [];

  for ( var i in d ) {
    // __foo__ is reserved and not a pattern
    if ( i.match( /^__.*__$/) ) continue;
    var l = i.replace( /([\\.*+?|()\[\]{}])/g, "\\$1" )
             .replace( /\n/, "\\n" );
    patterns.push( i.length == 1 ? l : "(?:" + l + ")" );
  }

  patterns = patterns.join("|");
  d.__patterns__ = patterns;
  //print("patterns:", uneval( patterns ) );

  var fn = d.__call__;
  d.__call__ = function(text, pattern) {
    if ( pattern != undefined ) {
      return fn.call(this, text, pattern);
    }
    else
    {
      return fn.call(this, text, patterns);
    }
  };
};

Markdown.DialectHelpers = {};
Markdown.DialectHelpers.inline_until_char = function( text, want ) {
  var consumed = 0,
      nodes = [];

  while ( true ) {
    if ( text.charAt( consumed ) == want ) {
      // Found the character we were looking for
      consumed++;
      return [ consumed, nodes ];
    }

    if ( consumed >= text.length ) {
      // No closing char found. Abort.
      return null;
    }

    var res = this.dialect.inline.__oneElement__.call(this, text.substr( consumed ) );
    consumed += res[ 0 ];
    // Add any returned nodes.
    nodes.push.apply( nodes, res.slice( 1 ) );
  }
}

// Helper function to make sub-classing a dialect easier
Markdown.subclassDialect = function( d ) {
  function Block() {}
  Block.prototype = d.block;
  function Inline() {}
  Inline.prototype = d.inline;

  return { block: new Block(), inline: new Inline() };
};

Markdown.buildBlockOrder ( Markdown.dialects.Gruber.block );
Markdown.buildInlinePatterns( Markdown.dialects.Gruber.inline );

Markdown.dialects.Maruku = Markdown.subclassDialect( Markdown.dialects.Gruber );

Markdown.dialects.Maruku.processMetaHash = function processMetaHash( meta_string ) {
  var meta = split_meta_hash( meta_string ),
      attr = {};

  for ( var i = 0; i < meta.length; ++i ) {
    // id: #foo
    if ( /^#/.test( meta[ i ] ) ) {
      attr.id = meta[ i ].substring( 1 );
    }
    // class: .foo
    else if ( /^\./.test( meta[ i ] ) ) {
      // if class already exists, append the new one
      if ( attr["class"] ) {
        attr["class"] = attr["class"] + meta[ i ].replace( /./, " " );
      }
      else {
        attr["class"] = meta[ i ].substring( 1 );
      }
    }
    // attribute: foo=bar
    else if ( /\=/.test( meta[ i ] ) ) {
      var s = meta[ i ].split( /\=/ );
      attr[ s[ 0 ] ] = s[ 1 ];
    }
  }

  return attr;
}

function split_meta_hash( meta_string ) {
  var meta = meta_string.split( "" ),
      parts = [ "" ],
      in_quotes = false;

  while ( meta.length ) {
    var letter = meta.shift();
    switch ( letter ) {
      case " " :
        // if we're in a quoted section, keep it
        if ( in_quotes ) {
          parts[ parts.length - 1 ] += letter;
        }
        // otherwise make a new part
        else {
          parts.push( "" );
        }
        break;
      case "'" :
      case '"' :
        // reverse the quotes and move straight on
        in_quotes = !in_quotes;
        break;
      case "\\" :
        // shift off the next letter to be used straight away.
        // it was escaped so we'll keep it whatever it is
        letter = meta.shift();
      default :
        parts[ parts.length - 1 ] += letter;
        break;
    }
  }

  return parts;
}

Markdown.dialects.Maruku.block.document_meta = function document_meta( block, next ) {
  // we're only interested in the first block
  if ( block.lineNumber > 1 ) return undefined;

  // document_meta blocks consist of one or more lines of `Key: Value\n`
  if ( ! block.match( /^(?:\w+:.*\n)*\w+:.*$/ ) ) return undefined;

  // make an attribute node if it doesn't exist
  if ( !extract_attr( this.tree ) ) {
    this.tree.splice( 1, 0, {} );
  }

  var pairs = block.split( /\n/ );
  for ( p in pairs ) {
    var m = pairs[ p ].match( /(\w+):\s*(.*)$/ ),
        key = m[ 1 ].toLowerCase(),
        value = m[ 2 ];

    this.tree[ 1 ][ key ] = value;
  }

  // document_meta produces no content!
  return [];
};

Markdown.dialects.Maruku.block.block_meta = function block_meta( block, next ) {
  // check if the last line of the block is an meta hash
  var m = block.match( /(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/ );
  if ( !m ) return undefined;

  // process the meta hash
  var attr = this.dialect.processMetaHash( m[ 2 ] );

  var hash;

  // if we matched ^ then we need to apply meta to the previous block
  if ( m[ 1 ] === "" ) {
    var node = this.tree[ this.tree.length - 1 ];
    hash = extract_attr( node );

    // if the node is a string (rather than JsonML), bail
    if ( typeof node === "string" ) return undefined;

    // create the attribute hash if it doesn't exist
    if ( !hash ) {
      hash = {};
      node.splice( 1, 0, hash );
    }

    // add the attributes in
    for ( a in attr ) {
      hash[ a ] = attr[ a ];
    }

    // return nothing so the meta hash is removed
    return [];
  }

  // pull the meta hash off the block and process what's left
  var b = block.replace( /\n.*$/, "" ),
      result = this.processBlock( b, [] );

  // get or make the attributes hash
  hash = extract_attr( result[ 0 ] );
  if ( !hash ) {
    hash = {};
    result[ 0 ].splice( 1, 0, hash );
  }

  // attach the attributes to the block
  for ( a in attr ) {
    hash[ a ] = attr[ a ];
  }

  return result;
};

Markdown.dialects.Maruku.block.definition_list = function definition_list( block, next ) {
  // one or more terms followed by one or more definitions, in a single block
  var tight = /^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,
      list = [ "dl" ],
      i, m;

  // see if we're dealing with a tight or loose block
  if ( ( m = block.match( tight ) ) ) {
    // pull subsequent tight DL blocks out of `next`
    var blocks = [ block ];
    while ( next.length && tight.exec( next[ 0 ] ) ) {
      blocks.push( next.shift() );
    }

    for ( var b = 0; b < blocks.length; ++b ) {
      var m = blocks[ b ].match( tight ),
          terms = m[ 1 ].replace( /\n$/, "" ).split( /\n/ ),
          defns = m[ 2 ].split( /\n:\s+/ );

      // print( uneval( m ) );

      for ( i = 0; i < terms.length; ++i ) {
        list.push( [ "dt", terms[ i ] ] );
      }

      for ( i = 0; i < defns.length; ++i ) {
        // run inline processing over the definition
        list.push( [ "dd" ].concat( this.processInline( defns[ i ].replace( /(\n)\s+/, "$1" ) ) ) );
      }
    }
  }
  else {
    return undefined;
  }

  return [ list ];
};

// splits on unescaped instances of @ch. If @ch is not a character the result
// can be unpredictable

Markdown.dialects.Maruku.block.table = function table (block, next) {

    var _split_on_unescaped = function(s, ch) {
        ch = ch || '\\s';
        if (ch.match(/^[\\|\[\]{}?*.+^$]$/)) { ch = '\\' + ch; }
        var res = [ ],
            r = new RegExp('^((?:\\\\.|[^\\\\' + ch + '])*)' + ch + '(.*)'),
            m;
        while(m = s.match(r)) {
            res.push(m[1]);
            s = m[2];
        }
        res.push(s);
        return res;
    }

    var leading_pipe = /^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/,
        // find at least an unescaped pipe in each line
        no_leading_pipe = /^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/,
        i, m;
    if (m = block.match(leading_pipe)) {
        // remove leading pipes in contents
        // (header and horizontal rule already have the leading pipe left out)
        m[3] = m[3].replace(/^\s*\|/gm, '');
    } else if (! ( m = block.match(no_leading_pipe))) {
        return undefined;
    }

    var table = [ "table", [ "thead", [ "tr" ] ], [ "tbody" ] ];

    // remove trailing pipes, then split on pipes
    // (no escaped pipes are allowed in horizontal rule)
    m[2] = m[2].replace(/\|\s*$/, '').split('|');

    // process alignment
    var html_attrs = [ ];
    forEach (m[2], function (s) {
        if (s.match(/^\s*-+:\s*$/))       html_attrs.push({align: "right"});
        else if (s.match(/^\s*:-+\s*$/))  html_attrs.push({align: "left"});
        else if (s.match(/^\s*:-+:\s*$/)) html_attrs.push({align: "center"});
        else                              html_attrs.push({});
    });

    // now for the header, avoid escaped pipes
    m[1] = _split_on_unescaped(m[1].replace(/\|\s*$/, ''), '|');
    for (i = 0; i < m[1].length; i++) {
        table[1][1].push(['th', html_attrs[i] || {}].concat(
            this.processInline(m[1][i].trim())));
    }

    // now for body contents
    forEach (m[3].replace(/\|\s*$/mg, '').split('\n'), function (row) {
        var html_row = ['tr'];
        row = _split_on_unescaped(row, '|');
        for (i = 0; i < row.length; i++) {
            html_row.push(['td', html_attrs[i] || {}].concat(this.processInline(row[i].trim())));
        }
        table[2].push(html_row);
    }, this);

    return [table];
}

Markdown.dialects.Maruku.inline[ "{:" ] = function inline_meta( text, matches, out ) {
  if ( !out.length ) {
    return [ 2, "{:" ];
  }

  // get the preceeding element
  var before = out[ out.length - 1 ];

  if ( typeof before === "string" ) {
    return [ 2, "{:" ];
  }

  // match a meta hash
  var m = text.match( /^\{:\s*((?:\\\}|[^\}])*)\s*\}/ );

  // no match, false alarm
  if ( !m ) {
    return [ 2, "{:" ];
  }

  // attach the attributes to the preceeding element
  var meta = this.dialect.processMetaHash( m[ 1 ] ),
      attr = extract_attr( before );

  if ( !attr ) {
    attr = {};
    before.splice( 1, 0, attr );
  }

  for ( var k in meta ) {
    attr[ k ] = meta[ k ];
  }

  // cut out the string and replace it with nothing
  return [ m[ 0 ].length, "" ];
};

Markdown.dialects.Maruku.inline.__escape__ = /^\\[\\`\*_{}\[\]()#\+.!\-|:]/;

Markdown.buildBlockOrder ( Markdown.dialects.Maruku.block );
Markdown.buildInlinePatterns( Markdown.dialects.Maruku.inline );

var isArray = Array.isArray || function(obj) {
  return Object.prototype.toString.call(obj) == "[object Array]";
};

var forEach;
// Don't mess with Array.prototype. Its not friendly
if ( Array.prototype.forEach ) {
  forEach = function( arr, cb, thisp ) {
    return arr.forEach( cb, thisp );
  };
}
else {
  forEach = function(arr, cb, thisp) {
    for (var i = 0; i < arr.length; i++) {
      cb.call(thisp || arr, arr[i], i, arr);
    }
  }
}

var isEmpty = function( obj ) {
  for ( var key in obj ) {
    if ( hasOwnProperty.call( obj, key ) ) {
      return false;
    }
  }

  return true;
}

function extract_attr( jsonml ) {
  return isArray(jsonml)
      && jsonml.length > 1
      && typeof jsonml[ 1 ] === "object"
      && !( isArray(jsonml[ 1 ]) )
      ? jsonml[ 1 ]
      : undefined;
}



/**
 *  renderJsonML( jsonml[, options] ) -> String
 *  - jsonml (Array): JsonML array to render to XML
 *  - options (Object): options
 *
 *  Converts the given JsonML into well-formed XML.
 *
 *  The options currently understood are:
 *
 *  - root (Boolean): wether or not the root node should be included in the
 *    output, or just its children. The default `false` is to not include the
 *    root itself.
 */
expose.renderJsonML = function( jsonml, options ) {
  options = options || {};
  // include the root element in the rendered output?
  options.root = options.root || false;

  var content = [];

  if ( options.root ) {
    content.push( render_tree( jsonml ) );
  }
  else {
    jsonml.shift(); // get rid of the tag
    if ( jsonml.length && typeof jsonml[ 0 ] === "object" && !( jsonml[ 0 ] instanceof Array ) ) {
      jsonml.shift(); // get rid of the attributes
    }

    while ( jsonml.length ) {
      content.push( render_tree( jsonml.shift() ) );
    }
  }

  return content.join( "\n\n" );
};

function escapeHTML( text ) {
  return text.replace( /&/g, "&amp;" )
             .replace( /</g, "&lt;" )
             .replace( />/g, "&gt;" )
             .replace( /"/g, "&quot;" )
             .replace( /'/g, "&#39;" );
}

function render_tree( jsonml ) {
  // basic case
  if ( typeof jsonml === "string" ) {
    return escapeHTML( jsonml );
  }

  var tag = jsonml.shift(),
      attributes = {},
      content = [];

  if ( jsonml.length && typeof jsonml[ 0 ] === "object" && !( jsonml[ 0 ] instanceof Array ) ) {
    attributes = jsonml.shift();
  }

  while ( jsonml.length ) {
    content.push( render_tree( jsonml.shift() ) );
  }

  var tag_attrs = "";
  for ( var a in attributes ) {
    tag_attrs += " " + a + '="' + escapeHTML( attributes[ a ] ) + '"';
  }

  // be careful about adding whitespace here for inline elements
  if ( tag == "img" || tag == "br" || tag == "hr" ) {
    return "<"+ tag + tag_attrs + "/>";
  }
  else {
    return "<"+ tag + tag_attrs + ">" + content.join( "" ) + "</" + tag + ">";
  }
}

function convert_tree_to_html( tree, references, options ) {
  var i;
  options = options || {};

  // shallow clone
  var jsonml = tree.slice( 0 );

  if ( typeof options.preprocessTreeNode === "function" ) {
      jsonml = options.preprocessTreeNode(jsonml, references);
  }

  // Clone attributes if they exist
  var attrs = extract_attr( jsonml );
  if ( attrs ) {
    jsonml[ 1 ] = {};
    for ( i in attrs ) {
      jsonml[ 1 ][ i ] = attrs[ i ];
    }
    attrs = jsonml[ 1 ];
  }

  // basic case
  if ( typeof jsonml === "string" ) {
    return jsonml;
  }

  // convert this node
  switch ( jsonml[ 0 ] ) {
    case "header":
      jsonml[ 0 ] = "h" + jsonml[ 1 ].level;
      delete jsonml[ 1 ].level;
      break;
    case "bulletlist":
      jsonml[ 0 ] = "ul";
      break;
    case "numberlist":
      jsonml[ 0 ] = "ol";
      break;
    case "listitem":
      jsonml[ 0 ] = "li";
      break;
    case "para":
      jsonml[ 0 ] = "p";
      break;
    case "markdown":
      jsonml[ 0 ] = "html";
      if ( attrs ) delete attrs.references;
      break;
    case "code_block":
      jsonml[ 0 ] = "pre";
      i = attrs ? 2 : 1;
      var code = [ "code" ];
      code.push.apply( code, jsonml.splice( i, jsonml.length - i ) );
      jsonml[ i ] = code;
      break;
    case "inlinecode":
      jsonml[ 0 ] = "code";
      break;
    case "img":
      jsonml[ 1 ].src = jsonml[ 1 ].href;
      delete jsonml[ 1 ].href;
      break;
    case "linebreak":
      jsonml[ 0 ] = "br";
    break;
    case "link":
      jsonml[ 0 ] = "a";
      break;
    case "link_ref":
      jsonml[ 0 ] = "a";

      // grab this ref and clean up the attribute node
      var ref = references[ attrs.ref ];

      // if the reference exists, make the link
      if ( ref ) {
        delete attrs.ref;

        // add in the href and title, if present
        attrs.href = ref.href;
        if ( ref.title ) {
          attrs.title = ref.title;
        }

        // get rid of the unneeded original text
        delete attrs.original;
      }
      // the reference doesn't exist, so revert to plain text
      else {
        return attrs.original;
      }
      break;
    case "img_ref":
      jsonml[ 0 ] = "img";

      // grab this ref and clean up the attribute node
      var ref = references[ attrs.ref ];

      // if the reference exists, make the link
      if ( ref ) {
        delete attrs.ref;

        // add in the href and title, if present
        attrs.src = ref.href;
        if ( ref.title ) {
          attrs.title = ref.title;
        }

        // get rid of the unneeded original text
        delete attrs.original;
      }
      // the reference doesn't exist, so revert to plain text
      else {
        return attrs.original;
      }
      break;
  }

  // convert all the children
  i = 1;

  // deal with the attribute node, if it exists
  if ( attrs ) {
    // if there are keys, skip over it
    for ( var key in jsonml[ 1 ] ) {
        i = 2;
        break;
    }
    // if there aren't, remove it
    if ( i === 1 ) {
      jsonml.splice( i, 1 );
    }
  }

  for ( ; i < jsonml.length; ++i ) {
    jsonml[ i ] = convert_tree_to_html( jsonml[ i ], references, options );
  }

  return jsonml;
}


// merges adjacent text nodes into a single node
function merge_text_nodes( jsonml ) {
  // skip the tag name and attribute hash
  var i = extract_attr( jsonml ) ? 2 : 1;

  while ( i < jsonml.length ) {
    // if it's a string check the next item too
    if ( typeof jsonml[ i ] === "string" ) {
      if ( i + 1 < jsonml.length && typeof jsonml[ i + 1 ] === "string" ) {
        // merge the second string into the first and remove it
        jsonml[ i ] += jsonml.splice( i + 1, 1 )[ 0 ];
      }
      else {
        ++i;
      }
    }
    // if it's not a string recurse
    else {
      merge_text_nodes( jsonml[ i ] );
      ++i;
    }
  }
}

} )( (function() {
  if ( typeof exports === "undefined" ) {
    window.markdown = {};
    return window.markdown;
  }
  else {
    return exports;
  }
} )() );
</script>
    <script>/* mousetrap v1.6.5 craig.is/killing/mice */
(function(q,u,c){function v(a,b,g){a.addEventListener?a.addEventListener(b,g,!1):a.attachEvent("on"+b,g)}function z(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);a.shiftKey||(b=b.toLowerCase());return b}return n[a.which]?n[a.which]:r[a.which]?r[a.which]:String.fromCharCode(a.which).toLowerCase()}function F(a){var b=[];a.shiftKey&&b.push("shift");a.altKey&&b.push("alt");a.ctrlKey&&b.push("ctrl");a.metaKey&&b.push("meta");return b}function w(a){return"shift"==a||"ctrl"==a||"alt"==a||
"meta"==a}function A(a,b){var g,d=[];var e=a;"+"===e?e=["+"]:(e=e.replace(/\+{2}/g,"+plus"),e=e.split("+"));for(g=0;g<e.length;++g){var m=e[g];B[m]&&(m=B[m]);b&&"keypress"!=b&&C[m]&&(m=C[m],d.push("shift"));w(m)&&d.push(m)}e=m;g=b;if(!g){if(!p){p={};for(var c in n)95<c&&112>c||n.hasOwnProperty(c)&&(p[n[c]]=c)}g=p[e]?"keydown":"keypress"}"keypress"==g&&d.length&&(g="keydown");return{key:m,modifiers:d,action:g}}function D(a,b){return null===a||a===u?!1:a===b?!0:D(a.parentNode,b)}function d(a){function b(a){a=
a||{};var b=!1,l;for(l in p)a[l]?b=!0:p[l]=0;b||(x=!1)}function g(a,b,t,f,g,d){var l,E=[],h=t.type;if(!k._callbacks[a])return[];"keyup"==h&&w(a)&&(b=[a]);for(l=0;l<k._callbacks[a].length;++l){var c=k._callbacks[a][l];if((f||!c.seq||p[c.seq]==c.level)&&h==c.action){var e;(e="keypress"==h&&!t.metaKey&&!t.ctrlKey)||(e=c.modifiers,e=b.sort().join(",")===e.sort().join(","));e&&(e=f&&c.seq==f&&c.level==d,(!f&&c.combo==g||e)&&k._callbacks[a].splice(l,1),E.push(c))}}return E}function c(a,b,c,f){k.stopCallback(b,
b.target||b.srcElement,c,f)||!1!==a(b,c)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function e(a){"number"!==typeof a.which&&(a.which=a.keyCode);var b=z(a);b&&("keyup"==a.type&&y===b?y=!1:k.handleKey(b,F(a),a))}function m(a,g,t,f){function h(c){return function(){x=c;++p[a];clearTimeout(q);q=setTimeout(b,1E3)}}function l(g){c(t,g,a);"keyup"!==f&&(y=z(g));setTimeout(b,10)}for(var d=p[a]=0;d<g.length;++d){var e=d+1===g.length?l:h(f||
A(g[d+1]).action);n(g[d],e,f,a,d)}}function n(a,b,c,f,d){k._directMap[a+":"+c]=b;a=a.replace(/\s+/g," ");var e=a.split(" ");1<e.length?m(a,e,b,c):(c=A(a,c),k._callbacks[c.key]=k._callbacks[c.key]||[],g(c.key,c.modifiers,{type:c.action},f,a,d),k._callbacks[c.key][f?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:f,level:d,combo:a}))}var k=this;a=a||u;if(!(k instanceof d))return new d(a);k.target=a;k._callbacks={};k._directMap={};var p={},q,y=!1,r=!1,x=!1;k._handleKey=function(a,
d,e){var f=g(a,d,e),h;d={};var k=0,l=!1;for(h=0;h<f.length;++h)f[h].seq&&(k=Math.max(k,f[h].level));for(h=0;h<f.length;++h)f[h].seq?f[h].level==k&&(l=!0,d[f[h].seq]=1,c(f[h].callback,e,f[h].combo,f[h].seq)):l||c(f[h].callback,e,f[h].combo);f="keypress"==e.type&&r;e.type!=x||w(a)||f||b(d);r=l&&"keydown"==e.type};k._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)n(a[d],b,c)};v(a,"keypress",e);v(a,"keydown",e);v(a,"keyup",e)}if(q){var n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",
18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},C={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},B={option:"alt",command:"meta","return":"enter",
escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},p;for(c=1;20>c;++c)n[111+c]="f"+c;for(c=0;9>=c;++c)n[c+96]=c.toString();d.prototype.bind=function(a,b,c){a=a instanceof Array?a:[a];this._bindMultiple.call(this,a,b,c);return this};d.prototype.unbind=function(a,b){return this.bind.call(this,a,function(){},b)};d.prototype.trigger=function(a,b){if(this._directMap[a+":"+b])this._directMap[a+":"+b]({},a);return this};d.prototype.reset=function(){this._callbacks={};
this._directMap={};return this};d.prototype.stopCallback=function(a,b){if(-1<(" "+b.className+" ").indexOf(" mousetrap ")||D(b,this.target))return!1;if("composedPath"in a&&"function"===typeof a.composedPath){var c=a.composedPath()[0];c!==a.target&&(b=c)}return"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable};d.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)};d.addKeycodes=function(a){for(var b in a)a.hasOwnProperty(b)&&(n[b]=a[b]);p=null};
d.init=function(){var a=d(u),b;for(b in a)"_"!==b.charAt(0)&&(d[b]=function(b){return function(){return a[b].apply(a,arguments)}}(b))};d.init();q.Mousetrap=d;"undefined"!==typeof module&&module.exports&&(module.exports=d);"function"===typeof define&&define.amd&&define(function(){return d})}})("undefined"!==typeof window?window:null,"undefined"!==typeof window?document:null);
</script>
    <script>/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.localforage=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||void 0===a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(b){return p.reject(a,b)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a(1),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype.catch=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){g(c,this.state===r?a:b,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{1:1}],3:[function(a,b,c){(function(b){"use strict";"function"!=typeof b.Promise&&(b.Promise=a(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(a){return}}function f(){try{if(!ua||!ua.open)return!1;var a="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),b="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!a||b)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(a){return!1}}function g(a,b){a=a||[],b=b||{};try{return new Blob(a,b)}catch(f){if("TypeError"!==f.name)throw f;for(var c="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,d=new c,e=0;e<a.length;e+=1)d.append(a[e]);return d.getBlob(b.type)}}function h(a,b){b&&a.then(function(a){b(null,a)},function(a){b(a)})}function i(a,b,c){"function"==typeof b&&a.then(b),"function"==typeof c&&a.catch(c)}function j(a){return"string"!=typeof a&&(console.warn(a+" used as a key, but it is not a string."),a=String(a)),a}function k(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function l(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c}function m(a){return new va(function(b){var c=a.transaction(wa,Ba),d=g([""]);c.objectStore(wa).put(d,"key"),c.onabort=function(a){a.preventDefault(),a.stopPropagation(),b(!1)},c.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),c=navigator.userAgent.match(/Edge\//);b(c||!a||parseInt(a[1],10)>=43)}}).catch(function(){return!1})}function n(a){return"boolean"==typeof xa?va.resolve(xa):m(a).then(function(a){return xa=a})}function o(a){var b=ya[a.name],c={};c.promise=new va(function(a,b){c.resolve=a,c.reject=b}),b.deferredOperations.push(c),b.dbReady?b.dbReady=b.dbReady.then(function(){return c.promise}):b.dbReady=c.promise}function p(a){var b=ya[a.name],c=b.deferredOperations.pop();if(c)return c.resolve(),c.promise}function q(a,b){var c=ya[a.name],d=c.deferredOperations.pop();if(d)return d.reject(b),d.promise}function r(a,b){return new va(function(c,d){if(ya[a.name]=ya[a.name]||B(),a.db){if(!b)return c(a.db);o(a),a.db.close()}var e=[a.name];b&&e.push(a.version);var f=ua.open.apply(ua,e);b&&(f.onupgradeneeded=function(b){var c=f.result;try{c.createObjectStore(a.storeName),b.oldVersion<=1&&c.createObjectStore(wa)}catch(c){if("ConstraintError"!==c.name)throw c;console.warn('The database "'+a.name+'" has been upgraded from version '+b.oldVersion+" to version "+b.newVersion+', but the storage "'+a.storeName+'" already exists.')}}),f.onerror=function(a){a.preventDefault(),d(f.error)},f.onsuccess=function(){var b=f.result;b.onversionchange=function(a){a.target.close()},c(b),p(a)}})}function s(a){return r(a,!1)}function t(a){return r(a,!0)}function u(a,b){if(!a.db)return!0;var c=!a.db.objectStoreNames.contains(a.storeName),d=a.version<a.db.version,e=a.version>a.db.version;if(d&&(a.version!==b&&console.warn('The database "'+a.name+"\" can't be downgraded from version "+a.db.version+" to version "+a.version+"."),a.version=a.db.version),e||c){if(c){var f=a.db.version+1;f>a.version&&(a.version=f)}return!0}return!1}function v(a){return new va(function(b,c){var d=new FileReader;d.onerror=c,d.onloadend=function(c){var d=btoa(c.target.result||"");b({__local_forage_encoded_blob:!0,data:d,type:a.type})},d.readAsBinaryString(a)})}function w(a){return g([l(atob(a.data))],{type:a.type})}function x(a){return a&&a.__local_forage_encoded_blob}function y(a){var b=this,c=b._initReady().then(function(){var a=ya[b._dbInfo.name];if(a&&a.dbReady)return a.dbReady});return i(c,a,a),c}function z(a){o(a);for(var b=ya[a.name],c=b.forages,d=0;d<c.length;d++){var e=c[d];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return a.db=null,s(a).then(function(b){return a.db=b,u(a)?t(a):b}).then(function(d){a.db=b.db=d;for(var e=0;e<c.length;e++)c[e]._dbInfo.db=d}).catch(function(b){throw q(a,b),b})}function A(a,b,c,d){void 0===d&&(d=1);try{var e=a.db.transaction(a.storeName,b);c(null,e)}catch(e){if(d>0&&(!a.db||"InvalidStateError"===e.name||"NotFoundError"===e.name))return va.resolve().then(function(){if(!a.db||"NotFoundError"===e.name&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),t(a)}).then(function(){return z(a).then(function(){A(a,b,c,d-1)})}).catch(c);c(e)}}function B(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function C(a){function b(){return va.resolve()}var c=this,d={db:null};if(a)for(var e in a)d[e]=a[e];var f=ya[d.name];f||(f=B(),ya[d.name]=f),f.forages.push(c),c._initReady||(c._initReady=c.ready,c.ready=y);for(var g=[],h=0;h<f.forages.length;h++){var i=f.forages[h];i!==c&&g.push(i._initReady().catch(b))}var j=f.forages.slice(0);return va.all(g).then(function(){return d.db=f.db,s(d)}).then(function(a){return d.db=a,u(d,c._defaultConfig.version)?t(d):a}).then(function(a){d.db=f.db=a,c._dbInfo=d;for(var b=0;b<j.length;b++){var e=j[b];e!==c&&(e._dbInfo.db=d.db,e._dbInfo.version=d.version)}})}function D(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.get(a);h.onsuccess=function(){var a=h.result;void 0===a&&(a=null),x(a)&&(a=w(a)),b(a)},h.onerror=function(){d(h.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function E(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.openCursor(),i=1;h.onsuccess=function(){var c=h.result;if(c){var d=c.value;x(d)&&(d=w(d));var e=a(d,c.key,i++);void 0!==e?b(e):c.continue()}else b()},h.onerror=function(){d(h.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function F(a,b,c){var d=this;a=j(a);var e=new va(function(c,e){var f;d.ready().then(function(){return f=d._dbInfo,"[object Blob]"===za.call(b)?n(f.db).then(function(a){return a?b:v(b)}):b}).then(function(b){A(d._dbInfo,Ba,function(f,g){if(f)return e(f);try{var h=g.objectStore(d._dbInfo.storeName);null===b&&(b=void 0);var i=h.put(b,a);g.oncomplete=function(){void 0===b&&(b=null),c(b)},g.onabort=g.onerror=function(){var a=i.error?i.error:i.transaction.error;e(a)}}catch(a){e(a)}})}).catch(e)});return h(e,c),e}function G(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Ba,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.delete(a);f.oncomplete=function(){b()},f.onerror=function(){d(h.error)},f.onabort=function(){var a=h.error?h.error:h.transaction.error;d(a)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function H(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Ba,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.clear();e.oncomplete=function(){a()},e.onabort=e.onerror=function(){var a=g.error?g.error:g.transaction.error;c(a)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function I(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Aa,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.count();g.onsuccess=function(){a(g.result)},g.onerror=function(){c(g.error)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function J(a,b){var c=this,d=new va(function(b,d){if(a<0)return void b(null);c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=!1,i=g.openKeyCursor();i.onsuccess=function(){var c=i.result;if(!c)return void b(null);0===a?b(c.key):h?b(c.key):(h=!0,c.advance(a))},i.onerror=function(){d(i.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function K(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Aa,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.openKeyCursor(),h=[];g.onsuccess=function(){var b=g.result;if(!b)return void a(h);h.push(b.key),b.continue()},g.onerror=function(){c(g.error)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function L(a,b){b=k.apply(this,arguments);var c=this.config();a="function"!=typeof a&&a||{},a.name||(a.name=a.name||c.name,a.storeName=a.storeName||c.storeName);var d,e=this;if(a.name){var f=a.name===c.name&&e._dbInfo.db,g=f?va.resolve(e._dbInfo.db):s(a).then(function(b){var c=ya[a.name],d=c.forages;c.db=b;for(var e=0;e<d.length;e++)d[e]._dbInfo.db=b;return b});d=a.storeName?g.then(function(b){if(b.objectStoreNames.contains(a.storeName)){var c=b.version+1;o(a);var d=ya[a.name],e=d.forages;b.close();for(var f=0;f<e.length;f++){var g=e[f];g._dbInfo.db=null,g._dbInfo.version=c}return new va(function(b,d){var e=ua.open(a.name,c);e.onerror=function(a){e.result.close(),d(a)},e.onupgradeneeded=function(){e.result.deleteObjectStore(a.storeName)},e.onsuccess=function(){var a=e.result;a.close(),b(a)}}).then(function(a){d.db=a;for(var b=0;b<e.length;b++){var c=e[b];c._dbInfo.db=a,p(c._dbInfo)}}).catch(function(b){throw(q(a,b)||va.resolve()).catch(function(){}),b})}}):g.then(function(b){o(a);var c=ya[a.name],d=c.forages;b.close();for(var e=0;e<d.length;e++){d[e]._dbInfo.db=null}return new va(function(b,c){var d=ua.deleteDatabase(a.name);d.onerror=function(){var a=d.result;a&&a.close(),c(d.error)},d.onblocked=function(){console.warn('dropInstance blocked for database "'+a.name+'" until all open connections are closed')},d.onsuccess=function(){var a=d.result;a&&a.close(),b(a)}}).then(function(a){c.db=a;for(var b=0;b<d.length;b++)p(d[b]._dbInfo)}).catch(function(b){throw(q(a,b)||va.resolve()).catch(function(){}),b})})}else d=va.reject("Invalid arguments");return h(d,b),d}function M(){return"function"==typeof openDatabase}function N(a){var b,c,d,e,f,g=.75*a.length,h=a.length,i=0;"="===a[a.length-1]&&(g--,"="===a[a.length-2]&&g--);var j=new ArrayBuffer(g),k=new Uint8Array(j);for(b=0;b<h;b+=4)c=Da.indexOf(a[b]),d=Da.indexOf(a[b+1]),e=Da.indexOf(a[b+2]),f=Da.indexOf(a[b+3]),k[i++]=c<<2|d>>4,k[i++]=(15&d)<<4|e>>2,k[i++]=(3&e)<<6|63&f;return j}function O(a){var b,c=new Uint8Array(a),d="";for(b=0;b<c.length;b+=3)d+=Da[c[b]>>2],d+=Da[(3&c[b])<<4|c[b+1]>>4],d+=Da[(15&c[b+1])<<2|c[b+2]>>6],d+=Da[63&c[b+2]];return c.length%3==2?d=d.substring(0,d.length-1)+"=":c.length%3==1&&(d=d.substring(0,d.length-2)+"=="),d}function P(a,b){var c="";if(a&&(c=Ua.call(a)),a&&("[object ArrayBuffer]"===c||a.buffer&&"[object ArrayBuffer]"===Ua.call(a.buffer))){var d,e=Ga;a instanceof ArrayBuffer?(d=a,e+=Ia):(d=a.buffer,"[object Int8Array]"===c?e+=Ka:"[object Uint8Array]"===c?e+=La:"[object Uint8ClampedArray]"===c?e+=Ma:"[object Int16Array]"===c?e+=Na:"[object Uint16Array]"===c?e+=Pa:"[object Int32Array]"===c?e+=Oa:"[object Uint32Array]"===c?e+=Qa:"[object Float32Array]"===c?e+=Ra:"[object Float64Array]"===c?e+=Sa:b(new Error("Failed to get type for BinaryArray"))),b(e+O(d))}else if("[object Blob]"===c){var f=new FileReader;f.onload=function(){var c=Ea+a.type+"~"+O(this.result);b(Ga+Ja+c)},f.readAsArrayBuffer(a)}else try{b(JSON.stringify(a))}catch(c){console.error("Couldn't convert value into a JSON string: ",a),b(null,c)}}function Q(a){if(a.substring(0,Ha)!==Ga)return JSON.parse(a);var b,c=a.substring(Ta),d=a.substring(Ha,Ta);if(d===Ja&&Fa.test(c)){var e=c.match(Fa);b=e[1],c=c.substring(e[0].length)}var f=N(c);switch(d){case Ia:return f;case Ja:return g([f],{type:b});case Ka:return new Int8Array(f);case La:return new Uint8Array(f);case Ma:return new Uint8ClampedArray(f);case Na:return new Int16Array(f);case Pa:return new Uint16Array(f);case Oa:return new Int32Array(f);case Qa:return new Uint32Array(f);case Ra:return new Float32Array(f);case Sa:return new Float64Array(f);default:throw new Error("Unkown type: "+d)}}function R(a,b,c,d){a.executeSql("CREATE TABLE IF NOT EXISTS "+b.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],c,d)}function S(a){var b=this,c={db:null};if(a)for(var d in a)c[d]="string"!=typeof a[d]?a[d].toString():a[d];var e=new va(function(a,d){try{c.db=openDatabase(c.name,String(c.version),c.description,c.size)}catch(a){return d(a)}c.db.transaction(function(e){R(e,c,function(){b._dbInfo=c,a()},function(a,b){d(b)})},d)});return c.serializer=Va,e}function T(a,b,c,d,e,f){a.executeSql(c,d,e,function(a,g){g.code===g.SYNTAX_ERR?a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[b.storeName],function(a,h){h.rows.length?f(a,g):R(a,b,function(){a.executeSql(c,d,e,f)},f)},f):f(a,g)},f)}function U(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT * FROM "+e.storeName+" WHERE key = ? LIMIT 1",[a],function(a,c){var d=c.rows.length?c.rows.item(0).value:null;d&&(d=e.serializer.deserialize(d)),b(d)},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function V(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT * FROM "+e.storeName,[],function(c,d){for(var f=d.rows,g=f.length,h=0;h<g;h++){var i=f.item(h),j=i.value;if(j&&(j=e.serializer.deserialize(j)),void 0!==(j=a(j,i.key,h+1)))return void b(j)}b()},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function W(a,b,c,d){var e=this;a=j(a);var f=new va(function(f,g){e.ready().then(function(){void 0===b&&(b=null);var h=b,i=e._dbInfo;i.serializer.serialize(b,function(b,j){j?g(j):i.db.transaction(function(c){T(c,i,"INSERT OR REPLACE INTO "+i.storeName+" (key, value) VALUES (?, ?)",[a,b],function(){f(h)},function(a,b){g(b)})},function(b){if(b.code===b.QUOTA_ERR){if(d>0)return void f(W.apply(e,[a,h,c,d-1]));g(b)}})})}).catch(g)});return h(f,c),f}function X(a,b,c){return W.apply(this,[a,b,c,1])}function Y(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"DELETE FROM "+e.storeName+" WHERE key = ?",[a],function(){b()},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function Z(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"DELETE FROM "+d.storeName,[],function(){a()},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function $(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"SELECT COUNT(key) as c FROM "+d.storeName,[],function(b,c){var d=c.rows.item(0).c;a(d)},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function _(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[a+1],function(a,c){var d=c.rows.length?c.rows.item(0).key:null;b(d)},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function aa(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"SELECT key FROM "+d.storeName,[],function(b,c){for(var d=[],e=0;e<c.rows.length;e++)d.push(c.rows.item(e).key);a(d)},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function ba(a){return new va(function(b,c){a.transaction(function(d){d.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(c,d){for(var e=[],f=0;f<d.rows.length;f++)e.push(d.rows.item(f).name);b({db:a,storeNames:e})},function(a,b){c(b)})},function(a){c(a)})})}function ca(a,b){b=k.apply(this,arguments);var c=this.config();a="function"!=typeof a&&a||{},a.name||(a.name=a.name||c.name,a.storeName=a.storeName||c.storeName);var d,e=this;return d=a.name?new va(function(b){var d;d=a.name===c.name?e._dbInfo.db:openDatabase(a.name,"","",0),b(a.storeName?{db:d,storeNames:[a.storeName]}:ba(d))}).then(function(a){return new va(function(b,c){a.db.transaction(function(d){function e(a){return new va(function(b,c){d.executeSql("DROP TABLE IF EXISTS "+a,[],function(){b()},function(a,b){c(b)})})}for(var f=[],g=0,h=a.storeNames.length;g<h;g++)f.push(e(a.storeNames[g]));va.all(f).then(function(){b()}).catch(function(a){c(a)})},function(a){c(a)})})}):va.reject("Invalid arguments"),h(d,b),d}function da(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(a){return!1}}function ea(a,b){var c=a.name+"/";return a.storeName!==b.storeName&&(c+=a.storeName+"/"),c}function fa(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch(a){return!0}}function ga(){return!fa()||localStorage.length>0}function ha(a){var b=this,c={};if(a)for(var d in a)c[d]=a[d];return c.keyPrefix=ea(a,b._defaultConfig),ga()?(b._dbInfo=c,c.serializer=Va,va.resolve()):va.reject()}function ia(a){var b=this,c=b.ready().then(function(){for(var a=b._dbInfo.keyPrefix,c=localStorage.length-1;c>=0;c--){var d=localStorage.key(c);0===d.indexOf(a)&&localStorage.removeItem(d)}});return h(c,a),c}function ja(a,b){var c=this;a=j(a);var d=c.ready().then(function(){var b=c._dbInfo,d=localStorage.getItem(b.keyPrefix+a);return d&&(d=b.serializer.deserialize(d)),d});return h(d,b),d}function ka(a,b){var c=this,d=c.ready().then(function(){for(var b=c._dbInfo,d=b.keyPrefix,e=d.length,f=localStorage.length,g=1,h=0;h<f;h++){var i=localStorage.key(h);if(0===i.indexOf(d)){var j=localStorage.getItem(i);if(j&&(j=b.serializer.deserialize(j)),void 0!==(j=a(j,i.substring(e),g++)))return j}}});return h(d,b),d}function la(a,b){var c=this,d=c.ready().then(function(){var b,d=c._dbInfo;try{b=localStorage.key(a)}catch(a){b=null}return b&&(b=b.substring(d.keyPrefix.length)),b});return h(d,b),d}function ma(a){var b=this,c=b.ready().then(function(){for(var a=b._dbInfo,c=localStorage.length,d=[],e=0;e<c;e++){var f=localStorage.key(e);0===f.indexOf(a.keyPrefix)&&d.push(f.substring(a.keyPrefix.length))}return d});return h(c,a),c}function na(a){var b=this,c=b.keys().then(function(a){return a.length});return h(c,a),c}function oa(a,b){var c=this;a=j(a);var d=c.ready().then(function(){var b=c._dbInfo;localStorage.removeItem(b.keyPrefix+a)});return h(d,b),d}function pa(a,b,c){var d=this;a=j(a);var e=d.ready().then(function(){void 0===b&&(b=null);var c=b;return new va(function(e,f){var g=d._dbInfo;g.serializer.serialize(b,function(b,d){if(d)f(d);else try{localStorage.setItem(g.keyPrefix+a,b),e(c)}catch(a){"QuotaExceededError"!==a.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==a.name||f(a),f(a)}})})});return h(e,c),e}function qa(a,b){if(b=k.apply(this,arguments),a="function"!=typeof a&&a||{},!a.name){var c=this.config();a.name=a.name||c.name,a.storeName=a.storeName||c.storeName}var d,e=this;return d=a.name?new va(function(b){b(a.storeName?ea(a,e._defaultConfig):a.name+"/")}).then(function(a){for(var b=localStorage.length-1;b>=0;b--){var c=localStorage.key(b);0===c.indexOf(a)&&localStorage.removeItem(c)}}):va.reject("Invalid arguments"),h(d,b),d}function ra(a,b){a[b]=function(){var c=arguments;return a.ready().then(function(){return a[b].apply(a,c)})}}function sa(){for(var a=1;a<arguments.length;a++){var b=arguments[a];if(b)for(var c in b)b.hasOwnProperty(c)&&($a(b[c])?arguments[0][c]=b[c].slice():arguments[0][c]=b[c])}return arguments[0]}var ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},ua=e();"undefined"==typeof Promise&&a(3);var va=Promise,wa="local-forage-detect-blob-support",xa=void 0,ya={},za=Object.prototype.toString,Aa="readonly",Ba="readwrite",Ca={_driver:"asyncStorage",_initStorage:C,_support:f(),iterate:E,getItem:D,setItem:F,removeItem:G,clear:H,length:I,key:J,keys:K,dropInstance:L},Da="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ea="~~local_forage_type~",Fa=/^~~local_forage_type~([^~]+)~/,Ga="__lfsc__:",Ha=Ga.length,Ia="arbf",Ja="blob",Ka="si08",La="ui08",Ma="uic8",Na="si16",Oa="si32",Pa="ur16",Qa="ui32",Ra="fl32",Sa="fl64",Ta=Ha+Ia.length,Ua=Object.prototype.toString,Va={serialize:P,deserialize:Q,stringToBuffer:N,bufferToString:O},Wa={_driver:"webSQLStorage",_initStorage:S,_support:M(),iterate:V,getItem:U,setItem:X,removeItem:Y,clear:Z,length:$,key:_,keys:aa,dropInstance:ca},Xa={_driver:"localStorageWrapper",_initStorage:ha,_support:da(),iterate:ka,getItem:ja,setItem:pa,removeItem:oa,clear:ia,length:na,key:la,keys:ma,dropInstance:qa},Ya=function(a,b){return a===b||"number"==typeof a&&"number"==typeof b&&isNaN(a)&&isNaN(b)},Za=function(a,b){for(var c=a.length,d=0;d<c;){if(Ya(a[d],b))return!0;d++}return!1},$a=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},_a={},ab={},bb={INDEXEDDB:Ca,WEBSQL:Wa,LOCALSTORAGE:Xa},cb=[bb.INDEXEDDB._driver,bb.WEBSQL._driver,bb.LOCALSTORAGE._driver],db=["dropInstance"],eb=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(db),fb={description:"",driver:cb.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},gb=function(){function a(b){d(this,a);for(var c in bb)if(bb.hasOwnProperty(c)){var e=bb[c],f=e._driver;this[c]=f,_a[f]||this.defineDriver(e)}this._defaultConfig=sa({},fb),this._config=sa({},this._defaultConfig,b),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(a){if("object"===(void 0===a?"undefined":ta(a))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var b in a){if("storeName"===b&&(a[b]=a[b].replace(/\W/g,"_")),"version"===b&&"number"!=typeof a[b])return new Error("Database version must be a number.");this._config[b]=a[b]}return!("driver"in a&&a.driver)||this.setDriver(this._config.driver)}return"string"==typeof a?this._config[a]:this._config},a.prototype.defineDriver=function(a,b,c){var d=new va(function(b,c){try{var d=a._driver,e=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!a._driver)return void c(e);for(var f=eb.concat("_initStorage"),g=0,i=f.length;g<i;g++){var j=f[g];if((!Za(db,j)||a[j])&&"function"!=typeof a[j])return void c(e)}(function(){for(var b=function(a){return function(){var b=new Error("Method "+a+" is not implemented by the current driver"),c=va.reject(b);return h(c,arguments[arguments.length-1]),c}},c=0,d=db.length;c<d;c++){var e=db[c];a[e]||(a[e]=b(e))}})();var k=function(c){_a[d]&&console.info("Redefining LocalForage driver: "+d),_a[d]=a,ab[d]=c,b()};"_support"in a?a._support&&"function"==typeof a._support?a._support().then(k,c):k(!!a._support):k(!0)}catch(a){c(a)}});return i(d,b,c),d},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(a,b,c){var d=_a[a]?va.resolve(_a[a]):va.reject(new Error("Driver not found."));return i(d,b,c),d},a.prototype.getSerializer=function(a){var b=va.resolve(Va);return i(b,a),b},a.prototype.ready=function(a){var b=this,c=b._driverSet.then(function(){return null===b._ready&&(b._ready=b._initDriver()),b._ready});return i(c,a,a),c},a.prototype.setDriver=function(a,b,c){function d(){g._config.driver=g.driver()}function e(a){return g._extend(a),d(),g._ready=g._initStorage(g._config),g._ready}function f(a){return function(){function b(){for(;c<a.length;){var f=a[c];return c++,g._dbInfo=null,g._ready=null,g.getDriver(f).then(e).catch(b)}d();var h=new Error("No available storage method found.");return g._driverSet=va.reject(h),g._driverSet}var c=0;return b()}}var g=this;$a(a)||(a=[a]);var h=this._getSupportedDrivers(a),j=null!==this._driverSet?this._driverSet.catch(function(){return va.resolve()}):va.resolve();return this._driverSet=j.then(function(){var a=h[0];return g._dbInfo=null,g._ready=null,g.getDriver(a).then(function(a){g._driver=a._driver,d(),g._wrapLibraryMethodsWithReady(),g._initDriver=f(h)})}).catch(function(){d();var a=new Error("No available storage method found.");return g._driverSet=va.reject(a),g._driverSet}),i(this._driverSet,b,c),this._driverSet},a.prototype.supports=function(a){return!!ab[a]},a.prototype._extend=function(a){sa(this,a)},a.prototype._getSupportedDrivers=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];this.supports(e)&&b.push(e)}return b},a.prototype._wrapLibraryMethodsWithReady=function(){for(var a=0,b=eb.length;a<b;a++)ra(this,eb[a])},a.prototype.createInstance=function(b){return new a(b)},a}(),hb=new gb;b.exports=hb},{3:3}]},{},[4])(4)});</script>
    <script>/*
 Highcharts JS v9.2.2 (2021-08-24)

 (c) 2009-2021 Torstein Honsi

 License: www.highcharts.com/license
*/
'use strict';(function(aa,M){"object"===typeof module&&module.exports?(M["default"]=M,module.exports=aa.document?M(aa):M):"function"===typeof define&&define.amd?define("highcharts/highcharts",function(){return M(aa)}):(aa.Highcharts&&aa.Highcharts.error(16,!0),aa.Highcharts=M(aa))})("undefined"!==typeof window?window:this,function(aa){function M(r,a,C,E){r.hasOwnProperty(a)||(r[a]=E.apply(null,C))}var a={};M(a,"Core/Globals.js",[],function(){var r="undefined"!==typeof aa?aa:"undefined"!==typeof window?
window:{},a;(function(a){a.SVG_NS="http://www.w3.org/2000/svg";a.product="Highcharts";a.version="9.2.2";a.win=r;a.doc=a.win.document;a.svg=a.doc&&a.doc.createElementNS&&!!a.doc.createElementNS(a.SVG_NS,"svg").createSVGRect;a.userAgent=a.win.navigator&&a.win.navigator.userAgent||"";a.isChrome=-1!==a.userAgent.indexOf("Chrome");a.isFirefox=-1!==a.userAgent.indexOf("Firefox");a.isMS=/(edge|msie|trident)/i.test(a.userAgent)&&!a.win.opera;a.isSafari=!a.isChrome&&-1!==a.userAgent.indexOf("Safari");a.isTouchDevice=
/(Mobile|Android|Windows Phone)/.test(a.userAgent);a.isWebKit=-1!==a.userAgent.indexOf("AppleWebKit");a.deg2rad=2*Math.PI/360;a.hasBidiBug=a.isFirefox&&4>parseInt(a.userAgent.split("Firefox/")[1],10);a.hasTouch=!!a.win.TouchEvent;a.marginNames=["plotTop","marginRight","marginBottom","plotLeft"];a.noop=function(){};a.supportsPassiveEvents=function(){var r=!1;if(!a.isMS){var w=Object.defineProperty({},"passive",{get:function(){r=!0}});a.win.addEventListener&&a.win.removeEventListener&&(a.win.addEventListener("testPassive",
a.noop,w),a.win.removeEventListener("testPassive",a.noop,w))}return r}();a.charts=[];a.dateFormats={};a.seriesTypes={};a.symbolSizes={};a.chartCount=0})(a||(a={}));"";return a});M(a,"Core/Utilities.js",[a["Core/Globals.js"]],function(a){function r(b,d,e,p){var y=d?"Highcharts error":"Highcharts warning";32===b&&(b=y+": Deprecated member");var F=m(b),c=F?y+" #"+b+": www.highcharts.com/errors/"+b+"/":b.toString();if("undefined"!==typeof p){var k="";F&&(c+="?");I(p,function(b,K){k+="\n - "+K+": "+b;
F&&(c+=encodeURI(K)+"="+encodeURI(b))});c+=k}B(a,"displayError",{chart:e,code:b,message:c,params:p},function(){if(d)throw Error(c);h.console&&-1===r.messages.indexOf(c)&&console.warn(c)});r.messages.push(c)}function C(b,d){var y={};I(b,function(h,c){if(J(b[c],!0)&&!b.nodeType&&d[c])h=C(b[c],d[c]),Object.keys(h).length&&(y[c]=h);else if(J(b[c])||b[c]!==d[c])y[c]=b[c]});return y}function E(b,d){return parseInt(b,d||10)}function z(b){return"string"===typeof b}function x(b){b=Object.prototype.toString.call(b);
return"[object Array]"===b||"[object Array Iterator]"===b}function J(b,d){return!!b&&"object"===typeof b&&(!d||!x(b))}function u(b){return J(b)&&"number"===typeof b.nodeType}function n(b){var d=b&&b.constructor;return!(!J(b,!0)||u(b)||!d||!d.name||"Object"===d.name)}function m(b){return"number"===typeof b&&!isNaN(b)&&Infinity>b&&-Infinity<b}function g(b){return"undefined"!==typeof b&&null!==b}function c(b,d,h){var y;z(d)?g(h)?b.setAttribute(d,h):b&&b.getAttribute&&((y=b.getAttribute(d))||"class"!==
d||(y=b.getAttribute(d+"Name"))):I(d,function(d,y){b.setAttribute(y,d)});return y}function e(b,d){var y;b||(b={});for(y in d)b[y]=d[y];return b}function l(){for(var b=arguments,d=b.length,h=0;h<d;h++){var c=b[h];if("undefined"!==typeof c&&null!==c)return c}}function f(b,d){a.isMS&&!a.svg&&d&&"undefined"!==typeof d.opacity&&(d.filter="alpha(opacity="+100*d.opacity+")");e(b.style,d)}function v(b,d,h,c,p){b=t.createElement(b);d&&e(b,d);p&&f(b,{padding:"0",border:"none",margin:"0"});h&&f(b,h);c&&c.appendChild(b);
return b}function q(b,d){return parseFloat(b.toPrecision(d||14))}function k(b,d,c){var y=a.getStyle||k;if("width"===d)return d=Math.min(b.offsetWidth,b.scrollWidth),c=b.getBoundingClientRect&&b.getBoundingClientRect().width,c<d&&c>=d-1&&(d=Math.floor(c)),Math.max(0,d-(y(b,"padding-left",!0)||0)-(y(b,"padding-right",!0)||0));if("height"===d)return Math.max(0,Math.min(b.offsetHeight,b.scrollHeight)-(y(b,"padding-top",!0)||0)-(y(b,"padding-bottom",!0)||0));h.getComputedStyle||r(27,!0);if(b=h.getComputedStyle(b,
void 0)){var e=b.getPropertyValue(d);l(c,"opacity"!==d)&&(e=E(e))}return e}function I(b,d,h){for(var y in b)Object.hasOwnProperty.call(b,y)&&d.call(h||b[y],b[y],y,b)}function D(b,d,h){function y(d,H){var K=b.removeEventListener||a.removeEventListenerPolyfill;K&&K.call(b,d,H,!1)}function c(h){var H;if(b.nodeName){if(d){var K={};K[d]=!0}else K=h;I(K,function(b,d){if(h[d])for(H=h[d].length;H--;)y(d,h[d][H].fn)})}}var e="function"===typeof b&&b.prototype||b;if(Object.hasOwnProperty.call(e,"hcEvents")){var p=
e.hcEvents;d?(e=p[d]||[],h?(p[d]=e.filter(function(b){return h!==b.fn}),y(d,h)):(c(p),p[d]=[])):(c(p),delete e.hcEvents)}}function B(b,d,h,c){h=h||{};if(t.createEvent&&(b.dispatchEvent||b.fireEvent&&b!==a)){var y=t.createEvent("Events");y.initEvent(d,!0,!0);h=e(y,h);b.dispatchEvent?b.dispatchEvent(h):b.fireEvent(d,h)}else if(b.hcEvents){h.target||e(h,{preventDefault:function(){h.defaultPrevented=!0},target:b,type:d});y=[];for(var p=b,k=!1;p.hcEvents;)Object.hasOwnProperty.call(p,"hcEvents")&&p.hcEvents[d]&&
(y.length&&(k=!0),y.unshift.apply(y,p.hcEvents[d])),p=Object.getPrototypeOf(p);k&&y.sort(function(b,d){return b.order-d.order});y.forEach(function(d){!1===d.fn.call(b,h)&&h.preventDefault()})}c&&!h.defaultPrevented&&c.call(b,h)}var O=a.charts,t=a.doc,h=a.win;(r||(r={})).messages=[];var d;Math.easeInOutSine=function(b){return-.5*(Math.cos(Math.PI*b)-1)};var b=Array.prototype.find?function(b,d){return b.find(d)}:function(b,d){var h,y=b.length;for(h=0;h<y;h++)if(d(b[h],h))return b[h]};I({map:"map",each:"forEach",
grep:"filter",reduce:"reduce",some:"some"},function(b,d){a[d]=function(h){var y;r(32,!1,void 0,(y={},y["Highcharts."+d]="use Array."+b,y));return Array.prototype[b].apply(h,[].slice.call(arguments,1))}});var p,G=function(){var b=Math.random().toString(36).substring(2,9)+"-",d=0;return function(){return"highcharts-"+(p?"":b)+d++}}();h.jQuery&&(h.jQuery.fn.highcharts=function(){var b=[].slice.call(arguments);if(this[0])return b[0]?(new (a[z(b[0])?b.shift():"Chart"])(this[0],b[0],b[1]),this):O[c(this[0],
"data-highcharts-chart")]});b={addEvent:function(b,d,h,c){void 0===c&&(c={});var y="function"===typeof b&&b.prototype||b;Object.hasOwnProperty.call(y,"hcEvents")||(y.hcEvents={});y=y.hcEvents;a.Point&&b instanceof a.Point&&b.series&&b.series.chart&&(b.series.chart.runTrackerClick=!0);var p=b.addEventListener||a.addEventListenerPolyfill;p&&p.call(b,d,h,a.supportsPassiveEvents?{passive:void 0===c.passive?-1!==d.indexOf("touch"):c.passive,capture:!1}:!1);y[d]||(y[d]=[]);y[d].push({fn:h,order:"number"===
typeof c.order?c.order:Infinity});y[d].sort(function(b,d){return b.order-d.order});return function(){D(b,d,h)}},arrayMax:function(b){for(var d=b.length,h=b[0];d--;)b[d]>h&&(h=b[d]);return h},arrayMin:function(b){for(var d=b.length,h=b[0];d--;)b[d]<h&&(h=b[d]);return h},attr:c,clamp:function(b,d,h){return b>d?b<h?b:h:d},cleanRecursively:C,clearTimeout:function(b){g(b)&&clearTimeout(b)},correctFloat:q,createElement:v,css:f,defined:g,destroyObjectProperties:function(b,d){I(b,function(h,c){h&&h!==d&&
h.destroy&&h.destroy();delete b[c]})},discardElement:function(b){d||(d=v("div"));b&&d.appendChild(b);d.innerHTML=""},erase:function(b,d){for(var h=b.length;h--;)if(b[h]===d){b.splice(h,1);break}},error:r,extend:e,extendClass:function(b,d){var h=function(){};h.prototype=new b;e(h.prototype,d);return h},find:b,fireEvent:B,getMagnitude:function(b){return Math.pow(10,Math.floor(Math.log(b)/Math.LN10))},getNestedProperty:function(b,d){for(b=b.split(".");b.length&&g(d);){var c=b.shift();if("undefined"===
typeof c||"__proto__"===c)return;d=d[c];if(!g(d)||"function"===typeof d||"number"===typeof d.nodeType||d===h)return}return d},getStyle:k,inArray:function(b,d,h){r(32,!1,void 0,{"Highcharts.inArray":"use Array.indexOf"});return d.indexOf(b,h)},isArray:x,isClass:n,isDOMElement:u,isFunction:function(b){return"function"===typeof b},isNumber:m,isObject:J,isString:z,keys:function(b){r(32,!1,void 0,{"Highcharts.keys":"use Object.keys"});return Object.keys(b)},merge:function(){var b,d=arguments,h={},c=function(b,
d){"object"!==typeof b&&(b={});I(d,function(h,H){"__proto__"!==H&&"constructor"!==H&&(!J(h,!0)||n(h)||u(h)?b[H]=d[H]:b[H]=c(b[H]||{},h))});return b};!0===d[0]&&(h=d[1],d=Array.prototype.slice.call(d,2));var p=d.length;for(b=0;b<p;b++)h=c(h,d[b]);return h},normalizeTickInterval:function(b,d,h,c,p){var e=b;h=l(h,1);var k=b/h;d||(d=p?[1,1.2,1.5,2,2.5,3,4,5,6,8,10]:[1,2,2.5,5,10],!1===c&&(1===h?d=d.filter(function(b){return 0===b%1}):.1>=h&&(d=[1/h])));for(c=0;c<d.length&&!(e=d[c],p&&e*h>=b||!p&&k<=(d[c]+
(d[c+1]||d[c]))/2);c++);return e=q(e*h,-Math.round(Math.log(.001)/Math.LN10))},objectEach:I,offset:function(b){var d=t.documentElement;b=b.parentElement||b.parentNode?b.getBoundingClientRect():{top:0,left:0,width:0,height:0};return{top:b.top+(h.pageYOffset||d.scrollTop)-(d.clientTop||0),left:b.left+(h.pageXOffset||d.scrollLeft)-(d.clientLeft||0),width:b.width,height:b.height}},pad:function(b,d,h){return Array((d||2)+1-String(b).replace("-","").length).join(h||"0")+b},pick:l,pInt:E,relativeLength:function(b,
d,h){return/%$/.test(b)?d*parseFloat(b)/100+(h||0):parseFloat(b)},removeEvent:D,splat:function(b){return x(b)?b:[b]},stableSort:function(b,d){var h=b.length,c,p;for(p=0;p<h;p++)b[p].safeI=p;b.sort(function(b,h){c=d(b,h);return 0===c?b.safeI-h.safeI:c});for(p=0;p<h;p++)delete b[p].safeI},syncTimeout:function(b,d,h){if(0<d)return setTimeout(b,d,h);b.call(0,h);return-1},timeUnits:{millisecond:1,second:1E3,minute:6E4,hour:36E5,day:864E5,week:6048E5,month:24192E5,year:314496E5},uniqueKey:G,useSerialIds:function(b){return p=
l(b,p)},wrap:function(b,d,h){var c=b[d];b[d]=function(){var b=Array.prototype.slice.call(arguments),d=arguments,p=this;p.proceed=function(){c.apply(p,arguments.length?arguments:d)};b.unshift(c);b=h.apply(this,b);p.proceed=null;return b}}};"";return b});M(a,"Core/Color/Palette.js",[],function(){return{colors:"#7cb5ec #434348 #90ed7d #f7a35c #8085e9 #f15c80 #e4d354 #2b908f #f45b5b #91e8e1".split(" "),backgroundColor:"#ffffff",neutralColor100:"#000000",neutralColor80:"#333333",neutralColor60:"#666666",
neutralColor40:"#999999",neutralColor20:"#cccccc",neutralColor10:"#e6e6e6",neutralColor5:"#f2f2f2",neutralColor3:"#f7f7f7",highlightColor100:"#003399",highlightColor80:"#335cad",highlightColor60:"#6685c2",highlightColor20:"#ccd6eb",highlightColor10:"#e6ebf5",positiveColor:"#06b535",negativeColor:"#f21313"}});M(a,"Core/Chart/ChartDefaults.js",[a["Core/Color/Palette.js"]],function(a){return{panning:{enabled:!1,type:"x"},styledMode:!1,borderRadius:0,colorCount:10,defaultSeriesType:"line",ignoreHiddenSeries:!0,
spacing:[10,10,15,10],resetZoomButton:{theme:{zIndex:6},position:{align:"right",x:-10,y:10}},zoomBySingleTouch:!1,width:null,height:null,borderColor:a.highlightColor80,backgroundColor:a.backgroundColor,plotBorderColor:a.neutralColor20}});M(a,"Core/Color/Color.js",[a["Core/Globals.js"],a["Core/Utilities.js"]],function(a,w){var r=w.isNumber,E=w.merge,z=w.pInt;w=function(){function x(r){this.rgba=[NaN,NaN,NaN,NaN];this.input=r;var u=a.Color;if(u&&u!==x)return new u(r);if(!(this instanceof x))return new x(r);
this.init(r)}x.parse=function(a){return a?new x(a):x.None};x.prototype.init=function(a){var u;if("object"===typeof a&&"undefined"!==typeof a.stops)this.stops=a.stops.map(function(c){return new x(c[1])});else if("string"===typeof a){this.input=a=x.names[a.toLowerCase()]||a;if("#"===a.charAt(0)){var n=a.length;var m=parseInt(a.substr(1),16);7===n?u=[(m&16711680)>>16,(m&65280)>>8,m&255,1]:4===n&&(u=[(m&3840)>>4|(m&3840)>>8,(m&240)>>4|m&240,(m&15)<<4|m&15,1])}if(!u)for(m=x.parsers.length;m--&&!u;){var g=
x.parsers[m];(n=g.regex.exec(a))&&(u=g.parse(n))}}u&&(this.rgba=u)};x.prototype.get=function(a){var u=this.input,n=this.rgba;if("object"===typeof u&&"undefined"!==typeof this.stops){var m=E(u);m.stops=[].slice.call(m.stops);this.stops.forEach(function(g,c){m.stops[c]=[m.stops[c][0],g.get(a)]});return m}return n&&r(n[0])?"rgb"===a||!a&&1===n[3]?"rgb("+n[0]+","+n[1]+","+n[2]+")":"a"===a?""+n[3]:"rgba("+n.join(",")+")":u};x.prototype.brighten=function(a){var u=this.rgba;if(this.stops)this.stops.forEach(function(m){m.brighten(a)});
else if(r(a)&&0!==a)for(var n=0;3>n;n++)u[n]+=z(255*a),0>u[n]&&(u[n]=0),255<u[n]&&(u[n]=255);return this};x.prototype.setOpacity=function(a){this.rgba[3]=a;return this};x.prototype.tweenTo=function(a,u){var n=this.rgba,m=a.rgba;if(!r(n[0])||!r(m[0]))return a.input||"none";a=1!==m[3]||1!==n[3];return(a?"rgba(":"rgb(")+Math.round(m[0]+(n[0]-m[0])*(1-u))+","+Math.round(m[1]+(n[1]-m[1])*(1-u))+","+Math.round(m[2]+(n[2]-m[2])*(1-u))+(a?","+(m[3]+(n[3]-m[3])*(1-u)):"")+")"};x.names={white:"#ffffff",black:"#000000"};
x.parsers=[{regex:/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]?(?:\.[0-9]+)?)\s*\)/,parse:function(a){return[z(a[1]),z(a[2]),z(a[3]),parseFloat(a[4],10)]}},{regex:/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/,parse:function(a){return[z(a[1]),z(a[2]),z(a[3]),1]}}];x.None=new x("");return x}();"";return w});M(a,"Core/Time.js",[a["Core/Globals.js"],a["Core/Utilities.js"]],function(a,w){var r=a.win,E=w.defined,z=w.error,x=w.extend,J=w.isObject,u=w.merge,
n=w.objectEach,m=w.pad,g=w.pick,c=w.splat,e=w.timeUnits,l=a.isSafari&&r.Intl&&r.Intl.DateTimeFormat.prototype.formatRange,f=a.isSafari&&r.Intl&&!r.Intl.DateTimeFormat.prototype.formatRange;w=function(){function v(c){this.options={};this.variableTimezone=this.useUTC=!1;this.Date=r.Date;this.getTimezoneOffset=this.timezoneOffsetFunction();this.update(c)}v.prototype.get=function(c,e){if(this.variableTimezone||this.timezoneOffset){var k=e.getTime(),f=k-this.getTimezoneOffset(e);e.setTime(f);c=e["getUTC"+
c]();e.setTime(k);return c}return this.useUTC?e["getUTC"+c]():e["get"+c]()};v.prototype.set=function(c,e,f){if(this.variableTimezone||this.timezoneOffset){if("Milliseconds"===c||"Seconds"===c||"Minutes"===c&&0===this.getTimezoneOffset(e)%36E5)return e["setUTC"+c](f);var k=this.getTimezoneOffset(e);k=e.getTime()-k;e.setTime(k);e["setUTC"+c](f);c=this.getTimezoneOffset(e);k=e.getTime()+c;return e.setTime(k)}return this.useUTC||l&&"FullYear"===c?e["setUTC"+c](f):e["set"+c](f)};v.prototype.update=function(c){var e=
g(c&&c.useUTC,!0);this.options=c=u(!0,this.options||{},c);this.Date=c.Date||r.Date||Date;this.timezoneOffset=(this.useUTC=e)&&c.timezoneOffset;this.getTimezoneOffset=this.timezoneOffsetFunction();this.variableTimezone=e&&!(!c.getTimezoneOffset&&!c.timezone)};v.prototype.makeTime=function(c,e,l,v,B,a){if(this.useUTC){var k=this.Date.UTC.apply(0,arguments);var h=this.getTimezoneOffset(k);k+=h;var d=this.getTimezoneOffset(k);h!==d?k+=d-h:h-36E5!==this.getTimezoneOffset(k-36E5)||f||(k-=36E5)}else k=(new this.Date(c,
e,g(l,1),g(v,0),g(B,0),g(a,0))).getTime();return k};v.prototype.timezoneOffsetFunction=function(){var c=this,e=this.options,f=e.moment||r.moment;if(!this.useUTC)return function(c){return 6E4*(new Date(c.toString())).getTimezoneOffset()};if(e.timezone){if(f)return function(c){return 6E4*-f.tz(c,e.timezone).utcOffset()};z(25)}return this.useUTC&&e.getTimezoneOffset?function(c){return 6E4*e.getTimezoneOffset(c.valueOf())}:function(){return 6E4*(c.timezoneOffset||0)}};v.prototype.dateFormat=function(c,
e,f){if(!E(e)||isNaN(e))return a.defaultOptions.lang&&a.defaultOptions.lang.invalidDate||"";c=g(c,"%Y-%m-%d %H:%M:%S");var k=this,l=new this.Date(e),q=this.get("Hours",l),t=this.get("Day",l),h=this.get("Date",l),d=this.get("Month",l),b=this.get("FullYear",l),p=a.defaultOptions.lang,G=p&&p.weekdays,y=p&&p.shortWeekdays;l=x({a:y?y[t]:G[t].substr(0,3),A:G[t],d:m(h),e:m(h,2," "),w:t,b:p.shortMonths[d],B:p.months[d],m:m(d+1),o:d+1,y:b.toString().substr(2,2),Y:b,H:m(q),k:q,I:m(q%12||12),l:q%12||12,M:m(this.get("Minutes",
l)),p:12>q?"AM":"PM",P:12>q?"am":"pm",S:m(l.getSeconds()),L:m(Math.floor(e%1E3),3)},a.dateFormats);n(l,function(b,d){for(;-1!==c.indexOf("%"+d);)c=c.replace("%"+d,"function"===typeof b?b.call(k,e):b)});return f?c.substr(0,1).toUpperCase()+c.substr(1):c};v.prototype.resolveDTLFormat=function(e){return J(e,!0)?e:(e=c(e),{main:e[0],from:e[1],to:e[2]})};v.prototype.getTimeTicks=function(c,k,f,l){var q=this,v=[],t={},h=new q.Date(k),d=c.unitRange,b=c.count||1,p;l=g(l,1);if(E(k)){q.set("Milliseconds",h,
d>=e.second?0:b*Math.floor(q.get("Milliseconds",h)/b));d>=e.second&&q.set("Seconds",h,d>=e.minute?0:b*Math.floor(q.get("Seconds",h)/b));d>=e.minute&&q.set("Minutes",h,d>=e.hour?0:b*Math.floor(q.get("Minutes",h)/b));d>=e.hour&&q.set("Hours",h,d>=e.day?0:b*Math.floor(q.get("Hours",h)/b));d>=e.day&&q.set("Date",h,d>=e.month?1:Math.max(1,b*Math.floor(q.get("Date",h)/b)));if(d>=e.month){q.set("Month",h,d>=e.year?0:b*Math.floor(q.get("Month",h)/b));var G=q.get("FullYear",h)}d>=e.year&&q.set("FullYear",
h,G-G%b);d===e.week&&(G=q.get("Day",h),q.set("Date",h,q.get("Date",h)-G+l+(G<l?-7:0)));G=q.get("FullYear",h);l=q.get("Month",h);var y=q.get("Date",h),a=q.get("Hours",h);k=h.getTime();!q.variableTimezone&&q.useUTC||!E(f)||(p=f-k>4*e.month||q.getTimezoneOffset(k)!==q.getTimezoneOffset(f));k=h.getTime();for(h=1;k<f;)v.push(k),k=d===e.year?q.makeTime(G+h*b,0):d===e.month?q.makeTime(G,l+h*b):!p||d!==e.day&&d!==e.week?p&&d===e.hour&&1<b?q.makeTime(G,l,y,a+h*b):k+d*b:q.makeTime(G,l,y+h*b*(d===e.day?1:7)),
h++;v.push(k);d<=e.hour&&1E4>v.length&&v.forEach(function(b){0===b%18E5&&"000000000"===q.dateFormat("%H%M%S%L",b)&&(t[b]="day")})}v.info=x(c,{higherRanks:t,totalRange:d*b});return v};v.prototype.getDateFormat=function(c,k,f,g){var l=this.dateFormat("%m-%d %H:%M:%S.%L",k),q={millisecond:15,second:12,minute:9,hour:6,day:3},t="millisecond";for(h in e){if(c===e.week&&+this.dateFormat("%w",k)===f&&"00:00:00.000"===l.substr(6)){var h="week";break}if(e[h]>c){h=t;break}if(q[h]&&l.substr(q[h])!=="01-01 00:00:00.000".substr(q[h]))break;
"week"!==h&&(t=h)}if(h)var d=this.resolveDTLFormat(g[h]).main;return d};return v}();"";return w});M(a,"Core/DefaultOptions.js",[a["Core/Chart/ChartDefaults.js"],a["Core/Color/Color.js"],a["Core/Globals.js"],a["Core/Color/Palette.js"],a["Core/Time.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x){w=w.parse;var r=x.merge,u={colors:E.colors,symbols:["circle","diamond","square","triangle","triangle-down"],lang:{loading:"Loading...",months:"January February March April May June July August September October November December".split(" "),
shortMonths:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),decimalPoint:".",numericSymbols:"kMGTPE".split(""),resetZoom:"Reset zoom",resetZoomTitle:"Reset zoom level 1:1",thousandsSep:" "},global:{},time:{Date:void 0,getTimezoneOffset:void 0,timezone:void 0,timezoneOffset:0,useUTC:!0},chart:a,title:{text:"Chart title",align:"center",margin:15,widthAdjust:-44},subtitle:{text:"",align:"center",widthAdjust:-44},
caption:{margin:15,text:"",align:"left",verticalAlign:"bottom"},plotOptions:{},labels:{style:{position:"absolute",color:E.neutralColor80}},legend:{enabled:!0,align:"center",alignColumns:!0,className:"highcharts-no-tooltip",layout:"horizontal",labelFormatter:function(){return this.name},borderColor:E.neutralColor40,borderRadius:0,navigation:{activeColor:E.highlightColor100,inactiveColor:E.neutralColor20},itemStyle:{color:E.neutralColor80,cursor:"pointer",fontSize:"12px",fontWeight:"bold",textOverflow:"ellipsis"},
itemHoverStyle:{color:E.neutralColor100},itemHiddenStyle:{color:E.neutralColor20},shadow:!1,itemCheckboxStyle:{position:"absolute",width:"13px",height:"13px"},squareSymbol:!0,symbolPadding:5,verticalAlign:"bottom",x:0,y:0,title:{style:{fontWeight:"bold"}}},loading:{labelStyle:{fontWeight:"bold",position:"relative",top:"45%"},style:{position:"absolute",backgroundColor:E.backgroundColor,opacity:.5,textAlign:"center"}},tooltip:{enabled:!0,animation:C.svg,borderRadius:3,dateTimeLabelFormats:{millisecond:"%A, %b %e, %H:%M:%S.%L",
second:"%A, %b %e, %H:%M:%S",minute:"%A, %b %e, %H:%M",hour:"%A, %b %e, %H:%M",day:"%A, %b %e, %Y",week:"Week from %A, %b %e, %Y",month:"%B %Y",year:"%Y"},footerFormat:"",headerShape:"callout",hideDelay:500,padding:8,shape:"callout",shared:!1,snap:C.isTouchDevice?25:10,headerFormat:'<span style="font-size: 10px">{point.key}</span><br/>',pointFormat:'<span style="color:{point.color}">\u25cf</span> {series.name}: <b>{point.y}</b><br/>',backgroundColor:w(E.neutralColor3).setOpacity(.85).get(),borderWidth:1,
shadow:!0,stickOnContact:!1,style:{color:E.neutralColor80,cursor:"default",fontSize:"12px",whiteSpace:"nowrap"},useHTML:!1},credits:{enabled:!0,href:"https://www.highcharts.com?credits",position:{align:"right",x:-10,verticalAlign:"bottom",y:-5},style:{cursor:"pointer",color:E.neutralColor40,fontSize:"9px"},text:"Highcharts.com"}};u.chart.styledMode=!1;"";var n=new z(r(u.global,u.time));a={defaultOptions:u,defaultTime:n,getOptions:function(){return u},setOptions:function(a){r(!0,u,a);if(a.time||a.global)C.time?
C.time.update(r(u.global,u.time,a.global,a.time)):C.time=n;return u}};"";return a});M(a,"Core/Animation/Fx.js",[a["Core/Color/Color.js"],a["Core/Globals.js"],a["Core/Utilities.js"]],function(a,w,C){var r=a.parse,z=w.win,x=C.isNumber,J=C.objectEach;return function(){function a(a,m,g){this.pos=NaN;this.options=m;this.elem=a;this.prop=g}a.prototype.dSetter=function(){var a=this.paths,m=a&&a[0];a=a&&a[1];var g=this.now||0,c=[];if(1!==g&&m&&a)if(m.length===a.length&&1>g)for(var e=0;e<a.length;e++){for(var l=
m[e],f=a[e],v=[],q=0;q<f.length;q++){var k=l[q],I=f[q];x(k)&&x(I)&&("A"!==f[0]||4!==q&&5!==q)?v[q]=k+g*(I-k):v[q]=I}c.push(v)}else c=a;else c=this.toD||[];this.elem.attr("d",c,void 0,!0)};a.prototype.update=function(){var a=this.elem,m=this.prop,g=this.now,c=this.options.step;if(this[m+"Setter"])this[m+"Setter"]();else a.attr?a.element&&a.attr(m,g,null,!0):a.style[m]=g+this.unit;c&&c.call(a,g,this)};a.prototype.run=function(n,m,g){var c=this,e=c.options,l=function(e){return l.stopped?!1:c.step(e)},
f=z.requestAnimationFrame||function(c){setTimeout(c,13)},v=function(){for(var c=0;c<a.timers.length;c++)a.timers[c]()||a.timers.splice(c--,1);a.timers.length&&f(v)};n!==m||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=n,this.end=m,this.unit=g,this.now=this.start,this.pos=0,l.elem=this.elem,l.prop=this.prop,l()&&1===a.timers.push(l)&&f(v)):(delete e.curAnim[this.prop],e.complete&&0===Object.keys(e.curAnim).length&&e.complete.call(this.elem))};a.prototype.step=function(a){var m=
+new Date,g=this.options,c=this.elem,e=g.complete,l=g.duration,f=g.curAnim;if(c.attr&&!c.element)a=!1;else if(a||m>=l+this.startTime){this.now=this.end;this.pos=1;this.update();var v=f[this.prop]=!0;J(f,function(c){!0!==c&&(v=!1)});v&&e&&e.call(c);a=!1}else this.pos=g.easing((m-this.startTime)/l),this.now=this.start+(this.end-this.start)*this.pos,this.update(),a=!0;return a};a.prototype.initPath=function(a,m,g){function c(c,e){for(;c.length<D;){var f=c[0],h=e[D-c.length];h&&"M"===f[0]&&(c[0]="C"===
h[0]?["C",f[1],f[2],f[1],f[2],f[1],f[2]]:["L",f[1],f[2]]);c.unshift(f);v&&(f=c.pop(),c.push(c[c.length-1],f))}}function e(c,e){for(;c.length<D;)if(e=c[Math.floor(c.length/q)-1].slice(),"C"===e[0]&&(e[1]=e[5],e[2]=e[6]),v){var f=c[Math.floor(c.length/q)].slice();c.splice(c.length/2,0,e,f)}else c.push(e)}var l=a.startX,f=a.endX;g=g.slice();var v=a.isArea,q=v?2:1;m=m&&m.slice();if(!m)return[g,g];if(l&&f&&f.length){for(a=0;a<l.length;a++)if(l[a]===f[0]){var k=a;break}else if(l[0]===f[f.length-l.length+
a]){k=a;var I=!0;break}else if(l[l.length-1]===f[f.length-l.length+a]){k=l.length-a;break}"undefined"===typeof k&&(m=[])}if(m.length&&x(k)){var D=g.length+k*q;I?(c(m,g),e(g,m)):(c(g,m),e(m,g))}return[m,g]};a.prototype.fillSetter=function(){a.prototype.strokeSetter.apply(this,arguments)};a.prototype.strokeSetter=function(){this.elem.attr(this.prop,r(this.start).tweenTo(r(this.end),this.pos),null,!0)};a.timers=[];return a}()});M(a,"Core/Animation/AnimationUtilities.js",[a["Core/Animation/Fx.js"],a["Core/Utilities.js"]],
function(a,w){function r(c){return n(c)?m({duration:500,defer:0},c):{duration:c?500:0,defer:0}}function E(c,g){for(var e=a.timers.length;e--;)a.timers[e].elem!==c||g&&g!==a.timers[e].prop||(a.timers[e].stopped=!0)}var z=w.defined,x=w.getStyle,J=w.isArray,u=w.isNumber,n=w.isObject,m=w.merge,g=w.objectEach,c=w.pick;return{animate:function(c,l,f){var e,q="",k,I;if(!n(f)){var D=arguments;f={duration:D[2],easing:D[3],complete:D[4]}}u(f.duration)||(f.duration=400);f.easing="function"===typeof f.easing?
f.easing:Math[f.easing]||Math.easeInOutSine;f.curAnim=m(l);g(l,function(g,v){E(c,v);I=new a(c,f,v);k=void 0;"d"===v&&J(l.d)?(I.paths=I.initPath(c,c.pathArray,l.d),I.toD=l.d,e=0,k=1):c.attr?e=c.attr(v):(e=parseFloat(x(c,v))||0,"opacity"!==v&&(q="px"));k||(k=g);"string"===typeof k&&k.match("px")&&(k=k.replace(/px/g,""));I.run(e,k,q)})},animObject:r,getDeferredAnimation:function(c,g,f){var e=r(g),a=0,k=0;(f?[f]:c.series).forEach(function(c){c=r(c.options.animation);a=g&&z(g.defer)?e.defer:Math.max(a,
c.duration+c.defer);k=Math.min(e.duration,c.duration)});c.renderer.forExport&&(a=0);return{defer:Math.max(0,a-k),duration:Math.min(a,k)}},setAnimation:function(e,g){g.renderer.globalAnimation=c(e,g.options.chart.animation,!0)},stop:E}});M(a,"Core/Renderer/HTML/AST.js",[a["Core/Globals.js"],a["Core/Utilities.js"]],function(a,w){var r=a.SVG_NS,E=w.attr,z=w.createElement,x=w.discardElement,J=w.error,u=w.isString,n=w.objectEach,m=w.splat;try{var g=!!(new DOMParser).parseFromString("","text/html")}catch(c){g=
!1}w=function(){function c(c){this.nodes="string"===typeof c?this.parseMarkup(c):c}c.filterUserAttributes=function(e){n(e,function(g,f){var a=!0;-1===c.allowedAttributes.indexOf(f)&&(a=!1);-1!==["background","dynsrc","href","lowsrc","src"].indexOf(f)&&(a=u(g)&&c.allowedReferences.some(function(c){return 0===g.indexOf(c)}));a||(J("Highcharts warning: Invalid attribute '"+f+"' in config"),delete e[f])});return e};c.setElementHTML=function(e,g){e.innerHTML="";g&&(new c(g)).addToDOM(e)};c.prototype.addToDOM=
function(e){function g(e,l){var f;m(e).forEach(function(e){var k=e.tagName,q=e.textContent?a.doc.createTextNode(e.textContent):void 0;if(k)if("#text"===k)var v=q;else if(-1!==c.allowedTags.indexOf(k)){k=a.doc.createElementNS("svg"===k?r:l.namespaceURI||r,k);var m=e.attributes||{};n(e,function(c,h){"tagName"!==h&&"attributes"!==h&&"children"!==h&&"textContent"!==h&&(m[h]=c)});E(k,c.filterUserAttributes(m));q&&k.appendChild(q);g(e.children||[],k);v=k}else J("Highcharts warning: Invalid tagName '"+k+
"' in config");v&&l.appendChild(v);f=v});return f}return g(this.nodes,e)};c.prototype.parseMarkup=function(c){var e=[];c=c.trim();if(g)c=(new DOMParser).parseFromString(c,"text/html");else{var f=z("div");f.innerHTML=c;c={body:f}}var a=function(c,e){var f=c.nodeName.toLowerCase(),k={tagName:f};"#text"===f&&(k.textContent=c.textContent||"");if(f=c.attributes){var g={};[].forEach.call(f,function(c){g[c.name]=c.value});k.attributes=g}if(c.childNodes.length){var l=[];[].forEach.call(c.childNodes,function(c){a(c,
l)});l.length&&(k.children=l)}e.push(k)};[].forEach.call(c.body.childNodes,function(c){return a(c,e)});f&&x(f);return e};c.allowedAttributes="aria-controls aria-describedby aria-expanded aria-haspopup aria-hidden aria-label aria-labelledby aria-live aria-pressed aria-readonly aria-roledescription aria-selected class clip-path color colspan cx cy d dx dy disabled fill height href id in markerHeight markerWidth offset opacity orient padding paddingLeft paddingRight patternUnits r refX refY role scope slope src startOffset stdDeviation stroke stroke-linecap stroke-width style tableValues result rowspan summary target tabindex text-align textAnchor textLength type valign width x x1 x2 y y1 y2 zIndex".split(" ");
c.allowedReferences="https:// http:// mailto: / ../ ./ #".split(" ");c.allowedTags="a b br button caption circle clipPath code dd defs div dl dt em feComponentTransfer feFuncA feFuncB feFuncG feFuncR feGaussianBlur feOffset feMerge feMergeNode filter h1 h2 h3 h4 h5 h6 hr i img li linearGradient marker ol p path pattern pre rect small span stop strong style sub sup svg table text thead tbody tspan td th tr u ul #text".split(" ");return c}();"";return w});M(a,"Core/FormatUtilities.js",[a["Core/DefaultOptions.js"],
a["Core/Utilities.js"]],function(a,w){function r(a,g,c,e){a=+a||0;g=+g;var l=E.lang,f=(a.toString().split(".")[1]||"").split("e")[0].length,v=a.toString().split("e"),q=g;if(-1===g)g=Math.min(f,20);else if(!J(g))g=2;else if(g&&v[1]&&0>v[1]){var k=g+ +v[1];0<=k?(v[0]=(+v[0]).toExponential(k).split("e")[0],g=k):(v[0]=v[0].split(".")[0]||0,a=20>g?(v[0]*Math.pow(10,v[1])).toFixed(g):0,v[1]=0)}k=(Math.abs(v[1]?v[0]:a)+Math.pow(10,-Math.max(g,f)-1)).toFixed(g);f=String(n(k));var m=3<f.length?f.length%3:
0;c=u(c,l.decimalPoint);e=u(e,l.thousandsSep);a=(0>a?"-":"")+(m?f.substr(0,m)+e:"");a=0>+v[1]&&!q?"0":a+f.substr(m).replace(/(\d{3})(?=\d)/g,"$1"+e);g&&(a+=c+k.slice(-g));v[1]&&0!==+a&&(a+="e"+v[1]);return a}var E=a.defaultOptions,z=a.defaultTime,x=w.getNestedProperty,J=w.isNumber,u=w.pick,n=w.pInt;return{dateFormat:function(a,g,c){return z.dateFormat(a,g,c)},format:function(a,g,c){var e="{",l=!1,f=/f$/,v=/\.([0-9])/,q=E.lang,k=c&&c.time||z;c=c&&c.numberFormatter||r;for(var m=[];a;){var D=a.indexOf(e);
if(-1===D)break;var B=a.slice(0,D);if(l){B=B.split(":");e=x(B.shift()||"",g);if(B.length&&"number"===typeof e)if(B=B.join(":"),f.test(B)){var u=parseInt((B.match(v)||["","-1"])[1],10);null!==e&&(e=c(e,u,q.decimalPoint,-1<B.indexOf(",")?q.thousandsSep:""))}else e=k.dateFormat(B,e);m.push(e)}else m.push(B);a=a.slice(D+1);e=(l=!l)?"}":"{"}m.push(a);return m.join("")},numberFormat:r}});M(a,"Core/Renderer/RendererUtilities.js",[a["Core/Utilities.js"]],function(a){var r=a.clamp,C=a.pick,E=a.stableSort,
z;(function(a){function x(a,n,m){var g=a,c=g.reducedLen||n,e=function(c,e){return(e.rank||0)-(c.rank||0)},l=function(c,e){return c.target-e.target},f,v=!0,q=[],k=0;for(f=a.length;f--;)k+=a[f].size;if(k>c){E(a,e);for(k=f=0;k<=c;)k+=a[f].size,f++;q=a.splice(f-1,a.length)}E(a,l);for(a=a.map(function(c){return{size:c.size,targets:[c.target],align:C(c.align,.5)}});v;){for(f=a.length;f--;)c=a[f],e=(Math.min.apply(0,c.targets)+Math.max.apply(0,c.targets))/2,c.pos=r(e-c.size*c.align,0,n-c.size);f=a.length;
for(v=!1;f--;)0<f&&a[f-1].pos+a[f-1].size>a[f].pos&&(a[f-1].size+=a[f].size,a[f-1].targets=a[f-1].targets.concat(a[f].targets),a[f-1].align=.5,a[f-1].pos+a[f-1].size>n&&(a[f-1].pos=n-a[f-1].size),a.splice(f,1),v=!0)}g.push.apply(g,q);f=0;a.some(function(c){var e=0;return(c.targets||[]).some(function(){g[f].pos=c.pos+e;if("undefined"!==typeof m&&Math.abs(g[f].pos-g[f].target)>m)return g.slice(0,f+1).forEach(function(c){return delete c.pos}),g.reducedLen=(g.reducedLen||n)-.1*n,g.reducedLen>.1*n&&x(g,
n,m),!0;e+=g[f].size;f++;return!1})});E(g,l);return g}a.distribute=x})(z||(z={}));return z});M(a,"Core/Renderer/SVG/SVGElement.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/Renderer/HTML/AST.js"],a["Core/Color/Color.js"],a["Core/Globals.js"],a["Core/Color/Palette.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x){var r=a.animate,u=a.animObject,n=a.stop,m=E.deg2rad,g=E.doc,c=E.noop,e=E.svg,l=E.SVG_NS,f=E.win,v=x.addEvent,q=x.attr,k=x.createElement,I=x.css,D=x.defined,B=x.erase,O=x.extend,
t=x.fireEvent,h=x.isArray,d=x.isFunction,b=x.isNumber,p=x.isString,G=x.merge,y=x.objectEach,L=x.pick,F=x.pInt,P=x.syncTimeout,S=x.uniqueKey;a=function(){function a(){this.element=void 0;this.onEvents={};this.opacity=1;this.renderer=void 0;this.SVG_NS=l;this.symbolCustomAttribs="x y width height r start end innerR anchorX anchorY rounded".split(" ")}a.prototype._defaultGetter=function(b){b=L(this[b+"Value"],this[b],this.element?this.element.getAttribute(b):null,0);/^[\-0-9\.]+$/.test(b)&&(b=parseFloat(b));
return b};a.prototype._defaultSetter=function(b,d,c){c.setAttribute(d,b)};a.prototype.add=function(b){var d=this.renderer,c=this.element;b&&(this.parentGroup=b);this.parentInverted=b&&b.inverted;"undefined"!==typeof this.textStr&&"text"===this.element.nodeName&&d.buildText(this);this.added=!0;if(!b||b.handleZ||this.zIndex)var K=this.zIndexSetter();K||(b?b.element:d.box).appendChild(c);if(this.onAdd)this.onAdd();return this};a.prototype.addClass=function(b,d){var c=d?"":this.attr("class")||"";b=(b||
"").split(/ /g).reduce(function(b,d){-1===c.indexOf(d)&&b.push(d);return b},c?[c]:[]).join(" ");b!==c&&this.attr("class",b);return this};a.prototype.afterSetters=function(){this.doTransform&&(this.updateTransform(),this.doTransform=!1)};a.prototype.align=function(b,d,c){var K={},h=this.renderer,H=h.alignedObjects,a,e,A;if(b){if(this.alignOptions=b,this.alignByTranslate=d,!c||p(c))this.alignTo=a=c||"renderer",B(H,this),H.push(this),c=void 0}else b=this.alignOptions,d=this.alignByTranslate,a=this.alignTo;
c=L(c,h[a],"scrollablePlotBox"===a?h.plotBox:void 0,h);a=b.align;var f=b.verticalAlign;h=(c.x||0)+(b.x||0);H=(c.y||0)+(b.y||0);"right"===a?e=1:"center"===a&&(e=2);e&&(h+=(c.width-(b.width||0))/e);K[d?"translateX":"x"]=Math.round(h);"bottom"===f?A=1:"middle"===f&&(A=2);A&&(H+=(c.height-(b.height||0))/A);K[d?"translateY":"y"]=Math.round(H);this[this.placed?"animate":"attr"](K);this.placed=!0;this.alignAttr=K;return this};a.prototype.alignSetter=function(b){var d={left:"start",center:"middle",right:"end"};
d[b]&&(this.alignValue=b,this.element.setAttribute("text-anchor",d[b]))};a.prototype.animate=function(b,d,c){var h=this,H=u(L(d,this.renderer.globalAnimation,!0));d=H.defer;L(g.hidden,g.msHidden,g.webkitHidden,!1)&&(H.duration=0);0!==H.duration?(c&&(H.complete=c),P(function(){h.element&&r(h,b,H)},d)):(this.attr(b,void 0,c),y(b,function(b,d){H.step&&H.step.call(this,b,{prop:d,pos:1,elem:this})},this));return this};a.prototype.applyTextOutline=function(b){var d=this.element;-1!==b.indexOf("contrast")&&
(b=b.replace(/contrast/g,this.renderer.getContrast(d.style.fill)));var c=b.split(" ");b=c[c.length-1];if((c=c[0])&&"none"!==c&&E.svg){this.fakeTS=!0;this.ySetter=this.xSetter;c=c.replace(/(^[\d\.]+)(.*?)$/g,function(b,d,c){return 2*Number(d)+c});this.removeTextOutline();var h=g.createElementNS(l,"tspan");q(h,{"class":"highcharts-text-outline",fill:b,stroke:b,"stroke-width":c,"stroke-linejoin":"round"});[].forEach.call(d.childNodes,function(b){var d=b.cloneNode(!0);d.removeAttribute&&["fill","stroke",
"stroke-width","stroke"].forEach(function(b){return d.removeAttribute(b)});h.appendChild(d)});var a=g.createElementNS(l,"tspan");a.textContent="\u200b";["x","y"].forEach(function(b){var c=d.getAttribute(b);c&&a.setAttribute(b,c)});h.appendChild(a);d.insertBefore(h,d.firstChild)}};a.prototype.attr=function(b,d,c,h){var K=this.element,H=this.symbolCustomAttribs,a,e=this,A,p;if("string"===typeof b&&"undefined"!==typeof d){var f=b;b={};b[f]=d}"string"===typeof b?e=(this[b+"Getter"]||this._defaultGetter).call(this,
b,K):(y(b,function(d,c){A=!1;h||n(this,c);this.symbolName&&-1!==H.indexOf(c)&&(a||(this.symbolAttr(b),a=!0),A=!0);!this.rotation||"x"!==c&&"y"!==c||(this.doTransform=!0);A||(p=this[c+"Setter"]||this._defaultSetter,p.call(this,d,c,K),!this.styledMode&&this.shadows&&/^(width|height|visibility|x|y|d|transform|cx|cy|r)$/.test(c)&&this.updateShadows(c,d,p))},this),this.afterSetters());c&&c.call(this);return e};a.prototype.clip=function(b){return this.attr("clip-path",b?"url("+this.renderer.url+"#"+b.id+
")":"none")};a.prototype.crisp=function(b,d){d=d||b.strokeWidth||0;var c=Math.round(d)%2/2;b.x=Math.floor(b.x||this.x||0)+c;b.y=Math.floor(b.y||this.y||0)+c;b.width=Math.floor((b.width||this.width||0)-2*c);b.height=Math.floor((b.height||this.height||0)-2*c);D(b.strokeWidth)&&(b.strokeWidth=d);return b};a.prototype.complexColor=function(b,d,c){var K=this.renderer,a,H,e,p,A,f,k,g,l,q,v=[],F;t(this.renderer,"complexColor",{args:arguments},function(){b.radialGradient?H="radialGradient":b.linearGradient&&
(H="linearGradient");if(H){e=b[H];A=K.gradients;f=b.stops;l=c.radialReference;h(e)&&(b[H]=e={x1:e[0],y1:e[1],x2:e[2],y2:e[3],gradientUnits:"userSpaceOnUse"});"radialGradient"===H&&l&&!D(e.gradientUnits)&&(p=e,e=G(e,K.getRadialAttr(l,p),{gradientUnits:"userSpaceOnUse"}));y(e,function(b,d){"id"!==d&&v.push(d,b)});y(f,function(b){v.push(b)});v=v.join(",");if(A[v])q=A[v].attr("id");else{e.id=q=S();var N=A[v]=K.createElement(H).attr(e).add(K.defs);N.radAttr=p;N.stops=[];f.forEach(function(b){0===b[1].indexOf("rgba")?
(a=C.parse(b[1]),k=a.get("rgb"),g=a.get("a")):(k=b[1],g=1);b=K.createElement("stop").attr({offset:b[0],"stop-color":k,"stop-opacity":g}).add(N);N.stops.push(b)})}F="url("+K.url+"#"+q+")";c.setAttribute(d,F);c.gradient=v;b.toString=function(){return F}}})};a.prototype.css=function(b){var d=this.styles,c={},h=this.element,a=["textOutline","textOverflow","width"],p="",f=!d;b&&b.color&&(b.fill=b.color);d&&y(b,function(b,h){d&&d[h]!==b&&(c[h]=b,f=!0)});if(f){d&&(b=O(d,c));if(b)if(null===b.width||"auto"===
b.width)delete this.textWidth;else if("text"===h.nodeName.toLowerCase()&&b.width)var k=this.textWidth=F(b.width);this.styles=b;k&&!e&&this.renderer.forExport&&delete b.width;if(h.namespaceURI===this.SVG_NS){var A=function(b,d){return"-"+d.toLowerCase()};y(b,function(b,d){-1===a.indexOf(d)&&(p+=d.replace(/([A-Z])/g,A)+":"+b+";")});p&&q(h,"style",p)}else I(h,b);this.added&&("text"===this.element.nodeName&&this.renderer.buildText(this),b&&b.textOutline&&this.applyTextOutline(b.textOutline))}return this};
a.prototype.dashstyleSetter=function(b){var d=this["stroke-width"];"inherit"===d&&(d=1);if(b=b&&b.toLowerCase()){var c=b.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");for(b=c.length;b--;)c[b]=""+F(c[b])*L(d,NaN);b=c.join(",").replace(/NaN/g,"none");this.element.setAttribute("stroke-dasharray",b)}};a.prototype.destroy=
function(){var b=this,d=b.element||{},c=b.renderer,h=d.ownerSVGElement,a=c.isSVG&&"SPAN"===d.nodeName&&b.parentGroup||void 0;d.onclick=d.onmouseout=d.onmouseover=d.onmousemove=d.point=null;n(b);if(b.clipPath&&h){var e=b.clipPath;[].forEach.call(h.querySelectorAll("[clip-path],[CLIP-PATH]"),function(b){-1<b.getAttribute("clip-path").indexOf(e.element.id)&&b.removeAttribute("clip-path")});b.clipPath=e.destroy()}if(b.stops){for(h=0;h<b.stops.length;h++)b.stops[h].destroy();b.stops.length=0;b.stops=void 0}b.safeRemoveChild(d);
for(c.styledMode||b.destroyShadows();a&&a.div&&0===a.div.childNodes.length;)d=a.parentGroup,b.safeRemoveChild(a.div),delete a.div,a=d;b.alignTo&&B(c.alignedObjects,b);y(b,function(d,c){b[c]&&b[c].parentGroup===b&&b[c].destroy&&b[c].destroy();delete b[c]})};a.prototype.destroyShadows=function(){(this.shadows||[]).forEach(function(b){this.safeRemoveChild(b)},this);this.shadows=void 0};a.prototype.destroyTextPath=function(b,d){var c=b.getElementsByTagName("text")[0];if(c){if(c.removeAttribute("dx"),
c.removeAttribute("dy"),d.element.setAttribute("id",""),this.textPathWrapper&&c.getElementsByTagName("textPath").length){for(b=this.textPathWrapper.element.childNodes;b.length;)c.appendChild(b[0]);c.removeChild(this.textPathWrapper.element)}}else if(b.getAttribute("dx")||b.getAttribute("dy"))b.removeAttribute("dx"),b.removeAttribute("dy");this.textPathWrapper&&(this.textPathWrapper=this.textPathWrapper.destroy())};a.prototype.dSetter=function(b,d,c){h(b)&&("string"===typeof b[0]&&(b=this.renderer.pathToSegments(b)),
this.pathArray=b,b=b.reduce(function(b,d,c){return d&&d.join?(c?b+" ":"")+d.join(" "):(d||"").toString()},""));/(NaN| {2}|^$)/.test(b)&&(b="M 0 0");this[d]!==b&&(c.setAttribute(d,b),this[d]=b)};a.prototype.fadeOut=function(b){var d=this;d.animate({opacity:0},{duration:L(b,150),complete:function(){d.attr({y:-9999}).hide()}})};a.prototype.fillSetter=function(b,d,c){"string"===typeof b?c.setAttribute(d,b):b&&this.complexColor(b,d,c)};a.prototype.getBBox=function(b,c){var h=this.renderer,K=this.element,
e=this.styles,p=this.textStr,f=h.cache,k=h.cacheKeys,A=K.namespaceURI===this.SVG_NS;c=L(c,this.rotation,0);var g=h.styledMode?K&&a.prototype.getStyle.call(K,"font-size"):e&&e.fontSize,y;if(D(p)){var G=p.toString();-1===G.indexOf("<")&&(G=G.replace(/[0-9]/g,"0"));G+=["",c,g,this.textWidth,e&&e.textOverflow,e&&e.fontWeight].join()}G&&!b&&(y=f[G]);if(!y){if(A||h.forExport){try{var l=this.fakeTS&&function(b){var d=K.querySelector(".highcharts-text-outline");d&&I(d,{display:b})};d(l)&&l("none");y=K.getBBox?
O({},K.getBBox()):{width:K.offsetWidth,height:K.offsetHeight};d(l)&&l("")}catch(Y){""}if(!y||0>y.width)y={width:0,height:0}}else y=this.htmlGetBBox();h.isSVG&&(b=y.width,h=y.height,A&&(y.height=h={"11px,17":14,"13px,20":16}[e&&e.fontSize+","+Math.round(h)]||h),c&&(e=c*m,y.width=Math.abs(h*Math.sin(e))+Math.abs(b*Math.cos(e)),y.height=Math.abs(h*Math.cos(e))+Math.abs(b*Math.sin(e))));if(G&&(""===p||0<y.height)){for(;250<k.length;)delete f[k.shift()];f[G]||k.push(G);f[G]=y}}return y};a.prototype.getStyle=
function(b){return f.getComputedStyle(this.element||this,"").getPropertyValue(b)};a.prototype.hasClass=function(b){return-1!==(""+this.attr("class")).split(" ").indexOf(b)};a.prototype.hide=function(b){b?this.attr({y:-9999}):this.attr({visibility:"hidden"});return this};a.prototype.htmlGetBBox=function(){return{height:0,width:0,x:0,y:0}};a.prototype.init=function(b,d){this.element="span"===d?k(d):g.createElementNS(this.SVG_NS,d);this.renderer=b;t(this,"afterInit")};a.prototype.invert=function(b){this.inverted=
b;this.updateTransform();return this};a.prototype.on=function(b,d){var c=this.onEvents;if(c[b])c[b]();c[b]=v(this.element,b,d);return this};a.prototype.opacitySetter=function(b,d,c){this.opacity=b=Number(Number(b).toFixed(3));c.setAttribute(d,b)};a.prototype.removeClass=function(b){return this.attr("class",(""+this.attr("class")).replace(p(b)?new RegExp("(^| )"+b+"( |$)"):b," ").replace(/ +/g," ").trim())};a.prototype.removeTextOutline=function(){var b=this.element.querySelector("tspan.highcharts-text-outline");
b&&this.safeRemoveChild(b)};a.prototype.safeRemoveChild=function(b){var d=b.parentNode;d&&d.removeChild(b)};a.prototype.setRadialReference=function(b){var d=this.element.gradient&&this.renderer.gradients[this.element.gradient];this.element.radialReference=b;d&&d.radAttr&&d.animate(this.renderer.getRadialAttr(b,d.radAttr));return this};a.prototype.setTextPath=function(d,h){var a=this.element,K=this.text?this.text.element:a,e={textAnchor:"text-anchor"},p=!1,f=this.textPathWrapper,k=!f;h=G(!0,{enabled:!0,
attributes:{dy:-5,startOffset:"50%",textAnchor:"middle"}},h);var A=w.filterUserAttributes(h.attributes);if(d&&h&&h.enabled){f&&null===f.element.parentNode?(k=!0,f=f.destroy()):f&&this.removeTextOutline.call(f.parentGroup);this.options&&this.options.padding&&(A.dx=-this.options.padding);f||(this.textPathWrapper=f=this.renderer.createElement("textPath"),p=!0);var g=f.element;(h=d.element.getAttribute("id"))||d.element.setAttribute("id",h=S());if(k)for(K.setAttribute("y",0),b(A.dx)&&K.setAttribute("x",
-A.dx),d=[].slice.call(K.childNodes),k=0;k<d.length;k++){var l=d[k];l.nodeType!==Node.TEXT_NODE&&"tspan"!==l.nodeName||g.appendChild(l)}p&&f&&f.add({element:K});g.setAttributeNS("http://www.w3.org/1999/xlink","href",this.renderer.url+"#"+h);D(A.dy)&&(g.parentNode.setAttribute("dy",A.dy),delete A.dy);D(A.dx)&&(g.parentNode.setAttribute("dx",A.dx),delete A.dx);y(A,function(b,d){g.setAttribute(e[d]||d,b)});a.removeAttribute("transform");this.removeTextOutline.call(f);this.text&&!this.renderer.styledMode&&
this.attr({fill:"none","stroke-width":0});this.applyTextOutline=this.updateTransform=c}else f&&(delete this.updateTransform,delete this.applyTextOutline,this.destroyTextPath(a,d),this.updateTransform(),this.options&&this.options.rotation&&this.applyTextOutline(this.options.style.textOutline));return this};a.prototype.shadow=function(b,d,c){var h=[],a=this.element,e=this.oldShadowOptions,H={color:z.neutralColor100,offsetX:this.parentInverted?-1:1,offsetY:this.parentInverted?-1:1,opacity:.15,width:3},
p=!1,A;!0===b?A=H:"object"===typeof b&&(A=O(H,b));A&&(A&&e&&y(A,function(b,d){b!==e[d]&&(p=!0)}),p&&this.destroyShadows(),this.oldShadowOptions=A);if(!A)this.destroyShadows();else if(!this.shadows){var f=A.opacity/A.width;var k=this.parentInverted?"translate("+A.offsetY+", "+A.offsetX+")":"translate("+A.offsetX+", "+A.offsetY+")";for(H=1;H<=A.width;H++){var g=a.cloneNode(!1);var G=2*A.width+1-2*H;q(g,{stroke:b.color||z.neutralColor100,"stroke-opacity":f*H,"stroke-width":G,transform:k,fill:"none"});
g.setAttribute("class",(g.getAttribute("class")||"")+" highcharts-shadow");c&&(q(g,"height",Math.max(q(g,"height")-G,0)),g.cutHeight=G);d?d.element.appendChild(g):a.parentNode&&a.parentNode.insertBefore(g,a);h.push(g)}this.shadows=h}return this};a.prototype.show=function(b){return this.attr({visibility:b?"inherit":"visible"})};a.prototype.strokeSetter=function(b,d,c){this[d]=b;this.stroke&&this["stroke-width"]?(a.prototype.fillSetter.call(this,this.stroke,"stroke",c),c.setAttribute("stroke-width",
this["stroke-width"]),this.hasStroke=!0):"stroke-width"===d&&0===b&&this.hasStroke?(c.removeAttribute("stroke"),this.hasStroke=!1):this.renderer.styledMode&&this["stroke-width"]&&(c.setAttribute("stroke-width",this["stroke-width"]),this.hasStroke=!0)};a.prototype.strokeWidth=function(){if(!this.renderer.styledMode)return this["stroke-width"]||0;var b=this.getStyle("stroke-width"),d=0;if(b.indexOf("px")===b.length-2)d=F(b);else if(""!==b){var c=g.createElementNS(l,"rect");q(c,{width:b,"stroke-width":0});
this.element.parentNode.appendChild(c);d=c.getBBox().width;c.parentNode.removeChild(c)}return d};a.prototype.symbolAttr=function(b){var d=this;"x y r start end width height innerR anchorX anchorY clockwise".split(" ").forEach(function(c){d[c]=L(b[c],d[c])});d.attr({d:d.renderer.symbols[d.symbolName](d.x,d.y,d.width,d.height,d)})};a.prototype.textSetter=function(b){b!==this.textStr&&(delete this.textPxLength,this.textStr=b,this.added&&this.renderer.buildText(this))};a.prototype.titleSetter=function(b){var d=
this.element,c=d.getElementsByTagName("title")[0]||g.createElementNS(this.SVG_NS,"title");d.insertBefore?d.insertBefore(c,d.firstChild):d.appendChild(c);c.textContent=String(L(b,"")).replace(/<[^>]*>/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">")};a.prototype.toFront=function(){var b=this.element;b.parentNode.appendChild(b);return this};a.prototype.translate=function(b,d){return this.attr({translateX:b,translateY:d})};a.prototype.updateShadows=function(b,d,c){var h=this.shadows;if(h)for(var a=h.length;a--;)c.call(h[a],
"height"===b?Math.max(d-(h[a].cutHeight||0),0):"d"===b?this.d:d,b,h[a])};a.prototype.updateTransform=function(){var b=this.scaleX,d=this.scaleY,c=this.inverted,h=this.rotation,a=this.matrix,e=this.element,p=this.translateX||0,f=this.translateY||0;c&&(p+=this.width,f+=this.height);p=["translate("+p+","+f+")"];D(a)&&p.push("matrix("+a.join(",")+")");c?p.push("rotate(90) scale(-1,1)"):h&&p.push("rotate("+h+" "+L(this.rotationOriginX,e.getAttribute("x"),0)+" "+L(this.rotationOriginY,e.getAttribute("y")||
0)+")");(D(b)||D(d))&&p.push("scale("+L(b,1)+" "+L(d,1)+")");p.length&&e.setAttribute("transform",p.join(" "))};a.prototype.visibilitySetter=function(b,d,c){"inherit"===b?c.removeAttribute(d):this[d]!==b&&c.setAttribute(d,b);this[d]=b};a.prototype.xGetter=function(b){"circle"===this.element.nodeName&&("x"===b?b="cx":"y"===b&&(b="cy"));return this._defaultGetter(b)};a.prototype.zIndexSetter=function(b,d){var c=this.renderer,h=this.parentGroup,a=(h||c).element||c.box,e=this.element;c=a===c.box;var p=
!1;var f=this.added;var A;D(b)?(e.setAttribute("data-z-index",b),b=+b,this[d]===b&&(f=!1)):D(this[d])&&e.removeAttribute("data-z-index");this[d]=b;if(f){(b=this.zIndex)&&h&&(h.handleZ=!0);d=a.childNodes;for(A=d.length-1;0<=A&&!p;A--){h=d[A];f=h.getAttribute("data-z-index");var k=!D(f);if(h!==e)if(0>b&&k&&!c&&!A)a.insertBefore(e,d[A]),p=!0;else if(F(f)<=b||k&&(!D(b)||0<=b))a.insertBefore(e,d[A+1]||null),p=!0}p||(a.insertBefore(e,d[c?3:0]||null),p=!0)}return p};return a}();a.prototype["stroke-widthSetter"]=
a.prototype.strokeSetter;a.prototype.yGetter=a.prototype.xGetter;a.prototype.matrixSetter=a.prototype.rotationOriginXSetter=a.prototype.rotationOriginYSetter=a.prototype.rotationSetter=a.prototype.scaleXSetter=a.prototype.scaleYSetter=a.prototype.translateXSetter=a.prototype.translateYSetter=a.prototype.verticalAlignSetter=function(b,d){this[d]=b;this.doTransform=!0};"";return a});M(a,"Core/Renderer/RendererRegistry.js",[a["Core/Globals.js"]],function(a){var r;(function(r){r.rendererTypes={};var w;
r.getRendererType=function(a){void 0===a&&(a=w);return r.rendererTypes[a]||r.rendererTypes[w]};r.registerRendererType=function(C,x,E){r.rendererTypes[C]=x;if(!w||E)w=C,a.Renderer=x}})(r||(r={}));return r});M(a,"Core/Renderer/SVG/SVGLabel.js",[a["Core/Renderer/SVG/SVGElement.js"],a["Core/Utilities.js"]],function(a,w){var r=this&&this.__extends||function(){var a=function(g,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,a){c.__proto__=a}||function(c,a){for(var e in a)a.hasOwnProperty(e)&&
(c[e]=a[e])};return a(g,c)};return function(g,c){function e(){this.constructor=g}a(g,c);g.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)}}(),E=w.defined,z=w.extend,x=w.isNumber,J=w.merge,u=w.pick,n=w.removeEvent;return function(m){function g(c,a,l,f,v,q,k,I,D,B){var e=m.call(this)||this;e.paddingLeftSetter=e.paddingSetter;e.paddingRightSetter=e.paddingSetter;e.init(c,"g");e.textStr=a;e.x=l;e.y=f;e.anchorX=q;e.anchorY=k;e.baseline=D;e.className=B;e.addClass("button"===B?"highcharts-no-tooltip":
"highcharts-label");B&&e.addClass("highcharts-"+B);e.text=c.text(void 0,0,0,I).attr({zIndex:1});var t;"string"===typeof v&&((t=/^url\((.*?)\)$/.test(v))||e.renderer.symbols[v])&&(e.symbolKey=v);e.bBox=g.emptyBBox;e.padding=3;e.baselineOffset=0;e.needsBox=c.styledMode||t;e.deferredAttr={};e.alignFactor=0;return e}r(g,m);g.prototype.alignSetter=function(c){c={left:0,center:.5,right:1}[c];c!==this.alignFactor&&(this.alignFactor=c,this.bBox&&x(this.xSetting)&&this.attr({x:this.xSetting}))};g.prototype.anchorXSetter=
function(c,a){this.anchorX=c;this.boxAttr(a,Math.round(c)-this.getCrispAdjust()-this.xSetting)};g.prototype.anchorYSetter=function(c,a){this.anchorY=c;this.boxAttr(a,c-this.ySetting)};g.prototype.boxAttr=function(c,a){this.box?this.box.attr(c,a):this.deferredAttr[c]=a};g.prototype.css=function(c){if(c){var e={};c=J(c);g.textProps.forEach(function(a){"undefined"!==typeof c[a]&&(e[a]=c[a],delete c[a])});this.text.css(e);var l="width"in e;"fontSize"in e||"fontWeight"in e?this.updateTextPadding():l&&
this.updateBoxSize()}return a.prototype.css.call(this,c)};g.prototype.destroy=function(){n(this.element,"mouseenter");n(this.element,"mouseleave");this.text&&this.text.destroy();this.box&&(this.box=this.box.destroy());a.prototype.destroy.call(this)};g.prototype.fillSetter=function(c,a){c&&(this.needsBox=!0);this.fill=c;this.boxAttr(a,c)};g.prototype.getBBox=function(){this.textStr&&0===this.bBox.width&&0===this.bBox.height&&this.updateBoxSize();var c=this.padding,a=u(this.paddingLeft,c);return{width:this.width,
height:this.height,x:this.bBox.x-a,y:this.bBox.y-c}};g.prototype.getCrispAdjust=function(){return this.renderer.styledMode&&this.box?this.box.strokeWidth()%2/2:(this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2};g.prototype.heightSetter=function(c){this.heightSetting=c};g.prototype.onAdd=function(){var c=this.textStr;this.text.add(this);this.attr({text:E(c)?c:"",x:this.x,y:this.y});this.box&&E(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})};g.prototype.paddingSetter=
function(c,a){x(c)?c!==this[a]&&(this[a]=c,this.updateTextPadding()):this[a]=void 0};g.prototype.rSetter=function(c,a){this.boxAttr(a,c)};g.prototype.shadow=function(c){c&&!this.renderer.styledMode&&(this.updateBoxSize(),this.box&&this.box.shadow(c));return this};g.prototype.strokeSetter=function(c,a){this.stroke=c;this.boxAttr(a,c)};g.prototype["stroke-widthSetter"]=function(c,a){c&&(this.needsBox=!0);this["stroke-width"]=c;this.boxAttr(a,c)};g.prototype["text-alignSetter"]=function(c){this.textAlign=
c};g.prototype.textSetter=function(c){"undefined"!==typeof c&&this.text.attr({text:c});this.updateTextPadding()};g.prototype.updateBoxSize=function(){var c=this.text.element.style,a={},l=this.padding,f=this.bBox=x(this.widthSetting)&&x(this.heightSetting)&&!this.textAlign||!E(this.text.textStr)?g.emptyBBox:this.text.getBBox();this.width=this.getPaddedWidth();this.height=(this.heightSetting||f.height||0)+2*l;c=this.renderer.fontMetrics(c&&c.fontSize,this.text);this.baselineOffset=l+Math.min((this.text.firstLineMetrics||
c).b,f.height||Infinity);this.heightSetting&&(this.baselineOffset+=(this.heightSetting-c.h)/2);this.needsBox&&(this.box||(l=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect(),l.addClass(("button"===this.className?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),l.add(this)),l=this.getCrispAdjust(),a.x=l,a.y=(this.baseline?-this.baselineOffset:0)+l,a.width=Math.round(this.width),a.height=Math.round(this.height),this.box.attr(z(a,this.deferredAttr)),
this.deferredAttr={})};g.prototype.updateTextPadding=function(){var c=this.text;this.updateBoxSize();var a=this.baseline?0:this.baselineOffset,g=u(this.paddingLeft,this.padding);E(this.widthSetting)&&this.bBox&&("center"===this.textAlign||"right"===this.textAlign)&&(g+={center:.5,right:1}[this.textAlign]*(this.widthSetting-this.bBox.width));if(g!==c.x||a!==c.y)c.attr("x",g),c.hasBoxWidthChanged&&(this.bBox=c.getBBox(!0)),"undefined"!==typeof a&&c.attr("y",a);c.x=g;c.y=a};g.prototype.widthSetter=function(c){this.widthSetting=
x(c)?c:void 0};g.prototype.getPaddedWidth=function(){var c=this.padding,a=u(this.paddingLeft,c);c=u(this.paddingRight,c);return(this.widthSetting||this.bBox.width||0)+a+c};g.prototype.xSetter=function(c){this.x=c;this.alignFactor&&(c-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0);this.xSetting=Math.round(c);this.attr("translateX",this.xSetting)};g.prototype.ySetter=function(c){this.ySetting=this.y=Math.round(c);this.attr("translateY",this.ySetting)};g.emptyBBox={width:0,height:0,
x:0,y:0};g.textProps="color direction fontFamily fontSize fontStyle fontWeight lineHeight textAlign textDecoration textOutline textOverflow width".split(" ");return g}(a)});M(a,"Core/Renderer/SVG/Symbols.js",[a["Core/Utilities.js"]],function(a){function r(a,n,m,g,c){var e=[];if(c){var l=c.start||0,f=J(c.r,m);m=J(c.r,g||m);var v=(c.end||0)-.001;g=c.innerR;var q=J(c.open,.001>Math.abs((c.end||0)-l-2*Math.PI)),k=Math.cos(l),I=Math.sin(l),D=Math.cos(v),B=Math.sin(v);l=J(c.longArc,.001>v-l-Math.PI?0:1);
e.push(["M",a+f*k,n+m*I],["A",f,m,0,l,J(c.clockwise,1),a+f*D,n+m*B]);z(g)&&e.push(q?["M",a+g*D,n+g*B]:["L",a+g*D,n+g*B],["A",g,g,0,l,z(c.clockwise)?1-c.clockwise:0,a+g*k,n+g*I]);q||e.push(["Z"])}return e}function C(a,n,m,g,c){return c&&c.r?E(a,n,m,g,c):[["M",a,n],["L",a+m,n],["L",a+m,n+g],["L",a,n+g],["Z"]]}function E(a,n,m,g,c){c=c&&c.r||0;return[["M",a+c,n],["L",a+m-c,n],["C",a+m,n,a+m,n,a+m,n+c],["L",a+m,n+g-c],["C",a+m,n+g,a+m,n+g,a+m-c,n+g],["L",a+c,n+g],["C",a,n+g,a,n+g,a,n+g-c],["L",a,n+c],
["C",a,n,a,n,a+c,n]]}var z=a.defined,x=a.isNumber,J=a.pick;return{arc:r,callout:function(a,n,m,g,c){var e=Math.min(c&&c.r||0,m,g),l=e+6,f=c&&c.anchorX;c=c&&c.anchorY||0;var v=E(a,n,m,g,{r:e});if(!x(f))return v;a+f>=m?c>n+l&&c<n+g-l?v.splice(3,1,["L",a+m,c-6],["L",a+m+6,c],["L",a+m,c+6],["L",a+m,n+g-e]):v.splice(3,1,["L",a+m,g/2],["L",f,c],["L",a+m,g/2],["L",a+m,n+g-e]):0>=a+f?c>n+l&&c<n+g-l?v.splice(7,1,["L",a,c+6],["L",a-6,c],["L",a,c-6],["L",a,n+e]):v.splice(7,1,["L",a,g/2],["L",f,c],["L",a,g/2],
["L",a,n+e]):c&&c>g&&f>a+l&&f<a+m-l?v.splice(5,1,["L",f+6,n+g],["L",f,n+g+6],["L",f-6,n+g],["L",a+e,n+g]):c&&0>c&&f>a+l&&f<a+m-l&&v.splice(1,1,["L",f-6,n],["L",f,n-6],["L",f+6,n],["L",m-e,n]);return v},circle:function(a,n,m,g){return r(a+m/2,n+g/2,m/2,g/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},diamond:function(a,n,m,g){return[["M",a+m/2,n],["L",a+m,n+g/2],["L",a+m/2,n+g],["L",a,n+g/2],["Z"]]},rect:C,roundedRect:E,square:C,triangle:function(a,n,m,g){return[["M",a+m/2,n],["L",a+m,n+g],["L",a,
n+g],["Z"]]},"triangle-down":function(a,n,m,g){return[["M",a,n],["L",a+m,n],["L",a+m/2,n+g],["Z"]]}}});M(a,"Core/Renderer/SVG/TextBuilder.js",[a["Core/Renderer/HTML/AST.js"],a["Core/Globals.js"],a["Core/Utilities.js"]],function(a,w,C){var r=w.doc,z=w.SVG_NS,x=C.attr,J=C.isString,u=C.objectEach,n=C.pick;return function(){function m(a){var c=a.styles;this.renderer=a.renderer;this.svgElement=a;this.width=a.textWidth;this.textLineHeight=c&&c.lineHeight;this.textOutline=c&&c.textOutline;this.ellipsis=
!(!c||"ellipsis"!==c.textOverflow);this.noWrap=!(!c||"nowrap"!==c.whiteSpace);this.fontSize=c&&c.fontSize}m.prototype.buildSVG=function(){var g=this.svgElement,c=g.element,e=g.renderer,l=n(g.textStr,"").toString(),f=-1!==l.indexOf("<"),v=c.childNodes;e=this.width&&!g.added&&e.box;var q=/<br.*?>/g,k=[l,this.ellipsis,this.noWrap,this.textLineHeight,this.textOutline,this.fontSize,this.width].join();if(k!==g.textCache){g.textCache=k;delete g.actualWidth;for(k=v.length;k--;)c.removeChild(v[k]);f||this.ellipsis||
this.width||-1!==l.indexOf(" ")&&(!this.noWrap||q.test(l))?""!==l&&(e&&e.appendChild(c),l=new a(l),this.modifyTree(l.nodes),l.addToDOM(g.element),this.modifyDOM(),this.ellipsis&&-1!==(c.textContent||"").indexOf("\u2026")&&g.attr("title",this.unescapeEntities(g.textStr||"",["&lt;","&gt;"])),e&&e.removeChild(c)):c.appendChild(r.createTextNode(this.unescapeEntities(l)));J(this.textOutline)&&g.applyTextOutline&&g.applyTextOutline(this.textOutline)}};m.prototype.modifyDOM=function(){var a=this,c=this.svgElement,
e=x(c.element,"x");c.firstLineMetrics=void 0;for(var l;l=c.element.firstChild;)if(/^[\s\u200B]*$/.test(l.textContent||" "))c.element.removeChild(l);else break;[].forEach.call(c.element.querySelectorAll("tspan.highcharts-br"),function(f,g){f.nextSibling&&f.previousSibling&&(0===g&&1===f.previousSibling.nodeType&&(c.firstLineMetrics=c.renderer.fontMetrics(void 0,f.previousSibling)),x(f,{dy:a.getLineHeight(f.nextSibling),x:e}))});var f=this.width||0;if(f){var v=function(k,g){var l=k.textContent||"",
q=l.replace(/([^\^])-/g,"$1- ").split(" "),v=!a.noWrap&&(1<q.length||1<c.element.childNodes.length),t=a.getLineHeight(g),h=0,d=c.actualWidth;if(a.ellipsis)l&&a.truncate(k,l,void 0,0,Math.max(0,f-parseInt(a.fontSize||12,10)),function(b,d){return b.substring(0,d)+"\u2026"});else if(v){l=[];for(v=[];g.firstChild&&g.firstChild!==k;)v.push(g.firstChild),g.removeChild(g.firstChild);for(;q.length;)q.length&&!a.noWrap&&0<h&&(l.push(k.textContent||""),k.textContent=q.join(" ").replace(/- /g,"-")),a.truncate(k,
void 0,q,0===h?d||0:0,f,function(b,d){return q.slice(0,d).join(" ").replace(/- /g,"-")}),d=c.actualWidth,h++;v.forEach(function(b){g.insertBefore(b,k)});l.forEach(function(b){g.insertBefore(r.createTextNode(b),k);b=r.createElementNS(z,"tspan");b.textContent="\u200b";x(b,{dy:t,x:e});g.insertBefore(b,k)})}},q=function(a){[].slice.call(a.childNodes).forEach(function(e){e.nodeType===Node.TEXT_NODE?v(e,a):(-1!==e.className.baseVal.indexOf("highcharts-br")&&(c.actualWidth=0),q(e))})};q(c.element)}};m.prototype.getLineHeight=
function(a){var c;a=a.nodeType===Node.TEXT_NODE?a.parentElement:a;this.renderer.styledMode||(c=a&&/(px|em)$/.test(a.style.fontSize)?a.style.fontSize:this.fontSize||this.renderer.style.fontSize||12);return this.textLineHeight?parseInt(this.textLineHeight.toString(),10):this.renderer.fontMetrics(c,a||this.svgElement.element).h};m.prototype.modifyTree=function(a){var c=this,e=function(g,f){var l=g.tagName,q=c.renderer.styledMode,k=g.attributes||{};if("b"===l||"strong"===l)q?k["class"]="highcharts-strong":
k.style="font-weight:bold;"+(k.style||"");else if("i"===l||"em"===l)q?k["class"]="highcharts-emphasized":k.style="font-style:italic;"+(k.style||"");J(k.style)&&(k.style=k.style.replace(/(;| |^)color([ :])/,"$1fill$2"));"br"===l&&(k["class"]="highcharts-br",g.textContent="\u200b",(f=a[f+1])&&f.textContent&&(f.textContent=f.textContent.replace(/^ +/gm,"")));"#text"!==l&&"a"!==l&&(g.tagName="tspan");g.attributes=k;g.children&&g.children.filter(function(c){return"#text"!==c.tagName}).forEach(e)};a.forEach(e)};
m.prototype.truncate=function(a,c,e,l,f,v){var g=this.svgElement,k=g.renderer,m=g.rotation,D=[],B=e?1:0,n=(c||e||"").length,t=n,h,d=function(b,d){d=d||b;var h=a.parentNode;if(h&&"undefined"===typeof D[d])if(h.getSubStringLength)try{D[d]=l+h.getSubStringLength(0,e?d+1:d)}catch(L){""}else k.getSpanWidth&&(a.textContent=v(c||e,b),D[d]=l+k.getSpanWidth(g,a));return D[d]};g.rotation=0;var b=d(a.textContent.length);if(l+b>f){for(;B<=n;)t=Math.ceil((B+n)/2),e&&(h=v(e,t)),b=d(t,h&&h.length-1),B===n?B=n+1:
b>f?n=t-1:B=t;0===n?a.textContent="":c&&n===c.length-1||(a.textContent=h||v(c||e,t))}e&&e.splice(0,t);g.actualWidth=b;g.rotation=m};m.prototype.unescapeEntities=function(a,c){u(this.renderer.escapes,function(e,g){c&&-1!==c.indexOf(e)||(a=a.toString().replace(new RegExp(e,"g"),g))});return a};return m}()});M(a,"Core/Renderer/SVG/SVGRenderer.js",[a["Core/Renderer/HTML/AST.js"],a["Core/Color/Color.js"],a["Core/Globals.js"],a["Core/Color/Palette.js"],a["Core/Renderer/RendererRegistry.js"],a["Core/Renderer/SVG/SVGElement.js"],
a["Core/Renderer/SVG/SVGLabel.js"],a["Core/Renderer/SVG/Symbols.js"],a["Core/Renderer/SVG/TextBuilder.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x,J,u,n,m){var g=C.charts,c=C.deg2rad,e=C.doc,l=C.isFirefox,f=C.isMS,v=C.isWebKit,q=C.noop,k=C.SVG_NS,I=C.symbolSizes,D=C.win,B=m.addEvent,r=m.attr,t=m.createElement,h=m.css,d=m.defined,b=m.destroyObjectProperties,p=m.extend,G=m.isArray,y=m.isNumber,L=m.isObject,F=m.isString,P=m.merge,S=m.pick,Q=m.pInt,V=m.uniqueKey,fa;C=function(){function H(b,d,c,
a,h,e,p){this.width=this.url=this.style=this.isSVG=this.imgCount=this.height=this.gradients=this.globalAnimation=this.defs=this.chartIndex=this.cacheKeys=this.cache=this.boxWrapper=this.box=this.alignedObjects=void 0;this.init(b,d,c,a,h,e,p)}H.prototype.init=function(b,d,c,a,p,A,H){var K=this.createElement("svg").attr({version:"1.1","class":"highcharts-root"}),f=K.element;H||K.css(this.getStyle(a));b.appendChild(f);r(b,"dir","ltr");-1===b.innerHTML.indexOf("xmlns")&&r(f,"xmlns",this.SVG_NS);this.isSVG=
!0;this.box=f;this.boxWrapper=K;this.alignedObjects=[];this.url=this.getReferenceURL();this.createElement("desc").add().element.appendChild(e.createTextNode("Created with Highcharts 9.2.2"));this.defs=this.createElement("defs").add();this.allowHTML=A;this.forExport=p;this.styledMode=H;this.gradients={};this.cache={};this.cacheKeys=[];this.imgCount=0;this.setSize(d,c,!1);var k;l&&b.getBoundingClientRect&&(d=function(){h(b,{left:0,top:0});k=b.getBoundingClientRect();h(b,{left:Math.ceil(k.left)-k.left+
"px",top:Math.ceil(k.top)-k.top+"px"})},d(),this.unSubPixelFix=B(D,"resize",d))};H.prototype.definition=function(b){return(new a([b])).addToDOM(this.defs.element)};H.prototype.getReferenceURL=function(){if((l||v)&&e.getElementsByTagName("base").length){if(!d(fa)){var b=V();b=(new a([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:b},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",
width:8,height:8,"clip-path":"url(#"+b+")",fill:"rgba(0,0,0,0.001)"}}]}])).addToDOM(e.body);h(b,{position:"fixed",top:0,left:0,zIndex:9E5});var c=e.elementFromPoint(6,6);fa="hitme"===(c&&c.id);e.body.removeChild(b)}if(fa)return D.location.href.split("#")[0].replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20")}return""};H.prototype.getStyle=function(b){return this.style=p({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},b)};H.prototype.setStyle=
function(b){this.boxWrapper.css(this.getStyle(b))};H.prototype.isHidden=function(){return!this.boxWrapper.getBBox().width};H.prototype.destroy=function(){var d=this.defs;this.box=null;this.boxWrapper=this.boxWrapper.destroy();b(this.gradients||{});this.gradients=null;d&&(this.defs=d.destroy());this.unSubPixelFix&&this.unSubPixelFix();return this.alignedObjects=null};H.prototype.createElement=function(b){var d=new this.Element;d.init(this,b);return d};H.prototype.getRadialAttr=function(b,d){return{cx:b[0]-
b[2]/2+(d.cx||0)*b[2],cy:b[1]-b[2]/2+(d.cy||0)*b[2],r:(d.r||0)*b[2]}};H.prototype.buildText=function(b){(new n(b)).buildSVG()};H.prototype.getContrast=function(b){b=w.parse(b).rgba;b[0]*=1;b[1]*=1.2;b[2]*=.5;return 459<b[0]+b[1]+b[2]?"#000000":"#FFFFFF"};H.prototype.button=function(b,d,c,h,e,A,H,k,g,y){var K=this.label(b,d,c,g,void 0,void 0,y,void 0,"button"),G=this.styledMode,l=0,t=e?P(e):{};b=t&&t.style||{};t=a.filterUserAttributes(t);K.attr(P({padding:8,r:2},t));if(!G){t=P({fill:E.neutralColor3,
stroke:E.neutralColor20,"stroke-width":1,style:{color:E.neutralColor80,cursor:"pointer",fontWeight:"normal"}},{style:b},t);var N=t.style;delete t.style;A=P(t,{fill:E.neutralColor10},a.filterUserAttributes(A||{}));var q=A.style;delete A.style;H=P(t,{fill:E.highlightColor10,style:{color:E.neutralColor100,fontWeight:"bold"}},a.filterUserAttributes(H||{}));var v=H.style;delete H.style;k=P(t,{style:{color:E.neutralColor20}},a.filterUserAttributes(k||{}));var F=k.style;delete k.style}B(K.element,f?"mouseover":
"mouseenter",function(){3!==l&&K.setState(1)});B(K.element,f?"mouseout":"mouseleave",function(){3!==l&&K.setState(l)});K.setState=function(b){1!==b&&(K.state=l=b);K.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][b||0]);G||K.attr([t,A,H,k][b||0]).css([N,q,v,F][b||0])};G||K.attr(t).css(p({cursor:"default"},N));return K.on("touchstart",function(b){return b.stopPropagation()}).on("click",function(b){3!==l&&h.call(K,
b)})};H.prototype.crispLine=function(b,c,a){void 0===a&&(a="round");var h=b[0],e=b[1];d(h[1])&&h[1]===e[1]&&(h[1]=e[1]=Math[a](h[1])-c%2/2);d(h[2])&&h[2]===e[2]&&(h[2]=e[2]=Math[a](h[2])+c%2/2);return b};H.prototype.path=function(b){var d=this.styledMode?{}:{fill:"none"};G(b)?d.d=b:L(b)&&p(d,b);return this.createElement("path").attr(d)};H.prototype.circle=function(b,d,c){b=L(b)?b:"undefined"===typeof b?{}:{x:b,y:d,r:c};d=this.createElement("circle");d.xSetter=d.ySetter=function(b,d,c){c.setAttribute("c"+
d,b)};return d.attr(b)};H.prototype.arc=function(b,d,c,a,h,e){L(b)?(a=b,d=a.y,c=a.r,b=a.x):a={innerR:a,start:h,end:e};b=this.symbol("arc",b,d,c,c,a);b.r=c;return b};H.prototype.rect=function(b,d,c,a,h,e){h=L(b)?b.r:h;var p=this.createElement("rect");b=L(b)?b:"undefined"===typeof b?{}:{x:b,y:d,width:Math.max(c,0),height:Math.max(a,0)};this.styledMode||("undefined"!==typeof e&&(b["stroke-width"]=e,b=p.crisp(b)),b.fill="none");h&&(b.r=h);p.rSetter=function(b,d,c){p.r=b;r(c,{rx:b,ry:b})};p.rGetter=function(){return p.r||
0};return p.attr(b)};H.prototype.setSize=function(b,d,c){this.width=b;this.height=d;this.boxWrapper.animate({width:b,height:d},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:S(c,!0)?void 0:0});this.alignElements()};H.prototype.g=function(b){var d=this.createElement("g");return b?d.attr({"class":"highcharts-"+b}):d};H.prototype.image=function(b,d,c,a,h,e){var A={preserveAspectRatio:"none"},H=function(b,d){b.setAttributeNS?b.setAttributeNS("http://www.w3.org/1999/xlink",
"href",d):b.setAttribute("hc-svg-href",d)};1<arguments.length&&p(A,{x:d,y:c,width:a,height:h});var f=this.createElement("image").attr(A);A=function(d){H(f.element,b);e.call(f,d)};if(e){H(f.element,"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==");var K=new D.Image;B(K,"load",A);K.src=b;K.complete&&A({})}else H(f.element,b);return f};H.prototype.symbol=function(b,c,a,H,f,A){var K=this,k=/^url\((.*?)\)$/,y=k.test(b),G=!y&&(this.symbols[b]?b:"circle"),l=G&&this.symbols[G],
q;if(l){"number"===typeof c&&(q=l.call(this.symbols,Math.round(c||0),Math.round(a||0),H||0,f||0,A));var v=this.path(q);K.styledMode||v.attr("fill","none");p(v,{symbolName:G||void 0,x:c,y:a,width:H,height:f});A&&p(v,A)}else if(y){var F=b.match(k)[1];var m=v=this.image(F);m.imgwidth=S(I[F]&&I[F].width,A&&A.width);m.imgheight=S(I[F]&&I[F].height,A&&A.height);var L=function(b){return b.attr({width:b.width,height:b.height})};["width","height"].forEach(function(b){m[b+"Setter"]=function(b,c){var a=this["img"+
c];this[c]=b;d(a)&&(A&&"within"===A.backgroundSize&&this.width&&this.height&&(a=Math.round(a*Math.min(this.width/this.imgwidth,this.height/this.imgheight))),this.element&&this.element.setAttribute(c,a),this.alignByTranslate||(b=((this[c]||0)-a)/2,this.attr("width"===c?{translateX:b}:{translateY:b})))}});d(c)&&m.attr({x:c,y:a});m.isImg=!0;d(m.imgwidth)&&d(m.imgheight)?L(m):(m.attr({width:0,height:0}),t("img",{onload:function(){var b=g[K.chartIndex];0===this.width&&(h(this,{position:"absolute",top:"-999em"}),
e.body.appendChild(this));I[F]={width:this.width,height:this.height};m.imgwidth=this.width;m.imgheight=this.height;m.element&&L(m);this.parentNode&&this.parentNode.removeChild(this);K.imgCount--;if(!K.imgCount&&b&&!b.hasLoaded)b.onload()},src:F}),this.imgCount++)}return v};H.prototype.clipRect=function(b,d,c,a){var h=V()+"-",e=this.createElement("clipPath").attr({id:h}).add(this.defs);b=this.rect(b,d,c,a,0).add(e);b.id=h;b.clipPath=e;b.count=0;return b};H.prototype.text=function(b,c,a,h){var e={};
if(h&&(this.allowHTML||!this.forExport))return this.html(b,c,a);e.x=Math.round(c||0);a&&(e.y=Math.round(a));d(b)&&(e.text=b);b=this.createElement("text").attr(e);if(!h||this.forExport&&!this.allowHTML)b.xSetter=function(b,d,c){for(var a=c.getElementsByTagName("tspan"),h=c.getAttribute(d),e=0,p;e<a.length;e++)p=a[e],p.getAttribute(d)===h&&p.setAttribute(d,b);c.setAttribute(d,b)};return b};H.prototype.fontMetrics=function(b,d){b=!this.styledMode&&/px/.test(b)||!D.getComputedStyle?b||d&&d.style&&d.style.fontSize||
this.style&&this.style.fontSize:d&&x.prototype.getStyle.call(d,"font-size");b=/px/.test(b)?Q(b):12;d=24>b?b+3:Math.round(1.2*b);return{h:d,b:Math.round(.8*d),f:b}};H.prototype.rotCorr=function(b,d,a){var h=b;d&&a&&(h=Math.max(h*Math.cos(d*c),4));return{x:-b/3*Math.sin(d*c),y:h}};H.prototype.pathToSegments=function(b){for(var d=[],c=[],a={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2},h=0;h<b.length;h++)F(c[0])&&y(b[h])&&c.length===a[c[0].toUpperCase()]&&b.splice(h,0,c[0].replace("M","L").replace("m","l")),
"string"===typeof b[h]&&(c.length&&d.push(c.slice(0)),c.length=0),c.push(b[h]);d.push(c.slice(0));return d};H.prototype.label=function(b,d,c,a,h,e,p,H,f){return new J(this,b,d,c,a,h,e,p,H,f)};H.prototype.alignElements=function(){this.alignedObjects.forEach(function(b){return b.align()})};return H}();p(C.prototype,{Element:x,SVG_NS:k,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:u,draw:q});z.registerRendererType("svg",C,!0);"";return C});M(a,"Core/Renderer/HTML/HTMLElement.js",
[a["Core/Globals.js"],a["Core/Renderer/SVG/SVGElement.js"],a["Core/Utilities.js"]],function(a,w,C){var r=this&&this.__extends||function(){var c=function(a,e){c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,a){c.__proto__=a}||function(c,a){for(var e in a)a.hasOwnProperty(e)&&(c[e]=a[e])};return c(a,e)};return function(a,e){function f(){this.constructor=a}c(a,e);a.prototype=null===e?Object.create(e):(f.prototype=e.prototype,new f)}}(),z=a.isFirefox,x=a.isMS,J=a.isWebKit,u=a.win,
n=C.css,m=C.defined,g=C.extend,c=C.pick,e=C.pInt;return function(a){function f(){return null!==a&&a.apply(this,arguments)||this}r(f,a);f.compose=function(c){if(-1===f.composedClasses.indexOf(c)){f.composedClasses.push(c);var a=f.prototype,e=c.prototype;e.getSpanCorrection=a.getSpanCorrection;e.htmlCss=a.htmlCss;e.htmlGetBBox=a.htmlGetBBox;e.htmlUpdateTransform=a.htmlUpdateTransform;e.setSpanRotation=a.setSpanRotation}return c};f.prototype.getSpanCorrection=function(c,a,e){this.xCorr=-c*e;this.yCorr=
-a};f.prototype.htmlCss=function(a){var e="SPAN"===this.element.tagName&&a&&"width"in a,f=c(e&&a.width,void 0);if(e){delete a.width;this.textWidth=f;var l=!0}a&&"ellipsis"===a.textOverflow&&(a.whiteSpace="nowrap",a.overflow="hidden");this.styles=g(this.styles,a);n(this.element,a);l&&this.htmlUpdateTransform();return this};f.prototype.htmlGetBBox=function(){var c=this.element;return{x:c.offsetLeft,y:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight}};f.prototype.htmlUpdateTransform=function(){if(this.added){var c=
this.renderer,a=this.element,f=this.translateX||0,g=this.translateY||0,l=this.x||0,B=this.y||0,r=this.textAlign||"left",t={left:0,center:.5,right:1}[r],h=this.styles;h=h&&h.whiteSpace;n(a,{marginLeft:f,marginTop:g});!c.styledMode&&this.shadows&&this.shadows.forEach(function(b){n(b,{marginLeft:f+1,marginTop:g+1})});this.inverted&&[].forEach.call(a.childNodes,function(b){c.invertChild(b,a)});if("SPAN"===a.tagName){var d=this.rotation,b=this.textWidth&&e(this.textWidth),p=[d,r,a.innerHTML,this.textWidth,
this.textAlign].join(),G=void 0;(G=b!==this.oldTextWidth)&&!(G=b>this.oldTextWidth)&&((G=this.textPxLength)||(n(a,{width:"",whiteSpace:h||"nowrap"}),G=a.offsetWidth),G=G>b);G&&(/[ \-]/.test(a.textContent||a.innerText)||"ellipsis"===a.style.textOverflow)?(n(a,{width:b+"px",display:"block",whiteSpace:h||"normal"}),this.oldTextWidth=b,this.hasBoxWidthChanged=!0):this.hasBoxWidthChanged=!1;p!==this.cTT&&(G=c.fontMetrics(a.style.fontSize,a).b,!m(d)||d===(this.oldRotation||0)&&r===this.oldAlign||this.setSpanRotation(d,
t,G),this.getSpanCorrection(!m(d)&&this.textPxLength||a.offsetWidth,G,t,d,r));n(a,{left:l+(this.xCorr||0)+"px",top:B+(this.yCorr||0)+"px"});this.cTT=p;this.oldRotation=d;this.oldAlign=r}}else this.alignOnAdd=!0};f.prototype.setSpanRotation=function(c,a,e){var f={},g=x&&!/Edge/.test(u.navigator.userAgent)?"-ms-transform":J?"-webkit-transform":z?"MozTransform":u.opera?"-o-transform":void 0;g&&(f[g]=f.transform="rotate("+c+"deg)",f[g+(z?"Origin":"-origin")]=f.transformOrigin=100*a+"% "+e+"px",n(this.element,
f))};f.composedClasses=[];return f}(w)});M(a,"Core/Renderer/HTML/HTMLRenderer.js",[a["Core/Renderer/HTML/AST.js"],a["Core/Renderer/SVG/SVGElement.js"],a["Core/Renderer/SVG/SVGRenderer.js"],a["Core/Utilities.js"]],function(a,w,C,E){var r=this&&this.__extends||function(){var a=function(g,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])};return a(g,c)};return function(g,c){function e(){this.constructor=
g}a(g,c);g.prototype=null===c?Object.create(c):(e.prototype=c.prototype,new e)}}(),x=E.attr,J=E.createElement,u=E.extend,n=E.pick;return function(m){function g(){return null!==m&&m.apply(this,arguments)||this}r(g,m);g.compose=function(c){-1===g.composedClasses.indexOf(c)&&(g.composedClasses.push(c),c.prototype.html=g.prototype.html);return c};g.prototype.html=function(c,e,g){var f=this.createElement("span"),l=f.element,q=f.renderer,k=q.isSVG,m=function(c,a){["opacity","visibility"].forEach(function(e){c[e+
"Setter"]=function(f,h,d){var b=c.div?c.div.style:a;w.prototype[e+"Setter"].call(this,f,h,d);b&&(b[h]=f)}});c.addedSetters=!0};f.textSetter=function(c){c!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,a.setElementHTML(this.element,n(c,"")),this.textStr=c,f.doTransform=!0)};k&&m(f,f.element.style);f.xSetter=f.ySetter=f.alignSetter=f.rotationSetter=function(c,a){"align"===a?f.alignValue=f.textAlign=c:f[a]=c;f.doTransform=!0};f.afterSetters=function(){this.doTransform&&(this.htmlUpdateTransform(),
this.doTransform=!1)};f.attr({text:c,x:Math.round(e),y:Math.round(g)}).css({position:"absolute"});q.styledMode||f.css({fontFamily:this.style.fontFamily,fontSize:this.style.fontSize});l.style.whiteSpace="nowrap";f.css=f.htmlCss;k&&(f.add=function(c){var a=q.box.parentNode,e=[];if(this.parentGroup=c){var g=c.div;if(!g){for(;c;)e.push(c),c=c.parentGroup;e.reverse().forEach(function(c){function d(b,d){c[d]=b;"translateX"===d?k.left=b+"px":k.top=b+"px";c.doTransform=!0}var b=x(c.element,"class"),h=c.styles||
{};g=c.div=c.div||J("div",b?{className:b}:void 0,{position:"absolute",left:(c.translateX||0)+"px",top:(c.translateY||0)+"px",display:c.display,opacity:c.opacity,cursor:h.cursor,pointerEvents:h.pointerEvents,visibility:c.visibility},g||a);var k=g.style;u(c,{classSetter:function(b){return function(d){this.element.setAttribute("class",d);b.className=d}}(g),on:function(){e[0].div&&f.on.apply({element:e[0].div,onEvents:c.onEvents},arguments);return c},translateXSetter:d,translateYSetter:d});c.addedSetters||
m(c)})}}else g=a;g.appendChild(l);f.added=!0;f.alignOnAdd&&f.htmlUpdateTransform();return f});return f};g.composedClasses=[];return g}(C)});M(a,"Core/Axis/AxisDefaults.js",[a["Core/Color/Palette.js"]],function(a){var r;(function(r){r.defaultXAxisOptions={alignTicks:!0,allowDecimals:void 0,panningEnabled:!0,zIndex:2,zoomEnabled:!0,dateTimeLabelFormats:{millisecond:{main:"%H:%M:%S.%L",range:!1},second:{main:"%H:%M:%S",range:!1},minute:{main:"%H:%M",range:!1},hour:{main:"%H:%M",range:!1},day:{main:"%e. %b"},
week:{main:"%e. %b"},month:{main:"%b '%y"},year:{main:"%Y"}},endOnTick:!1,gridLineDashStyle:"Solid",gridZIndex:1,labels:{autoRotation:void 0,autoRotationLimit:80,distance:void 0,enabled:!0,indentation:10,overflow:"justify",padding:5,reserveSpace:void 0,rotation:void 0,staggerLines:0,step:0,useHTML:!1,x:0,zIndex:7,style:{color:a.neutralColor60,cursor:"default",fontSize:"11px"}},maxPadding:.01,minorGridLineDashStyle:"Solid",minorTickLength:2,minorTickPosition:"outside",minPadding:.01,offset:void 0,
opposite:!1,reversed:void 0,reversedStacks:!1,showEmpty:!0,showFirstLabel:!0,showLastLabel:!0,startOfWeek:1,startOnTick:!1,tickLength:10,tickPixelInterval:100,tickmarkPlacement:"between",tickPosition:"outside",title:{align:"middle",rotation:0,useHTML:!1,x:0,y:0,style:{color:a.neutralColor60}},type:"linear",uniqueNames:!0,visible:!0,minorGridLineColor:a.neutralColor5,minorGridLineWidth:1,minorTickColor:a.neutralColor40,lineColor:a.highlightColor20,lineWidth:1,gridLineColor:a.neutralColor10,gridLineWidth:void 0,
tickColor:a.highlightColor20};r.defaultYAxisOptions={reversedStacks:!0,endOnTick:!0,maxPadding:.05,minPadding:.05,tickPixelInterval:72,showLastLabel:!0,labels:{x:-8},startOnTick:!0,title:{rotation:270,text:"Values"},stackLabels:{animation:{},allowOverlap:!1,enabled:!1,crop:!0,overflow:"justify",formatter:function(){var a=this.axis.chart.numberFormatter;return a(this.total,-1)},style:{color:a.neutralColor100,fontSize:"11px",fontWeight:"bold",textOutline:"1px contrast"}},gridLineWidth:1,lineWidth:0};
r.defaultLeftAxisOptions={labels:{x:-15},title:{rotation:270}};r.defaultRightAxisOptions={labels:{x:15},title:{rotation:90}};r.defaultBottomAxisOptions={labels:{autoRotation:[-45],x:0},margin:15,title:{rotation:0}};r.defaultTopAxisOptions={labels:{autoRotation:[-45],x:0},margin:15,title:{rotation:0}}})(r||(r={}));return r});M(a,"Core/Foundation.js",[a["Core/Utilities.js"]],function(a){var r=a.addEvent,C=a.isFunction,E=a.objectEach,z=a.removeEvent;return{registerEventOptions:function(a,w){a.eventOptions=
a.eventOptions||{};E(w.events,function(u,n){a.eventOptions[n]!==u&&(a.eventOptions[n]&&(z(a,n,a.eventOptions[n]),delete a.eventOptions[n]),C(u)&&(a.eventOptions[n]=u,r(a,n,u)))})}}});M(a,"Core/Axis/Tick.js",[a["Core/FormatUtilities.js"],a["Core/Globals.js"],a["Core/Utilities.js"]],function(a,w,C){var r=w.deg2rad,z=C.clamp,x=C.correctFloat,J=C.defined,u=C.destroyObjectProperties,n=C.extend,m=C.fireEvent,g=C.isNumber,c=C.merge,e=C.objectEach,l=C.pick;w=function(){function f(c,a,e,f,g){this.isNewLabel=
this.isNew=!0;this.axis=c;this.pos=a;this.type=e||"";this.parameters=g||{};this.tickmarkOffset=this.parameters.tickmarkOffset;this.options=this.parameters.options;m(this,"init");e||f||this.addLabel()}f.prototype.addLabel=function(){var c=this,e=c.axis,f=e.options,I=e.chart,D=e.categories,B=e.logarithmic,r=e.names,t=c.pos,h=l(c.options&&c.options.labels,f.labels),d=e.tickPositions,b=t===d[0],p=t===d[d.length-1],G=(!h.step||1===h.step)&&1===e.tickInterval;d=d.info;var y=c.label,L;D=this.parameters.category||
(D?l(D[t],r[t],t):t);B&&g(D)&&(D=x(B.lin2log(D)));if(e.dateTime)if(d){var F=I.time.resolveDTLFormat(f.dateTimeLabelFormats[!f.grid&&d.higherRanks[t]||d.unitName]);var P=F.main}else g(D)&&(P=e.dateTime.getXDateFormat(D,f.dateTimeLabelFormats||{}));c.isFirst=b;c.isLast=p;var S={axis:e,chart:I,dateTimeLabelFormat:P,isFirst:b,isLast:p,pos:t,tick:c,tickPositionInfo:d,value:D};m(this,"labelFormat",S);var Q=function(b){return h.formatter?h.formatter.call(b,b):h.format?(b.text=e.defaultLabelFormatter.call(b),
a.format(h.format,b,I)):e.defaultLabelFormatter.call(b,b)};f=Q.call(S,S);var u=F&&F.list;c.shortenLabel=u?function(){for(L=0;L<u.length;L++)if(n(S,{dateTimeLabelFormat:u[L]}),y.attr({text:Q.call(S,S)}),y.getBBox().width<e.getSlotWidth(c)-2*h.padding)return;y.attr({text:""})}:void 0;G&&e._addedPlotLB&&c.moveLabel(f,h);J(y)||c.movedLabel?y&&y.textStr!==f&&!G&&(!y.textWidth||h.style.width||y.styles.width||y.css({width:null}),y.attr({text:f}),y.textPxLength=y.getBBox().width):(c.label=y=c.createLabel({x:0,
y:0},f,h),c.rotation=0)};f.prototype.createLabel=function(a,e,f){var g=this.axis,k=g.chart;if(a=J(e)&&f.enabled?k.renderer.text(e,a.x,a.y,f.useHTML).add(g.labelGroup):null)k.styledMode||a.css(c(f.style)),a.textPxLength=a.getBBox().width;return a};f.prototype.destroy=function(){u(this,this.axis)};f.prototype.getPosition=function(c,a,e,f){var g=this.axis,k=g.chart,l=f&&k.oldChartHeight||k.chartHeight;c={x:c?x(g.translate(a+e,null,null,f)+g.transB):g.left+g.offset+(g.opposite?(f&&k.oldChartWidth||k.chartWidth)-
g.right-g.left:0),y:c?l-g.bottom+g.offset-(g.opposite?g.height:0):x(l-g.translate(a+e,null,null,f)-g.transB)};c.y=z(c.y,-1E5,1E5);m(this,"afterGetPosition",{pos:c});return c};f.prototype.getLabelPosition=function(c,a,e,f,g,l,n,t){var h=this.axis,d=h.transA,b=h.isLinked&&h.linkedParent?h.linkedParent.reversed:h.reversed,p=h.staggerLines,k=h.tickRotCorr||{x:0,y:0},y=f||h.reserveSpaceDefault?0:-h.labelOffset*("center"===h.labelAlign?.5:1),q={},F=g.y;J(F)||(F=0===h.side?e.rotation?-8:-e.getBBox().height:
2===h.side?k.y+8:Math.cos(e.rotation*r)*(k.y-e.getBBox(!1,0).height/2));c=c+g.x+y+k.x-(l&&f?l*d*(b?-1:1):0);a=a+F-(l&&!f?l*d*(b?1:-1):0);p&&(e=n/(t||1)%p,h.opposite&&(e=p-e-1),a+=h.labelOffset/p*e);q.x=c;q.y=Math.round(a);m(this,"afterGetLabelPosition",{pos:q,tickmarkOffset:l,index:n});return q};f.prototype.getLabelSize=function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0};f.prototype.getMarkPath=function(c,a,e,f,g,l){return l.crispLine([["M",c,a],["L",c+(g?0:-e),
a+(g?e:0)]],f)};f.prototype.handleOverflow=function(c){var a=this.axis,e=a.options.labels,f=c.x,g=a.chart.chartWidth,m=a.chart.spacing,v=l(a.labelLeft,Math.min(a.pos,m[3]));m=l(a.labelRight,Math.max(a.isRadial?0:a.pos+a.len,g-m[1]));var t=this.label,h=this.rotation,d={left:0,center:.5,right:1}[a.labelAlign||t.attr("align")],b=t.getBBox().width,p=a.getSlotWidth(this),G={},y=p,L=1,F;if(h||"justify"!==e.overflow)0>h&&f-d*b<v?F=Math.round(f/Math.cos(h*r)-v):0<h&&f+d*b>m&&(F=Math.round((g-f)/Math.cos(h*
r)));else if(g=f+(1-d)*b,f-d*b<v?y=c.x+y*(1-d)-v:g>m&&(y=m-c.x+y*d,L=-1),y=Math.min(p,y),y<p&&"center"===a.labelAlign&&(c.x+=L*(p-y-d*(p-Math.min(b,y)))),b>y||a.autoRotation&&(t.styles||{}).width)F=y;F&&(this.shortenLabel?this.shortenLabel():(G.width=Math.floor(F)+"px",(e.style||{}).textOverflow||(G.textOverflow="ellipsis"),t.css(G)))};f.prototype.moveLabel=function(c,a){var f=this,g=f.label,l=f.axis,m=l.reversed,q=!1;g&&g.textStr===c?(f.movedLabel=g,q=!0,delete f.label):e(l.ticks,function(a){q||
a.isNew||a===f||!a.label||a.label.textStr!==c||(f.movedLabel=a.label,q=!0,a.labelPos=f.movedLabel.xy,delete a.label)});if(!q&&(f.labelPos||g)){var t=f.labelPos||g.xy;g=l.horiz?m?0:l.width+l.left:t.x;l=l.horiz?t.y:m?l.width+l.left:0;f.movedLabel=f.createLabel({x:g,y:l},c,a);f.movedLabel&&f.movedLabel.attr({opacity:0})}};f.prototype.render=function(a,c,e){var f=this.axis,g=f.horiz,k=this.pos,q=l(this.tickmarkOffset,f.tickmarkOffset);k=this.getPosition(g,k,q,c);q=k.x;var t=k.y;f=g&&q===f.pos+f.len||
!g&&t===f.pos?-1:1;g=l(e,this.label&&this.label.newOpacity,1);e=l(e,1);this.isActive=!0;this.renderGridLine(c,e,f);this.renderMark(k,e,f);this.renderLabel(k,c,g,a);this.isNew=!1;m(this,"afterRender")};f.prototype.renderGridLine=function(c,a,e){var f=this.axis,g=f.options,k={},m=this.pos,t=this.type,h=l(this.tickmarkOffset,f.tickmarkOffset),d=f.chart.renderer,b=this.gridLine,p=g.gridLineWidth,G=g.gridLineColor,y=g.gridLineDashStyle;"minor"===this.type&&(p=g.minorGridLineWidth,G=g.minorGridLineColor,
y=g.minorGridLineDashStyle);b||(f.chart.styledMode||(k.stroke=G,k["stroke-width"]=p||0,k.dashstyle=y),t||(k.zIndex=1),c&&(a=0),this.gridLine=b=d.path().attr(k).addClass("highcharts-"+(t?t+"-":"")+"grid-line").add(f.gridGroup));if(b&&(e=f.getPlotLinePath({value:m+h,lineWidth:b.strokeWidth()*e,force:"pass",old:c})))b[c||this.isNew?"attr":"animate"]({d:e,opacity:a})};f.prototype.renderMark=function(c,a,e){var f=this.axis,g=f.options,k=f.chart.renderer,m=this.type,t=f.tickSize(m?m+"Tick":"tick"),h=c.x;
c=c.y;var d=l(g["minor"!==m?"tickWidth":"minorTickWidth"],!m&&f.isXAxis?1:0);g=g["minor"!==m?"tickColor":"minorTickColor"];var b=this.mark,p=!b;t&&(f.opposite&&(t[0]=-t[0]),b||(this.mark=b=k.path().addClass("highcharts-"+(m?m+"-":"")+"tick").add(f.axisGroup),f.chart.styledMode||b.attr({stroke:g,"stroke-width":d})),b[p?"attr":"animate"]({d:this.getMarkPath(h,c,t[0],b.strokeWidth()*e,f.horiz,k),opacity:a}))};f.prototype.renderLabel=function(c,a,e,f){var k=this.axis,m=k.horiz,q=k.options,t=this.label,
h=q.labels,d=h.step;k=l(this.tickmarkOffset,k.tickmarkOffset);var b=c.x;c=c.y;var p=!0;t&&g(b)&&(t.xy=c=this.getLabelPosition(b,c,t,m,h,k,f,d),this.isFirst&&!this.isLast&&!q.showFirstLabel||this.isLast&&!this.isFirst&&!q.showLastLabel?p=!1:!m||h.step||h.rotation||a||0===e||this.handleOverflow(c),d&&f%d&&(p=!1),p&&g(c.y)?(c.opacity=e,t[this.isNewLabel?"attr":"animate"](c),this.isNewLabel=!1):(t.attr("y",-9999),this.isNewLabel=!0))};f.prototype.replaceMovedLabel=function(){var c=this.label,a=this.axis,
e=a.reversed;if(c&&!this.isNew){var f=a.horiz?e?a.left:a.width+a.left:c.xy.x;e=a.horiz?c.xy.y:e?a.width+a.top:a.top;c.animate({x:f,y:e,opacity:0},void 0,c.destroy);delete this.label}a.isDirty=!0;this.label=this.movedLabel;delete this.movedLabel};return f}();"";return w});M(a,"Core/Axis/Axis.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/Axis/AxisDefaults.js"],a["Core/Color/Color.js"],a["Core/Color/Palette.js"],a["Core/DefaultOptions.js"],a["Core/Foundation.js"],a["Core/Globals.js"],a["Core/Axis/Tick.js"],
a["Core/Utilities.js"]],function(a,w,C,E,z,x,J,u,n){var m=a.animObject,g=z.defaultOptions,c=x.registerEventOptions,e=J.deg2rad,l=n.arrayMax,f=n.arrayMin,v=n.clamp,q=n.correctFloat,k=n.defined,r=n.destroyObjectProperties,D=n.erase,B=n.error,O=n.extend,t=n.fireEvent,h=n.getMagnitude,d=n.isArray,b=n.isNumber,p=n.isString,G=n.merge,y=n.normalizeTickInterval,L=n.objectEach,F=n.pick,P=n.relativeLength,S=n.removeEvent,Q=n.splat,V=n.syncTimeout;a=function(){function a(b,a){this.zoomEnabled=this.width=this.visible=
this.userOptions=this.translationSlope=this.transB=this.transA=this.top=this.ticks=this.tickRotCorr=this.tickPositions=this.tickmarkOffset=this.tickInterval=this.tickAmount=this.side=this.series=this.right=this.positiveValuesOnly=this.pos=this.pointRangePadding=this.pointRange=this.plotLinesAndBandsGroups=this.plotLinesAndBands=this.paddedTicks=this.overlap=this.options=this.offset=this.names=this.minPixelPadding=this.minorTicks=this.minorTickInterval=this.min=this.maxLabelLength=this.max=this.len=
this.left=this.labelFormatter=this.labelEdge=this.isLinked=this.height=this.hasVisibleSeries=this.hasNames=this.eventOptions=this.coll=this.closestPointRange=this.chart=this.categories=this.bottom=this.alternateBands=void 0;this.init(b,a)}a.prototype.init=function(a,d){var h=d.isX;this.chart=a;this.horiz=a.inverted&&!this.isZAxis?!h:h;this.isXAxis=h;this.coll=this.coll||(h?"xAxis":"yAxis");t(this,"init",{userOptions:d});this.opposite=F(d.opposite,this.opposite);this.side=F(d.side,this.side,this.horiz?
this.opposite?0:2:this.opposite?1:3);this.setOptions(d);var e=this.options,f=e.labels,p=e.type;this.userOptions=d;this.minPixelPadding=0;this.reversed=F(e.reversed,this.reversed);this.visible=e.visible;this.zoomEnabled=e.zoomEnabled;this.hasNames="category"===p||!0===e.categories;this.categories=e.categories||this.hasNames;this.names||(this.names=[],this.names.keys={});this.plotLinesAndBandsGroups={};this.positiveValuesOnly=!!this.logarithmic;this.isLinked=k(e.linkedTo);this.ticks={};this.labelEdge=
[];this.minorTicks={};this.plotLinesAndBands=[];this.alternateBands={};this.len=0;this.minRange=this.userMinRange=e.minRange||e.maxZoom;this.range=e.range;this.offset=e.offset||0;this.min=this.max=null;d=F(e.crosshair,Q(a.options.tooltip.crosshairs)[h?0:1]);this.crosshair=!0===d?{}:d;-1===a.axes.indexOf(this)&&(h?a.axes.splice(a.xAxis.length,0,this):a.axes.push(this),a[this.coll].push(this));this.series=this.series||[];a.inverted&&!this.isZAxis&&h&&"undefined"===typeof this.reversed&&(this.reversed=
!0);this.labelRotation=b(f.rotation)?f.rotation:void 0;c(this,e);t(this,"afterInit")};a.prototype.setOptions=function(b){this.options=G(w.defaultXAxisOptions,"yAxis"===this.coll&&w.defaultYAxisOptions,[w.defaultTopAxisOptions,w.defaultRightAxisOptions,w.defaultBottomAxisOptions,w.defaultLeftAxisOptions][this.side],G(g[this.coll],b));t(this,"afterSetOptions",{userOptions:b})};a.prototype.defaultLabelFormatter=function(a){var d=this.axis;a=this.chart.numberFormatter;var c=b(this.value)?this.value:NaN,
e=d.chart.time,h=this.dateTimeLabelFormat,f=g.lang,p=f.numericSymbols;f=f.numericSymbolMagnitude||1E3;var H=d.logarithmic?Math.abs(c):d.tickInterval,y=p&&p.length;if(d.categories)var k=""+this.value;else if(h)k=e.dateFormat(h,c);else if(y&&1E3<=H)for(;y--&&"undefined"===typeof k;)d=Math.pow(f,y+1),H>=d&&0===10*c%d&&null!==p[y]&&0!==c&&(k=a(c/d,-1)+p[y]);"undefined"===typeof k&&(k=1E4<=Math.abs(c)?a(c,-1):a(c,-1,void 0,""));return k};a.prototype.getSeriesExtremes=function(){var a=this,d=a.chart,c;
t(this,"getSeriesExtremes",null,function(){a.hasVisibleSeries=!1;a.dataMin=a.dataMax=a.threshold=null;a.softThreshold=!a.isXAxis;a.stacking&&a.stacking.buildStacks();a.series.forEach(function(e){if(e.visible||!d.options.chart.ignoreHiddenSeries){var h=e.options,f=h.threshold;a.hasVisibleSeries=!0;a.positiveValuesOnly&&0>=f&&(f=null);if(a.isXAxis){if(h=e.xData,h.length){h=a.logarithmic?h.filter(a.validatePositiveValue):h;c=e.getXExtremes(h);var p=c.min;var g=c.max;b(p)||p instanceof Date||(h=h.filter(b),
c=e.getXExtremes(h),p=c.min,g=c.max);h.length&&(a.dataMin=Math.min(F(a.dataMin,p),p),a.dataMax=Math.max(F(a.dataMax,g),g))}}else if(e=e.applyExtremes(),b(e.dataMin)&&(p=e.dataMin,a.dataMin=Math.min(F(a.dataMin,p),p)),b(e.dataMax)&&(g=e.dataMax,a.dataMax=Math.max(F(a.dataMax,g),g)),k(f)&&(a.threshold=f),!h.softThreshold||a.positiveValuesOnly)a.softThreshold=!1}})});t(this,"afterGetSeriesExtremes")};a.prototype.translate=function(a,d,c,e,h,f){var p=this.linkedParent||this,g=e&&p.old?p.old.min:p.min,
H=p.minPixelPadding;h=(p.isOrdinal||p.brokenAxis&&p.brokenAxis.hasBreaks||p.logarithmic&&h)&&p.lin2val;var K=1,y=0;e=e&&p.old?p.old.transA:p.transA;e||(e=p.transA);c&&(K*=-1,y=p.len);p.reversed&&(K*=-1,y-=K*(p.sector||p.len));d?(a=(a*K+y-H)/e+g,h&&(a=p.lin2val(a))):(h&&(a=p.val2lin(a)),a=b(g)?K*(a-g)*e+y+K*H+(b(f)?e*f:0):void 0);return a};a.prototype.toPixels=function(b,a){return this.translate(b,!1,!this.horiz,null,!0)+(a?0:this.pos)};a.prototype.toValue=function(b,a){return this.translate(b-(a?
0:this.pos),!0,!this.horiz,null,!0)};a.prototype.getPlotLinePath=function(a){function d(b,a,d){if("pass"!==m&&b<a||b>d)m?b=v(b,a,d):r=!0;return b}var c=this,e=c.chart,h=c.left,f=c.top,p=a.old,g=a.value,H=a.lineWidth,y=p&&e.oldChartHeight||e.chartHeight,k=p&&e.oldChartWidth||e.chartWidth,G=c.transB,l=a.translatedValue,m=a.force,L,q,n,B,r;a={value:g,lineWidth:H,old:p,force:m,acrossPanes:a.acrossPanes,translatedValue:l};t(this,"getPlotLinePath",a,function(a){l=F(l,c.translate(g,null,null,p));l=v(l,-1E5,
1E5);L=n=Math.round(l+G);q=B=Math.round(y-l-G);b(l)?c.horiz?(q=f,B=y-c.bottom,L=n=d(L,h,h+c.width)):(L=h,n=k-c.right,q=B=d(q,f,f+c.height)):(r=!0,m=!1);a.path=r&&!m?null:e.renderer.crispLine([["M",L,q],["L",n,B]],H||1)});return a.path};a.prototype.getLinearTickPositions=function(b,a,d){var c=q(Math.floor(a/b)*b);d=q(Math.ceil(d/b)*b);var e=[],h;q(c+b)===c&&(h=20);if(this.single)return[a];for(a=c;a<=d;){e.push(a);a=q(a+b,h);if(a===f)break;var f=a}return e};a.prototype.getMinorTickInterval=function(){var b=
this.options;return!0===b.minorTicks?F(b.minorTickInterval,"auto"):!1===b.minorTicks?null:b.minorTickInterval};a.prototype.getMinorTickPositions=function(){var b=this.options,a=this.tickPositions,d=this.minorTickInterval,c=this.pointRangePadding||0,e=this.min-c;c=this.max+c;var h=c-e,f=[];if(h&&h/d<this.len/3){var p=this.logarithmic;if(p)this.paddedTicks.forEach(function(b,a,c){a&&f.push.apply(f,p.getLogTickPositions(d,c[a-1],c[a],!0))});else if(this.dateTime&&"auto"===this.getMinorTickInterval())f=
f.concat(this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(d),e,c,b.startOfWeek));else for(b=e+(a[0]-e)%d;b<=c&&b!==f[0];b+=d)f.push(b)}0!==f.length&&this.trimTicks(f);return f};a.prototype.adjustForMinRange=function(){var b=this.options,a=this.logarithmic,d=this.min,c=this.max,e=0,h,p,g,y;this.isXAxis&&"undefined"===typeof this.minRange&&!a&&(k(b.min)||k(b.max)?this.minRange=null:(this.series.forEach(function(b){g=b.xData;y=b.xIncrement?1:g.length-1;if(1<g.length)for(h=y;0<h;h--)if(p=g[h]-
g[h-1],!e||p<e)e=p}),this.minRange=Math.min(5*e,this.dataMax-this.dataMin)));if(c-d<this.minRange){var G=this.dataMax-this.dataMin>=this.minRange;var t=this.minRange;var m=(t-c+d)/2;m=[d-m,F(b.min,d-m)];G&&(m[2]=this.logarithmic?this.logarithmic.log2lin(this.dataMin):this.dataMin);d=l(m);c=[d+t,F(b.max,d+t)];G&&(c[2]=a?a.log2lin(this.dataMax):this.dataMax);c=f(c);c-d<t&&(m[0]=c-t,m[1]=F(b.min,c-t),d=l(m))}this.min=d;this.max=c};a.prototype.getClosest=function(){var b;this.categories?b=1:this.series.forEach(function(a){var d=
a.closestPointRange,c=a.visible||!a.chart.options.chart.ignoreHiddenSeries;!a.noSharedTooltip&&k(d)&&c&&(b=k(b)?Math.min(b,d):d)});return b};a.prototype.nameToX=function(b){var a=d(this.categories),c=a?this.categories:this.names,e=b.options.x;b.series.requireSorting=!1;k(e)||(e=this.options.uniqueNames?a?c.indexOf(b.name):F(c.keys[b.name],-1):b.series.autoIncrement());if(-1===e){if(!a)var h=c.length}else h=e;"undefined"!==typeof h&&(this.names[h]=b.name,this.names.keys[b.name]=h);return h};a.prototype.updateNames=
function(){var b=this,a=this.names;0<a.length&&(Object.keys(a.keys).forEach(function(b){delete a.keys[b]}),a.length=0,this.minRange=this.userMinRange,(this.series||[]).forEach(function(a){a.xIncrement=null;if(!a.points||a.isDirtyData)b.max=Math.max(b.max,a.xData.length-1),a.processData(),a.generatePoints();a.data.forEach(function(d,c){if(d&&d.options&&"undefined"!==typeof d.name){var e=b.nameToX(d);"undefined"!==typeof e&&e!==d.x&&(d.x=e,a.xData[c]=e)}})}))};a.prototype.setAxisTranslation=function(){var b=
this,a=b.max-b.min,d=b.linkedParent,c=!!b.categories,e=b.isXAxis,h=b.axisPointRange||0,f=0,g=0,y=b.transA;if(e||c||h){var k=b.getClosest();d?(f=d.minPointOffset,g=d.pointRangePadding):b.series.forEach(function(a){var d=c?1:e?F(a.options.pointRange,k,0):b.axisPointRange||0,A=a.options.pointPlacement;h=Math.max(h,d);if(!b.single||c)a=a.is("xrange")?!e:e,f=Math.max(f,a&&p(A)?0:d/2),g=Math.max(g,a&&"on"===A?0:d)});d=b.ordinal&&b.ordinal.slope&&k?b.ordinal.slope/k:1;b.minPointOffset=f*=d;b.pointRangePadding=
g*=d;b.pointRange=Math.min(h,b.single&&c?1:a);e&&(b.closestPointRange=k)}b.translationSlope=b.transA=y=b.staticScale||b.len/(a+g||1);b.transB=b.horiz?b.left:b.bottom;b.minPixelPadding=y*f;t(this,"afterSetAxisTranslation")};a.prototype.minFromRange=function(){return this.max-this.range};a.prototype.setTickInterval=function(a){var d=this,c=d.chart,e=d.logarithmic,f=d.options,p=d.isXAxis,g=d.isLinked,l=f.tickPixelInterval,G=d.categories,H=d.softThreshold,m=f.maxPadding,L=f.minPadding,n=f.tickInterval,
v=b(d.threshold)?d.threshold:null;d.dateTime||G||g||this.getTickAmount();var r=F(d.userMin,f.min);var P=F(d.userMax,f.max);if(g){d.linkedParent=c[d.coll][f.linkedTo];var D=d.linkedParent.getExtremes();d.min=F(D.min,D.dataMin);d.max=F(D.max,D.dataMax);f.type!==d.linkedParent.options.type&&B(11,1,c)}else{if(H&&k(v))if(d.dataMin>=v)D=v,L=0;else if(d.dataMax<=v){var I=v;m=0}d.min=F(r,D,d.dataMin);d.max=F(P,I,d.dataMax)}e&&(d.positiveValuesOnly&&!a&&0>=Math.min(d.min,F(d.dataMin,d.min))&&B(10,1,c),d.min=
q(e.log2lin(d.min),16),d.max=q(e.log2lin(d.max),16));d.range&&k(d.max)&&(d.userMin=d.min=r=Math.max(d.dataMin,d.minFromRange()),d.userMax=P=d.max,d.range=null);t(d,"foundExtremes");d.beforePadding&&d.beforePadding();d.adjustForMinRange();!(G||d.axisPointRange||d.stacking&&d.stacking.usePercentage||g)&&k(d.min)&&k(d.max)&&(c=d.max-d.min)&&(!k(r)&&L&&(d.min-=c*L),!k(P)&&m&&(d.max+=c*m));b(d.userMin)||(b(f.softMin)&&f.softMin<d.min&&(d.min=r=f.softMin),b(f.floor)&&(d.min=Math.max(d.min,f.floor)));b(d.userMax)||
(b(f.softMax)&&f.softMax>d.max&&(d.max=P=f.softMax),b(f.ceiling)&&(d.max=Math.min(d.max,f.ceiling)));H&&k(d.dataMin)&&(v=v||0,!k(r)&&d.min<v&&d.dataMin>=v?d.min=d.options.minRange?Math.min(v,d.max-d.minRange):v:!k(P)&&d.max>v&&d.dataMax<=v&&(d.max=d.options.minRange?Math.max(v,d.min+d.minRange):v));b(d.min)&&b(d.max)&&!this.chart.polar&&d.min>d.max&&(k(d.options.min)?d.max=d.min:k(d.options.max)&&(d.min=d.max));d.tickInterval=d.min===d.max||"undefined"===typeof d.min||"undefined"===typeof d.max?1:
g&&d.linkedParent&&!n&&l===d.linkedParent.options.tickPixelInterval?n=d.linkedParent.tickInterval:F(n,this.tickAmount?(d.max-d.min)/Math.max(this.tickAmount-1,1):void 0,G?1:(d.max-d.min)*l/Math.max(d.len,l));p&&!a&&(d.series.forEach(function(b){b.forceCrop=b.forceCropping&&b.forceCropping();b.processData(d.min!==(d.old&&d.old.min)||d.max!==(d.old&&d.old.max))}),t(this,"postProcessData"));d.setAxisTranslation();t(this,"initialAxisTranslation");d.pointRange&&!n&&(d.tickInterval=Math.max(d.pointRange,
d.tickInterval));a=F(f.minTickInterval,d.dateTime&&!d.series.some(function(b){return b.noSharedTooltip})?d.closestPointRange:0);!n&&d.tickInterval<a&&(d.tickInterval=a);d.dateTime||d.logarithmic||n||(d.tickInterval=y(d.tickInterval,void 0,h(d.tickInterval),F(f.allowDecimals,.5>d.tickInterval||void 0!==this.tickAmount),!!this.tickAmount));this.tickAmount||(d.tickInterval=d.unsquish());this.setTickPositions()};a.prototype.setTickPositions=function(){var b=this.options,d=b.tickPositions,a=this.getMinorTickInterval(),
c=this.hasVerticalPanning(),e="colorAxis"===this.coll,h=(e||!c)&&b.startOnTick;c=(e||!c)&&b.endOnTick;e=b.tickPositioner;this.tickmarkOffset=this.categories&&"between"===b.tickmarkPlacement&&1===this.tickInterval?.5:0;this.minorTickInterval="auto"===a&&this.tickInterval?this.tickInterval/5:a;this.single=this.min===this.max&&k(this.min)&&!this.tickAmount&&(parseInt(this.min,10)===this.min||!1!==b.allowDecimals);this.tickPositions=a=d&&d.slice();!a&&(this.ordinal&&this.ordinal.positions||!((this.max-
this.min)/this.tickInterval>Math.max(2*this.len,200))?a=this.dateTime?this.getTimeTicks(this.dateTime.normalizeTimeTickInterval(this.tickInterval,b.units),this.min,this.max,b.startOfWeek,this.ordinal&&this.ordinal.positions,this.closestPointRange,!0):this.logarithmic?this.logarithmic.getLogTickPositions(this.tickInterval,this.min,this.max):this.getLinearTickPositions(this.tickInterval,this.min,this.max):(a=[this.min,this.max],B(19,!1,this.chart)),a.length>this.len&&(a=[a[0],a.pop()],a[0]===a[1]&&
(a.length=1)),this.tickPositions=a,e&&(e=e.apply(this,[this.min,this.max])))&&(this.tickPositions=a=e);this.paddedTicks=a.slice(0);this.trimTicks(a,h,c);this.isLinked||(this.single&&2>a.length&&!this.categories&&!this.series.some(function(b){return b.is("heatmap")&&"between"===b.options.pointPlacement})&&(this.min-=.5,this.max+=.5),d||e||this.adjustTickAmount());t(this,"afterSetTickPositions")};a.prototype.trimTicks=function(b,d,a){var c=b[0],e=b[b.length-1],h=!this.isOrdinal&&this.minPointOffset||
0;t(this,"trimTicks");if(!this.isLinked){if(d&&-Infinity!==c)this.min=c;else for(;this.min-h>b[0];)b.shift();if(a)this.max=e;else for(;this.max+h<b[b.length-1];)b.pop();0===b.length&&k(c)&&!this.options.tickPositions&&b.push((e+c)/2)}};a.prototype.alignToOthers=function(){var b={},d=this.options,a;!1!==this.chart.options.chart.alignTicks&&d.alignTicks&&!1!==d.startOnTick&&!1!==d.endOnTick&&!this.logarithmic&&this.chart[this.coll].forEach(function(d){var c=d.options;c=[d.horiz?c.left:c.top,c.width,
c.height,c.pane].join();d.series.length&&(b[c]?a=!0:b[c]=1)});return a};a.prototype.getTickAmount=function(){var b=this.options,d=b.tickPixelInterval,a=b.tickAmount;!k(b.tickInterval)&&!a&&this.len<d&&!this.isRadial&&!this.logarithmic&&b.startOnTick&&b.endOnTick&&(a=2);!a&&this.alignToOthers()&&(a=Math.ceil(this.len/d)+1);4>a&&(this.finalTickAmt=a,a=5);this.tickAmount=a};a.prototype.adjustTickAmount=function(){var d=this.options,a=this.tickInterval,c=this.tickPositions,e=this.tickAmount,h=this.finalTickAmt,
f=c&&c.length,p=F(this.threshold,this.softThreshold?0:null);if(this.hasData()&&b(this.min)&&b(this.max)){if(f<e){for(;c.length<e;)c.length%2||this.min===p?c.push(q(c[c.length-1]+a)):c.unshift(q(c[0]-a));this.transA*=(f-1)/(e-1);this.min=d.startOnTick?c[0]:Math.min(this.min,c[0]);this.max=d.endOnTick?c[c.length-1]:Math.max(this.max,c[c.length-1])}else f>e&&(this.tickInterval*=2,this.setTickPositions());if(k(h)){for(a=d=c.length;a--;)(3===h&&1===a%2||2>=h&&0<a&&a<d-1)&&c.splice(a,1);this.finalTickAmt=
void 0}}};a.prototype.setScale=function(){var b=!1,d=!1;this.series.forEach(function(a){b=b||a.isDirtyData||a.isDirty;d=d||a.xAxis&&a.xAxis.isDirty||!1});this.setAxisSize();var a=this.len!==(this.old&&this.old.len);a||b||d||this.isLinked||this.forceRedraw||this.userMin!==(this.old&&this.old.userMin)||this.userMax!==(this.old&&this.old.userMax)||this.alignToOthers()?(this.stacking&&this.stacking.resetStacks(),this.forceRedraw=!1,this.getSeriesExtremes(),this.setTickInterval(),this.isDirty||(this.isDirty=
a||this.min!==(this.old&&this.old.min)||this.max!==(this.old&&this.old.max))):this.stacking&&this.stacking.cleanStacks();b&&this.panningState&&(this.panningState.isDirty=!0);t(this,"afterSetScale")};a.prototype.setExtremes=function(b,d,a,c,e){var h=this,f=h.chart;a=F(a,!0);h.series.forEach(function(b){delete b.kdTree});e=O(e,{min:b,max:d});t(h,"setExtremes",e,function(){h.userMin=b;h.userMax=d;h.eventArgs=e;a&&f.redraw(c)})};a.prototype.zoom=function(b,d){var a=this,c=this.dataMin,e=this.dataMax,
h=this.options,f=Math.min(c,F(h.min,c)),p=Math.max(e,F(h.max,e));b={newMin:b,newMax:d};t(this,"zoom",b,function(b){var d=b.newMin,h=b.newMax;if(d!==a.min||h!==a.max)a.allowZoomOutside||(k(c)&&(d<f&&(d=f),d>p&&(d=p)),k(e)&&(h<f&&(h=f),h>p&&(h=p))),a.displayBtn="undefined"!==typeof d||"undefined"!==typeof h,a.setExtremes(d,h,!1,void 0,{trigger:"zoom"});b.zoomed=!0});return b.zoomed};a.prototype.setAxisSize=function(){var b=this.chart,d=this.options,a=d.offsets||[0,0,0,0],c=this.horiz,e=this.width=Math.round(P(F(d.width,
b.plotWidth-a[3]+a[1]),b.plotWidth)),h=this.height=Math.round(P(F(d.height,b.plotHeight-a[0]+a[2]),b.plotHeight)),f=this.top=Math.round(P(F(d.top,b.plotTop+a[0]),b.plotHeight,b.plotTop));d=this.left=Math.round(P(F(d.left,b.plotLeft+a[3]),b.plotWidth,b.plotLeft));this.bottom=b.chartHeight-h-f;this.right=b.chartWidth-e-d;this.len=Math.max(c?e:h,0);this.pos=c?d:f};a.prototype.getExtremes=function(){var b=this.logarithmic;return{min:b?q(b.lin2log(this.min)):this.min,max:b?q(b.lin2log(this.max)):this.max,
dataMin:this.dataMin,dataMax:this.dataMax,userMin:this.userMin,userMax:this.userMax}};a.prototype.getThreshold=function(b){var d=this.logarithmic,a=d?d.lin2log(this.min):this.min;d=d?d.lin2log(this.max):this.max;null===b||-Infinity===b?b=a:Infinity===b?b=d:a>b?b=a:d<b&&(b=d);return this.translate(b,0,1,0,1)};a.prototype.autoLabelAlign=function(b){var d=(F(b,0)-90*this.side+720)%360;b={align:"center"};t(this,"autoLabelAlign",b,function(b){15<d&&165>d?b.align="right":195<d&&345>d&&(b.align="left")});
return b.align};a.prototype.tickSize=function(b){var d=this.options,a=F(d["tick"===b?"tickWidth":"minorTickWidth"],"tick"===b&&this.isXAxis&&!this.categories?1:0),c=d["tick"===b?"tickLength":"minorTickLength"];if(a&&c){"inside"===d[b+"Position"]&&(c=-c);var e=[c,a]}b={tickSize:e};t(this,"afterTickSize",b);return b.tickSize};a.prototype.labelMetrics=function(){var b=this.tickPositions&&this.tickPositions[0]||0;return this.chart.renderer.fontMetrics(this.options.labels.style.fontSize,this.ticks[b]&&
this.ticks[b].label)};a.prototype.unsquish=function(){var d=this.options.labels,a=this.horiz,c=this.tickInterval,h=this.len/(((this.categories?1:0)+this.max-this.min)/c),f=d.rotation,p=this.labelMetrics(),g=Math.max(this.max-this.min,0),y=function(b){var d=b/(h||1);d=1<d?Math.ceil(d):1;d*c>g&&Infinity!==b&&Infinity!==h&&g&&(d=Math.ceil(g/c));return q(d*c)},k=c,l,G,t=Number.MAX_VALUE;if(a){if(!d.staggerLines&&!d.step)if(b(f))var m=[f];else h<d.autoRotationLimit&&(m=d.autoRotation);m&&m.forEach(function(b){if(b===
f||b&&-90<=b&&90>=b){G=y(Math.abs(p.h/Math.sin(e*b)));var d=G+Math.abs(b/360);d<t&&(t=d,l=b,k=G)}})}else d.step||(k=y(p.h));this.autoRotation=m;this.labelRotation=F(l,b(f)?f:0);return k};a.prototype.getSlotWidth=function(d){var a=this.chart,c=this.horiz,e=this.options.labels,h=Math.max(this.tickPositions.length-(this.categories?0:1),1),f=a.margin[3];if(d&&b(d.slotWidth))return d.slotWidth;if(c&&2>e.step)return e.rotation?0:(this.staggerLines||1)*this.len/h;if(!c){d=e.style.width;if(void 0!==d)return parseInt(String(d),
10);if(f)return f-a.spacing[3]}return.33*a.chartWidth};a.prototype.renderUnsquish=function(){var b=this.chart,d=b.renderer,a=this.tickPositions,c=this.ticks,e=this.options.labels,h=e.style,f=this.horiz,g=this.getSlotWidth(),y=Math.max(1,Math.round(g-2*e.padding)),k={},G=this.labelMetrics(),l=h.textOverflow,t=0;p(e.rotation)||(k.rotation=e.rotation||0);a.forEach(function(b){b=c[b];b.movedLabel&&b.replaceMovedLabel();b&&b.label&&b.label.textPxLength>t&&(t=b.label.textPxLength)});this.maxLabelLength=
t;if(this.autoRotation)t>y&&t>G.h?k.rotation=this.labelRotation:this.labelRotation=0;else if(g){var m=y;if(!l){var F="clip";for(y=a.length;!f&&y--;){var L=a[y];if(L=c[L].label)L.styles&&"ellipsis"===L.styles.textOverflow?L.css({textOverflow:"clip"}):L.textPxLength>g&&L.css({width:g+"px"}),L.getBBox().height>this.len/a.length-(G.h-G.f)&&(L.specificTextOverflow="ellipsis")}}}k.rotation&&(m=t>.5*b.chartHeight?.33*b.chartHeight:t,l||(F="ellipsis"));if(this.labelAlign=e.align||this.autoLabelAlign(this.labelRotation))k.align=
this.labelAlign;a.forEach(function(b){var d=(b=c[b])&&b.label,a=h.width,e={};d&&(d.attr(k),b.shortenLabel?b.shortenLabel():m&&!a&&"nowrap"!==h.whiteSpace&&(m<d.textPxLength||"SPAN"===d.element.tagName)?(e.width=m+"px",l||(e.textOverflow=d.specificTextOverflow||F),d.css(e)):d.styles&&d.styles.width&&!e.width&&!a&&d.css({width:null}),delete d.specificTextOverflow,b.rotation=k.rotation)},this);this.tickRotCorr=d.rotCorr(G.b,this.labelRotation||0,0!==this.side)};a.prototype.hasData=function(){return this.series.some(function(b){return b.hasData()})||
this.options.showEmpty&&k(this.min)&&k(this.max)};a.prototype.addTitle=function(b){var d=this.chart.renderer,a=this.horiz,c=this.opposite,e=this.options.title,h=this.chart.styledMode,f;this.axisTitle||((f=e.textAlign)||(f=(a?{low:"left",middle:"center",high:"right"}:{low:c?"right":"left",middle:"center",high:c?"left":"right"})[e.align]),this.axisTitle=d.text(e.text||"",0,0,e.useHTML).attr({zIndex:7,rotation:e.rotation,align:f}).addClass("highcharts-axis-title"),h||this.axisTitle.css(G(e.style)),this.axisTitle.add(this.axisGroup),
this.axisTitle.isNew=!0);h||e.style.width||this.isRadial||this.axisTitle.css({width:this.len+"px"});this.axisTitle[b?"show":"hide"](b)};a.prototype.generateTick=function(b){var d=this.ticks;d[b]?d[b].addLabel():d[b]=new u(this,b)};a.prototype.getOffset=function(){var b=this,d=this,a=d.chart,c=a.renderer,e=d.options,h=d.tickPositions,f=d.ticks,p=d.horiz,g=d.side,y=a.inverted&&!d.isZAxis?[1,0,3,2][g]:g,G=d.hasData(),l=e.title,m=e.labels,q=a.axisOffset;a=a.clipOffset;var v=[-1,1,1,-1][g],n=e.className,
B=d.axisParent,r,P=0,D=0,ca=0;d.showAxis=r=G||e.showEmpty;d.staggerLines=d.horiz&&m.staggerLines||void 0;if(!d.axisGroup){var ia=function(d,a,e){return c.g(d).attr({zIndex:e}).addClass("highcharts-"+b.coll.toLowerCase()+a+" "+(b.isRadial?"highcharts-radial-axis"+a+" ":"")+(n||"")).add(B)};d.gridGroup=ia("grid","-grid",e.gridZIndex);d.axisGroup=ia("axis","",e.zIndex);d.labelGroup=ia("axis-labels","-labels",m.zIndex)}G||d.isLinked?(h.forEach(function(b){d.generateTick(b)}),d.renderUnsquish(),d.reserveSpaceDefault=
0===g||2===g||{1:"left",3:"right"}[g]===d.labelAlign,F(m.reserveSpace,"center"===d.labelAlign?!0:null,d.reserveSpaceDefault)&&h.forEach(function(b){ca=Math.max(f[b].getLabelSize(),ca)}),d.staggerLines&&(ca*=d.staggerLines),d.labelOffset=ca*(d.opposite?-1:1)):L(f,function(b,d){b.destroy();delete f[d]});if(l&&l.text&&!1!==l.enabled&&(d.addTitle(r),r&&!1!==l.reserveSpace)){d.titleOffset=P=d.axisTitle.getBBox()[p?"height":"width"];var I=l.offset;D=k(I)?0:F(l.margin,p?5:10)}d.renderLine();d.offset=v*F(e.offset,
q[g]?q[g]+(e.margin||0):0);d.tickRotCorr=d.tickRotCorr||{x:0,y:0};l=0===g?-d.labelMetrics().h:2===g?d.tickRotCorr.y:0;G=Math.abs(ca)+D;ca&&(G=G-l+v*(p?F(m.y,d.tickRotCorr.y+8*v):m.x));d.axisTitleMargin=F(I,G);d.getMaxLabelDimensions&&(d.maxLabelDimensions=d.getMaxLabelDimensions(f,h));p=this.tickSize("tick");q[g]=Math.max(q[g],(d.axisTitleMargin||0)+P+v*d.offset,G,h&&h.length&&p?p[0]+v*d.offset:0);e=e.offset?0:2*Math.floor(d.axisLine.strokeWidth()/2);a[y]=Math.max(a[y],e);t(this,"afterGetOffset")};
a.prototype.getLinePath=function(b){var d=this.chart,a=this.opposite,c=this.offset,e=this.horiz,h=this.left+(a?this.width:0)+c;c=d.chartHeight-this.bottom-(a?this.height:0)+c;a&&(b*=-1);return d.renderer.crispLine([["M",e?this.left:h,e?c:this.top],["L",e?d.chartWidth-this.right:h,e?c:d.chartHeight-this.bottom]],b)};a.prototype.renderLine=function(){this.axisLine||(this.axisLine=this.chart.renderer.path().addClass("highcharts-axis-line").add(this.axisGroup),this.chart.styledMode||this.axisLine.attr({stroke:this.options.lineColor,
"stroke-width":this.options.lineWidth,zIndex:7}))};a.prototype.getTitlePosition=function(){var b=this.horiz,d=this.left,a=this.top,c=this.len,e=this.options.title,h=b?d:a,f=this.opposite,p=this.offset,g=e.x,y=e.y,k=this.axisTitle,G=this.chart.renderer.fontMetrics(e.style.fontSize,k);k=Math.max(k.getBBox(null,0).height-G.h-1,0);c={low:h+(b?0:c),middle:h+c/2,high:h+(b?c:0)}[e.align];d=(b?a+this.height:d)+(b?1:-1)*(f?-1:1)*this.axisTitleMargin+[-k,k,G.f,-k][this.side];b={x:b?c+g:d+(f?this.width:0)+p+
g,y:b?d+y-(f?this.height:0)+p:c+y};t(this,"afterGetTitlePosition",{titlePosition:b});return b};a.prototype.renderMinorTick=function(b,d){var a=this.minorTicks;a[b]||(a[b]=new u(this,b,"minor"));d&&a[b].isNew&&a[b].render(null,!0);a[b].render(null,!1,1)};a.prototype.renderTick=function(b,d,a){var c=this.ticks;if(!this.isLinked||b>=this.min&&b<=this.max||this.grid&&this.grid.isColumn)c[b]||(c[b]=new u(this,b)),a&&c[b].isNew&&c[b].render(d,!0,-1),c[b].render(d)};a.prototype.render=function(){var d=this,
a=d.chart,c=d.logarithmic,e=d.options,h=d.isLinked,f=d.tickPositions,p=d.axisTitle,g=d.ticks,y=d.minorTicks,k=d.alternateBands,G=e.stackLabels,l=e.alternateGridColor,F=d.tickmarkOffset,q=d.axisLine,v=d.showAxis,n=m(a.renderer.globalAnimation),B,r;d.labelEdge.length=0;d.overlap=!1;[g,y,k].forEach(function(b){L(b,function(b){b.isActive=!1})});if(d.hasData()||h){var P=d.chart.hasRendered&&d.old&&b(d.old.min);d.minorTickInterval&&!d.categories&&d.getMinorTickPositions().forEach(function(b){d.renderMinorTick(b,
P)});f.length&&(f.forEach(function(b,a){d.renderTick(b,a,P)}),F&&(0===d.min||d.single)&&(g[-1]||(g[-1]=new u(d,-1,null,!0)),g[-1].render(-1)));l&&f.forEach(function(b,e){r="undefined"!==typeof f[e+1]?f[e+1]+F:d.max-F;0===e%2&&b<d.max&&r<=d.max+(a.polar?-F:F)&&(k[b]||(k[b]=new J.PlotLineOrBand(d)),B=b+F,k[b].options={from:c?c.lin2log(B):B,to:c?c.lin2log(r):r,color:l,className:"highcharts-alternate-grid"},k[b].render(),k[b].isActive=!0)});d._addedPlotLB||(d._addedPlotLB=!0,(e.plotLines||[]).concat(e.plotBands||
[]).forEach(function(b){d.addPlotBandOrLine(b)}))}[g,y,k].forEach(function(b){var d=[],c=n.duration;L(b,function(b,a){b.isActive||(b.render(a,!1,0),b.isActive=!1,d.push(a))});V(function(){for(var a=d.length;a--;)b[d[a]]&&!b[d[a]].isActive&&(b[d[a]].destroy(),delete b[d[a]])},b!==k&&a.hasRendered&&c?c:0)});q&&(q[q.isPlaced?"animate":"attr"]({d:this.getLinePath(q.strokeWidth())}),q.isPlaced=!0,q[v?"show":"hide"](v));p&&v&&(e=d.getTitlePosition(),b(e.y)?(p[p.isNew?"attr":"animate"](e),p.isNew=!1):(p.attr("y",
-9999),p.isNew=!0));G&&G.enabled&&d.stacking&&d.stacking.renderStackTotals();d.old={len:d.len,max:d.max,min:d.min,transA:d.transA,userMax:d.userMax,userMin:d.userMin};d.isDirty=!1;t(this,"afterRender")};a.prototype.redraw=function(){this.visible&&(this.render(),this.plotLinesAndBands.forEach(function(b){b.render()}));this.series.forEach(function(b){b.isDirty=!0})};a.prototype.getKeepProps=function(){return this.keepProps||a.keepProps};a.prototype.destroy=function(b){var d=this,a=d.plotLinesAndBands,
c=this.eventOptions;t(this,"destroy",{keepEvents:b});b||S(d);[d.ticks,d.minorTicks,d.alternateBands].forEach(function(b){r(b)});if(a)for(b=a.length;b--;)a[b].destroy();"axisLine axisTitle axisGroup gridGroup labelGroup cross scrollbar".split(" ").forEach(function(b){d[b]&&(d[b]=d[b].destroy())});for(var e in d.plotLinesAndBandsGroups)d.plotLinesAndBandsGroups[e]=d.plotLinesAndBandsGroups[e].destroy();L(d,function(b,a){-1===d.getKeepProps().indexOf(a)&&delete d[a]});this.eventOptions=c};a.prototype.drawCrosshair=
function(b,d){var a=this.crosshair,c=F(a&&a.snap,!0),e=this.chart,h,f=this.cross;t(this,"drawCrosshair",{e:b,point:d});b||(b=this.cross&&this.cross.e);if(a&&!1!==(k(d)||!c)){c?k(d)&&(h=F("colorAxis"!==this.coll?d.crosshairPos:null,this.isXAxis?d.plotX:this.len-d.plotY)):h=b&&(this.horiz?b.chartX-this.pos:this.len-b.chartY+this.pos);if(k(h)){var p={value:d&&(this.isXAxis?d.x:F(d.stackY,d.y)),translatedValue:h};e.polar&&O(p,{isCrosshair:!0,chartX:b&&b.chartX,chartY:b&&b.chartY,point:d});p=this.getPlotLinePath(p)||
null}if(!k(p)){this.hideCrosshair();return}c=this.categories&&!this.isRadial;f||(this.cross=f=e.renderer.path().addClass("highcharts-crosshair highcharts-crosshair-"+(c?"category ":"thin ")+(a.className||"")).attr({zIndex:F(a.zIndex,2)}).add(),e.styledMode||(f.attr({stroke:a.color||(c?C.parse(E.highlightColor20).setOpacity(.25).get():E.neutralColor20),"stroke-width":F(a.width,1)}).css({"pointer-events":"none"}),a.dashStyle&&f.attr({dashstyle:a.dashStyle})));f.show().attr({d:p});c&&!a.width&&f.attr({"stroke-width":this.transA});
this.cross.e=b}else this.hideCrosshair();t(this,"afterDrawCrosshair",{e:b,point:d})};a.prototype.hideCrosshair=function(){this.cross&&this.cross.hide();t(this,"afterHideCrosshair")};a.prototype.hasVerticalPanning=function(){var b=this.chart.options.chart.panning;return!!(b&&b.enabled&&/y/.test(b.type))};a.prototype.validatePositiveValue=function(d){return b(d)&&0<d};a.prototype.update=function(b,d){var a=this.chart;b=G(this.userOptions,b);this.destroy(!0);this.init(a,b);a.isDirtyBox=!0;F(d,!0)&&a.redraw()};
a.prototype.remove=function(b){for(var d=this.chart,a=this.coll,c=this.series,e=c.length;e--;)c[e]&&c[e].remove(!1);D(d.axes,this);D(d[a],this);d[a].forEach(function(b,d){b.options.index=b.userOptions.index=d});this.destroy();d.isDirtyBox=!0;F(b,!0)&&d.redraw()};a.prototype.setTitle=function(b,d){this.update({title:b},d)};a.prototype.setCategories=function(b,d){this.update({categories:b},d)};a.defaultOptions=w.defaultXAxisOptions;a.keepProps="extKey hcEvents names series userMax userMin".split(" ");
return a}();"";return a});M(a,"Core/Axis/DateTimeAxis.js",[a["Core/Utilities.js"]],function(a){var r=a.addEvent,C=a.getMagnitude,E=a.normalizeTickInterval,z=a.timeUnits,x;(function(a){function u(){return this.chart.time.getTimeTicks.apply(this.chart.time,arguments)}function n(a){"datetime"!==a.userOptions.type?this.dateTime=void 0:this.dateTime||(this.dateTime=new g(this))}var m=[];a.compose=function(a){-1===m.indexOf(a)&&(m.push(a),a.keepProps.push("dateTime"),a.prototype.getTimeTicks=u,r(a,"init",
n));return a};var g=function(){function a(a){this.axis=a}a.prototype.normalizeTimeTickInterval=function(a,c){var e=c||[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1,2]],["week",[1,2]],["month",[1,2,3,4,6]],["year",null]];c=e[e.length-1];var g=z[c[0]],l=c[1],k;for(k=0;k<e.length&&!(c=e[k],g=z[c[0]],l=c[1],e[k+1]&&a<=(g*l[l.length-1]+z[e[k+1][0]])/2);k++);g===z.year&&a<5*g&&(l=[1,2,5]);a=E(a/g,l,"year"===c[0]?
Math.max(C(a/g),1):1);return{unitRange:g,count:a,unitName:c[0]}};a.prototype.getXDateFormat=function(a,c){var e=this.axis;return e.closestPointRange?e.chart.time.getDateFormat(e.closestPointRange,a,e.options.startOfWeek,c)||c.year:c.day};return a}();a.Additions=g})(x||(x={}));return x});M(a,"Core/Axis/LogarithmicAxis.js",[a["Core/Utilities.js"]],function(a){var r=a.addEvent,C=a.getMagnitude,E=a.normalizeTickInterval,z=a.pick,x;(function(a){function u(a){var c=this.logarithmic;"logarithmic"!==a.userOptions.type?
this.logarithmic=void 0:c||(this.logarithmic=new g(this))}function n(){var a=this.logarithmic;a&&(this.lin2val=function(c){return a.lin2log(c)},this.val2lin=function(c){return a.log2lin(c)})}var m=[];a.compose=function(a){-1===m.indexOf(a)&&(m.push(a),a.keepProps.push("logarithmic"),r(a,"init",u),r(a,"afterInit",n));return a};var g=function(){function a(a){this.axis=a}a.prototype.getLogTickPositions=function(a,c,f,g){var e=this.axis,k=e.len,l=e.options,m=[];g||(this.minorAutoInterval=void 0);if(.5<=
a)a=Math.round(a),m=e.getLinearTickPositions(a,c,f);else if(.08<=a){var n=Math.floor(c),v,t=l=void 0;for(k=.3<a?[1,2,4]:.15<a?[1,2,4,6,8]:[1,2,3,4,5,6,7,8,9];n<f+1&&!t;n++){var h=k.length;for(v=0;v<h&&!t;v++){var d=this.log2lin(this.lin2log(n)*k[v]);d>c&&(!g||l<=f)&&"undefined"!==typeof l&&m.push(l);l>f&&(t=!0);l=d}}}else c=this.lin2log(c),f=this.lin2log(f),a=g?e.getMinorTickInterval():l.tickInterval,a=z("auto"===a?null:a,this.minorAutoInterval,l.tickPixelInterval/(g?5:1)*(f-c)/((g?k/e.tickPositions.length:
k)||1)),a=E(a,void 0,C(a)),m=e.getLinearTickPositions(a,c,f).map(this.log2lin),g||(this.minorAutoInterval=a/5);g||(e.tickInterval=a);return m};a.prototype.lin2log=function(a){return Math.pow(10,a)};a.prototype.log2lin=function(a){return Math.log(a)/Math.LN10};return a}();a.Additions=g})(x||(x={}));return x});M(a,"Core/Axis/PlotLineOrBand/PlotLineOrBandAxis.js",[a["Core/Utilities.js"]],function(a){var r=a.erase,C=a.extend,E=a.isNumber,z;(function(a){var x=[],u;a.compose=function(a,g){u||(u=a);-1===
x.indexOf(g)&&(x.push(g),C(g.prototype,n.prototype));return g};var n=function(){function a(){}a.prototype.getPlotBandPath=function(a,c,e){void 0===e&&(e=this.options);var g=this.getPlotLinePath({value:c,force:!0,acrossPanes:e.acrossPanes}),f=[],m=this.horiz;c=!E(this.min)||!E(this.max)||a<this.min&&c<this.min||a>this.max&&c>this.max;a=this.getPlotLinePath({value:a,force:!0,acrossPanes:e.acrossPanes});e=1;if(a&&g){if(c){var q=a.toString()===g.toString();e=0}for(c=0;c<a.length;c+=2){var k=a[c],n=a[c+
1],r=g[c],B=g[c+1];"M"!==k[0]&&"L"!==k[0]||"M"!==n[0]&&"L"!==n[0]||"M"!==r[0]&&"L"!==r[0]||"M"!==B[0]&&"L"!==B[0]||(m&&r[1]===k[1]?(r[1]+=e,B[1]+=e):m||r[2]!==k[2]||(r[2]+=e,B[2]+=e),f.push(["M",k[1],k[2]],["L",n[1],n[2]],["L",B[1],B[2]],["L",r[1],r[2]],["Z"]));f.isFlat=q}}return f};a.prototype.addPlotBand=function(a){return this.addPlotBandOrLine(a,"plotBands")};a.prototype.addPlotLine=function(a){return this.addPlotBandOrLine(a,"plotLines")};a.prototype.addPlotBandOrLine=function(a,c){var e=this,
g=this.userOptions,f=new u(this,a);this.visible&&(f=f.render());if(f){this._addedPlotLB||(this._addedPlotLB=!0,(g.plotLines||[]).concat(g.plotBands||[]).forEach(function(a){e.addPlotBandOrLine(a)}));if(c){var m=g[c]||[];m.push(a);g[c]=m}this.plotLinesAndBands.push(f)}return f};a.prototype.removePlotBandOrLine=function(a){var c=this.plotLinesAndBands,e=this.options,g=this.userOptions;if(c){for(var f=c.length;f--;)c[f].id===a&&c[f].destroy();[e.plotLines||[],g.plotLines||[],e.plotBands||[],g.plotBands||
[]].forEach(function(c){for(f=c.length;f--;)(c[f]||{}).id===a&&r(c,c[f])})}};a.prototype.removePlotBand=function(a){this.removePlotBandOrLine(a)};a.prototype.removePlotLine=function(a){this.removePlotBandOrLine(a)};return a}()})(z||(z={}));return z});M(a,"Core/Axis/PlotLineOrBand/PlotLineOrBand.js",[a["Core/Color/Palette.js"],a["Core/Axis/PlotLineOrBand/PlotLineOrBandAxis.js"],a["Core/Utilities.js"]],function(a,w,C){var r=C.arrayMax,z=C.arrayMin,x=C.defined,J=C.destroyObjectProperties,u=C.erase,n=
C.fireEvent,m=C.merge,g=C.objectEach,c=C.pick;C=function(){function e(a,c){this.axis=a;c&&(this.options=c,this.id=c.id)}e.compose=function(a){return w.compose(e,a)};e.prototype.render=function(){n(this,"render");var e=this,f=e.axis,v=f.horiz,q=f.logarithmic,k=e.options,r=k.color,D=c(k.zIndex,0),B=k.events,u={},t=f.chart.renderer,h=k.label,d=e.label,b=k.to,p=k.from,G=k.value,y=e.svgElem,L=[],F=x(p)&&x(b);L=x(G);var P=!y,S={"class":"highcharts-plot-"+(F?"band ":"line ")+(k.className||"")},Q=F?"bands":
"lines";q&&(p=q.log2lin(p),b=q.log2lin(b),G=q.log2lin(G));f.chart.styledMode||(L?(S.stroke=r||a.neutralColor40,S["stroke-width"]=c(k.width,1),k.dashStyle&&(S.dashstyle=k.dashStyle)):F&&(S.fill=r||a.highlightColor10,k.borderWidth&&(S.stroke=k.borderColor,S["stroke-width"]=k.borderWidth)));u.zIndex=D;Q+="-"+D;(q=f.plotLinesAndBandsGroups[Q])||(f.plotLinesAndBandsGroups[Q]=q=t.g("plot-"+Q).attr(u).add());P&&(e.svgElem=y=t.path().attr(S).add(q));if(L)L=f.getPlotLinePath({value:G,lineWidth:y.strokeWidth(),
acrossPanes:k.acrossPanes});else if(F)L=f.getPlotBandPath(p,b,k);else return;!e.eventsAdded&&B&&(g(B,function(b,d){y.on(d,function(b){B[d].apply(e,[b])})}),e.eventsAdded=!0);(P||!y.d)&&L&&L.length?y.attr({d:L}):y&&(L?(y.show(!0),y.animate({d:L})):y.d&&(y.hide(),d&&(e.label=d=d.destroy())));h&&(x(h.text)||x(h.formatter))&&L&&L.length&&0<f.width&&0<f.height&&!L.isFlat?(h=m({align:v&&F&&"center",x:v?!F&&4:10,verticalAlign:!v&&F&&"middle",y:v?F?16:10:F?6:-4,rotation:v&&!F&&90},h),this.renderLabel(h,L,
F,D)):d&&d.hide();return e};e.prototype.renderLabel=function(a,c,e,g){var f=this.axis,l=f.chart.renderer,q=this.label;q||(this.label=q=l.text(this.getLabelText(a),0,0,a.useHTML).attr({align:a.textAlign||a.align,rotation:a.rotation,"class":"highcharts-plot-"+(e?"band":"line")+"-label "+(a.className||""),zIndex:g}).add(),f.chart.styledMode||q.css(m({textOverflow:"ellipsis"},a.style)));g=c.xBounds||[c[0][1],c[1][1],e?c[2][1]:c[0][1]];c=c.yBounds||[c[0][2],c[1][2],e?c[2][2]:c[0][2]];e=z(g);l=z(c);q.align(a,
!1,{x:e,y:l,width:r(g)-e,height:r(c)-l});q.alignValue&&"left"!==q.alignValue||q.css({width:(90===q.rotation?f.height-(q.alignAttr.y-f.top):f.width-(q.alignAttr.x-f.left))+"px"});q.show(!0)};e.prototype.getLabelText=function(a){return x(a.formatter)?a.formatter.call(this):a.text};e.prototype.destroy=function(){u(this.axis.plotLinesAndBands,this);delete this.axis;J(this)};return e}();"";"";return C});M(a,"Core/Tooltip.js",[a["Core/FormatUtilities.js"],a["Core/Globals.js"],a["Core/Color/Palette.js"],
a["Core/Renderer/RendererUtilities.js"],a["Core/Renderer/RendererRegistry.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x){var r=a.format,u=w.doc,n=E.distribute,m=x.addEvent,g=x.clamp,c=x.css,e=x.defined,l=x.discardElement,f=x.extend,v=x.fireEvent,q=x.isArray,k=x.isNumber,I=x.isString,D=x.merge,B=x.pick,O=x.splat,t=x.syncTimeout;a=function(){function a(a,b){this.container=void 0;this.crosshairs=[];this.distance=0;this.isHidden=!0;this.isSticky=!1;this.now={};this.options={};this.outside=!1;this.chart=
a;this.init(a,b)}a.prototype.applyFilter=function(){var a=this.chart;a.renderer.definition({tagName:"filter",attributes:{id:"drop-shadow-"+a.index,opacity:.5},children:[{tagName:"feGaussianBlur",attributes:{"in":"SourceAlpha",stdDeviation:1}},{tagName:"feOffset",attributes:{dx:1,dy:1}},{tagName:"feComponentTransfer",children:[{tagName:"feFuncA",attributes:{type:"linear",slope:.3}}]},{tagName:"feMerge",children:[{tagName:"feMergeNode"},{tagName:"feMergeNode",attributes:{"in":"SourceGraphic"}}]}]})};
a.prototype.bodyFormatter=function(a){return a.map(function(b){var a=b.series.tooltipOptions;return(a[(b.point.formatPrefix||"point")+"Formatter"]||b.point.tooltipFormatter).call(b.point,a[(b.point.formatPrefix||"point")+"Format"]||"")})};a.prototype.cleanSplit=function(a){this.chart.series.forEach(function(b){var d=b&&b.tt;d&&(!d.isActive||a?b.tt=d.destroy():d.isActive=!1)})};a.prototype.defaultFormatter=function(a){var b=this.points||O(this);var d=[a.tooltipFooterHeaderFormatter(b[0])];d=d.concat(a.bodyFormatter(b));
d.push(a.tooltipFooterHeaderFormatter(b[0],!0));return d};a.prototype.destroy=function(){this.label&&(this.label=this.label.destroy());this.split&&this.tt&&(this.cleanSplit(this.chart,!0),this.tt=this.tt.destroy());this.renderer&&(this.renderer=this.renderer.destroy(),l(this.container));x.clearTimeout(this.hideTimer);x.clearTimeout(this.tooltipTimeout)};a.prototype.getAnchor=function(a,b){var d=this.chart,c=d.pointer,e=d.inverted,h=d.plotTop,f=d.plotLeft,g,k,t=0,l=0;a=O(a);this.followPointer&&b?("undefined"===
typeof b.chartX&&(b=c.normalize(b)),c=[b.chartX-f,b.chartY-h]):a[0].tooltipPos?c=a[0].tooltipPos:(a.forEach(function(b){g=b.series.yAxis;k=b.series.xAxis;t+=b.plotX||0;l+=b.plotLow?(b.plotLow+(b.plotHigh||0))/2:b.plotY||0;k&&g&&(e?(t+=h+d.plotHeight-k.len-k.pos,l+=f+d.plotWidth-g.len-g.pos):(t+=k.pos-f,l+=g.pos-h))}),t/=a.length,l/=a.length,c=[e?d.plotWidth-l:t,e?d.plotHeight-t:l],this.shared&&1<a.length&&b&&(e?c[0]=b.chartX-f:c[1]=b.chartY-h));return c.map(Math.round)};a.prototype.getLabel=function(){var a=
this,b=this.chart.styledMode,h=this.options,f="tooltip"+(e(h.className)?" "+h.className:""),g=h.style.pointerEvents||(!this.followPointer&&h.stickOnContact?"auto":"none"),k=function(){a.inContact=!0},t=function(b){var d=a.chart.hoverSeries;a.inContact=a.shouldStickOnContact()&&a.chart.pointer.inClass(b.relatedTarget,"highcharts-tooltip");if(!a.inContact&&d&&d.onMouseOut)d.onMouseOut()},l,q=this.chart.renderer;if(!this.label){if(this.outside){var n=this.chart.options.chart.style,v=z.getRendererType();
this.container=l=w.doc.createElement("div");l.className="highcharts-tooltip-container";c(l,{position:"absolute",top:"1px",pointerEvents:g,zIndex:Math.max(this.options.style.zIndex||0,(n&&n.zIndex||0)+3)});m(l,"mouseenter",k);m(l,"mouseleave",t);w.doc.body.appendChild(l);this.renderer=q=new v(l,0,0,n,void 0,void 0,q.styledMode)}this.split?this.label=q.g(f):(this.label=q.label("",0,0,h.shape,void 0,void 0,h.useHTML,void 0,f).attr({padding:h.padding,r:h.borderRadius}),b||this.label.attr({fill:h.backgroundColor,
"stroke-width":h.borderWidth}).css(h.style).css({pointerEvents:g}).shadow(h.shadow));b&&h.shadow&&(this.applyFilter(),this.label.attr({filter:"url(#drop-shadow-"+this.chart.index+")"}));if(a.outside&&!a.split){var r=this.label,B=r.xSetter,D=r.ySetter;r.xSetter=function(b){B.call(r,a.distance);l.style.left=b+"px"};r.ySetter=function(b){D.call(r,a.distance);l.style.top=b+"px"}}this.label.on("mouseenter",k).on("mouseleave",t).attr({zIndex:8}).add()}return this.label};a.prototype.getPosition=function(a,
b,c){var d=this.chart,e=this.distance,h={},f=d.inverted&&c.h||0,g=this.outside,p=g?u.documentElement.clientWidth-2*e:d.chartWidth,k=g?Math.max(u.body.scrollHeight,u.documentElement.scrollHeight,u.body.offsetHeight,u.documentElement.offsetHeight,u.documentElement.clientHeight):d.chartHeight,l=d.pointer.getChartPosition(),t=function(h){var f="x"===h;return[h,f?p:k,f?a:b].concat(g?[f?a*l.scaleX:b*l.scaleY,f?l.left-e+(c.plotX+d.plotLeft)*l.scaleX:l.top-e+(c.plotY+d.plotTop)*l.scaleY,0,f?p:k]:[f?a:b,f?
c.plotX+d.plotLeft:c.plotY+d.plotTop,f?d.plotLeft:d.plotTop,f?d.plotLeft+d.plotWidth:d.plotTop+d.plotHeight])},m=t("y"),q=t("x"),n,v=!this.followPointer&&B(c.ttBelow,!d.inverted===!!c.negative),r=function(b,a,d,c,p,k,y){var t=g?"y"===b?e*l.scaleY:e*l.scaleX:e,G=(d-c)/2,A=c<p-e,m=p+e+c<a,F=p-t-d+G;p=p+t-G;if(v&&m)h[b]=p;else if(!v&&A)h[b]=F;else if(A)h[b]=Math.min(y-c,0>F-f?F:F-f);else if(m)h[b]=Math.max(k,p+f+d>a?p:p+f);else return!1},D=function(b,a,d,c,f){var g;f<e||f>a-e?g=!1:h[b]=f<d/2?1:f>a-c/
2?a-c-2:f-d/2;return g},A=function(b){var a=m;m=q;q=a;n=b},U=function(){!1!==r.apply(0,m)?!1!==D.apply(0,q)||n||(A(!0),U()):n?h.x=h.y=0:(A(!0),U())};(d.inverted||1<this.len)&&A();U();return h};a.prototype.hide=function(a){var b=this;x.clearTimeout(this.hideTimer);a=B(a,this.options.hideDelay);this.isHidden||(this.hideTimer=t(function(){b.getLabel().fadeOut(a?void 0:a);b.isHidden=!0},a))};a.prototype.init=function(a,b){this.chart=a;this.options=b;this.crosshairs=[];this.now={x:0,y:0};this.isHidden=
!0;this.split=b.split&&!a.inverted&&!a.polar;this.shared=b.shared||this.split;this.outside=B(b.outside,!(!a.scrollablePixelsX&&!a.scrollablePixelsY))};a.prototype.shouldStickOnContact=function(){return!(this.followPointer||!this.options.stickOnContact)};a.prototype.isStickyOnContact=function(){return!(!this.shouldStickOnContact()||!this.inContact)};a.prototype.move=function(a,b,c,e){var d=this,h=d.now,g=!1!==d.options.animation&&!d.isHidden&&(1<Math.abs(a-h.x)||1<Math.abs(b-h.y)),p=d.followPointer||
1<d.len;f(h,{x:g?(2*h.x+a)/3:a,y:g?(h.y+b)/2:b,anchorX:p?void 0:g?(2*h.anchorX+c)/3:c,anchorY:p?void 0:g?(h.anchorY+e)/2:e});d.getLabel().attr(h);d.drawTracker();g&&(x.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){d&&d.move(a,b,c,e)},32))};a.prototype.refresh=function(a,b){var d=this.chart,c=this.options,e=O(a),h=e[0],f=[],g=c.formatter||this.defaultFormatter,k=this.shared,l=d.styledMode,t={};if(c.enabled){x.clearTimeout(this.hideTimer);this.followPointer=!this.split&&
h.series.tooltipOptions.followPointer;var m=this.getAnchor(a,b),n=m[0],r=m[1];!k||!q(a)&&a.series&&a.series.noSharedTooltip?t=h.getLabelConfig():(d.pointer.applyInactiveState(e),e.forEach(function(b){b.setState("hover");f.push(b.getLabelConfig())}),t={x:h.category,y:h.y},t.points=f);this.len=f.length;a=g.call(t,this);g=h.series;this.distance=B(g.tooltipOptions.distance,16);if(!1===a)this.hide();else{if(this.split)this.renderSplit(a,e);else if(e=n,k=r,b&&d.pointer.isDirectTouch&&(e=b.chartX-d.plotLeft,
k=b.chartY-d.plotTop),d.polar||!1===g.options.clip||g.shouldShowTooltip(e,k))b=this.getLabel(),c.style.width&&!l||b.css({width:this.chart.spacingBox.width+"px"}),b.attr({text:a&&a.join?a.join(""):a}),b.removeClass(/highcharts-color-[\d]+/g).addClass("highcharts-color-"+B(h.colorIndex,g.colorIndex)),l||b.attr({stroke:c.borderColor||h.color||g.color||C.neutralColor60}),this.updatePosition({plotX:n,plotY:r,negative:h.negative,ttBelow:h.ttBelow,h:m[2]||0});else{this.hide();return}this.isHidden&&this.label&&
this.label.attr({opacity:1}).show();this.isHidden=!1}v(this,"refresh")}};a.prototype.renderSplit=function(a,b){function d(b,a,d,e,h){void 0===h&&(h=!0);d?(a=Y?0:J,b=g(b-e/2,N.left,N.right-e-(c.outside?T:0))):(a-=da,b=h?b-e-z:b+z,b=g(b,h?b:N.left,N.right));return{x:b,y:a}}var c=this,e=c.chart,h=c.chart,k=h.chartWidth,l=h.chartHeight,t=h.plotHeight,m=h.plotLeft,q=h.plotTop,r=h.pointer,v=h.scrollablePixelsY;v=void 0===v?0:v;var D=h.scrollablePixelsX,x=h.scrollingContainer;x=void 0===x?{scrollLeft:0,
scrollTop:0}:x;var w=x.scrollLeft;x=x.scrollTop;var O=h.styledMode,z=c.distance,A=c.options,U=c.options.positioner,N=c.outside&&"number"!==typeof D?u.documentElement.getBoundingClientRect():{left:w,right:w+k,top:x,bottom:x+l},W=c.getLabel(),X=this.renderer||e.renderer,Y=!(!e.xAxis[0]||!e.xAxis[0].opposite);e=r.getChartPosition();var T=e.left;e=e.top;var da=q+x,E=0,J=t-v;I(a)&&(a=[!1,a]);a=a.slice(0,b.length+1).reduce(function(a,e,h){if(!1!==e&&""!==e){h=b[h-1]||{isHeader:!0,plotX:b[0].plotX,plotY:t,
series:{}};var f=h.isHeader,p=f?c:h.series;e=e.toString();var k=p.tt,l=h.isHeader;var y=h.series;var G="highcharts-color-"+B(h.colorIndex,y.colorIndex,"none");k||(k={padding:A.padding,r:A.borderRadius},O||(k.fill=A.backgroundColor,k["stroke-width"]=A.borderWidth),k=X.label("",0,0,A[l?"headerShape":"shape"],void 0,void 0,A.useHTML).addClass((l?"highcharts-tooltip-header ":"")+"highcharts-tooltip-box "+G).attr(k).add(W));k.isActive=!0;k.attr({text:e});O||k.css(A.style).shadow(A.shadow).attr({stroke:A.borderColor||
h.color||y.color||C.neutralColor80});p=p.tt=k;l=p.getBBox();e=l.width+p.strokeWidth();f&&(E=l.height,J+=E,Y&&(da-=E));y=h.plotX;y=void 0===y?0:y;G=h.plotY;G=void 0===G?0:G;k=h.series;if(h.isHeader){y=m+y;var F=q+t/2}else{var n=k.xAxis,ca=k.yAxis;y=n.pos+g(y,-z,n.len+z);k.shouldShowTooltip(0,ca.pos-q+G,{ignoreX:!0})&&(F=ca.pos+G)}y=g(y,N.left-z,N.right+z);"number"===typeof F?(l=l.height+1,G=U?U.call(c,e,l,h):d(y,F,f,e),a.push({align:U?0:void 0,anchorX:y,anchorY:F,boxWidth:e,point:h,rank:B(G.rank,f?
1:0),size:l,target:G.y,tt:p,x:G.x})):p.isActive=!1}return a},[]);!U&&a.some(function(b){var a=(c.outside?T:0)+b.anchorX;return a<N.left&&a+b.boxWidth<N.right?!0:a<T-N.left+b.boxWidth&&N.right-a>a})&&(a=a.map(function(b){var a=d(b.anchorX,b.anchorY,b.point.isHeader,b.boxWidth,!1);return f(b,{target:a.y,x:a.x})}));c.cleanSplit();n(a,J);var ba=T,ea=T;a.forEach(function(b){var a=b.x,d=b.boxWidth;b=b.isHeader;b||(c.outside&&T+a<ba&&(ba=T+a),!b&&c.outside&&ba+d>ea&&(ea=T+a))});a.forEach(function(b){var a=
b.x,d=b.anchorX,e=b.pos,h=b.point.isHeader;e={visibility:"undefined"===typeof e?"hidden":"inherit",x:a,y:e+da,anchorX:d,anchorY:b.anchorY};if(c.outside&&a<d){var f=T-ba;0<f&&(h||(e.x=a+f,e.anchorX=d+f),h&&(e.x=(ea-ba)/2,e.anchorX=d+f))}b.tt.attr(e)});a=c.container;v=c.renderer;c.outside&&a&&v&&(h=W.getBBox(),v.setSize(h.width+h.x,h.height+h.y,!1),a.style.left=ba+"px",a.style.top=e+"px")};a.prototype.drawTracker=function(){if(this.followPointer||!this.options.stickOnContact)this.tracker&&this.tracker.destroy();
else{var a=this.chart,b=this.label,c=this.shared?a.hoverPoints:a.hoverPoint;if(b&&c){var e={x:0,y:0,width:0,height:0};c=this.getAnchor(c);var h=b.getBBox();c[0]+=a.plotLeft-b.translateX;c[1]+=a.plotTop-b.translateY;e.x=Math.min(0,c[0]);e.y=Math.min(0,c[1]);e.width=0>c[0]?Math.max(Math.abs(c[0]),h.width-c[0]):Math.max(Math.abs(c[0]),h.width);e.height=0>c[1]?Math.max(Math.abs(c[1]),h.height-Math.abs(c[1])):Math.max(Math.abs(c[1]),h.height);this.tracker?this.tracker.attr(e):(this.tracker=b.renderer.rect(e).addClass("highcharts-tracker").add(b),
a.styledMode||this.tracker.attr({fill:"rgba(0,0,0,0)"}))}}};a.prototype.styledModeFormat=function(a){return a.replace('style="font-size: 10px"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex}"')};a.prototype.tooltipFooterHeaderFormatter=function(a,b){var d=a.series,c=d.tooltipOptions,e=d.xAxis,h=e&&e.dateTime;e={isFooter:b,labelConfig:a};var f=c.xDateFormat,g=c[b?"footerFormat":"headerFormat"];v(this,"headerFormatter",e,function(b){h&&
!f&&k(a.key)&&(f=h.getXDateFormat(a.key,c.dateTimeLabelFormats));h&&f&&(a.point&&a.point.tooltipDateKeys||["key"]).forEach(function(b){g=g.replace("{point."+b+"}","{point."+b+":"+f+"}")});d.chart.styledMode&&(g=this.styledModeFormat(g));b.text=r(g,{point:a,series:d},this.chart)});return e.text};a.prototype.update=function(a){this.destroy();D(!0,this.chart.options.tooltip.userOptions,a);this.init(this.chart,D(!0,this.options,a))};a.prototype.updatePosition=function(a){var b=this.chart,d=this.options,
e=b.pointer,h=this.getLabel();e=e.getChartPosition();var f=(d.positioner||this.getPosition).call(this,h.width,h.height,a),g=a.plotX+b.plotLeft;a=a.plotY+b.plotTop;if(this.outside){d=d.borderWidth+2*this.distance;this.renderer.setSize(h.width+d,h.height+d,!1);if(1!==e.scaleX||1!==e.scaleY)c(this.container,{transform:"scale("+e.scaleX+", "+e.scaleY+")"}),g*=e.scaleX,a*=e.scaleY;g+=e.left-f.x;a+=e.top-f.y}this.move(Math.round(f.x),Math.round(f.y||0),g,a)};return a}();"";return a});M(a,"Core/Series/Point.js",
[a["Core/Renderer/HTML/AST.js"],a["Core/Animation/AnimationUtilities.js"],a["Core/DefaultOptions.js"],a["Core/FormatUtilities.js"],a["Core/Utilities.js"]],function(a,w,C,E,z){var r=w.animObject,J=C.defaultOptions,u=E.format,n=z.addEvent,m=z.defined,g=z.erase,c=z.extend,e=z.fireEvent,l=z.getNestedProperty,f=z.isArray,v=z.isFunction,q=z.isNumber,k=z.isObject,I=z.merge,D=z.objectEach,B=z.pick,O=z.syncTimeout,t=z.removeEvent,h=z.uniqueKey;w=function(){function d(){this.colorIndex=this.category=void 0;
this.formatPrefix="point";this.id=void 0;this.isNull=!1;this.percentage=this.options=this.name=void 0;this.selected=!1;this.total=this.series=void 0;this.visible=!0;this.x=void 0}d.prototype.animateBeforeDestroy=function(){var b=this,a={x:b.startXPos,opacity:0},d=b.getGraphicalProps();d.singular.forEach(function(d){b[d]=b[d].animate("dataLabel"===d?{x:b[d].startXPos,y:b[d].startYPos,opacity:0}:a)});d.plural.forEach(function(a){b[a].forEach(function(a){a.element&&a.animate(c({x:b.startXPos},a.startYPos?
{x:a.startXPos,y:a.startYPos}:{}))})})};d.prototype.applyOptions=function(b,a){var e=this.series,h=e.options.pointValKey||e.pointValKey;b=d.prototype.optionsToObject.call(this,b);c(this,b);this.options=this.options?c(this.options,b):b;b.group&&delete this.group;b.dataLabels&&delete this.dataLabels;h&&(this.y=d.prototype.getNestedProperty.call(this,h));this.formatPrefix=(this.isNull=B(this.isValid&&!this.isValid(),null===this.x||!q(this.y)))?"null":"point";this.selected&&(this.state="select");"name"in
this&&"undefined"===typeof a&&e.xAxis&&e.xAxis.hasNames&&(this.x=e.xAxis.nameToX(this));"undefined"===typeof this.x&&e?this.x="undefined"===typeof a?e.autoIncrement():a:q(b.x)&&e.options.relativeXValue&&(this.x=e.autoIncrement(b.x));return this};d.prototype.destroy=function(){function b(){if(a.graphic||a.dataLabel||a.dataLabels)t(a),a.destroyElements();for(f in a)a[f]=null}var a=this,d=a.series,c=d.chart;d=d.options.dataSorting;var e=c.hoverPoints,h=r(a.series.chart.renderer.globalAnimation),f;a.legendItem&&
c.legend.destroyItem(a);e&&(a.setState(),g(e,a),e.length||(c.hoverPoints=null));if(a===c.hoverPoint)a.onMouseOut();d&&d.enabled?(this.animateBeforeDestroy(),O(b,h.duration)):b();c.pointCount--};d.prototype.destroyElements=function(b){var a=this;b=a.getGraphicalProps(b);b.singular.forEach(function(b){a[b]=a[b].destroy()});b.plural.forEach(function(b){a[b].forEach(function(b){b.element&&b.destroy()});delete a[b]})};d.prototype.firePointEvent=function(b,a,d){var c=this,h=this.series.options;(h.point.events[b]||
c.options&&c.options.events&&c.options.events[b])&&c.importEvents();"click"===b&&h.allowPointSelect&&(d=function(b){c.select&&c.select(null,b.ctrlKey||b.metaKey||b.shiftKey)});e(c,b,a,d)};d.prototype.getClassName=function(){return"highcharts-point"+(this.selected?" highcharts-point-select":"")+(this.negative?" highcharts-negative":"")+(this.isNull?" highcharts-null-point":"")+("undefined"!==typeof this.colorIndex?" highcharts-color-"+this.colorIndex:"")+(this.options.className?" "+this.options.className:
"")+(this.zone&&this.zone.className?" "+this.zone.className.replace("highcharts-negative",""):"")};d.prototype.getGraphicalProps=function(b){var a=this,d=[],c={singular:[],plural:[]},e;b=b||{graphic:1,dataLabel:1};b.graphic&&d.push("graphic","upperGraphic","shadowGroup");b.dataLabel&&d.push("dataLabel","dataLabelUpper","connector");for(e=d.length;e--;){var h=d[e];a[h]&&c.singular.push(h)}["dataLabel","connector"].forEach(function(d){var e=d+"s";b[d]&&a[e]&&c.plural.push(e)});return c};d.prototype.getLabelConfig=
function(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}};d.prototype.getNestedProperty=function(b){if(b)return 0===b.indexOf("custom.")?l(b,this.options):this[b]};d.prototype.getZone=function(){var b=this.series,a=b.zones;b=b.zoneAxis||"y";var d,c=0;for(d=a[c];this[b]>=d.value;)d=a[++c];this.nonZonedColor||(this.nonZonedColor=this.color);this.color=
d&&d.color&&!this.options.color?d.color:this.nonZonedColor;return d};d.prototype.hasNewShapeType=function(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType};d.prototype.init=function(b,a,d){this.series=b;this.applyOptions(a,d);this.id=m(this.id)?this.id:h();this.resolveColor();b.chart.pointCount++;e(this,"afterInit");return this};d.prototype.optionsToObject=function(b){var a=this.series,c=a.options.keys,e=c||a.pointArrayMap||["y"],h=e.length,g={},k=
0,l=0;if(q(b)||null===b)g[e[0]]=b;else if(f(b))for(!c&&b.length>h&&(a=typeof b[0],"string"===a?g.name=b[0]:"number"===a&&(g.x=b[0]),k++);l<h;)c&&"undefined"===typeof b[k]||(0<e[l].indexOf(".")?d.prototype.setNestedProperty(g,b[k],e[l]):g[e[l]]=b[k]),k++,l++;else"object"===typeof b&&(g=b,b.dataLabels&&(a._hasPointLabels=!0),b.marker&&(a._hasPointMarkers=!0));return g};d.prototype.resolveColor=function(){var b=this.series,a=b.chart.styledMode;var d=b.chart.options.chart.colorCount;delete this.nonZonedColor;
if(b.options.colorByPoint){if(!a){d=b.options.colors||b.chart.options.colors;var c=d[b.colorCounter];d=d.length}a=b.colorCounter;b.colorCounter++;b.colorCounter===d&&(b.colorCounter=0)}else a||(c=b.color),a=b.colorIndex;this.colorIndex=B(this.options.colorIndex,a);this.color=B(this.options.color,c)};d.prototype.setNestedProperty=function(b,a,d){d.split(".").reduce(function(b,d,c,e){b[d]=e.length-1===c?a:k(b[d],!0)?b[d]:{};return b[d]},b);return b};d.prototype.tooltipFormatter=function(b){var a=this.series,
d=a.tooltipOptions,c=B(d.valueDecimals,""),e=d.valuePrefix||"",h=d.valueSuffix||"";a.chart.styledMode&&(b=a.chart.tooltip.styledModeFormat(b));(a.pointArrayMap||["y"]).forEach(function(a){a="{point."+a;if(e||h)b=b.replace(RegExp(a+"}","g"),e+a+"}"+h);b=b.replace(RegExp(a+"}","g"),a+":,."+c+"f}")});return u(b,{point:this,series:this.series},a.chart)};d.prototype.update=function(b,a,d,c){function e(){h.applyOptions(b);var c=g&&h.hasDummyGraphic;c=null===h.y?!c:c;g&&c&&(h.graphic=g.destroy(),delete h.hasDummyGraphic);
k(b,!0)&&(g&&g.element&&b&&b.marker&&"undefined"!==typeof b.marker.symbol&&(h.graphic=g.destroy()),b&&b.dataLabels&&h.dataLabel&&(h.dataLabel=h.dataLabel.destroy()),h.connector&&(h.connector=h.connector.destroy()));t=h.index;f.updateParallelArrays(h,t);l.data[t]=k(l.data[t],!0)||k(b,!0)?h.options:B(b,l.data[t]);f.isDirty=f.isDirtyData=!0;!f.fixedBox&&f.hasCartesianSeries&&(p.isDirtyBox=!0);"point"===l.legendType&&(p.isDirtyLegend=!0);a&&p.redraw(d)}var h=this,f=h.series,g=h.graphic,p=f.chart,l=f.options,
t;a=B(a,!0);!1===c?e():h.firePointEvent("update",{options:b},e)};d.prototype.remove=function(b,a){this.series.removePoint(this.series.data.indexOf(this),b,a)};d.prototype.select=function(b,a){var d=this,c=d.series,e=c.chart;this.selectedStaging=b=B(b,!d.selected);d.firePointEvent(b?"select":"unselect",{accumulate:a},function(){d.selected=d.options.selected=b;c.options.data[c.data.indexOf(d)]=d.options;d.setState(b&&"select");a||e.getSelectedPoints().forEach(function(b){var a=b.series;b.selected&&
b!==d&&(b.selected=b.options.selected=!1,a.options.data[a.data.indexOf(b)]=b.options,b.setState(e.hoverPoints&&a.options.inactiveOtherPoints?"inactive":""),b.firePointEvent("unselect"))})});delete this.selectedStaging};d.prototype.onMouseOver=function(b){var a=this.series.chart,d=a.pointer;b=b?d.normalize(b):d.getChartCoordinatesFromPoint(this,a.inverted);d.runPointActions(b,this)};d.prototype.onMouseOut=function(){var b=this.series.chart;this.firePointEvent("mouseOut");this.series.options.inactiveOtherPoints||
(b.hoverPoints||[]).forEach(function(b){b.setState()});b.hoverPoints=b.hoverPoint=null};d.prototype.importEvents=function(){if(!this.hasImportedEvents){var b=this,a=I(b.series.options.point,b.options).events;b.events=a;D(a,function(a,d){v(a)&&n(b,d,a)});this.hasImportedEvents=!0}};d.prototype.setState=function(b,d){var h=this.series,f=this.state,g=h.options.states[b||"normal"]||{},k=J.plotOptions[h.type].marker&&h.options.marker,p=k&&!1===k.enabled,l=k&&k.states&&k.states[b||"normal"]||{},t=!1===
l.enabled,m=this.marker||{},n=h.chart,v=k&&h.markerAttribs,r=h.halo,D,I=h.stateMarkerGraphic;b=b||"";if(!(b===this.state&&!d||this.selected&&"select"!==b||!1===g.enabled||b&&(t||p&&!1===l.enabled)||b&&m.states&&m.states[b]&&!1===m.states[b].enabled)){this.state=b;v&&(D=h.markerAttribs(this,b));if(this.graphic&&!this.hasDummyGraphic){f&&this.graphic.removeClass("highcharts-point-"+f);b&&this.graphic.addClass("highcharts-point-"+b);if(!n.styledMode){var u=h.pointAttribs(this,b);var x=B(n.options.chart.animation,
g.animation);h.options.inactiveOtherPoints&&q(u.opacity)&&((this.dataLabels||[]).forEach(function(b){b&&b.animate({opacity:u.opacity},x)}),this.connector&&this.connector.animate({opacity:u.opacity},x));this.graphic.animate(u,x)}D&&this.graphic.animate(D,B(n.options.chart.animation,l.animation,k.animation));I&&I.hide()}else{if(b&&l){f=m.symbol||h.symbol;I&&I.currentSymbol!==f&&(I=I.destroy());if(D)if(I)I[d?"animate":"attr"]({x:D.x,y:D.y});else f&&(h.stateMarkerGraphic=I=n.renderer.symbol(f,D.x,D.y,
D.width,D.height).add(h.markerGroup),I.currentSymbol=f);!n.styledMode&&I&&I.attr(h.pointAttribs(this,b))}I&&(I[b&&this.isInside?"show":"hide"](),I.element.point=this,I.addClass(this.getClassName(),!0))}g=g.halo;D=(I=this.graphic||I)&&I.visibility||"inherit";g&&g.size&&I&&"hidden"!==D&&!this.isCluster?(r||(h.halo=r=n.renderer.path().add(I.parentGroup)),r.show()[d?"animate":"attr"]({d:this.haloPath(g.size)}),r.attr({"class":"highcharts-halo highcharts-color-"+B(this.colorIndex,h.colorIndex)+(this.className?
" "+this.className:""),visibility:D,zIndex:-1}),r.point=this,n.styledMode||r.attr(c({fill:this.color||h.color,"fill-opacity":g.opacity},a.filterUserAttributes(g.attributes||{})))):r&&r.point&&r.point.haloPath&&r.animate({d:r.point.haloPath(0)},null,r.hide);e(this,"afterSetState",{state:b})}};d.prototype.haloPath=function(b){return this.series.chart.renderer.symbols.circle(Math.floor(this.plotX)-b,this.plotY-b,2*b,2*b)};return d}();"";return w});M(a,"Core/Pointer.js",[a["Core/Color/Color.js"],a["Core/Globals.js"],
a["Core/Color/Palette.js"],a["Core/Tooltip.js"],a["Core/Utilities.js"]],function(a,w,C,E,z){var r=a.parse,J=w.charts,u=w.noop,n=z.addEvent,m=z.attr,g=z.css,c=z.defined,e=z.extend,l=z.find,f=z.fireEvent,v=z.isNumber,q=z.isObject,k=z.objectEach,I=z.offset,D=z.pick,B=z.splat;a=function(){function a(a,c){this.lastValidTouch={};this.pinchDown=[];this.runChartClick=!1;this.eventsToUnbind=[];this.chart=a;this.hasDragged=!1;this.options=c;this.init(a,c)}a.prototype.applyInactiveState=function(a){var c=[],
d;(a||[]).forEach(function(b){d=b.series;c.push(d);d.linkedParent&&c.push(d.linkedParent);d.linkedSeries&&(c=c.concat(d.linkedSeries));d.navigatorSeries&&c.push(d.navigatorSeries)});this.chart.series.forEach(function(b){-1===c.indexOf(b)?b.setState("inactive",!0):b.options.inactiveOtherPoints&&b.setAllPointsToState("inactive")})};a.prototype.destroy=function(){var c=this;this.eventsToUnbind.forEach(function(a){return a()});this.eventsToUnbind=[];w.chartCount||(a.unbindDocumentMouseUp&&(a.unbindDocumentMouseUp=
a.unbindDocumentMouseUp()),a.unbindDocumentTouchEnd&&(a.unbindDocumentTouchEnd=a.unbindDocumentTouchEnd()));clearInterval(c.tooltipTimeout);k(c,function(a,d){c[d]=void 0})};a.prototype.drag=function(a){var c=this.chart,d=c.options.chart,b=this.zoomHor,e=this.zoomVert,f=c.plotLeft,g=c.plotTop,k=c.plotWidth,l=c.plotHeight,t=this.mouseDownX||0,m=this.mouseDownY||0,n=q(d.panning)?d.panning&&d.panning.enabled:d.panning,v=d.panKey&&a[d.panKey+"Key"],B=a.chartX,D=a.chartY,I=this.selectionMarker;if(!I||!I.touch)if(B<
f?B=f:B>f+k&&(B=f+k),D<g?D=g:D>g+l&&(D=g+l),this.hasDragged=Math.sqrt(Math.pow(t-B,2)+Math.pow(m-D,2)),10<this.hasDragged){var u=c.isInsidePlot(t-f,m-g,{visiblePlotOnly:!0});c.hasCartesianSeries&&(this.zoomX||this.zoomY)&&u&&!v&&!I&&(this.selectionMarker=I=c.renderer.rect(f,g,b?1:k,e?1:l,0).attr({"class":"highcharts-selection-marker",zIndex:7}).add(),c.styledMode||I.attr({fill:d.selectionMarkerFill||r(C.highlightColor80).setOpacity(.25).get()}));I&&b&&(b=B-t,I.attr({width:Math.abs(b),x:(0<b?0:b)+
t}));I&&e&&(b=D-m,I.attr({height:Math.abs(b),y:(0<b?0:b)+m}));u&&!I&&n&&c.pan(a,d.panning)}};a.prototype.dragStart=function(a){var c=this.chart;c.mouseIsDown=a.type;c.cancelClick=!1;c.mouseDownX=this.mouseDownX=a.chartX;c.mouseDownY=this.mouseDownY=a.chartY};a.prototype.drop=function(a){var h=this,d=this.chart,b=this.hasPinched;if(this.selectionMarker){var k={originalEvent:a,xAxis:[],yAxis:[]},l=this.selectionMarker,t=l.attr?l.attr("x"):l.x,m=l.attr?l.attr("y"):l.y,q=l.attr?l.attr("width"):l.width,
n=l.attr?l.attr("height"):l.height,r;if(this.hasDragged||b)d.axes.forEach(function(d){if(d.zoomEnabled&&c(d.min)&&(b||h[{xAxis:"zoomX",yAxis:"zoomY"}[d.coll]])&&v(t)&&v(m)){var e=d.horiz,f="touchend"===a.type?d.minPixelPadding:0,g=d.toValue((e?t:m)+f);e=d.toValue((e?t+q:m+n)-f);k[d.coll].push({axis:d,min:Math.min(g,e),max:Math.max(g,e)});r=!0}}),r&&f(d,"selection",k,function(a){d.zoom(e(a,b?{animation:!1}:null))});v(d.index)&&(this.selectionMarker=this.selectionMarker.destroy());b&&this.scaleGroups()}d&&
v(d.index)&&(g(d.container,{cursor:d._cursor}),d.cancelClick=10<this.hasDragged,d.mouseIsDown=this.hasDragged=this.hasPinched=!1,this.pinchDown=[])};a.prototype.findNearestKDPoint=function(a,c,d){var b=this.chart,e=b.hoverPoint;b=b.tooltip;if(e&&b&&b.isStickyOnContact())return e;var h;a.forEach(function(b){var a=!(b.noSharedTooltip&&c)&&0>b.options.findNearestPointBy.indexOf("y");b=b.searchPoint(d,a);if((a=q(b,!0)&&b.series)&&!(a=!q(h,!0))){a=h.distX-b.distX;var e=h.dist-b.dist,f=(b.series.group&&
b.series.group.zIndex)-(h.series.group&&h.series.group.zIndex);a=0<(0!==a&&c?a:0!==e?e:0!==f?f:h.series.index>b.series.index?-1:1)}a&&(h=b)});return h};a.prototype.getChartCoordinatesFromPoint=function(a,c){var d=a.series,b=d.xAxis;d=d.yAxis;var e=a.shapeArgs;if(b&&d){var h=D(a.clientX,a.plotX),f=a.plotY||0;a.isNode&&e&&v(e.x)&&v(e.y)&&(h=e.x,f=e.y);return c?{chartX:d.len+d.pos-f,chartY:b.len+b.pos-h}:{chartX:h+b.pos,chartY:f+d.pos}}if(e&&e.x&&e.y)return{chartX:e.x,chartY:e.y}};a.prototype.getChartPosition=
function(){if(this.chartPosition)return this.chartPosition;var a=this.chart.container,c=I(a);this.chartPosition={left:c.left,top:c.top,scaleX:1,scaleY:1};var d=a.offsetWidth;a=a.offsetHeight;2<d&&2<a&&(this.chartPosition.scaleX=c.width/d,this.chartPosition.scaleY=c.height/a);return this.chartPosition};a.prototype.getCoordinates=function(a){var c={xAxis:[],yAxis:[]};this.chart.axes.forEach(function(d){c[d.isXAxis?"xAxis":"yAxis"].push({axis:d,value:d.toValue(a[d.horiz?"chartX":"chartY"])})});return c};
a.prototype.getHoverData=function(a,c,d,b,e,g){var h=[];b=!(!b||!a);var k={chartX:g?g.chartX:void 0,chartY:g?g.chartY:void 0,shared:e};f(this,"beforeGetHoverData",k);var p=c&&!c.stickyTracking?[c]:d.filter(function(b){return k.filter?k.filter(b):b.visible&&!(!e&&b.directTouch)&&D(b.options.enableMouseTracking,!0)&&b.stickyTracking});var t=b||!g?a:this.findNearestKDPoint(p,e,g);c=t&&t.series;t&&(e&&!c.noSharedTooltip?(p=d.filter(function(b){return k.filter?k.filter(b):b.visible&&!(!e&&b.directTouch)&&
D(b.options.enableMouseTracking,!0)&&!b.noSharedTooltip}),p.forEach(function(b){var a=l(b.points,function(b){return b.x===t.x&&!b.isNull});q(a)&&(b.chart.isBoosting&&(a=b.getPoint(a)),h.push(a))})):h.push(t));k={hoverPoint:t};f(this,"afterGetHoverData",k);return{hoverPoint:k.hoverPoint,hoverSeries:c,hoverPoints:h}};a.prototype.getPointFromEvent=function(a){a=a.target;for(var c;a&&!c;)c=a.point,a=a.parentNode;return c};a.prototype.onTrackerMouseOut=function(a){a=a.relatedTarget||a.toElement;var c=
this.chart.hoverSeries;this.isDirectTouch=!1;if(!(!c||!a||c.stickyTracking||this.inClass(a,"highcharts-tooltip")||this.inClass(a,"highcharts-series-"+c.index)&&this.inClass(a,"highcharts-tracker")))c.onMouseOut()};a.prototype.inClass=function(a,c){for(var d;a;){if(d=m(a,"class")){if(-1!==d.indexOf(c))return!0;if(-1!==d.indexOf("highcharts-container"))return!1}a=a.parentNode}};a.prototype.init=function(a,c){this.options=c;this.chart=a;this.runChartClick=!(!c.chart.events||!c.chart.events.click);this.pinchDown=
[];this.lastValidTouch={};E&&(a.tooltip=new E(a,c.tooltip),this.followTouchMove=D(c.tooltip.followTouchMove,!0));this.setDOMEvents()};a.prototype.normalize=function(a,c){var d=a.touches,b=d?d.length?d.item(0):D(d.changedTouches,a.changedTouches)[0]:a;c||(c=this.getChartPosition());d=b.pageX-c.left;b=b.pageY-c.top;d/=c.scaleX;b/=c.scaleY;return e(a,{chartX:Math.round(d),chartY:Math.round(b)})};a.prototype.onContainerClick=function(a){var c=this.chart,d=c.hoverPoint;a=this.normalize(a);var b=c.plotLeft,
g=c.plotTop;c.cancelClick||(d&&this.inClass(a.target,"highcharts-tracker")?(f(d.series,"click",e(a,{point:d})),c.hoverPoint&&d.firePointEvent("click",a)):(e(a,this.getCoordinates(a)),c.isInsidePlot(a.chartX-b,a.chartY-g,{visiblePlotOnly:!0})&&f(c,"click",a)))};a.prototype.onContainerMouseDown=function(a){var c=1===((a.buttons||a.button)&1);a=this.normalize(a);if(w.isFirefox&&0!==a.button)this.onContainerMouseMove(a);if("undefined"===typeof a.button||c)this.zoomOption(a),c&&a.preventDefault&&a.preventDefault(),
this.dragStart(a)};a.prototype.onContainerMouseLeave=function(c){var e=J[D(a.hoverChartIndex,-1)],d=this.chart.tooltip;d&&d.shouldStickOnContact()&&this.inClass(c.relatedTarget,"highcharts-tooltip-container")||(c=this.normalize(c),e&&(c.relatedTarget||c.toElement)&&(e.pointer.reset(),e.pointer.chartPosition=void 0),d&&!d.isHidden&&this.reset())};a.prototype.onContainerMouseEnter=function(a){delete this.chartPosition};a.prototype.onContainerMouseMove=function(a){var c=this.chart;a=this.normalize(a);
this.setHoverChartIndex();a.preventDefault||(a.returnValue=!1);("mousedown"===c.mouseIsDown||this.touchSelect(a))&&this.drag(a);c.openMenu||!this.inClass(a.target,"highcharts-tracker")&&!c.isInsidePlot(a.chartX-c.plotLeft,a.chartY-c.plotTop,{visiblePlotOnly:!0})||(this.inClass(a.target,"highcharts-no-tooltip")?this.reset(!1,0):this.runPointActions(a))};a.prototype.onDocumentTouchEnd=function(c){var e=J[D(a.hoverChartIndex,-1)];e&&e.pointer.drop(c)};a.prototype.onContainerTouchMove=function(a){if(this.touchSelect(a))this.onContainerMouseMove(a);
else this.touch(a)};a.prototype.onContainerTouchStart=function(a){if(this.touchSelect(a))this.onContainerMouseDown(a);else this.zoomOption(a),this.touch(a,!0)};a.prototype.onDocumentMouseMove=function(a){var c=this.chart,d=this.chartPosition;a=this.normalize(a,d);var b=c.tooltip;!d||b&&b.isStickyOnContact()||c.isInsidePlot(a.chartX-c.plotLeft,a.chartY-c.plotTop,{visiblePlotOnly:!0})||this.inClass(a.target,"highcharts-tracker")||this.reset()};a.prototype.onDocumentMouseUp=function(c){var e=J[D(a.hoverChartIndex,
-1)];e&&e.pointer.drop(c)};a.prototype.pinch=function(a){var c=this,d=c.chart,b=c.pinchDown,f=a.touches||[],g=f.length,k=c.lastValidTouch,l=c.hasZoom,m={},t=1===g&&(c.inClass(a.target,"highcharts-tracker")&&d.runTrackerClick||c.runChartClick),q={},n=c.selectionMarker;1<g?c.initiated=!0:1===g&&this.followTouchMove&&(c.initiated=!1);l&&c.initiated&&!t&&!1!==a.cancelable&&a.preventDefault();[].map.call(f,function(b){return c.normalize(b)});"touchstart"===a.type?([].forEach.call(f,function(a,d){b[d]=
{chartX:a.chartX,chartY:a.chartY}}),k.x=[b[0].chartX,b[1]&&b[1].chartX],k.y=[b[0].chartY,b[1]&&b[1].chartY],d.axes.forEach(function(b){if(b.zoomEnabled){var a=d.bounds[b.horiz?"h":"v"],c=b.minPixelPadding,e=b.toPixels(Math.min(D(b.options.min,b.dataMin),b.dataMin)),h=b.toPixels(Math.max(D(b.options.max,b.dataMax),b.dataMax)),f=Math.max(e,h);a.min=Math.min(b.pos,Math.min(e,h)-c);a.max=Math.max(b.pos+b.len,f+c)}}),c.res=!0):c.followTouchMove&&1===g?this.runPointActions(c.normalize(a)):b.length&&(n||
(c.selectionMarker=n=e({destroy:u,touch:!0},d.plotBox)),c.pinchTranslate(b,f,m,n,q,k),c.hasPinched=l,c.scaleGroups(m,q),c.res&&(c.res=!1,this.reset(!1,0)))};a.prototype.pinchTranslate=function(a,c,d,b,e,f){this.zoomHor&&this.pinchTranslateDirection(!0,a,c,d,b,e,f);this.zoomVert&&this.pinchTranslateDirection(!1,a,c,d,b,e,f)};a.prototype.pinchTranslateDirection=function(a,c,d,b,e,f,g,k){var h=this.chart,l=a?"x":"y",p=a?"X":"Y",m="chart"+p,y=a?"width":"height",t=h["plot"+(a?"Left":"Top")],q=h.inverted,
n=h.bounds[a?"h":"v"],r=1===c.length,v=c[0][m],B=!r&&c[1][m];c=function(){"number"===typeof I&&20<Math.abs(v-B)&&(D=k||Math.abs(N-I)/Math.abs(v-B));A=(t-N)/D+v;G=h["plot"+(a?"Width":"Height")]/D};var G,A,D=k||1,N=d[0][m],I=!r&&d[1][m];c();d=A;if(d<n.min){d=n.min;var L=!0}else d+G>n.max&&(d=n.max-G,L=!0);L?(N-=.8*(N-g[l][0]),"number"===typeof I&&(I-=.8*(I-g[l][1])),c()):g[l]=[N,I];q||(f[l]=A-t,f[y]=G);f=q?1/D:D;e[y]=G;e[l]=d;b[q?a?"scaleY":"scaleX":"scale"+p]=D;b["translate"+p]=f*t+(N-f*v)};a.prototype.reset=
function(a,c){var d=this.chart,b=d.hoverSeries,e=d.hoverPoint,h=d.hoverPoints,f=d.tooltip,g=f&&f.shared?h:e;a&&g&&B(g).forEach(function(b){b.series.isCartesian&&"undefined"===typeof b.plotX&&(a=!1)});if(a)f&&g&&B(g).length&&(f.refresh(g),f.shared&&h?h.forEach(function(b){b.setState(b.state,!0);b.series.isCartesian&&(b.series.xAxis.crosshair&&b.series.xAxis.drawCrosshair(null,b),b.series.yAxis.crosshair&&b.series.yAxis.drawCrosshair(null,b))}):e&&(e.setState(e.state,!0),d.axes.forEach(function(b){b.crosshair&&
e.series[b.coll]===b&&b.drawCrosshair(null,e)})));else{if(e)e.onMouseOut();h&&h.forEach(function(b){b.setState()});if(b)b.onMouseOut();f&&f.hide(c);this.unDocMouseMove&&(this.unDocMouseMove=this.unDocMouseMove());d.axes.forEach(function(b){b.hideCrosshair()});this.hoverX=d.hoverPoints=d.hoverPoint=null}};a.prototype.runPointActions=function(c,e){var d=this.chart,b=d.tooltip&&d.tooltip.options.enabled?d.tooltip:void 0,h=b?b.shared:!1,f=e||d.hoverPoint,g=f&&f.series||d.hoverSeries;e=this.getHoverData(f,
g,d.series,(!c||"touchmove"!==c.type)&&(!!e||g&&g.directTouch&&this.isDirectTouch),h,c);f=e.hoverPoint;g=e.hoverSeries;var k=e.hoverPoints;e=g&&g.tooltipOptions.followPointer&&!g.tooltipOptions.split;h=h&&g&&!g.noSharedTooltip;if(f&&(f!==d.hoverPoint||b&&b.isHidden)){(d.hoverPoints||[]).forEach(function(b){-1===k.indexOf(b)&&b.setState()});if(d.hoverSeries!==g)g.onMouseOver();this.applyInactiveState(k);(k||[]).forEach(function(b){b.setState("hover")});d.hoverPoint&&d.hoverPoint.firePointEvent("mouseOut");
if(!f.series)return;d.hoverPoints=k;d.hoverPoint=f;f.firePointEvent("mouseOver");b&&b.refresh(h?k:f,c)}else e&&b&&!b.isHidden&&(f=b.getAnchor([{}],c),d.isInsidePlot(f[0],f[1],{visiblePlotOnly:!0})&&b.updatePosition({plotX:f[0],plotY:f[1]}));this.unDocMouseMove||(this.unDocMouseMove=n(d.container.ownerDocument,"mousemove",function(b){var d=J[a.hoverChartIndex];if(d)d.pointer.onDocumentMouseMove(b)}),this.eventsToUnbind.push(this.unDocMouseMove));d.axes.forEach(function(b){var a=D((b.crosshair||{}).snap,
!0),e;a&&((e=d.hoverPoint)&&e.series[b.coll]===b||(e=l(k,function(a){return a.series[b.coll]===b})));e||!a?b.drawCrosshair(c,e):b.hideCrosshair()})};a.prototype.scaleGroups=function(a,c){var d=this.chart;d.series.forEach(function(b){var e=a||b.getPlotBox();b.xAxis&&b.xAxis.zoomEnabled&&b.group&&(b.group.attr(e),b.markerGroup&&(b.markerGroup.attr(e),b.markerGroup.clip(c?d.clipRect:null)),b.dataLabelsGroup&&b.dataLabelsGroup.attr(e))});d.clipRect.attr(c||d.clipBox)};a.prototype.setDOMEvents=function(){var c=
this,e=this.chart.container,d=e.ownerDocument;e.onmousedown=this.onContainerMouseDown.bind(this);e.onmousemove=this.onContainerMouseMove.bind(this);e.onclick=this.onContainerClick.bind(this);this.eventsToUnbind.push(n(e,"mouseenter",this.onContainerMouseEnter.bind(this)));this.eventsToUnbind.push(n(e,"mouseleave",this.onContainerMouseLeave.bind(this)));a.unbindDocumentMouseUp||(a.unbindDocumentMouseUp=n(d,"mouseup",this.onDocumentMouseUp.bind(this)));for(var b=this.chart.renderTo.parentElement;b&&
"BODY"!==b.tagName;)this.eventsToUnbind.push(n(b,"scroll",function(){delete c.chartPosition})),b=b.parentElement;w.hasTouch&&(this.eventsToUnbind.push(n(e,"touchstart",this.onContainerTouchStart.bind(this),{passive:!1})),this.eventsToUnbind.push(n(e,"touchmove",this.onContainerTouchMove.bind(this),{passive:!1})),a.unbindDocumentTouchEnd||(a.unbindDocumentTouchEnd=n(d,"touchend",this.onDocumentTouchEnd.bind(this),{passive:!1})))};a.prototype.setHoverChartIndex=function(){var c=this.chart,e=w.charts[D(a.hoverChartIndex,
-1)];if(e&&e!==c)e.pointer.onContainerMouseLeave({relatedTarget:!0});e&&e.mouseIsDown||(a.hoverChartIndex=c.index)};a.prototype.touch=function(a,c){var d=this.chart,b;this.setHoverChartIndex();if(1===a.touches.length)if(a=this.normalize(a),(b=d.isInsidePlot(a.chartX-d.plotLeft,a.chartY-d.plotTop,{visiblePlotOnly:!0}))&&!d.openMenu){c&&this.runPointActions(a);if("touchmove"===a.type){c=this.pinchDown;var e=c[0]?4<=Math.sqrt(Math.pow(c[0].chartX-a.chartX,2)+Math.pow(c[0].chartY-a.chartY,2)):!1}D(e,
!0)&&this.pinch(a)}else c&&this.reset();else 2===a.touches.length&&this.pinch(a)};a.prototype.touchSelect=function(a){return!(!this.chart.options.chart.zoomBySingleTouch||!a.touches||1!==a.touches.length)};a.prototype.zoomOption=function(a){var c=this.chart,d=c.options.chart;c=c.inverted;var b=d.zoomType||"";/touch/.test(a.type)&&(b=D(d.pinchType,b));this.zoomX=a=/x/.test(b);this.zoomY=d=/y/.test(b);this.zoomHor=a&&!c||d&&c;this.zoomVert=d&&!c||a&&c;this.hasZoom=a||d};return a}();"";return a});M(a,
"Core/MSPointer.js",[a["Core/Globals.js"],a["Core/Pointer.js"],a["Core/Utilities.js"]],function(a,w,C){function r(){var a=[];a.item=function(a){return this[a]};e(f,function(c){a.push({pageX:c.pageX,pageY:c.pageY,target:c.target})});return a}function z(a,c,e,f){var g=J[w.hoverChartIndex||NaN];"touch"!==a.pointerType&&a.pointerType!==a.MSPOINTER_TYPE_TOUCH||!g||(g=g.pointer,f(a),g[c]({type:e,target:a.currentTarget,preventDefault:n,touches:r()}))}var x=this&&this.__extends||function(){var a=function(c,
e){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])};return a(c,e)};return function(c,e){function f(){this.constructor=c}a(c,e);c.prototype=null===e?Object.create(e):(f.prototype=e.prototype,new f)}}(),J=a.charts,u=a.doc,n=a.noop,m=a.win,g=C.addEvent,c=C.css,e=C.objectEach,l=C.removeEvent,f={},v=!!m.PointerEvent;return function(e){function k(){return null!==e&&e.apply(this,arguments)||this}x(k,e);k.isRequired=
function(){return!(a.hasTouch||!m.PointerEvent&&!m.MSPointerEvent)};k.prototype.batchMSEvents=function(a){a(this.chart.container,v?"pointerdown":"MSPointerDown",this.onContainerPointerDown);a(this.chart.container,v?"pointermove":"MSPointerMove",this.onContainerPointerMove);a(u,v?"pointerup":"MSPointerUp",this.onDocumentPointerUp)};k.prototype.destroy=function(){this.batchMSEvents(l);e.prototype.destroy.call(this)};k.prototype.init=function(a,f){e.prototype.init.call(this,a,f);this.hasZoom&&c(a.container,
{"-ms-touch-action":"none","touch-action":"none"})};k.prototype.onContainerPointerDown=function(a){z(a,"onContainerTouchStart","touchstart",function(a){f[a.pointerId]={pageX:a.pageX,pageY:a.pageY,target:a.currentTarget}})};k.prototype.onContainerPointerMove=function(a){z(a,"onContainerTouchMove","touchmove",function(a){f[a.pointerId]={pageX:a.pageX,pageY:a.pageY};f[a.pointerId].target||(f[a.pointerId].target=a.currentTarget)})};k.prototype.onDocumentPointerUp=function(a){z(a,"onDocumentTouchEnd",
"touchend",function(a){delete f[a.pointerId]})};k.prototype.setDOMEvents=function(){e.prototype.setDOMEvents.call(this);(this.hasZoom||this.followTouchMove)&&this.batchMSEvents(g)};return k}(w)});M(a,"Core/Legend/Legend.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/FormatUtilities.js"],a["Core/Globals.js"],a["Core/Series/Point.js"],a["Core/Renderer/RendererUtilities.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x){var r=a.animObject,u=a.setAnimation,n=w.format;a=C.isFirefox;var m=C.marginNames;
C=C.win;var g=z.distribute,c=x.addEvent,e=x.createElement,l=x.css,f=x.defined,v=x.discardElement,q=x.find,k=x.fireEvent,I=x.isNumber,D=x.merge,B=x.pick,O=x.relativeLength,t=x.stableSort,h=x.syncTimeout;z=x.wrap;x=function(){function a(a,d){this.allItems=[];this.contentGroup=this.box=void 0;this.display=!1;this.group=void 0;this.offsetWidth=this.maxLegendWidth=this.maxItemWidth=this.legendWidth=this.legendHeight=this.lastLineHeight=this.lastItemY=this.itemY=this.itemX=this.itemMarginTop=this.itemMarginBottom=
this.itemHeight=this.initialItemY=0;this.options={};this.padding=0;this.pages=[];this.proximate=!1;this.scrollGroup=void 0;this.widthOption=this.totalItemWidth=this.titleHeight=this.symbolWidth=this.symbolHeight=0;this.chart=a;this.init(a,d)}a.prototype.init=function(a,d){this.chart=a;this.setOptions(d);d.enabled&&(this.render(),c(this.chart,"endResize",function(){this.legend.positionCheckboxes()}),this.proximate?this.unchartrender=c(this.chart,"render",function(){this.legend.proximatePositions();
this.legend.positionItems()}):this.unchartrender&&this.unchartrender())};a.prototype.setOptions=function(a){var b=B(a.padding,8);this.options=a;this.chart.styledMode||(this.itemStyle=a.itemStyle,this.itemHiddenStyle=D(this.itemStyle,a.itemHiddenStyle));this.itemMarginTop=a.itemMarginTop||0;this.itemMarginBottom=a.itemMarginBottom||0;this.padding=b;this.initialItemY=b-5;this.symbolWidth=B(a.symbolWidth,16);this.pages=[];this.proximate="proximate"===a.layout&&!this.chart.inverted;this.baseline=void 0};
a.prototype.update=function(a,d){var b=this.chart;this.setOptions(D(!0,this.options,a));this.destroy();b.isDirtyLegend=b.isDirtyBox=!0;B(d,!0)&&b.redraw();k(this,"afterUpdate")};a.prototype.colorizeItem=function(a,d){a.legendGroup[d?"removeClass":"addClass"]("highcharts-legend-item-hidden");if(!this.chart.styledMode){var b=this.options,c=a.legendItem,e=a.legendLine,h=a.legendSymbol,f=this.itemHiddenStyle.color;b=d?b.itemStyle.color:f;var g=d?a.color||f:f,l=a.options&&a.options.marker,p={fill:g};c&&
c.css({fill:b,color:b});e&&e.attr({stroke:g});h&&(l&&h.isMarker&&(p=a.pointAttribs(),d||(p.stroke=p.fill=f)),h.attr(p))}k(this,"afterColorizeItem",{item:a,visible:d})};a.prototype.positionItems=function(){this.allItems.forEach(this.positionItem,this);this.chart.isResizing||this.positionCheckboxes()};a.prototype.positionItem=function(a){var b=this,d=this.options,c=d.symbolPadding,e=!d.rtl,h=a._legendItemPos;d=h[0];h=h[1];var g=a.checkbox,l=a.legendGroup;l&&l.element&&(c={translateX:e?d:this.legendWidth-
d-2*c-4,translateY:h},e=function(){k(b,"afterPositionItem",{item:a})},f(l.translateY)?l.animate(c,void 0,e):(l.attr(c),e()));g&&(g.x=d,g.y=h)};a.prototype.destroyItem=function(a){var b=a.checkbox;["legendItem","legendLine","legendSymbol","legendGroup"].forEach(function(b){a[b]&&(a[b]=a[b].destroy())});b&&v(a.checkbox)};a.prototype.destroy=function(){function a(a){this[a]&&(this[a]=this[a].destroy())}this.getAllItems().forEach(function(b){["legendItem","legendGroup"].forEach(a,b)});"clipRect up down pager nav box title group".split(" ").forEach(a,
this);this.display=null};a.prototype.positionCheckboxes=function(){var a=this.group&&this.group.alignAttr,d=this.clipHeight||this.legendHeight,c=this.titleHeight;if(a){var e=a.translateY;this.allItems.forEach(function(b){var h=b.checkbox;if(h){var f=e+c+h.y+(this.scrollOffset||0)+3;l(h,{left:a.translateX+b.checkboxOffset+h.x-20+"px",top:f+"px",display:this.proximate||f>e-6&&f<e+d-6?"":"none"})}},this)}};a.prototype.renderTitle=function(){var a=this.options,d=this.padding,c=a.title,e=0;c.text&&(this.title||
(this.title=this.chart.renderer.label(c.text,d-3,d-4,null,null,null,a.useHTML,null,"legend-title").attr({zIndex:1}),this.chart.styledMode||this.title.css(c.style),this.title.add(this.group)),c.width||this.title.css({width:this.maxLegendWidth+"px"}),a=this.title.getBBox(),e=a.height,this.offsetWidth=a.width,this.contentGroup.attr({translateY:e}));this.titleHeight=e};a.prototype.setText=function(a){var b=this.options;a.legendItem.attr({text:b.labelFormat?n(b.labelFormat,a,this.chart):b.labelFormatter.call(a)})};
a.prototype.renderItem=function(a){var b=this.chart,d=b.renderer,c=this.options,e=this.symbolWidth,h=c.symbolPadding||0,f=this.itemStyle,g=this.itemHiddenStyle,k="horizontal"===c.layout?B(c.itemDistance,20):0,l=!c.rtl,m=!a.series,n=!m&&a.series.drawLegendSymbol?a.series:a,q=n.options,t=this.createCheckboxForItem&&q&&q.showCheckbox,v=c.useHTML,r=a.options.className,I=a.legendItem;q=e+h+k+(t?20:0);I||(a.legendGroup=d.g("legend-item").addClass("highcharts-"+n.type+"-series highcharts-color-"+a.colorIndex+
(r?" "+r:"")+(m?" highcharts-series-"+a.index:"")).attr({zIndex:1}).add(this.scrollGroup),a.legendItem=I=d.text("",l?e+h:-h,this.baseline||0,v),b.styledMode||I.css(D(a.visible?f:g)),I.attr({align:l?"left":"right",zIndex:2}).add(a.legendGroup),this.baseline||(this.fontMetrics=d.fontMetrics(b.styledMode?12:f.fontSize,I),this.baseline=this.fontMetrics.f+3+this.itemMarginTop,I.attr("y",this.baseline),this.symbolHeight=c.symbolHeight||this.fontMetrics.f,c.squareSymbol&&(this.symbolWidth=B(c.symbolWidth,
Math.max(this.symbolHeight,16)),q=this.symbolWidth+h+k+(t?20:0),l&&I.attr("x",this.symbolWidth+h))),n.drawLegendSymbol(this,a),this.setItemEvents&&this.setItemEvents(a,I,v));t&&!a.checkbox&&this.createCheckboxForItem&&this.createCheckboxForItem(a);this.colorizeItem(a,a.visible);!b.styledMode&&f.width||I.css({width:(c.itemWidth||this.widthOption||b.spacingBox.width)-q+"px"});this.setText(a);b=I.getBBox();a.itemWidth=a.checkboxOffset=c.itemWidth||a.legendItemWidth||b.width+q;this.maxItemWidth=Math.max(this.maxItemWidth,
a.itemWidth);this.totalItemWidth+=a.itemWidth;this.itemHeight=a.itemHeight=Math.round(a.legendItemHeight||b.height||this.symbolHeight)};a.prototype.layoutItem=function(a){var b=this.options,d=this.padding,c="horizontal"===b.layout,e=a.itemHeight,h=this.itemMarginBottom,f=this.itemMarginTop,g=c?B(b.itemDistance,20):0,k=this.maxLegendWidth;b=b.alignColumns&&this.totalItemWidth>k?this.maxItemWidth:a.itemWidth;c&&this.itemX-d+b>k&&(this.itemX=d,this.lastLineHeight&&(this.itemY+=f+this.lastLineHeight+
h),this.lastLineHeight=0);this.lastItemY=f+this.itemY+h;this.lastLineHeight=Math.max(e,this.lastLineHeight);a._legendItemPos=[this.itemX,this.itemY];c?this.itemX+=b:(this.itemY+=f+e+h,this.lastLineHeight=e);this.offsetWidth=this.widthOption||Math.max((c?this.itemX-d-(a.checkbox?0:g):b)+d,this.offsetWidth)};a.prototype.getAllItems=function(){var a=[];this.chart.series.forEach(function(b){var d=b&&b.options;b&&B(d.showInLegend,f(d.linkedTo)?!1:void 0,!0)&&(a=a.concat(b.legendItems||("point"===d.legendType?
b.data:b)))});k(this,"afterGetAllItems",{allItems:a});return a};a.prototype.getAlignment=function(){var a=this.options;return this.proximate?a.align.charAt(0)+"tv":a.floating?"":a.align.charAt(0)+a.verticalAlign.charAt(0)+a.layout.charAt(0)};a.prototype.adjustMargins=function(a,d){var b=this.chart,c=this.options,e=this.getAlignment();e&&[/(lth|ct|rth)/,/(rtv|rm|rbv)/,/(rbh|cb|lbh)/,/(lbv|lm|ltv)/].forEach(function(h,g){h.test(e)&&!f(a[g])&&(b[m[g]]=Math.max(b[m[g]],b.legend[(g+1)%2?"legendHeight":
"legendWidth"]+[1,-1,-1,1][g]*c[g%2?"x":"y"]+B(c.margin,12)+d[g]+(b.titleOffset[g]||0)))})};a.prototype.proximatePositions=function(){var a=this.chart,d=[],c="left"===this.options.align;this.allItems.forEach(function(b){var e;var h=c;if(b.yAxis){b.xAxis.options.reversed&&(h=!h);b.points&&(e=q(h?b.points:b.points.slice(0).reverse(),function(a){return I(a.plotY)}));h=this.itemMarginTop+b.legendItem.getBBox().height+this.itemMarginBottom;var f=b.yAxis.top-a.plotTop;b.visible?(e=e?e.plotY:b.yAxis.height,
e+=f-.3*h):e=f+b.yAxis.height;d.push({target:e,size:h,item:b})}},this);g(d,a.plotHeight).forEach(function(b){b.item._legendItemPos&&(b.item._legendItemPos[1]=a.plotTop-a.spacing[0]+b.pos)})};a.prototype.render=function(){var a=this.chart,d=a.renderer,c=this.options,e=this.padding,h=this.getAllItems(),f=this.group,g=this.box;this.itemX=e;this.itemY=this.initialItemY;this.lastItemY=this.offsetWidth=0;this.widthOption=O(c.width,a.spacingBox.width-e);var l=a.spacingBox.width-2*e-c.x;-1<["rm","lm"].indexOf(this.getAlignment().substring(0,
2))&&(l/=2);this.maxLegendWidth=this.widthOption||l;f||(this.group=f=d.g("legend").addClass(c.className||"").attr({zIndex:7}).add(),this.contentGroup=d.g().attr({zIndex:1}).add(f),this.scrollGroup=d.g().add(this.contentGroup));this.renderTitle();t(h,function(a,b){return(a.options&&a.options.legendIndex||0)-(b.options&&b.options.legendIndex||0)});c.reversed&&h.reverse();this.allItems=h;this.display=l=!!h.length;this.itemHeight=this.totalItemWidth=this.maxItemWidth=this.lastLineHeight=0;h.forEach(this.renderItem,
this);h.forEach(this.layoutItem,this);h=(this.widthOption||this.offsetWidth)+e;var m=this.lastItemY+this.lastLineHeight+this.titleHeight;m=this.handleOverflow(m);m+=e;g||(this.box=g=d.rect().addClass("highcharts-legend-box").attr({r:c.borderRadius}).add(f),g.isNew=!0);a.styledMode||g.attr({stroke:c.borderColor,"stroke-width":c.borderWidth||0,fill:c.backgroundColor||"none"}).shadow(c.shadow);0<h&&0<m&&(g[g.isNew?"attr":"animate"](g.crisp.call({},{x:0,y:0,width:h,height:m},g.strokeWidth())),g.isNew=
!1);g[l?"show":"hide"]();a.styledMode&&"none"===f.getStyle("display")&&(h=m=0);this.legendWidth=h;this.legendHeight=m;l&&this.align();this.proximate||this.positionItems();k(this,"afterRender")};a.prototype.align=function(a){void 0===a&&(a=this.chart.spacingBox);var b=this.chart,d=this.options,c=a.y;/(lth|ct|rth)/.test(this.getAlignment())&&0<b.titleOffset[0]?c+=b.titleOffset[0]:/(lbh|cb|rbh)/.test(this.getAlignment())&&0<b.titleOffset[2]&&(c-=b.titleOffset[2]);c!==a.y&&(a=D(a,{y:c}));this.group.align(D(d,
{width:this.legendWidth,height:this.legendHeight,verticalAlign:this.proximate?"top":d.verticalAlign}),!0,a)};a.prototype.handleOverflow=function(a){var b=this,d=this.chart,c=d.renderer,e=this.options,h=e.y,f="top"===e.verticalAlign,g=this.padding,k=e.maxHeight,l=e.navigation,m=B(l.animation,!0),n=l.arrowSize||12,q=this.pages,t=this.allItems,v=function(a){"number"===typeof a?N.attr({height:a}):N&&(b.clipRect=N.destroy(),b.contentGroup.clip());b.contentGroup.div&&(b.contentGroup.div.style.clip=a?"rect("+
g+"px,9999px,"+(g+a)+"px,0)":"auto")},r=function(a){b[a]=c.circle(0,0,1.3*n).translate(n/2,n/2).add(U);d.styledMode||b[a].attr("fill","rgba(0,0,0,0.0001)");return b[a]},I,A;h=d.spacingBox.height+(f?-h:h)-g;var U=this.nav,N=this.clipRect;"horizontal"!==e.layout||"middle"===e.verticalAlign||e.floating||(h/=2);k&&(h=Math.min(h,k));q.length=0;a&&0<h&&a>h&&!1!==l.enabled?(this.clipHeight=I=Math.max(h-20-this.titleHeight-g,0),this.currentPage=B(this.currentPage,1),this.fullHeight=a,t.forEach(function(a,
b){var d=a._legendItemPos[1],c=Math.round(a.legendItem.getBBox().height),e=q.length;if(!e||d-q[e-1]>I&&(A||d)!==q[e-1])q.push(A||d),e++;a.pageIx=e-1;A&&(t[b-1].pageIx=e-1);b===t.length-1&&d+c-q[e-1]>I&&d!==A&&(q.push(d),a.pageIx=e);d!==A&&(A=d)}),N||(N=b.clipRect=c.clipRect(0,g,9999,0),b.contentGroup.clip(N)),v(I),U||(this.nav=U=c.g().attr({zIndex:1}).add(this.group),this.up=c.symbol("triangle",0,0,n,n).add(U),r("upTracker").on("click",function(){b.scroll(-1,m)}),this.pager=c.text("",15,10).addClass("highcharts-legend-navigation"),
d.styledMode||this.pager.css(l.style),this.pager.add(U),this.down=c.symbol("triangle-down",0,0,n,n).add(U),r("downTracker").on("click",function(){b.scroll(1,m)})),b.scroll(0),a=h):U&&(v(),this.nav=U.destroy(),this.scrollGroup.attr({translateY:1}),this.clipHeight=0);return a};a.prototype.scroll=function(a,d){var b=this,c=this.chart,e=this.pages,f=e.length,g=this.clipHeight,l=this.options.navigation,m=this.pager,p=this.padding,n=this.currentPage+a;n>f&&(n=f);0<n&&("undefined"!==typeof d&&u(d,c),this.nav.attr({translateX:p,
translateY:g+this.padding+7+this.titleHeight,visibility:"visible"}),[this.up,this.upTracker].forEach(function(a){a.attr({"class":1===n?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})}),m.attr({text:n+"/"+f}),[this.down,this.downTracker].forEach(function(a){a.attr({x:18+this.pager.getBBox().width,"class":n===f?"highcharts-legend-nav-inactive":"highcharts-legend-nav-active"})},this),c.styledMode||(this.up.attr({fill:1===n?l.inactiveColor:l.activeColor}),this.upTracker.css({cursor:1===
n?"default":"pointer"}),this.down.attr({fill:n===f?l.inactiveColor:l.activeColor}),this.downTracker.css({cursor:n===f?"default":"pointer"})),this.scrollOffset=-e[n-1]+this.initialItemY,this.scrollGroup.animate({translateY:this.scrollOffset}),this.currentPage=n,this.positionCheckboxes(),a=r(B(d,c.renderer.globalAnimation,!0)),h(function(){k(b,"afterScroll",{currentPage:n})},a.duration))};a.prototype.setItemEvents=function(a,d,c){var b=this,e=b.chart.renderer.boxWrapper,h=a instanceof E,f="highcharts-legend-"+
(h?"point":"series")+"-active",g=b.chart.styledMode,l=function(d){b.allItems.forEach(function(b){a!==b&&[b].concat(b.linkedSeries||[]).forEach(function(a){a.setState(d,!h)})})};(c?[d,a.legendSymbol]:[a.legendGroup]).forEach(function(c){if(c)c.on("mouseover",function(){a.visible&&l("inactive");a.setState("hover");a.visible&&e.addClass(f);g||d.css(b.options.itemHoverStyle)}).on("mouseout",function(){b.chart.styledMode||d.css(D(a.visible?b.itemStyle:b.itemHiddenStyle));l("");e.removeClass(f);a.setState()}).on("click",
function(b){var d=function(){a.setVisible&&a.setVisible();l(a.visible?"inactive":"")};e.removeClass(f);b={browserEvent:b};a.firePointEvent?a.firePointEvent("legendItemClick",b,d):k(a,"legendItemClick",b,d)})})};a.prototype.createCheckboxForItem=function(a){a.checkbox=e("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:a.selected,defaultChecked:a.selected},this.options.itemCheckboxStyle,this.chart.container);c(a.checkbox,"click",function(b){k(a.series||a,"checkboxClick",{checked:b.target.checked,
item:a},function(){a.select()})})};return a}();(/Trident\/7\.0/.test(C.navigator&&C.navigator.userAgent)||a)&&z(x.prototype,"positionItem",function(a,b){var d=this,c=function(){b._legendItemPos&&a.call(d,b)};c();d.bubbleLegend||setTimeout(c)});"";return x});M(a,"Core/Series/SeriesRegistry.js",[a["Core/Globals.js"],a["Core/DefaultOptions.js"],a["Core/Series/Point.js"],a["Core/Utilities.js"]],function(a,w,C,E){var r=w.defaultOptions,x=E.error,J=E.extendClass,u=E.merge,n;(function(m){function g(a,e){var c=
r.plotOptions||{},f=e.defaultOptions;e.prototype.pointClass||(e.prototype.pointClass=C);e.prototype.type=a;f&&(c[a]=f);m.seriesTypes[a]=e}m.seriesTypes=a.seriesTypes;m.getSeries=function(a,e){void 0===e&&(e={});var c=a.options.chart;c=e.type||c.type||c.defaultSeriesType||"";var f=m.seriesTypes[c];m||x(17,!0,a,{missingModuleFor:c});c=new f;"function"===typeof c.init&&c.init(a,e);return c};m.registerSeriesType=g;m.seriesType=function(a,e,l,f,n){var c=r.plotOptions||{};e=e||"";c[a]=u(c[e],l);g(a,J(m.seriesTypes[e]||
function(){},f));m.seriesTypes[a].prototype.type=a;n&&(m.seriesTypes[a].prototype.pointClass=J(C,n));return m.seriesTypes[a]}})(n||(n={}));return n});M(a,"Core/Chart/Chart.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/Axis/Axis.js"],a["Core/FormatUtilities.js"],a["Core/Foundation.js"],a["Core/Globals.js"],a["Core/Legend/Legend.js"],a["Core/MSPointer.js"],a["Core/DefaultOptions.js"],a["Core/Color/Palette.js"],a["Core/Pointer.js"],a["Core/Renderer/RendererRegistry.js"],a["Core/Series/SeriesRegistry.js"],
a["Core/Renderer/SVG/SVGRenderer.js"],a["Core/Time.js"],a["Core/Utilities.js"],a["Core/Renderer/HTML/AST.js"]],function(a,w,C,E,z,x,J,u,n,m,g,c,e,l,f,v){var q=a.animate,k=a.animObject,r=a.setAnimation,D=C.numberFormat,B=E.registerEventOptions,O=z.charts,t=z.doc,h=z.marginNames,d=z.svg,b=z.win,p=u.defaultOptions,G=u.defaultTime,y=c.seriesTypes,L=f.addEvent,F=f.attr,P=f.cleanRecursively,S=f.createElement,Q=f.css,V=f.defined,fa=f.discardElement,H=f.erase,K=f.error,M=f.extend,ha=f.find,R=f.fireEvent,
Z=f.getStyle,A=f.isArray,U=f.isNumber,N=f.isObject,W=f.isString,X=f.merge,Y=f.objectEach,T=f.pick,da=f.pInt,ka=f.relativeLength,ja=f.removeEvent,ba=f.splat,ea=f.syncTimeout,ma=f.uniqueKey;a=function(){function a(a,b,d){this.series=this.renderTo=this.renderer=this.pointer=this.pointCount=this.plotWidth=this.plotTop=this.plotLeft=this.plotHeight=this.plotBox=this.options=this.numberFormatter=this.margin=this.legend=this.labelCollectors=this.isResizing=this.index=this.eventOptions=this.container=this.colorCounter=
this.clipBox=this.chartWidth=this.chartHeight=this.bounds=this.axisOffset=this.axes=void 0;this.sharedClips={};this.yAxis=this.xAxis=this.userOptions=this.titleOffset=this.time=this.symbolCounter=this.spacingBox=this.spacing=void 0;this.getArgs(a,b,d)}a.chart=function(b,d,c){return new a(b,d,c)};a.prototype.getArgs=function(a,b,d){W(a)||a.nodeName?(this.renderTo=a,this.init(b,d)):this.init(a,b)};a.prototype.init=function(a,b){var d=a.plotOptions||{};R(this,"init",{args:arguments},function(){var c=
X(p,a),e=c.chart;Y(c.plotOptions,function(a,b){N(a)&&(a.tooltip=d[b]&&X(d[b].tooltip)||void 0)});c.tooltip.userOptions=a.chart&&a.chart.forExport&&a.tooltip.userOptions||a.tooltip;this.userOptions=a;this.margin=[];this.spacing=[];this.bounds={h:{},v:{}};this.labelCollectors=[];this.callback=b;this.isResizing=0;this.options=c;this.axes=[];this.series=[];this.time=a.time&&Object.keys(a.time).length?new l(a.time):z.time;this.numberFormatter=e.numberFormatter||D;this.styledMode=e.styledMode;this.hasCartesianSeries=
e.showAxes;this.index=O.length;O.push(this);z.chartCount++;B(this,e);this.xAxis=[];this.yAxis=[];this.pointCount=this.colorCounter=this.symbolCounter=0;R(this,"afterInit");this.firstRender()})};a.prototype.initSeries=function(a){var b=this.options.chart;b=a.type||b.type||b.defaultSeriesType;var d=y[b];d||K(17,!0,this,{missingModuleFor:b});b=new d;"function"===typeof b.init&&b.init(this,a);return b};a.prototype.setSeriesData=function(){this.getSeriesOrderByLinks().forEach(function(a){a.points||a.data||
!a.enabledDataSorting||a.setData(a.options.data,!1)})};a.prototype.getSeriesOrderByLinks=function(){return this.series.concat().sort(function(a,b){return a.linkedSeries.length||b.linkedSeries.length?b.linkedSeries.length-a.linkedSeries.length:0})};a.prototype.orderSeries=function(a){var b=this.series;a=a||0;for(var d=b.length;a<d;++a)b[a]&&(b[a].index=a,b[a].name=b[a].getName())};a.prototype.isInsidePlot=function(a,b,d){void 0===d&&(d={});var c=this.inverted,e=this.plotBox,h=this.plotLeft,f=this.plotTop,
g=this.scrollablePlotBox,k=0;var l=0;d.visiblePlotOnly&&this.scrollingContainer&&(l=this.scrollingContainer,k=l.scrollLeft,l=l.scrollTop);var m=d.series;e=d.visiblePlotOnly&&g||e;g=d.inverted?b:a;b=d.inverted?a:b;a={x:g,y:b,isInsidePlot:!0};if(!d.ignoreX){var A=m&&(c?m.yAxis:m.xAxis)||{pos:h,len:Infinity};g=d.paneCoordinates?A.pos+g:h+g;g>=Math.max(k+h,A.pos)&&g<=Math.min(k+h+e.width,A.pos+A.len)||(a.isInsidePlot=!1)}!d.ignoreY&&a.isInsidePlot&&(c=m&&(c?m.xAxis:m.yAxis)||{pos:f,len:Infinity},d=d.paneCoordinates?
c.pos+b:f+b,d>=Math.max(l+f,c.pos)&&d<=Math.min(l+f+e.height,c.pos+c.len)||(a.isInsidePlot=!1));R(this,"afterIsInsidePlot",a);return a.isInsidePlot};a.prototype.redraw=function(a){R(this,"beforeRedraw");var b=this.hasCartesianSeries?this.axes:this.colorAxis||[],d=this.series,c=this.pointer,e=this.legend,h=this.userOptions.legend,f=this.renderer,g=f.isHidden(),k=[],l=this.isDirtyBox,m=this.isDirtyLegend;this.setResponsive&&this.setResponsive(!1);r(this.hasRendered?a:!1,this);g&&this.temporaryDisplay();
this.layOutTitles();for(a=d.length;a--;){var A=d[a];if(A.options.stacking||A.options.centerInCategory){var p=!0;if(A.isDirty){var n=!0;break}}}if(n)for(a=d.length;a--;)A=d[a],A.options.stacking&&(A.isDirty=!0);d.forEach(function(a){a.isDirty&&("point"===a.options.legendType?("function"===typeof a.updateTotals&&a.updateTotals(),m=!0):h&&(h.labelFormatter||h.labelFormat)&&(m=!0));a.isDirtyData&&R(a,"updatedData")});m&&e&&e.options.enabled&&(e.render(),this.isDirtyLegend=!1);p&&this.getStacks();b.forEach(function(a){a.updateNames();
a.setScale()});this.getMargins();b.forEach(function(a){a.isDirty&&(l=!0)});b.forEach(function(a){var b=a.min+","+a.max;a.extKey!==b&&(a.extKey=b,k.push(function(){R(a,"afterSetExtremes",M(a.eventArgs,a.getExtremes()));delete a.eventArgs}));(l||p)&&a.redraw()});l&&this.drawChartBox();R(this,"predraw");d.forEach(function(a){(l||a.isDirty)&&a.visible&&a.redraw();a.isDirtyData=!1});c&&c.reset(!0);f.draw();R(this,"redraw");R(this,"render");g&&this.temporaryDisplay(!0);k.forEach(function(a){a.call()})};
a.prototype.get=function(a){function b(b){return b.id===a||b.options&&b.options.id===a}for(var d=this.series,c=ha(this.axes,b)||ha(this.series,b),e=0;!c&&e<d.length;e++)c=ha(d[e].points||[],b);return c};a.prototype.getAxes=function(){var a=this,b=this.options,d=b.xAxis=ba(b.xAxis||{});b=b.yAxis=ba(b.yAxis||{});R(this,"getAxes");d.forEach(function(a,b){a.index=b;a.isX=!0});b.forEach(function(a,b){a.index=b});d.concat(b).forEach(function(b){new w(a,b)});R(this,"afterGetAxes")};a.prototype.getSelectedPoints=
function(){return this.series.reduce(function(a,b){b.getPointsCollection().forEach(function(b){T(b.selectedStaging,b.selected)&&a.push(b)});return a},[])};a.prototype.getSelectedSeries=function(){return this.series.filter(function(a){return a.selected})};a.prototype.setTitle=function(a,b,d){this.applyDescription("title",a);this.applyDescription("subtitle",b);this.applyDescription("caption",void 0);this.layOutTitles(d)};a.prototype.applyDescription=function(a,b){var d=this,c="title"===a?{color:n.neutralColor80,
fontSize:this.options.isStock?"16px":"18px"}:{color:n.neutralColor60};c=this.options[a]=X(!this.styledMode&&{style:c},this.options[a],b);var e=this[a];e&&b&&(this[a]=e=e.destroy());c&&!e&&(e=this.renderer.text(c.text,0,0,c.useHTML).attr({align:c.align,"class":"highcharts-"+a,zIndex:c.zIndex||4}).add(),e.update=function(b){d[{title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"}[a]](b)},this.styledMode||e.css(c.style),this[a]=e)};a.prototype.layOutTitles=function(a){var b=[0,0,0],d=this.renderer,
c=this.spacingBox;["title","subtitle","caption"].forEach(function(a){var e=this[a],h=this.options[a],f=h.verticalAlign||"top";a="title"===a?"top"===f?-3:0:"top"===f?b[0]+2:0;var g;if(e){this.styledMode||(g=h.style&&h.style.fontSize);g=d.fontMetrics(g,e).b;e.css({width:(h.width||c.width+(h.widthAdjust||0))+"px"});var k=Math.round(e.getBBox(h.useHTML).height);e.align(M({y:"bottom"===f?g:a+g,height:k},h),!1,"spacingBox");h.floating||("top"===f?b[0]=Math.ceil(b[0]+k):"bottom"===f&&(b[2]=Math.ceil(b[2]+
k)))}},this);b[0]&&"top"===(this.options.title.verticalAlign||"top")&&(b[0]+=this.options.title.margin);b[2]&&"bottom"===this.options.caption.verticalAlign&&(b[2]+=this.options.caption.margin);var e=!this.titleOffset||this.titleOffset.join(",")!==b.join(",");this.titleOffset=b;R(this,"afterLayOutTitles");!this.isDirtyBox&&e&&(this.isDirtyBox=this.isDirtyLegend=e,this.hasRendered&&T(a,!0)&&this.isDirtyBox&&this.redraw())};a.prototype.getChartSize=function(){var a=this.options.chart,b=a.width;a=a.height;
var d=this.renderTo;V(b)||(this.containerWidth=Z(d,"width"));V(a)||(this.containerHeight=Z(d,"height"));this.chartWidth=Math.max(0,b||this.containerWidth||600);this.chartHeight=Math.max(0,ka(a,this.chartWidth)||(1<this.containerHeight?this.containerHeight:400))};a.prototype.temporaryDisplay=function(a){var b=this.renderTo;if(a)for(;b&&b.style;)b.hcOrigStyle&&(Q(b,b.hcOrigStyle),delete b.hcOrigStyle),b.hcOrigDetached&&(t.body.removeChild(b),b.hcOrigDetached=!1),b=b.parentNode;else for(;b&&b.style;){t.body.contains(b)||
b.parentNode||(b.hcOrigDetached=!0,t.body.appendChild(b));if("none"===Z(b,"display",!1)||b.hcOricDetached)b.hcOrigStyle={display:b.style.display,height:b.style.height,overflow:b.style.overflow},a={display:"block",overflow:"hidden"},b!==this.renderTo&&(a.height=0),Q(b,a),b.offsetWidth||b.style.setProperty("display","block","important");b=b.parentNode;if(b===t.body)break}};a.prototype.setClassName=function(a){this.container.className="highcharts-container "+(a||"")};a.prototype.getContainer=function(){var a=
this.options,b=a.chart,c=ma(),h,f=this.renderTo;f||(this.renderTo=f=b.renderTo);W(f)&&(this.renderTo=f=t.getElementById(f));f||K(13,!0,this);var k=da(F(f,"data-highcharts-chart"));U(k)&&O[k]&&O[k].hasRendered&&O[k].destroy();F(f,"data-highcharts-chart",this.index);f.innerHTML="";b.skipClone||f.offsetWidth||this.temporaryDisplay();this.getChartSize();k=this.chartWidth;var l=this.chartHeight;Q(f,{overflow:"hidden"});this.styledMode||(h=M({position:"relative",overflow:"hidden",width:k+"px",height:l+
"px",textAlign:"left",lineHeight:"normal",zIndex:0,"-webkit-tap-highlight-color":"rgba(0,0,0,0)",userSelect:"none","touch-action":"manipulation",outline:"none"},b.style||{}));this.container=c=S("div",{id:c},h,f);this._cursor=c.style.cursor;this.renderer=new (b.renderer||!d?g.getRendererType(b.renderer):e)(c,k,l,void 0,b.forExport,a.exporting&&a.exporting.allowHTML,this.styledMode);r(void 0,this);this.setClassName(b.className);if(this.styledMode)for(var m in a.defs)this.renderer.definition(a.defs[m]);
else this.renderer.setStyle(b.style);this.renderer.chartIndex=this.index;R(this,"afterGetContainer")};a.prototype.getMargins=function(a){var b=this.spacing,d=this.margin,c=this.titleOffset;this.resetMargins();c[0]&&!V(d[0])&&(this.plotTop=Math.max(this.plotTop,c[0]+b[0]));c[2]&&!V(d[2])&&(this.marginBottom=Math.max(this.marginBottom,c[2]+b[2]));this.legend&&this.legend.display&&this.legend.adjustMargins(d,b);R(this,"getMargins");a||this.getAxisMargins()};a.prototype.getAxisMargins=function(){var a=
this,b=a.axisOffset=[0,0,0,0],d=a.colorAxis,c=a.margin,e=function(a){a.forEach(function(a){a.visible&&a.getOffset()})};a.hasCartesianSeries?e(a.axes):d&&d.length&&e(d);h.forEach(function(d,e){V(c[e])||(a[d]+=b[e])});a.setChartSize()};a.prototype.reflow=function(a){var d=this,c=d.options.chart,e=d.renderTo,h=V(c.width)&&V(c.height),g=c.width||Z(e,"width");c=c.height||Z(e,"height");e=a?a.target:b;delete d.pointer.chartPosition;if(!h&&!d.isPrinting&&g&&c&&(e===b||e===t)){if(g!==d.containerWidth||c!==
d.containerHeight)f.clearTimeout(d.reflowTimeout),d.reflowTimeout=ea(function(){d.container&&d.setSize(void 0,void 0,!1)},a?100:0);d.containerWidth=g;d.containerHeight=c}};a.prototype.setReflow=function(a){var d=this;!1===a||this.unbindReflow?!1===a&&this.unbindReflow&&(this.unbindReflow=this.unbindReflow()):(this.unbindReflow=L(b,"resize",function(a){d.options&&d.reflow(a)}),L(this,"destroy",this.unbindReflow))};a.prototype.setSize=function(a,b,d){var c=this,e=c.renderer;c.isResizing+=1;r(d,c);d=
e.globalAnimation;c.oldChartHeight=c.chartHeight;c.oldChartWidth=c.chartWidth;"undefined"!==typeof a&&(c.options.chart.width=a);"undefined"!==typeof b&&(c.options.chart.height=b);c.getChartSize();c.styledMode||(d?q:Q)(c.container,{width:c.chartWidth+"px",height:c.chartHeight+"px"},d);c.setChartSize(!0);e.setSize(c.chartWidth,c.chartHeight,d);c.axes.forEach(function(a){a.isDirty=!0;a.setScale()});c.isDirtyLegend=!0;c.isDirtyBox=!0;c.layOutTitles();c.getMargins();c.redraw(d);c.oldChartHeight=null;R(c,
"resize");ea(function(){c&&R(c,"endResize",null,function(){--c.isResizing})},k(d).duration)};a.prototype.setChartSize=function(a){var b=this.inverted,d=this.renderer,c=this.chartWidth,e=this.chartHeight,h=this.options.chart,f=this.spacing,g=this.clipOffset,k,l,m,A;this.plotLeft=k=Math.round(this.plotLeft);this.plotTop=l=Math.round(this.plotTop);this.plotWidth=m=Math.max(0,Math.round(c-k-this.marginRight));this.plotHeight=A=Math.max(0,Math.round(e-l-this.marginBottom));this.plotSizeX=b?A:m;this.plotSizeY=
b?m:A;this.plotBorderWidth=h.plotBorderWidth||0;this.spacingBox=d.spacingBox={x:f[3],y:f[0],width:c-f[3]-f[1],height:e-f[0]-f[2]};this.plotBox=d.plotBox={x:k,y:l,width:m,height:A};b=2*Math.floor(this.plotBorderWidth/2);c=Math.ceil(Math.max(b,g[3])/2);e=Math.ceil(Math.max(b,g[0])/2);this.clipBox={x:c,y:e,width:Math.floor(this.plotSizeX-Math.max(b,g[1])/2-c),height:Math.max(0,Math.floor(this.plotSizeY-Math.max(b,g[2])/2-e))};a||(this.axes.forEach(function(a){a.setAxisSize();a.setAxisTranslation()}),
d.alignElements());R(this,"afterSetChartSize",{skipAxes:a})};a.prototype.resetMargins=function(){R(this,"resetMargins");var a=this,b=a.options.chart;["margin","spacing"].forEach(function(d){var c=b[d],e=N(c)?c:[c,c,c,c];["Top","Right","Bottom","Left"].forEach(function(c,h){a[d][h]=T(b[d+c],e[h])})});h.forEach(function(b,d){a[b]=T(a.margin[d],a.spacing[d])});a.axisOffset=[0,0,0,0];a.clipOffset=[0,0,0,0]};a.prototype.drawChartBox=function(){var a=this.options.chart,b=this.renderer,d=this.chartWidth,
c=this.chartHeight,e=this.styledMode,h=this.plotBGImage,f=a.backgroundColor,g=a.plotBackgroundColor,k=a.plotBackgroundImage,l=this.plotLeft,m=this.plotTop,A=this.plotWidth,p=this.plotHeight,n=this.plotBox,q=this.clipRect,N=this.clipBox,t=this.chartBackground,v=this.plotBackground,r=this.plotBorder,B,y="animate";t||(this.chartBackground=t=b.rect().addClass("highcharts-background").add(),y="attr");if(e)var I=B=t.strokeWidth();else{I=a.borderWidth||0;B=I+(a.shadow?8:0);f={fill:f||"none"};if(I||t["stroke-width"])f.stroke=
a.borderColor,f["stroke-width"]=I;t.attr(f).shadow(a.shadow)}t[y]({x:B/2,y:B/2,width:d-B-I%2,height:c-B-I%2,r:a.borderRadius});y="animate";v||(y="attr",this.plotBackground=v=b.rect().addClass("highcharts-plot-background").add());v[y](n);e||(v.attr({fill:g||"none"}).shadow(a.plotShadow),k&&(h?(k!==h.attr("href")&&h.attr("href",k),h.animate(n)):this.plotBGImage=b.image(k,l,m,A,p).add()));q?q.animate({width:N.width,height:N.height}):this.clipRect=b.clipRect(N);y="animate";r||(y="attr",this.plotBorder=
r=b.rect().addClass("highcharts-plot-border").attr({zIndex:1}).add());e||r.attr({stroke:a.plotBorderColor,"stroke-width":a.plotBorderWidth||0,fill:"none"});r[y](r.crisp({x:l,y:m,width:A,height:p},-r.strokeWidth()));this.isDirtyBox=!1;R(this,"afterDrawChartBox")};a.prototype.propFromSeries=function(){var a=this,b=a.options.chart,d=a.options.series,c,e,h;["inverted","angular","polar"].forEach(function(f){e=y[b.type||b.defaultSeriesType];h=b[f]||e&&e.prototype[f];for(c=d&&d.length;!h&&c--;)(e=y[d[c].type])&&
e.prototype[f]&&(h=!0);a[f]=h})};a.prototype.linkSeries=function(){var a=this,b=a.series;b.forEach(function(a){a.linkedSeries.length=0});b.forEach(function(b){var d=b.options.linkedTo;W(d)&&(d=":previous"===d?a.series[b.index-1]:a.get(d))&&d.linkedParent!==b&&(d.linkedSeries.push(b),b.linkedParent=d,d.enabledDataSorting&&b.setDataSortingOptions(),b.visible=T(b.options.visible,d.options.visible,b.visible))});R(this,"afterLinkSeries")};a.prototype.renderSeries=function(){this.series.forEach(function(a){a.translate();
a.render()})};a.prototype.renderLabels=function(){var a=this,b=a.options.labels;b.items&&b.items.forEach(function(d){var c=M(b.style,d.style),e=da(c.left)+a.plotLeft,h=da(c.top)+a.plotTop+12;delete c.left;delete c.top;a.renderer.text(d.html,e,h).attr({zIndex:2}).css(c).add()})};a.prototype.render=function(){var a=this.axes,b=this.colorAxis,d=this.renderer,c=this.options,e=function(a){a.forEach(function(a){a.visible&&a.render()})},h=0;this.setTitle();this.legend=new x(this,c.legend);this.getStacks&&
this.getStacks();this.getMargins(!0);this.setChartSize();c=this.plotWidth;a.some(function(a){if(a.horiz&&a.visible&&a.options.labels.enabled&&a.series.length)return h=21,!0});var f=this.plotHeight=Math.max(this.plotHeight-h,0);a.forEach(function(a){a.setScale()});this.getAxisMargins();var g=1.1<c/this.plotWidth,k=1.05<f/this.plotHeight;if(g||k)a.forEach(function(a){(a.horiz&&g||!a.horiz&&k)&&a.setTickInterval(!0)}),this.getMargins();this.drawChartBox();this.hasCartesianSeries?e(a):b&&b.length&&e(b);
this.seriesGroup||(this.seriesGroup=d.g("series-group").attr({zIndex:3}).add());this.renderSeries();this.renderLabels();this.addCredits();this.setResponsive&&this.setResponsive();this.hasRendered=!0};a.prototype.addCredits=function(a){var d=this,c=X(!0,this.options.credits,a);c.enabled&&!this.credits&&(this.credits=this.renderer.text(c.text+(this.mapCredits||""),0,0).addClass("highcharts-credits").on("click",function(){c.href&&(b.location.href=c.href)}).attr({align:c.position.align,zIndex:8}),d.styledMode||
this.credits.css(c.style),this.credits.add().align(c.position),this.credits.update=function(a){d.credits=d.credits.destroy();d.addCredits(a)})};a.prototype.destroy=function(){var a=this,b=a.axes,d=a.series,c=a.container,e=c&&c.parentNode,h;R(a,"destroy");a.renderer.forExport?H(O,a):O[a.index]=void 0;z.chartCount--;a.renderTo.removeAttribute("data-highcharts-chart");ja(a);for(h=b.length;h--;)b[h]=b[h].destroy();this.scroller&&this.scroller.destroy&&this.scroller.destroy();for(h=d.length;h--;)d[h]=
d[h].destroy();"title subtitle chartBackground plotBackground plotBGImage plotBorder seriesGroup clipRect credits pointer rangeSelector legend resetZoomButton tooltip renderer".split(" ").forEach(function(b){var d=a[b];d&&d.destroy&&(a[b]=d.destroy())});c&&(c.innerHTML="",ja(c),e&&fa(c));Y(a,function(b,d){delete a[d]})};a.prototype.firstRender=function(){var a=this,b=a.options;if(!a.isReadyToRender||a.isReadyToRender()){a.getContainer();a.resetMargins();a.setChartSize();a.propFromSeries();a.getAxes();
(A(b.series)?b.series:[]).forEach(function(b){a.initSeries(b)});a.linkSeries();a.setSeriesData();R(a,"beforeRender");m&&(J.isRequired()?a.pointer=new J(a,b):a.pointer=new m(a,b));a.render();a.pointer.getChartPosition();if(!a.renderer.imgCount&&!a.hasLoaded)a.onload();a.temporaryDisplay(!0)}};a.prototype.onload=function(){this.callbacks.concat([this.callback]).forEach(function(a){a&&"undefined"!==typeof this.index&&a.apply(this,[this])},this);R(this,"load");R(this,"render");V(this.index)&&this.setReflow(this.options.chart.reflow);
this.hasLoaded=!0};a.prototype.addSeries=function(a,b,d){var c=this,e;a&&(b=T(b,!0),R(c,"addSeries",{options:a},function(){e=c.initSeries(a);c.isDirtyLegend=!0;c.linkSeries();e.enabledDataSorting&&e.setData(a.data,!1);R(c,"afterAddSeries",{series:e});b&&c.redraw(d)}));return e};a.prototype.addAxis=function(a,b,d,c){return this.createAxis(b?"xAxis":"yAxis",{axis:a,redraw:d,animation:c})};a.prototype.addColorAxis=function(a,b,d){return this.createAxis("colorAxis",{axis:a,redraw:b,animation:d})};a.prototype.createAxis=
function(a,b){a=new w(this,X(b.axis,{index:this[a].length,isX:"xAxis"===a}));T(b.redraw,!0)&&this.redraw(b.animation);return a};a.prototype.showLoading=function(a){var b=this,d=b.options,c=d.loading,e=function(){h&&Q(h,{left:b.plotLeft+"px",top:b.plotTop+"px",width:b.plotWidth+"px",height:b.plotHeight+"px"})},h=b.loadingDiv,f=b.loadingSpan;h||(b.loadingDiv=h=S("div",{className:"highcharts-loading highcharts-loading-hidden"},null,b.container));f||(b.loadingSpan=f=S("span",{className:"highcharts-loading-inner"},
null,h),L(b,"redraw",e));h.className="highcharts-loading";v.setElementHTML(f,T(a,d.lang.loading,""));b.styledMode||(Q(h,M(c.style,{zIndex:10})),Q(f,c.labelStyle),b.loadingShown||(Q(h,{opacity:0,display:""}),q(h,{opacity:c.style.opacity||.5},{duration:c.showDuration||0})));b.loadingShown=!0;e()};a.prototype.hideLoading=function(){var a=this.options,b=this.loadingDiv;b&&(b.className="highcharts-loading highcharts-loading-hidden",this.styledMode||q(b,{opacity:0},{duration:a.loading.hideDuration||100,
complete:function(){Q(b,{display:"none"})}}));this.loadingShown=!1};a.prototype.update=function(a,b,d,c){var e=this,h={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},f=a.isResponsiveOptions,g=[],k,m;R(e,"update",{options:a});f||e.setResponsive(!1,!0);a=P(a,e.options);e.userOptions=X(e.userOptions,a);var A=a.chart;if(A){X(!0,e.options.chart,A);"className"in A&&e.setClassName(A.className);"reflow"in A&&e.setReflow(A.reflow);if("inverted"in A||"polar"in A||"type"in
A){e.propFromSeries();var p=!0}"alignTicks"in A&&(p=!0);"events"in A&&B(this,A);Y(A,function(a,b){-1!==e.propsRequireUpdateSeries.indexOf("chart."+b)&&(k=!0);-1!==e.propsRequireDirtyBox.indexOf(b)&&(e.isDirtyBox=!0);-1!==e.propsRequireReflow.indexOf(b)&&(f?e.isDirtyBox=!0:m=!0)});!e.styledMode&&A.style&&e.renderer.setStyle(e.options.chart.style||{})}!e.styledMode&&a.colors&&(this.options.colors=a.colors);a.time&&(this.time===G&&(this.time=new l(a.time)),X(!0,e.options.time,a.time));Y(a,function(b,
d){if(e[d]&&"function"===typeof e[d].update)e[d].update(b,!1);else if("function"===typeof e[h[d]])e[h[d]](b);else"colors"!==d&&-1===e.collectionsWithUpdate.indexOf(d)&&X(!0,e.options[d],a[d]);"chart"!==d&&-1!==e.propsRequireUpdateSeries.indexOf(d)&&(k=!0)});this.collectionsWithUpdate.forEach(function(b){if(a[b]){var c=[];e[b].forEach(function(a,b){a.options.isInternal||c.push(T(a.options.index,b))});ba(a[b]).forEach(function(a,h){var f=V(a.id),g;f&&(g=e.get(a.id));!g&&e[b]&&(g=e[b][c?c[h]:h])&&f&&
V(g.options.id)&&(g=void 0);g&&g.coll===b&&(g.update(a,!1),d&&(g.touched=!0));!g&&d&&e.collectionsWithInit[b]&&(e.collectionsWithInit[b][0].apply(e,[a].concat(e.collectionsWithInit[b][1]||[]).concat([!1])).touched=!0)});d&&e[b].forEach(function(a){a.touched||a.options.isInternal?delete a.touched:g.push(a)})}});g.forEach(function(a){a.chart&&a.remove&&a.remove(!1)});p&&e.axes.forEach(function(a){a.update({},!1)});k&&e.getSeriesOrderByLinks().forEach(function(a){a.chart&&a.update({},!1)},this);p=A&&
A.width;A=A&&(W(A.height)?ka(A.height,p||e.chartWidth):A.height);m||U(p)&&p!==e.chartWidth||U(A)&&A!==e.chartHeight?e.setSize(p,A,c):T(b,!0)&&e.redraw(c);R(e,"afterUpdate",{options:a,redraw:b,animation:c})};a.prototype.setSubtitle=function(a,b){this.applyDescription("subtitle",a);this.layOutTitles(b)};a.prototype.setCaption=function(a,b){this.applyDescription("caption",a);this.layOutTitles(b)};a.prototype.showResetZoom=function(){function a(){b.zoomOut()}var b=this,d=p.lang,c=b.options.chart.resetZoomButton,
e=c.theme,h=e.states,f="chart"===c.relativeTo||"spacingBox"===c.relativeTo?null:"scrollablePlotBox";R(this,"beforeShowResetZoom",null,function(){b.resetZoomButton=b.renderer.button(d.resetZoom,null,null,a,e,h&&h.hover).attr({align:c.position.align,title:d.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(c.position,!1,f)});R(this,"afterShowResetZoom")};a.prototype.zoomOut=function(){R(this,"selection",{resetSelection:!0},this.zoom)};a.prototype.zoom=function(a){var b=this,d=b.pointer,
c=b.inverted?d.mouseDownX:d.mouseDownY,e=!1,h;!a||a.resetSelection?(b.axes.forEach(function(a){h=a.zoom()}),d.initiated=!1):a.xAxis.concat(a.yAxis).forEach(function(a){var f=a.axis,g=b.inverted?f.left:f.top,k=b.inverted?g+f.width:g+f.height,l=f.isXAxis,A=!1;if(!l&&c>=g&&c<=k||l||!V(c))A=!0;d[l?"zoomX":"zoomY"]&&A&&(h=f.zoom(a.min,a.max),f.displayBtn&&(e=!0))});var f=b.resetZoomButton;e&&!f?b.showResetZoom():!e&&N(f)&&(b.resetZoomButton=f.destroy());h&&b.redraw(T(b.options.chart.animation,a&&a.animation,
100>b.pointCount))};a.prototype.pan=function(a,b){var d=this,c=d.hoverPoints;b="object"===typeof b?b:{enabled:b,type:"x"};var e=d.options.chart,h=d.options.mapNavigation&&d.options.mapNavigation.enabled;e&&e.panning&&(e.panning=b);var f=b.type,g;R(this,"pan",{originalEvent:a},function(){c&&c.forEach(function(a){a.setState()});var b=d.xAxis;"xy"===f?b=b.concat(d.yAxis):"y"===f&&(b=d.yAxis);var e={};b.forEach(function(b){if(b.options.panningEnabled&&!b.options.isInternal){var c=b.horiz,k=a[c?"chartX":
"chartY"];c=c?"mouseDownX":"mouseDownY";var l=d[c],A=b.minPointOffset||0,m=b.reversed&&!d.inverted||!b.reversed&&d.inverted?-1:1,p=b.getExtremes(),n=b.toValue(l-k,!0)+A*m,q=b.toValue(l+b.len-k,!0)-(A*m||b.isXAxis&&b.pointRangePadding||0),t=q<n;m=b.hasVerticalPanning();l=t?q:n;n=t?n:q;var N=b.panningState;!m||b.isXAxis||N&&!N.isDirty||b.series.forEach(function(a){var b=a.getProcessedData(!0);b=a.getExtremes(b.yData,!0);N||(N={startMin:Number.MAX_VALUE,startMax:-Number.MAX_VALUE});U(b.dataMin)&&U(b.dataMax)&&
(N.startMin=Math.min(T(a.options.threshold,Infinity),b.dataMin,N.startMin),N.startMax=Math.max(T(a.options.threshold,-Infinity),b.dataMax,N.startMax))});m=Math.min(T(N&&N.startMin,p.dataMin),A?p.min:b.toValue(b.toPixels(p.min)-b.minPixelPadding));q=Math.max(T(N&&N.startMax,p.dataMax),A?p.max:b.toValue(b.toPixels(p.max)+b.minPixelPadding));b.panningState=N;b.isOrdinal||(A=m-l,0<A&&(n+=A,l=m),A=n-q,0<A&&(n=q,l-=A),b.series.length&&l!==p.min&&n!==p.max&&l>=m&&n<=q&&(b.setExtremes(l,n,!1,!1,{trigger:"pan"}),
d.resetZoomButton||h||l===m||n===q||!f.match("y")||(d.showResetZoom(),b.displayBtn=!1),g=!0),e[c]=k)}});Y(e,function(a,b){d[b]=a});g&&d.redraw(!1);Q(d.container,{cursor:"move"})})};return a}();M(a.prototype,{callbacks:[],collectionsWithInit:{xAxis:[a.prototype.addAxis,[!0]],yAxis:[a.prototype.addAxis,[!1]],series:[a.prototype.addSeries]},collectionsWithUpdate:["xAxis","yAxis","series"],propsRequireDirtyBox:"backgroundColor borderColor borderWidth borderRadius plotBackgroundColor plotBackgroundImage plotBorderColor plotBorderWidth plotShadow shadow".split(" "),
propsRequireReflow:"margin marginTop marginRight marginBottom marginLeft spacing spacingTop spacingRight spacingBottom spacingLeft".split(" "),propsRequireUpdateSeries:"chart.inverted chart.polar chart.ignoreHiddenSeries chart.type colors plotOptions time tooltip".split(" ")});"";return a});M(a,"Core/Legend/LegendSymbol.js",[a["Core/Utilities.js"]],function(a){var r=a.merge,C=a.pick,E;(function(a){a.drawLineMarker=function(a){var x=this.options,u=a.symbolWidth,n=a.symbolHeight,m=n/2,g=this.chart.renderer,
c=this.legendGroup;a=a.baseline-Math.round(.3*a.fontMetrics.b);var e={},l=x.marker;this.chart.styledMode||(e={"stroke-width":x.lineWidth||0},x.dashStyle&&(e.dashstyle=x.dashStyle));this.legendLine=g.path([["M",0,a],["L",u,a]]).addClass("highcharts-graph").attr(e).add(c);l&&!1!==l.enabled&&u&&(x=Math.min(C(l.radius,m),m),0===this.symbol.indexOf("url")&&(l=r(l,{width:n,height:n}),x=0),this.legendSymbol=u=g.symbol(this.symbol,u/2-x,a-x,2*x,2*x,l).addClass("highcharts-point").add(c),u.isMarker=!0)};a.drawRectangle=
function(a,r){var u=a.symbolHeight,n=a.options.squareSymbol;r.legendSymbol=this.chart.renderer.rect(n?(a.symbolWidth-u)/2:0,a.baseline-u+1,n?u:a.symbolWidth,u,C(a.options.symbolRadius,u/2)).addClass("highcharts-point").attr({zIndex:3}).add(r.legendGroup)}})(E||(E={}));return E});M(a,"Core/Series/SeriesDefaults.js",[a["Core/Color/Palette.js"]],function(a){return{lineWidth:2,allowPointSelect:!1,crisp:!0,showCheckbox:!1,animation:{duration:1E3},events:{},marker:{enabledThreshold:2,lineColor:a.backgroundColor,
lineWidth:0,radius:4,states:{normal:{animation:!0},hover:{animation:{duration:50},enabled:!0,radiusPlus:2,lineWidthPlus:1},select:{fillColor:a.neutralColor20,lineColor:a.neutralColor100,lineWidth:2}}},point:{events:{}},dataLabels:{animation:{},align:"center",defer:!0,formatter:function(){var a=this.series.chart.numberFormatter;return"number"!==typeof this.y?"":a(this.y,-1)},padding:5,style:{fontSize:"11px",fontWeight:"bold",color:"contrast",textOutline:"1px contrast"},verticalAlign:"bottom",x:0,y:0},
cropThreshold:300,opacity:1,pointRange:0,softThreshold:!0,states:{normal:{animation:!0},hover:{animation:{duration:50},lineWidthPlus:1,marker:{},halo:{size:10,opacity:.25}},select:{animation:{duration:0}},inactive:{animation:{duration:50},opacity:.2}},stickyTracking:!0,turboThreshold:1E3,findNearestPointBy:"x"}});M(a,"Core/Series/Series.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/DefaultOptions.js"],a["Core/Foundation.js"],a["Core/Globals.js"],a["Core/Legend/LegendSymbol.js"],a["Core/Color/Palette.js"],
a["Core/Series/Point.js"],a["Core/Series/SeriesDefaults.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Renderer/SVG/SVGElement.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x,J,u,n,m,g){var c=a.animObject,e=a.setAnimation,l=w.defaultOptions,f=C.registerEventOptions,v=E.hasTouch,q=E.svg,k=E.win,r=n.seriesTypes,D=g.addEvent,B=g.arrayMax,O=g.arrayMin,t=g.clamp,h=g.cleanRecursively,d=g.correctFloat,b=g.defined,p=g.erase,G=g.error,y=g.extend,L=g.find,F=g.fireEvent,P=g.getNestedProperty,S=g.isArray,
Q=g.isNumber,V=g.isString,M=g.merge,H=g.objectEach,K=g.pick,la=g.removeEvent,ha=g.splat,R=g.syncTimeout;a=function(){function a(){this.zones=this.yAxis=this.xAxis=this.userOptions=this.tooltipOptions=this.processedYData=this.processedXData=this.points=this.options=this.linkedSeries=this.index=this.eventsToUnbind=this.eventOptions=this.data=this.chart=this._i=void 0}a.prototype.init=function(a,b){F(this,"init",{options:b});var d=this,c=a.series;this.eventsToUnbind=[];d.chart=a;d.options=d.setOptions(b);
b=d.options;d.linkedSeries=[];d.bindAxes();y(d,{name:b.name,state:"",visible:!1!==b.visible,selected:!0===b.selected});f(this,b);var e=b.events;if(e&&e.click||b.point&&b.point.events&&b.point.events.click||b.allowPointSelect)a.runTrackerClick=!0;d.getColor();d.getSymbol();d.parallelArrays.forEach(function(a){d[a+"Data"]||(d[a+"Data"]=[])});d.isCartesian&&(a.hasCartesianSeries=!0);var h;c.length&&(h=c[c.length-1]);d._i=K(h&&h._i,-1)+1;d.opacity=d.options.opacity;a.orderSeries(this.insert(c));b.dataSorting&&
b.dataSorting.enabled?d.setDataSortingOptions():d.points||d.data||d.setData(b.data,!1);F(this,"afterInit")};a.prototype.is=function(a){return r[a]&&this instanceof r[a]};a.prototype.insert=function(a){var b=this.options.index,d;if(Q(b)){for(d=a.length;d--;)if(b>=K(a[d].options.index,a[d]._i)){a.splice(d+1,0,this);break}-1===d&&a.unshift(this);d+=1}else a.push(this);return K(d,a.length-1)};a.prototype.bindAxes=function(){var a=this,b=a.options,d=a.chart,c;F(this,"bindAxes",null,function(){(a.axisTypes||
[]).forEach(function(e){var h=0;d[e].forEach(function(d){c=d.options;if(b[e]===h&&!c.isInternal||"undefined"!==typeof b[e]&&b[e]===c.id||"undefined"===typeof b[e]&&0===c.index)a.insert(d.series),a[e]=d,d.isDirty=!0;c.isInternal||h++});a[e]||a.optionalAxis===e||G(18,!0,d)})});F(this,"afterBindAxes")};a.prototype.updateParallelArrays=function(a,b){var d=a.series,c=arguments,e=Q(b)?function(c){var e="y"===c&&d.toYData?d.toYData(a):a[c];d[c+"Data"][b]=e}:function(a){Array.prototype[b].apply(d[a+"Data"],
Array.prototype.slice.call(c,2))};d.parallelArrays.forEach(e)};a.prototype.hasData=function(){return this.visible&&"undefined"!==typeof this.dataMax&&"undefined"!==typeof this.dataMin||this.visible&&this.yData&&0<this.yData.length};a.prototype.autoIncrement=function(a){var b=this.options,d=b.pointIntervalUnit,c=b.relativeXValue,e=this.chart.time,h=this.xIncrement,f;h=K(h,b.pointStart,0);this.pointInterval=f=K(this.pointInterval,b.pointInterval,1);c&&Q(a)&&(f*=a);d&&(b=new e.Date(h),"day"===d?e.set("Date",
b,e.get("Date",b)+f):"month"===d?e.set("Month",b,e.get("Month",b)+f):"year"===d&&e.set("FullYear",b,e.get("FullYear",b)+f),f=b.getTime()-h);if(c&&Q(a))return h+f;this.xIncrement=h+f;return h};a.prototype.setDataSortingOptions=function(){var a=this.options;y(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1});b(a.pointRange)||(a.pointRange=1)};a.prototype.setOptions=function(a){var d=this.chart,c=d.options,e=c.plotOptions,h=d.userOptions||{};a=M(a);d=d.styledMode;var f={plotOptions:e,
userOptions:a};F(this,"setOptions",f);var g=f.plotOptions[this.type],k=h.plotOptions||{};this.userOptions=f.userOptions;h=M(g,e.series,h.plotOptions&&h.plotOptions[this.type],a);this.tooltipOptions=M(l.tooltip,l.plotOptions.series&&l.plotOptions.series.tooltip,l.plotOptions[this.type].tooltip,c.tooltip.userOptions,e.series&&e.series.tooltip,e[this.type].tooltip,a.tooltip);this.stickyTracking=K(a.stickyTracking,k[this.type]&&k[this.type].stickyTracking,k.series&&k.series.stickyTracking,this.tooltipOptions.shared&&
!this.noSharedTooltip?!0:h.stickyTracking);null===g.marker&&delete h.marker;this.zoneAxis=h.zoneAxis;e=this.zones=(h.zones||[]).slice();!h.negativeColor&&!h.negativeFillColor||h.zones||(c={value:h[this.zoneAxis+"Threshold"]||h.threshold||0,className:"highcharts-negative"},d||(c.color=h.negativeColor,c.fillColor=h.negativeFillColor),e.push(c));e.length&&b(e[e.length-1].value)&&e.push(d?{}:{color:this.color,fillColor:this.fillColor});F(this,"afterSetOptions",{options:h});return h};a.prototype.getName=
function(){return K(this.options.name,"Series "+(this.index+1))};a.prototype.getCyclic=function(a,d,c){var e=this.chart,h=this.userOptions,f=a+"Index",g=a+"Counter",k=c?c.length:K(e.options.chart[a+"Count"],e[a+"Count"]);if(!d){var l=K(h[f],h["_"+f]);b(l)||(e.series.length||(e[g]=0),h["_"+f]=l=e[g]%k,e[g]+=1);c&&(d=c[l])}"undefined"!==typeof l&&(this[f]=l);this[a]=d};a.prototype.getColor=function(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color=x.neutralColor20:
this.getCyclic("color",this.options.color||l.plotOptions[this.type].color,this.chart.options.colors)};a.prototype.getPointsCollection=function(){return(this.hasGroupedData?this.points:this.data)||[]};a.prototype.getSymbol=function(){this.getCyclic("symbol",this.options.marker.symbol,this.chart.options.symbols)};a.prototype.findPointIndex=function(a,b){var d=a.id,c=a.x,e=this.points,h=this.options.dataSorting,f,g;if(d)h=this.chart.get(d),h instanceof J&&(f=h);else if(this.linkedParent||this.enabledDataSorting||
this.options.relativeXValue)if(f=function(b){return!b.touched&&b.index===a.index},h&&h.matchByName?f=function(b){return!b.touched&&b.name===a.name}:this.options.relativeXValue&&(f=function(b){return!b.touched&&b.options.x===a.x}),f=L(e,f),!f)return;if(f){var k=f&&f.index;"undefined"!==typeof k&&(g=!0)}"undefined"===typeof k&&Q(c)&&(k=this.xData.indexOf(c,b));-1!==k&&"undefined"!==typeof k&&this.cropped&&(k=k>=this.cropStart?k-this.cropStart:k);!g&&Q(k)&&e[k]&&e[k].touched&&(k=void 0);return k};a.prototype.updateData=
function(a,d){var c=this.options,e=c.dataSorting,h=this.points,f=[],g=this.requireSorting,k=a.length===h.length,l,m,A,p=!0;this.xIncrement=null;a.forEach(function(a,d){var m=b(a)&&this.pointClass.prototype.optionsToObject.call({series:this},a)||{},p=m.x;if(m.id||Q(p)){if(m=this.findPointIndex(m,A),-1===m||"undefined"===typeof m?f.push(a):h[m]&&a!==c.data[m]?(h[m].update(a,!1,null,!1),h[m].touched=!0,g&&(A=m+1)):h[m]&&(h[m].touched=!0),!k||d!==m||e&&e.enabled||this.hasDerivedData)l=!0}else f.push(a)},
this);if(l)for(a=h.length;a--;)(m=h[a])&&!m.touched&&m.remove&&m.remove(!1,d);else!k||e&&e.enabled?p=!1:(a.forEach(function(a,b){a!==h[b].y&&h[b].update&&h[b].update(a,!1,null,!1)}),f.length=0);h.forEach(function(a){a&&(a.touched=!1)});if(!p)return!1;f.forEach(function(a){this.addPoint(a,!1,null,null,!1)},this);null===this.xIncrement&&this.xData&&this.xData.length&&(this.xIncrement=B(this.xData),this.autoIncrement());return!0};a.prototype.setData=function(a,b,d,c){var e=this,h=e.points,f=h&&h.length||
0,g=e.options,k=e.chart,l=g.dataSorting,m=e.xAxis,A=g.turboThreshold,p=this.xData,n=this.yData,q=e.pointArrayMap;q=q&&q.length;var t=g.keys,v,r=0,B=1,y=null;a=a||[];var N=a.length;b=K(b,!0);l&&l.enabled&&(a=this.sortData(a));!1!==c&&N&&f&&!e.cropped&&!e.hasGroupedData&&e.visible&&!e.isSeriesBoosting&&(v=this.updateData(a,d));if(!v){e.xIncrement=null;e.colorCounter=0;this.parallelArrays.forEach(function(a){e[a+"Data"].length=0});if(A&&N>A)if(y=e.getFirstValidPoint(a),Q(y))for(d=0;d<N;d++)p[d]=this.autoIncrement(),
n[d]=a[d];else if(S(y))if(q)for(d=0;d<N;d++)c=a[d],p[d]=c[0],n[d]=c.slice(1,q+1);else for(t&&(r=t.indexOf("x"),B=t.indexOf("y"),r=0<=r?r:0,B=0<=B?B:1),d=0;d<N;d++)c=a[d],p[d]=c[r],n[d]=c[B];else G(12,!1,k);else for(d=0;d<N;d++)"undefined"!==typeof a[d]&&(c={series:e},e.pointClass.prototype.applyOptions.apply(c,[a[d]]),e.updateParallelArrays(c,d));n&&V(n[0])&&G(14,!0,k);e.data=[];e.options.data=e.userOptions.data=a;for(d=f;d--;)h[d]&&h[d].destroy&&h[d].destroy();m&&(m.minRange=m.userMinRange);e.isDirty=
k.isDirtyBox=!0;e.isDirtyData=!!h;d=!1}"point"===g.legendType&&(this.processData(),this.generatePoints());b&&k.redraw(d)};a.prototype.sortData=function(a){var d=this,c=d.options.dataSorting.sortKey||"y",e=function(a,d){return b(d)&&a.pointClass.prototype.optionsToObject.call({series:a},d)||{}};a.forEach(function(b,c){a[c]=e(d,b);a[c].index=c},this);a.concat().sort(function(a,b){a=P(c,a);b=P(c,b);return b<a?-1:b>a?1:0}).forEach(function(a,b){a.x=b},this);d.linkedSeries&&d.linkedSeries.forEach(function(b){var d=
b.options,c=d.data;d.dataSorting&&d.dataSorting.enabled||!c||(c.forEach(function(d,h){c[h]=e(b,d);a[h]&&(c[h].x=a[h].x,c[h].index=h)}),b.setData(c,!1))});return a};a.prototype.getProcessedData=function(a){var b=this.xAxis,d=this.options,c=d.cropThreshold,e=a||this.getExtremesFromAll||d.getExtremesFromAll,h=this.isCartesian;a=b&&b.val2lin;d=!(!b||!b.logarithmic);var f=0,g=this.xData,k=this.yData,l=this.requireSorting;var m=!1;var A=g.length;if(b){m=b.getExtremes();var p=m.min;var n=m.max;m=b.categories&&
!b.names.length}if(h&&this.sorted&&!e&&(!c||A>c||this.forceCrop))if(g[A-1]<p||g[0]>n)g=[],k=[];else if(this.yData&&(g[0]<p||g[A-1]>n)){var q=this.cropData(this.xData,this.yData,p,n);g=q.xData;k=q.yData;f=q.start;q=!0}for(c=g.length||1;--c;)if(b=d?a(g[c])-a(g[c-1]):g[c]-g[c-1],0<b&&("undefined"===typeof t||b<t))var t=b;else 0>b&&l&&!m&&(G(15,!1,this.chart),l=!1);return{xData:g,yData:k,cropped:q,cropStart:f,closestPointRange:t}};a.prototype.processData=function(a){var b=this.xAxis;if(this.isCartesian&&
!this.isDirty&&!b.isDirty&&!this.yAxis.isDirty&&!a)return!1;a=this.getProcessedData();this.cropped=a.cropped;this.cropStart=a.cropStart;this.processedXData=a.xData;this.processedYData=a.yData;this.closestPointRange=this.basePointRange=a.closestPointRange};a.prototype.cropData=function(a,b,d,c,e){var h=a.length,f,g=0,k=h;e=K(e,this.cropShoulder);for(f=0;f<h;f++)if(a[f]>=d){g=Math.max(0,f-e);break}for(d=f;d<h;d++)if(a[d]>c){k=d+e;break}return{xData:a.slice(g,k),yData:b.slice(g,k),start:g,end:k}};a.prototype.generatePoints=
function(){var a=this.options,b=a.data,d=this.processedXData,c=this.processedYData,e=this.pointClass,h=d.length,f=this.cropStart||0,g=this.hasGroupedData,k=a.keys,l=[];a=a.dataGrouping&&a.dataGrouping.groupAll?f:0;var m,p,n=this.data;if(!n&&!g){var q=[];q.length=b.length;n=this.data=q}k&&g&&(this.options.keys=!1);for(p=0;p<h;p++){q=f+p;if(g){var t=(new e).init(this,[d[p]].concat(ha(c[p])));t.dataGroup=this.groupMap[a+p];t.dataGroup.options&&(t.options=t.dataGroup.options,y(t,t.dataGroup.options),
delete t.dataLabels)}else(t=n[q])||"undefined"===typeof b[q]||(n[q]=t=(new e).init(this,b[q],d[p]));t&&(t.index=g?a+p:q,l[p]=t)}this.options.keys=k;if(n&&(h!==(m=n.length)||g))for(p=0;p<m;p++)p!==f||g||(p+=h),n[p]&&(n[p].destroyElements(),n[p].plotX=void 0);this.data=n;this.points=l;F(this,"afterGeneratePoints")};a.prototype.getXExtremes=function(a){return{min:O(a),max:B(a)}};a.prototype.getExtremes=function(a,b){var d=this.xAxis,c=this.yAxis,e=this.processedXData||this.xData,h=[],f=this.requireSorting?
this.cropShoulder:0;c=c?c.positiveValuesOnly:!1;var g,k=0,l=0,m=0;a=a||this.stackedYData||this.processedYData||[];var p=a.length;if(d){var n=d.getExtremes();k=n.min;l=n.max}for(g=0;g<p;g++){var A=e[g];n=a[g];var q=(Q(n)||S(n))&&(n.length||0<n||!c);A=b||this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||!d||(e[g+f]||A)>=k&&(e[g-f]||A)<=l;if(q&&A)if(q=n.length)for(;q--;)Q(n[q])&&(h[m++]=n[q]);else h[m++]=n}a={dataMin:O(h),dataMax:B(h)};F(this,"afterGetExtremes",{dataExtremes:a});
return a};a.prototype.applyExtremes=function(){var a=this.getExtremes();this.dataMin=a.dataMin;this.dataMax=a.dataMax;return a};a.prototype.getFirstValidPoint=function(a){for(var b=a.length,d=0,c=null;null===c&&d<b;)c=a[d],d++;return c};a.prototype.translate=function(){this.processedXData||this.processData();this.generatePoints();var a=this.options,c=a.stacking,e=this.xAxis,h=e.categories,f=this.enabledDataSorting,g=this.yAxis,k=this.points,l=k.length,m=!!this.modifyValue,p=this.pointPlacementToXValue(),
n=!!p,q=a.threshold,v=a.startFromThreshold?q:0,r=this.zoneAxis||"y",B,y,I=Number.MAX_VALUE;for(B=0;B<l;B++){var D=k[B],u=D.x,G=void 0,x=void 0,w=D.y,L=D.low,z=c&&g.stacking&&g.stacking.stacks[(this.negStacks&&w<(v?0:q)?"-":"")+this.stackKey];if(g.positiveValuesOnly&&!g.validatePositiveValue(w)||e.positiveValuesOnly&&!e.validatePositiveValue(u))D.isNull=!0;D.plotX=y=d(t(e.translate(u,0,0,0,1,p,"flags"===this.type),-1E5,1E5));if(c&&this.visible&&z&&z[u]){var C=this.getStackIndicator(C,u,this.index);
D.isNull||(G=z[u],x=G.points[C.key])}S(x)&&(L=x[0],w=x[1],L===v&&C.key===z[u].base&&(L=K(Q(q)&&q,g.min)),g.positiveValuesOnly&&0>=L&&(L=null),D.total=D.stackTotal=G.total,D.percentage=G.total&&D.y/G.total*100,D.stackY=w,this.irregularWidths||G.setOffset(this.pointXOffset||0,this.barW||0));D.yBottom=b(L)?t(g.translate(L,0,1,0,1),-1E5,1E5):null;m&&(w=this.modifyValue(w,D));D.plotY=void 0;Q(w)&&(G=g.translate(w,!1,!0,!1,!0),"undefined"!==typeof G&&(D.plotY=t(G,-1E5,1E5)));D.isInside=this.isPointInside(D);
D.clientX=n?d(e.translate(u,0,0,0,1,p)):y;D.negative=D[r]<(a[r+"Threshold"]||q||0);D.category=h&&"undefined"!==typeof h[D.x]?h[D.x]:D.x;if(!D.isNull&&!1!==D.visible){"undefined"!==typeof H&&(I=Math.min(I,Math.abs(y-H)));var H=y}D.zone=this.zones.length&&D.getZone();!D.graphic&&this.group&&f&&(D.isNew=!0)}this.closestPointRangePx=I;F(this,"afterTranslate")};a.prototype.getValidPoints=function(a,b,d){var c=this.chart;return(a||this.points||[]).filter(function(a){return b&&!c.isInsidePlot(a.plotX,a.plotY,
{inverted:c.inverted})?!1:!1!==a.visible&&(d||!a.isNull)})};a.prototype.getClipBox=function(a,b){var d=this.options,c=this.chart,e=c.inverted,h=this.xAxis,f=h&&this.yAxis,g=c.options.chart.scrollablePlotArea||{};a&&!1===d.clip&&f?a=e?{y:-c.chartWidth+f.len+f.pos,height:c.chartWidth,width:c.chartHeight,x:-c.chartHeight+h.len+h.pos}:{y:-f.pos,height:c.chartHeight,width:c.chartWidth,x:-h.pos}:(a=this.clipBox||c.clipBox,b&&(a.width=c.plotSizeX,a.x=(c.scrollablePixelsX||0)*(g.scrollPositionX||0)));return b?
{width:a.width,x:a.x}:a};a.prototype.getSharedClipKey=function(a){if(this.sharedClipKey)return this.sharedClipKey;var b=[a&&a.duration,a&&a.easing,a&&a.defer,this.getClipBox(a).height,this.options.xAxis,this.options.yAxis].join();if(!1!==this.options.clip||a)this.sharedClipKey=b;return b};a.prototype.setClip=function(a){var b=this.chart,d=this.options,c=b.renderer,e=b.inverted,h=this.clipBox,f=this.getClipBox(a),g=this.getSharedClipKey(a),k=b.sharedClips[g],l=b.sharedClips[g+"m"];a&&(f.width=0,e&&
(f.x=b.plotHeight+(!1!==d.clip?0:b.plotTop)));k?b.hasLoaded||k.attr(f):(a&&(b.sharedClips[g+"m"]=l=c.clipRect(e?(b.plotSizeX||0)+99:-99,e?-b.plotLeft:-b.plotTop,99,e?b.chartWidth:b.chartHeight)),b.sharedClips[g]=k=c.clipRect(f),k.count={length:0});a&&!k.count[this.index]&&(k.count[this.index]=!0,k.count.length+=1);if(!1!==d.clip||a)this.group.clip(a||h?k:b.clipRect),this.markerGroup.clip(l);a||(k.count[this.index]&&(delete k.count[this.index],--k.count.length),0===k.count.length&&(h||(b.sharedClips[g]=
k.destroy()),l&&(b.sharedClips[g+"m"]=l.destroy())))};a.prototype.animate=function(a){var b=this.chart,d=c(this.options.animation),e=this.sharedClipKey;if(a)this.setClip(d);else if(e){a=b.sharedClips[e];e=b.sharedClips[e+"m"];var h=this.getClipBox(d,!0);a&&a.animate(h,d);e&&e.animate({width:h.width+99,x:h.x-(b.inverted?0:99)},d)}};a.prototype.afterAnimate=function(){this.setClip();F(this,"afterAnimate");this.finishedAnimating=!0};a.prototype.drawPoints=function(){var a=this.points,b=this.chart,d=
this.options.marker,c=this[this.specialGroup]||this.markerGroup,e=this.xAxis,h=K(d.enabled,!e||e.isRadial?!0:null,this.closestPointRangePx>=d.enabledThreshold*d.radius),f,g;if(!1!==d.enabled||this._hasPointMarkers)for(f=0;f<a.length;f++){var k=a[f];var l=(g=k.graphic)?"animate":"attr";var m=k.marker||{};var p=!!k.marker;if((h&&"undefined"===typeof m.enabled||m.enabled)&&!k.isNull&&!1!==k.visible){var n=K(m.symbol,this.symbol,"rect");var q=this.markerAttribs(k,k.selected&&"select");this.enabledDataSorting&&
(k.startXPos=e.reversed?-(q.width||0):e.width);var t=!1!==k.isInside;g?g[t?"show":"hide"](t).animate(q):t&&(0<(q.width||0)||k.hasImage)&&(k.graphic=g=b.renderer.symbol(n,q.x,q.y,q.width,q.height,p?m:d).add(c),this.enabledDataSorting&&b.hasRendered&&(g.attr({x:k.startXPos}),l="animate"));g&&"animate"===l&&g[t?"show":"hide"](t).animate(q);if(g&&!b.styledMode)g[l](this.pointAttribs(k,k.selected&&"select"));g&&g.addClass(k.getClassName(),!0)}else g&&(k.graphic=g.destroy())}};a.prototype.markerAttribs=
function(a,b){var d=this.options,c=d.marker,e=a.marker||{},h=e.symbol||c.symbol,f=K(e.radius,c.radius);b&&(c=c.states[b],b=e.states&&e.states[b],f=K(b&&b.radius,c&&c.radius,f+(c&&c.radiusPlus||0)));a.hasImage=h&&0===h.indexOf("url");a.hasImage&&(f=0);a={x:d.crisp?Math.floor(a.plotX-f):a.plotX-f,y:a.plotY-f};f&&(a.width=a.height=2*f);return a};a.prototype.pointAttribs=function(a,b){var d=this.options.marker,c=a&&a.options,e=c&&c.marker||{},h=c&&c.color,f=a&&a.color,g=a&&a.zone&&a.zone.color,k=this.color;
a=K(e.lineWidth,d.lineWidth);c=1;k=h||g||f||k;h=e.fillColor||d.fillColor||k;f=e.lineColor||d.lineColor||k;b=b||"normal";d=d.states[b];b=e.states&&e.states[b]||{};a=K(b.lineWidth,d.lineWidth,a+K(b.lineWidthPlus,d.lineWidthPlus,0));h=b.fillColor||d.fillColor||h;f=b.lineColor||d.lineColor||f;c=K(b.opacity,d.opacity,c);return{stroke:f,"stroke-width":a,fill:h,opacity:c}};a.prototype.destroy=function(a){var b=this,d=b.chart,c=/AppleWebKit\/533/.test(k.navigator.userAgent),e=b.data||[],h,f,l,n;F(b,"destroy");
this.removeEvents(a);(b.axisTypes||[]).forEach(function(a){(n=b[a])&&n.series&&(p(n.series,b),n.isDirty=n.forceRedraw=!0)});b.legendItem&&b.chart.legend.destroyItem(b);for(f=e.length;f--;)(l=e[f])&&l.destroy&&l.destroy();b.clips&&b.clips.forEach(function(a){return a.destroy()});g.clearTimeout(b.animationTimeout);H(b,function(a,b){a instanceof m&&!a.survive&&(h=c&&"group"===b?"hide":"destroy",a[h]())});d.hoverSeries===b&&(d.hoverSeries=void 0);p(d.series,b);d.orderSeries();H(b,function(d,c){a&&"hcEvents"===
c||delete b[c]})};a.prototype.applyZones=function(){var a=this,b=this.chart,d=b.renderer,c=this.zones,e=this.clips||[],h=this.graph,f=this.area,g=Math.max(b.chartWidth,b.chartHeight),k=this[(this.zoneAxis||"y")+"Axis"],l=b.inverted,m,p,n,q,v,r,B,y,D=!1;if(c.length&&(h||f)&&k&&"undefined"!==typeof k.min){var I=k.reversed;var F=k.horiz;h&&!this.showLine&&h.hide();f&&f.hide();var u=k.getExtremes();c.forEach(function(c,A){m=I?F?b.plotWidth:0:F?0:k.toPixels(u.min)||0;m=t(K(p,m),0,g);p=t(Math.round(k.toPixels(K(c.value,
u.max),!0)||0),0,g);D&&(m=p=k.toPixels(u.max));q=Math.abs(m-p);v=Math.min(m,p);r=Math.max(m,p);k.isXAxis?(n={x:l?r:v,y:0,width:q,height:g},F||(n.x=b.plotHeight-n.x)):(n={x:0,y:l?r:v,width:g,height:q},F&&(n.y=b.plotWidth-n.y));l&&d.isVML&&(n=k.isXAxis?{x:0,y:I?v:r,height:n.width,width:b.chartWidth}:{x:n.y-b.plotLeft-b.spacingBox.x,y:0,width:n.height,height:b.chartHeight});e[A]?e[A].animate(n):e[A]=d.clipRect(n);B=a["zone-area-"+A];y=a["zone-graph-"+A];h&&y&&y.clip(e[A]);f&&B&&B.clip(e[A]);D=c.value>
u.max;a.resetZones&&0===p&&(p=void 0)});this.clips=e}else a.visible&&(h&&h.show(!0),f&&f.show(!0))};a.prototype.invertGroups=function(a){function b(){["group","markerGroup"].forEach(function(b){d[b]&&(c.renderer.isVML&&d[b].attr({width:d.yAxis.len,height:d.xAxis.len}),d[b].width=d.yAxis.len,d[b].height=d.xAxis.len,d[b].invert(d.isRadialSeries?!1:a))})}var d=this,c=d.chart;d.xAxis&&(d.eventsToUnbind.push(D(c,"resize",b)),b(),d.invertGroups=b)};a.prototype.plotGroup=function(a,d,c,e,h){var f=this[a],
g=!f;c={visibility:c,zIndex:e||.1};"undefined"===typeof this.opacity||this.chart.styledMode||"inactive"===this.state||(c.opacity=this.opacity);g&&(this[a]=f=this.chart.renderer.g().add(h));f.addClass("highcharts-"+d+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(b(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(f.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0);f.attr(c)[g?"attr":"animate"](this.getPlotBox());return f};
a.prototype.getPlotBox=function(){var a=this.chart,b=this.xAxis,d=this.yAxis;a.inverted&&(b=d,d=this.xAxis);return{translateX:b?b.left:a.plotLeft,translateY:d?d.top:a.plotTop,scaleX:1,scaleY:1}};a.prototype.removeEvents=function(a){a||la(this);this.eventsToUnbind.length&&(this.eventsToUnbind.forEach(function(a){a()}),this.eventsToUnbind.length=0)};a.prototype.render=function(){var a=this,b=a.chart,d=a.options,e=c(d.animation),h=a.visible?"inherit":"hidden",f=d.zIndex,g=a.hasRendered,k=b.seriesGroup,
l=b.inverted,m=!a.finishedAnimating&&b.renderer.isSVG&&e.duration;F(this,"render");var p=a.plotGroup("group","series",h,f,k);a.markerGroup=a.plotGroup("markerGroup","markers",h,f,k);m&&a.animate&&a.animate(!0);p.inverted=K(a.invertible,a.isCartesian)?l:!1;a.drawGraph&&(a.drawGraph(),a.applyZones());a.visible&&a.drawPoints();a.drawDataLabels&&a.drawDataLabels();a.redrawPoints&&a.redrawPoints();a.drawTracker&&!1!==a.options.enableMouseTracking&&a.drawTracker();a.invertGroups(l);!1===d.clip||a.sharedClipKey||
g||p.clip(b.clipRect);m&&a.animate&&a.animate();g||(m&&e.defer&&(m+=e.defer),a.animationTimeout=R(function(){a.afterAnimate()},m||0));a.isDirty=!1;a.hasRendered=!0;F(a,"afterRender")};a.prototype.redraw=function(){var a=this.chart,b=this.isDirty||this.isDirtyData,d=this.group,c=this.xAxis,e=this.yAxis;d&&(a.inverted&&d.attr({width:a.plotWidth,height:a.plotHeight}),d.animate({translateX:K(c&&c.left,a.plotLeft),translateY:K(e&&e.top,a.plotTop)}));this.translate();this.render();b&&delete this.kdTree};
a.prototype.searchPoint=function(a,b){var d=this.xAxis,c=this.yAxis,e=this.chart.inverted;return this.searchKDTree({clientX:e?d.len-a.chartY+d.pos:a.chartX-d.pos,plotY:e?c.len-a.chartX+c.pos:a.chartY-c.pos},b,a)};a.prototype.buildKDTree=function(a){function b(a,c,e){var h=a&&a.length;if(h){var f=d.kdAxisArray[c%e];a.sort(function(a,b){return a[f]-b[f]});h=Math.floor(h/2);return{point:a[h],left:b(a.slice(0,h),c+1,e),right:b(a.slice(h+1),c+1,e)}}}this.buildingKdTree=!0;var d=this,c=-1<d.options.findNearestPointBy.indexOf("y")?
2:1;delete d.kdTree;R(function(){d.kdTree=b(d.getValidPoints(null,!d.directTouch),c,c);d.buildingKdTree=!1},d.options.kdNow||a&&"touchstart"===a.type?0:1)};a.prototype.searchKDTree=function(a,d,c){function e(a,d,c,l){var m=d.point,p=h.kdAxisArray[c%l],n=m,q=b(a[f])&&b(m[f])?Math.pow(a[f]-m[f],2):null;var t=b(a[g])&&b(m[g])?Math.pow(a[g]-m[g],2):null;t=(q||0)+(t||0);m.dist=b(t)?Math.sqrt(t):Number.MAX_VALUE;m.distX=b(q)?Math.sqrt(q):Number.MAX_VALUE;p=a[p]-m[p];t=0>p?"left":"right";q=0>p?"right":"left";
d[t]&&(t=e(a,d[t],c+1,l),n=t[k]<n[k]?t:m);d[q]&&Math.sqrt(p*p)<n[k]&&(a=e(a,d[q],c+1,l),n=a[k]<n[k]?a:n);return n}var h=this,f=this.kdAxisArray[0],g=this.kdAxisArray[1],k=d?"distX":"dist";d=-1<h.options.findNearestPointBy.indexOf("y")?2:1;this.kdTree||this.buildingKdTree||this.buildKDTree(c);if(this.kdTree)return e(a,this.kdTree,d,d)};a.prototype.pointPlacementToXValue=function(){var a=this.options,b=a.pointRange,d=this.xAxis;a=a.pointPlacement;"between"===a&&(a=d.reversed?-.5:.5);return Q(a)?a*(b||
d.pointRange):0};a.prototype.isPointInside=function(a){return"undefined"!==typeof a.plotY&&"undefined"!==typeof a.plotX&&0<=a.plotY&&a.plotY<=this.yAxis.len&&0<=a.plotX&&a.plotX<=this.xAxis.len};a.prototype.drawTracker=function(){var a=this,b=a.options,d=b.trackByArea,c=[].concat(d?a.areaPath:a.graphPath),e=a.chart,h=e.pointer,f=e.renderer,g=e.options.tooltip.snap,k=a.tracker,l=function(b){if(e.hoverSeries!==a)a.onMouseOver()},m="rgba(192,192,192,"+(q?.0001:.002)+")";k?k.attr({d:c}):a.graph&&(a.tracker=
f.path(c).attr({visibility:a.visible?"visible":"hidden",zIndex:2}).addClass(d?"highcharts-tracker-area":"highcharts-tracker-line").add(a.group),e.styledMode||a.tracker.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:m,fill:d?m:"none","stroke-width":a.graph.strokeWidth()+(d?0:2*g)}),[a.tracker,a.markerGroup,a.dataLabelsGroup].forEach(function(a){if(a&&(a.addClass("highcharts-tracker").on("mouseover",l).on("mouseout",function(a){h.onTrackerMouseOut(a)}),b.cursor&&!e.styledMode&&a.css({cursor:b.cursor}),
v))a.on("touchstart",l)}));F(this,"afterDrawTracker")};a.prototype.addPoint=function(a,b,d,c,e){var h=this.options,f=this.data,g=this.chart,k=this.xAxis;k=k&&k.hasNames&&k.names;var l=h.data,m=this.xData,p;b=K(b,!0);var n={series:this};this.pointClass.prototype.applyOptions.apply(n,[a]);var q=n.x;var t=m.length;if(this.requireSorting&&q<m[t-1])for(p=!0;t&&m[t-1]>q;)t--;this.updateParallelArrays(n,"splice",t,0,0);this.updateParallelArrays(n,t);k&&n.name&&(k[q]=n.name);l.splice(t,0,a);p&&(this.data.splice(t,
0,null),this.processData());"point"===h.legendType&&this.generatePoints();d&&(f[0]&&f[0].remove?f[0].remove(!1):(f.shift(),this.updateParallelArrays(n,"shift"),l.shift()));!1!==e&&F(this,"addPoint",{point:n});this.isDirtyData=this.isDirty=!0;b&&g.redraw(c)};a.prototype.removePoint=function(a,b,d){var c=this,h=c.data,f=h[a],g=c.points,k=c.chart,l=function(){g&&g.length===h.length&&g.splice(a,1);h.splice(a,1);c.options.data.splice(a,1);c.updateParallelArrays(f||{series:c},"splice",a,1);f&&f.destroy();
c.isDirty=!0;c.isDirtyData=!0;b&&k.redraw()};e(d,k);b=K(b,!0);f?f.firePointEvent("remove",null,l):l()};a.prototype.remove=function(a,b,d,c){function e(){h.destroy(c);f.isDirtyLegend=f.isDirtyBox=!0;f.linkSeries();K(a,!0)&&f.redraw(b)}var h=this,f=h.chart;!1!==d?F(h,"remove",null,e):e()};a.prototype.update=function(a,b){a=h(a,this.userOptions);F(this,"update",{options:a});var d=this,c=d.chart,e=d.userOptions,f=d.initialType||d.type,g=c.options.plotOptions,k=r[f].prototype,l=d.finishedAnimating&&{animation:!1},
m={},p,n=["eventOptions","navigatorSeries","baseSeries"],q=a.type||e.type||c.options.chart.type,t=!(this.hasDerivedData||q&&q!==this.type||"undefined"!==typeof a.pointStart||"undefined"!==typeof a.pointInterval||"undefined"!==typeof a.relativeXValue||d.hasOptionChanged("dataGrouping")||d.hasOptionChanged("pointStart")||d.hasOptionChanged("pointInterval")||d.hasOptionChanged("pointIntervalUnit")||d.hasOptionChanged("keys"));q=q||f;t&&(n.push("data","isDirtyData","points","processedXData","processedYData",
"xIncrement","cropped","_hasPointMarkers","_hasPointLabels","clips","nodes","layout","mapMap","mapData","minY","maxY","minX","maxX"),!1!==a.visible&&n.push("area","graph"),d.parallelArrays.forEach(function(a){n.push(a+"Data")}),a.data&&(a.dataSorting&&y(d.options.dataSorting,a.dataSorting),this.setData(a.data,!1)));a=M(e,l,{index:"undefined"===typeof e.index?d.index:e.index,pointStart:K(g&&g.series&&g.series.pointStart,e.pointStart,d.xData[0])},!t&&{data:d.options.data},a);t&&a.data&&(a.data=d.options.data);
n=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(n);n.forEach(function(a){n[a]=d[a];delete d[a]});g=!1;if(r[q]){if(g=q!==d.type,d.remove(!1,!1,!1,!0),g)if(Object.setPrototypeOf)Object.setPrototypeOf(d,r[q].prototype);else{l=Object.hasOwnProperty.call(d,"hcEvents")&&d.hcEvents;for(p in k)d[p]=void 0;y(d,r[q].prototype);l?d.hcEvents=l:delete d.hcEvents}}else G(17,!0,c,{missingModuleFor:q});n.forEach(function(a){d[a]=n[a]});d.init(c,a);if(t&&this.points){var v=d.options;!1===v.visible?
(m.graphic=1,m.dataLabel=1):d._hasPointLabels||(a=v.marker,k=v.dataLabels,!a||!1!==a.enabled&&(e.marker&&e.marker.symbol)===a.symbol||(m.graphic=1),k&&!1===k.enabled&&(m.dataLabel=1));this.points.forEach(function(a){a&&a.series&&(a.resolveColor(),Object.keys(m).length&&a.destroyElements(m),!1===v.showInLegend&&a.legendItem&&c.legend.destroyItem(a))},this)}d.initialType=f;c.linkSeries();g&&d.linkedSeries.length&&(d.isDirtyData=!0);F(this,"afterUpdate");K(b,!0)&&c.redraw(t?void 0:!1)};a.prototype.setName=
function(a){this.name=this.options.name=this.userOptions.name=a;this.chart.isDirtyLegend=!0};a.prototype.hasOptionChanged=function(a){var b=this.options[a],d=this.chart.options.plotOptions,c=this.userOptions[a];return c?b!==c:b!==K(d&&d[this.type]&&d[this.type][a],d&&d.series&&d.series[a],b)};a.prototype.onMouseOver=function(){var a=this.chart,b=a.hoverSeries;a.pointer.setHoverChartIndex();if(b&&b!==this)b.onMouseOut();this.options.events.mouseOver&&F(this,"mouseOver");this.setState("hover");a.hoverSeries=
this};a.prototype.onMouseOut=function(){var a=this.options,b=this.chart,d=b.tooltip,c=b.hoverPoint;b.hoverSeries=null;if(c)c.onMouseOut();this&&a.events.mouseOut&&F(this,"mouseOut");!d||this.stickyTracking||d.shared&&!this.noSharedTooltip||d.hide();b.series.forEach(function(a){a.setState("",!0)})};a.prototype.setState=function(a,b){var d=this,c=d.options,e=d.graph,h=c.inactiveOtherPoints,f=c.states,g=K(f[a||"normal"]&&f[a||"normal"].animation,d.chart.options.chart.animation),k=c.lineWidth,l=0,m=c.opacity;
a=a||"";if(d.state!==a&&([d.group,d.markerGroup,d.dataLabelsGroup].forEach(function(b){b&&(d.state&&b.removeClass("highcharts-series-"+d.state),a&&b.addClass("highcharts-series-"+a))}),d.state=a,!d.chart.styledMode)){if(f[a]&&!1===f[a].enabled)return;a&&(k=f[a].lineWidth||k+(f[a].lineWidthPlus||0),m=K(f[a].opacity,m));if(e&&!e.dashstyle)for(c={"stroke-width":k},e.animate(c,g);d["zone-graph-"+l];)d["zone-graph-"+l].animate(c,g),l+=1;h||[d.group,d.markerGroup,d.dataLabelsGroup,d.labelBySeries].forEach(function(a){a&&
a.animate({opacity:m},g)})}b&&h&&d.points&&d.setAllPointsToState(a||void 0)};a.prototype.setAllPointsToState=function(a){this.points.forEach(function(b){b.setState&&b.setState(a)})};a.prototype.setVisible=function(a,b){var d=this,c=d.chart,e=d.legendItem,h=c.options.chart.ignoreHiddenSeries,f=d.visible,g=(d.visible=a=d.options.visible=d.userOptions.visible="undefined"===typeof a?!f:a)?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(function(a){if(d[a])d[a][g]()});if(c.hoverSeries===
d||(c.hoverPoint&&c.hoverPoint.series)===d)d.onMouseOut();e&&c.legend.colorizeItem(d,a);d.isDirty=!0;d.options.stacking&&c.series.forEach(function(a){a.options.stacking&&a.visible&&(a.isDirty=!0)});d.linkedSeries.forEach(function(b){b.setVisible(a,!1)});h&&(c.isDirtyBox=!0);F(d,g);!1!==b&&c.redraw()};a.prototype.show=function(){this.setVisible(!0)};a.prototype.hide=function(){this.setVisible(!1)};a.prototype.select=function(a){this.selected=a=this.options.selected="undefined"===typeof a?!this.selected:
a;this.checkbox&&(this.checkbox.checked=a);F(this,a?"select":"unselect")};a.prototype.shouldShowTooltip=function(a,b,d){void 0===d&&(d={});d.series=this;d.visiblePlotOnly=!0;return this.chart.isInsidePlot(a,b,d)};a.defaultOptions=u;return a}();y(a.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,cropShoulder:1,directTouch:!1,drawLegendSymbol:z.drawLineMarker,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:J,requireSorting:!0,sorted:!0});n.series=
a;"";"";return a});M(a,"Extensions/ScrollablePlotArea.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/Axis/Axis.js"],a["Core/Chart/Chart.js"],a["Core/Series/Series.js"],a["Core/Renderer/RendererRegistry.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x){var r=a.stop,u=x.addEvent,n=x.createElement,m=x.merge,g=x.pick;u(C,"afterSetChartSize",function(a){var c=this.options.chart.scrollablePlotArea,g=c&&c.minWidth;c=c&&c.minHeight;if(!this.renderer.forExport){if(g){if(this.scrollablePixelsX=g=Math.max(0,
g-this.chartWidth)){this.scrollablePlotBox=this.renderer.scrollablePlotBox=m(this.plotBox);this.plotBox.width=this.plotWidth+=g;this.inverted?this.clipBox.height+=g:this.clipBox.width+=g;var f={1:{name:"right",value:g}}}}else c&&(this.scrollablePixelsY=g=Math.max(0,c-this.chartHeight))&&(this.scrollablePlotBox=this.renderer.scrollablePlotBox=m(this.plotBox),this.plotBox.height=this.plotHeight+=g,this.inverted?this.clipBox.width+=g:this.clipBox.height+=g,f={2:{name:"bottom",value:g}});f&&!a.skipAxes&&
this.axes.forEach(function(a){f[a.side]?a.getPlotLinePath=function(){var c=f[a.side].name,e=this[c];this[c]=e-f[a.side].value;var g=w.prototype.getPlotLinePath.apply(this,arguments);this[c]=e;return g}:(a.setAxisSize(),a.setAxisTranslation())})}});u(C,"render",function(){this.scrollablePixelsX||this.scrollablePixelsY?(this.setUpScrolling&&this.setUpScrolling(),this.applyFixed()):this.fixedDiv&&this.applyFixed()});C.prototype.setUpScrolling=function(){var a=this,e={WebkitOverflowScrolling:"touch",
overflowX:"hidden",overflowY:"hidden"};this.scrollablePixelsX&&(e.overflowX="auto");this.scrollablePixelsY&&(e.overflowY="auto");this.scrollingParent=n("div",{className:"highcharts-scrolling-parent"},{position:"relative"},this.renderTo);this.scrollingContainer=n("div",{className:"highcharts-scrolling"},e,this.scrollingParent);u(this.scrollingContainer,"scroll",function(){a.pointer&&delete a.pointer.chartPosition});this.innerContainer=n("div",{className:"highcharts-inner-container"},null,this.scrollingContainer);
this.innerContainer.appendChild(this.container);this.setUpScrolling=null};C.prototype.moveFixedElements=function(){var a=this.container,e=this.fixedRenderer,g=".highcharts-contextbutton .highcharts-credits .highcharts-legend .highcharts-legend-checkbox .highcharts-navigator-series .highcharts-navigator-xaxis .highcharts-navigator-yaxis .highcharts-navigator .highcharts-reset-zoom .highcharts-drillup-button .highcharts-scrollbar .highcharts-subtitle .highcharts-title".split(" "),f;this.scrollablePixelsX&&
!this.inverted?f=".highcharts-yaxis":this.scrollablePixelsX&&this.inverted?f=".highcharts-xaxis":this.scrollablePixelsY&&!this.inverted?f=".highcharts-xaxis":this.scrollablePixelsY&&this.inverted&&(f=".highcharts-yaxis");f&&g.push(f+":not(.highcharts-radial-axis)",f+"-labels:not(.highcharts-radial-axis-labels)");g.forEach(function(c){[].forEach.call(a.querySelectorAll(c),function(a){(a.namespaceURI===e.SVG_NS?e.box:e.box.parentNode).appendChild(a);a.style.pointerEvents="auto"})})};C.prototype.applyFixed=
function(){var a=!this.fixedDiv,e=this.options.chart,l=e.scrollablePlotArea,f=z.getRendererType();a?(this.fixedDiv=n("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(e.style&&e.style.zIndex||0)+2,top:0},null,!0),this.scrollingContainer&&this.scrollingContainer.parentNode.insertBefore(this.fixedDiv,this.scrollingContainer),this.renderTo.style.overflow="visible",this.fixedRenderer=e=new f(this.fixedDiv,this.chartWidth,this.chartHeight,this.options.chart.style),
this.scrollableMask=e.path().attr({fill:this.options.chart.backgroundColor||"#fff","fill-opacity":g(l.opacity,.85),zIndex:-1}).addClass("highcharts-scrollable-mask").add(),u(this,"afterShowResetZoom",this.moveFixedElements),u(this,"afterDrilldown",this.moveFixedElements),u(this,"afterLayOutTitles",this.moveFixedElements)):this.fixedRenderer.setSize(this.chartWidth,this.chartHeight);if(this.scrollableDirty||a)this.scrollableDirty=!1,this.moveFixedElements();e=this.chartWidth+(this.scrollablePixelsX||
0);f=this.chartHeight+(this.scrollablePixelsY||0);r(this.container);this.container.style.width=e+"px";this.container.style.height=f+"px";this.renderer.boxWrapper.attr({width:e,height:f,viewBox:[0,0,e,f].join(" ")});this.chartBackground.attr({width:e,height:f});this.scrollingContainer.style.height=this.chartHeight+"px";a&&(l.scrollPositionX&&(this.scrollingContainer.scrollLeft=this.scrollablePixelsX*l.scrollPositionX),l.scrollPositionY&&(this.scrollingContainer.scrollTop=this.scrollablePixelsY*l.scrollPositionY));
f=this.axisOffset;a=this.plotTop-f[0]-1;l=this.plotLeft-f[3]-1;e=this.plotTop+this.plotHeight+f[2]+1;f=this.plotLeft+this.plotWidth+f[1]+1;var m=this.plotLeft+this.plotWidth-(this.scrollablePixelsX||0),q=this.plotTop+this.plotHeight-(this.scrollablePixelsY||0);a=this.scrollablePixelsX?[["M",0,a],["L",this.plotLeft-1,a],["L",this.plotLeft-1,e],["L",0,e],["Z"],["M",m,a],["L",this.chartWidth,a],["L",this.chartWidth,e],["L",m,e],["Z"]]:this.scrollablePixelsY?[["M",l,0],["L",l,this.plotTop-1],["L",f,this.plotTop-
1],["L",f,0],["Z"],["M",l,q],["L",l,this.chartHeight],["L",f,this.chartHeight],["L",f,q],["Z"]]:[["M",0,0]];"adjustHeight"!==this.redrawTrigger&&this.scrollableMask.attr({d:a})};u(w,"afterInit",function(){this.chart.scrollableDirty=!0});u(E,"show",function(){this.chart.scrollableDirty=!0});""});M(a,"Core/Axis/StackingAxis.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/Axis/Axis.js"],a["Core/Utilities.js"]],function(a,w,C){var r=a.getDeferredAnimation,z=C.addEvent,x=C.destroyObjectProperties,
J=C.fireEvent,u=C.isNumber,n=C.objectEach,m;(function(a){function c(){var a=this.stacking;if(a){var c=a.stacks;n(c,function(a,e){x(a);c[e]=null});a&&a.stackTotalGroup&&a.stackTotalGroup.destroy()}}function e(){this.stacking||(this.stacking=new f(this))}var g=[];a.compose=function(a){-1===g.indexOf(a)&&(g.push(a),z(a,"init",e),z(a,"destroy",c));return a};var f=function(){function a(a){this.oldStacks={};this.stacks={};this.stacksTouched=0;this.axis=a}a.prototype.buildStacks=function(){var a=this.axis,
c=a.series,e=a.options.reversedStacks,f=c.length,g;if(!a.isXAxis){this.usePercentage=!1;for(g=f;g--;){var l=c[e?g:f-g-1];l.setStackedPoints();l.setGroupedPoints()}for(g=0;g<f;g++)c[g].modifyStacks();J(a,"afterBuildStacks")}};a.prototype.cleanStacks=function(){if(!this.axis.isXAxis){if(this.oldStacks)var a=this.stacks=this.oldStacks;n(a,function(a){n(a,function(a){a.cumulative=a.total})})}};a.prototype.resetStacks=function(){var a=this,c=a.stacks;a.axis.isXAxis||n(c,function(c){n(c,function(e,f){u(e.touched)&&
e.touched<a.stacksTouched?(e.destroy(),delete c[f]):(e.total=null,e.cumulative=null)})})};a.prototype.renderStackTotals=function(){var a=this.axis,c=a.chart,e=c.renderer,f=this.stacks;a=r(c,a.options.stackLabels&&a.options.stackLabels.animation||!1);var g=this.stackTotalGroup=this.stackTotalGroup||e.g("stack-labels").attr({visibility:"visible",zIndex:6,opacity:0}).add();g.translate(c.plotLeft,c.plotTop);n(f,function(a){n(a,function(a){a.render(g)})});g.animate({opacity:1},a)};return a}();a.Additions=
f})(m||(m={}));return m});M(a,"Extensions/Stacking.js",[a["Core/Axis/Axis.js"],a["Core/Chart/Chart.js"],a["Core/FormatUtilities.js"],a["Core/Globals.js"],a["Core/Series/Series.js"],a["Core/Axis/StackingAxis.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x,J){var r=C.format,n=J.correctFloat,m=J.defined,g=J.destroyObjectProperties,c=J.isArray,e=J.isNumber,l=J.objectEach,f=J.pick,v=function(){function a(a,c,e,f,g){var k=a.chart.inverted;this.axis=a;this.isNegative=e;this.options=c=c||{};this.x=f;this.total=
null;this.points={};this.hasValidPoints=!1;this.stack=g;this.rightCliff=this.leftCliff=0;this.alignOptions={align:c.align||(k?e?"left":"right":"center"),verticalAlign:c.verticalAlign||(k?"middle":e?"bottom":"top"),y:c.y,x:c.x};this.textAlign=c.textAlign||(k?e?"right":"left":"center")}a.prototype.destroy=function(){g(this,this.axis)};a.prototype.render=function(a){var c=this.axis.chart,e=this.options,g=e.format;g=g?r(g,this,c):e.formatter.call(this);this.label?this.label.attr({text:g,visibility:"hidden"}):
(this.label=c.renderer.label(g,null,null,e.shape,null,null,e.useHTML,!1,"stack-labels"),g={r:e.borderRadius||0,text:g,rotation:e.rotation,padding:f(e.padding,5),visibility:"hidden"},c.styledMode||(g.fill=e.backgroundColor,g.stroke=e.borderColor,g["stroke-width"]=e.borderWidth,this.label.css(e.style)),this.label.attr(g),this.label.added||this.label.add(a));this.label.labelrank=c.plotSizeY};a.prototype.setOffset=function(a,c,g,l,n){var k=this.axis,h=k.chart;l=k.translate(k.stacking.usePercentage?100:
l?l:this.total,0,0,0,1);g=k.translate(g?g:0);g=m(l)&&Math.abs(l-g);a=f(n,h.xAxis[0].translate(this.x))+a;k=m(l)&&this.getStackBox(h,this,a,l,c,g,k);c=this.label;g=this.isNegative;a="justify"===f(this.options.overflow,"justify");var d=this.textAlign;c&&k&&(n=c.getBBox(),l=c.padding,d="left"===d?h.inverted?-l:l:"right"===d?n.width:h.inverted&&"center"===d?n.width/2:h.inverted?g?n.width+l:-l:n.width/2,g=h.inverted?n.height/2:g?-l:n.height,this.alignOptions.x=f(this.options.x,0),this.alignOptions.y=f(this.options.y,
0),k.x-=d,k.y-=g,c.align(this.alignOptions,null,k),h.isInsidePlot(c.alignAttr.x+d-this.alignOptions.x,c.alignAttr.y+g-this.alignOptions.y)?c.show():(c.alignAttr.y=-9999,a=!1),a&&z.prototype.justifyDataLabel.call(this.axis,c,this.alignOptions,c.alignAttr,n,k),c.attr({x:c.alignAttr.x,y:c.alignAttr.y}),f(!a&&this.options.crop,!0)&&((h=e(c.x)&&e(c.y)&&h.isInsidePlot(c.x-l+c.width,c.y)&&h.isInsidePlot(c.x+l,c.y))||c.hide()))};a.prototype.getStackBox=function(a,c,e,f,g,l,h){var d=c.axis.reversed,b=a.inverted,
k=h.height+h.pos-(b?a.plotLeft:a.plotTop);c=c.isNegative&&!d||!c.isNegative&&d;return{x:b?c?f-h.right:f-l+h.pos-a.plotLeft:e+a.xAxis[0].transB-a.plotLeft,y:b?h.height-e-g:c?k-f-l:k-f,width:b?l:g,height:b?g:l}};return a}();w.prototype.getStacks=function(){var a=this,c=a.inverted;a.yAxis.forEach(function(a){a.stacking&&a.stacking.stacks&&a.hasVisibleSeries&&(a.stacking.oldStacks=a.stacking.stacks)});a.series.forEach(function(e){var g=e.xAxis&&e.xAxis.options||{};!e.options.stacking||!0!==e.visible&&
!1!==a.options.chart.ignoreHiddenSeries||(e.stackKey=[e.type,f(e.options.stack,""),c?g.top:g.left,c?g.height:g.width].join())})};x.compose(a);z.prototype.setGroupedPoints=function(){var a=this.yAxis.stacking;this.options.centerInCategory&&(this.is("column")||this.is("columnrange"))&&!this.options.stacking&&1<this.chart.series.length?z.prototype.setStackedPoints.call(this,"group"):a&&l(a.stacks,function(c,e){"group"===e.slice(-5)&&(l(c,function(a){return a.destroy()}),delete a.stacks[e])})};z.prototype.setStackedPoints=
function(a){var e=a||this.options.stacking;if(e&&(!0===this.visible||!1===this.chart.options.chart.ignoreHiddenSeries)){var g=this.processedXData,l=this.processedYData,q=[],r=l.length,t=this.options,h=t.threshold,d=f(t.startFromThreshold&&h,0);t=t.stack;a=a?this.type+","+e:this.stackKey;var b="-"+a,p=this.negStacks,u=this.yAxis,y=u.stacking.stacks,x=u.stacking.oldStacks,F,w;u.stacking.stacksTouched+=1;for(w=0;w<r;w++){var z=g[w];var C=l[w];var E=this.getStackIndicator(E,z,this.index);var J=E.key;
var H=(F=p&&C<(d?0:h))?b:a;y[H]||(y[H]={});y[H][z]||(x[H]&&x[H][z]?(y[H][z]=x[H][z],y[H][z].total=null):y[H][z]=new v(u,u.options.stackLabels,F,z,t));H=y[H][z];null!==C?(H.points[J]=H.points[this.index]=[f(H.cumulative,d)],m(H.cumulative)||(H.base=J),H.touched=u.stacking.stacksTouched,0<E.index&&!1===this.singleStacks&&(H.points[J][0]=H.points[this.index+","+z+",0"][0])):H.points[J]=H.points[this.index]=null;"percent"===e?(F=F?a:b,p&&y[F]&&y[F][z]?(F=y[F][z],H.total=F.total=Math.max(F.total,H.total)+
Math.abs(C)||0):H.total=n(H.total+(Math.abs(C)||0))):"group"===e?(c(C)&&(C=C[0]),null!==C&&(H.total=(H.total||0)+1)):H.total=n(H.total+(C||0));H.cumulative="group"===e?(H.total||1)-1:f(H.cumulative,d)+(C||0);null!==C&&(H.points[J].push(H.cumulative),q[w]=H.cumulative,H.hasValidPoints=!0)}"percent"===e&&(u.stacking.usePercentage=!0);"group"!==e&&(this.stackedYData=q);u.stacking.oldStacks={}}};z.prototype.modifyStacks=function(){var a=this,c=a.stackKey,e=a.yAxis.stacking.stacks,f=a.processedXData,g,
l=a.options.stacking;a[l+"Stacker"]&&[c,"-"+c].forEach(function(c){for(var h=f.length,d,b;h--;)if(d=f[h],g=a.getStackIndicator(g,d,a.index,c),b=(d=e[c]&&e[c][d])&&d.points[g.key])a[l+"Stacker"](b,d,h)})};z.prototype.percentStacker=function(a,c,e){c=c.total?100/c.total:0;a[0]=n(a[0]*c);a[1]=n(a[1]*c);this.stackedYData[e]=a[1]};z.prototype.getStackIndicator=function(a,c,e,f){!m(a)||a.x!==c||f&&a.key!==f?a={x:c,index:0,key:f}:a.index++;a.key=[e,c,a.index].join();return a};E.StackItem=v;"";return E.StackItem});
M(a,"Series/Line/LineSeries.js",[a["Core/Color/Palette.js"],a["Core/Series/Series.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,w,C,E){var r=this&&this.__extends||function(){var a=function(n,m){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])};return a(n,m)};return function(n,m){function g(){this.constructor=n}a(n,m);n.prototype=null===m?Object.create(m):(g.prototype=m.prototype,
new g)}}(),x=E.defined,J=E.merge;E=function(u){function n(){var a=null!==u&&u.apply(this,arguments)||this;a.data=void 0;a.options=void 0;a.points=void 0;return a}r(n,u);n.prototype.drawGraph=function(){var m=this,g=this.options,c=(this.gappedPath||this.getGraphPath).call(this),e=this.chart.styledMode,l=[["graph","highcharts-graph"]];e||l[0].push(g.lineColor||this.color||a.neutralColor20,g.dashStyle);l=m.getZonesGraphs(l);l.forEach(function(a,l){var f=a[0],k=m[f],n=k?"animate":"attr";k?(k.endX=m.preventGraphAnimation?
null:c.xMap,k.animate({d:c})):c.length&&(m[f]=k=m.chart.renderer.path(c).addClass(a[1]).attr({zIndex:1}).add(m.group));k&&!e&&(f={stroke:a[2],"stroke-width":g.lineWidth,fill:m.fillGraph&&m.color||"none"},a[3]?f.dashstyle=a[3]:"square"!==g.linecap&&(f["stroke-linecap"]=f["stroke-linejoin"]="round"),k[n](f).shadow(2>l&&g.shadow));k&&(k.startX=c.xMap,k.isArea=c.isArea)})};n.prototype.getGraphPath=function(a,g,c){var e=this,l=e.options,f=[],m=[],n,k=l.step;a=a||e.points;var r=a.reversed;r&&a.reverse();
(k={right:1,center:2}[k]||k&&3)&&r&&(k=4-k);a=this.getValidPoints(a,!1,!(l.connectNulls&&!g&&!c));a.forEach(function(q,r){var v=q.plotX,t=q.plotY,h=a[r-1];(q.leftCliff||h&&h.rightCliff)&&!c&&(n=!0);q.isNull&&!x(g)&&0<r?n=!l.connectNulls:q.isNull&&!g?n=!0:(0===r||n?r=[["M",q.plotX,q.plotY]]:e.getPointSpline?r=[e.getPointSpline(a,q,r)]:k?(r=1===k?[["L",h.plotX,t]]:2===k?[["L",(h.plotX+v)/2,h.plotY],["L",(h.plotX+v)/2,t]]:[["L",v,h.plotY]],r.push(["L",v,t])):r=[["L",v,t]],m.push(q.x),k&&(m.push(q.x),
2===k&&m.push(q.x)),f.push.apply(f,r),n=!1)});f.xMap=m;return e.graphPath=f};n.prototype.getZonesGraphs=function(a){this.zones.forEach(function(g,c){c=["zone-graph-"+c,"highcharts-graph highcharts-zone-graph-"+c+" "+(g.className||"")];this.chart.styledMode||c.push(g.color||this.color,g.dashStyle||this.options.dashStyle);a.push(c)},this);return a};n.defaultOptions=J(w.defaultOptions,{});return n}(w);C.registerSeriesType("line",E);"";return E});M(a,"Series/Area/AreaSeries.js",[a["Core/Color/Color.js"],
a["Core/Legend/LegendSymbol.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,w,C,E){var r=this&&this.__extends||function(){var a=function(c,e){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])};return a(c,e)};return function(c,e){function g(){this.constructor=c}a(c,e);c.prototype=null===e?Object.create(e):(g.prototype=e.prototype,new g)}}(),x=a.parse,J=C.seriesTypes.line;a=
E.extend;var u=E.merge,n=E.objectEach,m=E.pick;E=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.data=void 0;c.options=void 0;c.points=void 0;return c}r(c,a);c.prototype.drawGraph=function(){this.areaPath=[];a.prototype.drawGraph.apply(this);var c=this,g=this.areaPath,f=this.options,n=[["area","highcharts-area",this.color,f.fillColor]];this.zones.forEach(function(a,e){n.push(["zone-area-"+e,"highcharts-area highcharts-zone-area-"+e+" "+a.className,a.color||c.color,a.fillColor||
f.fillColor])});n.forEach(function(a){var e=a[0],l=c[e],n=l?"animate":"attr",q={};l?(l.endX=c.preventGraphAnimation?null:g.xMap,l.animate({d:g})):(q.zIndex=0,l=c[e]=c.chart.renderer.path(g).addClass(a[1]).add(c.group),l.isArea=!0);c.chart.styledMode||(q.fill=m(a[3],x(a[2]).setOpacity(m(f.fillOpacity,.75)).get()));l[n](q);l.startX=g.xMap;l.shiftUnit=f.step?2:1})};c.prototype.getGraphPath=function(a){var c=J.prototype.getGraphPath,e=this.options,g=e.stacking,n=this.yAxis,k,r=[],u=[],B=this.index,x=
n.stacking.stacks[this.stackKey],t=e.threshold,h=Math.round(n.getThreshold(e.threshold));e=m(e.connectNulls,"percent"===g);var d=function(b,d,c){var e=a[b];b=g&&x[e.x].points[B];var f=e[c+"Null"]||0;c=e[c+"Cliff"]||0;e=!0;if(c||f){var k=(f?b[0]:b[1])+c;var l=b[0]+c;e=!!f}else!g&&a[d]&&a[d].isNull&&(k=l=t);"undefined"!==typeof k&&(u.push({plotX:p,plotY:null===k?h:n.getThreshold(k),isNull:e,isCliff:!0}),r.push({plotX:p,plotY:null===l?h:n.getThreshold(l),doCurve:!1}))};a=a||this.points;g&&(a=this.getStackPoints(a));
for(k=0;k<a.length;k++){g||(a[k].leftCliff=a[k].rightCliff=a[k].leftNull=a[k].rightNull=void 0);var b=a[k].isNull;var p=m(a[k].rectPlotX,a[k].plotX);var G=g?m(a[k].yBottom,h):h;if(!b||e)e||d(k,k-1,"left"),b&&!g&&e||(u.push(a[k]),r.push({x:k,plotX:p,plotY:G})),e||d(k,k+1,"right")}k=c.call(this,u,!0,!0);r.reversed=!0;b=c.call(this,r,!0,!0);(G=b[0])&&"M"===G[0]&&(b[0]=["L",G[1],G[2]]);b=k.concat(b);b.length&&b.push(["Z"]);c=c.call(this,u,!1,e);b.xMap=k.xMap;this.areaPath=b;return c};c.prototype.getStackPoints=
function(a){var c=this,e=[],g=[],r=this.xAxis,k=this.yAxis,u=k.stacking.stacks[this.stackKey],x={},B=k.series,w=B.length,t=k.options.reversedStacks?1:-1,h=B.indexOf(c);a=a||this.points;if(this.options.stacking){for(var d=0;d<a.length;d++)a[d].leftNull=a[d].rightNull=void 0,x[a[d].x]=a[d];n(u,function(a,b){null!==a.total&&g.push(b)});g.sort(function(a,b){return a-b});var b=B.map(function(a){return a.visible});g.forEach(function(a,d){var f=0,l,n;if(x[a]&&!x[a].isNull)e.push(x[a]),[-1,1].forEach(function(e){var f=
1===e?"rightNull":"leftNull",k=0,m=u[g[d+e]];if(m)for(var p=h;0<=p&&p<w;){var r=B[p].index;l=m.points[r];l||(r===c.index?x[a][f]=!0:b[p]&&(n=u[a].points[r])&&(k-=n[1]-n[0]));p+=t}x[a][1===e?"rightCliff":"leftCliff"]=k});else{for(var p=h;0<=p&&p<w;){if(l=u[a].points[B[p].index]){f=l[1];break}p+=t}f=m(f,0);f=k.translate(f,0,1,0,1);e.push({isNull:!0,plotX:r.translate(a,0,0,0,1),x:a,plotY:f,yBottom:f})}})}return e};c.defaultOptions=u(J.defaultOptions,{threshold:0});return c}(J);a(E.prototype,{singleStacks:!1,
drawLegendSymbol:w.drawRectangle});C.registerSeriesType("area",E);"";return E});M(a,"Series/Spline/SplineSeries.js",[a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,w){var r=this&&this.__extends||function(){var a=function(r,n){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,g){a.__proto__=g}||function(a,g){for(var c in g)g.hasOwnProperty(c)&&(a[c]=g[c])};return a(r,n)};return function(r,n){function m(){this.constructor=r}a(r,n);r.prototype=null===n?Object.create(n):
(m.prototype=n.prototype,new m)}}(),E=a.seriesTypes.line,z=w.merge,x=w.pick;w=function(a){function u(){var n=null!==a&&a.apply(this,arguments)||this;n.data=void 0;n.options=void 0;n.points=void 0;return n}r(u,a);u.prototype.getPointSpline=function(a,m,g){var c=m.plotX||0,e=m.plotY||0,l=a[g-1];g=a[g+1];if(l&&!l.isNull&&!1!==l.doCurve&&!m.isCliff&&g&&!g.isNull&&!1!==g.doCurve&&!m.isCliff){a=l.plotY||0;var f=g.plotX||0;g=g.plotY||0;var n=0;var r=(1.5*c+(l.plotX||0))/2.5;var k=(1.5*e+a)/2.5;f=(1.5*c+
f)/2.5;var u=(1.5*e+g)/2.5;f!==r&&(n=(u-k)*(f-c)/(f-r)+e-u);k+=n;u+=n;k>a&&k>e?(k=Math.max(a,e),u=2*e-k):k<a&&k<e&&(k=Math.min(a,e),u=2*e-k);u>g&&u>e?(u=Math.max(g,e),k=2*e-u):u<g&&u<e&&(u=Math.min(g,e),k=2*e-u);m.rightContX=f;m.rightContY=u}m=["C",x(l.rightContX,l.plotX,0),x(l.rightContY,l.plotY,0),x(r,c,0),x(k,e,0),c,e];l.rightContX=l.rightContY=void 0;return m};u.defaultOptions=z(E.defaultOptions);return u}(E);a.registerSeriesType("spline",w);"";return w});M(a,"Series/AreaSpline/AreaSplineSeries.js",
[a["Series/Area/AreaSeries.js"],a["Series/Spline/SplineSeries.js"],a["Core/Legend/LegendSymbol.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,w,C,E,z){var r=this&&this.__extends||function(){var a=function(g,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])};return a(g,c)};return function(g,c){function e(){this.constructor=g}a(g,c);g.prototype=null===c?Object.create(c):
(e.prototype=c.prototype,new e)}}(),J=a.prototype,u=z.extend,n=z.merge;z=function(m){function g(){var a=null!==m&&m.apply(this,arguments)||this;a.data=void 0;a.points=void 0;a.options=void 0;return a}r(g,m);g.defaultOptions=n(w.defaultOptions,a.defaultOptions);return g}(w);u(z.prototype,{getGraphPath:J.getGraphPath,getStackPoints:J.getStackPoints,drawGraph:J.drawGraph,drawLegendSymbol:C.drawRectangle});E.registerSeriesType("areaspline",z);"";return z});M(a,"Series/Column/ColumnSeries.js",[a["Core/Animation/AnimationUtilities.js"],
a["Core/Color/Color.js"],a["Core/Globals.js"],a["Core/Legend/LegendSymbol.js"],a["Core/Color/Palette.js"],a["Core/Series/Series.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x,J,u){var n=this&&this.__extends||function(){var a=function(c,d){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var b in d)d.hasOwnProperty(b)&&(a[b]=d[b])};return a(c,d)};return function(c,d){function b(){this.constructor=c}a(c,d);
c.prototype=null===d?Object.create(d):(b.prototype=d.prototype,new b)}}(),m=a.animObject,g=w.parse,c=C.hasTouch;a=C.noop;var e=u.clamp,l=u.css,f=u.defined,r=u.extend,q=u.fireEvent,k=u.isArray,I=u.isNumber,D=u.merge,B=u.pick,O=u.objectEach;u=function(a){function h(){var d=null!==a&&a.apply(this,arguments)||this;d.borderWidth=void 0;d.data=void 0;d.group=void 0;d.options=void 0;d.points=void 0;return d}n(h,a);h.prototype.animate=function(a){var b=this,d=this.yAxis,c=b.options,h=this.chart.inverted,
f={},g=h?"translateX":"translateY";if(a)f.scaleY=.001,a=e(d.toPixels(c.threshold),d.pos,d.pos+d.len),h?f.translateX=a-d.len:f.translateY=a,b.clipBox&&b.setClip(),b.group.attr(f);else{var k=Number(b.group.attr(g));b.group.animate({scaleY:1},r(m(b.options.animation),{step:function(a,c){b.group&&(f[g]=k+c.pos*(d.pos-k),b.group.attr(f))}}))}};h.prototype.init=function(d,b){a.prototype.init.apply(this,arguments);var c=this;d=c.chart;d.hasRendered&&d.series.forEach(function(a){a.type===c.type&&(a.isDirty=
!0)})};h.prototype.getColumnMetrics=function(){var a=this,b=a.options,c=a.xAxis,e=a.yAxis,h=c.options.reversedStacks;h=c.reversed&&!h||!c.reversed&&h;var f={},g,k=0;!1===b.grouping?k=1:a.chart.series.forEach(function(b){var d=b.yAxis,c=b.options;if(b.type===a.type&&(b.visible||!a.chart.options.chart.ignoreHiddenSeries)&&e.len===d.len&&e.pos===d.pos){if(c.stacking&&"group"!==c.stacking){g=b.stackKey;"undefined"===typeof f[g]&&(f[g]=k++);var h=f[g]}else!1!==c.grouping&&(h=k++);b.columnIndex=h}});var l=
Math.min(Math.abs(c.transA)*(c.ordinal&&c.ordinal.slope||b.pointRange||c.closestPointRange||c.tickInterval||1),c.len),m=l*b.groupPadding,n=(l-2*m)/(k||1);b=Math.min(b.maxPointWidth||c.len,B(b.pointWidth,n*(1-2*b.pointPadding)));a.columnMetrics={width:b,offset:(n-b)/2+(m+((a.columnIndex||0)+(h?1:0))*n-l/2)*(h?-1:1),paddedWidth:n,columnCount:k};return a.columnMetrics};h.prototype.crispCol=function(a,b,c,e){var d=this.chart,h=this.borderWidth,f=-(h%2?.5:0);h=h%2?.5:1;d.inverted&&d.renderer.isVML&&(h+=
1);this.options.crisp&&(c=Math.round(a+c)+f,a=Math.round(a)+f,c-=a);e=Math.round(b+e)+h;f=.5>=Math.abs(b)&&.5<e;b=Math.round(b)+h;e-=b;f&&e&&(--b,e+=1);return{x:a,y:b,width:c,height:e}};h.prototype.adjustForMissingColumns=function(a,b,c,e){var d=this,h=this.options.stacking;if(!c.isNull&&1<e.columnCount){var f=0,g=0;O(this.yAxis.stacking&&this.yAxis.stacking.stacks,function(a){if("number"===typeof c.x&&(a=a[c.x.toString()])){var b=a.points[d.index],e=a.total;h?(b&&(f=g),a.hasValidPoints&&g++):k(b)&&
(f=b[1],g=e||0)}});a=(c.plotX||0)+((g-1)*e.paddedWidth+b)/2-b-f*e.paddedWidth}return a};h.prototype.translate=function(){var a=this,b=a.chart,c=a.options,h=a.dense=2>a.closestPointRange*a.xAxis.transA;h=a.borderWidth=B(c.borderWidth,h?0:1);var g=a.xAxis,k=a.yAxis,l=c.threshold,m=a.translatedThreshold=k.getThreshold(l),n=B(c.minPointLength,5),r=a.getColumnMetrics(),t=r.width,q=a.pointXOffset=r.offset,v=a.dataMin,u=a.dataMax,w=a.barW=Math.max(t,1+2*h);b.inverted&&(m-=.5);c.pointPadding&&(w=Math.ceil(w));
x.prototype.translate.apply(a);a.points.forEach(function(d){var h=B(d.yBottom,m),p=999+Math.abs(h),y=d.plotX||0;p=e(d.plotY,-p,k.len+p);var x=Math.min(p,h),F=Math.max(p,h)-x,D=t,G=y+q,z=w;n&&Math.abs(F)<n&&(F=n,y=!k.reversed&&!d.negative||k.reversed&&d.negative,I(l)&&I(u)&&d.y===l&&u<=l&&(k.min||0)<l&&(v!==u||(k.max||0)<=l)&&(y=!y),x=Math.abs(x-m)>n?h-n:m-(y?n:0));f(d.options.pointWidth)&&(D=z=Math.ceil(d.options.pointWidth),G-=Math.round((D-t)/2));c.centerInCategory&&(G=a.adjustForMissingColumns(G,
D,d,r));d.barX=G;d.pointWidth=D;d.tooltipPos=b.inverted?[e(k.len+k.pos-b.plotLeft-p,k.pos-b.plotLeft,k.len+k.pos-b.plotLeft),g.len+g.pos-b.plotTop-G-z/2,F]:[g.left-b.plotLeft+G+z/2,e(p+k.pos-b.plotTop,k.pos-b.plotTop,k.len+k.pos-b.plotTop),F];d.shapeType=a.pointClass.prototype.shapeType||"rect";d.shapeArgs=a.crispCol.apply(a,d.isNull?[G,m,z,0]:[G,x,z,F])})};h.prototype.drawGraph=function(){this.group[this.dense?"addClass":"removeClass"]("highcharts-dense-data")};h.prototype.pointAttribs=function(a,
b){var d=this.options,c=this.pointAttrToOptions||{},e=c.stroke||"borderColor",h=c["stroke-width"]||"borderWidth",f=a&&a.color||this.color,k=a&&a[e]||d[e]||f;c=a&&a.options.dashStyle||d.dashStyle;var l=a&&a[h]||d[h]||this[h]||0,m=B(a&&a.opacity,d.opacity,1);if(a&&this.zones.length){var n=a.getZone();f=a.options.color||n&&(n.color||a.nonZonedColor)||this.color;n&&(k=n.borderColor||k,c=n.dashStyle||c,l=n.borderWidth||l)}b&&a&&(a=D(d.states[b],a.options.states&&a.options.states[b]||{}),b=a.brightness,
f=a.color||"undefined"!==typeof b&&g(f).brighten(a.brightness).get()||f,k=a[e]||k,l=a[h]||l,c=a.dashStyle||c,m=B(a.opacity,m));e={fill:f,stroke:k,"stroke-width":l,opacity:m};c&&(e.dashstyle=c);return e};h.prototype.drawPoints=function(){var a=this,b=this.chart,c=a.options,e=b.renderer,h=c.animationLimit||250,f;a.points.forEach(function(d){var g=d.graphic,k=!!g,l=g&&b.pointCount<h?"animate":"attr";if(I(d.plotY)&&null!==d.y){f=d.shapeArgs;g&&d.hasNewShapeType()&&(g=g.destroy());a.enabledDataSorting&&
(d.startXPos=a.xAxis.reversed?-(f?f.width||0:0):a.xAxis.width);g||(d.graphic=g=e[d.shapeType](f).add(d.group||a.group))&&a.enabledDataSorting&&b.hasRendered&&b.pointCount<h&&(g.attr({x:d.startXPos}),k=!0,l="animate");if(g&&k)g[l](D(f));if(c.borderRadius)g[l]({r:c.borderRadius});b.styledMode||g[l](a.pointAttribs(d,d.selected&&"select")).shadow(!1!==d.allowShadow&&c.shadow,null,c.stacking&&!c.borderRadius);g&&(g.addClass(d.getClassName(),!0),g.attr({visibility:d.visible?"inherit":"hidden"}))}else g&&
(d.graphic=g.destroy())})};h.prototype.drawTracker=function(){var a=this,b=a.chart,e=b.pointer,h=function(a){var b=e.getPointFromEvent(a);"undefined"!==typeof b&&(e.isDirectTouch=!0,b.onMouseOver(a))},f;a.points.forEach(function(a){f=k(a.dataLabels)?a.dataLabels:a.dataLabel?[a.dataLabel]:[];a.graphic&&(a.graphic.element.point=a);f.forEach(function(b){b.div?b.div.point=a:b.element.point=a})});a._hasTracking||(a.trackerGroups.forEach(function(d){if(a[d]){a[d].addClass("highcharts-tracker").on("mouseover",
h).on("mouseout",function(a){e.onTrackerMouseOut(a)});if(c)a[d].on("touchstart",h);!b.styledMode&&a.options.cursor&&a[d].css(l).css({cursor:a.options.cursor})}}),a._hasTracking=!0);q(this,"afterDrawTracker")};h.prototype.remove=function(){var a=this,b=a.chart;b.hasRendered&&b.series.forEach(function(b){b.type===a.type&&(b.isDirty=!0)});x.prototype.remove.apply(a,arguments)};h.defaultOptions=D(x.defaultOptions,{borderRadius:0,centerInCategory:!1,groupPadding:.2,marker:null,pointPadding:.1,minPointLength:0,
cropThreshold:50,pointRange:null,states:{hover:{halo:!1,brightness:.1},select:{color:z.neutralColor20,borderColor:z.neutralColor100}},dataLabels:{align:void 0,verticalAlign:void 0,y:void 0},startFromThreshold:!0,stickyTracking:!1,tooltip:{distance:6},threshold:0,borderColor:z.backgroundColor});return h}(x);r(u.prototype,{cropShoulder:0,directTouch:!0,drawLegendSymbol:E.drawRectangle,getSymbol:a,negStacks:!0,trackerGroups:["group","dataLabelsGroup"]});J.registerSeriesType("column",u);"";"";return u});
M(a,"Core/Series/DataLabel.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/FormatUtilities.js"],a["Core/Color/Palette.js"],a["Core/Utilities.js"]],function(a,w,C,E){var r=a.getDeferredAnimation,x=w.format,J=E.defined,u=E.extend,n=E.fireEvent,m=E.isArray,g=E.merge,c=E.objectEach,e=E.pick,l=E.splat,f;(function(a){function f(a,c,b,f,g){var d=this,h=this.chart,k=this.isCartesian&&h.inverted,l=this.enabledDataSorting,m=e(a.dlBox&&a.dlBox.centerX,a.plotX,-9999),n=e(a.plotY,-9999),p=c.getBBox(),r=
b.rotation,t=b.align,q=h.isInsidePlot(m,Math.round(n),{inverted:k,paneCoordinates:!0,series:d}),v=function(b){l&&d.xAxis&&!B&&d.setDataLabelStartPos(a,c,g,q,b)},B="justify"===e(b.overflow,l?"none":"justify"),x=this.visible&&!1!==a.visible&&(a.series.forceDL||l&&!B||q||e(b.inside,!!this.options.stacking)&&f&&h.isInsidePlot(m,k?f.x+1:f.y+f.height-1,{inverted:k,paneCoordinates:!0,series:d}));if(x){var w=h.renderer.fontMetrics(h.styledMode?void 0:b.style.fontSize,c).b;f=u({x:k?this.yAxis.len-n:m,y:Math.round(k?
this.xAxis.len-m:n),width:0,height:0},f);u(b,{width:p.width,height:p.height});r?(B=!1,m=h.renderer.rotCorr(w,r),m={x:f.x+(b.x||0)+f.width/2+m.x,y:f.y+(b.y||0)+{top:0,middle:.5,bottom:1}[b.verticalAlign]*f.height},v(m),c[g?"attr":"animate"](m).attr({align:t}),v=(r+720)%360,v=180<v&&360>v,"left"===t?m.y-=v?p.height:0:"center"===t?(m.x-=p.width/2,m.y-=p.height/2):"right"===t&&(m.x-=p.width,m.y-=v?0:p.height),c.placed=!0,c.alignAttr=m):(v(f),c.align(b,void 0,f),m=c.alignAttr);B&&0<=f.height?this.justifyDataLabel(c,
b,m,p,f,g):e(b.crop,!0)&&(x=h.isInsidePlot(m.x,m.y,{paneCoordinates:!0,series:d})&&h.isInsidePlot(m.x+p.width,m.y+p.height,{paneCoordinates:!0,series:d}));if(b.shape&&!r)c[g?"attr":"animate"]({anchorX:k?h.plotWidth-a.plotY:a.plotX,anchorY:k?h.plotHeight-a.plotX:a.plotY})}g&&l&&(c.placed=!1);x||l&&!B||(c.hide(!0),c.placed=!1)}function k(a,c){var b=c.filter;return b?(c=b.operator,a=a[b.property],b=b.value,">"===c&&a>b||"<"===c&&a<b||">="===c&&a>=b||"<="===c&&a<=b||"=="===c&&a==b||"==="===c&&a===b?!0:
!1):!0}function v(){var a=this,d=a.chart,b=a.options,f=a.points,g=a.hasRendered||0,t=d.renderer,q=b.dataLabels,v,u=q.animation;u=q.defer?r(d,u,a):{defer:0,duration:0};q=B(B(d.options.plotOptions&&d.options.plotOptions.series&&d.options.plotOptions.series.dataLabels,d.options.plotOptions&&d.options.plotOptions[a.type]&&d.options.plotOptions[a.type].dataLabels),q);n(this,"drawDataLabels");if(m(q)||q.enabled||a._hasPointLabels){var w=a.plotGroup("dataLabelsGroup","data-labels",g?"inherit":"hidden",q.zIndex||
6);w.attr({opacity:+g});!g&&(g=a.dataLabelsGroup)&&(a.visible&&w.show(!0),g[b.animation?"animate":"attr"]({opacity:1},u));f.forEach(function(f){v=l(B(q,f.dlOptions||f.options&&f.options.dataLabels));v.forEach(function(h,g){var l=h.enabled&&(!f.isNull||f.dataLabelOnNull)&&k(f,h),m=f.connectors?f.connectors[g]:f.connector,n=f.dataLabels?f.dataLabels[g]:f.dataLabel,p=e(h.distance,f.labelDistance),r=!n;if(l){var q=f.getLabelConfig();var v=e(h[f.formatPrefix+"Format"],h.format);q=J(v)?x(v,q,d):(h[f.formatPrefix+
"Formatter"]||h.formatter).call(q,h);v=h.style;var u=h.rotation;d.styledMode||(v.color=e(h.color,v.color,a.color,C.neutralColor100),"contrast"===v.color?(f.contrastColor=t.getContrast(f.color||a.color),v.color=!J(p)&&h.inside||0>p||b.stacking?f.contrastColor:C.neutralColor100):delete f.contrastColor,b.cursor&&(v.cursor=b.cursor));var B={r:h.borderRadius||0,rotation:u,padding:h.padding,zIndex:1};d.styledMode||(B.fill=h.backgroundColor,B.stroke=h.borderColor,B["stroke-width"]=h.borderWidth);c(B,function(a,
b){"undefined"===typeof a&&delete B[b]})}!n||l&&J(q)?l&&J(q)&&(n?B.text=q:(f.dataLabels=f.dataLabels||[],n=f.dataLabels[g]=u?t.text(q,0,-9999,h.useHTML).addClass("highcharts-data-label"):t.label(q,0,-9999,h.shape,null,null,h.useHTML,null,"data-label"),g||(f.dataLabel=n),n.addClass(" highcharts-data-label-color-"+f.colorIndex+" "+(h.className||"")+(h.useHTML?" highcharts-tracker":""))),n.options=h,n.attr(B),d.styledMode||n.css(v).shadow(h.shadow),n.added||n.add(w),h.textPath&&!h.useHTML&&(n.setTextPath(f.getDataLabelPath&&
f.getDataLabelPath(n)||f.graphic,h.textPath),f.dataLabelPath&&!h.textPath.enabled&&(f.dataLabelPath=f.dataLabelPath.destroy())),a.alignDataLabel(f,n,h,null,r)):(f.dataLabel=f.dataLabel&&f.dataLabel.destroy(),f.dataLabels&&(1===f.dataLabels.length?delete f.dataLabels:delete f.dataLabels[g]),g||delete f.dataLabel,m&&(f.connector=f.connector.destroy(),f.connectors&&(1===f.connectors.length?delete f.connectors:delete f.connectors[g])))})})}n(this,"afterDrawDataLabels")}function w(a,c,b,e,f,g){var d=this.chart,
h=c.align,k=c.verticalAlign,l=a.box?0:a.padding||0,m=c.x;m=void 0===m?0:m;var n=c.y;n=void 0===n?0:n;var p=(b.x||0)+l;if(0>p){"right"===h&&0<=m?(c.align="left",c.inside=!0):m-=p;var r=!0}p=(b.x||0)+e.width-l;p>d.plotWidth&&("left"===h&&0>=m?(c.align="right",c.inside=!0):m+=d.plotWidth-p,r=!0);p=b.y+l;0>p&&("bottom"===k&&0<=n?(c.verticalAlign="top",c.inside=!0):n-=p,r=!0);p=(b.y||0)+e.height-l;p>d.plotHeight&&("top"===k&&0>=n?(c.verticalAlign="bottom",c.inside=!0):n+=d.plotHeight-p,r=!0);r&&(c.x=m,
c.y=n,a.placed=!g,a.align(c,void 0,f));return r}function B(a,c){var b=[],d;if(m(a)&&!m(c))b=a.map(function(a){return g(a,c)});else if(m(c)&&!m(a))b=c.map(function(b){return g(a,b)});else if(m(a)||m(c))for(d=Math.max(a.length,c.length);d--;)b[d]=g(a[d],c[d]);else b=g(a,c);return b}function z(a,c,b,e,f){var d=this.chart,h=d.inverted,g=this.xAxis,k=g.reversed,l=h?c.height/2:c.width/2;a=(a=a.pointWidth)?a/2:0;c.startXPos=h?f.x:k?-l-a:g.width-l+a;c.startYPos=h?k?this.yAxis.height-l+a:-l-a:f.y;e?"hidden"===
c.visibility&&(c.show(),c.attr({opacity:0}).animate({opacity:1})):c.attr({opacity:1}).animate({opacity:0},void 0,c.hide);d.hasRendered&&(b&&c.attr({x:c.startXPos,y:c.startYPos}),c.placed=!0)}var t=[];a.compose=function(a){if(-1===t.indexOf(a)){var c=a.prototype;t.push(a);c.alignDataLabel=f;c.drawDataLabels=v;c.justifyDataLabel=w;c.setDataLabelStartPos=z}}})(f||(f={}));"";return f});M(a,"Series/Column/ColumnDataLabel.js",[a["Core/Series/DataLabel.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],
function(a,w,C){var r=w.series,z=C.merge,x=C.pick,J;(function(u){function n(a,c,e,l,f){var g=this.chart.inverted,m=a.series,k=a.dlBox||a.shapeArgs,n=x(a.below,a.plotY>x(this.translatedThreshold,m.yAxis.len)),u=x(e.inside,!!this.options.stacking);k&&(l=z(k),0>l.y&&(l.height+=l.y,l.y=0),k=l.y+l.height-m.yAxis.len,0<k&&k<l.height&&(l.height-=k),g&&(l={x:m.yAxis.len-l.y-l.height,y:m.xAxis.len-l.x-l.width,width:l.height,height:l.width}),u||(g?(l.x+=n?0:l.width,l.width=0):(l.y+=n?l.height:0,l.height=0)));
e.align=x(e.align,!g||u?"center":n?"right":"left");e.verticalAlign=x(e.verticalAlign,g||u?"middle":n?"top":"bottom");r.prototype.alignDataLabel.call(this,a,c,e,l,f);e.inside&&a.contrastColor&&c.css({color:a.contrastColor})}var m=[];u.compose=function(g){a.compose(r);-1===m.indexOf(g)&&(m.push(g),g.prototype.alignDataLabel=n)}})(J||(J={}));return J});M(a,"Series/Bar/BarSeries.js",[a["Series/Column/ColumnSeries.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,w,C){var r=this&&
this.__extends||function(){var a=function(r,n){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,g){a.__proto__=g}||function(a,g){for(var c in g)g.hasOwnProperty(c)&&(a[c]=g[c])};return a(r,n)};return function(r,n){function m(){this.constructor=r}a(r,n);r.prototype=null===n?Object.create(n):(m.prototype=n.prototype,new m)}}(),z=C.extend,x=C.merge;C=function(w){function u(){var a=null!==w&&w.apply(this,arguments)||this;a.data=void 0;a.options=void 0;a.points=void 0;return a}r(u,w);
u.defaultOptions=x(a.defaultOptions,{});return u}(a);z(C.prototype,{inverted:!0});w.registerSeriesType("bar",C);"";return C});M(a,"Series/Scatter/ScatterSeries.js",[a["Series/Column/ColumnSeries.js"],a["Series/Line/LineSeries.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,w,C,E){var r=this&&this.__extends||function(){var a=function(m,g){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=e}||function(a,e){for(var c in e)e.hasOwnProperty(c)&&
(a[c]=e[c])};return a(m,g)};return function(m,g){function c(){this.constructor=m}a(m,g);m.prototype=null===g?Object.create(g):(c.prototype=g.prototype,new c)}}(),x=E.addEvent,J=E.extend,u=E.merge;E=function(a){function m(){var g=null!==a&&a.apply(this,arguments)||this;g.data=void 0;g.options=void 0;g.points=void 0;return g}r(m,a);m.prototype.applyJitter=function(){var a=this,c=this.options.jitter,e=this.points.length;c&&this.points.forEach(function(g,f){["x","y"].forEach(function(l,m){var k="plot"+
l.toUpperCase();if(c[l]&&!g.isNull){var n=a[l+"Axis"];var r=c[l]*n.transA;if(n&&!n.isLog){var q=Math.max(0,g[k]-r);n=Math.min(n.len,g[k]+r);m=1E4*Math.sin(f+m*e);g[k]=q+(n-q)*(m-Math.floor(m));"x"===l&&(g.clientX=g.plotX)}}})})};m.prototype.drawGraph=function(){this.options.lineWidth?a.prototype.drawGraph.call(this):this.graph&&(this.graph=this.graph.destroy())};m.defaultOptions=u(w.defaultOptions,{lineWidth:0,findNearestPointBy:"xy",jitter:{x:0,y:0},marker:{enabled:!0},tooltip:{headerFormat:'<span style="color:{point.color}">\u25cf</span> <span style="font-size: 10px"> {series.name}</span><br/>',
pointFormat:"x: <b>{point.x}</b><br/>y: <b>{point.y}</b><br/>"}});return m}(w);J(E.prototype,{drawTracker:a.prototype.drawTracker,sorted:!1,requireSorting:!1,noSharedTooltip:!0,trackerGroups:["group","markerGroup","dataLabelsGroup"],takeOrdinalPosition:!1});x(E,"afterTranslate",function(){this.applyJitter()});C.registerSeriesType("scatter",E);"";return E});M(a,"Mixins/CenteredSeries.js",[a["Core/Globals.js"],a["Core/Series/Series.js"],a["Core/Utilities.js"]],function(a,w,C){var r=C.isNumber,z=C.pick,
x=C.relativeLength,J=a.deg2rad;return a.CenteredSeriesMixin={getCenter:function(){var a=this.options,n=this.chart,m=2*(a.slicedOffset||0),g=n.plotWidth-2*m,c=n.plotHeight-2*m,e=a.center,l=Math.min(g,c),f=a.size,r=a.innerSize||0;"string"===typeof f&&(f=parseFloat(f));"string"===typeof r&&(r=parseFloat(r));a=[z(e[0],"50%"),z(e[1],"50%"),z(f&&0>f?void 0:a.size,"100%"),z(r&&0>r?void 0:a.innerSize||0,"0%")];!n.angular||this instanceof w||(a[3]=0);for(e=0;4>e;++e)f=a[e],n=2>e||2===e&&/%$/.test(f),a[e]=
x(f,[g,c,l,a[2]][e])+(n?m:0);a[3]>a[2]&&(a[3]=a[2]);return a},getStartAndEndRadians:function(a,n){a=r(a)?a:0;n=r(n)&&n>a&&360>n-a?n:a+360;return{start:J*(a+-90),end:J*(n+-90)}}}});M(a,"Series/Pie/PiePoint.js",[a["Core/Animation/AnimationUtilities.js"],a["Core/Series/Point.js"],a["Core/Utilities.js"]],function(a,w,C){var r=this&&this.__extends||function(){var a=function(c,e){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var e in c)c.hasOwnProperty(e)&&
(a[e]=c[e])};return a(c,e)};return function(c,e){function g(){this.constructor=c}a(c,e);c.prototype=null===e?Object.create(e):(g.prototype=e.prototype,new g)}}(),z=a.setAnimation,x=C.addEvent,J=C.defined;a=C.extend;var u=C.isNumber,n=C.pick,m=C.relativeLength;w=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.labelDistance=void 0;c.options=void 0;c.series=void 0;return c}r(c,a);c.prototype.getConnectorPath=function(){var a=this.labelPosition,c=this.series.options.dataLabels,
f=this.connectorShapes,g=c.connectorShape;f[g]&&(g=f[g]);return g.call(this,{x:a.final.x,y:a.final.y,alignment:a.alignment},a.connectorPosition,c)};c.prototype.getTranslate=function(){return this.sliced?this.slicedTranslation:{translateX:0,translateY:0}};c.prototype.haloPath=function(a){var c=this.shapeArgs;return this.sliced||!this.visible?[]:this.series.chart.renderer.symbols.arc(c.x,c.y,c.r+a,c.r+a,{innerR:c.r-1,start:c.start,end:c.end})};c.prototype.init=function(){var c=this;a.prototype.init.apply(this,
arguments);this.name=n(this.name,"Slice");var g=function(a){c.slice("select"===a.type)};x(this,"select",g);x(this,"unselect",g);return this};c.prototype.isValid=function(){return u(this.y)&&0<=this.y};c.prototype.setVisible=function(a,c){var e=this,g=this.series,l=g.chart,k=g.options.ignoreHiddenPoint;c=n(c,k);a!==this.visible&&(this.visible=this.options.visible=a="undefined"===typeof a?!this.visible:a,g.options.data[g.data.indexOf(this)]=this.options,["graphic","dataLabel","connector","shadowGroup"].forEach(function(c){if(e[c])e[c][a?
"show":"hide"](a)}),this.legendItem&&l.legend.colorizeItem(this,a),a||"hover"!==this.state||this.setState(""),k&&(g.isDirty=!0),c&&l.redraw())};c.prototype.slice=function(a,c,f){var e=this.series;z(f,e.chart);n(c,!0);this.sliced=this.options.sliced=J(a)?a:!this.sliced;e.options.data[e.data.indexOf(this)]=this.options;this.graphic&&this.graphic.animate(this.getTranslate());this.shadowGroup&&this.shadowGroup.animate(this.getTranslate())};return c}(w);a(w.prototype,{connectorShapes:{fixedOffset:function(a,
c,e){var g=c.breakAt;c=c.touchingSliceAt;return[["M",a.x,a.y],e.softConnector?["C",a.x+("left"===a.alignment?-5:5),a.y,2*g.x-c.x,2*g.y-c.y,g.x,g.y]:["L",g.x,g.y],["L",c.x,c.y]]},straight:function(a,c){c=c.touchingSliceAt;return[["M",a.x,a.y],["L",c.x,c.y]]},crookedLine:function(a,c,e){c=c.touchingSliceAt;var g=this.series,f=g.center[0],n=g.chart.plotWidth,r=g.chart.plotLeft;g=a.alignment;var k=this.shapeArgs.r;e=m(e.crookDistance,1);n="left"===g?f+k+(n+r-f-k)*(1-e):r+(f-k)*e;e=["L",n,a.y];f=!0;if("left"===
g?n>a.x||n<c.x:n<a.x||n>c.x)f=!1;a=[["M",a.x,a.y]];f&&a.push(e);a.push(["L",c.x,c.y]);return a}}});return w});M(a,"Series/Pie/PieSeries.js",[a["Mixins/CenteredSeries.js"],a["Series/Column/ColumnSeries.js"],a["Core/Globals.js"],a["Core/Legend/LegendSymbol.js"],a["Core/Color/Palette.js"],a["Series/Pie/PiePoint.js"],a["Core/Series/Series.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Renderer/SVG/Symbols.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x,J,u,n,m){var g=this&&this.__extends||function(){var a=
function(c,e){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])};return a(c,e)};return function(c,e){function f(){this.constructor=c}a(c,e);c.prototype=null===e?Object.create(e):(f.prototype=e.prototype,new f)}}(),c=a.getStartAndEndRadians;C=C.noop;var e=m.clamp,l=m.extend,f=m.fireEvent,r=m.merge,q=m.pick,k=m.relativeLength;m=function(a){function l(){var c=null!==a&&a.apply(this,arguments)||this;c.center=
void 0;c.data=void 0;c.maxLabelDistance=void 0;c.options=void 0;c.points=void 0;return c}g(l,a);l.prototype.animate=function(a){var c=this,e=c.points,f=c.startAngleRad;a||e.forEach(function(a){var b=a.graphic,d=a.shapeArgs;b&&d&&(b.attr({r:q(a.startR,c.center&&c.center[3]/2),start:f,end:f}),b.animate({r:d.r,start:d.start,end:d.end},c.options.animation))})};l.prototype.drawEmpty=function(){var a=this.startAngleRad,c=this.endAngleRad,e=this.options;if(0===this.total&&this.center){var f=this.center[0];
var d=this.center[1];this.graph||(this.graph=this.chart.renderer.arc(f,d,this.center[1]/2,0,a,c).addClass("highcharts-empty-series").add(this.group));this.graph.attr({d:n.arc(f,d,this.center[2]/2,0,{start:a,end:c,innerR:this.center[3]/2})});this.chart.styledMode||this.graph.attr({"stroke-width":e.borderWidth,fill:e.fillColor||"none",stroke:e.color||z.neutralColor20})}else this.graph&&(this.graph=this.graph.destroy())};l.prototype.drawPoints=function(){var a=this.chart.renderer;this.points.forEach(function(c){c.graphic&&
c.hasNewShapeType()&&(c.graphic=c.graphic.destroy());c.graphic||(c.graphic=a[c.shapeType](c.shapeArgs).add(c.series.group),c.delayedRendering=!0)})};l.prototype.generatePoints=function(){a.prototype.generatePoints.call(this);this.updateTotals()};l.prototype.getX=function(a,c,f){var h=this.center,d=this.radii?this.radii[f.index]||0:h[2]/2;a=Math.asin(e((a-h[1])/(d+f.labelDistance),-1,1));return h[0]+(c?-1:1)*Math.cos(a)*(d+f.labelDistance)+(0<f.labelDistance?(c?-1:1)*this.options.dataLabels.padding:
0)};l.prototype.hasData=function(){return!!this.processedXData.length};l.prototype.redrawPoints=function(){var a=this,c=a.chart,e=c.renderer,f=a.options.shadow,d,b,g,k;this.drawEmpty();!f||a.shadowGroup||c.styledMode||(a.shadowGroup=e.g("shadow").attr({zIndex:-1}).add(a.group));a.points.forEach(function(h){var l={};b=h.graphic;if(!h.isNull&&b){var m=void 0;k=h.shapeArgs;d=h.getTranslate();c.styledMode||(m=h.shadowGroup,f&&!m&&(m=h.shadowGroup=e.g("shadow").add(a.shadowGroup)),m&&m.attr(d),g=a.pointAttribs(h,
h.selected&&"select"));h.delayedRendering?(b.setRadialReference(a.center).attr(k).attr(d),c.styledMode||b.attr(g).attr({"stroke-linejoin":"round"}).shadow(f,m),h.delayedRendering=!1):(b.setRadialReference(a.center),c.styledMode||r(!0,l,g),r(!0,l,k,d),b.animate(l));b.attr({visibility:h.visible?"inherit":"hidden"});b.addClass(h.getClassName(),!0)}else b&&(h.graphic=b.destroy())})};l.prototype.sortByAngle=function(a,c){a.sort(function(a,e){return"undefined"!==typeof a.angle&&(e.angle-a.angle)*c})};l.prototype.translate=
function(a){this.generatePoints();var e=this.options,g=e.slicedOffset,h=g+(e.borderWidth||0),d=c(e.startAngle,e.endAngle),b=this.startAngleRad=d.start;d=(this.endAngleRad=d.end)-b;var l=this.points,m=e.dataLabels.distance;e=e.ignoreHiddenPoint;var n=l.length,r,v=0;a||(this.center=a=this.getCenter());for(r=0;r<n;r++){var u=l[r];var x=b+v*d;!u.isValid()||e&&!u.visible||(v+=u.percentage/100);var w=b+v*d;var B={x:a[0],y:a[1],r:a[2]/2,innerR:a[3]/2,start:Math.round(1E3*x)/1E3,end:Math.round(1E3*w)/1E3};
u.shapeType="arc";u.shapeArgs=B;u.labelDistance=q(u.options.dataLabels&&u.options.dataLabels.distance,m);u.labelDistance=k(u.labelDistance,B.r);this.maxLabelDistance=Math.max(this.maxLabelDistance||0,u.labelDistance);w=(w+x)/2;w>1.5*Math.PI?w-=2*Math.PI:w<-Math.PI/2&&(w+=2*Math.PI);u.slicedTranslation={translateX:Math.round(Math.cos(w)*g),translateY:Math.round(Math.sin(w)*g)};B=Math.cos(w)*a[2]/2;var z=Math.sin(w)*a[2]/2;u.tooltipPos=[a[0]+.7*B,a[1]+.7*z];u.half=w<-Math.PI/2||w>Math.PI/2?1:0;u.angle=
w;x=Math.min(h,u.labelDistance/5);u.labelPosition={natural:{x:a[0]+B+Math.cos(w)*u.labelDistance,y:a[1]+z+Math.sin(w)*u.labelDistance},"final":{},alignment:0>u.labelDistance?"center":u.half?"right":"left",connectorPosition:{breakAt:{x:a[0]+B+Math.cos(w)*x,y:a[1]+z+Math.sin(w)*x},touchingSliceAt:{x:a[0]+B,y:a[1]+z}}}}f(this,"afterTranslate")};l.prototype.updateTotals=function(){var a=this.points,c=a.length,e=this.options.ignoreHiddenPoint,f,d=0;for(f=0;f<c;f++){var b=a[f];!b.isValid()||e&&!b.visible||
(d+=b.y)}this.total=d;for(f=0;f<c;f++)b=a[f],b.percentage=0<d&&(b.visible||!e)?b.y/d*100:0,b.total=d};l.defaultOptions=r(J.defaultOptions,{center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{allowOverlap:!0,connectorPadding:5,connectorShape:"fixedOffset",crookDistance:"70%",distance:30,enabled:!0,formatter:function(){return this.point.isNull?void 0:this.point.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,
slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:z.backgroundColor,borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}});return l}(J);l(m.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawLegendSymbol:E.drawRectangle,drawTracker:w.prototype.drawTracker,getCenter:a.getCenter,getSymbol:C,isCartesian:!1,noSharedTooltip:!0,pointAttribs:w.prototype.pointAttribs,pointClass:x,requireSorting:!1,searchPoint:C,trackerGroups:["group","dataLabelsGroup"]});u.registerSeriesType("pie",
m);"";return m});M(a,"Series/Pie/PieDataLabel.js",[a["Core/Series/DataLabel.js"],a["Core/Globals.js"],a["Core/Color/Palette.js"],a["Core/Renderer/RendererUtilities.js"],a["Core/Series/SeriesRegistry.js"],a["Core/Utilities.js"]],function(a,w,C,E,z,x){var r=w.noop,u=E.distribute,n=z.series,m=x.arrayMax,g=x.clamp,c=x.defined,e=x.merge,l=x.pick,f=x.relativeLength,v;(function(q){function k(){var a=this,f=a.data,d=a.chart,b=a.options.dataLabels||{},g=b.connectorPadding,k=d.plotWidth,r=d.plotHeight,q=d.plotLeft,
v=Math.round(d.chartWidth/3),w=a.center,x=w[2]/2,B=w[1],z=[[],[]],D=[0,0,0,0],E=a.dataLabelPositioners,I,J,M,O,Z,A,U,N,W,X,Y,T;a.visible&&(b.enabled||a._hasPointLabels)&&(f.forEach(function(a){a.dataLabel&&a.visible&&a.dataLabel.shortened&&(a.dataLabel.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),a.dataLabel.shortened=!1)}),n.prototype.drawDataLabels.apply(a),f.forEach(function(a){a.dataLabel&&(a.visible?(z[a.half].push(a),a.dataLabel._pos=null,!c(b.style.width)&&!c(a.options.dataLabels&&
a.options.dataLabels.style&&a.options.dataLabels.style.width)&&a.dataLabel.getBBox().width>v&&(a.dataLabel.css({width:Math.round(.7*v)+"px"}),a.dataLabel.shortened=!0)):(a.dataLabel=a.dataLabel.destroy(),a.dataLabels&&1===a.dataLabels.length&&delete a.dataLabels))}),z.forEach(function(e,f){var h=e.length,m=[],n;if(h){a.sortByAngle(e,f-.5);if(0<a.maxLabelDistance){var p=Math.max(0,B-x-a.maxLabelDistance);var t=Math.min(B+x+a.maxLabelDistance,d.plotHeight);e.forEach(function(a){0<a.labelDistance&&a.dataLabel&&
(a.top=Math.max(0,B-x-a.labelDistance),a.bottom=Math.min(B+x+a.labelDistance,d.plotHeight),n=a.dataLabel.getBBox().height||21,a.distributeBox={target:a.labelPosition.natural.y-a.top+n/2,size:n,rank:a.y},m.push(a.distributeBox))});p=t+n-p;u(m,p,p/5)}for(Y=0;Y<h;Y++){I=e[Y];A=I.labelPosition;O=I.dataLabel;X=!1===I.visible?"hidden":"inherit";W=p=A.natural.y;m&&c(I.distributeBox)&&("undefined"===typeof I.distributeBox.pos?X="hidden":(U=I.distributeBox.size,W=E.radialDistributionY(I)));delete I.positionIndex;
if(b.justify)N=E.justify(I,x,w);else switch(b.alignTo){case "connectors":N=E.alignToConnectors(e,f,k,q);break;case "plotEdges":N=E.alignToPlotEdges(O,f,k,q);break;default:N=E.radialDistributionX(a,I,W,p)}O._attr={visibility:X,align:A.alignment};T=I.options.dataLabels||{};O._pos={x:N+l(T.x,b.x)+({left:g,right:-g}[A.alignment]||0),y:W+l(T.y,b.y)-10};A.final.x=N;A.final.y=W;l(b.crop,!0)&&(Z=O.getBBox().width,p=null,N-Z<g&&1===f?(p=Math.round(Z-N+g),D[3]=Math.max(p,D[3])):N+Z>k-g&&0===f&&(p=Math.round(N+
Z-k+g),D[1]=Math.max(p,D[1])),0>W-U/2?D[0]=Math.max(Math.round(-W+U/2),D[0]):W+U/2>r&&(D[2]=Math.max(Math.round(W+U/2-r),D[2])),O.sideOverflow=p)}}}),0===m(D)||this.verifyDataLabelOverflow(D))&&(this.placeDataLabels(),this.points.forEach(function(c){T=e(b,c.options.dataLabels);if(J=l(T.connectorWidth,1)){var f;M=c.connector;if((O=c.dataLabel)&&O._pos&&c.visible&&0<c.labelDistance){X=O._attr.visibility;if(f=!M)c.connector=M=d.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+
c.colorIndex+(c.className?" "+c.className:"")).add(a.dataLabelsGroup),d.styledMode||M.attr({"stroke-width":J,stroke:T.connectorColor||c.color||C.neutralColor60});M[f?"attr":"animate"]({d:c.getConnectorPath()});M.attr("visibility",X)}else M&&(c.connector=M.destroy())}}))}function v(){this.points.forEach(function(a){var c=a.dataLabel,d;c&&a.visible&&((d=c._pos)?(c.sideOverflow&&(c._attr.width=Math.max(c.getBBox().width-c.sideOverflow,0),c.css({width:c._attr.width+"px",textOverflow:(this.options.dataLabels.style||
{}).textOverflow||"ellipsis"}),c.shortened=!0),c.attr(c._attr),c[c.moved?"animate":"attr"](d),c.moved=!0):c&&c.attr({y:-9999}));delete a.distributeBox},this)}function w(a){var c=this.center,d=this.options,b=d.center,e=d.minSize||80,k=null!==d.size;if(!k){if(null!==b[0])var l=Math.max(c[2]-Math.max(a[1],a[3]),e);else l=Math.max(c[2]-a[1]-a[3],e),c[0]+=(a[3]-a[1])/2;null!==b[1]?l=g(l,e,c[2]-Math.max(a[0],a[2])):(l=g(l,e,c[2]-a[0]-a[2]),c[1]+=(a[0]-a[2])/2);l<c[2]?(c[2]=l,c[3]=Math.min(f(d.innerSize||
0,l),l),this.translate(c),this.drawDataLabels&&this.drawDataLabels()):k=!0}return k}var x=[],z={radialDistributionY:function(a){return a.top+a.distributeBox.pos},radialDistributionX:function(a,c,d,b){return a.getX(d<c.top+2||d>c.bottom-2?b:d,c.half,c)},justify:function(a,c,d){return d[0]+(a.half?-1:1)*(c+a.labelDistance)},alignToPlotEdges:function(a,c,d,b){a=a.getBBox().width;return c?a+b:d-a-b},alignToConnectors:function(a,c,d,b){var e=0,f;a.forEach(function(a){f=a.dataLabel.getBBox().width;f>e&&
(e=f)});return c?e+b:d-e-b}};q.compose=function(c){a.compose(n);-1===x.indexOf(c)&&(x.push(c),c=c.prototype,c.dataLabelPositioners=z,c.alignDataLabel=r,c.drawDataLabels=k,c.placeDataLabels=v,c.verifyDataLabelOverflow=w)}})(v||(v={}));return v});M(a,"Extensions/OverlappingDataLabels.js",[a["Core/Chart/Chart.js"],a["Core/Utilities.js"]],function(a,w){function r(a,g){var c=!1;if(a){var e=a.newOpacity;a.oldOpacity!==e&&(a.alignAttr&&a.placed?(a[e?"removeClass":"addClass"]("highcharts-data-label-hidden"),
c=!0,a.alignAttr.opacity=e,a[a.isOld?"animate":"attr"](a.alignAttr,null,function(){g.styledMode||a.css({pointerEvents:e?"auto":"none"})}),z(g,"afterHideOverlappingLabel")):a.attr({opacity:e}));a.isOld=!0}return c}var E=w.addEvent,z=w.fireEvent,x=w.isArray,J=w.isNumber,u=w.objectEach,n=w.pick;E(a,"render",function(){var a=this,g=[];(this.labelCollectors||[]).forEach(function(a){g=g.concat(a())});(this.yAxis||[]).forEach(function(a){a.stacking&&a.options.stackLabels&&!a.options.stackLabels.allowOverlap&&
u(a.stacking.stacks,function(a){u(a,function(a){a.label&&"hidden"!==a.label.visibility&&g.push(a.label)})})});(this.series||[]).forEach(function(c){var e=c.options.dataLabels;c.visible&&(!1!==e.enabled||c._hasPointLabels)&&(e=function(c){return c.forEach(function(c){c.visible&&(x(c.dataLabels)?c.dataLabels:c.dataLabel?[c.dataLabel]:[]).forEach(function(e){var f=e.options;e.labelrank=n(f.labelrank,c.labelrank,c.shapeArgs&&c.shapeArgs.height);f.allowOverlap?(e.oldOpacity=e.opacity,e.newOpacity=1,r(e,
a)):g.push(e)})})},e(c.nodes||[]),e(c.points))});this.hideOverlappingLabels(g)});a.prototype.hideOverlappingLabels=function(a){var g=this,c=a.length,e=g.renderer,l,f,m,n=!1;var k=function(a){var c,f=a.box?0:a.padding||0,g=c=0,d;if(a&&(!a.alignAttr||a.placed)){var b=a.alignAttr||{x:a.attr("x"),y:a.attr("y")};var k=a.parentGroup;a.width||(c=a.getBBox(),a.width=c.width,a.height=c.height,c=e.fontMetrics(null,a.element).h);var l=a.width-2*f;(d={left:"0",center:"0.5",right:"1"}[a.alignValue])?g=+d*l:J(a.x)&&
Math.round(a.x)!==a.translateX&&(g=a.x-a.translateX);return{x:b.x+(k.translateX||0)+f-(g||0),y:b.y+(k.translateY||0)+f-c,width:a.width-2*f,height:a.height-2*f}}};for(f=0;f<c;f++)if(l=a[f])l.oldOpacity=l.opacity,l.newOpacity=1,l.absoluteBox=k(l);a.sort(function(a,c){return(c.labelrank||0)-(a.labelrank||0)});for(f=0;f<c;f++){var u=(k=a[f])&&k.absoluteBox;for(l=f+1;l<c;++l){var w=(m=a[l])&&m.absoluteBox;!u||!w||k===m||0===k.newOpacity||0===m.newOpacity||w.x>=u.x+u.width||w.x+w.width<=u.x||w.y>=u.y+u.height||
w.y+w.height<=u.y||((k.labelrank<m.labelrank?k:m).newOpacity=0)}}a.forEach(function(a){r(a,g)&&(n=!0)});n&&z(g,"afterHideAllOverlappingLabels")}});M(a,"Core/Responsive.js",[a["Core/Utilities.js"]],function(a){var r=a.extend,C=a.find,E=a.isArray,z=a.isObject,x=a.merge,J=a.objectEach,u=a.pick,n=a.splat,m=a.uniqueKey,g;(function(a){var c=[];a.compose=function(a){-1===c.indexOf(a)&&(c.push(a),r(a.prototype,g.prototype));return a};var g=function(){function a(){}a.prototype.currentOptions=function(a){function c(a,
f,g,k){var h;J(a,function(a,b){if(!k&&-1<e.collectionsWithUpdate.indexOf(b)&&f[b])for(a=n(a),g[b]=[],h=0;h<Math.max(a.length,f[b].length);h++)f[b][h]&&(void 0===a[h]?g[b][h]=f[b][h]:(g[b][h]={},c(a[h],f[b][h],g[b][h],k+1)));else z(a)?(g[b]=E(a)?[]:{},c(a,f[b]||{},g[b],k+1)):g[b]="undefined"===typeof f[b]?null:f[b]})}var e=this,f={};c(a,this.options,f,0);return f};a.prototype.matchResponsiveRule=function(a,c){var e=a.condition;(e.callback||function(){return this.chartWidth<=u(e.maxWidth,Number.MAX_VALUE)&&
this.chartHeight<=u(e.maxHeight,Number.MAX_VALUE)&&this.chartWidth>=u(e.minWidth,0)&&this.chartHeight>=u(e.minHeight,0)}).call(this)&&c.push(a._id)};a.prototype.setResponsive=function(a,c){var e=this,f=this.options.responsive,g=this.currentResponsive,l=[];!c&&f&&f.rules&&f.rules.forEach(function(a){"undefined"===typeof a._id&&(a._id=m());e.matchResponsiveRule(a,l)},this);c=x.apply(void 0,l.map(function(a){return C((f||{}).rules||[],function(c){return c._id===a})}).map(function(a){return a&&a.chartOptions}));
c.isResponsiveOptions=!0;l=l.toString()||void 0;l!==(g&&g.ruleIds)&&(g&&this.update(g.undoOptions,a,!0),l?(g=this.currentOptions(c),g.isResponsiveOptions=!0,this.currentResponsive={ruleIds:l,mergedOptions:c,undoOptions:g},this.update(c,a,!0)):this.currentResponsive=void 0)};return a}()})(g||(g={}));"";"";return g});M(a,"masters/highcharts.src.js",[a["Core/Globals.js"],a["Core/Utilities.js"],a["Core/DefaultOptions.js"],a["Core/Animation/Fx.js"],a["Core/Animation/AnimationUtilities.js"],a["Core/Renderer/HTML/AST.js"],
a["Core/FormatUtilities.js"],a["Core/Renderer/RendererUtilities.js"],a["Core/Renderer/SVG/SVGElement.js"],a["Core/Renderer/SVG/SVGRenderer.js"],a["Core/Renderer/HTML/HTMLElement.js"],a["Core/Renderer/HTML/HTMLRenderer.js"],a["Core/Axis/Axis.js"],a["Core/Axis/DateTimeAxis.js"],a["Core/Axis/LogarithmicAxis.js"],a["Core/Axis/PlotLineOrBand/PlotLineOrBand.js"],a["Core/Axis/Tick.js"],a["Core/Tooltip.js"],a["Core/Series/Point.js"],a["Core/Pointer.js"],a["Core/MSPointer.js"],a["Core/Legend/Legend.js"],a["Core/Chart/Chart.js"],
a["Core/Series/Series.js"],a["Core/Series/SeriesRegistry.js"],a["Series/Column/ColumnSeries.js"],a["Series/Column/ColumnDataLabel.js"],a["Series/Pie/PieSeries.js"],a["Series/Pie/PieDataLabel.js"],a["Core/Series/DataLabel.js"],a["Core/Responsive.js"],a["Core/Color/Color.js"],a["Core/Time.js"]],function(a,w,C,E,z,x,J,u,n,m,g,c,e,l,f,v,q,k,I,D,B,M,t,h,d,b,p,G,y,L,F,P,S){a.animate=z.animate;a.animObject=z.animObject;a.getDeferredAnimation=z.getDeferredAnimation;a.setAnimation=z.setAnimation;a.stop=z.stop;
a.timers=E.timers;a.AST=x;a.Axis=e;a.Chart=t;a.chart=t.chart;a.Fx=E;a.Legend=M;a.PlotLineOrBand=v;a.Point=I;a.Pointer=B.isRequired()?B:D;a.Series=h;a.SVGElement=n;a.SVGRenderer=m;a.Tick=q;a.Time=S;a.Tooltip=k;a.Color=P;a.color=P.parse;c.compose(m);g.compose(n);a.defaultOptions=C.defaultOptions;a.getOptions=C.getOptions;a.time=C.defaultTime;a.setOptions=C.setOptions;a.dateFormat=J.dateFormat;a.format=J.format;a.numberFormat=J.numberFormat;a.addEvent=w.addEvent;a.arrayMax=w.arrayMax;a.arrayMin=w.arrayMin;
a.attr=w.attr;a.clearTimeout=w.clearTimeout;a.correctFloat=w.correctFloat;a.createElement=w.createElement;a.css=w.css;a.defined=w.defined;a.destroyObjectProperties=w.destroyObjectProperties;a.discardElement=w.discardElement;a.distribute=u.distribute;a.erase=w.erase;a.error=w.error;a.extend=w.extend;a.extendClass=w.extendClass;a.find=w.find;a.fireEvent=w.fireEvent;a.getMagnitude=w.getMagnitude;a.getStyle=w.getStyle;a.inArray=w.inArray;a.isArray=w.isArray;a.isClass=w.isClass;a.isDOMElement=w.isDOMElement;
a.isFunction=w.isFunction;a.isNumber=w.isNumber;a.isObject=w.isObject;a.isString=w.isString;a.keys=w.keys;a.merge=w.merge;a.normalizeTickInterval=w.normalizeTickInterval;a.objectEach=w.objectEach;a.offset=w.offset;a.pad=w.pad;a.pick=w.pick;a.pInt=w.pInt;a.relativeLength=w.relativeLength;a.removeEvent=w.removeEvent;a.seriesType=d.seriesType;a.splat=w.splat;a.stableSort=w.stableSort;a.syncTimeout=w.syncTimeout;a.timeUnits=w.timeUnits;a.uniqueKey=w.uniqueKey;a.useSerialIds=w.useSerialIds;a.wrap=w.wrap;
p.compose(b);L.compose(h);l.compose(e);f.compose(e);y.compose(G);v.compose(e);F.compose(t);return a});a["masters/highcharts.src.js"]._modules=a;return a["masters/highcharts.src.js"]});
//# sourceMappingURL=highcharts.js.map</script>
    <script>/*
 Highcharts JS v9.2.2 (2021-08-24)

 Exporting module

 (c) 2010-2021 Torstein Honsi

 License: www.highcharts.com/license
*/
'use strict';(function(a){"object"===typeof module&&module.exports?(a["default"]=a,module.exports=a):"function"===typeof define&&define.amd?define("highcharts/modules/exporting",["highcharts"],function(g){a(g);a.Highcharts=g;return a}):a("undefined"!==typeof Highcharts?Highcharts:void 0)})(function(a){function g(a,b,r,h){a.hasOwnProperty(b)||(a[b]=h.apply(null,r))}a=a?a._modules:{};g(a,"Extensions/FullScreen.js",[a["Core/Chart/Chart.js"],a["Core/Globals.js"],a["Core/Renderer/HTML/AST.js"],a["Core/Utilities.js"]],
function(a,b,r,h){var m=h.addEvent;h=function(){function a(c){this.chart=c;this.isOpen=!1;c=c.renderTo;this.browserProps||("function"===typeof c.requestFullscreen?this.browserProps={fullscreenChange:"fullscreenchange",requestFullscreen:"requestFullscreen",exitFullscreen:"exitFullscreen"}:c.mozRequestFullScreen?this.browserProps={fullscreenChange:"mozfullscreenchange",requestFullscreen:"mozRequestFullScreen",exitFullscreen:"mozCancelFullScreen"}:c.webkitRequestFullScreen?this.browserProps={fullscreenChange:"webkitfullscreenchange",
requestFullscreen:"webkitRequestFullScreen",exitFullscreen:"webkitExitFullscreen"}:c.msRequestFullscreen&&(this.browserProps={fullscreenChange:"MSFullscreenChange",requestFullscreen:"msRequestFullscreen",exitFullscreen:"msExitFullscreen"}))}a.prototype.close=function(){var c=this.chart,a=c.options.chart;if(this.isOpen&&this.browserProps&&c.container.ownerDocument instanceof Document)c.container.ownerDocument[this.browserProps.exitFullscreen]();this.unbindFullscreenEvent&&(this.unbindFullscreenEvent=
this.unbindFullscreenEvent());c.setSize(this.origWidth,this.origHeight,!1);this.origHeight=this.origWidth=void 0;a.width=this.origWidthOption;a.height=this.origHeightOption;this.origHeightOption=this.origWidthOption=void 0;this.isOpen=!1;this.setButtonText()};a.prototype.open=function(){var c=this,a=c.chart,e=a.options.chart;e&&(c.origWidthOption=e.width,c.origHeightOption=e.height);c.origWidth=a.chartWidth;c.origHeight=a.chartHeight;if(c.browserProps){var k=m(a.container.ownerDocument,c.browserProps.fullscreenChange,
function(){c.isOpen?(c.isOpen=!1,c.close()):(a.setSize(null,null,!1),c.isOpen=!0,c.setButtonText())}),b=m(a,"destroy",k);c.unbindFullscreenEvent=function(){k();b()};if(e=a.renderTo[c.browserProps.requestFullscreen]())e["catch"](function(){alert("Full screen is not supported inside a frame.")})}};a.prototype.setButtonText=function(){var a=this.chart,b=a.exportDivElements,e=a.options.exporting,k=e&&e.buttons&&e.buttons.contextButton.menuItems;a=a.options.lang;e&&e.menuItemDefinitions&&a&&a.exitFullscreen&&
a.viewFullscreen&&k&&b&&(b=b[k.indexOf("viewFullscreen")])&&r.setElementHTML(b,this.isOpen?a.exitFullscreen:e.menuItemDefinitions.viewFullscreen.text||a.viewFullscreen)};a.prototype.toggle=function(){this.isOpen?this.close():this.open()};return a}();b.Fullscreen=h;m(a,"beforeRender",function(){this.fullscreen=new b.Fullscreen(this)});return b.Fullscreen});g(a,"Mixins/Navigation.js",[],function(){return{initUpdate:function(a){a.navigation||(a.navigation={updates:[],update:function(a,m){this.updates.forEach(function(b){b.update.call(b.context,
a,m)})}})},addUpdate:function(a,b){b.navigation||this.initUpdate(b);b.navigation.updates.push({update:a,context:b})}}});g(a,"Extensions/Exporting/ExportingDefaults.js",[a["Core/Globals.js"],a["Core/Color/Palette.js"]],function(a,b){return{exporting:{type:"image/png",url:"https://export.highcharts.com/",printMaxWidth:780,scale:2,buttons:{contextButton:{className:"highcharts-contextbutton",menuClassName:"highcharts-contextmenu",symbol:"menu",titleKey:"contextButtonTitle",menuItems:"viewFullscreen printChart separator downloadPNG downloadJPEG downloadPDF downloadSVG".split(" ")}},
menuItemDefinitions:{viewFullscreen:{textKey:"viewFullscreen",onclick:function(){this.fullscreen.toggle()}},printChart:{textKey:"printChart",onclick:function(){this.print()}},separator:{separator:!0},downloadPNG:{textKey:"downloadPNG",onclick:function(){this.exportChart()}},downloadJPEG:{textKey:"downloadJPEG",onclick:function(){this.exportChart({type:"image/jpeg"})}},downloadPDF:{textKey:"downloadPDF",onclick:function(){this.exportChart({type:"application/pdf"})}},downloadSVG:{textKey:"downloadSVG",
onclick:function(){this.exportChart({type:"image/svg+xml"})}}}},lang:{viewFullscreen:"View in full screen",exitFullscreen:"Exit from full screen",printChart:"Print chart",downloadPNG:"Download PNG image",downloadJPEG:"Download JPEG image",downloadPDF:"Download PDF document",downloadSVG:"Download SVG vector image",contextButtonTitle:"Chart context menu"},navigation:{buttonOptions:{symbolSize:14,symbolX:12.5,symbolY:10.5,align:"right",buttonSpacing:3,height:22,verticalAlign:"top",width:24,symbolFill:b.neutralColor60,
symbolStroke:b.neutralColor60,symbolStrokeWidth:3,theme:{padding:5}},menuStyle:{border:"1px solid "+b.neutralColor40,background:b.backgroundColor,padding:"5px 0"},menuItemStyle:{padding:"0.5em 1em",color:b.neutralColor80,background:"none",fontSize:a.isTouchDevice?"14px":"11px",transition:"background 250ms, color 250ms"},menuItemHoverStyle:{background:b.highlightColor80,color:b.backgroundColor}}}});g(a,"Extensions/Exporting/ExportingSymbols.js",[],function(){var a;(function(a){function b(a,c,b,e){return[["M",
a,c+2.5],["L",a+b,c+2.5],["M",a,c+e/2+.5],["L",a+b,c+e/2+.5],["M",a,c+e-1.5],["L",a+b,c+e-1.5]]}function h(a,c,b,e){a=e/3-2;e=[];return e=e.concat(this.circle(b-a,c,a,a),this.circle(b-a,c+a+4,a,a),this.circle(b-a,c+2*(a+4),a,a))}var m=[];a.compose=function(a){-1===m.indexOf(a)&&(m.push(a),a=a.prototype.symbols,a.menu=b,a.menuball=h.bind(a))}})(a||(a={}));return a});g(a,"Core/HttpUtilities.js",[a["Core/Globals.js"],a["Core/Utilities.js"]],function(a,b){var m=a.doc,h=b.createElement,g=b.discardElement,
F=b.merge,c=b.objectEach,G={ajax:function(a){var b=F(!0,{url:!1,type:"get",dataType:"json",success:!1,error:!1,data:!1,headers:{}},a);a={json:"application/json",xml:"application/xml",text:"text/plain",octet:"application/octet-stream"};var e=new XMLHttpRequest;if(!b.url)return!1;e.open(b.type.toUpperCase(),b.url,!0);b.headers["Content-Type"]||e.setRequestHeader("Content-Type",a[b.dataType]||a.text);c(b.headers,function(a,b){e.setRequestHeader(b,a)});e.onreadystatechange=function(){if(4===e.readyState){if(200===
e.status){var a=e.responseText;if("json"===b.dataType)try{a=JSON.parse(a)}catch(t){b.error&&b.error(e,t);return}return b.success&&b.success(a)}b.error&&b.error(e,e.responseText)}};try{b.data=JSON.stringify(b.data)}catch(ka){}e.send(b.data||!0)},getJSON:function(a,b){G.ajax({url:a,success:b,dataType:"json",headers:{"Content-Type":"text/plain"}})},post:function(a,b,r){var e=h("form",F({method:"post",action:a,enctype:"multipart/form-data"},r),{display:"none"},m.body);c(b,function(a,b){h("input",{type:"hidden",
name:b,value:a},null,e)});e.submit();g(e)}};"";return G});g(a,"Extensions/Exporting/Exporting.js",[a["Core/Renderer/HTML/AST.js"],a["Core/Chart/Chart.js"],a["Mixins/Navigation.js"],a["Core/DefaultOptions.js"],a["Extensions/Exporting/ExportingDefaults.js"],a["Extensions/Exporting/ExportingSymbols.js"],a["Core/Globals.js"],a["Core/HttpUtilities.js"],a["Core/Color/Palette.js"],a["Core/Utilities.js"]],function(a,b,g,h,z,F,c,G,e,k){h=h.defaultOptions;var m=c.doc,r=c.win,t=k.addEvent,u=k.css,A=k.createElement,
I=k.discardElement,B=k.extend,O=k.find,C=k.fireEvent,P=k.isObject,p=k.merge,J=k.objectEach,v=k.pick,Q=k.removeEvent,R=k.uniqueKey,D;(function(h){function z(a){var d=this,b=d.renderer,l=p(d.options.navigation.buttonOptions,a),c=l.onclick,x=l.menuItems,m=l.symbolSize||12;d.btnCount||(d.btnCount=0);d.exportDivElements||(d.exportDivElements=[],d.exportSVGElements=[]);if(!1!==l.enabled&&l.theme){var f=l.theme,y=f.states,h=y&&y.hover;y=y&&y.select;var k;d.styledMode||(f.fill=v(f.fill,e.backgroundColor),
f.stroke=v(f.stroke,"none"));delete f.states;c?k=function(a){a&&a.stopPropagation();c.call(d,a)}:x&&(k=function(a){a&&a.stopPropagation();d.contextMenu(q.menuClassName,x,q.translateX,q.translateY,q.width,q.height,q);q.setState(2)});l.text&&l.symbol?f.paddingLeft=v(f.paddingLeft,30):l.text||B(f,{width:l.width,height:l.height,padding:0});d.styledMode||(f["stroke-linecap"]="round",f.fill=v(f.fill,e.backgroundColor),f.stroke=v(f.stroke,"none"));var q=b.button(l.text,0,0,k,f,h,y).addClass(a.className).attr({title:v(d.options.lang[l._titleKey||
l.titleKey],"")});q.menuClassName=a.menuClassName||"highcharts-menu-"+d.btnCount++;if(l.symbol){var r=b.symbol(l.symbol,l.symbolX-m/2,l.symbolY-m/2,m,m,{width:m,height:m}).addClass("highcharts-button-symbol").attr({zIndex:1}).add(q);d.styledMode||r.attr({stroke:l.symbolStroke,fill:l.symbolFill,"stroke-width":l.symbolStrokeWidth||1})}q.add(d.exportingGroup).align(B(l,{width:q.width,x:v(l.x,d.buttonOffset)}),!0,"spacingBox");d.buttonOffset+=(q.width+l.buttonSpacing)*("right"===l.align?-1:1);d.exportSVGElements.push(q,
r)}}function D(){if(this.printReverseInfo){var a=this.printReverseInfo,w=a.childNodes,b=a.origDisplay;a=a.resetParams;this.moveContainers(this.renderTo);[].forEach.call(w,function(a,d){1===a.nodeType&&(a.style.display=b[d]||"")});this.isPrinting=!1;a&&this.setSize.apply(this,a);delete this.printReverseInfo;E=void 0;C(this,"afterPrint")}}function S(){var a=m.body,b=this.options.exporting.printMaxWidth,c={childNodes:a.childNodes,origDisplay:[],resetParams:void 0};this.isPrinting=!0;this.pointer.reset(null,
0);C(this,"beforePrint");b&&this.chartWidth>b&&(c.resetParams=[this.options.chart.width,void 0,!1],this.setSize(b,void 0,!1));[].forEach.call(c.childNodes,function(a,d){1===a.nodeType&&(c.origDisplay[d]=a.style.display,a.style.display="none")});this.moveContainers(a);this.printReverseInfo=c}function T(a){a.renderExporting();t(a,"redraw",a.renderExporting);t(a,"destroy",a.destroyExport)}function U(d,b,c,l,e,x,h){var f=this,w=f.options.navigation,H=f.chartWidth,K=f.chartHeight,q="cache-"+d,g=Math.max(e,
x),n=f[q];if(!n){f.exportContextMenu=f[q]=n=A("div",{className:d},{position:"absolute",zIndex:1E3,padding:g+"px",pointerEvents:"auto"},f.fixedDiv||f.container);var p=A("ul",{className:"highcharts-menu"},{listStyle:"none",margin:0,padding:0},n);f.styledMode||u(p,B({MozBoxShadow:"3px 3px 10px #888",WebkitBoxShadow:"3px 3px 10px #888",boxShadow:"3px 3px 10px #888"},w.menuStyle));n.hideMenu=function(){u(n,{display:"none"});h&&h.setState(0);f.openMenu=!1;u(f.renderTo,{overflow:"hidden"});u(f.container,
{overflow:"hidden"});k.clearTimeout(n.hideTimer);C(f,"exportMenuHidden")};f.exportEvents.push(t(n,"mouseleave",function(){n.hideTimer=r.setTimeout(n.hideMenu,500)}),t(n,"mouseenter",function(){k.clearTimeout(n.hideTimer)}),t(m,"mouseup",function(a){f.pointer.inClass(a.target,d)||n.hideMenu()}),t(n,"click",function(){f.openMenu&&n.hideMenu()}));b.forEach(function(d){"string"===typeof d&&(d=f.options.exporting.menuItemDefinitions[d]);if(P(d,!0)){var b=void 0;d.separator?b=A("hr",void 0,void 0,p):("viewData"===
d.textKey&&f.isDataTableVisible&&(d.textKey="hideData"),b=A("li",{className:"highcharts-menu-item",onclick:function(a){a&&a.stopPropagation();n.hideMenu();d.onclick&&d.onclick.apply(f,arguments)}},void 0,p),a.setElementHTML(b,d.text||f.options.lang[d.textKey]),f.styledMode||(b.onmouseover=function(){u(this,w.menuItemHoverStyle)},b.onmouseout=function(){u(this,w.menuItemStyle)},u(b,B({cursor:"pointer"},w.menuItemStyle))));f.exportDivElements.push(b)}});f.exportDivElements.push(p,n);f.exportMenuWidth=
n.offsetWidth;f.exportMenuHeight=n.offsetHeight}b={display:"block"};c+f.exportMenuWidth>H?b.right=H-c-e-g+"px":b.left=c-g+"px";l+x+f.exportMenuHeight>K&&"top"!==h.alignOptions.verticalAlign?b.bottom=K-l-g+"px":b.top=l+x-g+"px";u(n,b);u(f.renderTo,{overflow:""});u(f.container,{overflow:""});f.openMenu=!0;C(f,"exportMenuShown")}function V(a){var d=a?a.target:this,b=d.exportSVGElements,c=d.exportDivElements;a=d.exportEvents;var e;b&&(b.forEach(function(a,c){a&&(a.onclick=a.ontouchstart=null,e="cache-"+
a.menuClassName,d[e]&&delete d[e],b[c]=a.destroy())}),b.length=0);d.exportingGroup&&(d.exportingGroup.destroy(),delete d.exportingGroup);c&&(c.forEach(function(a,d){a&&(k.clearTimeout(a.hideTimer),Q(a,"mouseleave"),c[d]=a.onmouseout=a.onmouseover=a.ontouchstart=a.onclick=null,I(a))}),c.length=0);a&&(a.forEach(function(a){a()}),a.length=0)}function W(a,b){b=this.getSVGForExport(a,b);a=p(this.options.exporting,a);G.post(a.url,{filename:a.filename?a.filename.replace(/\//g,"-"):this.getFilename(),type:a.type,
width:a.width||0,scale:a.scale,svg:b},a.formAttributes)}function X(){this.styledMode&&this.inlineStyles();return this.container.innerHTML}function Y(){var a=this.userOptions.title&&this.userOptions.title.text,b=this.options.exporting.filename;if(b)return b.replace(/\//g,"-");"string"===typeof a&&(b=a.toLowerCase().replace(/<\/?[^>]+(>|$)/g,"").replace(/[\s_]+/g,"-").replace(/[^a-z0-9\-]/g,"").replace(/^[\-]+/g,"").replace(/[\-]+/g,"-").substr(0,24).replace(/[\-]+$/g,""));if(!b||5>b.length)b="chart";
return b}function Z(a){var d,c=p(this.options,a);c.plotOptions=p(this.userOptions.plotOptions,a&&a.plotOptions);c.time=p(this.userOptions.time,a&&a.time);var e=A("div",null,{position:"absolute",top:"-9999em",width:this.chartWidth+"px",height:this.chartHeight+"px"},m.body),h=this.renderTo.style.width;var k=this.renderTo.style.height;h=c.exporting.sourceWidth||c.chart.width||/px$/.test(h)&&parseInt(h,10)||(c.isGantt?800:600);k=c.exporting.sourceHeight||c.chart.height||/px$/.test(k)&&parseInt(k,10)||
400;B(c.chart,{animation:!1,renderTo:e,forExport:!0,renderer:"SVGRenderer",width:h,height:k});c.exporting.enabled=!1;delete c.data;c.series=[];this.series.forEach(function(a){d=p(a.userOptions,{animation:!1,enableMouseTracking:!1,showCheckbox:!1,visible:a.visible});d.isInternal||c.series.push(d)});var g={};this.axes.forEach(function(a){a.userOptions.internalKey||(a.userOptions.internalKey=R());a.options.isInternal||(g[a.coll]||(g[a.coll]=!0,c[a.coll]=[]),c[a.coll].push(p(a.userOptions,{visible:a.visible})))});
var f=new b(c,this.callback);a&&["xAxis","yAxis","series"].forEach(function(b){var d={};a[b]&&(d[b]=a[b],f.update(d))});this.axes.forEach(function(a){var b=O(f.axes,function(b){return b.options.internalKey===a.userOptions.internalKey}),d=a.getExtremes(),c=d.userMin;d=d.userMax;b&&("undefined"!==typeof c&&c!==b.min||"undefined"!==typeof d&&d!==b.max)&&b.setExtremes(c,d,!0,!1)});k=f.getChartHTML();C(this,"getSVG",{chartCopy:f});k=this.sanitizeSVG(k,c);c=null;f.destroy();I(e);return k}function aa(a,
b){var d=this.options.exporting;return this.getSVG(p({chart:{borderRadius:0}},d.chartOptions,b,{exporting:{sourceWidth:a&&a.sourceWidth||d.sourceWidth,sourceHeight:a&&a.sourceHeight||d.sourceHeight}}))}function L(a){return a.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()})}function ba(){function a(d){function f(a,c){h=m=!1;if(e.length){for(g=e.length;g--&&!m;)m=e[g].test(c);h=!m}"transform"===c&&"none"===a&&(h=!0);for(g=b.length;g--&&!h;)h=b[g].test(c)||"function"===typeof a;h||H[c]===
a&&"svg"!==d.nodeName||l[d.nodeName][c]===a||(M&&-1===M.indexOf(c)?w+=L(c)+":"+a+";":a&&d.setAttribute(L(c),a))}var w="",h,m,g;if(1===d.nodeType&&-1===ca.indexOf(d.nodeName)){var n=r.getComputedStyle(d,null);var H="svg"===d.nodeName?{}:r.getComputedStyle(d.parentNode,null);if(!l[d.nodeName]){k=t.getElementsByTagName("svg")[0];var u=t.createElementNS(d.namespaceURI,d.nodeName);k.appendChild(u);l[d.nodeName]=p(r.getComputedStyle(u,null));"text"===d.nodeName&&delete l.text.fill;k.removeChild(u)}if(c.isFirefox||
c.isMS)for(var v in n)f(n[v],v);else J(n,f);w&&(n=d.getAttribute("style"),d.setAttribute("style",(n?n+";":"")+w));"svg"===d.nodeName&&d.setAttribute("stroke-width","1px");"text"!==d.nodeName&&[].forEach.call(d.children||d.childNodes,a)}}var b=da,e=h.inlineWhitelist,l={},k,g=m.createElement("iframe");u(g,{width:"1px",height:"1px",visibility:"hidden"});m.body.appendChild(g);var t=g.contentWindow.document;t.open();t.write('<svg xmlns="http://www.w3.org/2000/svg"></svg>');t.close();a(this.container.querySelector("svg"));
k.parentNode.removeChild(k);g.parentNode.removeChild(g)}function ea(a){(this.fixedDiv?[this.fixedDiv,this.scrollingContainer]:[this.container]).forEach(function(b){a.appendChild(b)})}function fa(){var a=this;a.exporting={update:function(b,d){a.isDirtyExporting=!0;p(!0,a.options.exporting,b);v(d,!0)&&a.redraw()}};g.addUpdate(function(b,d){a.isDirtyExporting=!0;p(!0,a.options.navigation,b);v(d,!0)&&a.redraw()},a)}function ha(){var a=this;a.isPrinting||(E=a,c.isSafari||a.beforePrint(),setTimeout(function(){r.focus();
r.print();c.isSafari||setTimeout(function(){a.afterPrint()},1E3)},1))}function ia(){var a=this,b=a.options.exporting,c=b.buttons,e=a.isDirtyExporting||!a.exportSVGElements;a.buttonOffset=0;a.isDirtyExporting&&a.destroyExport();e&&!1!==b.enabled&&(a.exportEvents=[],a.exportingGroup=a.exportingGroup||a.renderer.g("exporting-group").attr({zIndex:3}).add(),J(c,function(b){a.addButton(b)}),a.isDirtyExporting=!1)}function ja(a,b){var c=a.indexOf("</svg>")+6,d=a.substr(c);a=a.substr(0,c);b&&b.exporting&&
b.exporting.allowHTML&&d&&(d='<foreignObject x="0" y="0" width="'+b.chart.width+'" height="'+b.chart.height+'"><body xmlns="http://www.w3.org/1999/xhtml">'+d.replace(/(<(?:img|br).*?(?=>))>/g,"$1 />")+"</body></foreignObject>",a=a.replace("</svg>",d+"</svg>"));a=a.replace(/zIndex="[^"]+"/g,"").replace(/symbolName="[^"]+"/g,"").replace(/jQuery[0-9]+="[^"]+"/g,"").replace(/url\(("|&quot;)(.*?)("|&quot;);?\)/g,"url($2)").replace(/url\([^#]+#/g,"url(#").replace(/<svg /,'<svg xmlns:xlink="http://www.w3.org/1999/xlink" ').replace(/ (|NS[0-9]+:)href=/g,
" xlink:href=").replace(/\n/," ").replace(/(fill|stroke)="rgba\(([ 0-9]+,[ 0-9]+,[ 0-9]+),([ 0-9\.]+)\)"/g,'$1="rgb($2)" $1-opacity="$3"').replace(/&nbsp;/g,"\u00a0").replace(/&shy;/g,"\u00ad");this.ieSanitizeSVG&&(a=this.ieSanitizeSVG(a));return a}var N=[],da=[/-/,/^(clipPath|cssText|d|height|width)$/,/^font$/,/[lL]ogical(Width|Height)$/,/perspective/,/TapHighlightColor/,/^transition/,/^length$/],M="fill stroke strokeLinecap strokeLinejoin strokeWidth textAnchor x y".split(" ");h.inlineWhitelist=
[];var ca=["clipPath","defs","desc"],E;h.compose=function(a,b){F.compose(b);-1===N.indexOf(a)&&(N.push(a),b=a.prototype,b.afterPrint=D,b.exportChart=W,b.inlineStyles=ba,b.print=ha,b.sanitizeSVG=ja,b.getChartHTML=X,b.getSVG=Z,b.getSVGForExport=aa,b.getFilename=Y,b.moveContainers=ea,b.beforePrint=S,b.contextMenu=U,b.addButton=z,b.destroyExport=V,b.renderExporting=ia,b.callbacks.push(T),t(a,"init",fa),c.isSafari&&c.win.matchMedia("print").addListener(function(a){E&&(a.matches?E.beforePrint():E.afterPrint())}))}})(D||
(D={}));h.exporting=p(z.exporting,h.exporting);h.lang=p(z.lang,h.lang);h.navigation=p(z.navigation,h.navigation);"";"";return D});g(a,"masters/modules/exporting.src.js",[a["Core/Globals.js"],a["Extensions/Exporting/Exporting.js"],a["Core/HttpUtilities.js"]],function(a,b,g){a.HttpUtilities=g;a.ajax=g.ajax;a.getJSON=g.getJSON;a.post=g.post;b.compose(a.Chart,a.Renderer)})});
//# sourceMappingURL=exporting.js.map</script>
    <script>/*
 Highcharts JS v9.2.2 (2021-08-24)

 Exporting module

 (c) 2010-2021 Torstein Honsi

 License: www.highcharts.com/license
*/
'use strict';(function(a){"object"===typeof module&&module.exports?(a["default"]=a,module.exports=a):"function"===typeof define&&define.amd?define("highcharts/modules/export-data",["highcharts","highcharts/modules/exporting"],function(k){a(k);a.Highcharts=k;return a}):a("undefined"!==typeof Highcharts?Highcharts:void 0)})(function(a){function k(a,f,d,p){a.hasOwnProperty(f)||(a[f]=p.apply(null,d))}a=a?a._modules:{};k(a,"Extensions/DownloadURL.js",[a["Core/Globals.js"]],function(a){var f=a.isSafari,
d=a.win,p=d.document,l=d.URL||d.webkitURL||d,r=a.dataURLtoBlob=function(a){if((a=a.replace(/filename=.*;/,"").match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/))&&3<a.length&&d.atob&&d.ArrayBuffer&&d.Uint8Array&&d.Blob&&l.createObjectURL){var f=d.atob(a[3]),n=new d.ArrayBuffer(f.length);n=new d.Uint8Array(n);for(var c=0;c<n.length;++c)n[c]=f.charCodeAt(c);a=new d.Blob([n],{type:a[1]});return l.createObjectURL(a)}};a=a.downloadURL=function(a,l){var n=d.navigator,c=p.createElement("a");if("string"===
typeof a||a instanceof String||!n.msSaveOrOpenBlob){a=""+a;n=/Edge\/\d+/.test(n.userAgent);if(f&&"string"===typeof a&&0===a.indexOf("data:application/pdf")||n||2E6<a.length)if(a=r(a)||"",!a)throw Error("Failed to convert to blob");if("undefined"!==typeof c.download)c.href=a,c.download=l,p.body.appendChild(c),c.click(),p.body.removeChild(c);else try{var g=d.open(a,"chart");if("undefined"===typeof g||null===g)throw Error("Failed to open window");}catch(E){d.location.href=a}}else n.msSaveOrOpenBlob(a,
l)};return{dataURLtoBlob:r,downloadURL:a}});k(a,"Extensions/ExportData.js",[a["Core/Axis/Axis.js"],a["Core/Chart/Chart.js"],a["Core/Renderer/HTML/AST.js"],a["Core/Globals.js"],a["Core/DefaultOptions.js"],a["Core/Utilities.js"],a["Extensions/DownloadURL.js"]],function(a,f,d,p,l,r,n){function k(a,m){var b=g.navigator,c=-1<b.userAgent.indexOf("WebKit")&&0>b.userAgent.indexOf("Chrome"),d=g.URL||g.webkitURL||g;try{if(b.msSaveOrOpenBlob&&g.MSBlobBuilder){var t=new g.MSBlobBuilder;t.append(a);return t.getBlob("image/svg+xml")}if(!c)return d.createObjectURL(new g.Blob(["\ufeff"+
a],{type:m}))}catch(N){}}var I=p.doc,c=p.seriesTypes,g=p.win;p=l.getOptions;l=l.setOptions;var E=r.addEvent,J=r.defined,F=r.extend,K=r.find,C=r.fireEvent,L=r.isNumber,v=r.pick,G=n.downloadURL;l({exporting:{csv:{annotations:{itemDelimiter:"; ",join:!1},columnHeaderFormatter:null,dateFormat:"%Y-%m-%d %H:%M:%S",decimalPoint:null,itemDelimiter:null,lineDelimiter:"\n"},showTable:!1,useMultiLevelHeaders:!0,useRowspanHeaders:!0},lang:{downloadCSV:"Download CSV",downloadXLS:"Download XLS",exportData:{annotationHeader:"Annotations",
categoryHeader:"Category",categoryDatetimeHeader:"DateTime"},viewData:"View data table",hideData:"Hide data table"}});E(f,"render",function(){this.options&&this.options.exporting&&this.options.exporting.showTable&&!this.options.chart.forExport&&!this.dataTableDiv&&this.viewData()});f.prototype.setUpKeyToAxis=function(){c.arearange&&(c.arearange.prototype.keyToAxis={low:"y",high:"y"});c.gantt&&(c.gantt.prototype.keyToAxis={start:"x",end:"x"})};f.prototype.getDataRows=function(b){var m=this.hasParallelCoordinates,
y=this.time,c=this.options.exporting&&this.options.exporting.csv||{},d=this.xAxis,t={},f=[],n=[],p=[],z;var g=this.options.lang.exportData;var l=g.categoryHeader,M=g.categoryDatetimeHeader,w=function(q,e,m){if(c.columnHeaderFormatter){var d=c.columnHeaderFormatter(q,e,m);if(!1!==d)return d}return q?q instanceof a?q.options.title&&q.options.title.text||(q.dateTime?M:l):b?{columnTitle:1<m?e:q.name,topLevelColumnTitle:q.name}:q.name+(1<m?" ("+e+")":""):l},H=function(a,b,e){var q={},m={};b.forEach(function(b){var c=
(a.keyToAxis&&a.keyToAxis[b]||b)+"Axis";c=L(e)?a.chart[c][e]:a[c];q[b]=c&&c.categories||[];m[b]=c&&c.dateTime});return{categoryMap:q,dateTimeValueAxisMap:m}},r=function(a,b){return a.data.filter(function(a){return"undefined"!==typeof a.y&&a.name}).length&&b&&!b.categories&&!a.keyToAxis?a.pointArrayMap&&a.pointArrayMap.filter(function(a){return"x"===a}).length?(a.pointArrayMap.unshift("x"),a.pointArrayMap):["x","y"]:a.pointArrayMap||["y"]},h=[];var x=0;this.setUpKeyToAxis();this.series.forEach(function(a){var e=
a.xAxis,q=a.options.keys||r(a,e),f=q.length,g=!a.requireSorting&&{},k=d.indexOf(e),B=H(a,q),l;if(!1!==a.options.includeInDataExport&&!a.options.isInternal&&!1!==a.visible){K(h,function(a){return a[0]===k})||h.push([k,x]);for(l=0;l<f;)z=w(a,q[l],q.length),p.push(z.columnTitle||z),b&&n.push(z.topLevelColumnTitle||z),l++;var A={chart:a.chart,autoIncrement:a.autoIncrement,options:a.options,pointArrayMap:a.pointArrayMap};a.options.data.forEach(function(b,d){m&&(B=H(a,q,d));var w={series:A};a.pointClass.prototype.applyOptions.apply(w,
[b]);b=w.x;var h=a.data[d]&&a.data[d].name;l=0;if(!e||"name"===a.exportKey||!m&&e&&e.hasNames&&h)b=h;g&&(g[b]&&(b+="|"+d),g[b]=!0);t[b]||(t[b]=[],t[b].xValues=[]);t[b].x=w.x;t[b].name=h;for(t[b].xValues[k]=w.x;l<f;)d=q[l],h=w[d],t[b][x+l]=v(B.categoryMap[d][h],B.dateTimeValueAxisMap[d]?y.dateFormat(c.dateFormat,h):null,h),l++});x+=l}});for(e in t)Object.hasOwnProperty.call(t,e)&&f.push(t[e]);var e=b?[n,p]:[p];for(x=h.length;x--;){var A=h[x][0];var D=h[x][1];var k=d[A];f.sort(function(a,b){return a.xValues[A]-
b.xValues[A]});g=w(k);e[0].splice(D,0,g);b&&e[1]&&e[1].splice(D,0,g);f.forEach(function(a){var b=a.name;k&&!J(b)&&(k.dateTime?(a.x instanceof Date&&(a.x=a.x.getTime()),b=y.dateFormat(c.dateFormat,a.x)):b=k.categories?v(k.names[a.x],k.categories[a.x],a.x):a.x);a.splice(D,0,b)})}e=e.concat(f);C(this,"exportData",{dataRows:e});return e};f.prototype.getCSV=function(a){var b="",d=this.getDataRows(),c=this.options.exporting.csv,f=v(c.decimalPoint,","!==c.itemDelimiter&&a?(1.1).toLocaleString()[1]:"."),
l=v(c.itemDelimiter,","===f?";":","),g=c.lineDelimiter;d.forEach(function(a,c){for(var m,y=a.length;y--;)m=a[y],"string"===typeof m&&(m='"'+m+'"'),"number"===typeof m&&"."!==f&&(m=m.toString().replace(".",f)),a[y]=m;b+=a.join(l);c<d.length-1&&(b+=g)});return b};f.prototype.getTable=function(a){var b=function(a){if(!a.tagName||"#text"===a.tagName)return a.textContent||"";var c=a.attributes,d="<"+a.tagName;c&&Object.keys(c).forEach(function(a){d+=" "+a+'="'+c[a]+'"'});d+=">";d+=a.textContent||"";(a.children||
[]).forEach(function(a){d+=b(a)});return d+="</"+a.tagName+">"};a=this.getTableAST(a);return b(a)};f.prototype.getTableAST=function(a){var b=0,c=[],d=this.options,f=a?(1.1).toLocaleString()[1]:".",l=v(d.exporting.useMultiLevelHeaders,!0);a=this.getDataRows(l);var g=l?a.shift():null,k=a.shift(),n=function(a,b,c,d){var h=v(d,"");b="text"+(b?" "+b:"");"number"===typeof h?(h=h.toString(),","===f&&(h=h.replace(".",f)),b="number"):d||(b="empty");c=F({"class":b},c);return{tagName:a,attributes:c,textContent:h}};
!1!==d.exporting.tableCaption&&c.push({tagName:"caption",attributes:{"class":"highcharts-table-caption"},textContent:v(d.exporting.tableCaption,d.title.text?d.title.text:"Chart")});for(var p=0,r=a.length;p<r;++p)a[p].length>b&&(b=a[p].length);c.push(function(a,b,c){var f=[],h=0;c=c||b&&b.length;var m=0,e;if(e=l&&a&&b){a:if(e=a.length,b.length===e){for(;e--;)if(a[e]!==b[e]){e=!1;break a}e=!0}else e=!1;e=!e}if(e){for(e=[];h<c;++h){var g=a[h];var k=a[h+1];g===k?++m:m?(e.push(n("th","highcharts-table-topheading",
{scope:"col",colspan:m+1},g)),m=0):(g===b[h]?d.exporting.useRowspanHeaders?(k=2,delete b[h]):(k=1,b[h]=""):k=1,g=n("th","highcharts-table-topheading",{scope:"col"},g),1<k&&g.attributes&&(g.attributes.valign="top",g.attributes.rowspan=k),e.push(g))}f.push({tagName:"tr",children:e})}if(b){e=[];h=0;for(c=b.length;h<c;++h)"undefined"!==typeof b[h]&&e.push(n("th",null,{scope:"col"},b[h]));f.push({tagName:"tr",children:e})}return{tagName:"thead",children:f}}(g,k,Math.max(b,k.length)));var u=[];a.forEach(function(a){for(var c=
[],d=0;d<b;d++)c.push(n(d?"td":"th",null,d?{}:{scope:"row"},a[d]));u.push({tagName:"tr",children:c})});c.push({tagName:"tbody",children:u});c={tree:{tagName:"table",id:"highcharts-data-table-"+this.index,children:c}};C(this,"aftergetTableAST",c);return c.tree};f.prototype.downloadCSV=function(){var a=this.getCSV(!0);G(k(a,"text/csv")||"data:text/csv,\ufeff"+encodeURIComponent(a),this.getFilename()+".csv")};f.prototype.downloadXLS=function(){var a='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Ark1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>td{border:none;font-family: Calibri, sans-serif;} .number{mso-number-format:"0.00";} .text{ mso-number-format:"@";}</style><meta name=ProgId content=Excel.Sheet><meta charset=UTF-8></head><body>'+
this.getTable(!0)+"</body></html>";G(k(a,"application/vnd.ms-excel")||"data:application/vnd.ms-excel;base64,"+g.btoa(unescape(encodeURIComponent(a))),this.getFilename()+".xls")};f.prototype.viewData=function(){this.toggleDataTable(!0)};f.prototype.hideData=function(){this.toggleDataTable(!1)};f.prototype.toggleDataTable=function(a){(a=v(a,!this.isDataTableVisible))&&!this.dataTableDiv&&(this.dataTableDiv=I.createElement("div"),this.dataTableDiv.className="highcharts-data-table",this.renderTo.parentNode.insertBefore(this.dataTableDiv,
this.renderTo.nextSibling));this.dataTableDiv&&(this.dataTableDiv.style.display=a?"block":"none",a&&(this.dataTableDiv.innerHTML="",(new d([this.getTableAST()])).addToDOM(this.dataTableDiv),C(this,"afterViewData",this.dataTableDiv)));this.isDataTableVisible=a;a=this.exportDivElements;var b=this.options.exporting,c=b&&b.buttons&&b.buttons.contextButton.menuItems;b=this.options.lang;u&&u.menuItemDefinitions&&b&&b.viewData&&b.hideData&&c&&a&&(a=a[c.indexOf("viewData")])&&d.setElementHTML(a,this.isDataTableVisible?
b.hideData:b.viewData)};var u=p().exporting;u&&(F(u.menuItemDefinitions,{downloadCSV:{textKey:"downloadCSV",onclick:function(){this.downloadCSV()}},downloadXLS:{textKey:"downloadXLS",onclick:function(){this.downloadXLS()}},viewData:{textKey:"viewData",onclick:function(){this.toggleDataTable()}}}),u.buttons&&u.buttons.contextButton.menuItems.push("separator","downloadCSV","downloadXLS","viewData"));c.map&&(c.map.prototype.exportKey="name");c.mapbubble&&(c.mapbubble.prototype.exportKey="name");c.treemap&&
(c.treemap.prototype.exportKey="name")});k(a,"masters/modules/export-data.src.js",[],function(){})});
//# sourceMappingURL=export-data.js.map</script>
    <script>/*
	Ractive.js v1.3.14
	Build: 76470bafd78eddd27baa1425ed3f9475242d1c34
	Date: Sat Dec 12 2020 08:01:19 GMT+0000 (UTC)
	Website: https://ractive.js.org
	License: MIT
*/
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define(factory) :
	(function() {
		var current = global.Ractive;
		var exports = factory();
		global.Ractive = exports;
		exports.noConflict = function() { global.Ractive = current; return exports; };
	})();
}(this, (function () { 'use strict';

/* istanbul ignore if */
if (!Object.assign) {
  Object.assign = function(target) {
    var sources = [], len = arguments.length - 1;
    while ( len-- > 0 ) sources[ len ] = arguments[ len + 1 ];

    if (target == null) { throw new TypeError('Cannot convert undefined or null to object'); }

    var to = Object(target);
    var sourcesLength = sources.length;

    for (var index = 0; index < sourcesLength; index++) {
      var nextSource = sources[index];
      for (var nextKey in nextSource) {
        if (!Object.prototype.hasOwnProperty.call(nextSource, nextKey)) { continue; }
        to[nextKey] = nextSource[nextKey];
      }
    }

    return to;
  };
}

function hasOwn(obj, prop) {
  return Object.prototype.hasOwnProperty.call(obj, prop);
}

function fillGaps(target) {
  var sources = [], len = arguments.length - 1;
  while ( len-- > 0 ) sources[ len ] = arguments[ len + 1 ];

  for (var i = 0; i < sources.length; i++) {
    var source = sources[i];
    for (var key in source) {
      // Source can be a prototype-less object.
      if (key in target || !hasOwn(source, key)) { continue; }
      target[key] = source[key];
    }
  }

  return target;
}

function toPairs(obj) {
  if ( obj === void 0 ) obj = {};

  var pairs = [];
  for (var key in obj) {
    // Source can be a prototype-less object.
    if (!hasOwn(obj, key)) { continue; }
    pairs.push([key, obj[key]]);
  }
  return pairs;
}

var obj = Object;

var assign = obj.assign;

var create = obj.create;

var defineProperty = obj.defineProperty;

var defineProperties = obj.defineProperties;

var keys = obj.keys;

var toString = Object.prototype.toString;


var isArray = Array.isArray;

function isEqual(a, b) {
  if (a === null && b === null) {
    return true;
  }

  if (isObjectType(a) || isObjectType(b)) {
    return false;
  }

  return a === b;
}

// http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric
function isNumeric(thing) {
  return !isNaN(parseFloat(thing)) && isFinite(thing);
}

function isObject(thing) {
  return thing && toString.call(thing) === '[object Object]';
}

function isObjectLike(thing) {
  return !!(thing && (isObjectType(thing) || isFunction(thing)));
}

function isObjectType(thing) {
  return typeof thing === 'object';
}

function isFunction(thing) {
  return typeof thing === 'function';
}

function isString(thing) {
  return typeof thing === 'string';
}

function isNumber(thing) {
  return typeof thing === 'number';
}

function isUndefined(thing) {
  return thing === undefined;
}

/* istanbul ignore if */
if (!Array.prototype.find) {
  defineProperty(Array.prototype, 'find', {
    value: function value(callback, thisArg) {
      if (this === null || isUndefined(this))
        { throw new TypeError('Array.prototype.find called on null or undefined'); }

      if (!isFunction(callback)) { throw new TypeError((callback + " is not a function")); }

      var array = Object(this);
      var arrayLength = array.length >>> 0;

      for (var index = 0; index < arrayLength; index++) {
        if (!hasOwn(array, index)) { continue; }
        if (!callback.call(thisArg, array[index], index, array)) { continue; }
        return array[index];
      }

      return undefined;
    },
    configurable: true,
    writable: true
  });
}

// NOTE: Node doesn't exist in IE8. Nothing can be done.
/* istanbul ignore if */
if (
  typeof window !== 'undefined' &&
  window.Node &&
  window.Node.prototype &&
  !window.Node.prototype.contains
) {
  Node.prototype.contains = function(node) {
    var this$1 = this;

    if (!node) { throw new TypeError('node required'); }

    do {
      if (this$1 === node) { return true; }
    } while ((node = node && node.parentNode));

    return false;
  };
}

/* istanbul ignore if */
if (typeof window !== 'undefined' && window.performance && !window.performance.now) {
  window.performance = window.performance || {};

  var nowOffset = Date.now();

  window.performance.now = function() {
    return Date.now() - nowOffset;
  };
}

/* eslint no-console:"off" */
var win = typeof window !== 'undefined' ? window : null;
var doc = win ? document : null;
var isClient = !!doc;
var base = typeof global !== 'undefined' ? global : win;
var hasConsole =
  typeof console !== 'undefined' && isFunction(console.warn) && isFunction(console.warn.apply);

var svg = doc
  ? doc.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1')
  : false;

var vendors = ['o', 'ms', 'moz', 'webkit'];

/* istanbul ignore if */
if (!base.Promise) {
  var PENDING = {};
  var FULFILLED = {};
  var REJECTED = {};

  var Promise$1 = (base.Promise = function(callback) {
    var fulfilledHandlers = [];
    var rejectedHandlers = [];
    var state = PENDING;
    var result;
    var dispatchHandlers;

    var makeResolver = function (newState) {
      return function(value) {
        if (state !== PENDING) { return; }
        result = value;
        state = newState;
        dispatchHandlers = makeDispatcher(
          state === FULFILLED ? fulfilledHandlers : rejectedHandlers,
          result
        );
        wait(dispatchHandlers);
      };
    };

    var fulfill = makeResolver(FULFILLED);
    var reject = makeResolver(REJECTED);

    try {
      callback(fulfill, reject);
    } catch (err) {
      reject(err);
    }

    return {
      // `then()` returns a Promise - 2.2.7
      then: function then(onFulfilled, onRejected) {
        var promise2 = new Promise$1(function (fulfill, reject) {
          var processResolutionHandler = function (handler, handlers, forward) {
            if (isFunction(handler)) {
              handlers.push(function (p1result) {
                try {
                  resolve$1(promise2, handler(p1result), fulfill, reject);
                } catch (err) {
                  reject(err);
                }
              });
            } else {
              handlers.push(forward);
            }
          };

          processResolutionHandler(onFulfilled, fulfilledHandlers, fulfill);
          processResolutionHandler(onRejected, rejectedHandlers, reject);

          if (state !== PENDING) {
            wait(dispatchHandlers);
          }
        });
        return promise2;
      },
      catch: function catch$1(onRejected) {
        return this.then(null, onRejected);
      },
      finally: function finally$1(callback) {
        return this.then(
          function (v) {
            callback();
            return v;
          },
          function (e) {
            callback();
            throw e;
          }
        );
      }
    };
  });

  Promise$1.all = function(promises) {
    return new Promise$1(function (fulfill, reject) {
      var result = [];
      var pending;
      var i;

      if (!promises.length) {
        fulfill(result);
        return;
      }

      var processPromise = function (promise, i) {
        if (promise && isFunction(promise.then)) {
          promise.then(function (value) {
            result[i] = value;
            --pending || fulfill(result);
          }, reject);
        } else {
          result[i] = promise;
          --pending || fulfill(result);
        }
      };

      pending = i = promises.length;

      while (i--) {
        processPromise(promises[i], i);
      }
    });
  };

  Promise$1.race = function(promises) {
    return new Promise$1(function (fulfill, reject) {
      var pending = true;
      function ok(v) {
        if (!pending) { return; }
        pending = false;
        fulfill(v);
      }
      function fail(e) {
        if (!pending) { return; }
        pending = false;
        reject(e);
      }
      for (var i = 0; i < promises.length; i++) {
        if (promises[i] && isFunction(promises[i].then)) {
          promises[i].then(ok, fail);
        }
      }
    });
  };

  Promise$1.resolve = function(value) {
    if (value && isFunction(value.then)) { return value; }
    return new Promise$1(function (fulfill) {
      fulfill(value);
    });
  };

  Promise$1.reject = function(reason) {
    if (reason && isFunction(reason.then)) { return reason; }
    return new Promise$1(function (fulfill, reject) {
      reject(reason);
    });
  };

  // TODO use MutationObservers or something to simulate setImmediate
  var wait = function(callback) {
    setTimeout(callback, 0);
  };

  var makeDispatcher = function(handlers, result) {
    return function() {
      for (var handler = (void 0); (handler = handlers.shift()); ) {
        handler(result);
      }
    };
  };

  var resolve$1 = function(promise, x, fulfil, reject) {
    var then;
    if (x === promise) {
      throw new TypeError("A promise's fulfillment handler cannot return the same promise");
    }
    if (x instanceof Promise$1) {
      x.then(fulfil, reject);
    } else if (x && (isObjectType(x) || isFunction(x))) {
      try {
        then = x.then;
      } catch (e) {
        reject(e);
        return;
      }
      if (isFunction(then)) {
        var called;

        var resolvePromise = function(y) {
          if (called) { return; }
          called = true;
          resolve$1(promise, y, fulfil, reject);
        };
        var rejectPromise = function(r) {
          if (called) { return; }
          called = true;
          reject(r);
        };

        try {
          then.call(x, resolvePromise, rejectPromise);
        } catch (e) {
          if (!called) {
            reject(e);
            called = true;
            return;
          }
        }
      } else {
        fulfil(x);
      }
    } else {
      fulfil(x);
    }
  };
}

/* istanbul ignore if */
if (
  typeof window !== 'undefined' &&
  !(window.requestAnimationFrame && window.cancelAnimationFrame)
) {
  var lastTime = 0;
  window.requestAnimationFrame = function(callback) {
    var currentTime = Date.now();
    var timeToNextCall = Math.max(0, 16 - (currentTime - lastTime));
    var id = window.setTimeout(function () {
      callback(currentTime + timeToNextCall);
    }, timeToNextCall);
    lastTime = currentTime + timeToNextCall;
    return id;
  };
  window.cancelAnimationFrame = function(id) {
    clearTimeout(id);
  };
}

var defaults = {
  // render placement:
  el: void 0,
  append: false,
  delegate: true,
  enhance: false,

  // template:
  template: null,

  // parse:
  allowExpressions: true,
  delimiters: ['{{', '}}'],
  tripleDelimiters: ['{{{', '}}}'],
  staticDelimiters: ['[[', ']]'],
  staticTripleDelimiters: ['[[[', ']]]'],
  csp: true,
  interpolate: false,
  preserveWhitespace: false,
  sanitize: false,
  stripComments: true,
  contextLines: 0,

  // data & binding:
  data: create(null),
  helpers: create(null),
  computed: create(null),
  syncComputedChildren: false,
  resolveInstanceMembers: false,
  warnAboutAmbiguity: false,
  adapt: [],
  isolated: true,
  twoway: true,
  lazy: false,

  // transitions:
  noIntro: false,
  noOutro: false,
  transitionsEnabled: true,
  complete: void 0,
  nestedTransitions: true,

  // css:
  css: null,
  noCSSTransform: false
};

// These are a subset of the easing equations found at
// https://raw.github.com/danro/easing-js - license info
// follows:

// --------------------------------------------------
// easing.js v0.5.4
// Generic set of easing functions with AMD support
// https://github.com/danro/easing-js
// This code may be freely distributed under the MIT license
// http://danro.mit-license.org/
// --------------------------------------------------
// All functions adapted from Thomas Fuchs & Jeremy Kahn
// Easing Equations (c) 2003 Robert Penner, BSD license
// https://raw.github.com/danro/easing-js/master/LICENSE
// --------------------------------------------------

// In that library, the functions named easeIn, easeOut, and
// easeInOut below are named easeInCubic, easeOutCubic, and
// (you guessed it) easeInOutCubic.
//
// You can add additional easing functions to this list, and they
// will be globally available.

var easing = {
  linear: function linear(pos) {
    return pos;
  },
  easeIn: function easeIn(pos) {
    /* istanbul ignore next */
    return Math.pow(pos, 3);
  },
  easeOut: function easeOut(pos) {
    return Math.pow(pos - 1, 3) + 1;
  },
  easeInOut: function easeInOut(pos) {
    /* istanbul ignore next */
    if ((pos /= 0.5) < 1) {
      return 0.5 * Math.pow(pos, 3);
    }
    /* istanbul ignore next */
    return 0.5 * (Math.pow(pos - 2, 3) + 2);
  }
};

function noop() {}

/* global console */
/* eslint no-console:"off" */

var alreadyWarned = {};
var log;
var printWarning;
var welcome;

if (hasConsole) {
  var welcomeIntro = [
    "%cRactive.js %c1.3.14 %cin debug mode, %cmore...",
    'color: rgb(114, 157, 52); font-weight: normal;',
    'color: rgb(85, 85, 85); font-weight: normal;',
    'color: rgb(85, 85, 85); font-weight: normal;',
    'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'
  ];
  var welcomeMessage = "You're running Ractive 1.3.14 in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\n\nTo disable debug mode, add this line at the start of your app:\n  Ractive.DEBUG = false;\n\nTo disable debug mode when your app is minified, add this snippet:\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\n\nGet help and support:\n  http://ractive.js.org\n  http://stackoverflow.com/questions/tagged/ractivejs\n  http://groups.google.com/forum/#!forum/ractive-js\n  http://twitter.com/ractivejs\n\nFound a bug? Raise an issue:\n  https://github.com/ractivejs/ractive/issues\n\n";

  welcome = function () {
    if (Ractive.WELCOME_MESSAGE === false) {
      welcome = noop;
      return;
    }
    var message = 'WELCOME_MESSAGE' in Ractive ? Ractive.WELCOME_MESSAGE : welcomeMessage;
    var hasGroup = !!console.groupCollapsed;
    if (hasGroup) { console.groupCollapsed.apply(console, welcomeIntro); }
    console.log(message);
    if (hasGroup) {
      console.groupEnd(welcomeIntro);
    }

    welcome = noop;
  };

  printWarning = function (message, args) {
    welcome();

    // extract information about the instance this message pertains to, if applicable
    if (isObjectType(args[args.length - 1])) {
      var options = args.pop();
      var ractive = options ? options.ractive : null;

      if (ractive) {
        // if this is an instance of a component that we know the name of, add
        // it to the message
        var name;
        if (ractive.component && (name = ractive.component.name)) {
          message = "<" + name + "> " + message;
        }

        var node;
        if (
          (node =
            options.node || (ractive.fragment && ractive.fragment.rendered && ractive.find('*')))
        ) {
          args.push(node);
        }
      }
    }

    console.warn.apply(
      console,
      ['%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);'].concat(
        args
      )
    );
  };

  log = function() {
    console.log.apply(console, arguments);
  };
} else {
  printWarning = log = welcome = noop;
}

function format(message, args) {
  return message.replace(/%s/g, function () { return args.shift(); });
}

function fatal(message) {
  var args = [], len = arguments.length - 1;
  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];

  message = format(message, args);
  throw new Error(message);
}

function logIfDebug() {
  if (Ractive.DEBUG) {
    log.apply(null, arguments);
  }
}

function warn(message) {
  var args = [], len = arguments.length - 1;
  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];

  message = format(message, args);
  printWarning(message, args);
}

function warnOnce(message) {
  var args = [], len = arguments.length - 1;
  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];

  message = format(message, args);

  if (alreadyWarned[message]) {
    return;
  }

  alreadyWarned[message] = true;
  printWarning(message, args);
}

function warnIfDebug() {
  if (Ractive.DEBUG) {
    warn.apply(null, arguments);
  }
}

function warnOnceIfDebug() {
  if (Ractive.DEBUG) {
    warnOnce.apply(null, arguments);
  }
}

// Error messages that are used (or could be) in multiple places
var badArguments = 'Bad arguments';
var noRegistryFunctionReturn =
  'A function was specified for "%s" %s, but no %s was returned';
var missingPlugin = function (name, type) { return ("Missing \"" + name + "\" " + type + " plugin. You may need to download a plugin via http://ractive.js.org/integrations/#" + type + "s"); };

function findInViewHierarchy(registryName, ractive, name) {
  var instance = findInstance(registryName, ractive, name);
  return instance ? instance[registryName][name] : null;
}

function findInstance(registryName, ractive, name) {
  while (ractive) {
    if (name in ractive[registryName]) {
      return ractive;
    }

    if (ractive.isolated) {
      return null;
    }

    ractive = ractive.parent;
  }
}

function interpolate(from, to, ractive, type) {
  if (from === to) { return null; }

  if (type) {
    var interpol = findInViewHierarchy('interpolators', ractive, type);
    if (interpol) { return interpol(from, to) || null; }

    fatal(missingPlugin(type, 'interpolator'));
  }

  return (
    interpolators.number(from, to) ||
    interpolators.array(from, to) ||
    interpolators.object(from, to) ||
    null
  );
}

var interpolators = {
  number: function number(from, to) {
    if (!isNumeric(from) || !isNumeric(to)) {
      return null;
    }

    from = +from;
    to = +to;

    var delta = to - from;

    if (!delta) {
      return function() {
        return from;
      };
    }

    return function(t) {
      return from + t * delta;
    };
  },

  array: function array(from, to) {
    var len, i;

    if (!isArray(from) || !isArray(to)) {
      return null;
    }

    var intermediate = [];
    var interpolators = [];

    i = len = Math.min(from.length, to.length);
    while (i--) {
      interpolators[i] = interpolate(from[i], to[i]);
    }

    // surplus values - don't interpolate, but don't exclude them either
    for (i = len; i < from.length; i += 1) {
      intermediate[i] = from[i];
    }

    for (i = len; i < to.length; i += 1) {
      intermediate[i] = to[i];
    }

    return function(t) {
      var i = len;

      while (i--) {
        intermediate[i] = interpolators[i](t);
      }

      return intermediate;
    };
  },

  object: function object(from, to) {
    if (!isObject(from) || !isObject(to)) {
      return null;
    }

    var properties = [];
    var intermediate = {};
    var interpolators = {};

    var loop = function ( prop ) {
      if (hasOwn(from, prop)) {
        if (hasOwn(to, prop)) {
          properties.push(prop);
          interpolators[prop] = interpolate(from[prop], to[prop]) || (function () { return to[prop]; });
        } else {
          intermediate[prop] = from[prop];
        }
      }
    };

    for (var prop in from) loop( prop );

    for (var prop$1 in to) {
      if (hasOwn(to, prop$1) && !hasOwn(from, prop$1)) {
        intermediate[prop$1] = to[prop$1];
      }
    }

    var len = properties.length;

    return function(t) {
      var i = len;

      while (i--) {
        var prop = properties[i];

        intermediate[prop] = interpolators[prop](t);
      }

      return intermediate;
    };
  }
};

var refPattern = /\[\s*(\*|[0-9]|[1-9][0-9]+)\s*\]/g;
var splitPattern = /([^\\](?:\\\\)*)\./;
var escapeKeyPattern = /\\|\./g;
var unescapeKeyPattern = /((?:\\)+)\1|\\(\.)/g;

function escapeKey(key) {
  if (isString(key)) {
    return key.replace(escapeKeyPattern, '\\$&');
  }

  return key;
}

function normalise(ref) {
  return ref ? ref.replace(refPattern, '.$1') : '';
}

function splitKeypath(keypath) {
  var result = [];
  var match;

  keypath = normalise(keypath);

  while ((match = splitPattern.exec(keypath))) {
    var index = match.index + match[1].length;
    result.push(keypath.substr(0, index));
    keypath = keypath.substr(index + 1);
  }

  result.push(keypath);

  return result;
}

function unescapeKey(key) {
  if (isString(key)) {
    return key.replace(unescapeKeyPattern, '$1$2');
  }

  return key;
}

function addToArray(array, value) {
  var index = array.indexOf(value);

  if (index === -1) {
    array.push(value);
  }
}

function arrayContains(array, value) {
  for (var i = 0, c = array.length; i < c; i++) {
    if (array[i] == value) {
      return true;
    }
  }

  return false;
}

function arrayContentsMatch(a, b) {
  var i;

  if (!isArray(a) || !isArray(b)) {
    return false;
  }

  if (a.length !== b.length) {
    return false;
  }

  i = a.length;
  while (i--) {
    if (a[i] !== b[i]) {
      return false;
    }
  }

  return true;
}

function ensureArray(x) {
  if (isString(x)) {
    return [x];
  }

  if (isUndefined(x)) {
    return [];
  }

  return x;
}

function lastItem(array) {
  return array[array.length - 1];
}

function removeFromArray(array, member) {
  if (!array) {
    return;
  }

  var index = array.indexOf(member);

  if (index !== -1) {
    array.splice(index, 1);
  }
}

function combine() {
  var arrays = [], len = arguments.length;
  while ( len-- ) arrays[ len ] = arguments[ len ];

  var res = arrays.concat.apply([], arrays);
  var i = res.length;
  while (i--) {
    var idx = res.indexOf(res[i]);
    if (~idx && idx < i) { res.splice(i, 1); }
  }

  return res;
}

function toArray(arrayLike) {
  var array = [];
  var i = arrayLike.length;
  while (i--) {
    array[i] = arrayLike[i];
  }

  return array;
}

function findMap(array, fn) {
  var len = array.length;
  for (var i = 0; i < len; i++) {
    var result = fn(array[i]);
    if (result) { return result; }
  }
}

function buildNewIndices(one, two, comparator) {
  var oldArray = one;
  var newArray = two;
  if (comparator) {
    oldArray = oldArray.map(comparator);
    newArray = newArray.map(comparator);
  }

  var oldLength = oldArray.length;

  var usedIndices = {};
  var firstUnusedIndex = 0;

  var result = oldArray.map(function (item) {
    var index;
    var start = firstUnusedIndex;

    do {
      index = newArray.indexOf(item, start);

      if (index === -1) {
        return -1;
      }

      start = index + 1;
    } while (usedIndices[index] === true && start < oldLength);

    // keep track of the first unused index, so we don't search
    // the whole of newArray for each item in oldArray unnecessarily
    if (index === firstUnusedIndex) {
      firstUnusedIndex += 1;
    }
    // allow next instance of next "equal" to be found item
    usedIndices[index] = true;
    return index;
  });

  var len = (result.oldLen = oldArray.length);
  result.newLen = newArray.length;

  if (len === result.newLen) {
    var i = 0;
    for (i; i < len; i++) {
      if (result[i] !== i) { break; }
    }

    if (i === len) { result.same = true; }
  }

  return result;
}

var fnBind = Function.prototype.bind;

function bind(fn, context) {
  if (!/this/.test(fn.toString())) { return fn; }

  var bound = fnBind.call(fn, context);
  for (var prop in fn) { bound[prop] = fn[prop]; }

  return bound;
}

var shuffleTasks = { early: [], mark: [] };
var registerQueue = { early: [], mark: [] };
var noVirtual = { virtual: false };

var ModelBase = function ModelBase(parent) {
  this.deps = [];

  this.children = [];
  this.childByKey = {};
  this.links = [];

  this.bindings = [];

  if (parent) {
    this.parent = parent;
    this.root = parent.root;
  }
};
var ModelBase__proto__ = ModelBase.prototype;

ModelBase__proto__.addShuffleTask = function addShuffleTask (task, stage) {
    if ( stage === void 0 ) stage = 'early';

  shuffleTasks[stage].push(task);
};
ModelBase__proto__.addShuffleRegister = function addShuffleRegister (item, stage) {
    if ( stage === void 0 ) stage = 'early';

  registerQueue[stage].push({ model: this, item: item });
};

ModelBase__proto__.downstreamChanged = function downstreamChanged () {};

ModelBase__proto__.findMatches = function findMatches (keys$$1) {
  var len = keys$$1.length;

  var existingMatches = [this];
  var matches;
  var i;

  var loop = function (  ) {
    var key = keys$$1[i];

    if (key === '*') {
      matches = [];
      existingMatches.forEach(function (model) {
        matches.push.apply(matches, model.getValueChildren(model.get()));
      });
    } else {
      matches = existingMatches.map(function (model) { return model.joinKey(key); });
    }

    existingMatches = matches;
  };

    for (i = 0; i < len; i += 1) loop(  );

  return matches;
};

ModelBase__proto__.getKeypath = function getKeypath (ractive) {
  if (ractive !== this.ractive && this._link) { return this._link.target.getKeypath(ractive); }

  if (!this.keypath) {
    var parent = this.parent && this.parent.getKeypath(ractive);
    this.keypath = parent
      ? ((this.parent.getKeypath(ractive)) + "." + (escapeKey(this.key)))
      : escapeKey(this.key);
  }

  return this.keypath;
};

ModelBase__proto__.getValueChildren = function getValueChildren (value) {
    var this$1 = this;

  var children;
  if (isArray(value)) {
    children = [];
    if ('length' in this && this.length !== value.length) {
      children.push(this.joinKey('length'));
    }
    value.forEach(function (m, i) {
      children.push(this$1.joinKey(i));
    });
  } else if (isObject(value) || isFunction(value)) {
    children = keys(value).map(function (key) { return this$1.joinKey(escapeKey(key)); });
  } else if (value != null) {
    children = [];
  }

  var computed = this.computed;
  if (computed) {
    children.push.apply(children, keys(computed).map(function (k) { return this$1.joinKey(k); }));
  }

  return children;
};

ModelBase__proto__.getVirtual = function getVirtual (shouldCapture) {
    var this$1 = this;

  var value = this.get(shouldCapture, { virtual: false });
  if (isObjectLike(value)) {
    var result = isArray(value) ? [] : create(null);

    var keys$$1 = keys(value);
    var i = keys$$1.length;
    while (i--) {
      var child = this$1.childByKey[keys$$1[i]];
      if (!child) { result[keys$$1[i]] = value[keys$$1[i]]; }
      else if (child._link) { result[keys$$1[i]] = child._link.getVirtual(); }
      else { result[keys$$1[i]] = child.getVirtual(); }
    }

    i = this.children.length;
    while (i--) {
      var child$1 = this$1.children[i];
      if (!(child$1.key in result) && child$1._link) {
        result[child$1.key] = child$1._link.getVirtual();
      }
    }

    if (this.computed) {
      keys$$1 = keys(this.computed);
      i = keys$$1.length;
      while (i--) {
        result[keys$$1[i]] = this$1.computed[keys$$1[i]].get();
      }
    }

    return result;
  } else { return value; }
};

ModelBase__proto__.has = function has (key) {
    var this$1 = this;

  if (this._link) { return this._link.has(key); }

  var value = this.get(false, noVirtual);
  if (!value) { return false; }

  key = unescapeKey(key);
  if ((isFunction(value) || isObject(value)) && key in value) { return true; }

  var computed = this.computed;
  if (computed && key in this.computed) { return true; }

  computed = this.root.ractive && this.root.ractive.computed;
  if (computed) {
    keys(computed).forEach(function (k) {
      if (computed[k].pattern && computed[k].pattern.test(this$1.getKeypath())) { return true; }
    });
  }

  return false;
};

ModelBase__proto__.joinAll = function joinAll (keys$$1, opts) {
  var model = this;
  for (var i = 0; i < keys$$1.length; i += 1) {
    if (
      opts &&
      opts.lastLink === false &&
      i + 1 === keys$$1.length &&
      model.childByKey[keys$$1[i]] &&
      model.childByKey[keys$$1[i]]._link
    )
      { return model.childByKey[keys$$1[i]]; }
    model = model.joinKey(keys$$1[i], opts);
  }

  return model;
};

ModelBase__proto__.notifyUpstream = function notifyUpstream (startPath) {
    var this$1 = this;

  var parent = this.parent;
  var path = startPath || [this.key];
  while (parent) {
    if (parent.patterns) { parent.patterns.forEach(function (o) { return o.notify(path.slice()); }); }
    path.unshift(parent.key);
    parent.links.forEach(function (l) { return l.notifiedUpstream(path, this$1.root); });
    parent.deps.forEach(function (d) { return d.handleChange(path); });
    parent.downstreamChanged(startPath);
    parent = parent.parent;
  }
};

ModelBase__proto__.rebind = function rebind (next, previous, safe) {
    var this$1 = this;

  if (this._link) {
    this._link.rebind(next, previous, false);
  }

  if (next === this) { return; }

  // tell the deps to move to the new target
  var i = this.deps.length;
  while (i--) {
    if (this$1.deps[i].rebind) { this$1.deps[i].rebind(next, previous, safe); }
  }

  i = this.links.length;
  while (i--) {
    var link = this$1.links[i];
    // only relink the root of the link tree
    if (link.owner && link.owner._link) { link.relinking(next, safe); }
  }

  i = this.children.length;
  while (i--) {
    var child = this$1.children[i];
    child.rebind(next ? next.joinKey(child.key) : undefined, child._link || child, safe);
    if (this$1.dataModel) {
      this$1.addShuffleTask(function () { return checkDataLink(this$1, this$1.retrieve()); }, 'early');
    }
  }

  i = this.bindings.length;
  while (i--) {
    this$1.bindings[i].rebind(next, previous, safe);
  }
};

ModelBase__proto__.reference = function reference () {
  'refs' in this ? this.refs++ : (this.refs = 1);
};

ModelBase__proto__.register = function register (dep) {
  this.deps.push(dep);
};

ModelBase__proto__.registerLink = function registerLink (link) {
  addToArray(this.links, link);
};

ModelBase__proto__.registerPatternObserver = function registerPatternObserver (observer) {
  (this.patterns || (this.patterns = [])).push(observer);
  this.register(observer);
};

ModelBase__proto__.registerTwowayBinding = function registerTwowayBinding (binding) {
  this.bindings.push(binding);
};

ModelBase__proto__.unreference = function unreference () {
  if ('refs' in this) { this.refs--; }
};

ModelBase__proto__.unregister = function unregister (dep) {
  removeFromArray(this.deps, dep);
};

ModelBase__proto__.unregisterLink = function unregisterLink (link) {
  removeFromArray(this.links, link);
};

ModelBase__proto__.unregisterPatternObserver = function unregisterPatternObserver (observer) {
  removeFromArray(this.patterns, observer);
  this.unregister(observer);
};

ModelBase__proto__.unregisterTwowayBinding = function unregisterTwowayBinding (binding) {
  removeFromArray(this.bindings, binding);
};

ModelBase__proto__.updateFromBindings = function updateFromBindings$1 (cascade) {
    var this$1 = this;

  var i = this.bindings.length;
  while (i--) {
    var value = this$1.bindings[i].getValue();
    if (value !== this$1.value) { this$1.set(value); }
  }

  // check for one-way bindings if there are no two-ways
  if (!this.bindings.length) {
    var oneway = findBoundValue(this.deps);
    if (oneway && oneway.value !== this.value) { this.set(oneway.value); }
  }

  if (cascade) {
    this.children.forEach(updateFromBindings);
    this.links.forEach(updateFromBindings);
    if (this._link) { this._link.updateFromBindings(cascade); }
  }
};

// TODO: this may be better handled by overriding `get` on models with a parent that isRoot
function maybeBind(model, value, shouldBind) {
  if (shouldBind && isFunction(value) && model.parent && model.parent.isRoot) {
    if (!model.boundValue) {
      model.boundValue = bind(value._r_unbound || value, model.parent.ractive);
    }

    return model.boundValue;
  }

  return value;
}

function updateFromBindings(model) {
  model.updateFromBindings(true);
}

function findBoundValue(list) {
  var i = list.length;
  while (i--) {
    if (list[i].bound) {
      var owner = list[i].owner;
      if (owner) {
        var value = owner.name === 'checked' ? owner.node.checked : owner.node.value;
        return { value: value };
      }
    }
  }
}

function fireShuffleTasks(stage) {
  if (!stage) {
    fireShuffleTasks('early');
    fireShuffleTasks('mark');
  } else {
    var tasks = shuffleTasks[stage];
    shuffleTasks[stage] = [];
    var i = tasks.length;
    while (i--) { tasks[i](); }

    var register = registerQueue[stage];
    registerQueue[stage] = [];
    i = register.length;
    while (i--) { register[i].model.register(register[i].item); }
  }
}

function shuffle(model, newIndices, link, unsafe) {
  model.shuffling = true;

  var i = newIndices.length;
  while (i--) {
    var idx = newIndices[i];
    // nothing is actually changing, so move in the index and roll on
    if (i === idx) {
      continue;
    }

    // rebind the children on i to idx
    if (i in model.childByKey)
      { model.childByKey[i].rebind(
        !~idx ? undefined : model.joinKey(idx),
        model.childByKey[i],
        !unsafe
      ); }
  }

  var upstream = model.source().length !== model.source().value.length;

  model.links.forEach(function (l) { return l.shuffle(newIndices); });
  if (!link) { fireShuffleTasks('early'); }

  i = model.deps.length;
  while (i--) {
    if (model.deps[i].shuffle) { model.deps[i].shuffle(newIndices); }
  }

  model[link ? 'marked' : 'mark']();
  if (!link) { fireShuffleTasks('mark'); }

  if (upstream) { model.notifyUpstream(); }

  model.shuffling = false;
}

function checkDataLink(model, value) {
  if (value !== model.dataModel) {
    if (value && value.viewmodel && value.viewmodel.isRoot && model.childByKey.data) {
      model.childByKey.data.link(value.viewmodel, 'data');
      model.dataModel = value;
    } else if (model.dataModel) {
      model.childByKey.data.unlink();
      model.dataModel = true;
    }
  }
}

var stack = [];
var captureGroup;

function startCapturing() {
  stack.push((captureGroup = []));
}

function stopCapturing() {
  var dependencies = stack.pop();
  captureGroup = stack[stack.length - 1];
  return dependencies;
}

function capture(model) {
  if (captureGroup) {
    addToArray(captureGroup, model);
  }
}

function bind$1(x) {
  x.bind();
}
function cancel(x) {
  x.cancel();
}
function destroyed(x) {
  x.destroyed();
}
function handleChange(x) {
  x.handleChange();
}
function mark(x) {
  x.mark();
}
function markForce(x) {
  x.mark(true);
}
function marked(x) {
  x.marked();
}
function markedAll(x) {
  x.markedAll();
}
function render(x) {
  x.render();
}
function shuffled(x) {
  x.shuffled();
}
function teardown(x) {
  x.teardown();
}
function unbind(x) {
  x.unbind();
}
function unrender(x) {
  x.unrender();
}

function update(x) {
  x.update();
}
function toString$1(x) {
  return x.toString();
}
function toEscapedString(x) {
  return x.toString(true);
}

// this is the dry method of checking to see if a rebind applies to
// a particular keypath because in some cases, a dep may be bound
// directly to a particular keypath e.g. foo.bars.0.baz and need
// to avoid getting kicked to foo.bars.1.baz if foo.bars is unshifted
function rebindMatch(template, next, previous, fragment) {
  var keypath = template.r || template;

  // no valid keypath, go with next
  if (!keypath || !isString(keypath)) { return next; }

  // completely contextual ref, go with next
  if (
    keypath === '.' ||
    keypath[0] === '@' ||
    (next || previous).isKey ||
    (next || previous).isKeypath
  )
    { return next; }

  var parts = keypath.split('/');
  var keys = splitKeypath(parts[parts.length - 1]);
  var last = keys[keys.length - 1];

  // check the keypath against the model keypath to see if it matches
  var model = next || previous;

  // check to see if this was an alias
  if (model && keys.length === 1 && last !== model.key && fragment) {
    keys = findAlias(last, fragment) || keys;
  }

  var i = keys.length;
  var match = true;
  var shuffling = false;

  while (model && i--) {
    if (model.shuffling) { shuffling = true; }
    // non-strict comparison to account for indices in keypaths
    if (keys[i] != model.key) { match = false; }
    model = model.parent;
  }

  // next is undefined, but keypath is shuffling and previous matches
  if (!next && match && shuffling) { return previous; }
  else if (next && !match && shuffling)
    // next is defined, but doesn't match the keypath
    { return previous; }
  else { return next; }
}

function findAlias(name, fragment) {
  while (fragment) {
    var z = fragment.aliases;
    if (z && z[name]) {
      var aliases = (fragment.owner.iterations ? fragment.owner : fragment).owner.template.z;
      for (var i = 0; i < aliases.length; i++) {
        if (aliases[i].n === name) {
          var alias = aliases[i].x;
          if (!alias.r) { return false; }
          var parts = alias.r.split('/');
          return splitKeypath(parts[parts.length - 1]);
        }
      }
      return;
    }

    fragment = fragment.componentParent || fragment.parent;
  }
}

// temporary placeholder target for detached implicit links
var Missing = {
  key: '@missing',
  animate: noop,
  applyValue: noop,
  get: noop,
  getKeypath: function getKeypath() {
    return this.key;
  },
  joinAll: function joinAll() {
    return this;
  },
  joinKey: function joinKey() {
    return this;
  },
  mark: noop,
  registerLink: noop,
  shufle: noop,
  set: noop,
  unregisterLink: noop
};
Missing.parent = Missing;

var LinkModel = (function (ModelBase) {
  function LinkModel(parent, owner, target, key) {
    ModelBase.call(this, parent);

    this.owner = owner;
    this.target = target;
    this.key = isUndefined(key) ? owner.key : key;
    if (owner && owner.isLink) { this.sourcePath = (owner.sourcePath) + "." + (this.key); }

    if (target) { target.registerLink(this); }

    if (parent) { this.isReadonly = parent.isReadonly; }

    this.isLink = true;
  }

  if ( ModelBase ) LinkModel.__proto__ = ModelBase;
  var LinkModel__proto__ = LinkModel.prototype = Object.create( ModelBase && ModelBase.prototype );
  LinkModel__proto__.constructor = LinkModel;

  LinkModel__proto__.animate = function animate (from, to, options, interpolator) {
    return this.target.animate(from, to, options, interpolator);
  };

  LinkModel__proto__.applyValue = function applyValue (value) {
    if (this.boundValue) { this.boundValue = null; }
    this.target.applyValue(value);
  };

  LinkModel__proto__.attach = function attach (fragment) {
    var model = resolveReference(fragment, this.key);
    if (model) {
      this.relinking(model, false);
    } else {
      // if there is no link available, move everything here to real models
      this.owner.unlink();
    }
  };

  LinkModel__proto__.detach = function detach () {
    this.relinking(Missing, false);
  };

  LinkModel__proto__.get = function get (shouldCapture, opts) {
    if ( opts === void 0 ) opts = {};

    if (shouldCapture) {
      capture(this);

      // may need to tell the target to unwrap
      opts.unwrap = 'unwrap' in opts ? opts.unwrap : true;
    }

    var bind = 'shouldBind' in opts ? opts.shouldBind : true;
    opts.shouldBind = this.mapping && this.target.parent && this.target.parent.isRoot;

    return maybeBind(this, this.target.get(false, opts), bind);
  };

  LinkModel__proto__.getKeypath = function getKeypath (ractive) {
    if (ractive && ractive !== this.root.ractive) { return this.target.getKeypath(ractive); }

    return ModelBase.prototype.getKeypath.call(this, ractive);
  };

  LinkModel__proto__.handleChange = function handleChange$1 () {
    this.deps.forEach(handleChange);
    this.links.forEach(handleChange);
    this.notifyUpstream();
  };

  LinkModel__proto__.isDetached = function isDetached () {
    return this.virtual && this.target === Missing;
  };

  LinkModel__proto__.joinKey = function joinKey (key) {
    // TODO: handle nested links
    if (isUndefined(key) || key === '') { return this; }

    if (!hasOwn(this.childByKey, key)) {
      var child = new LinkModel(this, this, this.target.joinKey(key), key);
      this.children.push(child);
      this.childByKey[key] = child;
    }

    return this.childByKey[key];
  };

  LinkModel__proto__.mark = function mark (force) {
    this.target.mark(force);
  };

  LinkModel__proto__.marked = function marked$1 () {
    if (this.boundValue) { this.boundValue = null; }

    this.links.forEach(marked);

    this.deps.forEach(handleChange);
  };

  LinkModel__proto__.markedAll = function markedAll$1 () {
    this.children.forEach(markedAll);
    this.marked();
  };

  LinkModel__proto__.notifiedUpstream = function notifiedUpstream (startPath, root) {
    var this$1 = this;

    this.links.forEach(function (l) { return l.notifiedUpstream(startPath, this$1.root); });
    this.deps.forEach(handleChange);
    if (startPath && this.rootLink && this.root !== root) {
      var path = startPath.slice(1);
      path.unshift(this.key);
      this.notifyUpstream(path);
    }
  };

  LinkModel__proto__.relinked = function relinked () {
    this.target.registerLink(this);
    this.children.forEach(function (c) { return c.relinked(); });
  };

  LinkModel__proto__.relinking = function relinking (target, safe) {
    var this$1 = this;

    if (this.rootLink && this.sourcePath)
      { target = rebindMatch(this.sourcePath, target, this.target); }
    if (!target || this.target === target) { return; }

    this.target && this.target.unregisterLink(this);

    this.target = target;
    this.children.forEach(function (c) {
      c.relinking(target.joinKey(c.key), safe);
    });

    if (this.rootLink)
      { this.addShuffleTask(function () {
        this$1.relinked();
        if (!safe) {
          this$1.markedAll();
          this$1.notifyUpstream();
        }
      }); }
  };

  LinkModel__proto__.set = function set (value) {
    if (this.boundValue) { this.boundValue = null; }
    this.target.set(value);
  };

  LinkModel__proto__.shuffle = function shuffle$1 (newIndices) {
    // watch for extra shuffles caused by a shuffle in a downstream link
    if (this.shuffling) { return; }

    // let the real model handle firing off shuffles
    if (!this.target.shuffling) {
      if (this.target.shuffle) {
        this.target.shuffle(newIndices);
      } else {
        // the target is a computation, which can't shuffle
        this.target.mark();
      }
    } else {
      shuffle(this, newIndices, true);
    }
  };

  LinkModel__proto__.source = function source () {
    if (this.target.source) { return this.target.source(); }
    else { return this.target; }
  };

  LinkModel__proto__.teardown = function teardown$3 () {
    if (this._link) { this._link.teardown(); }
    this.target.unregisterLink(this);
    this.children.forEach(teardown);
  };

  return LinkModel;
}(ModelBase));

ModelBase.prototype.link = function link(model, keypath, options) {
  var lnk = this._link || new LinkModel(this.parent, this, model, this.key);
  lnk.implicit = options && options.implicit;
  lnk.mapping = options && options.mapping;
  lnk.sourcePath = keypath;
  lnk.rootLink = true;
  if (this._link) { this._link.relinking(model, false); }
  this.rebind(lnk, this, false);
  fireShuffleTasks();

  this._link = lnk;
  lnk.markedAll();

  this.notifyUpstream();
  return lnk;
};

ModelBase.prototype.unlink = function unlink() {
  if (this._link) {
    var ln = this._link;
    this._link = undefined;
    ln.rebind(this, ln, false);
    fireShuffleTasks();
    ln.teardown();
    this.notifyUpstream();
  }
};

function fromExpression(body, length) {
  if ( length === void 0 ) length = 0;

  var args = new Array(length);

  while (length--) {
    args[length] = "_" + length;
  }

  // Functions created directly with new Function() look like this:
  //     function anonymous (_0 /**/) { return _0*2 }
  //
  // With this workaround, we get a little more compact:
  //     function (_0){return _0*2}
  return new Function([], ("return function (" + (args.join(',')) + "){return(" + body + ");};"))();
}

var functions = create(null);

function getFunction(str, i) {
  if (functions[str]) { return functions[str]; }
  return (functions[str] = createFunction(str, i));
}

function addFunctions(template) {
  if (!template) { return; }

  var exp = template.e;

  if (!exp) { return; }

  keys(exp).forEach(function (str) {
    if (functions[str]) { return; }
    functions[str] = exp[str];
  });
}

var TEMPLATE_VERSION = 4;

var leadingWhitespace = /^\s+/;

var ParseError = function(message) {
  this.name = 'ParseError';
  this.message = message;
  try {
    throw new Error(message);
  } catch (e) {
    this.stack = e.stack;
  }
};

ParseError.prototype = Error.prototype;

var Parser = function(str, options) {
  var item;
  var lineStart = 0;

  this.str = str;
  this.options = options || {};
  this.pos = 0;

  this.lines = this.str.split('\n');
  this.lineEnds = this.lines.map(function (line) {
    var lineEnd = lineStart + line.length + 1; // +1 for the newline

    lineStart = lineEnd;
    return lineEnd;
  }, 0);

  // Custom init logic
  if (this.init) { this.init(str, options); }

  var items = [];

  while (this.pos < this.str.length && (item = this.read())) {
    items.push(item);
  }

  this.leftover = this.remaining();
  this.result = this.postProcess ? this.postProcess(items, options) : items;
};

Parser.prototype = {
  read: function read(converters) {
    var this$1 = this;

    var i, item;

    if (!converters) { converters = this.converters; }

    var pos = this.pos;

    var len = converters.length;
    for (i = 0; i < len; i += 1) {
      this$1.pos = pos; // reset for each attempt

      if ((item = converters[i](this$1))) {
        return item;
      }
    }

    return null;
  },

  getContextMessage: function getContextMessage(pos, message) {
    var ref = this.getLinePos(pos);
    var lineNum = ref[0];
    var columnNum = ref[1];
    if (this.options.contextLines === -1) {
      return [lineNum, columnNum, (message + " at line " + lineNum + " character " + columnNum)];
    }

    var line = this.lines[lineNum - 1];

    var contextUp = '';
    var contextDown = '';
    if (this.options.contextLines) {
      var start =
        lineNum - 1 - this.options.contextLines < 0 ? 0 : lineNum - 1 - this.options.contextLines;
      contextUp = this.lines
        .slice(start, lineNum - 1 - start)
        .join('\n')
        .replace(/\t/g, '  ');
      contextDown = this.lines
        .slice(lineNum, lineNum + this.options.contextLines)
        .join('\n')
        .replace(/\t/g, '  ');
      if (contextUp) {
        contextUp += '\n';
      }
      if (contextDown) {
        contextDown = '\n' + contextDown;
      }
    }

    var numTabs = 0;
    var annotation =
      contextUp +
      line.replace(/\t/g, function (match, char) {
        if (char < columnNum) {
          numTabs += 1;
        }

        return '  ';
      }) +
      '\n' +
      new Array(columnNum + numTabs).join(' ') +
      '^----' +
      contextDown;

    return [
      lineNum,
      columnNum,
      (message + " at line " + lineNum + " character " + columnNum + ":\n" + annotation)
    ];
  },

  getLinePos: function getLinePos(char) {
    var this$1 = this;

    var lineNum = 0;
    var lineStart = 0;

    while (char >= this.lineEnds[lineNum]) {
      lineStart = this$1.lineEnds[lineNum];
      lineNum += 1;
    }

    var columnNum = char - lineStart;
    return [lineNum + 1, columnNum + 1, char]; // line/col should be one-based, not zero-based!
  },

  error: function error(message) {
    var ref = this.getContextMessage(this.pos, message);
    var lineNum = ref[0];
    var columnNum = ref[1];
    var msg = ref[2];

    var error = new ParseError(msg);

    error.line = lineNum;
    error.character = columnNum;
    error.shortMessage = message;

    throw error;
  },

  matchString: function matchString(string) {
    if (this.str.substr(this.pos, string.length) === string) {
      this.pos += string.length;
      return string;
    }
  },

  matchPattern: function matchPattern(pattern) {
    var match;

    if ((match = pattern.exec(this.remaining()))) {
      this.pos += match[0].length;
      return match[1] || match[0];
    }
  },

  sp: function sp() {
    this.matchPattern(leadingWhitespace);
  },

  remaining: function remaining() {
    return this.str.substring(this.pos);
  },

  nextChar: function nextChar() {
    return this.str.charAt(this.pos);
  },

  warn: function warn(message) {
    var msg = this.getContextMessage(this.pos, message)[2];

    warnIfDebug(msg);
  }
};

Parser.extend = function(proto) {
  var Parent = this;
  var Child = function(str, options) {
    Parser.call(this, str, options);
  };

  Child.prototype = create(Parent.prototype);

  for (var key in proto) {
    if (hasOwn(proto, key)) {
      Child.prototype[key] = proto[key];
    }
  }

  Child.extend = Parser.extend;
  return Child;
};

var TEXT = 1;
var INTERPOLATOR = 2;
var TRIPLE = 3;
var SECTION = 4;
var INVERTED = 5;
var CLOSING = 6;
var ELEMENT = 7;
var PARTIAL = 8;
var COMMENT = 9;
var DELIMCHANGE = 10;
var ANCHOR = 11;
var ATTRIBUTE = 13;
var CLOSING_TAG = 14;
var COMPONENT = 15;
var YIELDER = 16;
var INLINE_PARTIAL = 17;
var DOCTYPE = 18;
var ALIAS = 19;

var AWAIT = 55;

var NUMBER_LITERAL = 20;
var STRING_LITERAL = 21;
var ARRAY_LITERAL = 22;
var OBJECT_LITERAL = 23;
var BOOLEAN_LITERAL = 24;
var REGEXP_LITERAL = 25;

var GLOBAL = 26;
var KEY_VALUE_PAIR = 27;

var REFERENCE = 30;
var REFINEMENT = 31;
var MEMBER = 32;
var PREFIX_OPERATOR = 33;
var BRACKETED = 34;
var CONDITIONAL = 35;
var INFIX_OPERATOR = 36;

var INVOCATION = 40;

var SECTION_IF = 50;
var SECTION_UNLESS = 51;
var SECTION_EACH = 52;
var SECTION_WITH = 53;
var SECTION_IF_WITH = 54;

var ELSE = 60;
var ELSEIF = 61;
var THEN = 62;
var CATCH = 63;

var EVENT = 70;
var DECORATOR = 71;
var TRANSITION = 72;
var BINDING_FLAG = 73;
var DELEGATE_FLAG = 74;

var delimiterChangePattern = /^[^\s=]+/;
var whitespacePattern = /^\s+/;

function readDelimiterChange(parser) {
  if (!parser.matchString('=')) {
    return null;
  }

  var start = parser.pos;

  // allow whitespace before new opening delimiter
  parser.sp();

  var opening = parser.matchPattern(delimiterChangePattern);
  if (!opening) {
    parser.pos = start;
    return null;
  }

  // allow whitespace (in fact, it's necessary...)
  if (!parser.matchPattern(whitespacePattern)) {
    return null;
  }

  var closing = parser.matchPattern(delimiterChangePattern);
  if (!closing) {
    parser.pos = start;
    return null;
  }

  // allow whitespace before closing '='
  parser.sp();

  if (!parser.matchString('=')) {
    parser.pos = start;
    return null;
  }

  return [opening, closing];
}

var regexpPattern = /^(\/(?:[^\n\r\u2028\u2029/\\[]|\\.|\[(?:[^\n\r\u2028\u2029\]\\]|\\.)*])+\/(?:([gimuy])(?![a-z]*\2))*(?![a-zA-Z_$0-9]))/;

function readNumberLiteral(parser) {
  var result;

  if ((result = parser.matchPattern(regexpPattern))) {
    return {
      t: REGEXP_LITERAL,
      v: result
    };
  }

  return null;
}

var pattern = /[-/\\^$*+?.()|[\]{}]/g;

function escapeRegExp(str) {
  return str.replace(pattern, '\\$&');
}

var regExpCache = {};

function getLowestIndex(haystack, needles) {
  return haystack.search(
    regExpCache[needles.join()] ||
      (regExpCache[needles.join()] = new RegExp(needles.map(escapeRegExp).join('|')))
  );
}

// https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316
//export const booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;
var booleanAttributes = {
  allowfullscreen: 1,
  async: 1,
  autofocus: 1,
  autoplay: 1,
  checked: 1,
  compact: 1,
  controls: 1,
  declare: 1,
  default: 1,
  defaultchecked: 1,
  defaultmuted: 1,
  defaultselected: 1,
  defer: 1,
  disabled: 1,
  enabled: 1,
  formnovalidate: 1,
  hidden: 1,
  indeterminate: 1,
  inert: 1,
  ismap: 1,
  itemscope: 1,
  loop: 1,
  multiple: 1,
  muted: 1,
  nohref: 1,
  noresize: 1,
  noshade: 1,
  novalidate: 1,
  nowrap: 1,
  open: 1,
  pauseonexit: 1,
  readonly: 1,
  required: 1,
  reversed: 1,
  scoped: 1,
  seamless: 1,
  selected: 1,
  sortable: 1,
  translate: 1,
  truespeed: 1,
  typemustmatch: 1,
  visible: 1
};
var voidElements = {
  area: 1,
  base: 1,
  br: 1,
  col: 1,
  command: 1,
  doctype: 1,
  embed: 1,
  hr: 1,
  img: 1,
  input: 1,
  keygen: 1,
  link: 1,
  meta: 1,
  param: 1,
  source: 1,
  track: 1,
  wbr: 1
};

var htmlEntities = {
  quot: 34,
  amp: 38,
  apos: 39,
  lt: 60,
  gt: 62,
  nbsp: 160,
  iexcl: 161,
  cent: 162,
  pound: 163,
  curren: 164,
  yen: 165,
  brvbar: 166,
  sect: 167,
  uml: 168,
  copy: 169,
  ordf: 170,
  laquo: 171,
  not: 172,
  shy: 173,
  reg: 174,
  macr: 175,
  deg: 176,
  plusmn: 177,
  sup2: 178,
  sup3: 179,
  acute: 180,
  micro: 181,
  para: 182,
  middot: 183,
  cedil: 184,
  sup1: 185,
  ordm: 186,
  raquo: 187,
  frac14: 188,
  frac12: 189,
  frac34: 190,
  iquest: 191,
  Agrave: 192,
  Aacute: 193,
  Acirc: 194,
  Atilde: 195,
  Auml: 196,
  Aring: 197,
  AElig: 198,
  Ccedil: 199,
  Egrave: 200,
  Eacute: 201,
  Ecirc: 202,
  Euml: 203,
  Igrave: 204,
  Iacute: 205,
  Icirc: 206,
  Iuml: 207,
  ETH: 208,
  Ntilde: 209,
  Ograve: 210,
  Oacute: 211,
  Ocirc: 212,
  Otilde: 213,
  Ouml: 214,
  times: 215,
  Oslash: 216,
  Ugrave: 217,
  Uacute: 218,
  Ucirc: 219,
  Uuml: 220,
  Yacute: 221,
  THORN: 222,
  szlig: 223,
  agrave: 224,
  aacute: 225,
  acirc: 226,
  atilde: 227,
  auml: 228,
  aring: 229,
  aelig: 230,
  ccedil: 231,
  egrave: 232,
  eacute: 233,
  ecirc: 234,
  euml: 235,
  igrave: 236,
  iacute: 237,
  icirc: 238,
  iuml: 239,
  eth: 240,
  ntilde: 241,
  ograve: 242,
  oacute: 243,
  ocirc: 244,
  otilde: 245,
  ouml: 246,
  divide: 247,
  oslash: 248,
  ugrave: 249,
  uacute: 250,
  ucirc: 251,
  uuml: 252,
  yacute: 253,
  thorn: 254,
  yuml: 255,
  OElig: 338,
  oelig: 339,
  Scaron: 352,
  scaron: 353,
  Yuml: 376,
  fnof: 402,
  circ: 710,
  tilde: 732,
  Alpha: 913,
  Beta: 914,
  Gamma: 915,
  Delta: 916,
  Epsilon: 917,
  Zeta: 918,
  Eta: 919,
  Theta: 920,
  Iota: 921,
  Kappa: 922,
  Lambda: 923,
  Mu: 924,
  Nu: 925,
  Xi: 926,
  Omicron: 927,
  Pi: 928,
  Rho: 929,
  Sigma: 931,
  Tau: 932,
  Upsilon: 933,
  Phi: 934,
  Chi: 935,
  Psi: 936,
  Omega: 937,
  alpha: 945,
  beta: 946,
  gamma: 947,
  delta: 948,
  epsilon: 949,
  zeta: 950,
  eta: 951,
  theta: 952,
  iota: 953,
  kappa: 954,
  lambda: 955,
  mu: 956,
  nu: 957,
  xi: 958,
  omicron: 959,
  pi: 960,
  rho: 961,
  sigmaf: 962,
  sigma: 963,
  tau: 964,
  upsilon: 965,
  phi: 966,
  chi: 967,
  psi: 968,
  omega: 969,
  thetasym: 977,
  upsih: 978,
  piv: 982,
  ensp: 8194,
  emsp: 8195,
  thinsp: 8201,
  zwnj: 8204,
  zwj: 8205,
  lrm: 8206,
  rlm: 8207,
  ndash: 8211,
  mdash: 8212,
  lsquo: 8216,
  rsquo: 8217,
  sbquo: 8218,
  ldquo: 8220,
  rdquo: 8221,
  bdquo: 8222,
  dagger: 8224,
  Dagger: 8225,
  bull: 8226,
  hellip: 8230,
  permil: 8240,
  prime: 8242,
  Prime: 8243,
  lsaquo: 8249,
  rsaquo: 8250,
  oline: 8254,
  frasl: 8260,
  euro: 8364,
  image: 8465,
  weierp: 8472,
  real: 8476,
  trade: 8482,
  alefsym: 8501,
  larr: 8592,
  uarr: 8593,
  rarr: 8594,
  darr: 8595,
  harr: 8596,
  crarr: 8629,
  lArr: 8656,
  uArr: 8657,
  rArr: 8658,
  dArr: 8659,
  hArr: 8660,
  forall: 8704,
  part: 8706,
  exist: 8707,
  empty: 8709,
  nabla: 8711,
  isin: 8712,
  notin: 8713,
  ni: 8715,
  prod: 8719,
  sum: 8721,
  minus: 8722,
  lowast: 8727,
  radic: 8730,
  prop: 8733,
  infin: 8734,
  ang: 8736,
  and: 8743,
  or: 8744,
  cap: 8745,
  cup: 8746,
  int: 8747,
  there4: 8756,
  sim: 8764,
  cong: 8773,
  asymp: 8776,
  ne: 8800,
  equiv: 8801,
  le: 8804,
  ge: 8805,
  sub: 8834,
  sup: 8835,
  nsub: 8836,
  sube: 8838,
  supe: 8839,
  oplus: 8853,
  otimes: 8855,
  perp: 8869,
  sdot: 8901,
  lceil: 8968,
  rceil: 8969,
  lfloor: 8970,
  rfloor: 8971,
  lang: 9001,
  rang: 9002,
  loz: 9674,
  spades: 9824,
  clubs: 9827,
  hearts: 9829,
  diams: 9830
};
var controlCharacters = [
  8364,
  129,
  8218,
  402,
  8222,
  8230,
  8224,
  8225,
  710,
  8240,
  352,
  8249,
  338,
  141,
  381,
  143,
  144,
  8216,
  8217,
  8220,
  8221,
  8226,
  8211,
  8212,
  732,
  8482,
  353,
  8250,
  339,
  157,
  382,
  376
];
var entityPattern = new RegExp(
  '&(#?(?:x[\\w\\d]+|\\d+|' + keys(htmlEntities).join('|') + '));?',
  'g'
);
var codePointSupport = isFunction(String.fromCodePoint);
var codeToChar = codePointSupport ? String.fromCodePoint : String.fromCharCode;

function decodeCharacterReferences(html) {
  return html.replace(entityPattern, function (match, entity) {
    var code;

    // Handle named entities
    if (entity[0] !== '#') {
      code = htmlEntities[entity];
    } else if (entity[1] === 'x') {
      code = parseInt(entity.substring(2), 16);
    } else {
      code = parseInt(entity.substring(1), 10);
    }

    if (!code) {
      return match;
    }

    return codeToChar(validateCode(code));
  });
}

var lessThan = /</g;
var greaterThan = />/g;
var amp = /&/g;
var invalid = 65533;

function escapeHtml(str) {
  return str
    .replace(amp, '&amp;')
    .replace(lessThan, '&lt;')
    .replace(greaterThan, '&gt;');
}

// some code points are verboten. If we were inserting HTML, the browser would replace the illegal
// code points with alternatives in some cases - since we're bypassing that mechanism, we need
// to replace them ourselves
//
// Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters
/* istanbul ignore next */
function validateCode(code) {
  if (!code) {
    return invalid;
  }

  // line feed becomes generic whitespace
  if (code === 10) {
    return 32;
  }

  // ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)
  if (code < 128) {
    return code;
  }

  // code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need
  // to correct the mistake or we'll end up with missing  signs and so on
  if (code <= 159) {
    return controlCharacters[code - 128];
  }

  // basic multilingual plane
  if (code < 55296) {
    return code;
  }

  // UTF-16 surrogate halves
  if (code <= 57343) {
    return invalid;
  }

  // rest of the basic multilingual plane
  if (code <= 65535) {
    return code;
  } else if (!codePointSupport) {
    return invalid;
  }

  // supplementary multilingual plane 0x10000 - 0x1ffff
  if (code >= 65536 && code <= 131071) {
    return code;
  }

  // supplementary ideographic plane 0x20000 - 0x2ffff
  if (code >= 131072 && code <= 196607) {
    return code;
  }

  return invalid;
}

var expectedExpression = 'Expected a JavaScript expression';
var expectedParen = 'Expected closing paren';

// bulletproof number regex from https://gist.github.com/Rich-Harris/7544330
var numberPattern = /^(?:[+-]?)0*(?:(?:(?:[1-9]\d*)?\.\d+)|(?:(?:0|[1-9]\d*)\.)|(?:0|[1-9]\d*))(?:[eE][+-]?\d+)?/;

function readNumberLiteral$1(parser) {
  var result;

  if ((result = parser.matchPattern(numberPattern))) {
    return {
      t: NUMBER_LITERAL,
      v: result
    };
  }

  return null;
}

function readBooleanLiteral(parser) {
  var remaining = parser.remaining();

  if (remaining.substr(0, 4) === 'true') {
    parser.pos += 4;
    return {
      t: BOOLEAN_LITERAL,
      v: 'true'
    };
  }

  if (remaining.substr(0, 5) === 'false') {
    parser.pos += 5;
    return {
      t: BOOLEAN_LITERAL,
      v: 'false'
    };
  }

  return null;
}

// Match one or more characters until: ", ', \, or EOL/EOF.
// EOL/EOF is written as (?!.) (meaning there's no non-newline char next).
var stringMiddlePattern = /^(?=.)[^"'\\]+?(?:(?!.)|(?=["'\\]))/;

// Match one escape sequence, including the backslash.
var escapeSequencePattern = /^\\(?:[`'"\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;

// Match one ES5 line continuation (backslash + line terminator).
var lineContinuationPattern = /^\\(?:\r\n|[\u000A\u000D\u2028\u2029])/;

// Helper for defining getDoubleQuotedString and getSingleQuotedString.
function makeQuotedStringMatcher(okQuote) {
  return function(parser) {
    var literal = '"';
    var done = false;
    var next;

    while (!done) {
      next =
        parser.matchPattern(stringMiddlePattern) ||
        parser.matchPattern(escapeSequencePattern) ||
        parser.matchString(okQuote);
      if (next) {
        if (next === "\"") {
          literal += "\\\"";
        } else if (next === "\\'") {
          literal += "'";
        } else {
          literal += next;
        }
      } else {
        next = parser.matchPattern(lineContinuationPattern);
        if (next) {
          // convert \(newline-like) into a \u escape, which is allowed in JSON
          literal += '\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);
        } else {
          done = true;
        }
      }
    }

    literal += '"';

    // use JSON.parse to interpret escapes
    return JSON.parse(literal);
  };
}

var singleMatcher = makeQuotedStringMatcher("\"");
var doubleMatcher = makeQuotedStringMatcher("'");

function readStringLiteral(parser) {
  var start = parser.pos;
  var quote = parser.matchString("'") || parser.matchString("\"");

  if (quote) {
    var string = (quote === "'" ? singleMatcher : doubleMatcher)(parser);

    if (!parser.matchString(quote)) {
      parser.pos = start;
      return null;
    }

    return {
      t: STRING_LITERAL,
      v: string
    };
  }

  return null;
}

// Match one or more characters until: ", ', or \
var stringMiddlePattern$1 = /^[^`"\\\$]+?(?:(?=[`"\\\$]))/;

var escapes = /[\r\n\t\b\f]/g;
function getString(literal) {
  return JSON.parse(("\"" + (literal.replace(escapes, escapeChar)) + "\""));
}

function escapeChar(c) {
  switch (c) {
    case '\n':
      return '\\n';
    case '\r':
      return '\\r';
    case '\t':
      return '\\t';
    case '\b':
      return '\\b';
    case '\f':
      return '\\f';
  }
}

function readTemplateStringLiteral(parser) {
  if (!parser.matchString('`')) { return null; }

  var literal = '';
  var done = false;
  var next;
  var parts = [];

  while (!done) {
    next =
      parser.matchPattern(stringMiddlePattern$1) ||
      parser.matchPattern(escapeSequencePattern) ||
      parser.matchString('$') ||
      parser.matchString('"');
    if (next) {
      if (next === "\"") {
        literal += "\\\"";
      } else if (next === '\\`') {
        literal += '`';
      } else if (next === '$') {
        if (parser.matchString('{')) {
          parts.push({ t: STRING_LITERAL, v: getString(literal) });
          literal = '';

          parser.sp();
          var expr = readExpression(parser);

          if (!expr) { parser.error('Expected valid expression'); }

          parts.push({ t: BRACKETED, x: expr });

          parser.sp();
          if (!parser.matchString('}'))
            { parser.error("Expected closing '}' after interpolated expression"); }
        } else {
          literal += '$';
        }
      } else {
        literal += next;
      }
    } else {
      next = parser.matchPattern(lineContinuationPattern);
      if (next) {
        // convert \(newline-like) into a \u escape, which is allowed in JSON
        literal += '\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);
      } else {
        done = true;
      }
    }
  }

  if (literal.length) { parts.push({ t: STRING_LITERAL, v: getString(literal) }); }

  if (!parser.matchString('`')) { parser.error("Expected closing '`'"); }

  if (!parts.length) {
    // empty string literal
    return { t: STRING_LITERAL, v: '' };
  } else if (parts.length === 1) {
    return parts[0];
  } else {
    var result = parts.pop();
    var part;

    while ((part = parts.pop())) {
      result = {
        t: INFIX_OPERATOR,
        s: '+',
        o: [part, result]
      };
    }

    return {
      t: BRACKETED,
      x: result
    };
  }
}

var name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;
var spreadPattern = /^\s*\.{3}/;
var legalReference = /^(?:[a-zA-Z$_0-9]|\\\.)+(?:(?:\.(?:[a-zA-Z$_0-9]|\\\.)+)|(?:\[[0-9]+\]))*/;
var relaxedName = /^[a-zA-Z_$][-\/a-zA-Z_$0-9]*(?:\.(?:[a-zA-Z_$][-\/a-zA-Z_$0-9]*))*/;

var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;

// http://mathiasbynens.be/notes/javascript-properties
// can be any name, string literal, or number literal
function readKey(parser) {
  var token;

  if ((token = readStringLiteral(parser))) {
    return identifier.test(token.v) ? token.v : '"' + token.v.replace(/"/g, '\\"') + '"';
  }

  if ((token = readNumberLiteral$1(parser))) {
    return token.v;
  }

  if ((token = parser.matchPattern(name))) {
    return token;
  }

  return null;
}

function readKeyValuePair(parser) {
  var spread;
  var start = parser.pos;

  // allow whitespace between '{' and key
  parser.sp();

  var refKey = parser.nextChar() !== "'" && parser.nextChar() !== '"';
  if (refKey) { spread = parser.matchPattern(spreadPattern); }

  var key = spread ? readExpression(parser) : readKey(parser);
  if (key === null) {
    parser.pos = start;
    return null;
  }

  // allow whitespace between key and ':'
  parser.sp();

  // es2015 shorthand property
  if (refKey && (parser.nextChar() === ',' || parser.nextChar() === '}')) {
    if (!spread && !name.test(key)) {
      parser.error(("Expected a valid reference, but found '" + key + "' instead."));
    }

    var pair = {
      t: KEY_VALUE_PAIR,
      k: key,
      v: {
        t: REFERENCE,
        n: key
      }
    };

    if (spread) {
      pair.p = true;
    }

    return pair;
  }

  // next character must be ':'
  if (!parser.matchString(':')) {
    parser.pos = start;
    return null;
  }

  // allow whitespace between ':' and value
  parser.sp();

  // next expression must be a, well... expression
  var value = readExpression(parser);
  if (value === null) {
    parser.pos = start;
    return null;
  }

  return {
    t: KEY_VALUE_PAIR,
    k: key,
    v: value
  };
}

function readKeyValuePairs(parser) {
  var start = parser.pos;

  var pair = readKeyValuePair(parser);
  if (pair === null) {
    return null;
  }

  var pairs = [pair];

  if (parser.matchString(',')) {
    var keyValuePairs = readKeyValuePairs(parser);

    if (!keyValuePairs) {
      parser.pos = start;
      return null;
    }

    return pairs.concat(keyValuePairs);
  }

  return pairs;
}

function readObjectLiteral(parser) {
  var start = parser.pos;

  // allow whitespace
  parser.sp();

  if (!parser.matchString('{')) {
    parser.pos = start;
    return null;
  }

  var keyValuePairs = readKeyValuePairs(parser);

  // allow whitespace between final value and '}'
  parser.sp();

  if (!parser.matchString('}')) {
    parser.pos = start;
    return null;
  }

  return {
    t: OBJECT_LITERAL,
    m: keyValuePairs
  };
}

function readArrayLiteral(parser) {
  var start = parser.pos;

  // allow whitespace before '['
  parser.sp();

  if (!parser.matchString('[')) {
    parser.pos = start;
    return null;
  }

  var expressionList = readExpressionList(parser, true);

  if (!parser.matchString(']')) {
    parser.pos = start;
    return null;
  }

  return {
    t: ARRAY_LITERAL,
    m: expressionList
  };
}

function readLiteral(parser) {
  return (
    readNumberLiteral$1(parser) ||
    readBooleanLiteral(parser) ||
    readStringLiteral(parser) ||
    readTemplateStringLiteral(parser) ||
    readObjectLiteral(parser) ||
    readArrayLiteral(parser) ||
    readNumberLiteral(parser)
  );
}

// if a reference is a browser global, we don't deference it later, so it needs special treatment
var globals = /^(?:Array|console|Date|RegExp|decodeURIComponent|decodeURI|encodeURIComponent|encodeURI|isFinite|isNaN|parseFloat|parseInt|JSON|Math|NaN|undefined|null|Object|Number|String|Boolean)\b/;

// keywords are not valid references, with the exception of `this`
var keywords = /^(?:break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|var|void|while|with)$/;

var prefixPattern = /^(?:\@\.|\@|~\/|(?:\^\^\/(?:\^\^\/)*(?:\.\.\/)*)|(?:\.\.\/)+|\.\/(?:\.\.\/)*|\.)/;
var specials = /^(key|index|keypath|rootpath|this|global|shared|context|event|node|local|style|helpers|last|macro)/;

function readReference(parser) {
  var prefix, name$$1, global, reference, lastDotIndex;

  var startPos = parser.pos;

  prefix = parser.matchPattern(prefixPattern) || '';
  name$$1 =
    (!prefix && parser.relaxedNames && parser.matchPattern(relaxedName)) ||
    parser.matchPattern(legalReference);
  var actual = prefix.length + ((name$$1 && name$$1.length) || 0);

  if (prefix === '@.') {
    prefix = '@';
    if (name$$1) { name$$1 = 'this.' + name$$1; }
    else { name$$1 = 'this'; }
  }

  if (!name$$1 && prefix) {
    name$$1 = prefix;
    prefix = '';
  }

  if (!name$$1) {
    return null;
  }

  if (prefix === '@') {
    if (!specials.test(name$$1)) {
      parser.error(("Unrecognized special reference @" + name$$1));
    } else if ((!name$$1.indexOf('event') || !name$$1.indexOf('node')) && !parser.inEvent) {
      parser.error("@event and @node are only valid references within an event directive");
    } else if (!name$$1.indexOf('context')) {
      parser.pos = parser.pos - (name$$1.length - 7);
      return {
        t: BRACKETED,
        x: {
          t: REFERENCE,
          n: '@context'
        }
      };
    }
  }

  // bug out if it's a keyword (exception for ancestor/restricted refs - see https://github.com/ractivejs/ractive/issues/1497)
  if (!prefix && !parser.relaxedNames && keywords.test(name$$1)) {
    parser.pos = startPos;
    return null;
  }

  // if this is a browser global, stop here
  if (!prefix && globals.test(name$$1)) {
    global = globals.exec(name$$1)[0];
    parser.pos = startPos + global.length;

    return {
      t: GLOBAL,
      v: global
    };
  }

  reference = (prefix || '') + normalise(name$$1);

  if (parser.matchString('(')) {
    // if this is a method invocation (as opposed to a function) we need
    // to strip the method name from the reference combo, else the context
    // will be wrong
    // but only if the reference was actually a member and not a refinement
    lastDotIndex = reference.lastIndexOf('.');
    if (lastDotIndex !== -1 && name$$1[name$$1.length - 1] !== ']') {
      if (lastDotIndex === 0) {
        reference = '.';
        parser.pos = startPos;
      } else {
        var refLength = reference.length;
        reference = reference.substr(0, lastDotIndex);
        parser.pos = startPos + (actual - (refLength - lastDotIndex));
      }
    } else {
      parser.pos -= 1;
    }
  }

  return {
    t: REFERENCE,
    n: reference.replace(/^this\./, './').replace(/^this$/, '.')
  };
}

function readBracketedExpression(parser) {
  if (!parser.matchString('(')) { return null; }

  parser.sp();

  var expr = readExpression(parser);

  if (!expr) { parser.error(expectedExpression); }

  parser.sp();

  if (!parser.matchString(')')) { parser.error(expectedParen); }

  return {
    t: BRACKETED,
    x: expr
  };
}

function readPrimary(parser) {
  return readLiteral(parser) || readReference(parser) || readBracketedExpression(parser);
}

function readRefinement(parser) {
  // some things call for strict refinement (partial names), meaning no space between reference and refinement
  if (!parser.strictRefinement) {
    parser.sp();
  }

  // "." name
  if (parser.matchString('.')) {
    parser.sp();

    var name$$1 = parser.matchPattern(name);
    if (name$$1) {
      return {
        t: REFINEMENT,
        n: name$$1
      };
    }

    parser.error('Expected a property name');
  }

  // "[" expression "]"
  if (parser.matchString('[')) {
    parser.sp();

    var expr = readExpression(parser);
    if (!expr) { parser.error(expectedExpression); }

    parser.sp();

    if (!parser.matchString(']')) { parser.error("Expected ']'"); }

    return {
      t: REFINEMENT,
      x: expr
    };
  }

  return null;
}

function readMemberOrInvocation(parser) {
  var expression = readPrimary(parser);

  if (!expression) { return null; }

  while (expression) {
    var refinement = readRefinement(parser);
    if (refinement) {
      expression = {
        t: MEMBER,
        x: expression,
        r: refinement
      };
    } else if (parser.matchString('(')) {
      parser.sp();
      var expressionList = readExpressionList(parser, true);

      parser.sp();

      if (!parser.matchString(')')) {
        parser.error(expectedParen);
      }

      expression = {
        t: INVOCATION,
        x: expression
      };

      if (expressionList) { expression.o = expressionList; }
    } else {
      break;
    }
  }

  return expression;
}

var readTypeOf;

var makePrefixSequenceMatcher = function(symbol, fallthrough) {
  return function(parser) {
    var expression;

    if ((expression = fallthrough(parser))) {
      return expression;
    }

    if (!parser.matchString(symbol)) {
      return null;
    }

    parser.sp();

    expression = readExpression(parser);
    if (!expression) {
      parser.error(expectedExpression);
    }

    return {
      s: symbol,
      o: expression,
      t: PREFIX_OPERATOR
    };
  };
};

// create all prefix sequence matchers, return readTypeOf
(function() {
  var i, len, matcher, fallthrough;

  var prefixOperators = '! ~ + - typeof'.split(' ');

  fallthrough = readMemberOrInvocation;
  for (i = 0, len = prefixOperators.length; i < len; i += 1) {
    matcher = makePrefixSequenceMatcher(prefixOperators[i], fallthrough);
    fallthrough = matcher;
  }

  // typeof operator is higher precedence than multiplication, so provides the
  // fallthrough for the multiplication sequence matcher we're about to create
  // (we're skipping void and delete)
  readTypeOf = fallthrough;
})();

var readTypeof = readTypeOf;

var readLogicalOr;

var makeInfixSequenceMatcher = function(symbol, fallthrough) {
  return function(parser) {
    // > and / have to be quoted
    if (parser.inUnquotedAttribute && (symbol === '>' || symbol === '/'))
      { return fallthrough(parser); }

    var start, left, right;

    left = fallthrough(parser);
    if (!left) {
      return null;
    }

    // Loop to handle left-recursion in a case like `a * b * c` and produce
    // left association, i.e. `(a * b) * c`.  The matcher can't call itself
    // to parse `left` because that would be infinite regress.
    while (true) {
      start = parser.pos;

      parser.sp();

      if (!parser.matchString(symbol)) {
        parser.pos = start;
        return left;
      }

      // special case - in operator must not be followed by [a-zA-Z_$0-9]
      if (symbol === 'in' && /[a-zA-Z_$0-9]/.test(parser.remaining().charAt(0))) {
        parser.pos = start;
        return left;
      }

      parser.sp();

      // right operand must also consist of only higher-precedence operators
      right = fallthrough(parser);
      if (!right) {
        parser.pos = start;
        return left;
      }

      left = {
        t: INFIX_OPERATOR,
        s: symbol,
        o: [left, right]
      };

      // Loop back around.  If we don't see another occurrence of the symbol,
      // we'll return left.
    }
  };
};

// create all infix sequence matchers, and return readLogicalOr
(function() {
  var i, len, matcher, fallthrough;

  // All the infix operators on order of precedence (source: https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/Operator_Precedence)
  // Each sequence matcher will initially fall through to its higher precedence
  // neighbour, and only attempt to match if one of the higher precedence operators
  // (or, ultimately, a literal, reference, or bracketed expression) already matched
  var infixOperators = '* / % + - << >> >>> < <= > >= in instanceof == != === !== & ^ | && ||'.split(
    ' '
  );

  // A typeof operator is higher precedence than multiplication
  fallthrough = readTypeof;
  for (i = 0, len = infixOperators.length; i < len; i += 1) {
    matcher = makeInfixSequenceMatcher(infixOperators[i], fallthrough);
    fallthrough = matcher;
  }

  // Logical OR is the fallthrough for the conditional matcher
  readLogicalOr = fallthrough;
})();

var readLogicalOr$1 = readLogicalOr;

// The conditional operator is the lowest precedence operator, so we start here
function getConditional(parser) {
  var expression = readLogicalOr$1(parser);
  if (!expression) {
    return null;
  }

  var start = parser.pos;

  parser.sp();

  if (!parser.matchString('?')) {
    parser.pos = start;
    return expression;
  }

  parser.sp();

  var ifTrue = readExpression(parser);
  if (!ifTrue) {
    parser.error(expectedExpression);
  }

  parser.sp();

  if (!parser.matchString(':')) {
    parser.error('Expected ":"');
  }

  parser.sp();

  var ifFalse = readExpression(parser);
  if (!ifFalse) {
    parser.error(expectedExpression);
  }

  return {
    t: CONDITIONAL,
    o: [expression, ifTrue, ifFalse]
  };
}

function readExpression(parser) {
  // if eval is false, no expressions
  if (parser.allowExpressions === false) {
    var ref = readReference(parser);
    parser.sp();
    return ref;
  }

  // The conditional operator is the lowest precedence operator (except yield,
  // assignment operators, and commas, none of which are supported), so we
  // start there. If it doesn't match, it 'falls through' to progressively
  // higher precedence operators, until it eventually matches (or fails to
  // match) a 'primary' - a literal or a reference. This way, the abstract syntax
  // tree has everything in its proper place, i.e. 2 + 3 * 4 === 14, not 20.
  return getConditional(parser);
}

function readExpressionList(parser, spread) {
  var isSpread;
  var expressions = [];

  var pos = parser.pos;

  do {
    parser.sp();

    if (spread) {
      isSpread = parser.matchPattern(spreadPattern);
    }

    var expr = readExpression(parser);

    if (expr === null && expressions.length) {
      parser.error(expectedExpression);
    } else if (expr === null) {
      parser.pos = pos;
      return null;
    }

    if (isSpread) {
      expr.p = true;
    }

    expressions.push(expr);

    parser.sp();
  } while (parser.matchString(','));

  return expressions;
}

function readExpressionOrReference(parser, expectedFollowers) {
  var start = parser.pos;
  var expression = readExpression(parser);

  if (!expression) {
    // valid reference but invalid expression e.g. `{{new}}`?
    var ref = parser.matchPattern(/^(\w+)/);
    if (ref) {
      return {
        t: REFERENCE,
        n: ref
      };
    }

    return null;
  }

  for (var i = 0; i < expectedFollowers.length; i += 1) {
    if (parser.remaining().substr(0, expectedFollowers[i].length) === expectedFollowers[i]) {
      return expression;
    }
  }

  parser.pos = start;
  return readReference(parser);
}

function flattenExpression(expression) {
  var refs;
  var count = 0;

  extractRefs(expression, (refs = []));
  var stringified = stringify(expression);

  return {
    r: refs,
    s: getVars(stringified)
  };

  function getVars(expr) {
    var vars = [];
    for (var i = count - 1; i >= 0; i--) {
      vars.push(("x$" + i));
    }
    return vars.length ? ("(function(){var " + (vars.join(',')) + ";return(" + expr + ");})()") : expr;
  }

  function stringify(node) {
    if (isString(node)) {
      return node;
    }

    switch (node.t) {
      case BOOLEAN_LITERAL:
      case GLOBAL:
      case NUMBER_LITERAL:
      case REGEXP_LITERAL:
        return node.v;

      case STRING_LITERAL:
        return JSON.stringify(String(node.v));

      case ARRAY_LITERAL:
        if (node.m && hasSpread(node.m)) {
          return ("[].concat(" + (makeSpread(node.m, '[', ']', stringify)) + ")");
        } else {
          return '[' + (node.m ? node.m.map(stringify).join(',') : '') + ']';
        }

      case OBJECT_LITERAL:
        if (node.m && hasSpread(node.m)) {
          return ("Object.assign({}," + (makeSpread(node.m, '{', '}', stringifyPair)) + ")");
        } else {
          return '{' + (node.m ? node.m.map(function (n) { return ((n.k) + ":" + (stringify(n.v))); }).join(',') : '') + '}';
        }

      case PREFIX_OPERATOR:
        return (node.s === 'typeof' ? 'typeof ' : node.s) + stringify(node.o);

      case INFIX_OPERATOR:
        return (
          stringify(node.o[0]) +
          (node.s.substr(0, 2) === 'in' ? ' ' + node.s + ' ' : node.s) +
          stringify(node.o[1])
        );

      case INVOCATION:
        if (node.o && hasSpread(node.o)) {
          var id = count++;
          return ("(x$" + id + "=" + (stringify(node.x)) + ").apply(x$" + id + "," + (stringify({
            t: ARRAY_LITERAL,
            m: node.o
          })) + ")");
        } else {
          return stringify(node.x) + '(' + (node.o ? node.o.map(stringify).join(',') : '') + ')';
        }

      case BRACKETED:
        return '(' + stringify(node.x) + ')';

      case MEMBER:
        return stringify(node.x) + stringify(node.r);

      case REFINEMENT:
        return node.n ? '.' + node.n : '[' + stringify(node.x) + ']';

      case CONDITIONAL:
        return stringify(node.o[0]) + '?' + stringify(node.o[1]) + ':' + stringify(node.o[2]);

      case REFERENCE:
        return '_' + refs.indexOf(node.n);

      default:
        throw new Error('Expected legal JavaScript');
    }
  }

  function stringifyPair(node) {
    return node.p ? stringify(node.k) : ((node.k) + ":" + (stringify(node.v)));
  }

  function makeSpread(list, open, close, fn) {
    var out = list.reduce(
      function (a, c) {
        if (c.p) {
          a.str += "" + (a.open ? close + ',' : a.str.length ? ',' : '') + (fn(c));
        } else {
          a.str += "" + (!a.str.length ? open : !a.open ? ',' + open : ',') + (fn(c));
        }
        a.open = !c.p;
        return a;
      },
      { open: false, str: '' }
    );
    if (out.open) { out.str += close; }
    return out.str;
  }
}

function hasSpread(list) {
  for (var i = 0; i < list.length; i++) {
    if (list[i].p) { return true; }
  }

  return false;
}

// TODO maybe refactor this?
function extractRefs(node, refs) {
  if (node.t === REFERENCE && isString(node.n)) {
    if (!~refs.indexOf(node.n)) {
      refs.unshift(node.n);
    }
  }

  var list = node.o || node.m;
  if (list) {
    if (isObject(list)) {
      extractRefs(list, refs);
    } else {
      var i = list.length;
      while (i--) {
        extractRefs(list[i], refs);
      }
    }
  }

  if (node.k && node.t === KEY_VALUE_PAIR && !isString(node.k)) {
    extractRefs(node.k, refs);
  }

  if (node.x) {
    extractRefs(node.x, refs);
  }

  if (node.r) {
    extractRefs(node.r, refs);
  }

  if (node.v) {
    extractRefs(node.v, refs);
  }
}

function refineExpression(expression, mustache) {
  var referenceExpression;

  if (expression) {
    while (expression.t === BRACKETED && expression.x) {
      expression = expression.x;
    }

    if (expression.t === REFERENCE) {
      var n = expression.n;
      if (!~n.indexOf('@context')) {
        mustache.r = expression.n;
      } else {
        mustache.x = flattenExpression(expression);
      }
    } else {
      if ((referenceExpression = getReferenceExpression(expression))) {
        mustache.rx = referenceExpression;
      } else {
        mustache.x = flattenExpression(expression);
      }
    }

    return mustache;
  }
}

// TODO refactor this! it's bewildering
function getReferenceExpression(expression) {
  var members = [];
  var refinement;

  while (expression.t === MEMBER && expression.r.t === REFINEMENT) {
    refinement = expression.r;

    if (refinement.x) {
      if (refinement.x.t === REFERENCE) {
        members.unshift(refinement.x);
      } else {
        members.unshift(flattenExpression(refinement.x));
      }
    } else {
      members.unshift(refinement.n);
    }

    expression = expression.x;
  }

  if (expression.t !== REFERENCE) {
    return null;
  }

  return {
    r: expression.n,
    m: members
  };
}

var attributeNamePattern = /^[^\s"'>\/=(]+/;
var onPattern = /^on/;
var eventPattern = /^on-([a-zA-Z\*\.$_]((?:[a-zA-Z\*\.$_0-9\-]|\\-)+))$/;
var reservedEventNames = /^(?:change|reset|teardown|update|construct|config|init|render|complete|unrender|detach|insert|destruct|attachchild|detachchild)$/;
var decoratorPattern = /^as-([a-z-A-Z][-a-zA-Z_0-9]*)$/;
var transitionPattern = /^([a-zA-Z](?:(?!-in-out)[-a-zA-Z_0-9])*)-(in|out|in-out)$/;
var boundPattern = /^((bind|class)-(([-a-zA-Z0-9_])+))$/;
var directives = {
  lazy: { t: BINDING_FLAG, v: 'l' },
  twoway: { t: BINDING_FLAG, v: 't' },
  'no-delegation': { t: DELEGATE_FLAG }
};
var unquotedAttributeValueTextPattern = /^[^\s"'=<>\/`]+/;
var proxyEvent = /^[^\s"'=<>@\[\]()]*/;
var whitespace = /^\s+/;

var slashes = /\\/g;
function splitEvent(str) {
  var result = [];
  var s = 0;

  for (var i = 0; i < str.length; i++) {
    if (str[i] === '-' && str[i - 1] !== '\\') {
      result.push(str.substring(s, i).replace(slashes, ''));
      s = i + 1;
    }
  }

  result.push(str.substring(s).replace(slashes, ''));

  return result;
}

function readAttribute(parser) {
  var name, i, nearest, idx;

  parser.sp();

  name = parser.matchPattern(attributeNamePattern);
  if (!name) {
    return null;
  }

  // check for accidental delimiter consumption e.g. <tag bool{{>attrs}} />
  nearest = name.length;
  for (i = 0; i < parser.tags.length; i++) {
    if (~(idx = name.indexOf(parser.tags[i].open))) {
      if (idx < nearest) { nearest = idx; }
    }
  }
  if (nearest < name.length) {
    parser.pos -= name.length - nearest;
    name = name.substr(0, nearest);
    if (!name) { return null; }
  }

  return { n: name };
}

function readAttributeValue(parser) {
  var start = parser.pos;

  // next character must be `=`, `/`, `>` or whitespace
  if (!/[=\/>\s]/.test(parser.nextChar())) {
    parser.error('Expected `=`, `/`, `>` or whitespace');
  }

  parser.sp();

  if (!parser.matchString('=')) {
    parser.pos = start;
    return null;
  }

  parser.sp();

  var valueStart = parser.pos;
  var startDepth = parser.sectionDepth;

  var value =
    readQuotedAttributeValue(parser, "'") ||
    readQuotedAttributeValue(parser, "\"") ||
    readUnquotedAttributeValue(parser);

  if (value === null) {
    parser.error('Expected valid attribute value');
  }

  if (parser.sectionDepth !== startDepth) {
    parser.pos = valueStart;
    parser.error(
      'An attribute value must contain as many opening section tags as closing section tags'
    );
  }

  if (!value.length) {
    return '';
  }

  if (value.length === 1 && isString(value[0])) {
    return decodeCharacterReferences(value[0]);
  }

  return value;
}

function readUnquotedAttributeValueToken(parser) {
  var text, index;

  var start = parser.pos;

  text = parser.matchPattern(unquotedAttributeValueTextPattern);

  if (!text) {
    return null;
  }

  var haystack = text;
  var needles = parser.tags.map(function (t) { return t.open; }); // TODO refactor... we do this in readText.js as well

  if ((index = getLowestIndex(haystack, needles)) !== -1) {
    text = text.substr(0, index);
    parser.pos = start + text.length;
  }

  return text;
}

function readUnquotedAttributeValue(parser) {
  parser.inAttribute = true;

  var tokens = [];

  var token = readMustache(parser) || readUnquotedAttributeValueToken(parser);
  while (token) {
    tokens.push(token);
    token = readMustache(parser) || readUnquotedAttributeValueToken(parser);
  }

  if (!tokens.length) {
    return null;
  }

  parser.inAttribute = false;
  return tokens;
}

function readQuotedAttributeValue(parser, quoteMark) {
  var start = parser.pos;

  if (!parser.matchString(quoteMark)) {
    return null;
  }

  parser.inAttribute = quoteMark;

  var tokens = [];

  var token = readMustache(parser) || readQuotedStringToken(parser, quoteMark);
  while (token !== null) {
    tokens.push(token);
    token = readMustache(parser) || readQuotedStringToken(parser, quoteMark);
  }

  if (!parser.matchString(quoteMark)) {
    parser.pos = start;
    return null;
  }

  parser.inAttribute = false;

  return tokens;
}

function readQuotedStringToken(parser, quoteMark) {
  var haystack = parser.remaining();

  var needles = parser.tags.map(function (t) { return t.open; }); // TODO refactor... we do this in readText.js as well
  needles.push(quoteMark);

  var index = getLowestIndex(haystack, needles);

  if (index === -1) {
    parser.error('Quoted attribute value must have a closing quote');
  }

  if (!index) {
    return null;
  }

  parser.pos += index;
  return haystack.substr(0, index);
}

function readAttributeOrDirective(parser) {
  var match, directive;

  var attribute = readAttribute(parser, false);

  if (!attribute) { return null; }

  // lazy, twoway
  if ((directive = directives[attribute.n])) {
    attribute.t = directive.t;
    if (directive.v) { attribute.v = directive.v; }
    delete attribute.n; // no name necessary
    parser.sp();
    if (parser.nextChar() === '=') { attribute.f = readAttributeValue(parser); }
  } else if ((match = decoratorPattern.exec(attribute.n))) {
    // decorators
    attribute.n = match[1];
    attribute.t = DECORATOR;
    readArguments(parser, attribute);
  } else if ((match = transitionPattern.exec(attribute.n))) {
    // transitions
    attribute.n = match[1];
    attribute.t = TRANSITION;
    readArguments(parser, attribute);
    attribute.v = match[2] === 'in-out' ? 't0' : match[2] === 'in' ? 't1' : 't2';
  } else if ((match = eventPattern.exec(attribute.n))) {
    // on-click etc
    attribute.n = splitEvent(match[1]);
    attribute.t = EVENT;

    if (parser.matchString('(')) {
      attribute.a = flattenExpression({
        t: ARRAY_LITERAL,
        m: readExpressionList(parser)
      });
      if (!parser.matchString(')')) { parser.error("Expected closing ')'"); }
    }

    parser.inEvent = true;

    // check for a proxy event
    if (!readProxyEvent(parser, attribute)) {
      // otherwise, it's an expression
      readArguments(parser, attribute, true);
    } else if (reservedEventNames.test(attribute.f)) {
      parser.pos -= attribute.f.length;
      parser.error(
        'Cannot use reserved event names (change, reset, teardown, update, construct, config, init, render, unrender, complete, detach, insert, destruct, attachchild, detachchild)'
      );
    }

    parser.inEvent = false;
  } else if ((match = boundPattern.exec(attribute.n))) {
    // bound directives
    var bind = match[2] === 'bind';
    attribute.n = bind ? match[3] : match[1];
    attribute.t = ATTRIBUTE;
    readArguments(parser, attribute, false, true);

    if (!attribute.f && bind) {
      attribute.f = [{ t: INTERPOLATOR, r: match[3] }];
    }
  } else {
    parser.sp();
    var value = parser.nextChar() === '=' ? readAttributeValue(parser) : null;
    attribute.f = value != null ? value : attribute.f;

    if (parser.sanitizeEventAttributes && onPattern.test(attribute.n)) {
      return { exclude: true };
    } else {
      attribute.f = attribute.f || (attribute.f === '' ? '' : 0);
      attribute.t = ATTRIBUTE;
    }
  }

  return attribute;
}

function readProxyEvent(parser, attribute) {
  var start = parser.pos;
  if (!parser.matchString('=')) { parser.error("Missing required directive arguments"); }

  var quote = parser.matchString("'") || parser.matchString("\"");
  parser.sp();
  var proxy = parser.matchPattern(proxyEvent);

  if (proxy !== undefined) {
    if (quote) {
      parser.sp();
      if (!parser.matchString(quote)) { parser.pos = start; }
      else { return (attribute.f = proxy) || true; }
    } else if (!parser.matchPattern(whitespace)) {
      parser.pos = start;
    } else {
      return (attribute.f = proxy) || true;
    }
  } else {
    parser.pos = start;
  }
}

function readArguments(parser, attribute, required, single) {
  if ( required === void 0 ) required = false;
  if ( single === void 0 ) single = false;

  parser.sp();
  if (!parser.matchString('=')) {
    if (required) { parser.error("Missing required directive arguments"); }
    return;
  }
  parser.sp();

  var quote = parser.matchString('"') || parser.matchString("'");
  var spread = parser.spreadArgs;
  parser.spreadArgs = true;
  parser.inUnquotedAttribute = !quote;
  var expr = single
    ? readExpressionOrReference(parser, [quote || ' ', '/', '>'])
    : { m: readExpressionList(parser), t: ARRAY_LITERAL };
  parser.inUnquotedAttribute = false;
  parser.spreadArgs = spread;

  if (quote) {
    parser.sp();
    if (parser.matchString(quote) !== quote) { parser.error(("Expected matching quote '" + quote + "'")); }
  }

  if (single) {
    var interpolator = { t: INTERPOLATOR };
    refineExpression(expr, interpolator);
    attribute.f = [interpolator];
  } else {
    attribute.f = flattenExpression(expr);
  }
}

var delimiterChangeToken = { t: DELIMCHANGE, exclude: true };

function readMustache(parser) {
  var mustache, i;

  // If we're inside a <script> or <style> tag, and we're not
  // interpolating, bug out
  if (parser.interpolate[parser.inside] === false) {
    return null;
  }

  for (i = 0; i < parser.tags.length; i += 1) {
    if ((mustache = readMustacheOfType(parser, parser.tags[i]))) {
      return mustache;
    }
  }

  if (parser.inTag && !parser.inAttribute) {
    mustache = readAttributeOrDirective(parser);
    if (mustache) {
      parser.sp();
      return mustache;
    }
  }
}

function readMustacheOfType(parser, tag) {
  var mustache, reader, i;

  var start = parser.pos;

  if (parser.matchString('\\' + tag.open)) {
    if (start === 0 || parser.str[start - 1] !== '\\') {
      return tag.open;
    }
  } else if (!parser.matchString(tag.open)) {
    return null;
  }

  // delimiter change?
  if ((mustache = readDelimiterChange(parser))) {
    // find closing delimiter or abort...
    if (!parser.matchString(tag.close)) {
      return null;
    }

    // ...then make the switch
    tag.open = mustache[0];
    tag.close = mustache[1];
    parser.sortMustacheTags();

    return delimiterChangeToken;
  }

  parser.sp();

  // illegal section closer
  if (parser.matchString('/')) {
    parser.pos -= 1;
    var rewind = parser.pos;
    if (!readNumberLiteral(parser)) {
      parser.pos = rewind - tag.close.length;
      if (parser.inAttribute) {
        parser.pos = start;
        return null;
      } else {
        parser.error("Attempted to close a section that wasn't open");
      }
    } else {
      parser.pos = rewind;
    }
  }

  for (i = 0; i < tag.readers.length; i += 1) {
    reader = tag.readers[i];

    if ((mustache = reader(parser, tag))) {
      if (tag.isStatic) {
        mustache.s = 1;
      }

      if (parser.includeLinePositions) {
        mustache.q = parser.getLinePos(start);
      }

      return mustache;
    }
  }

  parser.pos = start;
  return null;
}

function readTriple(parser, tag) {
  var expression = readExpression(parser);

  if (!expression) {
    return null;
  }

  if (!parser.matchString(tag.close)) {
    parser.error(("Expected closing delimiter '" + (tag.close) + "'"));
  }

  var triple = { t: TRIPLE };
  refineExpression(expression, triple); // TODO handle this differently - it's mysterious

  return triple;
}

function readUnescaped(parser, tag) {
  if (!parser.matchString('&')) {
    return null;
  }

  parser.sp();

  var expression = readExpression(parser);

  if (!expression) {
    return null;
  }

  if (!parser.matchString(tag.close)) {
    parser.error(("Expected closing delimiter '" + (tag.close) + "'"));
  }

  var triple = { t: TRIPLE };
  refineExpression(expression, triple); // TODO handle this differently - it's mysterious

  return triple;
}

var legalAlias = /^(?:[a-zA-Z$_0-9]|\\\.)+(?:(?:(?:[a-zA-Z$_0-9]|\\\.)+)|(?:\[[0-9]+\]))*/;
var asRE = /^as/i;

function readAliases(parser) {
  var aliases = [];
  var alias;
  var start = parser.pos;

  parser.sp();

  alias = readAlias(parser);

  if (alias) {
    alias.x = refineExpression(alias.x, {});
    aliases.push(alias);

    parser.sp();

    while (parser.matchString(',')) {
      alias = readAlias(parser);

      if (!alias) {
        parser.error('Expected another alias.');
      }

      alias.x = refineExpression(alias.x, {});
      aliases.push(alias);

      parser.sp();
    }

    return aliases;
  }

  parser.pos = start;
  return null;
}

function readAlias(parser) {
  var start = parser.pos;

  parser.sp();

  var expr = readExpression(parser, []);

  if (!expr) {
    parser.pos = start;
    return null;
  }

  parser.sp();
  parser.matchPattern(asRE);
  parser.sp();

  var alias = parser.matchPattern(legalAlias);

  if (!alias) {
    parser.pos = start;
    return null;
  }

  return { n: alias, x: expr };
}

function readPartial(parser, tag) {
  var type = parser.matchString('>') || parser.matchString('yield');
  var partial = { t: type === '>' ? PARTIAL : YIELDER };
  var aliases;

  if (!type) { return null; }

  parser.sp();

  if (type === '>' || !(aliases = parser.matchString('with'))) {
    // Partial names can include hyphens, so we can't use readExpression
    // blindly. Instead, we use the `relaxedNames` flag to indicate that
    // `foo-bar` should be read as a single name, rather than 'subtract
    // bar from foo'
    parser.relaxedNames = parser.strictRefinement = true;
    var expression = readExpression(parser);
    parser.relaxedNames = parser.strictRefinement = false;

    if (!expression && type === '>') { return null; }

    if (expression) {
      refineExpression(expression, partial); // TODO...
      parser.sp();
      if (type !== '>') { aliases = parser.matchString('with'); }
    }
  }

  parser.sp();

  // check for alias context e.g. `{{>foo bar as bat, bip as bop}}`
  if (aliases || type === '>') {
    aliases = readAliases(parser);
    if (aliases && aliases.length) {
      partial.z = aliases;
    } else {
      // otherwise check for literal context e.g. `{{>foo bar}}` then
      // turn it into `{{#with bar}}{{>foo}}{{/with}}`
      var context = readExpression(parser);
      if (context) {
        partial.c = {};
        refineExpression(context, partial.c);
      }

      // allow aliases after context
      if (parser.matchString(',')) {
        aliases = readAliases(parser);
        if (aliases && aliases.length) {
          partial.z = aliases;
        }
      }
    }

    if (type !== '>' && (!partial.c && !partial.z)) {
      // {{yield with}} requires some aliases
      parser.error("Expected a context or one or more aliases");
    }
  }

  parser.sp();

  if (!parser.matchString(tag.close)) {
    parser.error(("Expected closing delimiter '" + (tag.close) + "'"));
  }

  return partial;
}

function readComment(parser, tag) {
  if (!parser.matchString('!')) {
    return null;
  }

  var index = parser.remaining().indexOf(tag.close);

  if (index !== -1) {
    parser.pos += index + tag.close.length;
    return { t: COMMENT };
  }
}

function readInterpolator(parser, tag) {
  var expression, err;

  var start = parser.pos;

  // TODO would be good for perf if we could do away with the try-catch
  try {
    expression = readExpressionOrReference(parser, [tag.close]);
  } catch (e) {
    err = e;
  }

  if (!expression) {
    if (parser.str.charAt(start) === '!') {
      // special case - comment
      parser.pos = start;
      return null;
    }

    if (err) {
      throw err;
    }
  }

  if (!parser.matchString(tag.close)) {
    parser.error(("Expected closing delimiter '" + (tag.close) + "' after reference"));

    if (!expression) {
      // special case - comment
      if (parser.nextChar() === '!') {
        return null;
      }

      parser.error("Expected expression or legal reference");
    }
  }

  var interpolator = { t: INTERPOLATOR };
  refineExpression(expression, interpolator); // TODO handle this differently - it's mysterious

  return interpolator;
}

function readClosing(parser, tag) {
  var start = parser.pos;

  if (!parser.matchString(tag.open)) {
    return null;
  }

  parser.sp();

  if (!parser.matchString('/')) {
    parser.pos = start;
    return null;
  }

  parser.sp();

  var remaining = parser.remaining();
  var index = remaining.indexOf(tag.close);

  if (index !== -1) {
    var closing = {
      t: CLOSING,
      r: remaining.substr(0, index).split(' ')[0]
    };

    parser.pos += index;

    if (!parser.matchString(tag.close)) {
      parser.error(("Expected closing delimiter '" + (tag.close) + "'"));
    }

    return closing;
  }

  parser.pos = start;
  return null;
}

var patterns = {
  else: /^\s*else\s*/,
  elseif: /^\s*elseif\s+/,
  then: /^\s*then\s*/,
  catch: /^\s*catch\s*/
};

var types = {
  else: ELSE,
  elseif: ELSEIF,
  then: THEN,
  catch: CATCH
};

function readInlineBlock(parser, tag, type) {
  var start = parser.pos;

  if (!parser.matchString(tag.open)) {
    return null;
  }

  if (!parser.matchPattern(patterns[type])) {
    parser.pos = start;
    return null;
  }

  var res = { t: types[type] };

  if (type === 'elseif') {
    res.x = readExpression(parser);
  } else if (type === 'catch' || type === 'then') {
    var nm = parser.matchPattern(name);
    if (nm) { res.n = nm; }
  }

  if (!parser.matchString(tag.close)) {
    parser.error(("Expected closing delimiter '" + (tag.close) + "'"));
  }

  return res;
}

var handlebarsBlockCodes = {
  each: SECTION_EACH,
  if: SECTION_IF,
  with: SECTION_IF_WITH,
  unless: SECTION_UNLESS
};

var indexRefPattern = /^\s*:\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;
var keyIndexRefPattern = /^\s*,\s*([a-zA-Z_$][a-zA-Z_$0-9]*)/;
var handlebarsBlockPattern = new RegExp('^(' + keys(handlebarsBlockCodes).join('|') + ')\\b');

function readSection(parser, tag) {
  var expression,
    section,
    child,
    children,
    hasElse,
    block,
    unlessBlock,
    closed,
    i,
    expectedClose,
    hasThen,
    hasCatch,
    inlineThen;
  var aliasOnly = false;

  var start = parser.pos;

  if (parser.matchString('^')) {
    // watch out for parent context refs - {{^^/^^/foo}}
    if (parser.matchString('^/')) {
      parser.pos = start;
      return null;
    }
    section = { t: SECTION, f: [], n: SECTION_UNLESS };
  } else if (parser.matchString('#')) {
    section = { t: SECTION, f: [] };

    if (parser.matchString('partial')) {
      parser.pos = start - parser.standardDelimiters[0].length;
      parser.error(
        'Partial definitions can only be at the top level of the template, or immediately inside components'
      );
    }

    if ((block = parser.matchString('await'))) {
      expectedClose = block;
      section.t = AWAIT;
    } else if ((block = parser.matchPattern(handlebarsBlockPattern))) {
      expectedClose = block;
      section.n = handlebarsBlockCodes[block];
    }
  } else {
    return null;
  }

  parser.sp();

  if (block === 'with') {
    var aliases = readAliases(parser);
    if (aliases) {
      aliasOnly = true;
      section.z = aliases;
      section.t = ALIAS;
    }
  } else if (block === 'each') {
    var alias = readAlias(parser);
    if (alias) {
      section.z = [{ n: alias.n, x: { r: '.' } }];
      expression = alias.x;
    }
  }

  if (!aliasOnly) {
    if (!expression) { expression = readExpression(parser); }

    if (!expression) {
      parser.error('Expected expression');
    }

    // extra each aliases
    if (block === 'each' && parser.matchString(',')) {
      var aliases$1 = readAliases(parser);
      if (aliases$1) {
        if (section.z) { aliases$1.unshift(section.z[0]); }
        section.z = aliases$1;
      }
    }

    // optional index and key references
    if ((block === 'each' || !block) && (i = parser.matchPattern(indexRefPattern))) {
      var extra;

      if ((extra = parser.matchPattern(keyIndexRefPattern))) {
        section.i = i + ',' + extra;
      } else {
        section.i = i;
      }
    } else if (block === 'await' && parser.matchString('then')) {
      parser.sp();
      hasThen = true;
      inlineThen = parser.matchPattern(name);
      if (!inlineThen) { inlineThen = true; }
    }

    if (!block && expression.n) {
      expectedClose = expression.n;
    }
  }

  parser.sp();

  if (!parser.matchString(tag.close)) {
    parser.error(("Expected closing delimiter '" + (tag.close) + "'"));
  }

  parser.sectionDepth += 1;
  children = section.f;

  var pos;
  do {
    pos = parser.pos;
    if ((child = readClosing(parser, tag))) {
      if (expectedClose && child.r !== expectedClose) {
        if (!block) {
          if (child.r)
            { parser.warn(
              ("Expected " + (tag.open) + "/" + expectedClose + (tag.close) + " but found " + (tag.open) + "/" + (child.r) + (tag.close))
            ); }
        } else {
          parser.pos = pos;
          parser.error(("Expected " + (tag.open) + "/" + expectedClose + (tag.close)));
        }
      }

      parser.sectionDepth -= 1;
      closed = true;
    } else if (
      !aliasOnly &&
      ((child = readInlineBlock(parser, tag, 'elseif')) ||
        (child = readInlineBlock(parser, tag, 'else')) ||
        (block === 'await' &&
          ((child = readInlineBlock(parser, tag, 'then')) ||
            (child = readInlineBlock(parser, tag, 'catch')))))
    ) {
      if (section.n === SECTION_UNLESS) {
        parser.error('{{else}} not allowed in {{#unless}}');
      }

      if (hasElse) {
        if (child.t === ELSE) {
          parser.error('there can only be one {{else}} block, at the end of a section');
        } else if (child.t === ELSEIF) {
          parser.error('illegal {{elseif...}} after {{else}}');
        }
      }

      if (!unlessBlock && (inlineThen || !hasThen) && !hasCatch) {
        if (block === 'await') {
          var s = { f: children };
          section.f = [s];
          if (inlineThen) {
            s.t = THEN;
            inlineThen !== true && (s.n = inlineThen);
          } else {
            s.t = SECTION;
          }
        } else {
          unlessBlock = [];
        }
      }

      var mustache = {
        t: SECTION,
        f: (children = [])
      };

      if (child.t === ELSE) {
        if (block === 'await') {
          section.f.push(mustache);
          mustache.t = ELSE;
        } else {
          mustache.n = SECTION_UNLESS;
          unlessBlock.push(mustache);
        }
        hasElse = true;
      } else if (child.t === ELSEIF) {
        mustache.n = SECTION_IF;
        refineExpression(child.x, mustache);
        unlessBlock.push(mustache);
      } else if (child.t === THEN) {
        if (hasElse) { parser.error('{{then}} block must appear before any {{else}} block'); }
        if (hasCatch) { parser.error('{{then}} block must appear before any {{catch}} block'); }
        if (hasThen) { parser.error('there can only be one {{then}} block per {{#await}}'); }
        mustache.t = THEN;
        hasThen = true;
        child.n && (mustache.n = child.n);
        section.f.push(mustache);
      } else if (child.t === CATCH) {
        if (hasElse) { parser.error('{{catch}} block must appear before any {{else}} block'); }
        if (hasCatch) { parser.error('there can only be one {{catch}} block per {{#await}}'); }
        mustache.t = CATCH;
        hasCatch = true;
        mustache.n = child.n;
        section.f.push(mustache);
      }
    } else {
      child = parser.read(READERS);

      if (!child) {
        break;
      }

      children.push(child);
    }
  } while (!closed);

  if (unlessBlock) {
    section.l = unlessBlock;
  }

  if (!aliasOnly) {
    refineExpression(expression, section);
  }

  if (block === 'await' && (inlineThen || !hasThen) && !hasCatch && !hasElse) {
    var s$1 = { f: section.f };
    section.f = [s$1];
    if (inlineThen) {
      s$1.t = THEN;
      inlineThen !== true && (s$1.n = inlineThen);
    } else {
      s$1.t = SECTION;
    }
  }

  // TODO if a section is empty it should be discarded. Don't do
  // that here though - we need to clean everything up first, as
  // it may contain removeable whitespace. As a temporary measure,
  // to pass the existing tests, remove empty `f` arrays
  if (!section.f.length) {
    delete section.f;
  }

  return section;
}

var OPEN_COMMENT = '<!--';
var CLOSE_COMMENT = '-->';

function readHtmlComment(parser) {
  var start = parser.pos;

  if (parser.textOnlyMode || !parser.matchString(OPEN_COMMENT)) {
    return null;
  }

  var remaining = parser.remaining();
  var endIndex = remaining.indexOf(CLOSE_COMMENT);

  if (endIndex === -1) {
    parser.error("Illegal HTML - expected closing comment sequence ('-->')");
  }

  var content = remaining.substr(0, endIndex);
  parser.pos += endIndex + 3;

  var comment = {
    t: COMMENT,
    c: content
  };

  if (parser.includeLinePositions) {
    comment.q = parser.getLinePos(start);
  }

  return comment;
}

var leadingLinebreak = /^[ \t\f\r\n]*\r?\n/;
var trailingLinebreak = /\r?\n[ \t\f\r\n]*$/;

function stripStandalones(items) {
  var i, current, backOne, backTwo, lastSectionItem;

  for (i = 1; i < items.length; i += 1) {
    current = items[i];
    backOne = items[i - 1];
    backTwo = items[i - 2];

    // if we're at the end of a [text][comment][text] sequence...
    if (isString(current) && isComment(backOne) && isString(backTwo)) {
      // ... and the comment is a standalone (i.e. line breaks either side)...
      if (trailingLinebreak.test(backTwo) && leadingLinebreak.test(current)) {
        // ... then we want to remove the whitespace after the first line break
        items[i - 2] = backTwo.replace(trailingLinebreak, '\n');

        // and the leading line break of the second text token
        items[i] = current.replace(leadingLinebreak, '');
      }
    }

    // if the current item is a section, and it is preceded by a linebreak, and
    // its first item is a linebreak...
    if (isSection(current) && isString(backOne)) {
      if (
        trailingLinebreak.test(backOne) &&
        isString(current.f[0]) &&
        leadingLinebreak.test(current.f[0])
      ) {
        items[i - 1] = backOne.replace(trailingLinebreak, '\n');
        current.f[0] = current.f[0].replace(leadingLinebreak, '');
      }
    }

    // if the last item was a section, and it is followed by a linebreak, and
    // its last item is a linebreak...
    if (isString(current) && isSection(backOne)) {
      lastSectionItem = lastItem(backOne.f);

      if (
        isString(lastSectionItem) &&
        trailingLinebreak.test(lastSectionItem) &&
        leadingLinebreak.test(current)
      ) {
        backOne.f[backOne.f.length - 1] = lastSectionItem.replace(trailingLinebreak, '\n');
        items[i] = current.replace(leadingLinebreak, '');
      }
    }
  }

  return items;
}

function isComment(item) {
  return item.t === COMMENT || item.t === DELIMCHANGE;
}

function isSection(item) {
  return (item.t === SECTION || item.t === INVERTED) && item.f;
}

function trimWhitespace(items, leadingPattern, trailingPattern) {
  var item;

  if (leadingPattern) {
    item = items[0];
    if (isString(item)) {
      item = item.replace(leadingPattern, '');

      if (!item) {
        items.shift();
      } else {
        items[0] = item;
      }
    }
  }

  if (trailingPattern) {
    item = lastItem(items);
    if (isString(item)) {
      item = item.replace(trailingPattern, '');

      if (!item) {
        items.pop();
      } else {
        items[items.length - 1] = item;
      }
    }
  }
}

var contiguousWhitespace = /[ \t\f\r\n]+/g;
var leadingWhitespace$1 = /^[ \t\f\r\n]+/;
var trailingWhitespace = /[ \t\f\r\n]+$/;
var leadingNewLine = /^(?:\r\n|\r|\n)/;
var trailingNewLine = /(?:\r\n|\r|\n)$/;

function cleanup(
  items,
  stripComments,
  preserveWhitespace,
  removeLeadingWhitespace,
  removeTrailingWhitespace,
  whiteSpaceElements
) {
  if (isString(items)) { return; }

  var i,
    item,
    previousItem,
    nextItem,
    preserveWhitespaceInsideFragment,
    removeLeadingWhitespaceInsideFragment,
    removeTrailingWhitespaceInsideFragment;

  // First pass - remove standalones and comments etc
  stripStandalones(items);

  i = items.length;
  while (i--) {
    item = items[i];

    // Remove delimiter changes, unsafe elements etc
    if (item.exclude) {
      items.splice(i, 1);
    } else if (stripComments && item.t === COMMENT) {
      // Remove comments, unless we want to keep them
      items.splice(i, 1);
    }
  }

  // If necessary, remove leading and trailing whitespace
  trimWhitespace(
    items,
    removeLeadingWhitespace ? leadingWhitespace$1 : null,
    removeTrailingWhitespace ? trailingWhitespace : null
  );

  i = items.length;
  while (i--) {
    item = items[i];
    removeLeadingWhitespaceInsideFragment = removeTrailingWhitespaceInsideFragment = false;

    // Recurse
    if (item.f) {
      var isPreserveWhitespaceElement =
        item.t === ELEMENT &&
        (whiteSpaceElements[item.e.toLowerCase()] || whiteSpaceElements[item.e]);
      preserveWhitespaceInsideFragment = preserveWhitespace || isPreserveWhitespaceElement;

      if (!preserveWhitespace && isPreserveWhitespaceElement) {
        trimWhitespace(item.f, leadingNewLine, trailingNewLine);
      }

      if (!preserveWhitespaceInsideFragment) {
        previousItem = items[i - 1];
        nextItem = items[i + 1];

        // if the previous item was a text item with trailing whitespace,
        // remove leading whitespace inside the fragment
        if (!previousItem || (isString(previousItem) && trailingWhitespace.test(previousItem))) {
          removeLeadingWhitespaceInsideFragment = true;
        }

        // and vice versa
        if (!nextItem || (isString(nextItem) && leadingWhitespace$1.test(nextItem))) {
          removeTrailingWhitespaceInsideFragment = true;
        }
      }

      cleanup(
        item.f,
        stripComments,
        preserveWhitespaceInsideFragment,
        removeLeadingWhitespaceInsideFragment,
        removeTrailingWhitespaceInsideFragment,
        whiteSpaceElements
      );
    }

    // Split if-else blocks into two (an if, and an unless)
    if (item.l) {
      cleanup(
        item.l,
        stripComments,
        preserveWhitespace,
        removeLeadingWhitespaceInsideFragment,
        removeTrailingWhitespaceInsideFragment,
        whiteSpaceElements
      );

      item.l.forEach(function (s) { return (s.l = 1); });
      item.l.unshift(i + 1, 0);
      items.splice.apply(items, item.l);
      delete item.l; // TODO would be nice if there was a way around this
    }

    // Clean up conditional attributes
    if (item.m) {
      cleanup(
        item.m,
        stripComments,
        preserveWhitespace,
        removeLeadingWhitespaceInsideFragment,
        removeTrailingWhitespaceInsideFragment,
        whiteSpaceElements
      );
      if (item.m.length < 1) { delete item.m; }
    }
  }

  // final pass - fuse text nodes together
  i = items.length;
  while (i--) {
    if (isString(items[i])) {
      if (isString(items[i + 1])) {
        items[i] = items[i] + items[i + 1];
        items.splice(i + 1, 1);
      }

      if (!preserveWhitespace) {
        items[i] = items[i].replace(contiguousWhitespace, ' ');
      }

      if (items[i] === '') {
        items.splice(i, 1);
      }
    }
  }
}

var closingTagPattern = /^([a-zA-Z]{1,}:?[a-zA-Z0-9\-]*)\s*\>/;

function readClosingTag(parser) {
  var tag;

  var start = parser.pos;

  // are we looking at a closing tag?
  if (!parser.matchString('</')) {
    return null;
  }

  if ((tag = parser.matchPattern(closingTagPattern))) {
    if (parser.inside && tag !== parser.inside) {
      parser.pos = start;
      return null;
    }

    return {
      t: CLOSING_TAG,
      e: tag
    };
  }

  // We have an illegal closing tag, report it
  parser.pos -= 2;
  parser.error('Illegal closing tag');
}

function hyphenateCamel(camelCaseStr) {
  return camelCaseStr.replace(/([A-Z])/g, function (match, $1) {
    return '-' + $1.toLowerCase();
  });
}

var tagNamePattern = /^[a-zA-Z]{1,}:?[a-zA-Z0-9\-]*/;
var anchorPattern = /^[a-zA-Z_$][-a-zA-Z0-9_$]*/;
var validTagNameFollower = /^[\s\n\/>]/;
var semiEnd = /;\s*$/;
var exclude = { exclude: true };

// based on http://developers.whatwg.org/syntax.html#syntax-tag-omission
var disallowedContents = {
  li: ['li'],
  dt: ['dt', 'dd'],
  dd: ['dt', 'dd'],
  p: 'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(
    ' '
  ),
  rt: ['rt', 'rp'],
  rp: ['rt', 'rp'],
  optgroup: ['optgroup'],
  option: ['option', 'optgroup'],
  thead: ['tbody', 'tfoot'],
  tbody: ['tbody', 'tfoot'],
  tfoot: ['tbody'],
  tr: ['tr', 'tbody'],
  td: ['td', 'th', 'tr'],
  th: ['td', 'th', 'tr']
};

function readElement$1(parser) {
  var attribute,
    selfClosing,
    children,
    partials,
    hasPartials,
    child,
    closed,
    pos,
    remaining,
    closingTag,
    anchor;

  var start = parser.pos;

  if (parser.inside || parser.inAttribute || parser.textOnlyMode) {
    return null;
  }

  if (!parser.matchString('<')) {
    return null;
  }

  // if this is a closing tag, abort straight away
  if (parser.nextChar() === '/') {
    return null;
  }

  var element = {};
  if (parser.includeLinePositions) {
    element.q = parser.getLinePos(start);
  }

  // check for doctype decl
  if (parser.matchString('!')) {
    element.t = DOCTYPE;
    if (!parser.matchPattern(/^doctype/i)) {
      parser.error('Expected DOCTYPE declaration');
    }

    element.a = parser.matchPattern(/^(.+?)>/);
    return element;
  } else if ((anchor = parser.matchString('#'))) {
    // check for anchor
    parser.sp();
    element.t = ANCHOR;
    element.n = parser.matchPattern(anchorPattern);
  } else {
    // otherwise, it's an element/component
    element.t = ELEMENT;

    // element name
    element.e = parser.matchPattern(tagNamePattern);
    if (!element.e) {
      return null;
    }
  }

  // next character must be whitespace, closing solidus or '>'
  if (!validTagNameFollower.test(parser.nextChar())) {
    parser.error('Illegal tag name');
  }

  parser.sp();

  parser.inTag = true;

  // directives and attributes
  while ((attribute = readMustache(parser))) {
    if (attribute !== false) {
      if (!element.m) { element.m = []; }
      element.m.push(attribute);
    }

    parser.sp();
  }

  parser.inTag = false;

  // allow whitespace before closing solidus
  parser.sp();

  // self-closing solidus?
  if (parser.matchString('/')) {
    selfClosing = true;
  }

  // closing angle bracket
  if (!parser.matchString('>')) {
    return null;
  }

  var lowerCaseName = (element.e || element.n).toLowerCase();
  var preserveWhitespace = parser.preserveWhitespace;

  if (!selfClosing && (anchor || !voidElements[element.e.toLowerCase()])) {
    if (!anchor) {
      parser.elementStack.push(lowerCaseName);

      // Special case - if we open a script element, further tags should
      // be ignored unless they're a closing script element
      if (lowerCaseName in parser.interpolate) {
        parser.inside = lowerCaseName;
      }
    }

    children = [];
    partials = create(null);

    do {
      pos = parser.pos;
      remaining = parser.remaining();

      if (!remaining) {
        // if this happens to be a script tag and there's no content left, it's because
        // a closing script tag can't appear in a script
        if (parser.inside === 'script') {
          closed = true;
          break;
        }

        parser.error(
          ("Missing end " + (parser.elementStack.length > 1 ? 'tags' : 'tag') + " (" + (parser.elementStack
            .reverse()
            .map(function (x) { return ("</" + x + ">"); })
            .join('')) + ")")
        );
      }

      // if for example we're in an <li> element, and we see another
      // <li> tag, close the first so they become siblings
      if (!anchor && !canContain(lowerCaseName, remaining)) {
        closed = true;
      } else if (!anchor && (closingTag = readClosingTag(parser))) {
        // closing tag
        closed = true;

        var closingTagName = closingTag.e.toLowerCase();

        // if this *isn't* the closing tag for the current element...
        if (closingTagName !== lowerCaseName) {
          // rewind parser
          parser.pos = pos;

          // if it doesn't close a parent tag, error
          if (!~parser.elementStack.indexOf(closingTagName)) {
            var errorMessage = 'Unexpected closing tag';

            // add additional help for void elements, since component names
            // might clash with them
            if (voidElements[closingTagName.toLowerCase()]) {
              errorMessage += " (<" + closingTagName + "> is a void element - it cannot contain children)";
            }

            parser.error(errorMessage);
          }
        }
      } else if (anchor && readAnchorClose(parser, element.n)) {
        closed = true;
      } else {
        // implicit close by closing section tag. TODO clean this up
        var tag = {
          open: parser.standardDelimiters[0],
          close: parser.standardDelimiters[1]
        };
        if (readClosing(parser, tag) || readInline(parser, tag)) {
          closed = true;
          parser.pos = pos;
        } else if ((child = parser.read(PARTIAL_READERS))) {
          if (partials[child.n]) {
            parser.pos = pos;
            parser.error('Duplicate partial definition');
          }

          cleanup(
            child.f,
            parser.stripComments,
            preserveWhitespace,
            !preserveWhitespace,
            !preserveWhitespace,
            parser.whiteSpaceElements
          );

          partials[child.n] = child.f;
          hasPartials = true;
        } else {
          if ((child = parser.read(READERS))) {
            children.push(child);
          } else {
            closed = true;
          }
        }
      }
    } while (!closed);

    if (children.length) {
      element.f = children;
    }

    if (hasPartials) {
      element.p = partials;
    }

    parser.elementStack.pop();
  }

  parser.inside = null;

  if (parser.sanitizeElements && parser.sanitizeElements.indexOf(lowerCaseName) !== -1) {
    return exclude;
  }

  if (
    element.m &&
    lowerCaseName !== 'input' &&
    lowerCaseName !== 'select' &&
    lowerCaseName !== 'textarea' &&
    lowerCaseName !== 'option'
  ) {
    var attrs = element.m;
    var classes, styles, cls, style;
    var i = 0;
    var a;
    while (i < attrs.length) {
      a = attrs[i];

      if (a.t !== ATTRIBUTE) {
        i++;
        continue;
      }

      if (a.n.indexOf('class-') === 0 && !a.f) {
        // static class directives
        (classes || (classes = [])).push(a.n.slice(6));
        attrs.splice(i, 1);
      } else if (a.n.indexOf('style-') === 0 && isString(a.f)) {
        // static style directives
        (styles || (styles = [])).push(((hyphenateCamel(a.n.slice(6))) + ": " + (a.f) + ";"));
        attrs.splice(i, 1);
      } else if (a.n === 'class' && isString(a.f)) {
        // static class attrs
        (classes || (classes = [])).push(a.f);
        attrs.splice(i, 1);
      } else if (a.n === 'style' && isString(a.f)) {
        // static style attrs
        (styles || (styles = [])).push(a.f + (semiEnd.test(a.f) ? '' : ';'));
        attrs.splice(i, 1);
      } else if (a.n === 'class') {
        cls = a;
        i++;
      } else if (a.n === 'style') {
        style = a;
        i++;
      } else if (
        !~a.n.indexOf(':') &&
        a.n !== 'value' &&
        a.n !== 'contenteditable' &&
        isString(a.f)
      ) {
        a.g = 1;
        i++;
      } else {
        i++;
      }
    }

    if (classes) {
      if (!cls || !isString(cls.f))
        { attrs.unshift({ t: ATTRIBUTE, n: 'class', f: classes.join(' '), g: 1 }); }
      else { cls.f += ' ' + classes.join(' '); }
    } else if (cls && isString(cls.f)) { cls.g = 1; }

    if (styles) {
      if (!style || !isString(style.f))
        { attrs.unshift({ t: ATTRIBUTE, n: 'style', f: styles.join(' '), g: 1 }); }
      else { style.f += '; ' + styles.join(' '); }
    } else if (style && isString(style.f)) { style.g = 1; }
  }

  return element;
}

function canContain(name, remaining) {
  var match = /^<([a-zA-Z][a-zA-Z0-9]*)/.exec(remaining);
  var disallowed = disallowedContents[name];

  if (!match || !disallowed) {
    return true;
  }

  return !~disallowed.indexOf(match[1].toLowerCase());
}

function readAnchorClose(parser, name) {
  var pos = parser.pos;
  if (!parser.matchString('</')) {
    return null;
  }

  parser.matchString('#');
  parser.sp();

  if (!parser.matchString(name)) {
    parser.pos = pos;
    return null;
  }

  parser.sp();

  if (!parser.matchString('>')) {
    parser.pos = pos;
    return null;
  }

  return true;
}

var inlines = /^\s*(elseif|else|then|catch)\s*/;
function readInline(parser, tag) {
  var pos = parser.pos;
  if (!parser.matchString(tag.open)) { return; }
  if (parser.matchPattern(inlines)) {
    return true;
  } else {
    parser.pos = pos;
  }
}

function readText(parser) {
  var index, disallowed, barrier;

  var remaining = parser.remaining();

  if (parser.textOnlyMode) {
    disallowed = parser.tags.map(function (t) { return t.open; });
    disallowed = disallowed.concat(parser.tags.map(function (t) { return '\\' + t.open; }));

    index = getLowestIndex(remaining, disallowed);
  } else {
    barrier = parser.inside ? '</' + parser.inside : '<';

    if (parser.inside && !parser.interpolate[parser.inside]) {
      index = remaining.indexOf(barrier);
    } else {
      disallowed = parser.tags.map(function (t) { return t.open; });
      disallowed = disallowed.concat(parser.tags.map(function (t) { return '\\' + t.open; }));

      // http://developers.whatwg.org/syntax.html#syntax-attributes
      if (parser.inAttribute === true) {
        // we're inside an unquoted attribute value
        disallowed.push("\"", "'", "=", "<", ">", '`');
      } else if (parser.inAttribute) {
        // quoted attribute value
        disallowed.push(parser.inAttribute);
      } else {
        disallowed.push(barrier);
      }

      index = getLowestIndex(remaining, disallowed);
    }
  }

  if (!index) {
    return null;
  }

  if (index === -1) {
    index = remaining.length;
  }

  parser.pos += index;

  if ((parser.inside && parser.inside !== 'textarea') || parser.textOnlyMode) {
    return remaining.substr(0, index);
  } else {
    return decodeCharacterReferences(remaining.substr(0, index));
  }
}

var partialDefinitionSectionPattern = /^\s*#\s*partial\s+/;

function readPartialDefinitionSection(parser) {
  var child, closed;

  var start = parser.pos;

  var delimiters = parser.standardDelimiters;

  if (!parser.matchString(delimiters[0])) {
    return null;
  }

  if (!parser.matchPattern(partialDefinitionSectionPattern)) {
    parser.pos = start;
    return null;
  }

  var name = parser.matchPattern(/^[a-zA-Z_$][a-zA-Z_$0-9\-\/]*/);

  if (!name) {
    parser.error('expected legal partial name');
  }

  parser.sp();
  if (!parser.matchString(delimiters[1])) {
    parser.error(("Expected closing delimiter '" + (delimiters[1]) + "'"));
  }

  var content = [];

  var open = delimiters[0];
  var close = delimiters[1];

  do {
    if ((child = readClosing(parser, { open: open, close: close }))) {
      if (child.r !== 'partial') {
        parser.error(("Expected " + open + "/partial" + close));
      }

      closed = true;
    } else {
      child = parser.read(READERS);

      if (!child) {
        parser.error(("Expected " + open + "/partial" + close));
      }

      content.push(child);
    }
  } while (!closed);

  return {
    t: INLINE_PARTIAL,
    n: name,
    f: content
  };
}

function readTemplate(parser) {
  var fragment = [];
  var partials = create(null);
  var hasPartials = false;

  var preserveWhitespace = parser.preserveWhitespace;

  while (parser.pos < parser.str.length) {
    var pos = parser.pos;
    var item = (void 0), partial = (void 0);

    if ((partial = parser.read(PARTIAL_READERS))) {
      if (partials[partial.n]) {
        parser.pos = pos;
        parser.error('Duplicated partial definition');
      }

      cleanup(
        partial.f,
        parser.stripComments,
        preserveWhitespace,
        !preserveWhitespace,
        !preserveWhitespace,
        parser.whiteSpaceElements
      );

      partials[partial.n] = partial.f;
      hasPartials = true;
    } else if ((item = parser.read(READERS))) {
      fragment.push(item);
    } else {
      parser.error('Unexpected template content');
    }
  }

  var result = {
    v: TEMPLATE_VERSION,
    t: fragment
  };

  if (hasPartials) {
    result.p = partials;
  }

  return result;
}

function insertExpressions(obj, expr) {
  keys(obj).forEach(function (key) {
    if (isExpression(key, obj)) { return addTo(obj, expr); }

    var ref = obj[key];
    if (hasChildren(ref)) { insertExpressions(ref, expr); }
  });
}

function isExpression(key, obj) {
  return key === 's' && isArray(obj.r);
}

function addTo(obj, expr) {
  var s = obj.s;
  var r = obj.r;
  if (!expr[s]) { expr[s] = fromExpression(s, r.length); }
}

function hasChildren(ref) {
  return isArray(ref) || isObject(ref);
}

var shared = {};

// See https://github.com/ractivejs/template-spec for information
// about the Ractive template specification

var STANDARD_READERS = [
  readPartial,
  readUnescaped,
  readSection,
  readInterpolator,
  readComment
];
var TRIPLE_READERS = [readTriple];

var READERS = [readMustache, readHtmlComment, readElement$1, readText];
var PARTIAL_READERS = [readPartialDefinitionSection];

var preserveWhitespaceElements = { pre: 1, script: 1, style: 1, textarea: 1 };

var defaultInterpolate = { textarea: true, script: true, style: true, template: true };

var StandardParser = Parser.extend({
  init: function init(str, options) {
    var tripleDelimiters = options.tripleDelimiters || shared.defaults.tripleDelimiters;
    var staticDelimiters = options.staticDelimiters || shared.defaults.staticDelimiters;
    var staticTripleDelimiters =
      options.staticTripleDelimiters || shared.defaults.staticTripleDelimiters;

    this.standardDelimiters = options.delimiters || shared.defaults.delimiters;

    this.tags = [
      {
        isStatic: false,
        isTriple: false,
        open: this.standardDelimiters[0],
        close: this.standardDelimiters[1],
        readers: STANDARD_READERS
      },
      {
        isStatic: false,
        isTriple: true,
        open: tripleDelimiters[0],
        close: tripleDelimiters[1],
        readers: TRIPLE_READERS
      },
      {
        isStatic: true,
        isTriple: false,
        open: staticDelimiters[0],
        close: staticDelimiters[1],
        readers: STANDARD_READERS
      },
      {
        isStatic: true,
        isTriple: true,
        open: staticTripleDelimiters[0],
        close: staticTripleDelimiters[1],
        readers: TRIPLE_READERS
      }
    ];

    this.contextLines = options.contextLines || shared.defaults.contextLines;

    this.sortMustacheTags();

    this.sectionDepth = 0;
    this.elementStack = [];

    this.interpolate = assign(
      {},
      defaultInterpolate,
      shared.defaults.interpolate,
      options.interpolate
    );

    if (options.sanitize === true) {
      options.sanitize = {
        // blacklist from https://code.google.com/p/google-caja/source/browse/trunk/src/com/google/caja/lang/html/html4-elements-whitelist.json
        elements: 'applet base basefont body frame frameset head html isindex link meta noframes noscript object param script style title'.split(
          ' '
        ),
        eventAttributes: true
      };
    }

    this.stripComments = options.stripComments !== false;
    this.preserveWhitespace = isObjectType(options.preserveWhitespace)
      ? false
      : options.preserveWhitespace;
    this.sanitizeElements = options.sanitize && options.sanitize.elements;
    this.sanitizeEventAttributes = options.sanitize && options.sanitize.eventAttributes;
    this.includeLinePositions = options.includeLinePositions;
    this.textOnlyMode = options.textOnlyMode;
    this.csp = options.csp;
    this.allowExpressions = options.allowExpressions;

    if (options.expression) { this.converters = [readExpression]; }

    if (options.attributes) { this.inTag = true; }

    // special whitespace handling requested for certain elements
    this.whiteSpaceElements = assign({}, options.preserveWhitespace, preserveWhitespaceElements);
  },

  postProcess: function postProcess(result, options) {
    var parserResult = result[0];

    if (options.expression) {
      var expr = flattenExpression(parserResult);
      expr.e = fromExpression(expr.s, expr.r.length);
      return expr;
    } else {
      // special case - empty string
      if (!result.length) {
        return { t: [], v: TEMPLATE_VERSION };
      }

      if (this.sectionDepth > 0) {
        this.error('A section was left open');
      }

      cleanup(
        parserResult.t,
        this.stripComments,
        this.preserveWhitespace,
        !this.preserveWhitespace,
        !this.preserveWhitespace,
        this.whiteSpaceElements
      );

      if (this.csp !== false) {
        var expr$1 = {};

        insertExpressions(parserResult.t, expr$1);
        insertExpressions(parserResult.p || {}, expr$1);

        if (keys(expr$1).length) { parserResult.e = expr$1; }
      }

      return parserResult;
    }
  },

  converters: [readTemplate],

  sortMustacheTags: function sortMustacheTags() {
    // Sort in order of descending opening delimiter length (longer first),
    // to protect against opening delimiters being substrings of each other
    this.tags.sort(function (a, b) {
      return b.open.length - a.open.length;
    });
  }
});

function parse(template, options) {
  return new StandardParser(template, options || {}).result;
}

var parseOptions = [
  'delimiters',
  'tripleDelimiters',
  'staticDelimiters',
  'staticTripleDelimiters',
  'csp',
  'interpolate',
  'preserveWhitespace',
  'sanitize',
  'stripComments',
  'contextLines',
  'allowExpressions',
  'attributes'
];

var TEMPLATE_INSTRUCTIONS = "Either preparse or use a ractive runtime source that includes the parser. ";

var COMPUTATION_INSTRUCTIONS = "Either include a version of Ractive that can parse or convert your computation strings to functions.";

function throwNoParse(method, error, instructions) {
  if (!method) {
    fatal(("Missing Ractive.parse - cannot parse " + error + ". " + instructions));
  }
}

function createFunction(body, length) {
  throwNoParse(fromExpression, 'new expression function', TEMPLATE_INSTRUCTIONS);
  return fromExpression(body, length);
}

function createFunctionFromString(str, bindTo) {
  throwNoParse(parse, 'compution string "${str}"', COMPUTATION_INSTRUCTIONS);
  var tpl = parse(str, { expression: true });
  return function() {
    return tpl.e.apply(bindTo, tpl.r.map(function (r) { return bindTo.get(r); }));
  };
}

var parser = {
  fromId: function fromId(id, options) {
    if (!doc) {
      if (options && options.noThrow) {
        return;
      }
      throw new Error(("Cannot retrieve template #" + id + " as Ractive is not running in a browser."));
    }

    if (id) { id = id.replace(/^#/, ''); }

    var template;

    if (!(template = doc.getElementById(id))) {
      if (options && options.noThrow) {
        return;
      }
      throw new Error(("Could not find template element with id #" + id));
    }

    if (template.tagName.toUpperCase() !== 'SCRIPT') {
      if (options && options.noThrow) {
        return;
      }
      throw new Error(("Template element with id #" + id + ", must be a <script> element"));
    }

    return 'textContent' in template ? template.textContent : template.innerHTML;
  },

  isParsed: function isParsed(template) {
    return !isString(template);
  },

  getParseOptions: function getParseOptions(ractive) {
    // Could be Ractive or a Component
    if (ractive.defaults) {
      ractive = ractive.defaults;
    }

    return parseOptions.reduce(function (val, key) {
      val[key] = ractive[key];
      return val;
    }, {});
  },

  parse: function parse$1(template, options) {
    throwNoParse(parse, 'template', TEMPLATE_INSTRUCTIONS);
    var parsed = parse(template, options);
    addFunctions(parsed);
    return parsed;
  },

  parseFor: function parseFor(template, ractive) {
    return this.parse(template, this.getParseOptions(ractive));
  }
};

function getComputationSignature(ractive, key, signature) {
  var getter;
  var setter;

  // useful for debugging
  var getterString;
  var getterUseStack;
  var setterString;

  if (isFunction(signature)) {
    getter = bind(signature, ractive);
    getterString = signature.toString();
    getterUseStack = true;
  }

  if (isString(signature)) {
    getter = createFunctionFromString(signature, ractive);
    getterString = signature;
  }

  if (isObjectType(signature)) {
    if (isString(signature.get)) {
      getter = createFunctionFromString(signature.get, ractive);
      getterString = signature.get;
    } else if (isFunction(signature.get)) {
      getter = bind(signature.get, ractive);
      getterString = signature.get.toString();
      getterUseStack = true;
    } else {
      fatal('`%s` computation must have a `get()` method', key);
    }

    if (isFunction(signature.set)) {
      setter = bind(signature.set, ractive);
      setterString = signature.set.toString();
    }
  }

  return {
    getter: getter,
    setter: setter,
    getterString: getterString,
    setterString: setterString,
    getterUseStack: getterUseStack
  };
}

var id = 0;

var TransitionManager = function TransitionManager(callback, parent) {
  this.callback = callback;
  this.parent = parent;

  this.intros = [];
  this.outros = [];

  this.children = [];
  this.totalChildren = this.outroChildren = 0;

  this.detachQueue = [];
  this.outrosComplete = false;

  this.id = id++;

  if (parent) {
    parent.addChild(this);
  }
};
var TransitionManager__proto__ = TransitionManager.prototype;

TransitionManager__proto__.add = function add (transition) {
  var list = transition.isIntro ? this.intros : this.outros;
  transition.starting = true;
  list.push(transition);
};

TransitionManager__proto__.addChild = function addChild (child) {
  this.children.push(child);

  this.totalChildren += 1;
  this.outroChildren += 1;
};

TransitionManager__proto__.checkStart = function checkStart () {
  if (this.parent && this.parent.started) { this.start(); }
};

TransitionManager__proto__.decrementOutros = function decrementOutros () {
  this.outroChildren -= 1;
  check(this);
};

TransitionManager__proto__.decrementTotal = function decrementTotal () {
  this.totalChildren -= 1;
  check(this);
};

TransitionManager__proto__.detachNodes = function detachNodes () {
    var this$1 = this;

  var len = this.detachQueue.length;
  for (var i = 0; i < len; i++) { this$1.detachQueue[i].detach(); }
  len = this.children.length;
  for (var i$1 = 0; i$1 < len; i$1++) { this$1.children[i$1].detachNodes(); }
  this.detachQueue = [];
};

TransitionManager__proto__.ready = function ready () {
  if (this.detachQueue.length) { detachImmediate(this); }
};

TransitionManager__proto__.remove = function remove (transition) {
  var list = transition.isIntro ? this.intros : this.outros;
  removeFromArray(list, transition);
  check(this);
};

TransitionManager__proto__.start = function start () {
  this.started = true;
  this.children.forEach(function (c) { return c.start(); });
  this.intros.concat(this.outros).forEach(function (t) { return t.start(); });
  check(this);
};

function check(tm) {
  if (!tm.started || tm.outros.length || tm.outroChildren) { return; }

  // If all outros are complete, and we haven't already done this,
  // we notify the parent if there is one, otherwise
  // start detaching nodes
  if (!tm.outrosComplete) {
    tm.outrosComplete = true;

    if (tm.parent) { tm.parent.decrementOutros(tm); }

    if (allOutrosComplete(tm)) {
      tm.detachNodes();
    }
  }

  // Once everything is done, we can notify parent transition
  // manager and call the callback
  if (!tm.intros.length && !tm.totalChildren) {
    if (isFunction(tm.callback)) {
      tm.callback();
    }

    if (tm.parent && !tm.notifiedTotal) {
      tm.notifiedTotal = true;
      tm.parent.decrementTotal();
    }
  }
}

function allOutrosComplete(manager) {
  return !manager || (manager.outrosComplete && allOutrosComplete(manager.parent));
}

// check through the detach queue to see if a node is up or downstream from a
// transition and if not, go ahead and detach it
function detachImmediate(manager) {
  var queue = manager.detachQueue;
  var outros = collectAllOutros(manager);

  if (!outros.length) {
    manager.detachNodes();
  } else {
    var i = queue.length;
    var j = 0;
    var node, trans;
    var nqueue = (manager.detachQueue = []);

    start: while (i--) {
      node = queue[i].node;
      j = outros.length;
      while (j--) {
        trans = outros[j].element.node;
        // check to see if the node is, contains, or is contained by the transitioning node
        if (trans === node || trans.contains(node) || node.contains(trans)) {
          nqueue.push(queue[i]);
          continue start;
        }
      }

      // no match, we can drop it
      queue[i].detach();
    }
  }
}

function collectAllOutros(manager, _list) {
  var list = _list;

  // if there's no list, we're starting at the root to build one
  if (!list) {
    list = [];
    var parent = manager;
    while (parent.parent) { parent = parent.parent; }
    return collectAllOutros(parent, list);
  } else {
    // grab all outros from child managers
    var i = manager.children.length;
    while (i--) {
      list = collectAllOutros(manager.children[i], list);
    }

    // grab any from this manager if there are any
    if (manager.outros.length) { list = list.concat(manager.outros); }

    return list;
  }
}

var batch;

var runloop = {
  active: function active() {
    return !!batch;
  },

  start: function start() {
    var fulfilPromise;
    var promise = new Promise(function (f) { return (fulfilPromise = f); });

    batch = {
      previousBatch: batch,
      transitionManager: new TransitionManager(fulfilPromise, batch && batch.transitionManager),
      fragments: [],
      tasks: [],
      immediateObservers: [],
      deferredObservers: [],
      promise: promise
    };

    return promise;
  },

  end: function end() {
    flushChanges();

    if (!batch.previousBatch) { batch.transitionManager.start(); }
    else { batch.transitionManager.checkStart(); }

    batch = batch.previousBatch;
  },

  addFragment: function addFragment(fragment) {
    addToArray(batch.fragments, fragment);
  },

  // TODO: come up with a better way to handle fragments that trigger their own update
  addFragmentToRoot: function addFragmentToRoot(fragment) {
    if (!batch) { return; }

    var b = batch;
    while (b.previousBatch) {
      b = b.previousBatch;
    }

    addToArray(b.fragments, fragment);
  },

  addObserver: function addObserver(observer, defer) {
    if (!batch) {
      observer.dispatch();
    } else {
      addToArray(defer ? batch.deferredObservers : batch.immediateObservers, observer);
    }
  },

  registerTransition: function registerTransition(transition) {
    transition._manager = batch.transitionManager;
    batch.transitionManager.add(transition);
  },

  // synchronise node detachments with transition ends
  detachWhenReady: function detachWhenReady(thing) {
    batch.transitionManager.detachQueue.push(thing);
  },

  scheduleTask: function scheduleTask(task, postRender) {
    var _batch;

    if (!batch) {
      task();
    } else {
      _batch = batch;
      while (postRender && _batch.previousBatch) {
        // this can't happen until the DOM has been fully updated
        // otherwise in some situations (with components inside elements)
        // transitions and decorators will initialise prematurely
        _batch = _batch.previousBatch;
      }

      _batch.tasks.push(task);
    }
  },

  promise: function promise() {
    if (!batch) { return Promise.resolve(); }

    var target = batch;
    while (target.previousBatch) {
      target = target.previousBatch;
    }

    return target.promise || Promise.resolve();
  }
};

function dispatch(observer) {
  observer.dispatch();
}

function flushChanges() {
  var which = batch.immediateObservers;
  batch.immediateObservers = [];
  which.forEach(dispatch);

  // Now that changes have been fully propagated, we can update the DOM
  // and complete other tasks
  var i = batch.fragments.length;
  var fragment;

  which = batch.fragments;
  batch.fragments = [];

  while (i--) {
    fragment = which[i];
    fragment.update();
  }

  batch.transitionManager.ready();

  which = batch.deferredObservers;
  batch.deferredObservers = [];
  which.forEach(dispatch);

  var tasks = batch.tasks;
  batch.tasks = [];

  for (i = 0; i < tasks.length; i += 1) {
    tasks[i]();
  }

  // If updating the view caused some model blowback - e.g. a triple
  // containing <option> elements caused the binding on the <select>
  // to update - then we start over
  if (
    batch.fragments.length ||
    batch.immediateObservers.length ||
    batch.deferredObservers.length ||
    batch.tasks.length
  )
    { return flushChanges(); }
}

// TODO what happens if a transition is aborted?

var tickers = [];
var running = false;

function tick() {
  runloop.start();

  var now = performance.now();

  var i;
  var ticker;

  for (i = 0; i < tickers.length; i += 1) {
    ticker = tickers[i];

    if (!ticker.tick(now)) {
      // ticker is complete, remove it from the stack, and decrement i so we don't miss one
      tickers.splice(i--, 1);
    }
  }

  runloop.end();

  if (tickers.length) {
    requestAnimationFrame(tick);
  } else {
    running = false;
  }
}

var Ticker = function Ticker(options) {
  this.duration = options.duration;
  this.step = options.step;
  this.complete = options.complete;
  this.easing = options.easing;

  this.start = performance.now();
  this.end = this.start + this.duration;

  this.running = true;

  tickers.push(this);
  if (!running) { requestAnimationFrame(tick); }
};
var Ticker__proto__ = Ticker.prototype;

Ticker__proto__.tick = function tick (now) {
  if (!this.running) { return false; }

  if (now > this.end) {
    if (this.step) { this.step(1); }
    if (this.complete) { this.complete(1); }

    return false;
  }

  var elapsed = now - this.start;
  var eased = this.easing(elapsed / this.duration);

  if (this.step) { this.step(eased); }

  return true;
};

Ticker__proto__.stop = function stop () {
  if (this.abort) { this.abort(); }
  this.running = false;
};

var prefixers = {};

// TODO this is legacy. sooner we can replace the old adaptor API the better
/* istanbul ignore next */
function prefixKeypath(obj, prefix) {
  var prefixed = {};

  if (!prefix) {
    return obj;
  }

  prefix += '.';

  for (var key in obj) {
    if (hasOwn(obj, key)) {
      prefixed[prefix + key] = obj[key];
    }
  }

  return prefixed;
}

function getPrefixer(rootKeypath) {
  var rootDot;

  if (!prefixers[rootKeypath]) {
    rootDot = rootKeypath ? rootKeypath + '.' : '';

    /* istanbul ignore next */
    prefixers[rootKeypath] = function(relativeKeypath, value) {
      var obj;

      if (isString(relativeKeypath)) {
        obj = {};
        obj[rootDot + relativeKeypath] = value;
        return obj;
      }

      if (isObjectType(relativeKeypath)) {
        // 'relativeKeypath' is in fact a hash, not a keypath
        return rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;
      }
    };
  }

  return prefixers[rootKeypath];
}

var shared$1 = {};

var Model = (function (ModelBase) {
  function Model(parent, key) {
    ModelBase.call(this, parent);

    this.ticker = null;

    if (parent) {
      this.key = unescapeKey(key);
      this.isReadonly = parent.isReadonly;

      if (parent.value) {
        this.value = parent.value[this.key];
        if (isArray(this.value)) { this.length = this.value.length; }
        this.adapt();
      }
    }
  }

  if ( ModelBase ) Model.__proto__ = ModelBase;
  var Model__proto__ = Model.prototype = Object.create( ModelBase && ModelBase.prototype );
  Model__proto__.constructor = Model;

  Model__proto__.adapt = function adapt () {
    var this$1 = this;

    var adaptors = this.root.adaptors;
    var len = adaptors.length;

    this.rewrap = false;

    // Exit early if no adaptors
    if (len === 0) { return; }

    var value = this.wrapper
      ? 'newWrapperValue' in this
        ? this.newWrapperValue
        : this.wrapperValue
      : this.value;

    // TODO remove this legacy nonsense
    var ractive = this.root.ractive;
    var keypath = this.getKeypath();

    // tear previous adaptor down if present
    if (this.wrapper) {
      var shouldTeardown =
        this.wrapperValue === value
          ? false
          : !this.wrapper.reset || this.wrapper.reset(value) === false;

      if (shouldTeardown) {
        this.wrapper.teardown();
        delete this.wrapper;
        delete this.wrapperValue;
        delete this.newWrapperValue;

        // don't branch for undefined values
        if (this.value !== undefined) {
          var parentValue = this.parent.value || this.parent.createBranch(this.key);
          if (parentValue[this.key] !== value) { parentValue[this.key] = value; }
          this.value = value;
        }
      } else {
        delete this.newWrapperValue;
        this.value = this.wrapper.get();
        return;
      }
    }

    var i;

    for (i = 0; i < len; i += 1) {
      var adaptor = adaptors[i];
      if (adaptor.filter(value, keypath, ractive)) {
        this$1.wrapper = adaptor.wrap(ractive, value, keypath, getPrefixer(keypath));
        this$1.wrapperValue = value;
        this$1.wrapper.__model = this$1; // massive temporary hack to enable array adaptor

        this$1.value = this$1.wrapper.get();

        break;
      }
    }
  };

  Model__proto__.animate = function animate (from, to, options, interpolator) {
    var this$1 = this;

    if (this.ticker) { this.ticker.stop(); }

    var fulfilPromise;
    var promise = new Promise(function (fulfil) { return (fulfilPromise = fulfil); });

    this.ticker = new Ticker({
      duration: options.duration,
      easing: options.easing,
      step: function (t) {
        var value = interpolator(t);
        this$1.applyValue(value);
        if (options.step) { options.step(t, value); }
      },
      complete: function () {
        this$1.applyValue(to);
        if (options.complete) { options.complete(to); }

        this$1.ticker = null;
        fulfilPromise(to);
      }
    });

    promise.stop = this.ticker.stop;
    return promise;
  };

  Model__proto__.applyValue = function applyValue (value, notify) {
    if ( notify === void 0 ) notify = true;

    if (isEqual(value, this.value)) { return; }
    if (this.boundValue) { this.boundValue = null; }

    if (this.parent.wrapper && this.parent.wrapper.set) {
      this.parent.wrapper.set(this.key, value);
      this.parent.value = this.parent.wrapper.get();

      this.value = this.parent.value[this.key];
      if (this.wrapper) { this.newWrapperValue = this.value; }
      this.adapt();
    } else if (this.wrapper) {
      this.newWrapperValue = value;
      this.adapt();
    } else {
      var parentValue = this.parent.value || this.parent.createBranch(this.key);
      if (isObjectLike(parentValue)) {
        parentValue[this.key] = value;
      } else {
        warnIfDebug(("Attempted to set a property of a non-object '" + (this.getKeypath()) + "'"));
        return;
      }

      this.value = value;
      this.adapt();
    }

    if (this.dataModel || (value && value.viewmodel && value.viewmodel.isRoot)) {
      checkDataLink(this, value);
    }

    // keep track of array stuff
    if (isArray(value)) {
      this.length = value.length;
      this.isArray = true;
    } else {
      this.isArray = false;
    }

    // notify dependants
    this.links.forEach(handleChange);
    this.children.forEach(mark);
    this.deps.forEach(handleChange);

    if (notify) { this.notifyUpstream(); }

    if (this.parent.isArray) {
      if (this.key === 'length') { this.parent.length = value; }
      else { this.parent.joinKey('length').mark(); }
    }
  };

  Model__proto__.compute = function compute (key, computed) {
    var registry = this.computed || (this.computed = {});

    if (registry[key]) {
      registry[key].signature = getComputationSignature(this.root.ractive, key, computed);
      registry[key].mark();
    } else {
      registry[key] = new shared$1.Computation(
        this,
        getComputationSignature(this.root.ractive, key, computed),
        key
      );
    }

    return registry[key];
  };

  Model__proto__.createBranch = function createBranch (key) {
    var branch = isNumeric(key) ? [] : {};
    this.applyValue(branch, false);

    return branch;
  };

  Model__proto__.get = function get (shouldCapture, opts) {
    if (this._link) { return this._link.get(shouldCapture, opts); }
    if (shouldCapture) { capture(this); }
    // if capturing, this value needs to be unwrapped because it's for external use
    if (opts && opts.virtual) { return this.getVirtual(false); }
    return maybeBind(
      this,
      (opts && 'unwrap' in opts ? opts.unwrap !== false : shouldCapture) && this.wrapper
        ? this.wrapperValue
        : this.value,
      !opts || opts.shouldBind !== false
    );
  };

  Model__proto__.joinKey = function joinKey (key, opts) {
    var this$1 = this;

    if (this._link) {
      if (opts && opts.lastLink !== false && (isUndefined(key) || key === '')) { return this; }
      return this._link.joinKey(key);
    }

    if (isUndefined(key) || key === '') { return this; }

    var child;
    if (hasOwn(this.childByKey, key)) { child = this.childByKey[key]; }
    else { child = this.computed && this.computed[key]; }

    if (!child) {
      var computed;
      if (this.isRoot && this.ractive && (computed = this.ractive.computed[key])) {
        child = this.compute(key, computed);
      } else if (!this.isRoot && this.root.ractive) {
        var registry = this.root.ractive.computed;
        for (var k in registry) {
          computed = registry[k];
          if (computed.pattern && computed.pattern.test(this$1.getKeypath() + '.' + key)) {
            child = this$1.compute(key, computed);
          }
        }
      }
    }

    if (!child) {
      child = new Model(this, key);
      this.children.push(child);
      this.childByKey[key] = child;

      if (key === 'data') {
        var val = this.retrieve();
        if (val && val.viewmodel && val.viewmodel.isRoot) {
          child.link(val.viewmodel, 'data');
          this.dataModel = val;
        }
      }
    }

    if (child._link && (!opts || opts.lastLink !== false)) { return child._link; }

    return child;
  };

  Model__proto__.mark = function mark$1 (force) {
    if (this._link) { return this._link.mark(force); }

    var old = this.value;
    var value = this.retrieve();

    if (this.dataModel || (value && value.viewmodel && value.viewmodel.isRoot)) {
      checkDataLink(this, value);
    }

    if (force || !isEqual(value, old)) {
      this.value = value;
      if (this.boundValue) { this.boundValue = null; }

      // make sure the wrapper stays in sync
      if (old !== value || this.rewrap) {
        if (this.wrapper) { this.newWrapperValue = value; }
        this.adapt();
      }

      // keep track of array stuff
      if (isArray(value)) {
        this.length = value.length;
        this.isArray = true;
      } else {
        this.isArray = false;
      }

      this.children.forEach(force ? markForce : mark);
      this.links.forEach(marked);

      this.deps.forEach(handleChange);
    }
  };

  Model__proto__.merge = function merge (array, comparator) {
    var newIndices = buildNewIndices(
      this.value === array ? recreateArray(this) : this.value,
      array,
      comparator
    );
    this.parent.value[this.key] = array;
    this.shuffle(newIndices, true);
  };

  Model__proto__.retrieve = function retrieve () {
    return this.parent.value ? this.parent.value[this.key] : undefined;
  };

  Model__proto__.set = function set (value) {
    if (this.ticker) { this.ticker.stop(); }
    this.applyValue(value);
  };

  Model__proto__.shuffle = function shuffle$2 (newIndices, unsafe) {
    shuffle(this, newIndices, false, unsafe);
  };

  Model__proto__.source = function source () {
    return this;
  };

  Model__proto__.teardown = function teardown$4 () {
    var this$1 = this;

    if (this._link) {
      this._link.teardown();
      this._link = null;
    }
    this.children.forEach(teardown);
    if (this.wrapper) { this.wrapper.teardown(); }
    if (this.computed) { keys(this.computed).forEach(function (k) { return this$1.computed[k].teardown(); }); }
  };

  return Model;
}(ModelBase));

function recreateArray(model) {
  var array = [];

  for (var i = 0; i < model.length; i++) {
    array[i] = (model.childByKey[i] || {}).value;
  }

  return array;
}

/* global global */
var data = {};

var SharedModel = (function (Model) {
  function SharedModel(value, name, ractive) {
    Model.call(this, null, ("@" + name));
    this.key = "@" + name;
    this.value = value;
    this.isRoot = true;
    this.root = this;
    this.adaptors = [];
    this.ractive = ractive;
  }

  if ( Model ) SharedModel.__proto__ = Model;
  var SharedModel__proto__ = SharedModel.prototype = Object.create( Model && Model.prototype );
  SharedModel__proto__.constructor = SharedModel;

  SharedModel__proto__.getKeypath = function getKeypath () {
    return this.key;
  };

  SharedModel__proto__.retrieve = function retrieve () {
    return this.value;
  };

  return SharedModel;
}(Model));

var SharedModel$1 = new SharedModel(data, 'shared');

var GlobalModel = new SharedModel(base, 'global');

function findContext(fragment) {
  var frag = fragment;
  while (frag && !frag.context && !frag.aliases) { frag = frag.parent; }
  return frag;
}

function resolveReference(fragment, ref) {
  var initialFragment = fragment;
  // current context ref
  if (ref === '.') { return fragment.findContext(); }

  // ancestor references
  if (ref[0] === '~') { return fragment.ractive.viewmodel.joinAll(splitKeypath(ref.slice(2))); }

  // scoped references
  if (ref[0] === '.' || ref[0] === '^') {
    var frag = fragment;
    var parts = ref.split('/');
    var explicitContext = parts[0] === '^^';

    // find nearest context node
    while (frag && !frag.context) {
      frag = up(frag);
    }
    var context$1 = frag && frag.context;

    // walk up the context chain
    while (frag && parts[0] === '^^') {
      parts.shift();

      // the current fragment should always be a context,
      // and if it happens to be an iteration, jump above the each block
      if (frag.isIteration) {
        frag = frag.parent.parent;
      } else {
        // otherwise jump above the current fragment
        frag = up(frag);
      }

      // walk to the next contexted fragment
      while (frag && !frag.context) {
        frag = up(frag);
      }
      context$1 = frag && frag.context;
    }

    if (!context$1 && explicitContext) {
      throw new Error(
        ("Invalid context parent reference ('" + ref + "'). There is not context at that level.")
      );
    }

    // walk up the context path
    while (parts[0] === '.' || parts[0] === '..') {
      var part = parts.shift();

      if (part === '..') {
        context$1 = context$1.parent;
      }
    }

    ref = parts.join('/');

    // special case - `{{.foo}}` means the same as `{{./foo}}`
    if (ref[0] === '.') { ref = ref.slice(1); }
    return context$1.joinAll(splitKeypath(ref));
  }

  var keys$$1 = splitKeypath(ref);
  if (!keys$$1.length) { return; }
  var base = keys$$1.shift();

  // special refs
  if (base[0] === '@') {
    // shorthand from outside the template
    // @this referring to local ractive instance
    if (base === '@this' || base === '@') {
      return fragment.ractive.viewmodel.getRactiveModel().joinAll(keys$$1);
    } else if (base === '@index' || base === '@key') {
      // @index or @key referring to the nearest repeating index or key
      if (keys$$1.length) { badReference(base); }
      var repeater = findIter(fragment);
      return repeater && repeater[("get" + (base[1] === 'i' ? 'Index' : 'Key'))]();
    } else if (base === '@last') {
      var repeater$1 = findIter(fragment);
      return repeater$1 && repeater$1.parent.getLast();
    } else if (base === '@global') {
      // @global referring to window or global
      return GlobalModel.joinAll(keys$$1);
    } else if (base === '@shared') {
      // @global referring to window or global
      return SharedModel$1.joinAll(keys$$1);
    } else if (base === '@keypath' || base === '@rootpath') {
      // @keypath or @rootpath, the current keypath string
      var root = ref[1] === 'r' ? fragment.ractive.root : null;
      var f = fragment;

      while (
        f &&
        (!f.context || (f.isRoot && f.ractive.component && (root || !f.ractive.isolated)))
      ) {
        f = f.isRoot ? f.componentParent : f.parent;
      }

      return f.getKeypath(root);
    } else if (base === '@context') {
      return new SharedModel(fragment.getContext(), 'context').joinAll(keys$$1);
    } else if (base === '@local') {
      // @context-local data
      return fragment.getContext()._data.joinAll(keys$$1);
    } else if (base === '@style') {
      // @style shared model
      return fragment.ractive.constructor._cssModel.joinAll(keys$$1);
    } else if (base === '@helpers') {
      // @helpers instance model
      return fragment.ractive.viewmodel.getHelpers().joinAll(keys$$1);
    } else if (base === '@macro') {
      var handle = findMacro(fragment);
      if (handle) { return new SharedModel(handle, 'macro').joinAll(keys$$1); }
      else { return; }
    } else {
      // nope
      throw new Error(("Invalid special reference '" + base + "'"));
    }
  }

  // helpers
  if (base && !keys$$1.length) {
    var helpers = fragment.ractive.viewmodel.getHelpers();
    if (helpers.has(base)) { return helpers.joinKey(base); }
  }

  var context = findContext(fragment);

  // check immediate context for a match
  if (context) {
    if (context.context) {
      context = context.context;
    } else {
      // alias block, so get next full context for later
      context = fragment.findContext();
    }
  } else {
    context = fragment.findContext();
  }

  // walk up the fragment hierarchy looking for a matching ref, alias, or key in a context
  var createMapping = false;
  var shouldWarn = fragment.ractive.warnAboutAmbiguity;
  var crossed = 0;
  var model;

  while (fragment) {
    // repeated fragments
    if (fragment.isIteration) {
      if (base === fragment.parent.keyRef) {
        model = fragment.getKey();
      } else if (base === fragment.parent.indexRef) {
        model = fragment.getIndex();
      }

      if (model && keys$$1.length) { badReference(base); }
    }

    // alias node or iteration
    if (!model && fragment.aliases && hasOwn(fragment.aliases, base)) {
      model = fragment.aliases[base];
    }

    // check fragment context to see if it has the key we need
    if (!model && fragment.context && fragment.context.has(base)) {
      model = fragment.context.joinKey(base);

      // this is an implicit mapping
      if (createMapping) {
        if (shouldWarn)
          { warnIfDebug(
            ("'" + ref + "' resolved but is ambiguous and will create a mapping to a parent component.")
          ); }
      } else if (shouldWarn && crossed) { warnIfDebug(("'" + ref + "' resolved but is ambiguous.")); }
    }

    if (model) {
      if (createMapping) {
        model = initialFragment.ractive.viewmodel.createLink(base, model, base, { implicit: true });
      }

      if (keys$$1.length > 0 && isFunction(model.joinAll)) {
        model = model.joinAll(keys$$1);
      }

      return model;
    }

    // don't consider alias blocks when checking for ambiguity
    if (fragment.context && !fragment.aliases) { crossed = 1; }

    if (
      (fragment.componentParent || (!fragment.parent && fragment.ractive.component)) &&
      !fragment.ractive.isolated
    ) {
      // ascend through component boundary
      fragment = fragment.componentParent || fragment.ractive.component.up;
      createMapping = true;
    } else {
      fragment = fragment.parent;
    }
  }

  // if enabled, check the instance for a match
  var instance = initialFragment.ractive;
  if (instance.resolveInstanceMembers && base !== 'data' && base in instance) {
    return instance.viewmodel
      .getRactiveModel()
      .joinKey(base)
      .joinAll(keys$$1);
  }

  if (shouldWarn) {
    warnIfDebug(("'" + ref + "' is ambiguous and did not resolve."));
  }

  // didn't find anything, so go ahead and create the key on the local model
  return context.joinKey(base).joinAll(keys$$1);
}

function up(fragment) {
  return fragment && ((!fragment.ractive.isolated && fragment.componentParent) || fragment.parent);
}

function findIter(start) {
  var fragment = start;
  var next;
  while (!fragment.isIteration && (next = up(fragment))) {
    fragment = next;
  }

  return fragment.isIteration && fragment;
}

function findMacro(start) {
  var fragment = start;
  while (fragment) {
    if (fragment.owner.handle) { return fragment.owner.handle; }
    fragment = up(fragment);
  }
}

function badReference(key) {
  throw new Error(("An index or key reference (" + key + ") cannot have child properties"));
}

var extern = {};

function getRactiveContext(ractive) {
  var assigns = [], len = arguments.length - 1;
  while ( len-- > 0 ) assigns[ len ] = arguments[ len + 1 ];

  var fragment =
    ractive.fragment ||
    ractive._fakeFragment ||
    (ractive._fakeFragment = new FakeFragment(ractive));
  return fragment.getContext.apply(fragment, assigns);
}

function getContext() {
  var assigns = [], len = arguments.length;
  while ( len-- ) assigns[ len ] = arguments[ len ];

  if (!this.ctx) { this.ctx = new extern.Context(this); }
  assigns.unshift(create(this.ctx));
  return assign.apply(null, assigns);
}

var FakeFragment = function FakeFragment(ractive) {
  this.ractive = ractive;
};

FakeFragment.prototype.findContext = function findContext () {
  return this.ractive.viewmodel;
};
var proto = FakeFragment.prototype;
proto.getContext = getContext;
proto.find = proto.findComponent = proto.findAll = proto.findAllComponents = noop;

function findParentWithContext(fragment) {
  var frag = fragment;
  while (frag && !frag.context) { frag = frag.parent; }
  if (!frag) { return fragment && fragment.ractive.fragment; }
  else { return frag; }
}

var keep = false;

function set(pairs, options) {
  var k = keep;

  var deep = options && options.deep;
  var shuffle = options && options.shuffle;
  var promise = runloop.start();
  if (options && 'keep' in options) { keep = options.keep; }

  var i = pairs.length;
  while (i--) {
    var model = pairs[i][0];
    var value = pairs[i][1];
    var keypath = pairs[i][2];

    if (!model) {
      runloop.end();
      throw new Error(("Failed to set invalid keypath '" + keypath + "'"));
    }

    if (deep) { deepSet(model, value); }
    else if (shuffle) {
      var array = value;
      var target = model.get();
      // shuffle target array with itself
      if (!array) { array = target; }

      // if there's not an array there yet, go ahead and set
      if (isUndefined(target)) {
        model.set(array);
      } else {
        if (!isArray(target) || !isArray(array)) {
          runloop.end();
          throw new Error('You cannot merge an array with a non-array');
        }

        var comparator = getComparator(shuffle);
        model.merge(array, comparator);
      }
    } else { model.set(value); }
  }

  runloop.end();

  keep = k;

  return promise;
}

var star = /\*/;
function gather(ractive, keypath, base, isolated) {
  if (!base && (keypath[0] === '.' || keypath[1] === '^')) {
    warnIfDebug(
      "Attempted to set a relative keypath from a non-relative context. You can use a context object to set relative keypaths."
    );
    return [];
  }

  var keys$$1 = splitKeypath(keypath);
  var model = base || ractive.viewmodel;

  if (star.test(keypath)) {
    return model.findMatches(keys$$1);
  } else {
    if (model === ractive.viewmodel) {
      // allow implicit mappings
      if (
        ractive.component &&
        !ractive.isolated &&
        !model.has(keys$$1[0]) &&
        keypath[0] !== '@' &&
        keypath[0] &&
        !isolated
      ) {
        return [resolveReference(ractive.fragment || new FakeFragment(ractive), keypath)];
      } else {
        return [model.joinAll(keys$$1)];
      }
    } else {
      return [model.joinAll(keys$$1)];
    }
  }
}

function build(ractive, keypath, value, isolated) {
  var sets = [];

  // set multiple keypaths in one go
  if (isObject(keypath)) {
    var loop = function ( k ) {
      if (hasOwn(keypath, k)) {
        sets.push.apply(sets, gather(ractive, k, null, isolated).map(function (m) { return [m, keypath[k], k]; }));
      }
    };

    for (var k in keypath) loop( k );
  } else {
    // set a single keypath
    sets.push.apply(sets, gather(ractive, keypath, null, isolated).map(function (m) { return [m, value, keypath]; }));
  }

  return sets;
}

var deepOpts = { virtual: false };
function deepSet(model, value) {
  var dest = model.get(false, deepOpts);

  // if dest doesn't exist, just set it
  if (dest == null || !isObjectType(value)) { return model.set(value); }
  if (!isObjectType(dest)) { return model.set(value); }

  for (var k in value) {
    if (hasOwn(value, k)) {
      deepSet(model.joinKey(k), value[k]);
    }
  }
}

var comparators = {};
function getComparator(option) {
  if (option === true) { return null; } // use existing arrays
  if (isFunction(option)) { return option; }

  if (isString(option)) {
    return comparators[option] || (comparators[option] = function (thing) { return thing[option]; });
  }

  throw new Error('If supplied, options.compare must be a string, function, or true'); // TODO link to docs
}

var errorMessage = 'Cannot add to a non-numeric value';

function add(ractive, keypath, d, options) {
  if (!isString(keypath) || !isNumeric(d)) {
    throw new Error('Bad arguments');
  }

  var sets = build(ractive, keypath, d, options && options.isolated);

  return set(
    sets.map(function (pair) {
      var model = pair[0];
      var add = pair[1];
      var value = model.get();
      if (!isNumeric(add) || !isNumeric(value)) { throw new Error(errorMessage); }
      return [model, value + add];
    })
  );
}

function Ractive$add(keypath, d, options) {
  var num = isNumber(d) ? d : 1;
  var opts = isObjectType(d) ? d : options;
  return add(this, keypath, num, opts);
}

function immediate(value) {
  var result = Promise.resolve(value);
  defineProperty(result, 'stop', { value: noop });
  return result;
}

var linear = easing.linear;

function getOptions(options, instance) {
  options = options || {};

  var easing$$1;
  if (options.easing) {
    easing$$1 = isFunction(options.easing) ? options.easing : instance.easing[options.easing];
  }

  return {
    easing: easing$$1 || linear,
    duration: 'duration' in options ? options.duration : 400,
    complete: options.complete || noop,
    step: options.step || noop,
    interpolator: options.interpolator
  };
}

function animate(ractive, model, to, options) {
  options = getOptions(options, ractive);
  var from = model.get();

  // don't bother animating values that stay the same
  if (isEqual(from, to)) {
    options.complete(options.to);
    return immediate(to);
  }

  var interpolator = interpolate(from, to, ractive, options.interpolator);

  // if we can't interpolate the value, set it immediately
  if (!interpolator) {
    runloop.start();
    model.set(to);
    runloop.end();

    return immediate(to);
  }

  return model.animate(from, to, options, interpolator);
}

function Ractive$animate(keypath, to, options) {
  if (isObjectType(keypath)) {
    var keys$$1 = keys(keypath);

    throw new Error(("ractive.animate(...) no longer supports objects. Instead of ractive.animate({\n  " + (keys$$1.map(function (key) { return ("'" + key + "': " + (keypath[key])); }).join('\n  ')) + "\n}, {...}), do\n\n" + (keys$$1.map(function (key) { return ("ractive.animate('" + key + "', " + (keypath[key]) + ", {...});"); }).join('\n')) + "\n"));
  }

  return animate(this, this.viewmodel.joinAll(splitKeypath(keypath)), to, options);
}

function enqueue(ractive, event) {
  if (ractive.event) {
    ractive._eventQueue.push(ractive.event);
  }

  ractive.event = event;
}

function dequeue(ractive) {
  if (ractive._eventQueue.length) {
    ractive.event = ractive._eventQueue.pop();
  } else {
    ractive.event = null;
  }
}

var initStars = {};
var bubbleStars = {};

// cartesian product of name parts and stars
// adjusted appropriately for special cases
function variants(name, initial) {
  var map = initial ? initStars : bubbleStars;
  if (map[name]) { return map[name]; }

  var parts = name.split('.');
  var result = [];
  var base = false;

  // initial events the implicit namespace of 'this'
  if (initial) {
    parts.unshift('this');
    base = true;
  }

  // use max - 1 bits as a bitmap to pick a part or a *
  // need to skip the full star case if the namespace is synthetic
  var max = Math.pow(2, parts.length) - (initial ? 1 : 0);
  for (var i = 0; i < max; i++) {
    var join = [];
    for (var j = 0; j < parts.length; j++) {
      join.push(1 & (i >> j) ? '*' : parts[j]);
    }
    result.unshift(join.join('.'));
  }

  if (base) {
    // include non-this-namespaced versions
    if (parts.length > 2) {
      result.push.apply(result, variants(name, false));
    } else {
      result.push('*');
      result.push(name);
    }
  }

  map[name] = result;
  return result;
}

function fireEvent(ractive, eventName, context, args) {
  if ( args === void 0 ) args = [];

  if (!eventName) {
    return;
  }

  context.name = eventName;
  args.unshift(context);

  var eventNames = ractive._nsSubs ? variants(eventName, true) : ['*', eventName];

  return fireEventAs(ractive, eventNames, context, args, true);
}

function fireEventAs(ractive, eventNames, context, args, initialFire) {
  if ( initialFire === void 0 ) initialFire = false;

  var bubble = true;

  if (initialFire || ractive._nsSubs) {
    enqueue(ractive, context);

    var i = eventNames.length;
    while (i--) {
      if (eventNames[i] in ractive._subs) {
        bubble = notifySubscribers(ractive, ractive._subs[eventNames[i]], context, args) && bubble;
      }
    }

    dequeue(ractive);
  }

  if (ractive.parent && bubble) {
    if (initialFire && ractive.component) {
      var fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];
      eventNames = variants(fullName, false);

      if (context && !context.component) {
        context.component = ractive;
      }
    }

    bubble = fireEventAs(ractive.parent, eventNames, context, args);
  }

  return bubble;
}

function notifySubscribers(ractive, subscribers, context, args) {
  var originalEvent = null;
  var stopEvent = false;

  // subscribers can be modified inflight, e.g. "once" functionality
  // so we need to copy to make sure everyone gets called
  subscribers = subscribers.slice();

  for (var i = 0, len = subscribers.length; i < len; i += 1) {
    if (!subscribers[i].off && subscribers[i].handler.apply(ractive, args) === false) {
      stopEvent = true;
    }
  }

  if (context && stopEvent && (originalEvent = context.event)) {
    originalEvent.preventDefault && originalEvent.preventDefault();
    originalEvent.stopPropagation && originalEvent.stopPropagation();
  }

  return !stopEvent;
}

var Hook = function Hook(event) {
  this.event = event;
  this.method = 'on' + event;
};

Hook.prototype.fire = function fire (ractive, arg) {
  var context = getRactiveContext(ractive);
  var method = this.method;

  if (ractive[method]) {
    arg ? ractive[method](context, arg) : ractive[method](context);
  }

  fireEvent(ractive, this.event, context, arg ? [arg, ractive] : [ractive]);
};

function getChildQueue(queue, ractive) {
  return queue[ractive._guid] || (queue[ractive._guid] = []);
}

function fire(hookQueue, ractive) {
  var childQueue = getChildQueue(hookQueue.queue, ractive);

  hookQueue.hook.fire(ractive);

  // queue is "live" because components can end up being
  // added while hooks fire on parents that modify data values.
  while (childQueue.length) {
    fire(hookQueue, childQueue.shift());
  }

  delete hookQueue.queue[ractive._guid];
}

var HookQueue = function HookQueue(event) {
  this.hook = new Hook(event);
  this.inProcess = {};
  this.queue = {};
};
var HookQueue__proto__ = HookQueue.prototype;

HookQueue__proto__.begin = function begin (ractive) {
  this.inProcess[ractive._guid] = true;
};

HookQueue__proto__.end = function end (ractive) {
  var parent = ractive.parent;

  // If this is *isn't* a child of a component that's in process,
  // it should call methods or fire at this point
  if (!parent || !this.inProcess[parent._guid]) {
    fire(this, ractive);
  } else {
    // elsewise, handoff to parent to fire when ready
    getChildQueue(this.queue, parent).push(ractive);
  }

  delete this.inProcess[ractive._guid];
};

var hooks = {};
[
  'construct',
  'config',
  'attachchild',
  'detach',
  'detachchild',
  'insert',
  'complete',
  'reset',
  'render',
  'unrendering',
  'unrender',
  'teardown',
  'destruct',
  'update'
].forEach(function (hook) {
  hooks[hook] = new Hook(hook);
});
hooks.init = new HookQueue('init');

function findAnchors(fragment, name) {
  if ( name === void 0 ) name = null;

  var res = [];

  findAnchorsIn(fragment, name, res);

  return res;
}

function findAnchorsIn(item, name, result) {
  if (item.isAnchor) {
    if (!name || item.name === name) {
      result.push(item);
    }
  } else if (item.items) {
    item.items.forEach(function (i) { return findAnchorsIn(i, name, result); });
  } else if (item.iterations) {
    item.iterations.forEach(function (i) { return findAnchorsIn(i, name, result); });
  } else if (item.fragment && !item.component) {
    findAnchorsIn(item.fragment, name, result);
  }
}

function updateAnchors(instance, name) {
  if ( name === void 0 ) name = null;

  var anchors = findAnchors(instance.fragment, name);
  var idxs = {};
  var children = instance._children.byName;

  anchors.forEach(function (a) {
    var name = a.name;
    if (!(name in idxs)) { idxs[name] = 0; }
    var idx = idxs[name];
    var child = (children[name] || [])[idx];

    if (child && child.lastBound !== a) {
      if (child.lastBound) { child.lastBound.removeChild(child); }
      a.addChild(child);
    }

    idxs[name]++;
  });
}

function unrenderChild(meta) {
  if (meta.instance.fragment.rendered) {
    meta.shouldDestroy = true;
    meta.instance.unrender();
  }
  meta.instance.el = null;
}

function attachChild(child, options) {
  if ( options === void 0 ) options = {};

  var children = this._children;
  var idx;

  if (child.parent && child.parent !== this)
    { throw new Error(
      ("Instance " + (child._guid) + " is already attached to a different instance " + (child.parent._guid) + ". Please detach it from the other instance using detachChild first.")
    ); }
  else if (child.parent)
    { throw new Error(("Instance " + (child._guid) + " is already attached to this instance.")); }

  var meta = {
    instance: child,
    ractive: this,
    name: options.name || child.constructor.name || 'Ractive',
    target: options.target || false,
    bubble: bubble,
    findNextNode: findNextNode
  };
  meta.nameOption = options.name;

  // child is managing itself
  if (!meta.target) {
    meta.up = this.fragment;
    meta.external = true;
  } else {
    var list;
    if (!(list = children.byName[meta.target])) {
      list = [];
      this.set(("@this.children.byName." + (meta.target)), list);
    }
    idx = options.prepend ? 0 : options.insertAt !== undefined ? options.insertAt : list.length;
  }

  child.parent = this;
  child.root = this.root;
  child.component = meta;
  children.push(meta);

  var promise = runloop.start();

  var rm = child.viewmodel.getRactiveModel();
  rm.joinKey('parent', { lastLink: false }).link(this.viewmodel.getRactiveModel());
  rm.joinKey('root', { lastLink: false }).link(this.root.viewmodel.getRactiveModel());

  hooks.attachchild.fire(child);

  if (meta.target) {
    unrenderChild(meta);
    this.splice(("@this.children.byName." + (meta.target)), idx, 0, meta);
    updateAnchors(this, meta.target);
  } else {
    if (!child.isolated) { child.viewmodel.attached(this.fragment); }
  }

  runloop.end();

  promise.ractive = child;
  return promise.then(function () { return child; });
}

function bubble() {
  runloop.addFragment(this.instance.fragment);
}

function findNextNode() {
  if (this.anchor) { return this.anchor.findNextNode(); }
}

function compute(path, computed) {
  this.computed[path] = computed;
  if (isString(computed) || isFunction(computed))
    { computed = this.computed[path] = { get: computed }; }

  var keys = splitKeypath(path);
  if (!~path.indexOf('*')) {
    var last = keys.pop();
    return this.viewmodel.joinAll(keys).compute(last, computed);
  } else {
    computed.pattern = new RegExp(
      '^' +
        keys
          .map(function (k) { return k.replace(/\*\*/g, '(.+)').replace(/\*/g, '((?:\\\\.|[^\\.])+)'); })
          .join('\\.') +
        '$'
    );
  }
}

function Ractive$compute(path, computed) {
  var promise = runloop.start();
  var comp = compute.call(this, path, computed);

  if (comp) {
    var keys = splitKeypath(path);
    if (keys.length === 1 && !comp.isReadonly) {
      comp.set(this.viewmodel.value[keys[0]]);
    }

    var first = keys.reduce(function (a, c) { return a && a.childByKey[c]; }, this.viewmodel);
    if (first) {
      first.rebind(comp, first, false);
      if (first.parent) { delete first.parent.childByKey[first.key]; }
      fireShuffleTasks();
    }
  }

  runloop.end();

  return promise;
}

function Ractive$detach() {
  if (this.isDetached) {
    return this.el;
  }

  if (this.el) {
    removeFromArray(this.el.__ractive_instances__, this);
  }

  this.el = this.fragment.detach();
  this.isDetached = true;

  hooks.detach.fire(this);
  return this.el;
}

function detachChild(child) {
  var children = this._children;
  var meta, index;

  var i = children.length;
  while (i--) {
    if (children[i].instance === child) {
      index = i;
      meta = children[i];
      break;
    }
  }

  if (!meta || child.parent !== this)
    { throw new Error(("Instance " + (child._guid) + " is not attached to this instance.")); }

  var promise = runloop.start();

  if (meta.anchor) { meta.anchor.removeChild(meta); }
  if (!child.isolated) { child.viewmodel.detached(); }

  children.splice(index, 1);
  if (meta.target) {
    this.splice(
      ("@this.children.byName." + (meta.target)),
      children.byName[meta.target].indexOf(meta),
      1
    );
    updateAnchors(this, meta.target);
  }
  var rm = child.viewmodel.getRactiveModel();
  rm.joinKey('parent', { lastLink: false }).unlink();
  rm.joinKey('root', { lastLink: false }).link(rm);
  child.root = child;
  child.parent = null;
  child.component = null;

  hooks.detachchild.fire(child);

  runloop.end();

  promise.ractive = child;
  return promise.then(function () { return child; });
}

function Ractive$find(selector, options) {
  var this$1 = this;
  if ( options === void 0 ) options = {};

  if (!this.rendered)
    { throw new Error(
      ("Cannot call ractive.find('" + selector + "') unless instance is rendered to the DOM")
    ); }

  var node = this.fragment.find(selector, options);
  if (node) { return node; }

  if (options.remote) {
    for (var i = 0; i < this._children.length; i++) {
      if (!this$1._children[i].instance.fragment.rendered) { continue; }
      node = this$1._children[i].instance.find(selector, options);
      if (node) { return node; }
    }
  }
}

function Ractive$findAll(selector, options) {
  if ( options === void 0 ) options = {};

  if (!this.rendered)
    { throw new Error(
      ("Cannot call ractive.findAll('" + selector + "', ...) unless instance is rendered to the DOM")
    ); }

  if (!isArray(options.result)) { options.result = []; }

  this.fragment.findAll(selector, options);

  if (options.remote) {
    // seach non-fragment children
    this._children.forEach(function (c) {
      if (!c.target && c.instance.fragment && c.instance.fragment.rendered) {
        c.instance.findAll(selector, options);
      }
    });
  }

  return options.result;
}

function Ractive$findAllComponents(selector, options) {
  if (!options && isObjectType(selector)) {
    options = selector;
    selector = '';
  }

  options = options || {};

  if (!isArray(options.result)) { options.result = []; }

  this.fragment.findAllComponents(selector, options);

  if (options.remote) {
    // search non-fragment children
    this._children.forEach(function (c) {
      if (!c.target && c.instance.fragment && c.instance.fragment.rendered) {
        if (!selector || c.name === selector) {
          options.result.push(c.instance);
        }

        c.instance.findAllComponents(selector, options);
      }
    });
  }

  return options.result;
}

function Ractive$findComponent(selector, options) {
  var this$1 = this;
  if ( options === void 0 ) options = {};

  if (isObjectType(selector)) {
    options = selector;
    selector = '';
  }

  var child = this.fragment.findComponent(selector, options);
  if (child) { return child; }

  if (options.remote) {
    if (!selector && this._children.length) { return this._children[0].instance; }
    for (var i = 0; i < this._children.length; i++) {
      // skip children that are or should be in an anchor
      if (this$1._children[i].target) { continue; }
      if (this$1._children[i].name === selector) { return this$1._children[i].instance; }
      child = this$1._children[i].instance.findComponent(selector, options);
      if (child) { return child; }
    }
  }
}

function Ractive$findContainer(selector) {
  if (this.container) {
    if (this.container.component && this.container.component.name === selector) {
      return this.container;
    } else {
      return this.container.findContainer(selector);
    }
  }

  return null;
}

function Ractive$findParent(selector) {
  if (this.parent) {
    if (this.parent.component && this.parent.component.name === selector) {
      return this.parent;
    } else {
      return this.parent.findParent(selector);
    }
  }

  return null;
}

function findElement(start, orComponent, name) {
  if ( orComponent === void 0 ) orComponent = true;

  while (
    start &&
    (start.type !== ELEMENT || (name && start.name !== name)) &&
    (!orComponent || (start.type !== COMPONENT && start.type !== ANCHOR))
  ) {
    // start is a fragment - look at the owner
    if (start.owner) { start = start.owner; }
    else if (start.component || start.yield)
      // start is a component or yielder - look at the container
      { start = start.containerFragment || start.component.up; }
    else if (start.parent)
      // start is an item - look at the parent
      { start = start.parent; }
    else if (start.up)
      // start is an item without a parent - look at the parent fragment
      { start = start.up; }
    else { start = undefined; }
  }

  return start;
}

// This function takes an array, the name of a mutator method, and the
// arguments to call that mutator method with, and returns an array that
// maps the old indices to their new indices.

// So if you had something like this...
//
//     array = [ 'a', 'b', 'c', 'd' ];
//     array.push( 'e' );
//
// ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices
// have changed. If you then did this...
//
//     array.unshift( 'z' );
//
// ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved
// one higher to make room for the 'z'. If you removed an item, the new index
// would be -1...
//
//     array.splice( 2, 2 );
//
// ...this would result in [ 0, 1, -1, -1, 2, 3 ].
//
// This information is used to enable fast, non-destructive shuffling of list
// sections when you do e.g. `ractive.splice( 'items', 2, 2 );

function getNewIndices(length, methodName, args) {
  var newIndices = [];

  var spliceArguments = getSpliceEquivalent(length, methodName, args);

  if (!spliceArguments) {
    return null; // TODO support reverse and sort?
  }

  var balance = spliceArguments.length - 2 - spliceArguments[1];

  var removeStart = Math.min(length, spliceArguments[0]);
  var removeEnd = removeStart + spliceArguments[1];
  newIndices.startIndex = removeStart;

  var i;
  for (i = 0; i < removeStart; i += 1) {
    newIndices.push(i);
  }

  for (; i < removeEnd; i += 1) {
    newIndices.push(-1);
  }

  for (; i < length; i += 1) {
    newIndices.push(i + balance);
  }

  // there is a net shift for the rest of the array starting with index + balance
  if (balance !== 0) {
    newIndices.touchedFrom = spliceArguments[0];
  } else {
    newIndices.touchedFrom = length;
  }

  return newIndices;
}

// The pop, push, shift an unshift methods can all be represented
// as an equivalent splice
function getSpliceEquivalent(length, methodName, args) {
  switch (methodName) {
    case 'splice':
      if (args[0] !== undefined && args[0] < 0) {
        args[0] = length + Math.max(args[0], -length);
      }

      if (isUndefined(args[0])) { args[0] = 0; }

      while (args.length < 2) {
        args.push(length - args[0]);
      }

      if (!isNumber(args[1])) {
        args[1] = length - args[0];
      }

      // ensure we only remove elements that exist
      args[1] = Math.min(args[1], length - args[0]);

      return args;

    case 'sort':
    case 'reverse':
      return null;

    case 'pop':
      if (length) {
        return [length - 1, 1];
      }
      return [0, 0];

    case 'push':
      return [length, 0].concat(args);

    case 'shift':
      return [0, length ? 1 : 0];

    case 'unshift':
      return [0, 0].concat(args);
  }
}

var arrayProto = Array.prototype;

function makeArrayMethod(methodName) {
  function path(keypath) {
    var args = [], len = arguments.length - 1;
    while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];

    return model(this.viewmodel.joinAll(splitKeypath(keypath)), args);
  }

  function model(mdl, args) {
    var array = mdl.get();

    if (!isArray(array)) {
      if (isUndefined(array)) {
        array = [];
        var result$1 = arrayProto[methodName].apply(array, args);
        var promise$1 = runloop.start().then(function () { return result$1; });
        mdl.set(array);
        runloop.end();
        return promise$1;
      } else {
        throw new Error(
          ("shuffle array method " + methodName + " called on non-array at " + (mdl.getKeypath()))
        );
      }
    }

    var newIndices = getNewIndices(array.length, methodName, args);
    var result = arrayProto[methodName].apply(array, args);

    var promise = runloop.start().then(function () { return result; });
    promise.result = result;

    if (newIndices) {
      if (mdl.shuffle) {
        mdl.shuffle(newIndices);
      } else {
        // it's a computation, which don't have a shuffle, so just invalidate
        mdl.mark();
      }
    } else {
      mdl.set(result);
    }

    runloop.end();

    return promise;
  }

  return { path: path, model: model };
}

function update$1(ractive, model, options) {
  // if the parent is wrapped, the adaptor will need to be updated before
  // updating on this keypath
  if (model.parent && model.parent.wrapper) {
    model.parent.adapt();
  }

  var promise = runloop.start();

  model.mark(options && options.force);

  // notify upstream of changes
  model.notifyUpstream();

  runloop.end();

  hooks.update.fire(ractive, model);

  return promise;
}

function Ractive$update(keypath, options) {
  var opts, path;

  if (isString(keypath)) {
    path = splitKeypath(keypath);
    opts = options;
  } else {
    opts = keypath;
  }

  return update$1(this, path ? this.viewmodel.joinAll(path) : this.viewmodel, opts);
}

var modelPush = makeArrayMethod('push').model;
var modelPop = makeArrayMethod('pop').model;
var modelShift = makeArrayMethod('shift').model;
var modelUnshift = makeArrayMethod('unshift').model;
var modelSort = makeArrayMethod('sort').model;
var modelSplice = makeArrayMethod('splice').model;
var modelReverse = makeArrayMethod('reverse').model;

var ContextData = (function (Model) {
  function ContextData(options) {
    Model.call(this, null, null);

    this.isRoot = true;
    this.root = this;
    this.value = {};
    this.ractive = options.ractive;
    this.adaptors = [];
    this.context = options.context;
  }

  if ( Model ) ContextData.__proto__ = Model;
  var ContextData__proto__ = ContextData.prototype = Object.create( Model && Model.prototype );
  ContextData__proto__.constructor = ContextData;

  ContextData__proto__.getKeypath = function getKeypath () {
    return '@context.data';
  };

  ContextData__proto__.rebound = function rebound () {};

  return ContextData;
}(Model));

var Context = function Context(fragment, element) {
  this.fragment = fragment;
  this.element = element || findElement(fragment);
  this.node = this.element && this.element.node;
  this.ractive = fragment.ractive;
  this.root = this;
};
var Context__proto__ = Context.prototype;

var prototypeAccessors = { decorators: {},_data: {} };

prototypeAccessors.decorators.get = function () {
  var items = {};
  if (!this.element) { return items; }
  this.element.decorators.forEach(function (d) { return (items[d.name] = d.handle); });
  return items;
};

prototypeAccessors._data.get = function () {
  return (
    this.model ||
    (this.root.model = new ContextData({
      ractive: this.ractive,
      context: this.root
    }))
  );
};

// the usual mutation suspects
Context__proto__.add = function add (keypath, d, options) {
  var num = isNumber(d) ? +d : 1;
  var opts = isObjectType(d) ? d : options;
  return set(
    build$1(this, keypath, num).map(function (pair) {
      var model = pair[0];
        var val = pair[1];
      var value = model.get();
      if (!isNumeric(val) || !isNumeric(value)) { throw new Error('Cannot add non-numeric value'); }
      return [model, value + val];
    }),
    opts
  );
};

Context__proto__.animate = function animate$1 (keypath, value, options) {
  var model = findModel(this, keypath).model;
  return animate(this.ractive, model, value, options);
};

Context__proto__.find = function find (selector) {
  return this.fragment.find(selector);
};

Context__proto__.findAll = function findAll (selector) {
  var result = [];
  this.fragment.findAll(selector, { result: result });
  return result;
};

Context__proto__.findAllComponents = function findAllComponents (selector) {
  var result = [];
  this.fragment.findAllComponents(selector, { result: result });
  return result;
};

Context__proto__.findComponent = function findComponent (selector) {
  return this.fragment.findComponent(selector);
};

// get relative keypaths and values
Context__proto__.get = function get (keypath) {
  if (!keypath) { return this.fragment.findContext().get(true); }

  var ref = findModel(this, keypath);
    var model = ref.model;

  return model ? model.get(true) : undefined;
};

Context__proto__.getParent = function getParent (component) {
  var fragment = this.fragment;

  if (!fragment.parent && component) { fragment = fragment.componentParent; }
  else {
    if (fragment.context) { fragment = findParentWithContext(fragment.parent); }
    else {
      fragment = findParentWithContext(fragment.parent);
      if (fragment) {
        if (!fragment.parent && component) { fragment = fragment.componentParent; }
        else { fragment = findParentWithContext(fragment.parent); }
      }
    }
  }

  if (!fragment || fragment === this.fragment) { return; }
  else { return fragment.getContext(); }
};

Context__proto__.hasListener = function hasListener (name, bubble) {
  // if the owner is a component, start there because the nearest element
  // may exist outside of the immediate context (yield)
  var el = this.fragment.owner.component
    ? this.fragment.owner
    : this.element || this.fragment.owner;
  var base;

  do {
    base = el.component || el;
    if (base.template.t === ELEMENT) {
      if (findEvent(base, name)) { return true; }
    }
    el = el.up && el.up.owner;
    if (el && el.component) { el = el.component; }
  } while (el && bubble);
};

Context__proto__.link = function link (source, dest) {
  var there = findModel(this, source).model;
  var here = findModel(this, dest).model;
  var promise = runloop.start();
  here.link(there, source);
  runloop.end();
  return promise;
};

Context__proto__.listen = function listen (event, handler) {
  var el = this.element;
  el.on(event, handler);
  return {
    cancel: function cancel() {
      el.off(event, handler);
    }
  };
};

Context__proto__.observe = function observe (keypath, callback, options) {
    if ( options === void 0 ) options = {};

  if (isObject(keypath)) { options = callback || {}; }
  options.fragment = this.fragment;
  return this.ractive.observe(keypath, callback, options);
};

Context__proto__.observeOnce = function observeOnce (keypath, callback, options) {
    if ( options === void 0 ) options = {};

  if (isObject(keypath)) { options = callback || {}; }
  options.fragment = this.fragment;
  return this.ractive.observeOnce(keypath, callback, options);
};

Context__proto__.pop = function pop (keypath) {
  return modelPop(findModel(this, keypath).model, []);
};

Context__proto__.push = function push (keypath) {
    var values = [], len = arguments.length - 1;
    while ( len-- > 0 ) values[ len ] = arguments[ len + 1 ];

  return modelPush(findModel(this, keypath).model, values);
};

Context__proto__.raise = function raise (name, event) {
    var args = [], len = arguments.length - 2;
    while ( len-- > 0 ) args[ len ] = arguments[ len + 2 ];

  var el = this.element;
  var ev;

  while (el) {
    if (el.component) { el = el.component; }
    ev = findEvent(el, name);
    if (ev) {
      return ev.fire(
        ev.element.getContext(
          event || {},
          event && !('original' in event) ? { original: {} } : {}
        ),
        args
      );
    }

    el = el.up && el.up.owner;
  }
};

Context__proto__.readLink = function readLink (keypath, options) {
  return this.ractive.readLink(this.resolve(keypath), options);
};

Context__proto__.resolve = function resolve (path, ractive) {
  var ref = findModel(this, path);
    var model = ref.model;
    var instance = ref.instance;
  return model ? model.getKeypath(ractive || instance) : path;
};

Context__proto__.reverse = function reverse (keypath) {
  return modelReverse(findModel(this, keypath).model, []);
};

Context__proto__.set = function set$2 (keypath, value, options) {
  return set(build$1(this, keypath, value), options);
};

Context__proto__.shift = function shift (keypath) {
  return modelShift(findModel(this, keypath).model, []);
};

Context__proto__.splice = function splice (keypath, index, drop) {
    var add = [], len = arguments.length - 3;
    while ( len-- > 0 ) add[ len ] = arguments[ len + 3 ];

  add.unshift(index, drop);
  return modelSplice(findModel(this, keypath).model, add);
};

Context__proto__.sort = function sort (keypath) {
  return modelSort(findModel(this, keypath).model, []);
};

Context__proto__.subtract = function subtract (keypath, d, options) {
  var num = isNumber(d) ? d : 1;
  var opts = isObjectType(d) ? d : options;
  return set(
    build$1(this, keypath, num).map(function (pair) {
      var model = pair[0];
        var val = pair[1];
      var value = model.get();
      if (!isNumeric(val) || !isNumeric(value)) { throw new Error('Cannot add non-numeric value'); }
      return [model, value - val];
    }),
    opts
  );
};

Context__proto__.toggle = function toggle (keypath, options) {
  var ref = findModel(this, keypath);
    var model = ref.model;
  return set([[model, !model.get()]], options);
};

Context__proto__.unlink = function unlink (dest) {
  var here = findModel(this, dest).model;
  var promise = runloop.start();
  if (here.owner && here.owner._link) { here.owner.unlink(); }
  runloop.end();
  return promise;
};

Context__proto__.unlisten = function unlisten (event, handler) {
  this.element.off(event, handler);
};

Context__proto__.unshift = function unshift (keypath) {
    var add = [], len = arguments.length - 1;
    while ( len-- > 0 ) add[ len ] = arguments[ len + 1 ];

  return modelUnshift(findModel(this, keypath).model, add);
};

Context__proto__.update = function update (keypath, options) {
  return update$1(this.ractive, findModel(this, keypath).model, options);
};

Context__proto__.updateModel = function updateModel (keypath, cascade) {
  var ref = findModel(this, keypath);
    var model = ref.model;
  var promise = runloop.start();
  model.updateFromBindings(cascade);
  runloop.end();
  return promise;
};

// two-way binding related helpers
Context__proto__.isBound = function isBound () {
  var ref = this.getBindingModel(this);
    var model = ref.model;
  return !!model;
};

Context__proto__.getBindingPath = function getBindingPath (ractive) {
  var ref = this.getBindingModel(this);
    var model = ref.model;
    var instance = ref.instance;
  if (model) { return model.getKeypath(ractive || instance); }
};

Context__proto__.getBinding = function getBinding () {
  var ref = this.getBindingModel(this);
    var model = ref.model;
  if (model) { return model.get(true); }
};

Context__proto__.getBindingModel = function getBindingModel (ctx) {
  var el = ctx.element;
  return { model: el.binding && el.binding.model, instance: el.up.ractive };
};

Context__proto__.setBinding = function setBinding (value) {
  var ref = this.getBindingModel(this);
    var model = ref.model;
  return set([[model, value]]);
};

Object.defineProperties( Context__proto__, prototypeAccessors );

Context.forRactive = getRactiveContext;
// circular deps are fun
extern.Context = Context;

// TODO: at some point perhaps this could support relative * keypaths?
function build$1(ctx, keypath, value) {
  var sets = [];

  // set multiple keypaths in one go
  if (isObject(keypath)) {
    for (var k in keypath) {
      if (hasOwn(keypath, k)) {
        sets.push([findModel(ctx, k).model, keypath[k]]);
      }
    }
  } else {
    // set a single keypath
    sets.push([findModel(ctx, keypath).model, value]);
  }

  return sets;
}

function findModel(ctx, path) {
  var frag = ctx.fragment;

  if (!isString(path)) {
    return { model: frag.findContext(), instance: path };
  }

  return { model: resolveReference(frag, path), instance: frag.ractive };
}

function findEvent(el, name) {
  return el.events && el.events.find && el.events.find(function (e) { return ~e.template.n.indexOf(name); });
}

function Ractive$fire(eventName) {
  var args = [], len = arguments.length - 1;
  while ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];

  var ctx;

  // watch for reproxy
  if (args[0] instanceof Context) {
    var proto = args.shift();
    ctx = create(proto);
    assign(ctx, proto);
  } else if (isObjectType(args[0]) && (args[0] === null || args[0].constructor === Object)) {
    ctx = Context.forRactive(this, args.shift());
  } else {
    ctx = Context.forRactive(this);
  }

  return fireEvent(this, eventName, ctx, args);
}

function Ractive$get(keypath, opts) {
  if (!isString(keypath)) { return this.viewmodel.get(true, keypath); }

  var keys = splitKeypath(keypath);
  var key = keys[0];

  var model;

  if (!this.viewmodel.has(key)) {
    // if this is an inline component, we may need to create
    // an implicit mapping
    if (this.component && !this.isolated) {
      model = resolveReference(this.fragment || new FakeFragment(this), key);
    }
  }

  model = this.viewmodel.joinAll(keys);
  return model.get(true, opts);
}

var query = doc && doc.querySelector;

function getContext$1(node) {
  if (isString(node) && query) {
    node = query.call(document, node);
  }

  var instances;
  if (node) {
    if (node._ractive) {
      return node._ractive.proxy.getContext();
    } else if ((instances = node.__ractive_instances__)) {
      if (instances.length === 1) { return getRactiveContext(instances[0]); }
    } else { return getContext$1(node.parentNode); }
  }
}

function getContext$2(node, options) {
  if (!node) { return getRactiveContext(this); }

  if (isString(node)) {
    node = this.find(node, options);
  }

  return getContext$1(node);
}

var html = 'http://www.w3.org/1999/xhtml';
var mathml = 'http://www.w3.org/1998/Math/MathML';
var svg$1 = 'http://www.w3.org/2000/svg';
var xlink = 'http://www.w3.org/1999/xlink';
var xml = 'http://www.w3.org/XML/1998/namespace';
var xmlns = 'http://www.w3.org/2000/xmlns';

var namespaces = { html: html, mathml: mathml, svg: svg$1, xlink: xlink, xml: xml, xmlns: xmlns };

var createElement;
var matches;
var div;
var methodNames;
var unprefixed;
var prefixed;
var i;
var j;
var makeFunction;

// Test for SVG support
if (!svg) {
  /* istanbul ignore next */
  createElement = function (type, ns, extend) {
    if (ns && ns !== html) {
      throw "This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you're trying to render SVG in an older browser. See http://ractive.js.org/support/#svgs for more information";
    }

    return extend ? doc.createElement(type, extend) : doc.createElement(type);
  };
} else {
  createElement = function (type, ns, extend) {
    if (!ns || ns === html) {
      return extend ? doc.createElement(type, extend) : doc.createElement(type);
    }

    return extend ? doc.createElementNS(ns, type, extend) : doc.createElementNS(ns, type);
  };
}

function createDocumentFragment() {
  return doc.createDocumentFragment();
}

function getElement(input) {
  var output;

  if (!input || typeof input === 'boolean') {
    return;
  }

  /* istanbul ignore next */
  if (!win || !doc || !input) {
    return null;
  }

  // We already have a DOM node - no work to do. (Duck typing alert!)
  if (input.nodeType) {
    return input;
  }

  // Get node from string
  if (isString(input)) {
    // try ID first
    output = doc.getElementById(input);

    // then as selector, if possible
    if (!output && doc.querySelector) {
      try {
        output = doc.querySelector(input);
      } catch (e) {
        /* this space intentionally left blank */
      }
    }

    // did it work?
    if (output && output.nodeType) {
      return output;
    }
  }

  // If we've been given a collection (jQuery, Zepto etc), extract the first item
  if (input[0] && input[0].nodeType) {
    return input[0];
  }

  return null;
}

if (!isClient) {
  matches = null;
} else {
  div = createElement('div');
  methodNames = ['matches', 'matchesSelector'];

  makeFunction = function(methodName) {
    return function(node, selector) {
      return node[methodName](selector);
    };
  };

  i = methodNames.length;

  while (i-- && !matches) {
    unprefixed = methodNames[i];

    if (div[unprefixed]) {
      matches = makeFunction(unprefixed);
    } else {
      j = vendors.length;
      while (j--) {
        prefixed = vendors[i] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);

        if (div[prefixed]) {
          matches = makeFunction(prefixed);
          break;
        }
      }
    }
  }

  // IE8... and apparently phantom some?
  /* istanbul ignore next */
  if (!matches) {
    matches = function(node, selector) {
      var parentNode, i;

      parentNode = node.parentNode;

      if (!parentNode) {
        // empty dummy <div>
        div.innerHTML = '';

        parentNode = div;
        node = node.cloneNode();

        div.appendChild(node);
      }

      var nodes = parentNode.querySelectorAll(selector);

      i = nodes.length;
      while (i--) {
        if (nodes[i] === node) {
          return true;
        }
      }

      return false;
    };
  }
}

function detachNode(node) {
  // stupid ie
  // eslint-disable-next-line valid-typeof
  if (node && typeof node.parentNode !== 'unknown' && node.parentNode) {
    node.parentNode.removeChild(node);
  }

  return node;
}

function safeToStringValue(value) {
  return value == null || (isNumber(value) && isNaN(value)) || !value.toString ? '' : '' + value;
}

function safeAttributeString(string) {
  return safeToStringValue(string)
    .replace(/&/g, '&amp;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}

function Ractive$insert(target, anchor) {
  if (!this.fragment.rendered) {
    // TODO create, and link to, documentation explaining this
    throw new Error(
      'The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.'
    );
  }

  target = getElement(target);
  anchor = getElement(anchor) || null;

  if (!target) {
    throw new Error('You must specify a valid target to insert into');
  }

  target.insertBefore(this.detach(), anchor);
  this.el = target;

  (target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);
  this.isDetached = false;

  fireInsertHook(this);
}

function fireInsertHook(ractive) {
  hooks.insert.fire(ractive);

  ractive.findAllComponents('*').forEach(function (child) {
    fireInsertHook(child.instance);
  });
}

function link(there, here, options) {
  var model;
  var target = (options && (options.ractive || options.instance)) || this;

  // may need to allow a mapping to resolve implicitly
  var sourcePath = splitKeypath(there);
  if (!target.viewmodel.has(sourcePath[0]) && target.component) {
    model = resolveReference(target.component.up, sourcePath[0]);
    model = model.joinAll(sourcePath.slice(1));
  }

  var src = model || target.viewmodel.joinAll(sourcePath);
  var dest = this.viewmodel.joinAll(splitKeypath(here), { lastLink: false });

  if (isUpstream(src, dest) || isUpstream(dest, src)) {
    throw new Error('A keypath cannot be linked to itself.');
  }

  var promise = runloop.start();

  dest.link(src, (options && options.keypath) || there);

  runloop.end();

  return promise;
}

function isUpstream(check, start) {
  var model = start;
  while (model) {
    if (model === check || model.owner === check) { return true; }
    model = model.target || model.parent;
  }
}

var Observer = function Observer(ractive, model, callback, options) {
  this.context = options.context || ractive;
  this.callback = callback;
  this.ractive = ractive;
  this.keypath = options.keypath;
  this.options = options;

  if (model) { this.resolved(model); }

  if (isFunction(options.old)) {
    this.oldContext = create(ractive);
    this.oldFn = options.old;
  }

  if (options.init !== false) {
    this.dirty = true;
    this.dispatch();
  } else {
    updateOld(this);
  }

  this.dirty = false;
};
var Observer__proto__ = Observer.prototype;

Observer__proto__.cancel = function cancel () {
  this.cancelled = true;
  if (this.model) {
    this.model.unregister(this);
  } else {
    this.resolver.unbind();
  }
  removeFromArray(this.ractive._observers, this);
};

Observer__proto__.dispatch = function dispatch () {
  if (!this.cancelled) {
    try {
      this.callback.call(this.context, this.newValue, this.oldValue, this.keypath);
    } catch (err) {
      warnIfDebug(
        ("Failed to execute observer callback for '" + (this.keypath) + "': " + (err.message || err))
      );
    }
    updateOld(this, true);
    this.dirty = false;
  }
};

Observer__proto__.handleChange = function handleChange () {
    var this$1 = this;

  if (!this.dirty) {
    var newValue = this.model.get();
    if (isEqual(newValue, this.oldValue)) { return; }

    this.newValue = newValue;

    if (this.options.strict && this.newValue === this.oldValue) { return; }

    runloop.addObserver(this, this.options.defer);
    this.dirty = true;

    if (this.options.once) { runloop.scheduleTask(function () { return this$1.cancel(); }); }
  } else {
    // make sure the newValue stays updated in case this observer gets touched multiple times in one loop
    this.newValue = this.model.get();
  }
};

Observer__proto__.rebind = function rebind (next, previous) {
    var this$1 = this;

  next = rebindMatch(this.keypath, next, previous);
  if (next === this.model) { return false; }

  if (this.model) { this.model.unregister(this); }
  if (next) { next.addShuffleTask(function () { return this$1.resolved(next); }); }
};

Observer__proto__.resolved = function resolved (model) {
  this.model = model;

  this.oldValue = undefined;
  this.newValue = model.get();

  model.register(this);
};

function updateOld(observer, fresh) {
  var next = fresh
    ? observer.model
      ? observer.model.get()
      : observer.newValue
    : observer.newValue;
  try {
    observer.oldValue = observer.oldFn
      ? observer.oldFn.call(observer.oldContext, undefined, next, observer.keypath)
      : next;
  } catch (err) {
    warnIfDebug(
      ("Failed to execute observer oldValue callback for '" + (this.keypath) + "': " + (err.message || err))
    );
    observer.oldValue = next;
  }
}

function joinKeys() {
  var keys = [], len = arguments.length;
  while ( len-- ) keys[ len ] = arguments[ len ];

  return keys.map(escapeKey).join('.');
}

function splitKeypath$1(keypath) {
  return splitKeypath(keypath).map(unescapeKey);
}

var star$1 = /\*+/g;

var PatternObserver = function PatternObserver(ractive, baseModel, keys$$1, callback, options) {
  var this$1 = this;

  this.context = options.context || ractive;
  this.ractive = ractive;
  this.baseModel = baseModel;
  this.keys = keys$$1;
  this.callback = callback;

  var pattern = keys$$1.join('\\.').replace(star$1, '(.+)');
  var baseKeypath = (this.baseKeypath = baseModel.getKeypath(ractive));
  this.pattern = new RegExp(("^" + (baseKeypath ? baseKeypath + '\\.' : '') + pattern + "$"));
  this.recursive = keys$$1.length === 1 && keys$$1[0] === '**';
  if (this.recursive) { this.keys = ['*']; }
  if (options.old) {
    this.oldContext = create(ractive);
    this.oldFn = options.old;
  }

  this.oldValues = {};
  this.newValues = {};

  this.defer = options.defer;
  this.once = options.once;
  this.strict = options.strict;

  this.dirty = false;
  this.changed = [];
  this.cache = [];
  this.partial = false;
  this.links = options.links;

  var models = baseModel.findMatches(this.keys);

  models.forEach(function (model) {
    this$1.newValues[model.getKeypath(this$1.ractive)] = model.get();
  });

  if (options.init !== false) {
    this.dispatch();
  } else {
    updateOld$1(this, this.newValues);
  }

  baseModel.registerPatternObserver(this);
};
var PatternObserver__proto__ = PatternObserver.prototype;

PatternObserver__proto__.cancel = function cancel () {
  this.baseModel.unregisterPatternObserver(this);
  removeFromArray(this.ractive._observers, this);
};

PatternObserver__proto__.dispatch = function dispatch () {
    var this$1 = this;

  var newValues = this.newValues;
  this.newValues = {};
  keys(newValues).forEach(function (keypath) {
    var newValue = newValues[keypath];
    var oldValue = this$1.oldValues[keypath];

    if (this$1.strict && newValue === oldValue) { return; }
    if (isEqual(newValue, oldValue)) { return; }

    var args = [newValue, oldValue, keypath];
    if (keypath) {
      var wildcards = this$1.pattern.exec(keypath);
      if (wildcards) {
        args = args.concat(wildcards.slice(1));
      }
    }

    try {
      this$1.callback.apply(this$1.context, args);
    } catch (err) {
      warnIfDebug(
        ("Failed to execute pattern observer callback for '" + (this$1.keypath) + "': " + (err.message || err))
      );
    }
  });

  updateOld$1(this, newValues, this.partial);

  this.dirty = false;
};

PatternObserver__proto__.notify = function notify (keys$$1) {
  var path = joinKeys(keys$$1);
  if (!~this.cache.indexOf(path)) {
    this.cache.push(path);
    this.changed.push(keys$$1);
  }
};

PatternObserver__proto__.shuffle = function shuffle (newIndices) {
    var this$1 = this;

  if (!isArray(this.baseModel.value)) { return; }

  var max = this.baseModel.value.length;

  for (var i = 0; i < newIndices.length; i++) {
    if (newIndices[i] === -1 || newIndices[i] === i) { continue; }
    this$1.changed.push([i]);
  }

  for (var i$1 = newIndices.touchedFrom; i$1 < max; i$1++) {
    this$1.changed.push([i$1]);
  }
};

PatternObserver__proto__.handleChange = function handleChange () {
    var this$1 = this;

  if (!this.dirty || this.changed.length) {
    if (!this.dirty) { this.newValues = {}; }

    if (!this.changed.length) {
      this.baseModel.findMatches(this.keys).forEach(function (model) {
        var keypath = model.getKeypath(this$1.ractive);
        this$1.newValues[keypath] = model.get();
      });
      this.partial = false;
    } else {
      var count = 0;

      if (this.recursive) {
        var changed = this.changed.slice();
        this.changed.length = 0;
        this.dirty = true;
        changed.forEach(function (keys$$1) {
          var model = this$1.baseModel.joinAll(keys$$1);
          if (model.isLink && !this$1.links) { return; }
          count++;
          this$1.newValues[model.getKeypath(this$1.ractive)] = model.get();
        });
        this.dirty = false;
      } else {
        var ok = this.baseModel.isRoot
          ? this.changed.map(function (keys$$1) { return keys$$1.map(escapeKey).join('.'); })
          : this.changed.map(function (keys$$1) { return this$1.baseKeypath + '.' + keys$$1.map(escapeKey).join('.'); });

        this.baseModel.findMatches(this.keys).forEach(function (model) {
          var keypath = model.getKeypath(this$1.ractive);
          var check = function (k) {
            return (
              (k.indexOf(keypath) === 0 &&
                (k.length === keypath.length || k[keypath.length] === '.')) ||
              (keypath.indexOf(k) === 0 &&
                (k.length === keypath.length || keypath[k.length] === '.'))
            );
          };

          // is this model on a changed keypath?
          if (ok.filter(check).length) {
            count++;
            this$1.newValues[keypath] = model.get();
          }
        });
      }

      // no valid change triggered, so bail to avoid breakage
      if (!count) { return; }

      this.partial = true;
    }

    runloop.addObserver(this, this.defer);
    this.dirty = true;
    this.changed.length = 0;
    this.cache = [];

    if (this.once) { this.cancel(); }
  }
};

function updateOld$1(observer, vals, partial) {
  var olds = observer.oldValues;

  if (observer.oldFn) {
    if (!partial) { observer.oldValues = {}; }

    keys(vals).forEach(function (k) {
      var args = [olds[k], vals[k], k];
      var parts = observer.pattern.exec(k);
      if (parts) {
        args.push.apply(args, parts.slice(1));
      }
      observer.oldValues[k] = observer.oldFn.apply(observer.oldContext, args);
    });
  } else {
    if (partial) {
      keys(vals).forEach(function (k) { return (olds[k] = vals[k]); });
    } else {
      observer.oldValues = vals;
    }
  }
}

function negativeOne() {
  return -1;
}

var ArrayObserver = function ArrayObserver(ractive, model, callback, options) {
  this.ractive = ractive;
  this.model = model;
  this.keypath = model.getKeypath();
  this.callback = callback;
  this.options = options;

  this.pending = null;

  model.register(this);

  if (options.init !== false) {
    this.sliced = [];
    this.shuffle([]);
    this.dispatch();
  } else {
    this.sliced = this.slice();
  }
};
var ArrayObserver__proto__ = ArrayObserver.prototype;

ArrayObserver__proto__.cancel = function cancel () {
  this.model.unregister(this);
  removeFromArray(this.ractive._observers, this);
};

ArrayObserver__proto__.dispatch = function dispatch () {
  try {
    this.callback(this.pending);
  } catch (err) {
    warnIfDebug(
      ("Failed to execute array observer callback for '" + (this.keypath) + "': " + (err.message || err))
    );
  }
  this.pending = null;
  if (this.options.once) { this.cancel(); }
};

ArrayObserver__proto__.handleChange = function handleChange (path) {
  if (this.pending) {
    // post-shuffle
    runloop.addObserver(this, this.options.defer);
  } else if (!path) {
    // entire array changed
    this.shuffle(this.sliced.map(negativeOne));
    this.handleChange();
  }
};

ArrayObserver__proto__.shuffle = function shuffle (newIndices) {
    var this$1 = this;

  var newValue = this.slice();

  var inserted = [];
  var deleted = [];
  var start;

  var hadIndex = {};

  newIndices.forEach(function (newIndex, oldIndex) {
    hadIndex[newIndex] = true;

    if (newIndex !== oldIndex && isUndefined(start)) {
      start = oldIndex;
    }

    if (newIndex === -1) {
      deleted.push(this$1.sliced[oldIndex]);
    }
  });

  if (isUndefined(start)) { start = newIndices.length; }

  var len = newValue.length;
  for (var i = 0; i < len; i += 1) {
    if (!hadIndex[i]) { inserted.push(newValue[i]); }
  }

  this.pending = { inserted: inserted, deleted: deleted, start: start };
  this.sliced = newValue;
};

ArrayObserver__proto__.slice = function slice () {
  var value = this.model.get();
  return isArray(value) ? value.slice() : [];
};

function observe(keypath, callback, options) {
  var this$1 = this;

  var observers = [];
  var map;
  var opts;

  if (isObject(keypath)) {
    map = keypath;
    opts = callback || {};
  } else {
    if (isFunction(keypath)) {
      map = { '': keypath };
      opts = callback || {};
    } else {
      map = {};
      map[keypath] = callback;
      opts = options || {};
    }
  }

  var silent = false;
  keys(map).forEach(function (keypath) {
    var callback = map[keypath];
    var caller = function() {
      var args = [], len = arguments.length;
      while ( len-- ) args[ len ] = arguments[ len ];

      if (silent) { return; }
      return callback.apply(this, args);
    };

    var keypaths = keypath.split(' ');
    if (keypaths.length > 1) { keypaths = keypaths.filter(function (k) { return k; }); }

    keypaths.forEach(function (keypath) {
      opts.keypath = keypath;
      var observer = createObserver(this$1, keypath, caller, opts);
      if (observer) { observers.push(observer); }
    });
  });

  // add observers to the Ractive instance, so they can be
  // cancelled on ractive.teardown()
  this._observers.push.apply(this._observers, observers);

  return {
    cancel: function () { return observers.forEach(function (o) { return o.cancel(); }); },
    isSilenced: function () { return silent; },
    silence: function () { return (silent = true); },
    resume: function () { return (silent = false); }
  };
}

function createObserver(ractive, keypath, callback, options) {
  var keys$$1 = splitKeypath(keypath);
  var wildcardIndex = keys$$1.indexOf('*');
  if (!~wildcardIndex) { wildcardIndex = keys$$1.indexOf('**'); }

  options.fragment = options.fragment || ractive.fragment;

  var model;
  if (!options.fragment) {
    model = ractive.viewmodel.joinKey(keys$$1[0]);
  } else {
    // .*.whatever relative wildcard is a special case because splitkeypath doesn't handle the leading .
    if (~keys$$1[0].indexOf('.*')) {
      model = options.fragment.findContext();
      wildcardIndex = 0;
      keys$$1[0] = keys$$1[0].slice(1);
    } else {
      model =
        wildcardIndex === 0
          ? options.fragment.findContext()
          : resolveReference(options.fragment, keys$$1[0]);
    }
  }

  // the model may not exist key
  if (!model) { model = ractive.viewmodel.joinKey(keys$$1[0]); }

  if (!~wildcardIndex) {
    model = model.joinAll(keys$$1.slice(1));
    if (options.array) {
      return new ArrayObserver(ractive, model, callback, options);
    } else {
      return new Observer(ractive, model, callback, options);
    }
  } else {
    var double = keys$$1.indexOf('**');
    if (~double) {
      if (double + 1 !== keys$$1.length || ~keys$$1.indexOf('*')) {
        warnOnceIfDebug(
          "Recursive observers may only specify a single '**' at the end of the path."
        );
        return;
      }
    }

    model = model.joinAll(keys$$1.slice(1, wildcardIndex));

    return new PatternObserver(ractive, model, keys$$1.slice(wildcardIndex), callback, options);
  }
}

var onceOptions = { init: false, once: true };

function observeOnce(keypath, callback, options) {
  if (isObject(keypath) || isFunction(keypath)) {
    options = assign(callback || {}, onceOptions);
    return this.observe(keypath, options);
  }

  options = assign(options || {}, onceOptions);
  return this.observe(keypath, callback, options);
}

var trim = function (str) { return str.trim(); };

var notEmptyString = function (str) { return str !== ''; };

function Ractive$off(eventName, callback) {
  var this$1 = this;

  // if no event is specified, remove _all_ event listeners
  if (!eventName) {
    this._subs = {};
  } else {
    // Handle multiple space-separated event names
    var eventNames = eventName
      .split(' ')
      .map(trim)
      .filter(notEmptyString);

    eventNames.forEach(function (event) {
      var subs = this$1._subs[event];
      // if given a specific callback to remove, remove only it
      if (subs && callback) {
        var entry = subs.find(function (s) { return s.callback === callback; });
        if (entry) {
          removeFromArray(subs, entry);
          entry.off = true;

          if (event.indexOf('.')) { this$1._nsSubs--; }
        }
      } else if (subs) {
        // otherwise, remove all listeners for this event
        if (event.indexOf('.')) { this$1._nsSubs -= subs.length; }
        subs.length = 0;
      }
    });
  }

  return this;
}

function Ractive$on(eventName, callback) {
  var this$1 = this;

  // eventName may already be a map
  var map = isObjectType(eventName) ? eventName : {};
  // or it may be a string along with a callback
  if (isString(eventName)) { map[eventName] = callback; }

  var silent = false;
  var events = [];

  var loop = function ( k ) {
    var callback$1 = map[k];
    var caller = function() {
      var args = [], len = arguments.length;
      while ( len-- ) args[ len ] = arguments[ len ];

      if (!silent) { return callback$1.apply(this, args); }
    };
    var entry = {
      callback: callback$1,
      handler: caller
    };

    if (hasOwn(map, k)) {
      var names = k
        .split(' ')
        .map(trim)
        .filter(notEmptyString);
      names.forEach(function (n) {
        (this$1._subs[n] || (this$1._subs[n] = [])).push(entry);
        if (n.indexOf('.')) { this$1._nsSubs++; }
        events.push([n, entry]);
      });
    }
  };

  for (var k in map) loop( k );

  return {
    cancel: function () { return events.forEach(function (e) { return this$1.off(e[0], e[1].callback); }); },
    isSilenced: function () { return silent; },
    silence: function () { return (silent = true); },
    resume: function () { return (silent = false); }
  };
}

function Ractive$once(eventName, handler) {
  var listener = this.on(eventName, function() {
    handler.apply(this, arguments);
    listener.cancel();
  });

  // so we can still do listener.cancel() manually
  return listener;
}

var pop = makeArrayMethod('pop').path;

var push = makeArrayMethod('push').path;

function readLink(keypath, options) {
  if ( options === void 0 ) options = {};

  var path = splitKeypath(keypath);

  if (this.viewmodel.has(path[0])) {
    var model = this.viewmodel.joinAll(path);

    if (!model.isLink) { return; }

    while ((model = model.target) && options.canonical !== false) {
      if (!model.isLink) { break; }
    }

    if (model) { return { ractive: model.root.ractive, keypath: model.getKeypath() }; }
  }
}

var PREFIX = '/* Ractive.js component styles */';

// Holds current definitions of styles.
var styleDefinitions = [];

// Flag to tell if we need to update the CSS
var isDirty = false;

// These only make sense on the browser. See additional setup below.
var styleElement = null;
var useCssText = null;

function addCSS(styleDefinition) {
  styleDefinitions.push(styleDefinition);
  isDirty = true;
}

function applyCSS(force) {
  var styleElement = style();

  // Apply only seems to make sense when we're in the DOM. Server-side renders
  // can call toCSS to get the updated CSS.
  if (!styleElement || (!force && !isDirty)) { return; }

  if (useCssText) {
    styleElement.styleSheet.cssText = getCSS(null);
  } else {
    styleElement.innerHTML = getCSS(null);
  }

  isDirty = false;
}

function getCSS(cssIds) {
  if (cssIds && !isArray(cssIds)) { cssIds = [cssIds]; }
  var filteredStyleDefinitions = cssIds
    ? styleDefinitions.filter(function (style) { return ~cssIds.indexOf(style.id); })
    : styleDefinitions;

  filteredStyleDefinitions.forEach(function (d) { return (d.applied = true); });

  return filteredStyleDefinitions.reduce(
    function (styles, style) { return ("" + (styles ? (styles + "\n\n/* {" + (style.id) + "} */\n" + (style.styles)) : '')); },
    PREFIX
  );
}

function style() {
  // If we're on the browser, additional setup needed.
  if (doc && !styleElement) {
    styleElement = doc.createElement('style');
    styleElement.type = 'text/css';
    styleElement.setAttribute('data-ractive-css', '');

    doc.getElementsByTagName('head')[0].appendChild(styleElement);

    useCssText = !!styleElement.styleSheet;
  }

  return styleElement;
}

var adaptConfigurator = {
  extend: function (Parent, proto, options) {
    proto.adapt = combine(proto.adapt, ensureArray(options.adapt));
  },

  init: function init() {}
};

var remove = /\/\*(?:[\s\S]*?)\*\//g;
var escape = /url\(\s*(['"])(?:\\[\s\S]|(?!\1).)*\1\s*\)|url\((?:\\[\s\S]|[^)])*\)|(['"])(?:\\[\s\S]|(?!\2).)*\2/gi;
var value = /\0(\d+)/g;

// Removes comments and strings from the given CSS to make it easier to parse.
// Callback receives the cleaned CSS and a function which can be used to put
// the removed strings back in place after parsing is done.
function cleanCss(css, callback, additionalReplaceRules) {
  if ( additionalReplaceRules === void 0 ) additionalReplaceRules = [];

  var values = [];
  var reconstruct = function (css) { return css.replace(value, function (match, n) { return values[n]; }); };
  css = css.replace(escape, function (match) { return ("\u0000" + (values.push(match) - 1)); }).replace(remove, '');

  additionalReplaceRules.forEach(function (pattern) {
    css = css.replace(pattern, function (match) { return ("\u0000" + (values.push(match) - 1)); });
  });

  return callback(css, reconstruct);
}

var selectorsPattern = /(?:^|\}|\{|\x01)\s*([^\{\}\0\x01]+)\s*(?=\{)/g;
var importPattern = /@import\s*\([^)]*\)\s*;?/gi;
var importEndPattern = /\x01/g;
var keyframesDeclarationPattern = /@keyframes\s+[^\{\}]+\s*\{(?:[^{}]+|\{[^{}]+})*}/gi;
var selectorUnitPattern = /((?:(?:\[[^\]]+\])|(?:[^\s\+\>~:]))+)((?:::?[^\s\+\>\~\(:]+(?:\([^\)]+\))?)*\s*[\s\+\>\~]?)\s*/g;
var excludePattern = /^(?:@|\d+%)/;
var dataRvcGuidPattern = /\[data-ractive-css~="\{[a-z0-9-]+\}"]/g;

function trim$1(str) {
  return str.trim();
}

function extractString(unit) {
  return unit.str;
}

function transformSelector(selector, parent) {
  var selectorUnits = [];
  var match;

  while ((match = selectorUnitPattern.exec(selector))) {
    selectorUnits.push({
      str: match[0],
      base: match[1],
      modifiers: match[2]
    });
  }

  // For each simple selector within the selector, we need to create a version
  // that a) combines with the id, and b) is inside the id
  var base = selectorUnits.map(extractString);

  var transformed = [];
  var i = selectorUnits.length;

  while (i--) {
    var appended = base.slice();

    // Pseudo-selectors should go after the attribute selector
    var unit = selectorUnits[i];
    appended[i] = unit.base + parent + unit.modifiers || '';

    var prepended = base.slice();
    prepended[i] = parent + ' ' + prepended[i];

    transformed.push(appended.join(' '), prepended.join(' '));
  }

  return transformed.join(', ');
}

function transformCss(css, id) {
  var dataAttr = "[data-ractive-css~=\"{" + id + "}\"]";

  var transformed;

  if (dataRvcGuidPattern.test(css)) {
    transformed = css.replace(dataRvcGuidPattern, dataAttr);
  } else {
    transformed = cleanCss(
      css,
      function (css, reconstruct) {
        css = css
          .replace(importPattern, '$&\x01')
          .replace(selectorsPattern, function (match, $1) {
            // don't transform at-rules and keyframe declarations
            if (excludePattern.test($1)) { return match; }

            var selectors = $1.split(',').map(trim$1);
            var transformed =
              selectors.map(function (selector) { return transformSelector(selector, dataAttr); }).join(', ') + ' ';

            return match.replace($1, transformed);
          })
          .replace(importEndPattern, '');

        return reconstruct(css);
      },
      [keyframesDeclarationPattern]
    );
  }

  return transformed;
}

function s4() {
  return Math.floor((1 + Math.random()) * 0x10000)
    .toString(16)
    .substring(1);
}

function uuid() {
  return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
}

function setCSSData(keypath, value, options) {
  var opts = isObjectType(keypath) ? value : options;
  var model = this._cssModel;

  model.locked = true;
  var promise = set(build({ viewmodel: model }, keypath, value, true), opts);
  model.locked = false;

  var cascade = runloop.start();
  this.extensions.forEach(function (e) {
    var model = e._cssModel;
    model.mark();
    model.downstreamChanged('', 1);
  });
  runloop.end();

  applyChanges(this, !opts || opts.apply !== false);

  return promise.then(function () { return cascade; });
}

function applyChanges(component, apply) {
  var local = recomputeCSS(component);
  var child = component.extensions
    .map(function (e) { return applyChanges(e, false); })
    .reduce(function (a, c) { return c || a; }, false);

  if (apply && (local || child)) {
    var def = component._cssDef;
    if (!def || (def && def.applied)) { applyCSS(true); }
  }

  return local || child;
}

function recomputeCSS(component) {
  var css = component.css;

  if (!isFunction(css)) { return; }

  var def = component._cssDef;
  var result = evalCSS(component, css);
  var styles = def.transform ? transformCss(result, def.id) : result;

  if (def.styles === styles) { return; }

  def.styles = styles;

  return true;
}

var CSSModel = (function (SharedModel) {
  function CSSModel(component) {
    SharedModel.call(this, component.cssData, '@style');
    this.component = component;
  }

  if ( SharedModel ) CSSModel.__proto__ = SharedModel;
  var CSSModel__proto__ = CSSModel.prototype = Object.create( SharedModel && SharedModel.prototype );
  CSSModel__proto__.constructor = CSSModel;

  CSSModel__proto__.downstreamChanged = function downstreamChanged (path, depth) {
    if (this.locked) { return; }

    var component = this.component;

    component.extensions.forEach(function (e) {
      var model = e._cssModel;
      model.mark();
      model.downstreamChanged(path, depth || 1);
    });

    if (!depth) {
      applyChanges(component, true);
    }
  };

  return CSSModel;
}(SharedModel));

var hasCurly = /\{/;
var cssConfigurator = {
  name: 'css',

  // Called when creating a new component definition
  extend: function (Parent, proto, options, Child) {
    Child._cssIds = gatherIds(Parent);

    defineProperty(Child, 'cssData', {
      configurable: true,
      value: assign(create(Parent.cssData), options.cssData || {})
    });

    defineProperty(Child, '_cssModel', {
      configurable: true,
      value: new CSSModel(Child)
    });

    if (options.css) { initCSS(options, Child, proto); }
  },

  // Called when creating a new component instance
  init: function (Parent, target, options) {
    if (!options.css) { return; }

    warnIfDebug("\nThe css option is currently not supported on a per-instance basis and will be discarded. Instead, we recommend instantiating from a component definition with a css option.\n\nconst Component = Ractive.extend({\n\t...\n\tcss: '/* your css */',\n\t...\n});\n\nconst componentInstance = new Component({ ... })\n\t\t");
  }
};

function gatherIds(start) {
  var cmp = start;
  var ids = [];

  while (cmp) {
    if (cmp.prototype.cssId) { ids.push(cmp.prototype.cssId); }
    cmp = cmp.Parent;
  }

  return ids;
}

function evalCSS(component, css) {
  if (isString(css)) { return css; }

  var cssData = component.cssData;
  var model = component._cssModel;
  var data = function data(path) {
    return model.joinAll(splitKeypath(path)).get();
  };
  data.__proto__ = cssData;

  var result = css.call(component, data);
  return isString(result) ? result : '';
}

function initCSS(options, target, proto) {
  var css =
    options.css === true
      ? ''
      : isString(options.css) && !hasCurly.test(options.css)
      ? getElement(options.css) || options.css
      : options.css;
  var cssProp = css;

  var id = options.cssId || uuid();

  if (isObjectType(css)) {
    css = 'textContent' in css ? css.textContent : css.innerHTML;
    cssProp = css;
  } else if (isFunction(css)) {
    cssProp = css;
    css = evalCSS(target, css);
  }

  var def = {
    transform: 'noCSSTransform' in options ? !options.noCSSTransform : !options.noCssTransform
  };

  defineProperty(target, '_cssDef', { configurable: true, value: def });

  defineProperty(target, 'css', {
    get: function get() {
      return cssProp;
    },
    set: function set(next) {
      cssProp = next;
      var css = evalCSS(target, cssProp);
      var styles = def.styles;
      def.styles = def.transform ? transformCss(css, id) : css;
      if (def.applied && styles !== def.styles) { applyCSS(true); }
    }
  });

  def.styles = def.transform ? transformCss(css, id) : css;
  def.id = proto.cssId = id;
  target._cssIds.push(id);

  addCSS(target._cssDef);
}

function validate(data) {
  // Warn if userOptions.data is a non-POJO
  if (data && data.constructor !== Object) {
    if (isFunction(data)) {
      // TODO do we need to support this in the new Ractive() case?
    } else if (!isObjectType(data)) {
      fatal(("data option must be an object or a function, `" + data + "` is not valid"));
    } else {
      warnIfDebug(
        'If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged'
      );
    }
  }
}

var dataConfigurator = {
  name: 'data',

  extend: function (Parent, proto, options) {
    var key;
    var value;

    // check for non-primitives, which could cause mutation-related bugs
    if (options.data && isObject(options.data)) {
      for (key in options.data) {
        value = options.data[key];

        if (value && isObjectType(value)) {
          if (isObject(value) || isArray(value)) {
            warnIfDebug("Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\n\n  // this...\n  data: function () {\n    return {\n      myObject: {}\n    };\n  })\n\n  // instead of this:\n  data: {\n    myObject: {}\n  }");
          }
        }
      }
    }

    proto.data = combine$1(proto.data, options.data);
  },

  init: function (Parent, ractive, options) {
    var result = combine$1(Parent.prototype.data, options.data);

    if (isFunction(result)) { result = result.call(ractive); }

    // bind functions to the ractive instance at the top level,
    // unless it's a non-POJO (in which case alarm bells should ring)
    if (result && result.constructor === Object) {
      for (var prop in result) {
        if (isFunction(result[prop])) {
          var value = result[prop];
          result[prop] = bind(value, ractive);
          result[prop]._r_unbound = value;
        }
      }
    }

    return result || {};
  },

  reset: function reset(ractive) {
    var result = this.init(ractive.constructor, ractive, ractive.viewmodel);
    ractive.viewmodel.root.set(result);
    return true;
  }
};

function emptyData() {
  return {};
}

function combine$1(parentValue, childValue) {
  validate(childValue);

  var parentIsFn = isFunction(parentValue);

  // Very important, otherwise child instance can become
  // the default data object on Ractive or a component.
  // then ractive.set() ends up setting on the prototype!
  if (!childValue && !parentIsFn) {
    // this needs to be a function so that it can still inherit parent defaults
    childValue = emptyData;
  }

  var childIsFn = isFunction(childValue);

  // Fast path, where we just need to copy properties from
  // parent to child
  if (!parentIsFn && !childIsFn) {
    return fromProperties(childValue, parentValue);
  }

  return function() {
    var child = childIsFn ? callDataFunction(childValue, this) : childValue;
    var parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;

    return fromProperties(child, parent);
  };
}

function callDataFunction(fn, context) {
  var data = fn.call(context);

  if (!data) { return; }

  if (!isObjectType(data)) {
    fatal('Data function must return an object');
  }

  if (data.constructor !== Object) {
    warnOnceIfDebug(
      'Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged'
    );
  }

  return data;
}

function fromProperties(primary, secondary) {
  if (primary && secondary) {
    for (var key in secondary) {
      if (!(key in primary)) {
        primary[key] = secondary[key];
      }
    }

    return primary;
  }

  return primary || secondary;
}

var templateConfigurator = {
  name: 'template',

  extend: function extend(Parent, proto, options) {
    // only assign if exists
    if ('template' in options) {
      var template = options.template;

      if (isFunction(template)) {
        proto.template = template;
      } else {
        proto.template = parseTemplate(template, proto);
      }
    }
  },

  init: function init(Parent, ractive, options) {
    // TODO because of prototypal inheritance, we might just be able to use
    // ractive.template, and not bother passing through the Parent object.
    // At present that breaks the test mocks' expectations
    var template = 'template' in options ? options.template : Parent.prototype.template;
    template = template || { v: TEMPLATE_VERSION, t: [] };

    if (isFunction(template)) {
      var fn = template;
      template = getDynamicTemplate(ractive, fn);

      ractive._config.template = {
        fn: fn,
        result: template
      };
    }

    template = parseTemplate(template, ractive);

    // TODO the naming of this is confusing - ractive.template refers to [...],
    // but Component.prototype.template refers to {v:1,t:[],p:[]}...
    // it's unnecessary, because the developer never needs to access
    // ractive.template
    ractive.template = template.t;

    if (template.p) {
      extendPartials(ractive.partials, template.p);
    }
  },

  reset: function reset(ractive) {
    var result = resetValue(ractive);

    if (result) {
      var parsed = parseTemplate(result, ractive);

      ractive.template = parsed.t;
      extendPartials(ractive.partials, parsed.p, true);

      return true;
    }
  }
};

function resetValue(ractive) {
  var initial = ractive._config.template;

  // If this isn't a dynamic template, there's nothing to do
  if (!initial || !initial.fn) {
    return;
  }

  var result = getDynamicTemplate(ractive, initial.fn);

  // TODO deep equality check to prevent unnecessary re-rendering
  // in the case of already-parsed templates
  if (result !== initial.result) {
    initial.result = result;
    return result;
  }
}

function getDynamicTemplate(ractive, fn) {
  return fn.call(ractive, {
    fromId: parser.fromId,
    isParsed: parser.isParsed,
    parse: function parse(template, options) {
      if ( options === void 0 ) options = parser.getParseOptions(ractive);

      return parser.parse(template, options);
    }
  });
}

function parseTemplate(template, ractive) {
  if (isString(template)) {
    // parse will validate and add expression functions
    template = parseAsString(template, ractive);
  } else {
    // need to validate and add exp for already parsed template
    validate$1(template);
    addFunctions(template);
  }

  return template;
}

function parseAsString(template, ractive) {
  // ID of an element containing the template?
  if (template[0] === '#') {
    template = parser.fromId(template);
  }

  return parser.parseFor(template, ractive);
}

function validate$1(template) {
  // Check that the template even exists
  if (template == undefined) {
    throw new Error(("The template cannot be " + template + "."));
  } else if (!isNumber(template.v)) {
    // Check the parsed template has a version at all
    throw new Error(
      "The template parser was passed a non-string template, but the template doesn't have a version.  Make sure you're passing in the template you think you are."
    );
  } else if (template.v !== TEMPLATE_VERSION) {
    // Check we're using the correct version
    throw new Error(
      ("Mismatched template version (expected " + TEMPLATE_VERSION + ", got " + (template.v) + ") Please ensure you are using the latest version of Ractive.js in your build process as well as in your app")
    );
  }
}

function extendPartials(existingPartials, newPartials, overwrite) {
  if (!newPartials) { return; }

  // TODO there's an ambiguity here - we need to overwrite in the `reset()`
  // case, but not initially...

  for (var key in newPartials) {
    if (overwrite || !hasOwn(existingPartials, key)) {
      existingPartials[key] = newPartials[key];
    }
  }
}

var registryNames = [
  'adaptors',
  'components',
  'computed',
  'decorators',
  'easing',
  'events',
  'helpers',
  'interpolators',
  'partials',
  'transitions'
];

var registriesOnDefaults = ['computed', 'helpers'];

var Registry = function Registry(name, useDefaults) {
  this.name = name;
  this.useDefaults = useDefaults;
};
var Registry__proto__ = Registry.prototype;

Registry__proto__.extend = function extend (Parent, proto, options) {
  var parent = this.useDefaults ? Parent.defaults : Parent;
  var target = this.useDefaults ? proto : proto.constructor;
  this.configure(parent, target, options);
};

Registry__proto__.init = function init () {
  // noop
};

Registry__proto__.configure = function configure (Parent, target, options) {
  var name = this.name;
  var option = options[name];

  var registry = create(Parent[name]);

  assign(registry, option);

  target[name] = registry;

  if (name === 'partials' && target[name]) {
    keys(target[name]).forEach(function (key) {
      addFunctions(target[name][key]);
    });
  }
};

Registry__proto__.reset = function reset (ractive) {
  var registry = ractive[this.name];
  var changed = false;

  keys(registry).forEach(function (key) {
    var item = registry[key];

    if (item._fn) {
      if (item._fn.isOwner) {
        registry[key] = item._fn;
      } else {
        delete registry[key];
      }
      changed = true;
    }
  });

  return changed;
};

var registries = registryNames.map(function (name) {
  var putInDefaults = registriesOnDefaults.indexOf(name) > -1;
  return new Registry(name, putInDefaults);
});

function wrap(parent, name, method) {
  if (!/_super/.test(method)) { return method; }

  function wrapper() {
    var superMethod = getSuperMethod(wrapper._parent, name);
    var hasSuper = '_super' in this;
    var oldSuper = this._super;

    this._super = superMethod;

    var result = method.apply(this, arguments);

    if (hasSuper) {
      this._super = oldSuper;
    } else {
      delete this._super;
    }

    return result;
  }

  wrapper._parent = parent;
  wrapper._method = method;

  return wrapper;
}

function getSuperMethod(parent, name) {
  if (name in parent) {
    var value = parent[name];

    return isFunction(value) ? value : function () { return value; };
  }

  return noop;
}

function getMessage(deprecated, correct, isError) {
  return (
    "options." + deprecated + " has been deprecated in favour of options." + correct + "." +
    (isError ? (" You cannot specify both options, please use options." + correct + ".") : '')
  );
}

function deprecateOption(options, deprecatedOption, correct) {
  if (deprecatedOption in options) {
    if (!(correct in options)) {
      warnIfDebug(getMessage(deprecatedOption, correct));
      options[correct] = options[deprecatedOption];
    } else {
      throw new Error(getMessage(deprecatedOption, correct, true));
    }
  }
}

function deprecate(options) {
  deprecateOption(options, 'beforeInit', 'onconstruct');
  deprecateOption(options, 'init', 'onrender');
  deprecateOption(options, 'complete', 'oncomplete');
  deprecateOption(options, 'eventDefinitions', 'events');

  // Using extend with Component instead of options,
  // like Human.extend( Spider ) means adaptors as a registry
  // gets copied to options. So we have to check if actually an array
  if (isArray(options.adaptors)) {
    deprecateOption(options, 'adaptors', 'adapt');
  }
}

var config = {
  extend: function (Parent, proto, options, Child) { return configure('extend', Parent, proto, options, Child); },
  init: function (Parent, ractive, options) { return configure('init', Parent, ractive, options); },
  reset: function (ractive) { return order.filter(function (c) { return c.reset && c.reset(ractive); }).map(function (c) { return c.name; }); }
};

var custom = {
  adapt: adaptConfigurator,
  computed: config,
  css: cssConfigurator,
  data: dataConfigurator,
  helpers: config,
  template: templateConfigurator
};

var defaultKeys = keys(defaults);

var isStandardKey = makeObj(defaultKeys.filter(function (key) { return !custom[key]; }));

// blacklisted keys that we don't double extend
var isBlacklisted = makeObj(
  defaultKeys.concat(registries.map(function (r) { return r.name; }), ['on', 'observe', 'attributes', 'cssData', 'use'])
);

var order = [].concat(
  defaultKeys.filter(function (key) { return !registries[key] && !custom[key]; }),
  registries,
  //custom.data,
  custom.template,
  custom.css
);

function configure(method, Parent, target, options, Child) {
  deprecate(options);

  for (var key in options) {
    if (hasOwn(isStandardKey, key)) {
      var value = options[key];

      // warn the developer if they passed a function and ignore its value

      // NOTE: we allow some functions on "el" because we duck type element lists
      // and some libraries or ef'ed-up virtual browsers (phantomJS) return a
      // function object as the result of querySelector methods
      if (key !== 'el' && isFunction(value)) {
        warnIfDebug(
          (key + " is a Ractive option that does not expect a function and will be ignored"),
          method === 'init' ? target : null
        );
      } else {
        target[key] = value;
      }
    }
  }

  // disallow combination of `append` and `enhance`
  if (target.append && target.enhance) {
    throw new Error('Cannot use append and enhance at the same time');
  }

  registries.forEach(function (registry) {
    registry[method](Parent, target, options, Child);
  });

  adaptConfigurator[method](Parent, target, options, Child);
  templateConfigurator[method](Parent, target, options, Child);
  cssConfigurator[method](Parent, target, options, Child);

  extendOtherMethods(Parent.prototype, target, options);
}

var _super = /\b_super\b/;
function extendOtherMethods(parent, target, options) {
  for (var key in options) {
    if (!isBlacklisted[key] && hasOwn(options, key)) {
      var member = options[key];

      // if this is a method that overwrites a method, wrap it:
      if (isFunction(member)) {
        if (
          (key in proto$9 ||
            (key.slice(0, 2) === 'on' && key.slice(2) in hooks && key in target)) &&
          !_super.test(member.toString())
        ) {
          warnIfDebug(
            ("Overriding Ractive prototype function '" + key + "' without calling the '" + _super + "' method can be very dangerous.")
          );
        }
        member = wrap(parent, key, member);
      }

      target[key] = member;
    }
  }
}

function makeObj(array) {
  var obj = {};
  array.forEach(function (x) { return (obj[x] = true); });
  return obj;
}

var Item = function Item(options) {
  this.up = options.up;
  this.ractive = options.up.ractive;

  this.template = options.template;
  this.index = options.index;
  this.type = options.template.t;

  this.dirty = false;
};
var Item__proto__ = Item.prototype;

Item__proto__.bubble = function bubble () {
  if (!this.dirty) {
    this.dirty = true;
    this.up.bubble();
  }
};

Item__proto__.destroyed = function destroyed () {
  if (this.fragment) { this.fragment.destroyed(); }
};

Item__proto__.find = function find () {
  return null;
};

Item__proto__.findComponent = function findComponent () {
  return null;
};

Item__proto__.findNextNode = function findNextNode () {
  return this.up.findNextNode(this);
};

Item__proto__.rebound = function rebound (update) {
  if (this.fragment) { this.fragment.rebound(update); }
};

Item__proto__.shuffled = function shuffled () {
  if (this.fragment) { this.fragment.shuffled(); }
};

Item__proto__.valueOf = function valueOf () {
  return this.toString();
};

Item.prototype.findAll = noop;
Item.prototype.findAllComponents = noop;

var ContainerItem = (function (Item) {
  function ContainerItem(options) {
    Item.call(this, options);
  }

  if ( Item ) ContainerItem.__proto__ = Item;
  var ContainerItem__proto__ = ContainerItem.prototype = Object.create( Item && Item.prototype );
  ContainerItem__proto__.constructor = ContainerItem;

  ContainerItem__proto__.detach = function detach () {
    return this.fragment ? this.fragment.detach() : createDocumentFragment();
  };

  ContainerItem__proto__.find = function find (selector) {
    if (this.fragment) {
      return this.fragment.find(selector);
    }
  };

  ContainerItem__proto__.findAll = function findAll (selector, options) {
    if (this.fragment) {
      this.fragment.findAll(selector, options);
    }
  };

  ContainerItem__proto__.findComponent = function findComponent (name) {
    if (this.fragment) {
      return this.fragment.findComponent(name);
    }
  };

  ContainerItem__proto__.findAllComponents = function findAllComponents (name, options) {
    if (this.fragment) {
      this.fragment.findAllComponents(name, options);
    }
  };

  ContainerItem__proto__.firstNode = function firstNode (skipParent) {
    return this.fragment && this.fragment.firstNode(skipParent);
  };

  ContainerItem__proto__.toString = function toString (escape) {
    return this.fragment ? this.fragment.toString(escape) : '';
  };

  return ContainerItem;
}(Item));

var space = /\s+/;

function readStyle(css) {
  if (!isString(css)) { return {}; }

  return cleanCss(css, function (css, reconstruct) {
    return css
      .split(';')
      .filter(function (rule) { return !!rule.trim(); })
      .map(reconstruct)
      .reduce(function (rules, rule) {
        var i = rule.indexOf(':');
        var name = rule.substr(0, i).trim();
        rules[name] = rule.substr(i + 1).trim();
        return rules;
      }, {});
  });
}

function readClass(str) {
  var list = str.split(space);

  // remove any empty entries
  var i = list.length;
  while (i--) {
    if (!list[i]) { list.splice(i, 1); }
  }

  return list;
}

var textTypes = [
  undefined,
  'text',
  'search',
  'url',
  'email',
  'hidden',
  'password',
  'search',
  'reset',
  'submit'
];

function getUpdateDelegate(attribute) {
  var element = attribute.element;
  var name = attribute.name;

  if (name === 'value') {
    if (attribute.interpolator) { attribute.interpolator.bound = true; }

    // special case - selects
    if (element.name === 'select' && name === 'value') {
      return element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;
    }

    if (element.name === 'textarea') { return updateStringValue; }

    // special case - contenteditable
    if (element.getAttribute('contenteditable') != null) { return updateContentEditableValue; }

    // special case - <input>
    if (element.name === 'input') {
      var type = element.getAttribute('type');

      // type='file' value='{{fileList}}'>
      if (type === 'file') { return noop; } // read-only

      // type='radio' name='{{twoway}}'
      if (type === 'radio' && element.binding && element.binding.attribute.name === 'name')
        { return updateRadioValue; }

      if (~textTypes.indexOf(type)) { return updateStringValue; }
    }

    return updateValue;
  }

  var node = element.node;

  // special case - <input type='radio' name='{{twoway}}' value='foo'>
  if (attribute.isTwoway && name === 'name') {
    if (node.type === 'radio') { return updateRadioName; }
    if (node.type === 'checkbox') { return updateCheckboxName; }
  }

  if (name === 'style') { return updateStyleAttribute; }

  if (name.indexOf('style-') === 0) { return updateInlineStyle; }

  // special case - class names. IE fucks things up, again
  if (name === 'class' && (!node.namespaceURI || node.namespaceURI === html))
    { return updateClassName; }

  if (name.indexOf('class-') === 0) { return updateInlineClass; }

  if (attribute.isBoolean) {
    var type$1 = element.getAttribute('type');
    if (attribute.interpolator && name === 'checked' && (type$1 === 'checkbox' || type$1 === 'radio'))
      { attribute.interpolator.bound = true; }
    return updateBoolean;
  }

  if (attribute.namespace && attribute.namespace !== attribute.node.namespaceURI)
    { return updateNamespacedAttribute; }

  return updateAttribute;
}

function updateMultipleSelectValue(reset) {
  var value = this.getValue();

  if (!isArray(value)) { value = [value]; }

  var options = this.node.options;
  var i = options.length;

  if (reset) {
    while (i--) { options[i].selected = false; }
  } else {
    while (i--) {
      var option = options[i];
      var optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive

      option.selected = arrayContains(value, optionValue);
    }
  }
}

function updateSelectValue(reset) {
  var value = this.getValue();

  if (!this.locked) {
    // TODO is locked still a thing?
    this.node._ractive.value = value;

    var options = this.node.options;
    var i = options.length;
    var wasSelected = false;

    if (reset) {
      while (i--) { options[i].selected = false; }
    } else {
      while (i--) {
        var option = options[i];
        var optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive
        if (option.disabled && option.selected) { wasSelected = true; }

        if (optionValue == value) {
          // double equals as we may be comparing numbers with strings
          option.selected = true;
          return;
        }
      }
    }

    if (!wasSelected) { this.node.selectedIndex = -1; }
  }
}

function updateContentEditableValue(reset) {
  var value = this.getValue();

  if (!this.locked) {
    if (reset) { this.node.innerHTML = ''; }
    else { this.node.innerHTML = isUndefined(value) ? '' : value; }
  }
}

function updateRadioValue(reset) {
  var node = this.node;
  var wasChecked = node.checked;

  var value = this.getValue();

  if (reset) { return (node.checked = false); }

  //node.value = this.element.getAttribute( 'value' );
  node.value = this.node._ractive.value = value;
  node.checked = this.element.compare(value, this.element.getAttribute('name'));

  // This is a special case - if the input was checked, and the value
  // changed so that it's no longer checked, the twoway binding is
  // most likely out of date. To fix it we have to jump through some
  // hoops... this is a little kludgy but it works
  if (wasChecked && !node.checked && this.element.binding && this.element.binding.rendered) {
    this.element.binding.group.model.set(this.element.binding.group.getValue());
  }
}

function updateValue(reset) {
  if (!this.locked) {
    if (reset) {
      this.node.removeAttribute('value');
      this.node.value = this.node._ractive.value = null;
    } else {
      var value = this.getValue();

      this.node.value = this.node._ractive.value = value;
      this.node.setAttribute('value', safeToStringValue(value));
    }
  }
}

function updateStringValue(reset) {
  if (!this.locked) {
    if (reset) {
      this.node._ractive.value = '';
      this.node.removeAttribute('value');
    } else {
      var value = this.getValue();

      this.node._ractive.value = value;

      var safeValue = safeToStringValue(value);

      // fixes #3281  Safari moves caret position when setting an input value to the same value
      if (this.node.value !== safeValue) {
        this.node.value = safeValue;
      }

      this.node.setAttribute('value', safeValue);
    }
  }
}

function updateRadioName(reset) {
  if (reset) { this.node.checked = false; }
  else { this.node.checked = this.element.compare(this.getValue(), this.element.binding.getValue()); }
}

function updateCheckboxName(reset) {
  var ref = this;
  var element = ref.element;
  var node = ref.node;
  var binding = element.binding;

  var value = this.getValue();
  var valueAttribute = element.getAttribute('value');

  if (!isArray(value)) {
    binding.isChecked = node.checked = element.compare(value, valueAttribute);
  } else {
    var i = value.length;
    while (i--) {
      if (element.compare(valueAttribute, value[i])) {
        binding.isChecked = node.checked = true;
        return;
      }
    }
    binding.isChecked = node.checked = false;
  }
}

function updateStyleAttribute(reset) {
  var props = reset ? {} : readStyle(this.getValue() || '');
  var style = this.node.style;
  var keys$$1 = keys(props);
  var prev = this.previous || [];

  var i = 0;
  while (i < keys$$1.length) {
    if (keys$$1[i] in style) {
      var safe = props[keys$$1[i]].replace('!important', '');
      style.setProperty(keys$$1[i], safe, safe.length !== props[keys$$1[i]].length ? 'important' : '');
    }
    i++;
  }

  // remove now-missing attrs
  i = prev.length;
  while (i--) {
    if (!~keys$$1.indexOf(prev[i]) && prev[i] in style) { style.setProperty(prev[i], '', ''); }
  }

  this.previous = keys$$1;
}

function updateInlineStyle(reset) {
  if (!this.style) {
    this.style = hyphenateCamel(this.name.substr(6));
  }

  if (reset && this.node.style.getPropertyValue(this.style) !== this.last) { return; }

  var value = reset ? '' : safeToStringValue(this.getValue());
  var safe = value.replace('!important', '');
  this.node.style.setProperty(this.style, safe, safe.length !== value.length ? 'important' : '');
  this.last = this.node.style.getPropertyValue(this.style);
}

function updateClassName(reset) {
  var value = reset ? [] : readClass(safeToStringValue(this.getValue()));

  // watch out for werdo svg elements
  var cls = this.node.className;
  cls = cls.baseVal !== undefined ? cls.baseVal : cls;

  var attr = readClass(cls);
  var prev = this.previous || [];

  var className = value.concat(attr.filter(function (c) { return !~prev.indexOf(c); })).join(' ');

  if (className !== cls) {
    if (!isString(this.node.className)) {
      this.node.className.baseVal = className;
    } else {
      this.node.className = className;
    }
  }

  this.previous = value;
}

function updateInlineClass(reset) {
  var name = this.name.substr(6);

  // watch out for werdo svg elements
  var cls = this.node.className;
  cls = cls.baseVal !== undefined ? cls.baseVal : cls;

  var attr = readClass(cls);
  var value = reset ? false : this.getValue();

  if (!this.inlineClass) { this.inlineClass = name; }

  if (value && !~attr.indexOf(name)) { attr.push(name); }
  else if (!value && ~attr.indexOf(name)) { attr.splice(attr.indexOf(name), 1); }

  if (!isString(this.node.className)) {
    this.node.className.baseVal = attr.join(' ');
  } else {
    this.node.className = attr.join(' ');
  }
}

function updateBoolean(reset) {
  // with two-way binding, only update if the change wasn't initiated by the user
  // otherwise the cursor will often be sent to the wrong place
  if (!this.locked) {
    if (reset) {
      if (this.useProperty) { this.node[this.propertyName] = false; }
      this.node.removeAttribute(this.propertyName);
    } else {
      if (this.useProperty) {
        this.node[this.propertyName] = this.getValue();
      } else {
        var val = this.getValue();
        if (val) {
          this.node.setAttribute(this.propertyName, isString(val) ? val : '');
        } else {
          this.node.removeAttribute(this.propertyName);
        }
      }
    }
  }
}

function updateAttribute(reset) {
  if (reset) {
    if (this.node.getAttribute(this.name) === this.value) {
      this.node.removeAttribute(this.name);
    }
  } else {
    this.value = safeToStringValue(this.getString());
    this.node.setAttribute(this.name, this.value);
  }
}

function updateNamespacedAttribute(reset) {
  if (reset) {
    if (
      this.value ===
      this.node.getAttributeNS(this.namespace, this.name.slice(this.name.indexOf(':') + 1))
    ) {
      this.node.removeAttributeNS(this.namespace, this.name.slice(this.name.indexOf(':') + 1));
    }
  } else {
    this.value = safeToStringValue(this.getString());
    this.node.setAttributeNS(
      this.namespace,
      this.name.slice(this.name.indexOf(':') + 1),
      this.value
    );
  }
}

var propertyNames = {
  'accept-charset': 'acceptCharset',
  accesskey: 'accessKey',
  bgcolor: 'bgColor',
  class: 'className',
  codebase: 'codeBase',
  colspan: 'colSpan',
  contenteditable: 'contentEditable',
  datetime: 'dateTime',
  dirname: 'dirName',
  for: 'htmlFor',
  'http-equiv': 'httpEquiv',
  ismap: 'isMap',
  maxlength: 'maxLength',
  novalidate: 'noValidate',
  pubdate: 'pubDate',
  readonly: 'readOnly',
  rowspan: 'rowSpan',
  tabindex: 'tabIndex',
  usemap: 'useMap'
};

var div$1 = doc ? createElement('div') : null;

var attributes = false;
function inAttributes() {
  return attributes;
}

var ConditionalAttribute = (function (Item) {
  function ConditionalAttribute(options) {
    Item.call(this, options);

    this.attributes = [];

    this.owner = options.owner;

    this.fragment = new Fragment({
      ractive: this.ractive,
      owner: this,
      template: this.template
    });

    // this fragment can't participate in node-y things
    this.fragment.findNextNode = noop;

    this.dirty = false;
  }

  if ( Item ) ConditionalAttribute.__proto__ = Item;
  var ConditionalAttribute__proto__ = ConditionalAttribute.prototype = Object.create( Item && Item.prototype );
  ConditionalAttribute__proto__.constructor = ConditionalAttribute;

  ConditionalAttribute__proto__.bind = function bind () {
    this.fragment.bind();
  };

  ConditionalAttribute__proto__.bubble = function bubble () {
    if (!this.dirty) {
      this.dirty = true;
      this.owner.bubble();
    }
  };

  ConditionalAttribute__proto__.destroyed = function destroyed () {
    this.unrender();
  };

  ConditionalAttribute__proto__.render = function render () {
    this.node = this.owner.node;
    if (this.node) {
      this.isSvg = this.node.namespaceURI === svg$1;
    }

    attributes = true;
    if (!this.rendered) { this.fragment.render(); }

    this.rendered = true;
    this.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js
    this.update();
    attributes = false;
  };

  ConditionalAttribute__proto__.toString = function toString () {
    return this.fragment.toString();
  };

  ConditionalAttribute__proto__.unbind = function unbind (view) {
    this.fragment.unbind(view);
  };

  ConditionalAttribute__proto__.unrender = function unrender () {
    this.rendered = false;
    this.fragment.unrender();
  };

  ConditionalAttribute__proto__.update = function update () {
    var this$1 = this;

    var str;
    var attrs;

    if (this.dirty) {
      this.dirty = false;

      var current = attributes;
      attributes = true;
      this.fragment.update();

      if (this.rendered && this.node) {
        str = this.fragment.toString();

        attrs = parseAttributes(str, this.isSvg);

        // any attributes that previously existed but no longer do
        // must be removed
        this.attributes
          .filter(function (a) { return notIn(attrs, a); })
          .forEach(function (a) {
            this$1.node.removeAttribute(a.name);
          });

        attrs.forEach(function (a) {
          this$1.node.setAttribute(a.name, a.value);
        });

        this.attributes = attrs;
      }

      attributes = current || false;
    }
  };

  return ConditionalAttribute;
}(Item));

var onlyWhitespace = /^\s*$/;
function parseAttributes(str, isSvg) {
  if (onlyWhitespace.test(str)) { return []; }
  var tagName = isSvg ? 'svg' : 'div';
  return str
    ? (div$1.innerHTML = "<" + tagName + " " + str + "></" + tagName + ">") && toArray(div$1.childNodes[0].attributes)
    : [];
}

function notIn(haystack, needle) {
  var i = haystack.length;

  while (i--) {
    if (haystack[i].name === needle.name) {
      return false;
    }
  }

  return true;
}

function lookupNamespace(node, prefix) {
  var qualified = "xmlns:" + prefix;

  while (node) {
    if (node.hasAttribute && node.hasAttribute(qualified)) { return node.getAttribute(qualified); }
    node = node.parentNode;
  }

  return namespaces[prefix];
}

var attribute = false;
function inAttribute() {
  return attribute;
}

var Attribute = (function (Item) {
  function Attribute(options) {
    Item.call(this, options);

    this.name = options.template.n;
    this.namespace = null;

    this.owner = options.owner || options.up.owner || options.element || findElement(options.up);
    this.element =
      options.element || (this.owner.attributeByName ? this.owner : findElement(options.up));
    this.up = options.up; // shared
    this.ractive = this.up.ractive;

    this.rendered = false;
    this.updateDelegate = null;
    this.fragment = null;

    this.element.attributeByName[this.name] = this;

    if (!isArray(options.template.f)) {
      this.value = options.template.f;
      if (this.value === 0) {
        this.value = '';
      } else if (isUndefined(this.value)) {
        this.value = true;
      }
      return;
    } else {
      this.fragment = new Fragment({
        owner: this,
        template: options.template.f
      });
    }

    this.interpolator =
      this.fragment &&
      this.fragment.items.length === 1 &&
      this.fragment.items[0].type === INTERPOLATOR &&
      this.fragment.items[0];

    if (this.interpolator) { this.interpolator.owner = this; }
  }

  if ( Item ) Attribute.__proto__ = Item;
  var Attribute__proto__ = Attribute.prototype = Object.create( Item && Item.prototype );
  Attribute__proto__.constructor = Attribute;

  Attribute__proto__.bind = function bind () {
    if (this.fragment) {
      this.fragment.bind();
    }
  };

  Attribute__proto__.bubble = function bubble () {
    if (!this.dirty) {
      this.up.bubble();
      this.element.bubble();
      this.dirty = true;
    }
  };

  Attribute__proto__.firstNode = function firstNode () {};

  Attribute__proto__.getString = function getString () {
    attribute = true;
    var value = this.fragment
      ? this.fragment.toString()
      : this.value != null
      ? '' + this.value
      : '';
    attribute = false;
    return value;
  };

  // TODO could getValue ever be called for a static attribute,
  // or can we assume that this.fragment exists?
  Attribute__proto__.getValue = function getValue () {
    attribute = true;
    var value = this.fragment
      ? this.fragment.valueOf()
      : booleanAttributes[this.name.toLowerCase()]
      ? true
      : this.value;
    attribute = false;
    return value;
  };

  Attribute__proto__.render = function render () {
    var node = this.element.node;
    this.node = node;

    // should we use direct property access, or setAttribute?
    if (!node.namespaceURI || node.namespaceURI === namespaces.html) {
      this.propertyName = propertyNames[this.name] || this.name;

      if (node[this.propertyName] !== undefined) {
        this.useProperty = true;
      }

      // is attribute a boolean attribute or 'value'? If so we're better off doing e.g.
      // node.selected = true rather than node.setAttribute( 'selected', '' )
      if (booleanAttributes[this.name.toLowerCase()] || this.isTwoway) {
        this.isBoolean = true;
      }

      if (this.propertyName === 'value') {
        node._ractive.value = this.value;
      }
    }

    if (node.namespaceURI) {
      var index = this.name.indexOf(':');
      if (index !== -1) {
        this.namespace = lookupNamespace(node, this.name.slice(0, index));
      } else {
        this.namespace = node.namespaceURI;
      }
    }

    this.rendered = true;
    this.updateDelegate = getUpdateDelegate(this);
    this.updateDelegate();
  };

  Attribute__proto__.toString = function toString () {
    if (inAttributes()) { return ''; }
    attribute = true;

    var value = this.getValue();

    // Special case - select and textarea values (should not be stringified)
    if (
      this.name === 'value' &&
      (this.element.getAttribute('contenteditable') !== undefined ||
        (this.element.name === 'select' || this.element.name === 'textarea'))
    ) {
      return;
    }

    // Special case  bound radio `name` attributes
    if (
      this.name === 'name' &&
      this.element.name === 'input' &&
      this.interpolator &&
      this.element.getAttribute('type') === 'radio'
    ) {
      return ("name=\"{{" + (this.interpolator.model.getKeypath()) + "}}\"");
    }

    // Special case - style and class attributes and directives
    if (
      this.owner === this.element &&
      (this.name === 'style' || this.name === 'class' || this.style || this.inlineClass)
    ) {
      return;
    }

    if (
      !this.rendered &&
      this.owner === this.element &&
      (!this.name.indexOf('style-') || !this.name.indexOf('class-'))
    ) {
      if (!this.name.indexOf('style-')) {
        this.style = hyphenateCamel(this.name.substr(6));
      } else {
        this.inlineClass = this.name.substr(6);
      }

      return;
    }

    if (booleanAttributes[this.name.toLowerCase()])
      { return value
        ? isString(value)
          ? ((this.name) + "=\"" + (safeAttributeString(value)) + "\"")
          : this.name
        : ''; }
    if (value == null) { return ''; }

    var str = safeAttributeString(this.getString());
    attribute = false;

    return str ? ((this.name) + "=\"" + str + "\"") : this.name;
  };

  Attribute__proto__.unbind = function unbind (view) {
    if (this.fragment) { this.fragment.unbind(view); }
  };

  Attribute__proto__.unrender = function unrender () {
    this.updateDelegate(true);

    this.rendered = false;
  };

  Attribute__proto__.update = function update () {
    if (this.dirty) {
      var binding;
      this.dirty = false;
      if (this.fragment) { this.fragment.update(); }
      if (this.rendered) { this.updateDelegate(); }
      if (this.isTwoway && !this.locked) {
        this.interpolator.twowayBinding.lastVal(true, this.interpolator.model.get());
      } else if (this.name === 'value' && (binding = this.element.binding)) {
        // special case: name bound element with dynamic value
        var attr = binding.attribute;
        if (attr && !attr.dirty && attr.rendered) {
          this.element.binding.attribute.updateDelegate();
        }
      }
    }
  };

  return Attribute;
}(Item));

var BindingFlag = (function (Item) {
  function BindingFlag(options) {
    Item.call(this, options);

    this.owner = options.owner || options.up.owner || findElement(options.up);
    this.element = this.owner.attributeByName ? this.owner : findElement(options.up);
    this.flag = options.template.v === 'l' ? 'lazy' : 'twoway';
    this.bubbler = this.owner === this.element ? this.element : this.up;

    if (this.element.type === ELEMENT) {
      if (isArray(options.template.f)) {
        this.fragment = new Fragment({
          owner: this,
          template: options.template.f
        });
      }

      this.interpolator =
        this.fragment &&
        this.fragment.items.length === 1 &&
        this.fragment.items[0].type === INTERPOLATOR &&
        this.fragment.items[0];
    }
  }

  if ( Item ) BindingFlag.__proto__ = Item;
  var BindingFlag__proto__ = BindingFlag.prototype = Object.create( Item && Item.prototype );
  BindingFlag__proto__.constructor = BindingFlag;

  BindingFlag__proto__.bind = function bind () {
    if (this.fragment) { this.fragment.bind(); }
    set$1(this, this.getValue(), true);
  };

  BindingFlag__proto__.bubble = function bubble () {
    if (!this.dirty) {
      this.bubbler.bubble();
      this.dirty = true;
    }
  };

  BindingFlag__proto__.getValue = function getValue () {
    if (this.fragment) { return this.fragment.valueOf(); }
    else if ('value' in this) { return this.value; }
    else if ('f' in this.template) { return this.template.f; }
    else { return true; }
  };

  BindingFlag__proto__.render = function render () {
    set$1(this, this.getValue(), true);
  };

  BindingFlag__proto__.toString = function toString () {
    return '';
  };

  BindingFlag__proto__.unbind = function unbind (view) {
    if (this.fragment) { this.fragment.unbind(view); }

    delete this.element[this.flag];
  };

  BindingFlag__proto__.unrender = function unrender () {
    if (this.element.rendered) { this.element.recreateTwowayBinding(); }
  };

  BindingFlag__proto__.update = function update () {
    if (this.dirty) {
      this.dirty = false;
      if (this.fragment) { this.fragment.update(); }
      set$1(this, this.getValue(), true);
    }
  };

  return BindingFlag;
}(Item));

function set$1(flag, value, update) {
  if (value === 0) {
    flag.value = true;
  } else if (value === 'true') {
    flag.value = true;
  } else if (value === 'false' || value === '0') {
    flag.value = false;
  } else {
    flag.value = value;
  }

  var current = flag.element[flag.flag];
  flag.element[flag.flag] = flag.value;
  if (update && !flag.element.attributes.binding && current !== flag.value) {
    flag.element.recreateTwowayBinding();
  }

  return flag.value;
}

function Comment(options) {
  Item.call(this, options);
}

var proto$1 = create(Item.prototype);

assign(proto$1, {
  bind: noop,
  unbind: noop,
  update: noop,

  detach: function detach() {
    return detachNode(this.node);
  },

  firstNode: function firstNode() {
    return this.node;
  },

  render: function render(target) {
    this.rendered = true;

    this.node = doc.createComment(this.template.c);
    target.appendChild(this.node);
  },

  toString: function toString() {
    return ("<!-- " + (this.template.c) + " -->");
  },

  unrender: function unrender(shouldDestroy) {
    if (this.rendered && shouldDestroy) { this.detach(); }
    this.rendered = false;
  }
});

Comment.prototype = proto$1;

// Teardown. This goes through the root fragment and all its children, removing observers
// and generally cleaning up after itself

function Ractive$teardown() {
  var this$1 = this;

  if (this.torndown) {
    warnIfDebug('ractive.teardown() was called on a Ractive instance that was already torn down');
    return Promise.resolve();
  }

  this.shouldDestroy = true;
  return teardown$1(this, function () { return (this$1.fragment.rendered ? this$1.unrender() : Promise.resolve()); });
}

function teardown$1(instance, getPromise) {
  instance.torndown = true;
  instance.fragment.unbind();
  instance._observers.slice().forEach(cancel);

  if (instance.el && instance.el.__ractive_instances__) {
    removeFromArray(instance.el.__ractive_instances__, instance);
  }

  var promise = getPromise();

  hooks.teardown.fire(instance);

  promise.then(function () {
    hooks.destruct.fire(instance);
    instance.viewmodel.teardown();
  });

  return promise;
}

var RactiveModel = (function (SharedModel) {
  function RactiveModel(ractive) {
    SharedModel.call(this, ractive, '@this');
    this.ractive = ractive;
  }

  if ( SharedModel ) RactiveModel.__proto__ = SharedModel;
  var RactiveModel__proto__ = RactiveModel.prototype = Object.create( SharedModel && SharedModel.prototype );
  RactiveModel__proto__.constructor = RactiveModel;

  RactiveModel__proto__.joinKey = function joinKey (key) {
    var model = SharedModel.prototype.joinKey.call(this, key);

    if ((key === 'root' || key === 'parent') && !model.isLink) { return initLink(model, key); }
    else if (key === 'data') { return this.ractive.viewmodel; }
    else if (key === 'cssData') { return this.ractive.constructor._cssModel; }

    return model;
  };

  return RactiveModel;
}(SharedModel));

function initLink(model, key) {
  model.applyValue = function(value) {
    this.parent.value[key] = value;
    if (value && value.viewmodel) {
      this.link(value.viewmodel.getRactiveModel(), key);
      this._link.markedAll();
    } else {
      this.link(create(Missing), key);
      this._link.markedAll();
    }
  };

  if (key === 'root') {
    var mark = model.mark;
    model.mark = function(force) {
      if (this._marking) { return; }
      this._marking = true;
      mark.apply(this, force);
      this._marking = false;
    };
  }

  model.applyValue(model.parent.ractive[key], key);
  model._link.set = function (v) { return model.applyValue(v); };
  model._link.applyValue = function (v) { return model.applyValue(v); };

  return model._link;
}

var specialModels = {
  '@this': function _this(root) {
    return root.getRactiveModel();
  },
  '@global': function _global() {
    return GlobalModel;
  },
  '@shared': function _shared() {
    return SharedModel$1;
  },
  '@style': function _style(root) {
    return root.getRactiveModel().joinKey('cssData');
  },
  '@helpers': function _helpers(root) {
    return root.getHelpers();
  }
};
specialModels['@'] = specialModels['@this'];

var RootModel = (function (Model) {
  function RootModel(options) {
    Model.call(this, null, null);

    this.isRoot = true;
    this.root = this;
    this.ractive = options.ractive; // TODO sever this link

    this.value = options.data;
    this.adaptors = options.adapt;
    this.adapt();
  }

  if ( Model ) RootModel.__proto__ = Model;
  var RootModel__proto__ = RootModel.prototype = Object.create( Model && Model.prototype );
  RootModel__proto__.constructor = RootModel;

  RootModel__proto__.attached = function attached (fragment) {
    attachImplicits(this, fragment);
  };

  RootModel__proto__.createLink = function createLink (keypath, target, targetPath, options) {
    var keys = splitKeypath(keypath);

    var model = this;
    while (keys.length) {
      var key = keys.shift();
      model = model.childByKey[key] || model.joinKey(key);
    }

    return model.link(target, targetPath, options);
  };

  RootModel__proto__.detached = function detached () {
    detachImplicits(this);
  };

  RootModel__proto__.get = function get (shouldCapture, options) {
    if (shouldCapture) { capture(this); }

    if (!options || options.virtual !== false) {
      return this.getVirtual();
    } else {
      return this.value;
    }
  };

  RootModel__proto__.getHelpers = function getHelpers () {
    if (!this.helpers) { this.helpers = new SharedModel(this.ractive.helpers, 'helpers', this.ractive); }
    return this.helpers;
  };

  RootModel__proto__.getKeypath = function getKeypath () {
    return '';
  };

  RootModel__proto__.getRactiveModel = function getRactiveModel () {
    return this.ractiveModel || (this.ractiveModel = new RactiveModel(this.ractive));
  };

  RootModel__proto__.getValueChildren = function getValueChildren () {
    var children = Model.prototype.getValueChildren.call(this, this.value);

    this.children.forEach(function (child) {
      if (child._link) {
        var idx = children.indexOf(child);
        if (~idx) { children.splice(idx, 1, child._link); }
        else { children.push(child._link); }
      }
    });

    return children;
  };

  RootModel__proto__.has = function has (key) {
    if (key[0] === '~' && key[1] === '/') { key = key.slice(2); }
    if (specialModels[key] || key === '') { return true; }

    if (Model.prototype.has.call(this, key)) {
      return true;
    } else {
      var unescapedKey = unescapeKey(key);

      // mappings/links and computations
      if (this.childByKey[unescapedKey] && this.childByKey[unescapedKey]._link) { return true; }
    }
  };

  RootModel__proto__.joinKey = function joinKey (key, opts) {
    if (key[0] === '~' && key[1] === '/') { key = key.slice(2); }

    if (key[0] === '@') {
      var fn = specialModels[key];
      if (fn) { return fn(this); }
    } else {
      return Model.prototype.joinKey.call(this, key, opts);
    }
  };

  RootModel__proto__.set = function set (value) {
    // TODO wrapping root node is a baaaad idea. We should prevent this
    var wrapper = this.wrapper;
    if (wrapper) {
      var shouldTeardown = !wrapper.reset || wrapper.reset(value) === false;

      if (shouldTeardown) {
        wrapper.teardown();
        this.wrapper = null;
        this.value = value;
        this.adapt();
      }
    } else {
      this.value = value;
      this.adapt();
    }

    this.deps.forEach(handleChange);
    this.children.forEach(mark);
  };

  RootModel__proto__.retrieve = function retrieve () {
    return this.wrapper ? this.wrapper.get() : this.value;
  };

  RootModel__proto__.teardown = function teardown () {
    Model.prototype.teardown.call(this);
    this.ractiveModel && this.ractiveModel.teardown();
  };

  return RootModel;
}(Model));
RootModel.prototype.update = noop;

function attachImplicits(model, fragment) {
  if (model._link && model._link.implicit && model._link.isDetached()) {
    model.attach(fragment);
  }

  // look for virtual children to relink and cascade
  for (var k in model.childByKey) {
    if (model.value) {
      if (k in model.value) {
        attachImplicits(model.childByKey[k], fragment);
      } else if (!model.childByKey[k]._link || model.childByKey[k]._link.isDetached()) {
        var mdl = resolveReference(fragment, k);
        if (mdl) {
          model.childByKey[k].link(mdl, k, { implicit: true });
        }
      }
    }
  }
}

function detachImplicits(model) {
  if (model._link && model._link.implicit) {
    model.unlink();
  }

  for (var k in model.childByKey) {
    detachImplicits(model.childByKey[k]);
  }
}

function subscribe(instance, options, type) {
  var subs = (instance.constructor[("_" + type)] || []).concat(toPairs(options[type] || []));
  var single = type === 'on' ? 'once' : (type + "Once");

  subs.forEach(function (ref) {
    var target = ref[0];
    var config = ref[1];

    if (isFunction(config)) {
      instance[type](target, config);
    } else if (isObjectType(config) && isFunction(config.handler)) {
      instance[config.once ? single : type](target, config.handler, create(config));
    }
  });
}

var registryNames$1 = [
  'adaptors',
  'components',
  'decorators',
  'easing',
  'events',
  'interpolators',
  'partials',
  'transitions'
];

var protoRegistries = ['computed', 'helpers'];

var uid = 0;

function construct(ractive, options) {
  if (Ractive.DEBUG) { welcome(); }

  initialiseProperties(ractive);
  handleAttributes(ractive);

  // set up event subscribers
  subscribe(ractive, options, 'on');

  // if there's not a delegation setting, inherit from parent if it's not default
  if (
    !hasOwn(options, 'delegate') &&
    ractive.parent &&
    ractive.parent.delegate !== ractive.delegate
  ) {
    ractive.delegate = false;
  }

  // plugins that need to run at construct
  if (isArray(options.use)) {
    ractive.use.apply(ractive, options.use.filter(function (p) { return p.construct; }));
  }

  hooks.construct.fire(ractive, options);
  if (options.onconstruct) { options.onconstruct.call(ractive, getRactiveContext(ractive), options); }

  // Add registries
  var i = registryNames$1.length;
  while (i--) {
    var name = registryNames$1[i];
    ractive[name] = assign(create(ractive.constructor[name] || null), options[name]);
  }

  i = protoRegistries.length;
  while (i--) {
    var name$1 = protoRegistries[i];
    ractive[name$1] = assign(create(ractive.constructor.prototype[name$1]), options[name$1]);
  }

  if (ractive._attributePartial) {
    ractive.partials['extra-attributes'] = ractive._attributePartial;
    delete ractive._attributePartial;
  }

  // Create a viewmodel
  var viewmodel = new RootModel({
    adapt: getAdaptors(ractive, ractive.adapt, options),
    data: dataConfigurator.init(ractive.constructor, ractive, options),
    ractive: ractive
  });

  // once resolved, share the adaptors array between the root model and instance
  ractive.adapt = viewmodel.adaptors;

  ractive.viewmodel = viewmodel;

  for (var k in ractive.computed) {
    compute.call(ractive, k, ractive.computed[k]);
  }
}

function getAdaptors(ractive, protoAdapt, options) {
  protoAdapt = protoAdapt.map(lookup);
  var adapt = ensureArray(options.adapt).map(lookup);

  var srcs = [protoAdapt, adapt];
  if (ractive.parent && !ractive.isolated) {
    srcs.push(ractive.parent.viewmodel.adaptors);
  }

  return combine.apply(null, srcs);

  function lookup(adaptor) {
    if (isString(adaptor)) {
      adaptor = findInViewHierarchy('adaptors', ractive, adaptor);

      if (!adaptor) {
        fatal(missingPlugin(adaptor, 'adaptor'));
      }
    }

    return adaptor;
  }
}

function initialiseProperties(ractive) {
  // Generate a unique identifier, for places where you'd use a weak map if it
  // existed
  ractive._guid = 'r-' + uid++;

  // events
  ractive._subs = create(null);
  ractive._nsSubs = 0;

  // storage for item configuration from instantiation to reset,
  // like dynamic functions or original values
  ractive._config = {};

  // events
  ractive.event = null;
  ractive._eventQueue = [];

  // observers
  ractive._observers = [];

  // external children
  ractive._children = [];
  ractive._children.byName = {};
  ractive.children = ractive._children;

  if (!ractive.component) {
    ractive.root = ractive;
    ractive.parent = ractive.container = null; // TODO container still applicable?
  }
}

function handleAttributes(ractive) {
  var component = ractive.component;
  var attributes = ractive.constructor.attributes;

  if (attributes && component) {
    var tpl = component.template;
    var attrs = tpl.m ? tpl.m.slice() : [];

    // grab all of the passed attribute names
    var props = attrs.filter(function (a) { return a.t === ATTRIBUTE; }).map(function (a) { return a.n; });

    // warn about missing requireds
    attributes.required.forEach(function (p) {
      if (!~props.indexOf(p)) {
        warnIfDebug(("Component '" + (component.name) + "' requires attribute '" + p + "' to be provided"));
      }
    });

    // set up a partial containing non-property attributes
    var all = attributes.optional.concat(attributes.required);
    var partial = [];
    var i = attrs.length;
    while (i--) {
      var a = attrs[i];
      if (a.t === ATTRIBUTE && !~all.indexOf(a.n)) {
        if (attributes.mapAll) {
          // map the attribute if requested and make the extra attribute in the partial refer to the mapping
          partial.unshift({
            t: ATTRIBUTE,
            n: a.n,
            f: [{ t: INTERPOLATOR, r: ("~/" + (a.n)) }]
          });
        } else {
          // transfer the attribute to the extra attributes partal
          partial.unshift(attrs.splice(i, 1)[0]);
        }
      } else if (
        !attributes.mapAll &&
        (a.t === DECORATOR || a.t === TRANSITION || a.t === BINDING_FLAG)
      ) {
        partial.unshift(attrs.splice(i, 1)[0]);
      }
    }

    if (partial.length) { component.template = { t: tpl.t, e: tpl.e, f: tpl.f, m: attrs, p: tpl.p }; }
    ractive._attributePartial = partial;
  }
}

var Component = (function (Item) {
  function Component(options, ComponentConstructor) {
    var this$1 = this;

    Item.call(this, options);
    var template = options.template;
    this.isAnchor = template.t === ANCHOR;
    this.type = this.isAnchor ? ANCHOR : COMPONENT; // override ELEMENT from super
    var attrs = template.m;

    var partials = template.p || {};
    if (!('content' in partials)) { partials.content = template.f || []; }
    this._partials = partials; // TEMP

    if (this.isAnchor) {
      this.name = template.n;

      this.addChild = addChild;
      this.removeChild = removeChild;
    } else {
      var instance = create(ComponentConstructor.prototype);

      this.instance = instance;
      this.name = template.e;

      if (instance.el || instance.target) {
        warnIfDebug(
          ("The <" + (this.name) + "> component has a default '" + (instance.el ? 'el' : 'target') + "' property; it has been disregarded")
        );
        instance.el = instance.target = null;
      }

      // find container
      var fragment = options.up;
      var container;
      while (fragment) {
        if (fragment.owner.type === YIELDER) {
          container = fragment.owner.container;
          break;
        }

        fragment = fragment.parent;
      }

      // add component-instance-specific properties
      instance.parent = this.up.ractive;
      instance.container = container || null;
      instance.root = instance.parent.root;
      instance.component = this;

      construct(this.instance, { partials: partials });

      // these can be modified during construction
      template = this.template;
      attrs = template.m;

      // allow components that are so inclined to add programmatic mappings
      if (isArray(this.mappings)) {
        attrs = (attrs || []).concat(this.mappings);
      } else if (isString(this.mappings)) {
        attrs = (attrs || []).concat(parser.parse(this.mappings, { attributes: true }).t);
      }

      // for hackability, this could be an open option
      // for any ractive instance, but for now, just
      // for components and just for ractive...
      instance._inlinePartials = partials;
    }

    this.attributeByName = {};
    this.attributes = [];

    if (attrs) {
      var leftovers = [];
      attrs.forEach(function (template) {
        switch (template.t) {
          case ATTRIBUTE:
          case EVENT:
            this$1.attributes.push(
              createItem({
                owner: this$1,
                up: this$1.up,
                template: template
              })
            );
            break;

          case TRANSITION:
          case BINDING_FLAG:
          case DECORATOR:
            break;

          default:
            leftovers.push(template);
            break;
        }
      });

      if (leftovers.length) {
        this.attributes.push(
          new ConditionalAttribute({
            owner: this,
            up: this.up,
            template: leftovers
          })
        );
      }
    }

    this.eventHandlers = [];
  }

  if ( Item ) Component.__proto__ = Item;
  var Component__proto__ = Component.prototype = Object.create( Item && Item.prototype );
  Component__proto__.constructor = Component;

  Component__proto__.bind = function bind () {
    if (!this.isAnchor) {
      this.attributes.forEach(bind$1);
      this.eventHandlers.forEach(bind$1);

      initialise(
        this.instance,
        {
          partials: this._partials
        },
        {
          cssIds: this.up.cssIds
        }
      );

      if (this.instance.target || this.instance.el) { this.extern = true; }

      this.bound = true;
    }
  };

  Component__proto__.bubble = function bubble () {
    if (!this.dirty) {
      this.dirty = true;
      this.up.bubble();
    }
  };

  Component__proto__.destroyed = function destroyed () {
    if (!this.isAnchor && this.instance.fragment) { this.instance.fragment.destroyed(); }
  };

  Component__proto__.detach = function detach () {
    if (this.isAnchor) {
      if (this.instance) { return this.instance.fragment.detach(); }
      return createDocumentFragment();
    }

    return this.instance.fragment.detach();
  };

  Component__proto__.find = function find (selector, options) {
    if (this.instance) { return this.instance.fragment.find(selector, options); }
  };

  Component__proto__.findAll = function findAll (selector, options) {
    if (this.instance) { this.instance.fragment.findAll(selector, options); }
  };

  Component__proto__.findComponent = function findComponent (name, options) {
    if (!name || this.name === name) { return this.instance; }

    if (this.instance.fragment) {
      return this.instance.fragment.findComponent(name, options);
    }
  };

  Component__proto__.findAllComponents = function findAllComponents (name, options) {
    var result = options.result;

    if (this.instance && (!name || this.name === name)) {
      result.push(this.instance);
    }

    if (this.instance) { this.instance.findAllComponents(name, options); }
  };

  Component__proto__.firstNode = function firstNode (skipParent) {
    if (this.instance) { return this.instance.fragment.firstNode(skipParent); }
  };

  Component__proto__.getContext = function getContext () {
    var assigns = [], len = arguments.length;
    while ( len-- ) assigns[ len ] = arguments[ len ];

    assigns.unshift(this.instance);
    return getRactiveContext.apply(null, assigns);
  };

  Component__proto__.rebound = function rebound (update$$1) {
    this.attributes.forEach(function (x) { return x.rebound(update$$1); });
  };

  Component__proto__.render = function render$2 (target, occupants) {
    if (this.isAnchor) {
      this.rendered = true;
      this.target = target;

      if (!checking.length) {
        checking.push(this.ractive);
        if (occupants) {
          this.occupants = occupants;
          checkAnchors();
          this.occupants = null;
        } else {
          runloop.scheduleTask(checkAnchors, true);
        }
      }
    } else {
      this.attributes.forEach(render);
      this.eventHandlers.forEach(render);

      if (this.extern) {
        this.instance.delegate = false;
        this.instance.render();
      } else {
        render$1(this.instance, target, null, occupants);
      }

      this.rendered = true;
    }
  };

  Component__proto__.shuffled = function shuffled () {
    Item.prototype.shuffled.call(this);
    this.instance &&
      !this.instance.isolated &&
      this.instance.fragment &&
      this.instance.fragment.shuffled();
  };

  Component__proto__.toString = function toString () {
    if (this.instance) { return this.instance.toHTML(); }
  };

  Component__proto__.unbind = function unbind$1 (view) {
    if (!this.isAnchor) {
      this.bound = false;

      this.attributes.forEach(unbind);

      if (view) { this.instance.fragment.unbind(); }
      else { teardown$1(this.instance, function () { return runloop.promise(); }); }
    }
  };

  Component__proto__.unrender = function unrender$1 (shouldDestroy) {
    this.shouldDestroy = shouldDestroy;

    if (this.isAnchor) {
      if (this.item) { unrenderItem(this, this.item); }
      this.target = null;
      if (!checking.length) {
        checking.push(this.ractive);
        runloop.scheduleTask(checkAnchors, true);
      }
    } else {
      this.instance.unrender();
      this.instance.el = this.instance.target = null;
      this.attributes.forEach(unrender);
      this.eventHandlers.forEach(unrender);
    }

    this.rendered = false;
  };

  Component__proto__.update = function update$2 () {
    this.dirty = false;
    if (this.instance) {
      this.instance.fragment.update();
      this.attributes.forEach(update);
      this.eventHandlers.forEach(update);
    }
  };

  return Component;
}(Item));

function addChild(meta) {
  if (this.item) { this.removeChild(this.item); }

  var child = meta.instance;
  meta.anchor = this;

  meta.up = this.up;
  meta.name = meta.nameOption || this.name;
  this.name = meta.name;

  if (!child.isolated) { child.viewmodel.attached(this.up); }

  // render as necessary
  if (this.rendered) {
    renderItem(this, meta);
  }
}

function removeChild(meta) {
  // unrender as necessary
  if (this.item === meta) {
    unrenderItem(this, meta);
    this.name = this.template.n;
  }
}

function renderItem(anchor, meta) {
  if (!anchor.rendered) { return; }

  meta.shouldDestroy = false;
  meta.up = anchor.up;

  anchor.item = meta;
  anchor.instance = meta.instance;
  var nextNode = anchor.up.findNextNode(anchor);

  if (meta.instance.fragment.rendered) {
    meta.instance.unrender();
  }

  meta.partials = meta.instance.partials;
  meta.instance.partials = assign(create(meta.partials), meta.partials, anchor._partials);

  meta.instance.fragment.unbind(true);
  meta.instance.fragment.componentParent = anchor.up;
  meta.instance.fragment.bind(meta.instance.viewmodel);

  anchor.attributes.forEach(bind$1);
  anchor.eventHandlers.forEach(bind$1);
  anchor.attributes.forEach(render);
  anchor.eventHandlers.forEach(render);

  var target = anchor.up.findParentNode();
  render$1(meta.instance, target, target.contains(nextNode) ? nextNode : null, anchor.occupants);

  if (meta.lastBound !== anchor) {
    meta.lastBound = anchor;
  }
}

function unrenderItem(anchor, meta) {
  if (!anchor.rendered) { return; }

  meta.shouldDestroy = true;
  meta.instance.unrender();

  anchor.eventHandlers.forEach(unrender);
  anchor.attributes.forEach(unrender);
  anchor.eventHandlers.forEach(unbind);
  anchor.attributes.forEach(unbind);

  meta.instance.el = meta.instance.anchor = null;
  meta.instance.fragment.componentParent = null;
  meta.up = null;
  meta.anchor = null;
  anchor.item = null;
  anchor.instance = null;
}

var checking = [];
function checkAnchors() {
  var list = checking;
  checking = [];

  list.forEach(updateAnchors);
}

var ComputationChild = (function (Model) {
  function ComputationChild(parent, key) {
    Model.call(this, parent, key);

    this.isReadonly = !this.root.ractive.syncComputedChildren;
    this.dirty = true;
    this.isComputed = true;
  }

  if ( Model ) ComputationChild.__proto__ = Model;
  var ComputationChild__proto__ = ComputationChild.prototype = Object.create( Model && Model.prototype );
  ComputationChild__proto__.constructor = ComputationChild;

  var prototypeAccessors$1 = { setRoot: {} };

  prototypeAccessors$1.setRoot.get = function () {
    return this.parent.setRoot;
  };

  ComputationChild__proto__.applyValue = function applyValue (value) {
    Model.prototype.applyValue.call(this, value);

    if (!this.isReadonly) {
      var source = this.parent;
      // computed models don't have a shuffle method
      while (source && source.shuffle) {
        source = source.parent;
      }

      if (source) {
        source.dependencies.forEach(mark);
      }
    }

    if (this.setRoot) {
      this.setRoot.set(this.setRoot.value);
    }
  };

  ComputationChild__proto__.get = function get (shouldCapture, opts) {
    if (shouldCapture) { capture(this); }

    if (this.dirty) {
      this.dirty = false;
      var parentValue = this.parent.get();
      this.value = parentValue ? parentValue[this.key] : undefined;
      if (this.wrapper) { this.newWrapperValue = this.value; }
      this.adapt();
    }

    return (opts && 'unwrap' in opts ? opts.unwrap !== false : shouldCapture) && this.wrapper
      ? this.wrapperValue
      : this.value;
  };

  ComputationChild__proto__.handleChange = function handleChange$2 () {
    if (this.dirty) { return; }
    this.dirty = true;

    if (this.boundValue) { this.boundValue = null; }

    this.links.forEach(marked);
    this.deps.forEach(handleChange);
    this.children.forEach(handleChange);
  };

  ComputationChild__proto__.joinKey = function joinKey (key) {
    if (isUndefined(key) || key === '') { return this; }

    if (!hasOwn(this.childByKey, key)) {
      var child = new ComputationChild(this, key);
      this.children.push(child);
      this.childByKey[key] = child;
    }

    return this.childByKey[key];
  };

  Object.defineProperties( ComputationChild__proto__, prototypeAccessors$1 );

  return ComputationChild;
}(Model));

/* global console */
/* eslint no-console:"off" */

var Computation = (function (Model) {
  function Computation(parent, signature, key) {
    Model.call(this, parent, key);

    this.signature = signature;

    this.isReadonly = !this.signature.setter;
    this.isComputed = true;

    this.dependencies = [];

    this.children = [];
    this.childByKey = {};

    this.deps = [];

    this.dirty = true;

    // TODO: is there a less hackish way to do this?
    this.shuffle = undefined;
  }

  if ( Model ) Computation.__proto__ = Model;
  var Computation__proto__ = Computation.prototype = Object.create( Model && Model.prototype );
  Computation__proto__.constructor = Computation;

  var prototypeAccessors$2 = { setRoot: {} };

  prototypeAccessors$2.setRoot.get = function () {
    if (this.signature.setter) { return this; }
  };

  Computation__proto__.get = function get (shouldCapture, opts) {
    if (shouldCapture) { capture(this); }

    if (this.dirty) {
      var old = this.value;
      this.value = this.getValue();
      // this may cause a view somewhere to update, so it must be in a runloop
      if (!runloop.active()) {
        runloop.start();
        if (!isEqual(old, this.value)) { this.notifyUpstream(); }
        runloop.end();
      } else {
        if (!isEqual(old, this.value)) { this.notifyUpstream(); }
      }
      if (this.wrapper) { this.newWrapperValue = this.value; }
      this.adapt();
      this.dirty = false;
    }

    // if capturing, this value needs to be unwrapped because it's for external use
    return maybeBind(
      this,
      // if unwrap is supplied, it overrides capture
      this.wrapper && (opts && 'unwrap' in opts ? opts.unwrap !== false : shouldCapture)
        ? this.wrapperValue
        : this.value,
      !opts || opts.shouldBind !== false
    );
  };

  Computation__proto__.getContext = function getContext () {
    return this.parent.isRoot ? this.root.ractive : this.parent.get(false, noVirtual);
  };

  Computation__proto__.getValue = function getValue () {
    startCapturing();
    var result;

    try {
      result = this.signature.getter.call(this.root.ractive, this.getContext());
    } catch (err) {
      warnIfDebug(("Failed to compute " + (this.getKeypath()) + ": " + (err.message || err)));

      // TODO this is all well and good in Chrome, but...
      // ...also, should encapsulate this stuff better, and only
      // show it if Ractive.DEBUG
      if (hasConsole) {
        if (console.groupCollapsed)
          { console.groupCollapsed(
            '%cshow details',
            'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'
          ); }
        var sig = this.signature;
        console.error(
          ((err.name) + ": " + (err.message) + "\n\n" + (sig.getterString) + (sig.getterUseStack ? '\n\n' + err.stack : ''))
        );
        if (console.groupCollapsed) { console.groupEnd(); }
      }
    }

    var dependencies = stopCapturing();
    if (this.parent.keypath && !~dependencies.indexOf(this.parent)) { dependencies.push(this.parent); }
    this.setDependencies(dependencies);

    return result;
  };

  Computation__proto__.mark = function mark () {
    this.handleChange();
  };

  Computation__proto__.rebind = function rebind (next, previous) {
    // computations will grab all of their deps again automagically
    if (next !== previous) { this.handleChange(); }
  };

  Computation__proto__.set = function set (value) {
    if (this.isReadonly) {
      throw new Error(("Cannot set read-only computed value '" + (this.key) + "'"));
    }

    this.signature.setter(value);
    this.mark();
  };

  Computation__proto__.setDependencies = function setDependencies (dependencies) {
    var this$1 = this;

    // unregister any soft dependencies we no longer have
    var i = this.dependencies.length;
    while (i--) {
      var model = this$1.dependencies[i];
      if (!~dependencies.indexOf(model)) { model.unregister(this$1); }
    }

    // and add any new ones
    i = dependencies.length;
    while (i--) {
      var model$1 = dependencies[i];
      if (!~this$1.dependencies.indexOf(model$1)) { model$1.register(this$1); }
    }

    this.dependencies = dependencies;
  };

  Computation__proto__.teardown = function teardown () {
    var this$1 = this;

    var i = this.dependencies.length;
    while (i--) {
      if (this$1.dependencies[i]) { this$1.dependencies[i].unregister(this$1); }
    }
    if (this.parent.computed[this.key] === this) { delete this.parent.computed[this.key]; }
    Model.prototype.teardown.call(this);
  };

  Object.defineProperties( Computation__proto__, prototypeAccessors$2 );

  return Computation;
}(Model));

var prototype = Computation.prototype;
var child = ComputationChild.prototype;
prototype.handleChange = child.handleChange;
prototype.joinKey = child.joinKey;

shared$1.Computation = Computation;

var ExpressionProxy = (function (Model) {
  function ExpressionProxy(fragment, template) {
    var this$1 = this;

    Model.call(this, fragment.ractive.viewmodel, null);

    this.fragment = fragment;
    this.template = template;

    this.isReadonly = true;
    this.isComputed = true;
    this.dirty = true;

    this.fn =
      fragment.ractive.allowExpressions === false
        ? noop
        : getFunction(template.s, template.r.length);

    this.models = this.template.r.map(function (ref) {
      return resolveReference(this$1.fragment, ref);
    });
    this.dependencies = [];

    this.shuffle = undefined;

    this.bubble();
  }

  if ( Model ) ExpressionProxy.__proto__ = Model;
  var ExpressionProxy__proto__ = ExpressionProxy.prototype = Object.create( Model && Model.prototype );
  ExpressionProxy__proto__.constructor = ExpressionProxy;

  ExpressionProxy__proto__.bubble = function bubble (actuallyChanged) {
    if ( actuallyChanged === void 0 ) actuallyChanged = true;

    // refresh the keypath
    this.keypath = undefined;

    if (actuallyChanged) {
      this.handleChange();
    }
  };

  ExpressionProxy__proto__.getKeypath = function getKeypath () {
    var this$1 = this;

    if (!this.template) { return '@undefined'; }
    if (!this.keypath) {
      this.keypath =
        '@' +
        this.template.s.replace(/_(\d+)/g, function (match, i) {
          if (i >= this$1.models.length) { return match; }

          var model = this$1.models[i];
          return model ? model.getKeypath() : '@undefined';
        });
    }

    return this.keypath;
  };

  ExpressionProxy__proto__.getValue = function getValue () {
    var this$1 = this;

    startCapturing();
    var result;

    try {
      var params = this.models.map(function (m) { return (m ? m.get(true) : undefined); });
      result = this.fn.apply(this.fragment.ractive, params);
    } catch (err) {
      warnIfDebug(("Failed to compute " + (this.getKeypath()) + ": " + (err.message || err)));
    }

    var dependencies = stopCapturing();
    // remove missing deps
    this.dependencies
      .filter(function (d) { return !~dependencies.indexOf(d); })
      .forEach(function (d) {
        d.unregister(this$1);
        removeFromArray(this$1.dependencies, d);
      });
    // register new deps
    dependencies
      .filter(function (d) { return !~this$1.dependencies.indexOf(d); })
      .forEach(function (d) {
        d.register(this$1);
        this$1.dependencies.push(d);
      });

    return result;
  };

  ExpressionProxy__proto__.notifyUpstream = function notifyUpstream () {};

  ExpressionProxy__proto__.rebind = function rebind (next, previous, safe) {
    var idx = this.models.indexOf(previous);

    if (~idx) {
      next = rebindMatch(this.template.r[idx], next, previous);
      if (next !== previous) {
        previous.unregister(this);
        this.models.splice(idx, 1, next);
        if (next) { next.addShuffleRegister(this, 'mark'); }
      }
    }
    this.bubble(!safe);
  };

  ExpressionProxy__proto__.rebound = function rebound (update) {
    var this$1 = this;

    this.models = this.template.r.map(function (ref) { return resolveReference(this$1.fragment, ref); });
    if (update) { this.bubble(true); }
  };

  ExpressionProxy__proto__.retrieve = function retrieve () {
    return this.get();
  };

  ExpressionProxy__proto__.teardown = function teardown () {
    var this$1 = this;

    this.fragment = undefined;
    if (this.dependencies) { this.dependencies.forEach(function (d) { return d.unregister(this$1); }); }
    Model.prototype.teardown.call(this);
  };

  ExpressionProxy__proto__.unreference = function unreference () {
    Model.prototype.unreference.call(this);
    collect(this);
  };

  ExpressionProxy__proto__.unregister = function unregister (dep) {
    Model.prototype.unregister.call(this, dep);
    collect(this);
  };

  ExpressionProxy__proto__.unregisterLink = function unregisterLink (link) {
    Model.prototype.unregisterLink.call(this, link);
    collect(this);
  };

  return ExpressionProxy;
}(Model));

var prototype$1 = ExpressionProxy.prototype;
var computation = Computation.prototype;
prototype$1.get = computation.get;
prototype$1.handleChange = computation.handleChange;
prototype$1.joinKey = computation.joinKey;
prototype$1.mark = computation.mark;
prototype$1.unbind = noop;

function collect(model) {
  if (!model.deps.length && !model.refs && !model.links.length) { model.teardown(); }
}

function setupArgsFn(item, template, fragment, opts) {
  if ( opts === void 0 ) opts = {};

  if (template && template.f && template.f.s) {
    if (opts.register) {
      item.model = new ExpressionProxy(fragment, template.f);
      item.model.register(item);
    } else {
      item.fn = getFunction(template.f.s, template.f.r.length);
    }
  }
}

function resolveArgs(item, template, fragment, opts) {
  if ( opts === void 0 ) opts = {};

  return template.f.r.map(function (ref, i) {
    var model;

    if (opts.specialRef && (model = opts.specialRef(ref, i))) { return model; }

    model = resolveReference(fragment, ref);

    return model;
  });
}

function teardownArgsFn(item) {
  if (item.model) { item.model.unregister(item); }
}

var missingDecorator = {
  update: noop,
  teardown: noop
};

var Decorator = function Decorator(options) {
  this.owner = options.owner || options.up.owner || findElement(options.up);
  this.element = this.owner.attributeByName ? this.owner : findElement(options.up);
  this.up = options.up || this.owner.up;
  this.ractive = this.owner.ractive;
  var template = (this.template = options.template);

  this.name = template.n;

  this.node = null;
  this.handle = null;

  this.element.decorators.push(this);
};
var Decorator__proto__ = Decorator.prototype;

Decorator__proto__.bind = function bind () {
  // if the owner is the elment, make sure the context includes the element
  var frag = this.element === this.owner ? new Fragment({ owner: this.owner }) : this.up;
  setupArgsFn(this, this.template, frag, { register: true });
};

Decorator__proto__.bubble = function bubble () {
  if (!this.dirty) {
    this.dirty = true;
    // decorators may be owned directly by an element or by a fragment if conditional
    this.owner.bubble();
    this.up.bubble();
  }
};

Decorator__proto__.destroyed = function destroyed () {
  if (this.handle) {
    this.handle.teardown();
    this.handle = null;
  }
  this.shouldDestroy = true;
};

Decorator__proto__.handleChange = function handleChange () {
  this.bubble();
};

Decorator__proto__.rebound = function rebound (update) {
  if (this.model) { this.model.rebound(update); }
};

Decorator__proto__.render = function render () {
    var this$1 = this;

  this.shouldDestroy = false;
  if (this.handle) { this.unrender(); }
  runloop.scheduleTask(function () {
    // bail if the host element has managed to become unrendered
    if (!this$1.element.rendered) { return; }

    var fn = findInViewHierarchy('decorators', this$1.ractive, this$1.name);

    if (!fn) {
      warnOnce(missingPlugin(this$1.name, 'decorator'));
      this$1.handle = missingDecorator;
      return;
    }

    this$1.node = this$1.element.node;

    var args = this$1.model ? this$1.model.get() : [];
    this$1.handle = fn.apply(this$1.ractive, [this$1.node].concat(args));

    if (!this$1.handle || !this$1.handle.teardown) {
      throw new Error(
        ("The '" + (this$1.name) + "' decorator must return an object with a teardown method")
      );
    }

    // watch out for decorators that cause their host element to be unrendered
    if (this$1.shouldDestroy) { this$1.destroyed(); }
  }, true);
};

Decorator__proto__.toString = function toString () {
  return '';
};

Decorator__proto__.unbind = function unbind () {
  teardownArgsFn(this, this.template);
};

Decorator__proto__.unrender = function unrender (shouldDestroy) {
  if ((!shouldDestroy || this.element.rendered) && this.handle) {
    this.handle.teardown();
    this.handle = null;
  }
};

Decorator__proto__.update = function update () {
  var instance = this.handle;

  if (!this.dirty) {
    if (instance && instance.invalidate) {
      runloop.scheduleTask(function () { return instance.invalidate(); }, true);
    }
    return;
  }

  this.dirty = false;

  if (instance) {
    if (!instance.update) {
      this.unrender();
      this.render();
    } else {
      var args = this.model ? this.model.get() : [];
      instance.update.apply(this.ractive, args);
    }
  }
};

Decorator.prototype.firstNode = noop;

var Doctype = (function (Item) {
  function Doctype () {
    Item.apply(this, arguments);
  }

  if ( Item ) Doctype.__proto__ = Item;
  var Doctype__proto__ = Doctype.prototype = Object.create( Item && Item.prototype );
  Doctype__proto__.constructor = Doctype;

  Doctype__proto__.toString = function toString () {
    return '<!DOCTYPE' + this.template.a + '>';
  };

  return Doctype;
}(Item));

var proto$2 = Doctype.prototype;
proto$2.bind = proto$2.render = proto$2.teardown = proto$2.unbind = proto$2.unrender = proto$2.update = noop;

var Binding = function Binding(element, name) {
  if ( name === void 0 ) name = 'value';

  this.element = element;
  this.ractive = element.ractive;
  this.attribute = element.attributeByName[name];

  var interpolator = this.attribute.interpolator;
  interpolator.twowayBinding = this;

  var model = interpolator.model;

  if (model.isReadonly && !model.setRoot) {
    var keypath = model.getKeypath().replace(/^@/, '');
    warnOnceIfDebug(
      ("Cannot use two-way binding on <" + (element.name) + "> element: " + keypath + " is read-only. To suppress this warning use <" + (element.name) + " twoway='false'...>"),
      { ractive: this.ractive }
    );
    return false;
  }

  this.attribute.isTwoway = true;
  this.model = model;

  // initialise value, if it's undefined
  var value = model.get();
  this.wasUndefined = isUndefined(value);

  if (isUndefined(value) && this.getInitialValue) {
    value = this.getInitialValue();
    model.set(value);
  }
  this.lastVal(true, value);

  var parentForm = findElement(this.element, false, 'form');
  if (parentForm) {
    this.resetValue = value;
    parentForm.formBindings.push(this);
  }
};
var Binding__proto__ = Binding.prototype;

Binding__proto__.bind = function bind () {
  this.model.registerTwowayBinding(this);
};

Binding__proto__.handleChange = function handleChange () {
    var this$1 = this;

  var value = this.getValue();
  if (this.lastVal() === value) { return; }

  runloop.start();
  this.attribute.locked = true;
  this.model.set(value);
  this.lastVal(true, value);

  // if the value changes before observers fire, unlock to be updatable cause something weird and potentially freezy is up
  if (this.model.get() !== value) { this.attribute.locked = false; }
  else { runloop.scheduleTask(function () { return (this$1.attribute.locked = false); }); }

  runloop.end();
};

Binding__proto__.lastVal = function lastVal (setting, value) {
  if (setting) { this.lastValue = value; }
  else { return this.lastValue; }
};

Binding__proto__.rebind = function rebind (next, previous) {
    var this$1 = this;

  if (this.model && this.model === previous) { previous.unregisterTwowayBinding(this); }
  if (next) {
    this.model = next;
    runloop.scheduleTask(function () { return next.registerTwowayBinding(this$1); });
  }
};

Binding__proto__.rebound = function rebound () {
  if (this.model) { this.model.unregisterTwowayBinding(this); }
  this.model = this.attribute.interpolator.model;
  this.model && this.model.registerTwowayBinding(this);
};

Binding__proto__.render = function render () {
  this.node = this.element.node;
  this.node._ractive.binding = this;
  this.rendered = true; // TODO is this used anywhere?
};

Binding__proto__.setFromNode = function setFromNode (node) {
  this.model.set(node.value);
};

Binding__proto__.unbind = function unbind () {
  this.model && this.model.unregisterTwowayBinding(this);
};

Binding.prototype.unrender = noop;

// This is the handler for DOM events that would lead to a change in the model
// (i.e. change, sometimes, input, and occasionally click and keyup)
function handleDomEvent() {
  this._ractive.binding.handleChange();
}

var CheckboxBinding = (function (Binding) {
  function CheckboxBinding(element) {
    Binding.call(this, element, 'checked');
  }

  if ( Binding ) CheckboxBinding.__proto__ = Binding;
  var CheckboxBinding__proto__ = CheckboxBinding.prototype = Object.create( Binding && Binding.prototype );
  CheckboxBinding__proto__.constructor = CheckboxBinding;

  CheckboxBinding__proto__.render = function render () {
    Binding.prototype.render.call(this);

    this.element.on('change', handleDomEvent);

    if (this.node.attachEvent) {
      this.element.on('click', handleDomEvent);
    }
  };

  CheckboxBinding__proto__.unrender = function unrender () {
    this.element.off('change', handleDomEvent);

    if (this.node.attachEvent) {
      this.element.off('click', handleDomEvent);
    }
  };

  CheckboxBinding__proto__.getInitialValue = function getInitialValue () {
    return !!this.element.getAttribute('checked');
  };

  CheckboxBinding__proto__.getValue = function getValue () {
    return this.node.checked;
  };

  CheckboxBinding__proto__.setFromNode = function setFromNode (node) {
    this.model.set(node.checked);
  };

  return CheckboxBinding;
}(Binding));

function getBindingGroup(group, model, getValue) {
  var hash = group + "-bindingGroup";
  return model[hash] || (model[hash] = new BindingGroup(hash, model, getValue));
}

var BindingGroup = function BindingGroup(hash, model, getValue) {
  var this$1 = this;

  this.model = model;
  this.hash = hash;
  this.getValue = function () {
    this$1.value = getValue.call(this$1);
    return this$1.value;
  };

  this.bindings = [];
};
var BindingGroup__proto__ = BindingGroup.prototype;

BindingGroup__proto__.add = function add (binding) {
  this.bindings.push(binding);
};

BindingGroup__proto__.bind = function bind () {
    var this$1 = this;

  this.value = this.model.get();
  this.bindings.forEach(function (b) { return b.lastVal(true, this$1.value); });
  this.model.registerTwowayBinding(this);
  this.bound = true;
};

BindingGroup__proto__.remove = function remove (binding) {
  removeFromArray(this.bindings, binding);
  if (!this.bindings.length) {
    this.unbind();
  }
};

BindingGroup__proto__.unbind = function unbind () {
  this.model.unregisterTwowayBinding(this);
  this.bound = false;
  delete this.model[this.hash];
};

BindingGroup.prototype.rebind = Binding.prototype.rebind;

var push$1 = [].push;

function getValue() {
  var this$1 = this;

  var all = this.bindings
    .filter(function (b) { return b.node && b.node.checked; })
    .map(function (b) { return b.element.getAttribute('value'); });
  var res = [];
  all.forEach(function (v) {
    if (!this$1.bindings[0].arrayContains(res, v)) { res.push(v); }
  });
  return res;
}

var CheckboxNameBinding = (function (Binding) {
  function CheckboxNameBinding(element) {
    Binding.call(this, element, 'name');

    this.checkboxName = true; // so that ractive.updateModel() knows what to do with this

    // Each input has a reference to an array containing it and its
    // group, as two-way binding depends on being able to ascertain
    // the status of all inputs within the group
    this.group = getBindingGroup('checkboxes', this.model, getValue);
    this.group.add(this);

    if (this.noInitialValue) {
      this.group.noInitialValue = true;
    }

    // If no initial value was set, and this input is checked, we
    // update the model
    if (this.group.noInitialValue && this.element.getAttribute('checked')) {
      var existingValue = this.model.get();
      var bindingValue = this.element.getAttribute('value');

      if (!this.arrayContains(existingValue, bindingValue)) {
        push$1.call(existingValue, bindingValue); // to avoid triggering runloop with array adaptor
      }
    }
  }

  if ( Binding ) CheckboxNameBinding.__proto__ = Binding;
  var CheckboxNameBinding__proto__ = CheckboxNameBinding.prototype = Object.create( Binding && Binding.prototype );
  CheckboxNameBinding__proto__.constructor = CheckboxNameBinding;

  CheckboxNameBinding__proto__.bind = function bind () {
    if (!this.group.bound) {
      this.group.bind();
    }
  };

  CheckboxNameBinding__proto__.getInitialValue = function getInitialValue () {
    // This only gets called once per group (of inputs that
    // share a name), because it only gets called if there
    // isn't an initial value. By the same token, we can make
    // a note of that fact that there was no initial value,
    // and populate it using any `checked` attributes that
    // exist (which users should avoid, but which we should
    // support anyway to avoid breaking expectations)
    this.noInitialValue = true; // TODO are noInitialValue and wasUndefined the same thing?
    return [];
  };

  CheckboxNameBinding__proto__.getValue = function getValue () {
    return this.group.value;
  };

  CheckboxNameBinding__proto__.handleChange = function handleChange () {
    this.isChecked = this.element.node.checked;
    this.group.value = this.model.get().slice();
    var value = this.element.getAttribute('value');
    if (this.isChecked && !this.arrayContains(this.group.value, value)) {
      this.group.value.push(value);
    } else if (!this.isChecked && this.arrayContains(this.group.value, value)) {
      this.removeFromArray(this.group.value, value);
    }
    // make sure super knows there's a change
    this.lastValue = null;
    Binding.prototype.handleChange.call(this);
  };

  CheckboxNameBinding__proto__.render = function render () {
    Binding.prototype.render.call(this);

    var node = this.node;

    var existingValue = this.model.get();
    var bindingValue = this.element.getAttribute('value');

    if (isArray(existingValue)) {
      this.isChecked = this.arrayContains(existingValue, bindingValue);
    } else {
      this.isChecked = this.element.compare(existingValue, bindingValue);
    }
    node.name = '{{' + this.model.getKeypath() + '}}';
    node.checked = this.isChecked;

    this.element.on('change', handleDomEvent);

    // in case of IE emergency, bind to click event as well
    if (this.node.attachEvent) {
      this.element.on('click', handleDomEvent);
    }
  };

  CheckboxNameBinding__proto__.setFromNode = function setFromNode (node) {
    this.group.bindings.forEach(function (binding) { return (binding.wasUndefined = true); });

    if (node.checked) {
      var valueSoFar = this.group.getValue();
      valueSoFar.push(this.element.getAttribute('value'));

      this.group.model.set(valueSoFar);
    }
  };

  CheckboxNameBinding__proto__.unbind = function unbind () {
    this.group.remove(this);
  };

  CheckboxNameBinding__proto__.unrender = function unrender () {
    var el = this.element;

    el.off('change', handleDomEvent);

    if (this.node.attachEvent) {
      el.off('click', handleDomEvent);
    }
  };

  CheckboxNameBinding__proto__.arrayContains = function arrayContains (selectValue, optionValue) {
    var this$1 = this;

    var i = selectValue.length;
    while (i--) {
      if (this$1.element.compare(optionValue, selectValue[i])) { return true; }
    }
    return false;
  };

  CheckboxNameBinding__proto__.removeFromArray = function removeFromArray (array, item) {
    var this$1 = this;

    if (!array) { return; }
    var i = array.length;
    while (i--) {
      if (this$1.element.compare(item, array[i])) {
        array.splice(i, 1);
      }
    }
  };

  return CheckboxNameBinding;
}(Binding));

var ContentEditableBinding = (function (Binding) {
  function ContentEditableBinding () {
    Binding.apply(this, arguments);
  }

  if ( Binding ) ContentEditableBinding.__proto__ = Binding;
  var ContentEditableBinding__proto__ = ContentEditableBinding.prototype = Object.create( Binding && Binding.prototype );
  ContentEditableBinding__proto__.constructor = ContentEditableBinding;

  ContentEditableBinding__proto__.getInitialValue = function getInitialValue () {
    return this.element.fragment ? this.element.fragment.toString() : '';
  };

  ContentEditableBinding__proto__.getValue = function getValue () {
    return this.element.node.innerHTML;
  };

  ContentEditableBinding__proto__.render = function render () {
    Binding.prototype.render.call(this);

    var el = this.element;

    el.on('change', handleDomEvent);
    el.on('blur', handleDomEvent);

    if (!this.ractive.lazy) {
      el.on('input', handleDomEvent);

      if (this.node.attachEvent) {
        el.on('keyup', handleDomEvent);
      }
    }
  };

  ContentEditableBinding__proto__.setFromNode = function setFromNode (node) {
    this.model.set(node.innerHTML);
  };

  ContentEditableBinding__proto__.unrender = function unrender () {
    var el = this.element;

    el.off('blur', handleDomEvent);
    el.off('change', handleDomEvent);
    el.off('input', handleDomEvent);
    el.off('keyup', handleDomEvent);
  };

  return ContentEditableBinding;
}(Binding));

function handleBlur() {
  handleDomEvent.call(this);

  var value = this._ractive.binding.model.get();
  this.value = value == undefined ? '' : value;
}

function handleDelay(delay) {
  var timeout;

  return function() {
    var this$1 = this;

    if (timeout) { clearTimeout(timeout); }

    timeout = setTimeout(function () {
      var binding = this$1._ractive.binding;
      if (binding.rendered) { handleDomEvent.call(this$1); }
      timeout = null;
    }, delay);
  };
}

var GenericBinding = (function (Binding) {
  function GenericBinding () {
    Binding.apply(this, arguments);
  }

  if ( Binding ) GenericBinding.__proto__ = Binding;
  var GenericBinding__proto__ = GenericBinding.prototype = Object.create( Binding && Binding.prototype );
  GenericBinding__proto__.constructor = GenericBinding;

  GenericBinding__proto__.getInitialValue = function getInitialValue () {
    return '';
  };

  GenericBinding__proto__.getValue = function getValue () {
    return this.node.value;
  };

  GenericBinding__proto__.render = function render () {
    Binding.prototype.render.call(this);

    // any lazy setting for this element overrides the root
    // if the value is a number, it's a timeout
    var lazy = this.ractive.lazy;
    var timeout = false;
    var el = this.element;

    if ('lazy' in this.element) {
      lazy = this.element.lazy;
    }

    if (isNumeric(lazy)) {
      timeout = +lazy;
      lazy = false;
    }

    this.handler = timeout ? handleDelay(timeout) : handleDomEvent;

    var node = this.node;

    el.on('change', handleDomEvent);

    if (node.type !== 'file') {
      if (!lazy) {
        el.on('input', this.handler);

        // IE is a special snowflake
        if (node.attachEvent) {
          el.on('keyup', this.handler);
        }
      }

      el.on('blur', handleBlur);
    }
  };

  GenericBinding__proto__.unrender = function unrender () {
    var el = this.element;
    this.rendered = false;

    el.off('change', handleDomEvent);
    el.off('input', this.handler);
    el.off('keyup', this.handler);
    el.off('blur', handleBlur);
  };

  return GenericBinding;
}(Binding));

var FileBinding = (function (GenericBinding) {
  function FileBinding () {
    GenericBinding.apply(this, arguments);
  }

  if ( GenericBinding ) FileBinding.__proto__ = GenericBinding;
  var FileBinding__proto__ = FileBinding.prototype = Object.create( GenericBinding && GenericBinding.prototype );
  FileBinding__proto__.constructor = FileBinding;

  FileBinding__proto__.getInitialValue = function getInitialValue () {
    /* istanbul ignore next */
    return undefined;
  };

  FileBinding__proto__.getValue = function getValue () {
    /* istanbul ignore next */
    return this.node.files;
  };

  FileBinding__proto__.render = function render () {
    /* istanbul ignore next */
    this.element.lazy = false;
    /* istanbul ignore next */
    GenericBinding.prototype.render.call(this);
  };

  FileBinding__proto__.setFromNode = function setFromNode (node) {
    /* istanbul ignore next */
    this.model.set(node.files);
  };

  return FileBinding;
}(GenericBinding));

function getSelectedOptions(select) {
  /* istanbul ignore next */
  return select.selectedOptions
    ? toArray(select.selectedOptions)
    : select.options
    ? toArray(select.options).filter(function (option) { return option.selected; })
    : [];
}

var MultipleSelectBinding = (function (Binding) {
  function MultipleSelectBinding () {
    Binding.apply(this, arguments);
  }

  if ( Binding ) MultipleSelectBinding.__proto__ = Binding;
  var MultipleSelectBinding__proto__ = MultipleSelectBinding.prototype = Object.create( Binding && Binding.prototype );
  MultipleSelectBinding__proto__.constructor = MultipleSelectBinding;

  MultipleSelectBinding__proto__.getInitialValue = function getInitialValue () {
    return this.element.options
      .filter(function (option) { return option.getAttribute('selected'); })
      .map(function (option) { return option.getAttribute('value'); });
  };

  MultipleSelectBinding__proto__.getValue = function getValue () {
    var options = this.element.node.options;
    var len = options.length;

    var selectedValues = [];

    for (var i = 0; i < len; i += 1) {
      var option = options[i];

      if (option.selected) {
        var optionValue = option._ractive ? option._ractive.value : option.value;
        selectedValues.push(optionValue);
      }
    }

    return selectedValues;
  };

  MultipleSelectBinding__proto__.handleChange = function handleChange () {
    var attribute = this.attribute;
    var previousValue = attribute.getValue();

    var value = this.getValue();

    if (isUndefined(previousValue) || !arrayContentsMatch(value, previousValue)) {
      Binding.prototype.handleChange.call(this);
    }

    return this;
  };

  MultipleSelectBinding__proto__.render = function render () {
    Binding.prototype.render.call(this);

    this.element.on('change', handleDomEvent);

    if (isUndefined(this.model.get())) {
      // get value from DOM, if possible
      this.handleChange();
    }
  };

  MultipleSelectBinding__proto__.setFromNode = function setFromNode (node) {
    var selectedOptions = getSelectedOptions(node);
    var i = selectedOptions.length;
    var result = new Array(i);

    while (i--) {
      var option = selectedOptions[i];
      result[i] = option._ractive ? option._ractive.value : option.value;
    }

    this.model.set(result);
  };

  MultipleSelectBinding__proto__.unrender = function unrender () {
    this.element.off('change', handleDomEvent);
  };

  return MultipleSelectBinding;
}(Binding));

var NumericBinding = (function (GenericBinding) {
  function NumericBinding () {
    GenericBinding.apply(this, arguments);
  }

  if ( GenericBinding ) NumericBinding.__proto__ = GenericBinding;
  var NumericBinding__proto__ = NumericBinding.prototype = Object.create( GenericBinding && GenericBinding.prototype );
  NumericBinding__proto__.constructor = NumericBinding;

  NumericBinding__proto__.getInitialValue = function getInitialValue () {
    return undefined;
  };

  NumericBinding__proto__.getValue = function getValue () {
    var value = parseFloat(this.node.value);
    return isNaN(value) ? undefined : value;
  };

  NumericBinding__proto__.setFromNode = function setFromNode (node) {
    var value = parseFloat(node.value);
    if (!isNaN(value)) { this.model.set(value); }
  };

  return NumericBinding;
}(GenericBinding));

var siblings = {};

function getSiblings(hash) {
  return siblings[hash] || (siblings[hash] = []);
}

var RadioBinding = (function (Binding) {
  function RadioBinding(element) {
    Binding.call(this, element, 'checked');

    this.siblings = getSiblings(this.ractive._guid + this.element.getAttribute('name'));
    this.siblings.push(this);
  }

  if ( Binding ) RadioBinding.__proto__ = Binding;
  var RadioBinding__proto__ = RadioBinding.prototype = Object.create( Binding && Binding.prototype );
  RadioBinding__proto__.constructor = RadioBinding;

  RadioBinding__proto__.getValue = function getValue () {
    return this.node.checked;
  };

  RadioBinding__proto__.handleChange = function handleChange () {
    runloop.start();

    this.siblings.forEach(function (binding) {
      binding.model.set(binding.getValue());
    });

    runloop.end();
  };

  RadioBinding__proto__.render = function render () {
    Binding.prototype.render.call(this);

    this.element.on('change', handleDomEvent);

    if (this.node.attachEvent) {
      this.element.on('click', handleDomEvent);
    }
  };

  RadioBinding__proto__.setFromNode = function setFromNode (node) {
    this.model.set(node.checked);
  };

  RadioBinding__proto__.unbind = function unbind () {
    removeFromArray(this.siblings, this);
  };

  RadioBinding__proto__.unrender = function unrender () {
    this.element.off('change', handleDomEvent);

    if (this.node.attachEvent) {
      this.element.off('click', handleDomEvent);
    }
  };

  return RadioBinding;
}(Binding));

function getValue$1() {
  var checked = this.bindings.filter(function (b) { return b.node.checked; });
  if (checked.length > 0) {
    return checked[0].element.getAttribute('value');
  }
}

var RadioNameBinding = (function (Binding) {
  function RadioNameBinding(element) {
    var this$1 = this;

    Binding.call(this, element, 'name');

    this.group = getBindingGroup('radioname', this.model, getValue$1);
    this.group.add(this);

    if (element.checked) {
      this.group.value = this.getValue();
    }

    this.attribute.interpolator.pathChanged = function () { return this$1.updateName(); };
  }

  if ( Binding ) RadioNameBinding.__proto__ = Binding;
  var RadioNameBinding__proto__ = RadioNameBinding.prototype = Object.create( Binding && Binding.prototype );
  RadioNameBinding__proto__.constructor = RadioNameBinding;

  RadioNameBinding__proto__.bind = function bind () {
    if (!this.group.bound) {
      this.group.bind();
    }
  };

  RadioNameBinding__proto__.getInitialValue = function getInitialValue () {
    if (this.element.getAttribute('checked')) {
      return this.element.getAttribute('value');
    }
  };

  RadioNameBinding__proto__.getValue = function getValue () {
    return this.element.getAttribute('value');
  };

  RadioNameBinding__proto__.handleChange = function handleChange () {
    // If this <input> is the one that's checked, then the value of its
    // `name` model gets set to its value
    if (this.node.checked) {
      this.group.value = this.getValue();
      Binding.prototype.handleChange.call(this);
    }

    this.updateName();
  };

  RadioNameBinding__proto__.lastVal = function lastVal (setting, value) {
    if (!this.group) { return; }
    if (setting) { this.group.lastValue = value; }
    else { return this.group.lastValue; }
  };

  RadioNameBinding__proto__.rebind = function rebind (next, previous) {
    Binding.prototype.rebind.call(this, next, previous);
    this.updateName();
  };

  RadioNameBinding__proto__.rebound = function rebound (update) {
    Binding.prototype.rebound.call(this, update);
    this.updateName();
  };

  RadioNameBinding__proto__.render = function render () {
    Binding.prototype.render.call(this);

    var node = this.node;

    this.updateName();
    node.checked = this.element.compare(this.model.get(), this.element.getAttribute('value'));

    this.element.on('change', handleDomEvent);

    if (node.attachEvent) {
      this.element.on('click', handleDomEvent);
    }
  };

  RadioNameBinding__proto__.setFromNode = function setFromNode (node) {
    if (node.checked) {
      this.group.model.set(this.element.getAttribute('value'));
    }
  };

  RadioNameBinding__proto__.unbind = function unbind () {
    this.group.remove(this);
  };

  RadioNameBinding__proto__.unrender = function unrender () {
    var el = this.element;

    el.off('change', handleDomEvent);

    if (this.node.attachEvent) {
      el.off('click', handleDomEvent);
    }
  };

  RadioNameBinding__proto__.updateName = function updateName () {
    if (this.node) { this.node.name = "{{" + (this.model.getKeypath()) + "}}"; }
  };

  return RadioNameBinding;
}(Binding));

var SingleSelectBinding = (function (Binding) {
  function SingleSelectBinding () {
    Binding.apply(this, arguments);
  }

  if ( Binding ) SingleSelectBinding.__proto__ = Binding;
  var SingleSelectBinding__proto__ = SingleSelectBinding.prototype = Object.create( Binding && Binding.prototype );
  SingleSelectBinding__proto__.constructor = SingleSelectBinding;

  SingleSelectBinding__proto__.forceUpdate = function forceUpdate () {
    var this$1 = this;

    var value = this.getValue();

    if (value !== undefined) {
      this.attribute.locked = true;
      runloop.scheduleTask(function () { return (this$1.attribute.locked = false); });
      this.model.set(value);
    }
  };

  SingleSelectBinding__proto__.getInitialValue = function getInitialValue () {
    if (this.element.getAttribute('value') !== undefined) {
      return;
    }

    var options = this.element.options;
    var len = options.length;

    if (!len) { return; }

    var value;
    var optionWasSelected;
    var i = len;

    // take the final selected option...
    while (i--) {
      var option = options[i];

      if (option.getAttribute('selected')) {
        if (!option.getAttribute('disabled')) {
          value = option.getAttribute('value');
        }

        optionWasSelected = true;
        break;
      }
    }

    // or the first non-disabled option, if none are selected
    if (!optionWasSelected) {
      while (++i < len) {
        if (!options[i].getAttribute('disabled')) {
          value = options[i].getAttribute('value');
          break;
        }
      }
    }

    // This is an optimisation (aka hack) that allows us to forgo some
    // other more expensive work
    // TODO does it still work? seems at odds with new architecture
    if (value !== undefined) {
      this.element.attributeByName.value.value = value;
    }

    return value;
  };

  SingleSelectBinding__proto__.getValue = function getValue () {
    var options = this.node.options;
    var len = options.length;

    var i;
    for (i = 0; i < len; i += 1) {
      var option = options[i];

      if (options[i].selected && !options[i].disabled) {
        return option._ractive ? option._ractive.value : option.value;
      }
    }
  };

  SingleSelectBinding__proto__.render = function render () {
    Binding.prototype.render.call(this);
    this.element.on('change', handleDomEvent);
  };

  SingleSelectBinding__proto__.setFromNode = function setFromNode (node) {
    var option = getSelectedOptions(node)[0];
    this.model.set(option._ractive ? option._ractive.value : option.value);
  };

  SingleSelectBinding__proto__.unrender = function unrender () {
    this.element.off('change', handleDomEvent);
  };

  return SingleSelectBinding;
}(Binding));

function isBindable(attribute) {
  // The fragment must be a single non-string fragment
  if (
    !attribute ||
    !attribute.template.f ||
    attribute.template.f.length !== 1 ||
    attribute.template.f[0].s
  )
    { return false; }

  // A binding is an interpolator `{{ }}`, yey.
  if (attribute.template.f[0].t === INTERPOLATOR) { return true; }

  // The above is probably the only true case. For the rest, show an appropriate
  // warning before returning false.

  // You can't bind a triple curly. HTML values on an attribute makes no sense.
  if (attribute.template.f[0].t === TRIPLE)
    { warnIfDebug('It is not possible create a binding using a triple mustache.'); }

  return false;
}

function selectBinding(element) {
  var name = element.name;
  var attributes = element.attributeByName;
  if (name !== 'input' && name !== 'textarea' && name !== 'select' && !attributes.contenteditable)
    { return; }
  var isBindableByValue = isBindable(attributes.value);
  var isBindableByContentEditable = isBindable(attributes.contenteditable);
  var isContentEditable = element.getAttribute('contenteditable');

  // contenteditable
  // Bind if the contenteditable is true or a binding that may become true.
  if ((isContentEditable || isBindableByContentEditable) && isBindableByValue)
    { return ContentEditableBinding; }

  // <input>
  if (name === 'input') {
    var type = element.getAttribute('type');

    if (type === 'radio') {
      var isBindableByName = isBindable(attributes.name);
      var isBindableByChecked = isBindable(attributes.checked);

      // For radios we can either bind the name or checked, but not both.
      // Name binding is handed instead.
      if (isBindableByName && isBindableByChecked) {
        warnIfDebug(
          'A radio input can have two-way binding on its name attribute, or its checked attribute - not both',
          { ractive: element.root }
        );
        return RadioNameBinding;
      }

      if (isBindableByName) { return RadioNameBinding; }

      if (isBindableByChecked) { return RadioBinding; }

      // Dead end. Unknown binding on radio input.
      return null;
    }

    if (type === 'checkbox') {
      var isBindableByName$1 = isBindable(attributes.name);
      var isBindableByChecked$1 = isBindable(attributes.checked);

      // A checkbox with bindings for both name and checked. Checked treated as
      // the checkbox value, name is treated as a regular binding.
      //
      // See https://github.com/ractivejs/ractive/issues/1749
      if (isBindableByName$1 && isBindableByChecked$1) { return CheckboxBinding; }

      if (isBindableByName$1) { return CheckboxNameBinding; }

      if (isBindableByChecked$1) { return CheckboxBinding; }

      // Dead end. Unknown binding on checkbox input.
      return null;
    }

    if (type === 'file' && isBindableByValue) { return FileBinding; }

    if (type === 'number' && isBindableByValue) { return NumericBinding; }

    if (type === 'range' && isBindableByValue) { return NumericBinding; }

    // Some input of unknown type (browser usually falls back to text).
    if (isBindableByValue) { return GenericBinding; }

    // Dead end. Some unknown input and an unbindable.
    return null;
  }

  // <select>
  if (name === 'select' && isBindableByValue) {
    return element.getAttribute('multiple') ? MultipleSelectBinding : SingleSelectBinding;
  }

  // <textarea>
  if (name === 'textarea' && isBindableByValue) { return GenericBinding; }

  // Dead end. Some unbindable element.
  return null;
}

var endsWithSemi = /;\s*$/;

var Element = (function (ContainerItem) {
  function Element(options) {
    var this$1 = this;

    ContainerItem.call(this, options);

    this.name = options.template.e.toLowerCase();

    // find parent element
    this.parent = findElement(this.up, false);

    if (this.parent && this.parent.name === 'option') {
      throw new Error(
        ("An <option> element cannot contain other elements (encountered <" + (this.name) + ">)")
      );
    }

    this.decorators = [];

    // create attributes
    this.attributeByName = {};

    var attrs;
    var n, attr, val, cls, name, template, leftovers;

    var m = this.template.m;
    var len = (m && m.length) || 0;

    for (var i = 0; i < len; i++) {
      template = m[i];
      if (template.g) {
        (this$1.statics || (this$1.statics = {}))[template.n] = isString(template.f)
          ? template.f
          : template.n;
      } else {
        switch (template.t) {
          case ATTRIBUTE:
          case BINDING_FLAG:
          case DECORATOR:
          case EVENT:
          case TRANSITION:
            attr = createItem({
              owner: this$1,
              up: this$1.up,
              template: template
            });

            n = template.n;

            attrs = attrs || (attrs = this$1.attributes = []);

            if (n === 'value') { val = attr; }
            else if (n === 'name') { name = attr; }
            else if (n === 'class') { cls = attr; }
            else { attrs.push(attr); }

            break;

          case DELEGATE_FLAG:
            this$1.delegate = false;
            break;

          default:
            (leftovers || (leftovers = [])).push(template);
            break;
        }
      }
    }

    if (val) { attrs.push(val); }
    if (name) { attrs.push(name); }
    if (cls) { attrs.unshift(cls); }

    if (leftovers) {
      (attrs || (this.attributes = [])).push(
        new ConditionalAttribute({
          owner: this,
          up: this.up,
          template: leftovers
        })
      );

      // empty leftovers array
      leftovers = [];
    }

    // create children
    if (options.template.f && !options.deferContent) {
      this.fragment = new Fragment({
        template: options.template.f,
        owner: this,
        cssIds: null
      });
    }

    this.binding = null; // filled in later
  }

  if ( ContainerItem ) Element.__proto__ = ContainerItem;
  var Element__proto__ = Element.prototype = Object.create( ContainerItem && ContainerItem.prototype );
  Element__proto__.constructor = Element;

  Element__proto__.bind = function bind () {
    var attrs = this.attributes;
    if (attrs) {
      attrs.binding = true;
      var len = attrs.length;
      for (var i = 0; i < len; i++) { attrs[i].bind(); }
      attrs.binding = false;
    }

    if (this.fragment) { this.fragment.bind(); }

    // create two-way binding if necessary
    if (!this.binding) { this.recreateTwowayBinding(); }
    else { this.binding.bind(); }
  };

  Element__proto__.createTwowayBinding = function createTwowayBinding () {
    if ('twoway' in this ? this.twoway : this.ractive.twoway) {
      var Binding = selectBinding(this);
      if (Binding) {
        var binding = new Binding(this);
        if (binding && binding.model) { return binding; }
      }
    }
  };

  Element__proto__.destroyed = function destroyed$1 () {
    if (this.attributes) { this.attributes.forEach(destroyed); }
    if (this.fragment) { this.fragment.destroyed(); }
  };

  Element__proto__.detach = function detach () {
    // if this element is no longer rendered, the transitions are complete and the attributes can be torn down
    if (!this.rendered) { this.destroyed(); }

    return detachNode(this.node);
  };

  Element__proto__.find = function find (selector, options) {
    if (this.node && matches(this.node, selector)) { return this.node; }
    if (this.fragment) {
      return this.fragment.find(selector, options);
    }
  };

  Element__proto__.findAll = function findAll (selector, options) {
    var result = options.result;

    if (matches(this.node, selector)) {
      result.push(this.node);
    }

    if (this.fragment) {
      this.fragment.findAll(selector, options);
    }
  };

  Element__proto__.findNextNode = function findNextNode () {
    return null;
  };

  Element__proto__.firstNode = function firstNode () {
    return this.node;
  };

  Element__proto__.getAttribute = function getAttribute (name) {
    if (this.statics && name in this.statics) { return this.statics[name]; }
    var attribute = this.attributeByName[name];
    return attribute ? attribute.getValue() : undefined;
  };

  Element__proto__.getContext = function getContext () {
    var assigns = [], len = arguments.length;
    while ( len-- ) assigns[ len ] = arguments[ len ];

    if (this.fragment) { return (ref = this.fragment).getContext.apply(ref, assigns); }

    if (!this.ctx) { this.ctx = new Context(this.up, this); }
    assigns.unshift(create(this.ctx));
    return assign.apply(null, assigns);
    var ref;
  };

  Element__proto__.off = function off (event, callback, capture) {
    if ( capture === void 0 ) capture = false;

    var delegate = this.up.delegate;
    var ref = this.listeners && this.listeners[event];

    if (!ref) { return; }
    removeFromArray(ref, callback);

    if (delegate) {
      var listeners =
        (delegate.listeners || (delegate.listeners = [])) &&
        (delegate.listeners[event] || (delegate.listeners[event] = []));
      if (listeners.refs && !--listeners.refs) { delegate.off(event, delegateHandler, true); }
    } else if (this.rendered) {
      var n = this.node;
      var add = n.addEventListener;
      var rem = n.removeEventListener;

      if (!ref.length) {
        rem.call(n, event, handler, capture);
      } else if (ref.length && !ref.refs && capture) {
        rem.call(n, event, handler, true);
        add.call(n, event, handler, false);
      }
    }
  };

  Element__proto__.on = function on (event, callback, capture) {
    if ( capture === void 0 ) capture = false;

    var delegate = this.up.delegate;
    var ref = (this.listeners || (this.listeners = {}))[event] || (this.listeners[event] = []);

    if (delegate) {
      var listeners =
        ((delegate.listeners || (delegate.listeners = [])) && delegate.listeners[event]) ||
        (delegate.listeners[event] = []);
      if (!listeners.refs) {
        listeners.refs = 0;
        delegate.on(event, delegateHandler, true);
        listeners.refs++;
      } else {
        listeners.refs++;
      }
    } else if (this.rendered) {
      var n = this.node;
      var add = n.addEventListener;
      var rem = n.removeEventListener;

      if (!ref.length) {
        add.call(n, event, handler, capture);
      } else if (ref.length && !ref.refs && capture) {
        rem.call(n, event, handler, false);
        add.call(n, event, handler, true);
      }
    }

    addToArray(this.listeners[event], callback);
  };

  Element__proto__.recreateTwowayBinding = function recreateTwowayBinding () {
    if (this.binding) {
      this.binding.unbind();
      this.binding.unrender();
    }

    if ((this.binding = this.createTwowayBinding())) {
      this.binding.bind();
      if (this.rendered) { this.binding.render(); }
    }
  };

  Element__proto__.rebound = function rebound (update$$1) {
    ContainerItem.prototype.rebound.call(this, update$$1);
    if (this.attributes) { this.attributes.forEach(function (x) { return x.rebound(update$$1); }); }
    if (this.binding) { this.binding.rebound(update$$1); }
  };

  Element__proto__.render = function render (target, occupants) {
    var this$1 = this;

    // TODO determine correct namespace
    this.namespace = getNamespace(this);

    var node;
    var existing = false;

    if (occupants) {
      var n;
      while ((n = occupants.shift())) {
        if (
          n.nodeName.toUpperCase() === this$1.template.e.toUpperCase() &&
          n.namespaceURI === this$1.namespace
        ) {
          this$1.node = node = n;
          existing = true;
          break;
        } else {
          detachNode(n);
        }
      }
    }

    if (!existing && this.node) {
      node = this.node;
      target.appendChild(node);
      existing = true;
    }

    if (!node) {
      var name = this.template.e;
      node = createElement(
        this.namespace === html ? name.toLowerCase() : name,
        this.namespace,
        this.getAttribute('is')
      );
      this.node = node;
    }

    // tie the node to this vdom element
    defineProperty(node, '_ractive', {
      value: {
        proxy: this
      },
      configurable: true
    });

    if (this.statics) {
      keys(this.statics).forEach(function (k) {
        node.setAttribute(k, this$1.statics[k]);
      });
    }

    if (existing && this.foundNode) { this.foundNode(node); }

    // register intro before rendering content so children can find the intro
    var intro = this.intro;
    if (intro && intro.shouldFire('intro')) {
      intro.isIntro = true;
      intro.isOutro = false;
      runloop.registerTransition(intro);
    }

    if (this.fragment) {
      var children = existing ? toArray(node.childNodes) : undefined;

      this.fragment.render(node, children);

      // clean up leftover children
      if (children) {
        children.forEach(detachNode);
      }
    }

    if (existing) {
      // store initial values for two-way binding
      if (this.binding && this.binding.wasUndefined) { this.binding.setFromNode(node); }
      // remove unused attributes
      var i = node.attributes.length;
      while (i--) {
        var name$1 = node.attributes[i].name;
        if (!(name$1 in this$1.attributeByName) && (!this$1.statics || !(name$1 in this$1.statics)))
          { node.removeAttribute(name$1); }
      }
    }

    // Is this a top-level node of a component? If so, we may need to add
    // a data-ractive-css attribute, for CSS encapsulation
    if (this.up.cssIds) {
      node.setAttribute('data-ractive-css', this.up.cssIds.map(function (x) { return ("{" + x + "}"); }).join(' '));
    }

    if (this.attributes) {
      var len = this.attributes.length;
      for (var i$1 = 0; i$1 < len; i$1++) { this$1.attributes[i$1].render(); }
    }
    if (this.binding) { this.binding.render(); }

    if (!this.up.delegate && this.listeners) {
      var ls = this.listeners;
      for (var k in ls) {
        if (ls[k] && ls[k].length) { this$1.node.addEventListener(k, handler, !!ls[k].refs); }
      }
    }

    if (!existing) {
      target.appendChild(node);
    }

    this.rendered = true;
  };

  Element__proto__.toString = function toString () {
    var this$1 = this;

    var tagName = this.template.e;

    var attrs = (this.attributes && this.attributes.map(stringifyAttribute).join('')) || '';

    if (this.statics)
      { keys(this.statics).forEach(
        function (k) { return k !== 'class' &&
          k !== 'style' &&
          (attrs = " " + k + "=\"" + (safeAttributeString(this$1.statics[k])) + "\"" + attrs); }
      ); }

    // Special case - selected options
    if (this.name === 'option' && this.isSelected()) {
      attrs += ' selected';
    }

    // Special case - two-way radio name bindings
    if (this.name === 'input' && inputIsCheckedRadio(this)) {
      attrs += ' checked';
    }

    // Special case style and class attributes and directives
    var style = this.statics ? this.statics.style : undefined;
    var cls = this.statics ? this.statics.class : undefined;
    this.attributes &&
      this.attributes.forEach(function (attr) {
        if (attr.name === 'class') {
          cls = (cls || '') + (cls ? ' ' : '') + safeAttributeString(attr.getString());
        } else if (attr.name === 'style') {
          style = (style || '') + (style ? ' ' : '') + safeAttributeString(attr.getString());
          if (style && !endsWithSemi.test(style)) { style += ';'; }
        } else if (attr.style) {
          style =
            (style || '') +
            (style ? ' ' : '') +
            (attr.style) + ": " + (safeAttributeString(attr.getString())) + ";";
        } else if (attr.inlineClass && attr.getValue()) {
          cls = (cls || '') + (cls ? ' ' : '') + attr.inlineClass;
        }
      });
    // put classes first, then inline style
    if (style !== undefined) { attrs = ' style' + (style ? ("=\"" + style + "\"") : '') + attrs; }
    if (cls !== undefined) { attrs = ' class' + (cls ? ("=\"" + cls + "\"") : '') + attrs; }

    if (this.up.cssIds) {
      attrs += " data-ractive-css=\"" + (this.up.cssIds.map(function (x) { return ("{" + x + "}"); }).join(' ')) + "\"";
    }

    var str = "<" + tagName + attrs + ">";

    if (voidElements[this.name.toLowerCase()]) { return str; }

    // Special case - textarea
    if (this.name === 'textarea' && this.getAttribute('value') !== undefined) {
      str += escapeHtml(this.getAttribute('value'));
    } else if (this.getAttribute('contenteditable') !== undefined) {
      // Special case - contenteditable
      str += this.getAttribute('value') || '';
    }

    if (this.fragment) {
      str += this.fragment.toString(!/^(?:script|style)$/i.test(this.template.e)); // escape text unless script/style
    }

    str += "</" + tagName + ">";
    return str;
  };

  Element__proto__.unbind = function unbind (view) {
    var attrs = this.attributes;
    if (attrs) {
      attrs.unbinding = true;
      var len = attrs.length;
      for (var i = 0; i < len; i++) { attrs[i].unbind(view); }
      attrs.unbinding = false;
    }

    if (this.binding) { this.binding.unbind(view); }
    if (this.fragment) { this.fragment.unbind(view); }
  };

  Element__proto__.unrender = function unrender (shouldDestroy) {
    if (!this.rendered) { return; }
    this.rendered = false;

    // unrendering before intro completed? complete it now
    // TODO should be an API for aborting transitions
    var transition = this.intro;
    if (transition && transition.complete) { transition.complete(); }

    // Detach as soon as we can
    if (this.name === 'option') {
      // <option> elements detach immediately, so that
      // their parent <select> element syncs correctly, and
      // since option elements can't have transitions anyway
      this.detach();
    } else if (shouldDestroy) {
      runloop.detachWhenReady(this);
    }

    // outro transition
    var outro = this.outro;
    if (outro && outro.shouldFire('outro')) {
      outro.isIntro = false;
      outro.isOutro = true;
      runloop.registerTransition(outro);
    }

    if (this.fragment) { this.fragment.unrender(); }

    if (this.binding) { this.binding.unrender(); }
  };

  Element__proto__.update = function update () {
    if (this.dirty) {
      this.dirty = false;

      var attrs = this.attributes;
      if (attrs) {
        var len = attrs.length;
        for (var i = 0; i < len; i++) { attrs[i].update(); }
      }

      if (this.fragment) { this.fragment.update(); }
    }
  };

  return Element;
}(ContainerItem));

function inputIsCheckedRadio(element) {
  var nameAttr = element.attributeByName.name;
  return (
    element.getAttribute('type') === 'radio' &&
    (nameAttr || {}).interpolator &&
    element.getAttribute('value') === nameAttr.interpolator.model.get()
  );
}

function stringifyAttribute(attribute) {
  var str = attribute.toString();
  return str ? ' ' + str : '';
}

function getNamespace(element) {
  // Use specified namespace...
  var xmlns$$1 = element.getAttribute('xmlns');
  if (xmlns$$1) { return xmlns$$1; }

  // ...or SVG namespace, if this is an <svg> element
  if (element.name === 'svg') { return svg$1; }

  var parent = element.parent;

  if (parent) {
    // ...or HTML, if the parent is a <foreignObject>
    if (parent.name === 'foreignobject') { return html; }

    // ...or inherit from the parent node
    return parent.node.namespaceURI;
  }

  return element.ractive.el.namespaceURI;
}

function delegateHandler(ev) {
  var name = ev.type;
  var end = ev.currentTarget;
  var endEl = end._ractive && end._ractive.proxy;
  var node = ev.target;
  var bubble = true;
  var listeners;

  // starting with the origin node, walk up the DOM looking for ractive nodes with a matching event listener
  while (bubble && node && node !== end) {
    var proxy = node._ractive && node._ractive.proxy;
    if (proxy && proxy.up.delegate === endEl && shouldFire(ev, node, end)) {
      listeners = proxy.listeners && proxy.listeners[name];

      if (listeners) {
        var len = listeners.length;
        for (var i = 0; i < len; i++) { bubble = listeners[i].call(node, ev) !== false && bubble; }
      }
    }

    node = node.parentNode || node.correspondingUseElement; // SVG with a <use> element in certain environments
  }

  return bubble;
}

var UIEvent = win !== null ? win.UIEvent : null;
function shouldFire(event, start, end) {
  if (UIEvent && event instanceof UIEvent) {
    var node = start;
    while (node && node !== end) {
      if (node.disabled) { return false; }
      node = node.parentNode || node.correspondingUseElement;
    }
  }

  return true;
}

function handler(ev) {
  var this$1 = this;

  var el = this._ractive.proxy;
  var listeners;
  if (el.listeners && (listeners = el.listeners[ev.type])) {
    var len = listeners.length;
    for (var i = 0; i < len; i++) { listeners[i].call(this$1, ev); }
  }
}

var Form = (function (Element) {
  function Form(options) {
    Element.call(this, options);
    this.formBindings = [];
  }

  if ( Element ) Form.__proto__ = Element;
  var Form__proto__ = Form.prototype = Object.create( Element && Element.prototype );
  Form__proto__.constructor = Form;

  Form__proto__.render = function render (target, occupants) {
    Element.prototype.render.call(this, target, occupants);
    this.on('reset', handleReset);
  };

  Form__proto__.unrender = function unrender (shouldDestroy) {
    this.off('reset', handleReset);
    Element.prototype.unrender.call(this, shouldDestroy);
  };

  return Form;
}(Element));

function handleReset() {
  var element = this._ractive.proxy;

  runloop.start();
  element.formBindings.forEach(updateModel);
  runloop.end();
}

function updateModel(binding) {
  binding.model.set(binding.resetValue);
}

var DOMEvent = function DOMEvent(name, owner) {
  if (name.indexOf('*') !== -1) {
    fatal(
      ("Only component proxy-events may contain \"*\" wildcards, <" + (owner.name) + " on-" + name + "=\"...\"/> is not valid")
    );
  }

  this.name = name;
  this.owner = owner;
  this.handler = null;
};
var DOMEvent__proto__ = DOMEvent.prototype;

DOMEvent__proto__.bind = function bind () {};

DOMEvent__proto__.render = function render (directive) {
    var this$1 = this;

  var name = this.name;

  var register = function () {
    var node = this$1.owner.node;

    this$1.owner.on(
      name,
      (this$1.handler = function (event) {
        return directive.fire({
          node: node,
          original: event,
          event: event,
          name: name
        });
      })
    );
  };

  if (name !== 'load') {
    // schedule events so that they take place after twoway binding
    runloop.scheduleTask(register, true);
  } else {
    // unless its a load event
    register();
  }
};

DOMEvent__proto__.unbind = function unbind () {};

DOMEvent__proto__.unrender = function unrender () {
  if (this.handler) { this.owner.off(this.name, this.handler); }
};

var CustomEvent = function CustomEvent(eventPlugin, owner, name, args) {
  this.eventPlugin = eventPlugin;
  this.owner = owner;
  this.name = name;
  this.handler = null;
  this.args = args;
};
var CustomEvent__proto__ = CustomEvent.prototype;

CustomEvent__proto__.bind = function bind () {};

CustomEvent__proto__.render = function render (directive) {
    var this$1 = this;

  runloop.scheduleTask(function () {
    var node = this$1.owner.node;

    this$1.handler = this$1.eventPlugin.apply(
      this$1.owner.ractive,
      [
        node,
        function (event) {
            if ( event === void 0 ) event = {};

          if (event.original) { event.event = event.original; }
          else { event.original = event.event; }

          event.name = this$1.name;
          event.node = event.node || node;
          return directive.fire(event);
        }
      ].concat(this$1.args || [])
    );
  });
};

CustomEvent__proto__.unbind = function unbind () {};

CustomEvent__proto__.unrender = function unrender () {
  this.handler.teardown();
};

var RactiveEvent = function RactiveEvent(component, name) {
  this.component = component;
  this.name = name;
  this.handler = null;
};
var RactiveEvent__proto__ = RactiveEvent.prototype;

RactiveEvent__proto__.bind = function bind (directive) {
  var ractive = this.component.instance;

  this.handler = ractive.on(this.name, function () {
      var args = [], len = arguments.length;
      while ( len-- ) args[ len ] = arguments[ len ];

    // watch for reproxy
    if (args[0] instanceof Context) {
      var ctx = args.shift();
      ctx.component = ractive;
      directive.fire(ctx, args);
    } else {
      directive.fire({}, args);
    }

    // cancel bubbling
    return false;
  });
};

RactiveEvent__proto__.render = function render () {};

RactiveEvent__proto__.unbind = function unbind () {
  this.handler.cancel();
};

RactiveEvent__proto__.unrender = function unrender () {};

var specialPattern = /^(event|arguments|@node|@event|@context)(\..+)?$/;
var dollarArgsPattern = /^\$(\d+)(\..+)?$/;

var EventDirective = function EventDirective(options) {
  this.owner = options.owner || options.up.owner || findElement(options.up);
  this.element = this.owner.attributeByName ? this.owner : findElement(options.up, true);
  this.template = options.template;
  this.up = options.up;
  this.ractive = options.up.ractive;
  this.events = [];
};
var EventDirective__proto__ = EventDirective.prototype;

EventDirective__proto__.bind = function bind () {
    var this$1 = this;

  // sometimes anchors will cause an unbind without unrender
  if (this.events.length) {
    this.events.forEach(function (e) { return e.unrender(); });
    this.events = [];
  }

  if (this.element.type === COMPONENT || this.element.type === ANCHOR) {
    this.template.n.forEach(function (n) {
      this$1.events.push(new RactiveEvent(this$1.element, n));
    });
  } else {
    var args;
    if ((args = this.template.a)) {
      var rs = args.r.map(function (r) {
        var model = resolveReference(this$1.up, r);
        return model ? model.get() : undefined;
      });
      try {
        args = getFunction(args.s, rs.length).apply(null, rs);
      } catch (err) {
        args = null;
        warnIfDebug(
          ("Failed to compute args for event on-" + (this.template.n.join('- ')) + ": " + (err.message ||
            err))
        );
      }
    }

    this.template.n.forEach(function (n) {
      var fn = findInViewHierarchy('events', this$1.ractive, n);
      if (fn) {
        this$1.events.push(new CustomEvent(fn, this$1.element, n, args));
      } else {
        this$1.events.push(new DOMEvent(n, this$1.element));
      }
    });
  }

  // method calls
  this.models = null;

  addToArray(this.element.events || (this.element.events = []), this);

  setupArgsFn(this, this.template);
  if (!this.fn) { this.action = this.template.f; }

  this.events.forEach(function (e) { return e.bind(this$1); });
};

EventDirective__proto__.destroyed = function destroyed () {
  this.events.forEach(function (e) { return e.unrender(); });
};

EventDirective__proto__.fire = function fire (event, args) {
    var this$1 = this;
    if ( args === void 0 ) args = [];

  var context =
    event instanceof Context && event.refire ? event : this.element.getContext(event);

  if (this.fn) {
    var values = [];

    var models = resolveArgs(this, this.template, this.up, {
      specialRef: function specialRef(ref) {
        var specialMatch = specialPattern.exec(ref);
        if (specialMatch) {
          // on-click="foo(event.node)"
          return {
            special: specialMatch[1],
            keys: specialMatch[2] ? splitKeypath(specialMatch[2].substr(1)) : []
          };
        }

        var dollarMatch = dollarArgsPattern.exec(ref);
        if (dollarMatch) {
          // on-click="foo($1)"
          return {
            special: 'arguments',
            keys: [dollarMatch[1] - 1].concat(
              dollarMatch[2] ? splitKeypath(dollarMatch[2].substr(1)) : []
            )
          };
        }
      }
    });

    if (models) {
      models.forEach(function (model) {
        if (!model) { return values.push(undefined); }

        if (model.special) {
          var which = model.special;
          var obj;

          if (which === '@node') {
            obj = this$1.element.node;
          } else if (which === '@event') {
            obj = event && event.event;
          } else if (which === 'event') {
            warnOnceIfDebug(
              "The event reference available to event directives is deprecated and should be replaced with @context and @event"
            );
            obj = context;
          } else if (which === '@context') {
            obj = context;
          } else {
            obj = args;
          }

          var keys = model.keys.slice();

          while (obj && keys.length) { obj = obj[keys.shift()]; }
          return values.push(obj);
        }

        if (model.wrapper) {
          return values.push(model.wrapperValue);
        }

        values.push(model.get());
      });
    }

    // make event available as `this.event`
    var ractive = this.ractive;
    var oldEvent = ractive.event;

    ractive.event = context;
    var returned = this.fn.apply(ractive, values);
    var result = returned.pop();

    // Auto prevent and stop if return is explicitly false
    if (result === false) {
      var original = event ? event.original : undefined;
      if (original) {
        original.preventDefault && original.preventDefault();
        original.stopPropagation && original.stopPropagation();
      } else {
        warnOnceIfDebug(
          ("handler '" + (this.template.n.join(
            ' '
          )) + "' returned false, but there is no event available to cancel")
        );
      }
    } else if (!returned.length && isArray(result) && isString(result[0])) {
      // watch for proxy events
      result = fireEvent(this.ractive, result.shift(), context, result);
    }

    ractive.event = oldEvent;

    return result;
  } else {
    return fireEvent(this.ractive, this.action, context, args);
  }
};

EventDirective__proto__.handleChange = function handleChange () {};

EventDirective__proto__.render = function render () {
    var this$1 = this;

  this.events.forEach(function (e) { return e.render(this$1); });
};

EventDirective__proto__.toString = function toString () {
  return '';
};

EventDirective__proto__.unbind = function unbind (view) {
  removeFromArray(this.element.events, this);
  this.events.forEach(function (e) { return e.unbind(view); });
};

EventDirective__proto__.unrender = function unrender () {
  this.events.forEach(function (e) { return e.unrender(); });
};

var proto$3 = EventDirective.prototype;
proto$3.firstNode = proto$3.rebound = proto$3.update = noop;

function progressiveText(item, target, occupants, text) {
  if (occupants) {
    var n = occupants[0];
    if (n && n.nodeType === 3) {
      var idx = n.nodeValue.indexOf(text);
      occupants.shift();

      if (idx === 0) {
        if (n.nodeValue.length !== text.length) {
          occupants.unshift(n.splitText(text.length));
        }
      } else {
        n.nodeValue = text;
      }
    } else {
      n = item.node = doc.createTextNode(text);
      if (occupants[0]) {
        target.insertBefore(n, occupants[0]);
      } else {
        target.appendChild(n);
      }
    }

    item.node = n;
  } else {
    if (!item.node) { item.node = doc.createTextNode(text); }
    target.appendChild(item.node);
  }
}

var ReferenceExpressionProxy = (function (LinkModel) {
  function ReferenceExpressionProxy(fragment, template) {
    LinkModel.call(this, null, null, null, '@undefined');
    this.root = fragment.ractive.viewmodel;
    this.template = template;
    this.rootLink = true;
    this.template = template;
    this.fragment = fragment;

    this.rebound();
  }

  if ( LinkModel ) ReferenceExpressionProxy.__proto__ = LinkModel;
  var ReferenceExpressionProxy__proto__ = ReferenceExpressionProxy.prototype = Object.create( LinkModel && LinkModel.prototype );
  ReferenceExpressionProxy__proto__.constructor = ReferenceExpressionProxy;

  ReferenceExpressionProxy__proto__.getKeypath = function getKeypath () {
    return this.model ? this.model.getKeypath() : '@undefined';
  };

  ReferenceExpressionProxy__proto__.rebound = function rebound () {
    var this$1 = this;

    var fragment = this.fragment;
    var template = this.template;

    var base = (this.base = resolve(fragment, template));
    var idx;

    if (this.proxy) {
      teardown$2(this);
    }

    var proxy = (this.proxy = {
      rebind: function (next, previous) {
        if (previous === base) {
          next = rebindMatch(template, next, previous);
          if (next !== base) {
            this$1.base = base = next;
          }
        } else if (~(idx = members.indexOf(previous))) {
          next = rebindMatch(template.m[idx].n, next, previous);
          if (next !== members[idx]) {
            members.splice(idx, 1, next || Missing);
          }
        }

        if (next !== previous) {
          previous.unregister(proxy);
          if (next) { next.addShuffleTask(function () { return next.register(proxy); }); }
        }
      },
      handleChange: function () {
        pathChanged();
      }
    });

    base.register(proxy);

    var members = (this.members = template.m.map(function (tpl) {
      if (isString(tpl)) {
        return { get: function () { return tpl; } };
      }

      var model;

      if (tpl.t === REFERENCE) {
        model = resolveReference(fragment, tpl.n);
        model.register(proxy);

        return model;
      }

      model = new ExpressionProxy(fragment, tpl);
      model.register(proxy);
      return model;
    }));

    var pathChanged = function () {
      var model =
        base &&
        base.joinAll(
          members.reduce(function (list, m) {
            var k = m.get();
            if (isArray(k)) { return list.concat(k); }
            else { list.push(escapeKey(String(k))); }
            return list;
          }, [])
        );

      if (model !== this$1.model) {
        this$1.model = model;
        this$1.relinking(model);
        fireShuffleTasks();
        refreshPathDeps(this$1);
      }
    };

    pathChanged();
  };

  ReferenceExpressionProxy__proto__.teardown = function teardown () {
    teardown$2(this);
    LinkModel.prototype.teardown.call(this);
  };

  ReferenceExpressionProxy__proto__.unreference = function unreference () {
    LinkModel.prototype.unreference.call(this);
    if (!this.deps.length && !this.refs) { this.teardown(); }
  };

  ReferenceExpressionProxy__proto__.unregister = function unregister (dep) {
    LinkModel.prototype.unregister.call(this, dep);
    if (!this.deps.length && !this.refs) { this.teardown(); }
  };

  return ReferenceExpressionProxy;
}(LinkModel));

function teardown$2(proxy) {
  if (proxy.base) { proxy.base.unregister(proxy.proxy); }
  if (proxy.models) {
    proxy.models.forEach(function (m) {
      if (m.unregister) { m.unregister(proxy); }
    });
  }
}

function refreshPathDeps(proxy) {
  var len = proxy.deps.length;
  var i, v;

  for (i = 0; i < len; i++) {
    v = proxy.deps[i];
    if (v.pathChanged) { v.pathChanged(); }
    if (v.fragment && v.fragment.pathModel) { v.fragment.pathModel.applyValue(proxy.getKeypath()); }
  }

  len = proxy.children.length;
  for (i = 0; i < len; i++) {
    refreshPathDeps(proxy.children[i]);
  }
}

var eproto = ExpressionProxy.prototype;
var proto$4 = ReferenceExpressionProxy.prototype;

proto$4.unreference = eproto.unreference;
proto$4.unregister = eproto.unregister;
proto$4.unregisterLink = eproto.unregisterLink;

function resolve(fragment, template) {
  if (template.r) {
    return resolveReference(fragment, template.r);
  } else if (template.x) {
    return new ExpressionProxy(fragment, template.x);
  } else if (template.rx) {
    return new ReferenceExpressionProxy(fragment, template.rx);
  }
}

var Mustache = (function (Item) {
  function Mustache(options) {
    Item.call(this, options);

    if (options.owner) { this.parent = options.owner; }

    this.isStatic = !!options.template.s;

    this.model = null;
    this.dirty = false;
  }

  if ( Item ) Mustache.__proto__ = Item;
  var Mustache__proto__ = Mustache.prototype = Object.create( Item && Item.prototype );
  Mustache__proto__.constructor = Mustache;

  Mustache__proto__.bind = function bind (pre) {
    // yield mustaches and inner contexts should resolve in container context
    var start = this.template.y
      ? this.template.y.containerFragment
      : this.containerFragment || this.up;
    // try to find a model for this view
    var model = pre || resolve(start, this.template);

    if (model) {
      var value = model.get();

      if (this.isStatic) {
        this.model = { get: function () { return value; } };
        model.unreference();
        return;
      }

      model.register(this);
      this.model = model;
    }
  };

  Mustache__proto__.handleChange = function handleChange () {
    this.bubble();
  };

  Mustache__proto__.rebind = function rebind (next, previous, safe) {
    if (this.isStatic) { return; }

    next = rebindMatch(this.template, next, previous, this.up);
    if (next === this.model) { return false; }

    if (this.model) {
      this.model.unregister(this);
    }
    if (next) { next.addShuffleRegister(this, 'mark'); }
    this.model = next;
    if (!safe) { this.handleChange(); }
    return true;
  };

  Mustache__proto__.rebound = function rebound (update) {
    if (this.model) {
      if (this.model.rebound) { this.model.rebound(update); }
      else {
        // check to see if the model actually changed...
        // yield mustaches and inner contexts should resolve in container context
        var start = this.template.y
          ? this.template.y.containerFragment
          : this.containerFragment || this.up;
        // try to find a model for this view
        var model = resolve(start, this.template);
        if (model !== this.model) {
          this.model.unregister(this);
          this.bind(model);
        }
      }

      if (update) { this.bubble(); }
    }
    if (this.fragment) { this.fragment.rebound(update); }
  };

  Mustache__proto__.unbind = function unbind () {
    if (!this.isStatic) {
      this.model && this.model.unregister(this);
      this.model = undefined;
    }
  };

  return Mustache;
}(Item));

function MustacheContainer(options) {
  Mustache.call(this, options);
}

var proto$5 = (MustacheContainer.prototype = Object.create(ContainerItem.prototype));

assign(proto$5, Mustache.prototype, { constructor: MustacheContainer });

var Interpolator = (function (Mustache) {
  function Interpolator () {
    Mustache.apply(this, arguments);
  }

  if ( Mustache ) Interpolator.__proto__ = Mustache;
  var Interpolator__proto__ = Interpolator.prototype = Object.create( Mustache && Mustache.prototype );
  Interpolator__proto__.constructor = Interpolator;

  Interpolator__proto__.bubble = function bubble () {
    if (this.owner) { this.owner.bubble(); }
    Mustache.prototype.bubble.call(this);
  };

  Interpolator__proto__.detach = function detach () {
    return detachNode(this.node);
  };

  Interpolator__proto__.firstNode = function firstNode () {
    return this.node;
  };

  Interpolator__proto__.getString = function getString () {
    return this.model ? safeToStringValue(this.model.get()) : '';
  };

  Interpolator__proto__.render = function render (target, occupants) {
    if (inAttributes()) { return; }
    var value = (this.value = this.getString());

    this.rendered = true;

    progressiveText(this, target, occupants, value);
  };

  Interpolator__proto__.toString = function toString (escape) {
    var string = this.getString();
    return escape ? escapeHtml(string) : string;
  };

  Interpolator__proto__.unrender = function unrender (shouldDestroy) {
    if (shouldDestroy) { this.detach(); }
    this.rendered = false;
  };

  Interpolator__proto__.update = function update () {
    if (this.dirty) {
      this.dirty = false;
      if (this.rendered) {
        var value = this.getString();
        if (value !== this.value) { this.node.data = this.value = value; }
      }
    }
  };

  Interpolator__proto__.valueOf = function valueOf () {
    return this.model ? this.model.get() : undefined;
  };

  return Interpolator;
}(Mustache));

var Input = (function (Element) {
  function Input () {
    Element.apply(this, arguments);
  }

  if ( Element ) Input.__proto__ = Element;
  var Input__proto__ = Input.prototype = Object.create( Element && Element.prototype );
  Input__proto__.constructor = Input;

  Input__proto__.render = function render (target, occupants) {
    Element.prototype.render.call(this, target, occupants);
    this.node.defaultValue = this.node.value;
  };
  Input__proto__.compare = function compare (value, attrValue) {
    var comparator = this.getAttribute('value-comparator');
    if (comparator) {
      if (isFunction(comparator)) {
        return comparator(value, attrValue);
      }
      if (value && attrValue) {
        return value[comparator] == attrValue[comparator];
      }
    }
    return value == attrValue;
  };

  return Input;
}(Element));

// simple JSON parser, without the restrictions of JSON parse
// (i.e. having to double-quote keys).
//
// If passed a hash of values as the second argument, ${placeholders}
// will be replaced with those values

var specials$1 = {
  true: true,
  false: false,
  null: null,
  undefined: undefined
};

var specialsPattern = new RegExp('^(?:' + keys(specials$1).join('|') + ')');
var numberPattern$1 = /^(?:[+-]?)(?:(?:(?:0|[1-9]\d*)?\.\d+)|(?:(?:0|[1-9]\d*)\.)|(?:0|[1-9]\d*))(?:[eE][+-]?\d+)?/;
var placeholderPattern = /\$\{([^\}]+)\}/g;
var placeholderAtStartPattern = /^\$\{([^\}]+)\}/;
var onlyWhitespace$1 = /^\s*$/;

var JsonParser = Parser.extend({
  init: function init(str, options) {
    this.values = options.values;
    this.sp();
  },

  postProcess: function postProcess(result) {
    if (result.length !== 1 || !onlyWhitespace$1.test(this.leftover)) {
      return null;
    }

    return { value: result[0].v };
  },

  converters: [
    function getPlaceholder(parser) {
      if (!parser.values) { return null; }

      var placeholder = parser.matchPattern(placeholderAtStartPattern);

      if (placeholder && hasOwn(parser.values, placeholder)) {
        return { v: parser.values[placeholder] };
      }
    },

    function getSpecial(parser) {
      var special = parser.matchPattern(specialsPattern);
      if (special) { return { v: specials$1[special] }; }
    },

    function getNumber(parser) {
      var number = parser.matchPattern(numberPattern$1);
      if (number) { return { v: +number }; }
    },

    function getString(parser) {
      var stringLiteral = readStringLiteral(parser);
      var values = parser.values;

      if (stringLiteral && values) {
        return {
          v: stringLiteral.v.replace(placeholderPattern, function (match, $1) { return $1 in values ? values[$1] : $1; }
          )
        };
      }

      return stringLiteral;
    },

    function getObject(parser) {
      if (!parser.matchString('{')) { return null; }

      var result = {};

      parser.sp();

      if (parser.matchString('}')) {
        return { v: result };
      }

      var pair;
      while ((pair = getKeyValuePair(parser))) {
        result[pair.key] = pair.value;

        parser.sp();

        if (parser.matchString('}')) {
          return { v: result };
        }

        if (!parser.matchString(',')) {
          return null;
        }
      }

      return null;
    },

    function getArray(parser) {
      if (!parser.matchString('[')) { return null; }

      var result = [];

      parser.sp();

      if (parser.matchString(']')) {
        return { v: result };
      }

      var valueToken;
      while ((valueToken = parser.read())) {
        result.push(valueToken.v);

        parser.sp();

        if (parser.matchString(']')) {
          return { v: result };
        }

        if (!parser.matchString(',')) {
          return null;
        }

        parser.sp();
      }

      return null;
    }
  ]
});

function getKeyValuePair(parser) {
  parser.sp();

  var key = readKey(parser);

  if (!key) { return null; }

  var pair = { key: key };

  parser.sp();
  if (!parser.matchString(':')) {
    return null;
  }
  parser.sp();

  var valueToken = parser.read();

  if (!valueToken) { return null; }

  pair.value = valueToken.v;
  return pair;
}

function parseJSON(str, values) {
  var parser = new JsonParser(str, { values: values });
  return parser.result;
}

var Mapping = (function (Item) {
  function Mapping(options) {
    Item.call(this, options);

    this.name = options.template.n;

    this.owner = options.owner || options.up.owner || options.element || findElement(options.up);
    this.element =
      options.element || (this.owner.attributeByName ? this.owner : findElement(options.up));
    this.up = this.element.up; // shared
    this.ractive = this.up.ractive;

    this.element.attributeByName[this.name] = this;

    this.value = options.template.f;
  }

  if ( Item ) Mapping.__proto__ = Item;
  var Mapping__proto__ = Mapping.prototype = Object.create( Item && Item.prototype );
  Mapping__proto__.constructor = Mapping;

  Mapping__proto__.bind = function bind () {
    var template = this.template.f;
    var viewmodel = this.element.instance.viewmodel;

    if (template === 0) {
      // empty attributes are `true`
      viewmodel.joinKey(this.name).set(true);
    } else if (isString(template)) {
      var parsed = parseJSON(template);
      viewmodel.joinKey(this.name).set(parsed ? parsed.value : template);
    } else if (isArray(template)) {
      createMapping(this, true);
    }
  };

  Mapping__proto__.rebound = function rebound (update) {
    if (this.boundFragment) { this.boundFragment.rebound(update); }
    if (this.link) {
      this.model = resolve(this.up, this.template.f[0]);
      var model = this.element.instance.viewmodel.joinAll(splitKeypath(this.name));
      model.link(this.model, this.name, { mapping: true });
    }
  };

  Mapping__proto__.render = function render () {};

  Mapping__proto__.unbind = function unbind (view) {
    if (this.model) { this.model.unregister(this); }
    if (this.boundFragment) { this.boundFragment.unbind(view); }

    if (this.element.bound) {
      if (this.link.target === this.model) { this.link.owner.unlink(); }
    }
  };

  Mapping__proto__.unrender = function unrender () {};

  Mapping__proto__.update = function update () {
    if (this.dirty) {
      this.dirty = false;
      if (this.boundFragment) { this.boundFragment.update(); }
    }
  };

  return Mapping;
}(Item));

function createMapping(item) {
  var template = item.template.f;
  var viewmodel = item.element.instance.viewmodel;
  var childData = viewmodel.value;

  if (template.length === 1 && template[0].t === INTERPOLATOR) {
    var model = resolve(item.up, template[0]);
    var val = model.get(false);

    // if the interpolator is not static
    if (!template[0].s) {
      item.model = model;
      item.link = viewmodel.createLink(item.name, model, template[0].r, {
        mapping: true
      });

      // initialize parent side of the mapping from child data
      if (isUndefined(val) && !model.isReadonly && item.name in childData) {
        model.set(childData[item.name]);
      }
    } else if (!isObjectType(val) || template[0].x) {
      // copy non-object, non-computed vals through
      viewmodel.joinKey(splitKeypath(item.name)).set(val);
    } else {
      // warn about trying to copy an object
      warnIfDebug(("Cannot copy non-computed object value from static mapping '" + (item.name) + "'"));
    }

    // if the item isn't going to manage the model, give it a change to tear down if it's computed
    if (model !== item.model) { model.unregister(); }
  } else {
    item.boundFragment = new Fragment({
      owner: item,
      template: template
    }).bind();

    item.model = viewmodel.joinKey(splitKeypath(item.name));
    item.model.set(item.boundFragment.valueOf());

    // item is a *bit* of a hack
    item.boundFragment.bubble = function () {
      Fragment.prototype.bubble.call(item.boundFragment);
      // defer this to avoid mucking around model deps if there happens to be an expression involved
      runloop.scheduleTask(function () {
        item.boundFragment.update();
        item.model.set(item.boundFragment.valueOf());
      });
    };
  }
}

var Option = (function (Element) {
  function Option(options) {
    var template = options.template;
    if (!template.a) { template.a = {}; }

    // If the value attribute is missing, use the element's content,
    // as long as it isn't disabled
    if (isUndefined(template.a.value) && !('disabled' in template.a)) {
      template.a.value = template.f || '';
    }

    Element.call(this, options);

    this.select = findElement(this.parent || this.up, false, 'select');
  }

  if ( Element ) Option.__proto__ = Element;
  var Option__proto__ = Option.prototype = Object.create( Element && Element.prototype );
  Option__proto__.constructor = Option;

  Option__proto__.bind = function bind () {
    if (!this.select) {
      Element.prototype.bind.call(this);
      return;
    }

    // If the select has a value, it overrides the `selected` attribute on
    // this option - so we delete the attribute
    var selectedAttribute = this.attributeByName.selected;
    if (selectedAttribute && this.select.getAttribute('value') !== undefined) {
      var index = this.attributes.indexOf(selectedAttribute);
      this.attributes.splice(index, 1);
      delete this.attributeByName.selected;
    }

    Element.prototype.bind.call(this);
    this.select.options.push(this);
  };

  Option__proto__.bubble = function bubble () {
    // if we're using content as value, may need to update here
    var value = this.getAttribute('value');
    if (this.node && this.node.value !== value) {
      this.node._ractive.value = value;
    }
    Element.prototype.bubble.call(this);
  };

  Option__proto__.getAttribute = function getAttribute (name) {
    var attribute = this.attributeByName[name];
    return attribute
      ? attribute.getValue()
      : name === 'value' && this.fragment
      ? this.fragment.valueOf()
      : undefined;
  };

  Option__proto__.isSelected = function isSelected () {
    var this$1 = this;

    var optionValue = this.getAttribute('value');

    if (isUndefined(optionValue) || !this.select) {
      return false;
    }

    var selectValue = this.select.getAttribute('value');

    if (this.select.compare(selectValue, optionValue)) {
      return true;
    }

    if (this.select.getAttribute('multiple') && isArray(selectValue)) {
      var i = selectValue.length;
      while (i--) {
        if (this$1.select.compare(selectValue[i], optionValue)) {
          return true;
        }
      }
    }
  };

  Option__proto__.render = function render (target, occupants) {
    Element.prototype.render.call(this, target, occupants);

    if (!this.attributeByName.value) {
      this.node._ractive.value = this.getAttribute('value');
    }
  };

  Option__proto__.unbind = function unbind (view) {
    Element.prototype.unbind.call(this, view);

    if (this.select) {
      removeFromArray(this.select.options, this);
    }
  };

  return Option;
}(Element));

function getPartialTemplate(ractive, name, up) {
  // If the partial in instance or view heirarchy instances, great
  var partial = getPartialFromRegistry(ractive, name, up || {});
  if (partial) { return partial; }

  // Does it exist on the page as a script tag?
  partial = parser.fromId(name, { noThrow: true });
  if (partial) {
    // parse and register to this ractive instance
    var parsed = parser.parseFor(partial, ractive);

    // register extra partials on the ractive instance if they don't already exist
    if (parsed.p) { fillGaps(ractive.partials, parsed.p); }

    // register (and return main partial if there are others in the template)
    return (ractive.partials[name] = parsed.t);
  }
}

function getPartialFromRegistry(ractive, name, up) {
  // if there was an instance up-hierarchy, cool
  var partial = findParentPartial(name, up.owner);
  if (partial) { return partial; }

  // find first instance in the ractive or view hierarchy that has this partial
  var instance = findInstance('partials', ractive, name);

  if (!instance) {
    return;
  }

  partial = instance.partials[name];

  // partial is a function?
  var fn;
  if (isFunction(partial)) {
    fn = partial;
    // super partial
    if (fn.styleSet) { return fn; }

    fn = partial.bind(instance);
    fn.isOwner = hasOwn(instance.partials, name);
    partial = fn.call(ractive, parser);
  }

  if (!partial && partial !== '') {
    warnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', {
      ractive: ractive
    });
    return;
  }

  // If this was added manually to the registry,
  // but hasn't been parsed, parse it now
  if (!parser.isParsed(partial)) {
    // use the parseOptions of the ractive instance on which it was found
    var parsed = parser.parseFor(partial, instance);

    // Partials cannot contain nested partials!
    // TODO add a test for this
    if (parsed.p) {
      warnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });
    }

    // if fn, use instance to store result, otherwise needs to go
    // in the correct point in prototype chain on instance or constructor
    var target = fn ? instance : findOwner(instance, name);

    // may be a template with partials, which need to be registered and main template extracted
    target.partials[name] = partial = parsed.t;
  }

  // store for reset
  if (fn) { partial._fn = fn; }

  // if the partial is a pre-parsed template object, import any expressions and update the registry
  if (partial.v) {
    addFunctions(partial);
    return (instance.partials[name] = partial.t);
  } else {
    return partial;
  }
}

function findOwner(ractive, key) {
  return hasOwn(ractive.partials, key) ? ractive : findConstructor(ractive.constructor, key);
}

function findConstructor(constructor, key) {
  if (!constructor) {
    return;
  }
  return hasOwn(constructor.partials, key) ? constructor : findConstructor(constructor.Parent, key);
}

function findParentPartial(name, parent) {
  if (parent) {
    if (
      parent.template &&
      parent.template.p &&
      !isArray(parent.template.p) &&
      hasOwn(parent.template.p, name)
    ) {
      return parent.template.p[name];
    } else if (parent.up && parent.up.owner) {
      return findParentPartial(name, parent.up.owner);
    }
  }
}

function Partial(options) {
  MustacheContainer.call(this, options);

  var tpl = options.template;

  // yielder is a special form of partial that will later require special handling
  if (tpl.t === YIELDER) {
    this.yielder = 1;
  } else if (tpl.t === ELEMENT) {
    // this is a macro partial, complete with macro constructor
    // leaving this as an element will confuse up-template searches
    this.type = PARTIAL;
    this.macro = options.macro;
  }
}

var proto$6 = (Partial.prototype = create(MustacheContainer.prototype));

assign(proto$6, {
  constructor: Partial,

  bind: function bind() {
    var template = this.template;

    if (this.yielder) {
      // the container is the instance that owns this node
      this.container = this.up.ractive;
      this.component = this.container.component;
      this.containerFragment = this.up;

      // normal component
      if (this.component) {
        // yields skip the owning instance and go straight to the surrounding context
        this.up = this.component.up;

        // {{yield}} is equivalent to {{yield content}}
        if (!template.r && !template.x && !template.rx) { this.refName = 'content'; }
      } else {
        // plain-ish instance that may be attached to a parent later
        this.fragment = new Fragment({
          owner: this,
          template: []
        });
        this.fragment.bind();
        return;
      }
    }

    // this is a macro/super partial
    if (this.macro) {
      this.fn = this.macro;
    } else {
      // this is a plain partial or yielder
      if (!this.refName) { this.refName = template.r; }

      // if the refName exists as a partial, this is a plain old partial reference where no model binding will happen
      if (this.refName) {
        partialFromValue(this, this.refName);
      }

      // this is a dynamic/inline partial
      if (!this.partial && !this.fn) {
        MustacheContainer.prototype.bind.call(this);
        if (this.model) { partialFromValue(this, this.model.get()); }
      }
    }

    if (!this.partial && !this.fn) {
      warnOnceIfDebug(("Could not find template for partial '" + (this.name) + "'"));
    }

    createFragment(this, this.partial || []);

    // macro/super partial
    if (this.fn) { initMacro(this); }

    this.fragment.bind();
  },

  bubble: function bubble() {
    if (!this.dirty) {
      this.dirty = true;

      if (this.yielder) {
        this.containerFragment.bubble();
      } else {
        this.up.bubble();
      }
    }
  },

  findNextNode: function findNextNode() {
    return (this.containerFragment || this.up).findNextNode(this);
  },

  handleChange: function handleChange() {
    this.dirtyTemplate = true;
    this.externalChange = true;
    this.bubble();
  },

  rebound: function rebound(update) {
    var this$1 = this;

    if (this._attrs) {
      keys(this._attrs).forEach(function (k) { return this$1._attrs[k].rebound(update); });
    }
    MustacheContainer.prototype.rebound.call(this, update);
  },

  refreshAttrs: function refreshAttrs() {
    var this$1 = this;

    keys(this._attrs).forEach(function (k) {
      this$1.handle.attributes[k] = !this$1._attrs[k].items.length || this$1._attrs[k].valueOf();
    });
  },

  resetTemplate: function resetTemplate() {
    var this$1 = this;

    if (this.fn && this.proxy) {
      this.last = 0;
      if (this.externalChange) {
        if (isFunction(this.proxy.teardown)) { this.proxy.teardown(); }
        this.fn = this.proxy = null;
      } else {
        this.partial = this.fnTemplate;
        return true;
      }
    }

    this.partial = null;

    if (this.refName) {
      this.partial = getPartialTemplate(this.ractive, this.refName, this.up);
    }

    if (!this.partial && this.model) {
      partialFromValue(this, this.model.get());
    }

    if (!this.fn) {
      if (this.last && this.partial === this.last) { return false; }
      else if (this.partial) {
        this.last = this.partial;
        contextifyTemplate(this);
      }
    }

    this.unbindAttrs();

    if (this.fn) {
      initMacro(this);
      if (isFunction(this.proxy.render)) { runloop.scheduleTask(function () { return this$1.proxy.render(); }); }
    } else if (!this.partial) {
      warnOnceIfDebug(("Could not find template for partial '" + (this.name) + "'"));
    }

    return true;
  },

  render: function render(target, occupants) {
    if (this.fn && this.fn._cssDef && !this.fn._cssDef.applied) { applyCSS(); }

    this.fragment.render(target, occupants);

    if (this.proxy && isFunction(this.proxy.render)) { this.proxy.render(); }
  },

  unbind: function unbind(view) {
    this.fragment.unbind(view);

    this.unbindAttrs(view);

    MustacheContainer.prototype.unbind.call(this, view);
  },

  unbindAttrs: function unbindAttrs(view) {
    var this$1 = this;

    if (this._attrs) {
      keys(this._attrs).forEach(function (k) {
        this$1._attrs[k].unbind(view);
      });
    }
  },

  unrender: function unrender(shouldDestroy) {
    if (this.proxy && isFunction(this.proxy.teardown)) { this.proxy.teardown(); }

    this.fragment.unrender(shouldDestroy);
  },

  update: function update() {
    var this$1 = this;

    var proxy = this.proxy;
    this.updating = 1;

    if (this.dirtyAttrs) {
      this.dirtyAttrs = false;
      keys(this._attrs).forEach(function (k) { return this$1._attrs[k].update(); });
      this.refreshAttrs();
      if (isFunction(proxy.update)) { proxy.update(this.handle.attributes); }
    }

    if (this.dirtyTemplate) {
      this.dirtyTemplate = false;
      this.resetTemplate() && this.fragment.resetTemplate(this.partial || []);
    }

    if (this.dirty) {
      this.dirty = false;
      if (proxy && isFunction(proxy.invalidate)) { proxy.invalidate(); }
      this.fragment.update();
    }

    this.externalChange = false;
    this.updating = 0;
  }
});

function createFragment(self, partial) {
  self.partial = self.last = partial;
  contextifyTemplate(self);

  var options = {
    owner: self,
    template: self.partial
  };

  if (self.yielder) { options.ractive = self.container.parent; }

  if (self.fn) { options.cssIds = self.fn._cssIds; }

  self.fragment = new Fragment(options);
}

function contextifyTemplate(self) {
  if (self.template.c) {
    self.partial = [{ t: SECTION, n: SECTION_WITH, f: self.partial }];
    assign(self.partial[0], self.template.c);
    if (self.yielder) { self.partial[0].y = self; }
    else { self.partial[0].z = self.template.z; }
  }
}

function partialFromValue(self, value, okToParse) {
  var tpl = value;

  if (isArray(tpl)) {
    self.partial = tpl;
  } else if (tpl && isObjectType(tpl)) {
    if (isArray(tpl.t)) { self.partial = tpl.t; }
    else if (isString(tpl.template))
      { self.partial = parsePartial(tpl.template, tpl.template, self.ractive).t; }
  } else if (isFunction(tpl) && tpl.styleSet) {
    self.fn = tpl;
    if (self.fragment) { self.fragment.cssIds = tpl._cssIds; }
  } else if (tpl != null) {
    tpl = getPartialTemplate(self.ractive, '' + tpl, self.containerFragment || self.up);
    if (tpl) {
      self.name = value;
      if (tpl.styleSet) {
        self.fn = tpl;
        if (self.fragment) { self.fragment.cssIds = tpl._cssIds; }
      } else { self.partial = tpl; }
    } else if (okToParse) {
      self.partial = parsePartial('' + value, '' + value, self.ractive).t;
    } else {
      self.name = value;
    }
  }

  return self.partial;
}

function setTemplate(template) {
  partialFromValue(this, template, true);

  if (!this.initing) {
    this.dirtyTemplate = true;
    this.fnTemplate = this.partial;

    if (this.updating) {
      this.bubble();
      runloop.promise();
    } else {
      var promise = runloop.start();

      this.bubble();
      runloop.end();

      return promise;
    }
  }
}

function aliasLocal(ref, name) {
  var aliases = this.fragment.aliases || (this.fragment.aliases = {});
  if (!name) {
    aliases[ref] = this._data;
  } else {
    aliases[name] = this._data.joinAll(splitKeypath(ref));
  }
}

var extras = 'extra-attributes';

function initMacro(self) {
  var fn = self.fn;
  var fragment = self.fragment;

  // defensively copy the template in case it changes
  var template = (self.template = assign({}, self.template));
  var handle = (self.handle = fragment.getContext({
    proxy: self,
    aliasLocal: aliasLocal,
    name: self.template.e || self.name,
    attributes: {},
    setTemplate: setTemplate.bind(self),
    template: template,
    macro: fn
  }));

  if (!template.p) { template.p = {}; }
  template.p = handle.partials = assign({}, template.p);
  if (!hasOwn(template.p, 'content')) { template.p.content = template.f || []; }

  if (isArray(fn.attributes)) {
    self._attrs = {};

    var invalidate = function() {
      this.dirty = true;
      self.dirtyAttrs = true;
      self.bubble();
    };

    if (isArray(template.m)) {
      var attrs = template.m;
      template.p[extras] = template.m = attrs.filter(function (a) { return !~fn.attributes.indexOf(a.n); });
      attrs
        .filter(function (a) { return ~fn.attributes.indexOf(a.n); })
        .forEach(function (a) {
          var fragment = new Fragment({
            template: a.f,
            owner: self
          });
          fragment.bubble = invalidate;
          fragment.findFirstNode = noop;
          self._attrs[a.n] = fragment;
        });
    } else {
      template.p[extras] = [];
    }
  } else {
    template.p[extras] = template.m;
  }

  if (self._attrs) {
    keys(self._attrs).forEach(function (k) {
      self._attrs[k].bind();
    });
    self.refreshAttrs();
  }

  self.initing = 1;
  self.proxy = fn.call(self.ractive, handle, handle.attributes) || {};
  if (!self.partial) { self.partial = []; }
  self.fnTemplate = self.partial;
  self.initing = 0;

  contextifyTemplate(self);
  fragment.resetTemplate(self.partial);
}

function parsePartial(name, partial, ractive) {
  var parsed;

  try {
    parsed = parser.parse(partial, parser.getParseOptions(ractive));
  } catch (e) {
    warnIfDebug(("Could not parse partial from expression '" + name + "'\n" + (e.message)));
  }

  return parsed || { t: [] };
}

var KeyModel = function KeyModel(value, context, instance) {
  this.value = this.key = value;
  this.context = context;
  this.isReadonly = this.isKey = true;
  this.deps = [];
  this.links = [];
  this.children = [];
  this.instance = instance;
};
var KeyModel__proto__ = KeyModel.prototype;

KeyModel__proto__.applyValue = function applyValue (value) {
  if (value !== this.value) {
    this.value = this.key = value;
    this.deps.forEach(handleChange);
    this.links.forEach(handleChange);
    this.children.forEach(function (c) {
      c.applyValue(c.context.getKeypath(c.instance));
    });
  }
};

KeyModel__proto__.destroyed = function destroyed () {
  if (this.upstream) { this.upstream.unregisterChild(this); }
};

KeyModel__proto__.get = function get (shouldCapture) {
  if (shouldCapture) { capture(this); }
  return unescapeKey(this.value);
};

KeyModel__proto__.getKeypath = function getKeypath () {
  return unescapeKey(this.value);
};

KeyModel__proto__.has = function has () {
  return false;
};

KeyModel__proto__.rebind = function rebind (next, previous) {
    var this$1 = this;

  var i = this.deps.length;
  while (i--) { this$1.deps[i].rebind(next, previous, false); }

  i = this.links.length;
  while (i--) { this$1.links[i].relinking(next, false); }
};

KeyModel__proto__.register = function register (dependant) {
  this.deps.push(dependant);
};

KeyModel__proto__.registerChild = function registerChild (child) {
  addToArray(this.children, child);
  child.upstream = this;
};

KeyModel__proto__.registerLink = function registerLink (link) {
  addToArray(this.links, link);
};

KeyModel__proto__.unregister = function unregister (dependant) {
  removeFromArray(this.deps, dependant);
};

KeyModel__proto__.unregisterChild = function unregisterChild (child) {
  removeFromArray(this.children, child);
};

KeyModel__proto__.unregisterLink = function unregisterLink (link) {
  removeFromArray(this.links, link);
};

KeyModel.prototype.reference = noop;
KeyModel.prototype.unreference = noop;

var keypathString = /^"(\\"|[^"])+"$/;

var RepeatedFragment = function RepeatedFragment(options) {
  this.parent = options.owner.up;

  // bit of a hack, so reference resolution works without another
  // layer of indirection
  this.up = this;
  this.owner = options.owner;
  this.ractive = this.parent.ractive;
  this.delegate =
    this.ractive.delegate !== false && (this.parent.delegate || findDelegate(this.parent));
  // delegation disabled by directive
  if (this.delegate && this.delegate.delegate === false) { this.delegate = false; }
  // let the element know it's a delegate handler
  if (this.delegate) { this.delegate.delegate = this.delegate; }

  // encapsulated styles should be inherited until they get applied by an element
  this.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;

  this.context = null;
  this.rendered = false;
  this.iterations = [];

  this.template = options.template;

  this.indexRef = options.indexRef;
  this.keyRef = options.keyRef;

  this.pendingNewIndices = null;
  this.previousIterations = null;

  // track array versus object so updates of type rest
  this.isArray = false;
};
var RepeatedFragment__proto__ = RepeatedFragment.prototype;

RepeatedFragment__proto__.bind = function bind (context) {
    var this$1 = this;

  this.context = context;
  this.bound = true;
  var value = context.get();

  var aliases = (this.aliases = this.owner.template.z && this.owner.template.z.slice());

  var shuffler = aliases && aliases.find(function (a) { return a.n === 'shuffle'; });
  if (shuffler && shuffler.x && shuffler.x.x) {
    if (shuffler.x.x.s === 'true') { this.shuffler = true; }
    else if (keypathString.test(shuffler.x.x.s))
      { this.shuffler = splitKeypath(shuffler.x.x.s.slice(1, -1)); }
  }

  if (this.shuffler) { this.values = shuffleValues(this, this.shuffler); }

  if (this.source) { this.source.model.unbind(this.source); }
  var source = context.isComputed && aliases && aliases.find(function (a) { return a.n === 'source'; });
  if (source && source.x && source.x.r) {
    var model = resolve(this, source.x);
    this.source = {
      handleChange: function handleChange() {},
      rebind: function rebind(next) {
        this.model.unregister(this);
        this.model = next;
        next.register(this);
      }
    };
    this.source.model = model;
    model.register(this.source);
  }

  // {{#each array}}...
  if ((this.isArray = isArray(value))) {
    // we can't use map, because of sparse arrays
    this.iterations = [];
    var max = (this.length = value.length);
    for (var i = 0; i < max; i += 1) {
      this$1.iterations[i] = this$1.createIteration(i, i);
    }
  } else if (isObject(value)) {
    // {{#each object}}...
    this.isArray = false;

    // TODO this is a dreadful hack. There must be a neater way
    if (this.indexRef) {
      var refs = this.indexRef.split(',');
      this.keyRef = refs[0];
      this.indexRef = refs[1];
    }

    var ks = keys(value);
    this.length = ks.length;

    this.iterations = ks.map(function (key, index) {
      return this$1.createIteration(key, index);
    });
  }

  return this;
};

RepeatedFragment__proto__.bubble = function bubble (index) {
  if (!this.bubbled) { this.bubbled = []; }
  this.bubbled.push(index);

  if (!this.rebounding) { this.owner.bubble(); }
};

RepeatedFragment__proto__.createIteration = function createIteration (key, index) {
  var fragment = new Fragment({
    owner: this,
    template: this.template
  });

  fragment.isIteration = true;
  fragment.delegate = this.delegate;

  if (this.aliases) { fragment.aliases = {}; }
  swizzleFragment(this, fragment, key, index);

  return fragment.bind(fragment.context);
};

RepeatedFragment__proto__.destroyed = function destroyed () {
    var this$1 = this;

  var len = this.iterations.length;
  for (var i = 0; i < len; i++) { this$1.iterations[i].destroyed(); }
  if (this.pathModel) { this.pathModel.destroyed(); }
  if (this.rootModel) { this.rootModel.destroyed(); }
};

RepeatedFragment__proto__.detach = function detach () {
  var docFrag = createDocumentFragment();
  this.iterations.forEach(function (fragment) { return docFrag.appendChild(fragment.detach()); });
  return docFrag;
};

RepeatedFragment__proto__.find = function find (selector, options) {
  return findMap(this.iterations, function (i) { return i.find(selector, options); });
};

RepeatedFragment__proto__.findAll = function findAll (selector, options) {
  return this.iterations.forEach(function (i) { return i.findAll(selector, options); });
};

RepeatedFragment__proto__.findAllComponents = function findAllComponents (name, options) {
  return this.iterations.forEach(function (i) { return i.findAllComponents(name, options); });
};

RepeatedFragment__proto__.findComponent = function findComponent (name, options) {
  return findMap(this.iterations, function (i) { return i.findComponent(name, options); });
};

RepeatedFragment__proto__.findContext = function findContext () {
  return this.context;
};

RepeatedFragment__proto__.findNextNode = function findNextNode (iteration) {
    var this$1 = this;

  if (iteration.index < this.iterations.length - 1) {
    for (var i = iteration.index + 1; i < this.iterations.length; i++) {
      var node = this$1.iterations[i].firstNode(true);
      if (node) { return node; }
    }
  }

  return this.owner.findNextNode();
};

RepeatedFragment__proto__.firstNode = function firstNode (skipParent) {
  return this.iterations[0] ? this.iterations[0].firstNode(skipParent) : null;
};

RepeatedFragment__proto__.getLast = function getLast () {
  return this.lastModel || (this.lastModel = new KeyModel(this.length - 1));
};

RepeatedFragment__proto__.rebind = function rebind (next) {
    var this$1 = this;

  this.context = next;
  if (this.source) { return; }
  this.iterations.forEach(function (fragment) {
    swizzleFragment(this$1, fragment, fragment.key, fragment.index);
  });
};

RepeatedFragment__proto__.rebound = function rebound (update$$1) {
    var this$1 = this;

  this.context = this.owner.model;
  this.iterations.forEach(function (f, i) {
    f.context = contextFor(this$1, f, i);
    f.rebound(update$$1);
  });
};

RepeatedFragment__proto__.render = function render (target, occupants) {
  var xs = this.iterations;
  if (xs) {
    var len = xs.length;
    for (var i = 0; i < len; i++) {
      xs[i].render(target, occupants);
    }
  }

  this.rendered = true;
};

RepeatedFragment__proto__.shuffle = function shuffle (newIndices, merge) {
    var this$1 = this;

  if (!this.pendingNewIndices) { this.previousIterations = this.iterations.slice(); }

  if (!this.pendingNewIndices) { this.pendingNewIndices = []; }

  this.pendingNewIndices.push(newIndices);

  var iterations = [];

  newIndices.forEach(function (newIndex, oldIndex) {
    if (newIndex === -1) { return; }

    var fragment = this$1.iterations[oldIndex];
    iterations[newIndex] = fragment;

    if (newIndex !== oldIndex && fragment) {
      fragment.dirty = true;
      if (merge) { fragment.shouldRebind = 1; }
    }
  });

  this.iterations = iterations;

  // if merging, we're in the midst of an update already
  if (!merge) { this.bubble(); }
};

RepeatedFragment__proto__.shuffled = function shuffled$1 () {
  this.iterations.forEach(shuffled);
};

RepeatedFragment__proto__.toString = function toString (escape) {
  return this.iterations ? this.iterations.map(escape ? toEscapedString : toString$1).join('') : '';
};

RepeatedFragment__proto__.unbind = function unbind (view) {
  this.bound = false;
  if (this.source) { this.source.model.unregister(this.source); }
  var iterations = this.pendingNewIndices ? this.previousIterations : this.iterations;
  var len = iterations.length;
  for (var i = 0; i < len; i++) { iterations[i].unbind(view); }
  return this;
};

RepeatedFragment__proto__.unrender = function unrender (shouldDestroy) {
    var this$1 = this;

  var len = this.iterations.length;
  for (var i = 0; i < len; i++) { this$1.iterations[i].unrender(shouldDestroy); }
  if (this.pendingNewIndices && this.previousIterations) {
    len = this.previousIterations.length;
    for (var i$1 = 0; i$1 < len; i$1++) { this$1.previousIterations[i$1].unrender(shouldDestroy); }
  }
  this.rendered = false;
};

RepeatedFragment__proto__.update = function update$3 () {
    var this$1 = this;

  if (this.pendingNewIndices) {
    this.bubbled.length = 0;
    this.updatePostShuffle();
    return;
  }

  if (this.updating) { return; }
  this.updating = true;

  if (this.shuffler) {
    var values = shuffleValues(this, this.shuffler);
    var newIndices = buildNewIndices(this.values, values);
    if (!newIndices.same) {
      this.shuffle(newIndices, true);
      this.updatePostShuffle();
    } else {
      this.iterations.forEach(update);
    }
  } else {
    var len = this.iterations.length;
    for (var i = 0; i < len; i++) {
      var f = this$1.iterations[i];
      f && f.idxModel && f.idxModel.applyValue(i);
    }

    var value = this.context.get();
    var wasArray = this.isArray;

    var toRemove;
    var oldKeys;
    var reset = true;
    var i$1;

    if ((this.isArray = isArray(value))) {
      // if there's a source to map back to, make sure everything stays bound correctly
      if (this.source) {
        this.rebounding = 1;
        var source = this.source.model.get();
        this.iterations.forEach(function (f, c) {
          if (c < value.length && f.lastValue !== value[c] && ~(i$1 = source.indexOf(value[c]))) {
            swizzleFragment(this$1, f, c, c);
            f.rebound(true);
          }
        });
        this.rebounding = 0;
      }

      if (wasArray) {
        reset = false;
        if (this.iterations.length > value.length) {
          toRemove = this.iterations.splice(value.length);
        }
      }
    } else if (isObject(value) && !wasArray) {
      reset = false;
      toRemove = [];
      oldKeys = {};
      i$1 = this.iterations.length;

      while (i$1--) {
        var fragment = this$1.iterations[i$1];
        if (fragment.key in value) {
          oldKeys[fragment.key] = true;
        } else {
          this$1.iterations.splice(i$1, 1);
          toRemove.push(fragment);
        }
      }
    }

    var newLength = isArray(value) ? value.length : isObject(value) ? keys(value).length : 0;
    this.length = newLength;
    this.updateLast();

    if (reset) {
      toRemove = this.iterations;
      this.iterations = [];
    }

    if (toRemove) {
      len = toRemove.length;
      for (var i$2 = 0; i$2 < len; i$2++) { toRemove[i$2].unbind().unrender(true); }
    }

    // update the remaining ones
    if (!reset && this.isArray && this.bubbled && this.bubbled.length) {
      var bubbled = this.bubbled;
      this.bubbled = [];
      len = bubbled.length;
      for (var i$3 = 0; i$3 < len; i$3++)
        { this$1.iterations[bubbled[i$3]] && this$1.iterations[bubbled[i$3]].update(); }
    } else {
      len = this.iterations.length;
      for (var i$4 = 0; i$4 < len; i$4++) { this$1.iterations[i$4].update(); }
    }

    // add new iterations
    var docFrag;
    var fragment$1;

    if (newLength > this.iterations.length) {
      docFrag = this.rendered ? createDocumentFragment() : null;
      i$1 = this.iterations.length;

      if (isArray(value)) {
        while (i$1 < value.length) {
          fragment$1 = this$1.createIteration(i$1, i$1);

          this$1.iterations.push(fragment$1);
          if (this$1.rendered) { fragment$1.render(docFrag); }

          i$1 += 1;
        }
      } else if (isObject(value)) {
        // TODO this is a dreadful hack. There must be a neater way
        if (this.indexRef && !this.keyRef) {
          var refs = this.indexRef.split(',');
          this.keyRef = refs[0];
          this.indexRef = refs[1];
        }

        keys(value).forEach(function (key) {
          if (!oldKeys || !(key in oldKeys)) {
            fragment$1 = this$1.createIteration(key, i$1);

            this$1.iterations.push(fragment$1);
            if (this$1.rendered) { fragment$1.render(docFrag); }

            i$1 += 1;
          }
        });
      }

      if (this.rendered) {
        var parentNode = this.parent.findParentNode();
        var anchor = this.parent.findNextNode(this.owner);

        parentNode.insertBefore(docFrag, anchor);
      }
    }
  }

  this.updating = false;
};

RepeatedFragment__proto__.updateLast = function updateLast () {
  if (this.lastModel) { this.lastModel.applyValue(this.length - 1); }
};

RepeatedFragment__proto__.updatePostShuffle = function updatePostShuffle () {
    var this$1 = this;

  var newIndices = this.pendingNewIndices[0];
  var parentNode = this.rendered ? this.parent.findParentNode() : null;
  var nextNode = parentNode && this.owner.findNextNode();
  var docFrag = parentNode ? createDocumentFragment() : null;

  // map first shuffle through
  this.pendingNewIndices.slice(1).forEach(function (indices) {
    newIndices.forEach(function (newIndex, oldIndex) {
      newIndices[oldIndex] = indices[newIndex];
    });
  });

  var len = (this.length = this.context.get().length);
  var prev = this.previousIterations;
  var iters = this.iterations;
  var value = this.context.get();
  var stash = {};
  var idx, dest, pos, next, anchor, rebound;

  var map = new Array(newIndices.length);
  newIndices.forEach(function (e, i) { return (map[e] = i); });

  this.updateLast();

  idx = pos = 0;
  while (idx < len) {
    // if there's not an existing thing to shuffle, handle that
    if (isUndefined(map[idx])) {
      next = iters[idx] = this$1.createIteration(idx, idx);
      if (parentNode) {
        anchor = prev[pos];
        anchor = (anchor && parentNode && anchor.firstNode()) || nextNode;

        next.render(docFrag);
        parentNode.insertBefore(docFrag, anchor);
      }

      idx++;
    } else {
      dest = newIndices[pos];

      if (dest === -1) {
        // if it needs to be dropped, drop it
        prev[pos] && prev[pos].unbind().unrender(true);
        prev[pos++] = 0;
      } else if (dest > idx) {
        // if it needs to move down, stash it
        stash[dest] = prev[pos];
        prev[pos++] = null;
      } else {
        // get the fragment that goes for this idx
        iters[idx] = next = iters[idx] || stash[idx] || this$1.createIteration(idx, idx);

        // if it's an existing fragment, swizzle
        if (stash[idx] || pos !== idx) {
          rebound = this$1.source && next.lastValue !== value[idx];
          swizzleFragment(this$1, next, idx, idx);
        }

        // does next need to be moved?
        if (parentNode && (stash[idx] || !prev[pos])) {
          anchor = prev[pos + 1];
          anchor = (anchor && parentNode && anchor.firstNode()) || nextNode;

          if (stash[idx]) {
            parentNode.insertBefore(next.detach(), anchor);
          } else {
            next.render(docFrag);
            parentNode.insertBefore(docFrag, anchor);
          }
        }

        prev[pos++] = 0;
        idx++;
      }

      if (next && isObjectType(next)) {
        if (next.shouldRebind || rebound) {
          next.rebound(rebound);
          next.shouldRebind = 0;
        }
        next.update();
        next.shuffled();
      }
    }
  }

  // clean up any stragglers
  var plen = prev.length;
  for (var i = 0; i < plen; i++) { prev[i] && prev[i].unbind().unrender(true); }

  if (this.shuffler) { this.values = shuffleValues(this, this.shuffler); }

  this.pendingNewIndices = null;
  this.previousIterations = null;
};

RepeatedFragment.prototype.getContext = getContext;
RepeatedFragment.prototype.getKeypath = getKeypath;

// find the topmost delegate
function findDelegate(start) {
  var frag = start;
  var delegate, el;

  out: while (frag) {
    // find next element
    el = 0;
    while (!el && frag) {
      if (frag.owner.type === ELEMENT) { el = frag.owner; }
      if (frag.owner.ractive && frag.owner.ractive.delegate === false) { break out; }
      frag = frag.parent || frag.componentParent;
    }

    if (el.delegate === false) { break out; }
    delegate = el.delegate || el;

    // find next repeated fragment
    while (frag) {
      if (frag.iterations) { break; }
      if (frag.owner.ractive && frag.owner.ractive.delegate === false) { break out; }
      frag = frag.parent || frag.componentParent;
    }
  }

  return delegate;
}

function swizzleFragment(section, fragment, key, idx) {
  var model = section.context ? contextFor(section, fragment, key) : undefined;

  fragment.key = key;
  fragment.index = idx;
  fragment.context = model;
  if (section.source) { fragment.lastValue = model && model.get(); }

  if (fragment.idxModel) { fragment.idxModel.applyValue(idx); }
  if (fragment.keyModel) { fragment.keyModel.applyValue(key); }
  if (fragment.pathModel) {
    fragment.pathModel.context = model;
    fragment.pathModel.applyValue(model.getKeypath());
  }
  if (fragment.rootModel) {
    fragment.rootModel.context = model;
    fragment.rootModel.applyValue(model.getKeypath(fragment.ractive.root));
  }

  // handle any aliases
  var aliases = fragment.aliases;
  section.aliases &&
    section.aliases.forEach(function (a) {
      if (a.x.r === '.') { aliases[a.n] = model; }
      else if (a.x.r === '@index') { aliases[a.n] = fragment.getIndex(); }
      else if (a.x.r === '@key') { aliases[a.n] = fragment.getKey(); }
      else if (a.x.r === '@keypath') { aliases[a.n] = fragment.getKeypath(); }
      else if (a.x.r === '@rootpath') { aliases[a.n] = fragment.getKeypath(true); }
    });
}

function shuffleValues(section, shuffler) {
  var array = section.context.get() || [];
  if (shuffler === true) {
    return array.slice();
  } else {
    return array.map(function (v) { return shuffler.reduce(function (a, c) { return a && a[c]; }, v); });
  }
}

function contextFor(section, fragment, key) {
  if (section.source) {
    var idx;
    var source = section.source.model.get();
    if (source.indexOf && ~(idx = source.indexOf(section.context.joinKey(key).get())))
      { return section.source.model.joinKey(idx); }
  }

  return section.context.joinKey(key);
}

function isEmpty(value) {
  return (
    !value ||
    (isArray(value) && value.length === 0) ||
    (isObject(value) && keys(value).length === 0)
  );
}

function getType(value, hasIndexRef) {
  if (hasIndexRef || isArray(value)) { return SECTION_EACH; }
  if (isObjectLike(value)) { return SECTION_IF_WITH; }
  if (isUndefined(value)) { return null; }
  return SECTION_IF;
}

var Section = (function (MustacheContainer) {
  function Section(options) {
    MustacheContainer.call(this, options);

    this.isAlias = options.template.t === ALIAS;
    this.sectionType = options.template.n || (this.isAlias && SECTION_WITH) || null;
    this.templateSectionType = this.sectionType;
    this.subordinate = options.template.l === 1;
    this.fragment = null;
  }

  if ( MustacheContainer ) Section.__proto__ = MustacheContainer;
  var Section__proto__ = Section.prototype = Object.create( MustacheContainer && MustacheContainer.prototype );
  Section__proto__.constructor = Section;

  Section__proto__.bind = function bind () {
    MustacheContainer.prototype.bind.call(this);

    if (this.subordinate) {
      this.sibling = this.up.items[this.up.items.indexOf(this) - 1];
      this.sibling.nextSibling = this;
    }

    // if we managed to bind, we need to create children
    if (this.model || this.isAlias) {
      this.dirty = true;
      this.update();
    } else if (
      this.sectionType &&
      this.sectionType === SECTION_UNLESS &&
      (!this.sibling || !this.sibling.isTruthy())
    ) {
      this.fragment = new Fragment({
        owner: this,
        template: this.template.f
      }).bind();
    }
  };

  Section__proto__.bubble = function bubble () {
    if (!this.dirty && this.yield) {
      this.dirty = true;
      this.containerFragment.bubble();
    } else { MustacheContainer.prototype.bubble.call(this); }
  };

  Section__proto__.detach = function detach () {
    var frag = this.fragment || this.detached;
    return frag ? frag.detach() : MustacheContainer.prototype.detach.call(this);
  };

  Section__proto__.isTruthy = function isTruthy () {
    if (this.subordinate && this.sibling.isTruthy()) { return true; }
    var value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();
    return !!value && (this.templateSectionType === SECTION_IF_WITH || !isEmpty(value));
  };

  Section__proto__.rebind = function rebind (next, previous, safe) {
    if (MustacheContainer.prototype.rebind.call(this, next, previous, safe)) {
      if (this.fragment && this.sectionType !== SECTION_IF && this.sectionType !== SECTION_UNLESS) {
        this.fragment.rebind(next);
      }
    }
  };

  Section__proto__.rebound = function rebound (update) {
    if (this.model) {
      if (this.model.rebound) { this.model.rebound(update); }
      else {
        MustacheContainer.prototype.unbind.call(this);
        MustacheContainer.prototype.bind.call(this);
        if (
          this.sectionType === SECTION_WITH ||
          this.sectionType === SECTION_IF_WITH ||
          this.sectionType === SECTION_EACH
        ) {
          if (this.fragment) { this.fragment.rebind(this.model); }
        }

        if (update) { this.bubble(); }
      }
    }
    if (this.fragment) { this.fragment.rebound(update); }
  };

  Section__proto__.render = function render (target, occupants) {
    this.rendered = true;
    if (this.fragment) { this.fragment.render(target, occupants); }
  };

  Section__proto__.shuffle = function shuffle (newIndices) {
    if (this.fragment && this.sectionType === SECTION_EACH) {
      this.fragment.shuffle(newIndices);
    }
  };

  Section__proto__.unbind = function unbind (view) {
    MustacheContainer.prototype.unbind.call(this, view);
    if (this.fragment) { this.fragment.unbind(view); }
  };

  Section__proto__.unrender = function unrender (shouldDestroy) {
    if (this.rendered && this.fragment) { this.fragment.unrender(shouldDestroy); }
    this.rendered = false;
  };

  Section__proto__.update = function update () {
    var this$1 = this;

    if (!this.dirty) { return; }

    if (this.fragment && this.sectionType !== SECTION_IF && this.sectionType !== SECTION_UNLESS) {
      this.fragment.context = this.model;
    }

    if (!this.model && this.sectionType !== SECTION_UNLESS && !this.isAlias) { return; }

    this.dirty = false;

    var value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();
    var siblingFalsey = !this.subordinate || !this.sibling.isTruthy();
    var lastType = this.sectionType;

    if (this.yield && this.yield !== value) {
      this.up = this.containerFragment;
      this.container = null;
      this.yield = null;
      if (this.rendered) { this.fragment.unbind().unrender(true); }
      this.fragment = null;
    } else if (this.rendered && !this.yield && value instanceof Context) {
      if (this.rendered && this.fragment) { this.fragment.unbind().unrender(true); }
      this.fragment = null;
    }

    // watch for switching section types
    if (this.sectionType === null || this.templateSectionType === null)
      { this.sectionType = getType(value, this.template.i); }
    if (lastType && lastType !== this.sectionType && this.fragment) {
      if (this.rendered) {
        this.fragment.unbind().unrender(true);
      }

      this.fragment = null;
    }

    var newFragment;

    var fragmentShouldExist =
      this.sectionType === SECTION_EACH || // each always gets a fragment, which may have no iterations
      this.sectionType === SECTION_WITH || // with (partial context) always gets a fragment
      (siblingFalsey &&
        (this.sectionType === SECTION_UNLESS ? !this.isTruthy() : this.isTruthy())) || // if, unless, and if-with depend on siblings and the condition
      this.isAlias;

    if (fragmentShouldExist) {
      if (!this.fragment) { this.fragment = this.detached; }

      if (this.fragment) {
        // check for detached fragment
        if (this.detached) {
          attach(this, this.fragment);
          this.detached = false;
          this.rendered = true;
        }

        if (!this.fragment.bound) { this.fragment.bind(this.model); }
        this.fragment.update();
      } else {
        if (this.sectionType === SECTION_EACH) {
          newFragment = new RepeatedFragment({
            owner: this,
            template: this.template.f,
            indexRef: this.template.i
          }).bind(this.model);
        } else {
          // only with and if-with provide context - if and unless do not
          var context =
            this.sectionType !== SECTION_IF && this.sectionType !== SECTION_UNLESS
              ? this.model
              : null;

          if (value instanceof Context) {
            this.yield = value;
            this.containerFragment = this.up;
            this.up = value.fragment;
            this.container = value.ractive;
            context = undefined;
          }

          newFragment = new Fragment({
            owner: this,
            template: this.template.f
          }).bind(context);
        }
      }
    } else {
      if (this.fragment && this.rendered) {
        if (keep !== true) {
          this.fragment.unbind().unrender(true);
        } else {
          this.unrender(false);
          this.detached = this.fragment;
          runloop.promise().then(function () {
            if (this$1.detached) { this$1.detach(); }
          });
        }
      } else if (this.fragment) {
        this.fragment.unbind();
      }

      this.fragment = null;
    }

    if (newFragment) {
      if (this.rendered) {
        attach(this, newFragment);
      }

      this.fragment = newFragment;
    }

    if (this.nextSibling) {
      this.nextSibling.dirty = true;
      this.nextSibling.update();
    }
  };

  return Section;
}(MustacheContainer));

function attach(section, fragment) {
  var anchor = (section.containerFragment || section.up).findNextNode(section);

  if (anchor) {
    var docFrag = createDocumentFragment();
    fragment.render(docFrag);

    anchor.parentNode.insertBefore(docFrag, anchor);
  } else {
    fragment.render(section.up.findParentNode());
  }
}

var Select = (function (Element) {
  function Select(options) {
    Element.call(this, options);
    this.options = [];
  }

  if ( Element ) Select.__proto__ = Element;
  var Select__proto__ = Select.prototype = Object.create( Element && Element.prototype );
  Select__proto__.constructor = Select;

  Select__proto__.foundNode = function foundNode (node) {
    if (this.binding) {
      var selectedOptions = getSelectedOptions(node);

      if (selectedOptions.length > 0) {
        this.selectedOptions = selectedOptions;
      }
    }
  };

  Select__proto__.render = function render (target, occupants) {
    Element.prototype.render.call(this, target, occupants);
    this.sync();

    var node = this.node;

    var i = node.options.length;
    while (i--) {
      node.options[i].defaultSelected = node.options[i].selected;
    }

    this.rendered = true;
  };

  Select__proto__.sync = function sync () {
    var this$1 = this;

    var selectNode = this.node;

    if (!selectNode) { return; }

    var options = toArray(selectNode.options);

    if (this.selectedOptions) {
      options.forEach(function (o) {
        if (this$1.selectedOptions.indexOf(o) >= 0) { o.selected = true; }
        else { o.selected = false; }
      });
      this.binding.setFromNode(selectNode);
      delete this.selectedOptions;
      return;
    }

    var selectValue = this.getAttribute('value');
    var isMultiple = this.getAttribute('multiple');
    var array = isMultiple && isArray(selectValue);

    // If the <select> has a specified value, that should override
    // these options
    if (selectValue !== undefined) {
      var optionWasSelected;

      options.forEach(function (o) {
        var optionValue = o._ractive ? o._ractive.value : o.value;
        var shouldSelect = isMultiple
          ? array && this$1.valueContains(selectValue, optionValue)
          : this$1.compare(selectValue, optionValue);

        if (shouldSelect) {
          optionWasSelected = true;
        }

        o.selected = shouldSelect;
      });

      if (!optionWasSelected && !isMultiple) {
        if (this.binding) {
          this.binding.forceUpdate();
        }
      }
    } else if (this.binding && this.binding.forceUpdate) {
      // Otherwise the value should be initialised according to which
      // <option> element is selected, if twoway binding is in effect
      this.binding.forceUpdate();
    }
  };
  Select__proto__.valueContains = function valueContains (selectValue, optionValue) {
    var this$1 = this;

    var i = selectValue.length;
    while (i--) {
      if (this$1.compare(optionValue, selectValue[i])) { return true; }
    }
  };
  Select__proto__.compare = function compare (optionValue, selectValue) {
    var comparator = this.getAttribute('value-comparator');
    if (comparator) {
      if (isFunction(comparator)) {
        return comparator(selectValue, optionValue);
      }
      if (selectValue && optionValue) {
        return selectValue[comparator] == optionValue[comparator];
      }
    }
    return selectValue == optionValue;
  };
  Select__proto__.update = function update () {
    var dirty = this.dirty;
    Element.prototype.update.call(this);
    if (dirty) {
      this.sync();
    }
  };

  return Select;
}(Element));

var Textarea = (function (Input) {
  function Textarea(options) {
    var template = options.template;

    options.deferContent = true;

    Input.call(this, options);

    // check for single interpolator binding
    if (!this.attributeByName.value) {
      if (template.f && isBindable({ template: template })) {
        (this.attributes || (this.attributes = [])).push(
          createItem({
            owner: this,
            template: { t: ATTRIBUTE, f: template.f, n: 'value' },
            up: this.up
          })
        );
      } else {
        this.fragment = new Fragment({
          owner: this,
          cssIds: null,
          template: template.f
        });
      }
    }
  }

  if ( Input ) Textarea.__proto__ = Input;
  var Textarea__proto__ = Textarea.prototype = Object.create( Input && Input.prototype );
  Textarea__proto__.constructor = Textarea;

  Textarea__proto__.bubble = function bubble () {
    var this$1 = this;

    if (!this.dirty) {
      this.dirty = true;

      if (this.rendered && !this.binding && this.fragment) {
        runloop.scheduleTask(function () {
          this$1.dirty = false;
          this$1.node.value = this$1.fragment.toString();
        });
      }

      this.up.bubble(); // default behaviour
    }
  };

  return Textarea;
}(Input));

var Text = (function (Item) {
  function Text(options) {
    Item.call(this, options);
    this.type = TEXT;
  }

  if ( Item ) Text.__proto__ = Item;
  var Text__proto__ = Text.prototype = Object.create( Item && Item.prototype );
  Text__proto__.constructor = Text;

  Text__proto__.detach = function detach () {
    return detachNode(this.node);
  };

  Text__proto__.firstNode = function firstNode () {
    return this.node;
  };

  Text__proto__.render = function render (target, occupants) {
    if (inAttributes()) { return; }
    this.rendered = true;

    progressiveText(this, target, occupants, this.template);
  };

  Text__proto__.toString = function toString (escape) {
    return escape ? escapeHtml(this.template) : this.template;
  };

  Text__proto__.unrender = function unrender (shouldDestroy) {
    if (this.rendered && shouldDestroy) { this.detach(); }
    this.rendered = false;
  };

  Text__proto__.valueOf = function valueOf () {
    return this.template;
  };

  return Text;
}(Item));

var proto$7 = Text.prototype;
proto$7.bind = proto$7.unbind = proto$7.update = noop;

var visible;
var hidden = 'hidden';

if (doc) {
  var prefix$2;

  /* istanbul ignore next */
  if (hidden in doc) {
    prefix$2 = '';
  } else {
    var i$1 = vendors.length;
    while (i$1--) {
      var vendor = vendors[i$1];
      hidden = vendor + 'Hidden';

      if (hidden in doc) {
        prefix$2 = vendor;
        break;
      }
    }
  }

  /* istanbul ignore else */
  if (prefix$2 !== undefined) {
    doc.addEventListener(prefix$2 + 'visibilitychange', onChange);
    onChange();
  } else {
    // gah, we're in an old browser
    if ('onfocusout' in doc) {
      doc.addEventListener('focusout', onHide);
      doc.addEventListener('focusin', onShow);
    } else {
      win.addEventListener('pagehide', onHide);
      win.addEventListener('blur', onHide);

      win.addEventListener('pageshow', onShow);
      win.addEventListener('focus', onShow);
    }

    visible = true; // until proven otherwise. Not ideal but hey
  }
}

function onChange() {
  visible = !doc[hidden];
}

/* istanbul ignore next */
function onHide() {
  visible = false;
}

/* istanbul ignore next */
function onShow() {
  visible = true;
}

var prefix;

/* istanbul ignore next */
if (!isClient) {
  prefix = null;
} else {
  var prefixCache = {};
  var testStyle = createElement('div').style;

  // technically this also normalizes on hyphenated styles as well
  prefix = function(prop) {
    if (!prefixCache[prop]) {
      var name = hyphenateCamel(prop);

      if (testStyle[prop] !== undefined) {
        prefixCache[prop] = name;
      } else {
        /* istanbul ignore next */
        // test vendors...
        var i = vendors.length;
        while (i--) {
          var vendor = "-" + (vendors[i]) + "-" + name;
          if (testStyle[vendor] !== undefined) {
            prefixCache[prop] = vendor;
            break;
          }
        }
      }
    }

    return prefixCache[prop];
  };
}

var prefix$1 = prefix;

var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');

function hyphenate(str) {
  /* istanbul ignore next */
  if (!str) { return ''; } // edge case

  /* istanbul ignore next */
  if (vendorPattern.test(str)) { str = '-' + str; }

  return str.replace(/[A-Z]/g, function (match) { return '-' + match.toLowerCase(); });
}

var createTransitions;

if (!isClient) {
  createTransitions = null;
} else {
  var testStyle$1 = createElement('div').style;
  var linear$1 = function (x) { return x; };

  var canUseCssTransitions = {};
  var cannotUseCssTransitions = {};

  // determine some facts about our environment
  var TRANSITION$1;
  var TRANSITIONEND;
  var CSS_TRANSITIONS_ENABLED;
  var TRANSITION_DURATION;
  var TRANSITION_PROPERTY;
  var TRANSITION_TIMING_FUNCTION;

  if (testStyle$1.transition !== undefined) {
    TRANSITION$1 = 'transition';
    TRANSITIONEND = 'transitionend';
    CSS_TRANSITIONS_ENABLED = true;
  } else if (testStyle$1.webkitTransition !== undefined) {
    TRANSITION$1 = 'webkitTransition';
    TRANSITIONEND = 'webkitTransitionEnd';
    CSS_TRANSITIONS_ENABLED = true;
  } else {
    CSS_TRANSITIONS_ENABLED = false;
  }

  if (TRANSITION$1) {
    TRANSITION_DURATION = TRANSITION$1 + 'Duration';
    TRANSITION_PROPERTY = TRANSITION$1 + 'Property';
    TRANSITION_TIMING_FUNCTION = TRANSITION$1 + 'TimingFunction';
  }

  createTransitions = function(t, to, options, changedProperties, resolve) {
    // Wait a beat (otherwise the target styles will be applied immediately)
    // TODO use a fastdom-style mechanism?
    setTimeout(function () {
      var jsTransitionsComplete;
      var cssTransitionsComplete;
      var cssTimeout; // eslint-disable-line prefer-const

      function transitionDone() {
        clearTimeout(cssTimeout);
      }

      function checkComplete() {
        if (jsTransitionsComplete && cssTransitionsComplete) {
          t.unregisterCompleteHandler(transitionDone);
          // will changes to events and fire have an unexpected consequence here?
          t.ractive.fire(t.name + ':end', t.node, t.isIntro);
          resolve();
        }
      }

      // this is used to keep track of which elements can use CSS to animate
      // which properties
      var hashPrefix = (t.node.namespaceURI || '') + t.node.tagName;

      // need to reset transition properties
      var style = t.node.style;
      var previous = {
        property: style[TRANSITION_PROPERTY],
        timing: style[TRANSITION_TIMING_FUNCTION],
        duration: style[TRANSITION_DURATION]
      };

      function transitionEndHandler(event) {
        if (event.target !== t.node) { return; }
        var index = changedProperties.indexOf(event.propertyName);

        if (index !== -1) {
          changedProperties.splice(index, 1);
        }

        if (changedProperties.length) {
          // still transitioning...
          return;
        }

        clearTimeout(cssTimeout);
        cssTransitionsDone();
      }

      function cssTransitionsDone() {
        style[TRANSITION_PROPERTY] = previous.property;
        style[TRANSITION_TIMING_FUNCTION] = previous.duration;
        style[TRANSITION_DURATION] = previous.timing;

        t.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);

        cssTransitionsComplete = true;
        checkComplete();
      }

      t.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);

      // safety net in case transitionend never fires
      cssTimeout = setTimeout(function () {
        changedProperties = [];
        cssTransitionsDone();
      }, options.duration + (options.delay || 0) + 50);
      t.registerCompleteHandler(transitionDone);

      style[TRANSITION_PROPERTY] = changedProperties.join(',');
      var easingName = hyphenate(options.easing || 'linear');
      style[TRANSITION_TIMING_FUNCTION] = easingName;
      var cssTiming = style[TRANSITION_TIMING_FUNCTION] === easingName;
      style[TRANSITION_DURATION] = options.duration / 1000 + 's';

      setTimeout(function () {
        var i = changedProperties.length;
        var hash;
        var originalValue = null;
        var index;
        var propertiesToTransitionInJs = [];
        var prop;
        var suffix;
        var interpolator;

        while (i--) {
          prop = changedProperties[i];
          hash = hashPrefix + prop;

          if (cssTiming && CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {
            var initial = style[prop];
            style[prop] = to[prop];

            // If we're not sure if CSS transitions are supported for
            // this tag/property combo, find out now
            if (!(hash in canUseCssTransitions)) {
              originalValue = t.getStyle(prop);

              // if this property is transitionable in this browser,
              // the current style will be different from the target style
              canUseCssTransitions[hash] = t.getStyle(prop) != to[prop];
              cannotUseCssTransitions[hash] = !canUseCssTransitions[hash];

              // Reset, if we're going to use timers after all
              if (cannotUseCssTransitions[hash]) {
                style[prop] = initial;
              }
            }
          }

          if (!cssTiming || !CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {
            // we need to fall back to timer-based stuff
            if (originalValue === null) { originalValue = t.getStyle(prop); }

            // need to remove this from changedProperties, otherwise transitionEndHandler
            // will get confused
            index = changedProperties.indexOf(prop);
            if (index === -1) {
              warnIfDebug(
                'Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!',
                { node: t.node }
              );
            } else {
              changedProperties.splice(index, 1);
            }

            // TODO Determine whether this property is animatable at all

            suffix = /[^\d]*$/.exec(originalValue)[0];
            interpolator = interpolate(parseFloat(originalValue), parseFloat(to[prop]));

            // ...then kick off a timer-based transition
            if (interpolator) {
              propertiesToTransitionInJs.push({
                name: prop,
                interpolator: interpolator,
                suffix: suffix
              });
            } else {
              style[prop] = to[prop];
            }

            originalValue = null;
          }
        }

        // javascript transitions
        if (propertiesToTransitionInJs.length) {
          var easing;

          if (isString(options.easing)) {
            easing = t.ractive.easing[options.easing];

            if (!easing) {
              warnOnceIfDebug(missingPlugin(options.easing, 'easing'));
              easing = linear$1;
            }
          } else if (isFunction(options.easing)) {
            easing = options.easing;
          } else {
            easing = linear$1;
          }

          new Ticker({
            duration: options.duration,
            easing: easing,
            step: function step(pos) {
              var i = propertiesToTransitionInJs.length;
              while (i--) {
                var prop = propertiesToTransitionInJs[i];
                style[prop.name] = prop.interpolator(pos) + prop.suffix;
              }
            },
            complete: function complete() {
              jsTransitionsComplete = true;
              checkComplete();
            }
          });
        } else {
          jsTransitionsComplete = true;
        }

        if (changedProperties.length) {
          style[TRANSITION_PROPERTY] = changedProperties.join(',');
        } else {
          style[TRANSITION_PROPERTY] = 'none';

          // We need to cancel the transitionEndHandler, and deal with
          // the fact that it will never fire
          t.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);
          cssTransitionsComplete = true;
          checkComplete();
        }
      }, 0);
    }, options.delay || 0);
  };
}

var createTransitions$1 = createTransitions;

var getComputedStyle = win && win.getComputedStyle;
var resolved = Promise.resolve();

var names = {
  t0: 'intro-outro',
  t1: 'intro',
  t2: 'outro'
};

var Transition = function Transition(options) {
  this.owner = options.owner || options.up.owner || findElement(options.up);
  this.element = this.owner.attributeByName ? this.owner : findElement(options.up);
  this.ractive = this.owner.ractive;
  this.template = options.template;
  this.up = options.up;
  this.options = options;
  this.onComplete = [];
};
var Transition__proto__ = Transition.prototype;

Transition__proto__.animateStyle = function animateStyle (style, value, options) {
    var this$1 = this;

  if (arguments.length === 4) {
    throw new Error(
      't.animateStyle() returns a promise - use .then() instead of passing a callback'
    );
  }

  // Special case - page isn't visible. Don't animate anything, because
  // that way you'll never get CSS transitionend events
  if (!visible) {
    this.setStyle(style, value);
    return resolved;
  }

  var to;

  if (isString(style)) {
    to = {};
    to[style] = value;
  } else {
    to = style;

    // shuffle arguments
    options = value;
  }

  return new Promise(function (fulfil) {
    // Edge case - if duration is zero, set style synchronously and complete
    if (!options.duration) {
      this$1.setStyle(to);
      fulfil();
      return;
    }

    // Get a list of the properties we're animating
    var propertyNames = keys(to);
    var changedProperties = [];

    // Store the current styles
    var computedStyle = getComputedStyle(this$1.node);

    var i = propertyNames.length;
    while (i--) {
      var prop = propertyNames[i];
      var name = prefix$1(prop);

      var current = computedStyle[prefix$1(prop)];

      // record the starting points
      var init = this$1.node.style[name];
      if (!(name in this$1.originals)) { this$1.originals[name] = this$1.node.style[name]; }
      this$1.node.style[name] = to[prop];
      this$1.targets[name] = this$1.node.style[name];
      this$1.node.style[name] = init;

      // we need to know if we're actually changing anything
      if (current != to[prop]) {
        // use != instead of !==, so we can compare strings with numbers
        changedProperties.push(name);

        // if we happened to prefix, make sure there is a properly prefixed value
        to[name] = to[prop];

        // make the computed style explicit, so we can animate where
        // e.g. height='auto'
        this$1.node.style[name] = current;
      }
    }

    // If we're not actually changing anything, the transitionend event
    // will never fire! So we complete early
    if (!changedProperties.length) {
      fulfil();
      return;
    }

    createTransitions$1(this$1, to, options, changedProperties, fulfil);
  });
};

Transition__proto__.bind = function bind () {
  var options = this.options;
  var type = options.template && options.template.v;
  if (type) {
    if (type === 't0' || type === 't1') { this.element.intro = this; }
    if (type === 't0' || type === 't2') { this.element.outro = this; }
    this.eventName = names[type];
  }

  var ractive = this.owner.ractive;

  this.name = options.name || options.template.n;

  if (options.params) {
    this.params = options.params;
  }

  if (isFunction(this.name)) {
    this._fn = this.name;
    this.name = this._fn.name;
  } else {
    this._fn = findInViewHierarchy('transitions', ractive, this.name);
  }

  if (!this._fn) {
    warnOnceIfDebug(missingPlugin(this.name, 'transition'), { ractive: ractive });
  }

  setupArgsFn(this, options.template);
};

Transition__proto__.getParams = function getParams () {
  if (this.params) { return this.params; }

  // get expression args if supplied
  if (this.fn) {
    var values = resolveArgs(this, this.template, this.up).map(function (model) {
      if (!model) { return undefined; }

      return model.get();
    });
    return this.fn.apply(this.ractive, values);
  }
};

Transition__proto__.getStyle = function getStyle (props) {
  var computedStyle = getComputedStyle(this.node);

  if (isString(props)) {
    return computedStyle[prefix$1(props)];
  }

  if (!isArray(props)) {
    throw new Error(
      'Transition$getStyle must be passed a string, or an array of strings representing CSS properties'
    );
  }

  var styles = {};

  var i = props.length;
  while (i--) {
    var prop = props[i];
    var value = computedStyle[prefix$1(prop)];

    if (value === '0px') { value = 0; }
    styles[prop] = value;
  }

  return styles;
};

Transition__proto__.processParams = function processParams (params, defaults) {
  if (isNumber(params)) {
    params = { duration: params };
  } else if (isString(params)) {
    if (params === 'slow') {
      params = { duration: 600 };
    } else if (params === 'fast') {
      params = { duration: 200 };
    } else {
      params = { duration: 400 };
    }
  } else if (!params) {
    params = {};
  }

  return assign({}, defaults, params);
};

Transition__proto__.registerCompleteHandler = function registerCompleteHandler (fn) {
  addToArray(this.onComplete, fn);
};

Transition__proto__.setStyle = function setStyle (style, value) {
    var this$1 = this;

  if (isString(style)) {
    var name = prefix$1(style);
    if (!hasOwn(this.originals, name)) { this.originals[name] = this.node.style[name]; }
    this.node.style[name] = value;
    this.targets[name] = this.node.style[name];
  } else {
    var prop;
    for (prop in style) {
      if (hasOwn(style, prop)) {
        this$1.setStyle(prop, style[prop]);
      }
    }
  }

  return this;
};

Transition__proto__.shouldFire = function shouldFire (type) {
  if (!this.ractive.transitionsEnabled) { return false; }

  // check for noIntro and noOutro cases, which only apply when the owner ractive is rendering and unrendering, respectively
  if (type === 'intro' && this.ractive.rendering && nearestProp('noIntro', this.ractive, true))
    { return false; }
  if (type === 'outro' && this.ractive.unrendering && nearestProp('noOutro', this.ractive, false))
    { return false; }

  var params = this.getParams(); // this is an array, the params object should be the first member
  // if there's not a parent element, this can't be nested, so roll on
  if (!this.element.parent) { return true; }

  // if there is a local param, it takes precedent
  if (params && params[0] && isObject(params[0]) && 'nested' in params[0]) {
    if (params[0].nested !== false) { return true; }
  } else {
    // use the nearest instance setting
    // find the nearest instance that actually has a nested setting
    if (nearestProp('nestedTransitions', this.ractive) !== false) { return true; }
  }

  // check to see if this is actually a nested transition
  var el = this.element.parent;
  while (el) {
    if (el[type] && el[type].starting) { return false; }
    el = el.parent;
  }

  return true;
};

Transition__proto__.start = function start () {
    var this$1 = this;

  var node = (this.node = this.element.node);
  var originals = (this.originals = {}); //= node.getAttribute( 'style' );
  var targets = (this.targets = {});

  var completed;
  var args = this.getParams();

  // create t.complete() - we don't want this on the prototype,
  // because we don't want `this` silliness when passing it as
  // an argument
  this.complete = function (noReset) {
    this$1.starting = false;
    if (completed) {
      return;
    }

    this$1.onComplete.forEach(function (fn) { return fn(); });
    if (!noReset && this$1.isIntro) {
      for (var k in targets) {
        if (node.style[k] === targets[k]) { node.style[k] = originals[k]; }
      }
    }

    this$1._manager.remove(this$1);

    completed = true;
  };

  // If the transition function doesn't exist, abort
  if (!this._fn) {
    this.complete();
    return;
  }

  var promise = this._fn.apply(this.ractive, [this].concat(args));
  if (promise) { promise.then(this.complete); }
};

Transition__proto__.toString = function toString () {
  return '';
};

Transition__proto__.unbind = function unbind () {
  if (!this.element.attributes.unbinding) {
    var type = this.options && this.options.template && this.options.template.v;
    if (type === 't0' || type === 't1') { this.element.intro = null; }
    if (type === 't0' || type === 't2') { this.element.outro = null; }
  }
};

Transition__proto__.unregisterCompleteHandler = function unregisterCompleteHandler (fn) {
  removeFromArray(this.onComplete, fn);
};

var proto$8 = Transition.prototype;
proto$8.destroyed = proto$8.firstNode = proto$8.rebound = proto$8.render = proto$8.unrender = proto$8.update = noop;

function nearestProp(prop, ractive, rendering) {
  var instance = ractive;
  while (instance) {
    if (
      hasOwn(instance, prop) &&
      (isUndefined(rendering) || rendering ? instance.rendering : instance.unrendering)
    )
      { return instance[prop]; }
    instance = instance.component && instance.component.ractive;
  }

  return ractive[prop];
}

var elementCache = {};

var ieBug;
var ieBlacklist;

try {
  createElement('table').innerHTML = 'foo';
} catch (/* istanbul ignore next */ err) {
  ieBug = true;

  ieBlacklist = {
    TABLE: ['<table class="x">', '</table>'],
    THEAD: ['<table><thead class="x">', '</thead></table>'],
    TBODY: ['<table><tbody class="x">', '</tbody></table>'],
    TR: ['<table><tr class="x">', '</tr></table>'],
    SELECT: ['<select class="x">', '</select>']
  };
}

function insertHtml(html$$1, node) {
  var nodes = [];

  // render 0 and false
  if (html$$1 == null || html$$1 === '') { return nodes; }

  var container;
  var wrapper;
  var selectedOption;

  /* istanbul ignore if */
  if (ieBug && (wrapper = ieBlacklist[node.tagName])) {
    container = element('DIV');
    container.innerHTML = wrapper[0] + html$$1 + wrapper[1];
    container = container.querySelector('.x');

    if (container.tagName === 'SELECT') {
      selectedOption = container.options[container.selectedIndex];
    }
  } else if (node.namespaceURI === svg$1) {
    container = element('DIV');
    container.innerHTML = '<svg class="x">' + html$$1 + '</svg>';
    container = container.querySelector('.x');
  } else if (node.tagName === 'TEXTAREA') {
    container = createElement('div');

    if (typeof container.textContent !== 'undefined') {
      container.textContent = html$$1;
    } else {
      container.innerHTML = html$$1;
    }
  } else {
    container = element(node.tagName);
    container.innerHTML = html$$1;

    if (container.tagName === 'SELECT') {
      selectedOption = container.options[container.selectedIndex];
    }
  }

  var child;
  while ((child = container.firstChild)) {
    nodes.push(child);
    container.removeChild(child);
  }

  // This is really annoying. Extracting <option> nodes from the
  // temporary container <select> causes the remaining ones to
  // become selected. So now we have to deselect them. IE8, you
  // amaze me. You really do
  // ...and now Chrome too
  var i;
  if (node.tagName === 'SELECT') {
    i = nodes.length;
    while (i--) {
      if (nodes[i] !== selectedOption) {
        nodes[i].selected = false;
      }
    }
  }

  return nodes;
}

function element(tagName) {
  return elementCache[tagName] || (elementCache[tagName] = createElement(tagName));
}

var Triple = (function (Mustache) {
  function Triple(options) {
    Mustache.call(this, options);
  }

  if ( Mustache ) Triple.__proto__ = Mustache;
  var Triple__proto__ = Triple.prototype = Object.create( Mustache && Mustache.prototype );
  Triple__proto__.constructor = Triple;

  Triple__proto__.detach = function detach () {
    var docFrag = createDocumentFragment();
    if (this.nodes) { this.nodes.forEach(function (node) { return docFrag.appendChild(node); }); }
    return docFrag;
  };

  Triple__proto__.find = function find (selector) {
    var this$1 = this;

    var len = this.nodes.length;
    var i;

    for (i = 0; i < len; i += 1) {
      var node = this$1.nodes[i];

      if (node.nodeType !== 1) { continue; }

      if (matches(node, selector)) { return node; }

      var queryResult = node.querySelector(selector);
      if (queryResult) { return queryResult; }
    }

    return null;
  };

  Triple__proto__.findAll = function findAll (selector, options) {
    var this$1 = this;

    var result = options.result;
    var len = this.nodes.length;
    var i;

    for (i = 0; i < len; i += 1) {
      var node = this$1.nodes[i];

      if (node.nodeType !== 1) { continue; }

      if (matches(node, selector)) { result.push(node); }

      var queryAllResult = node.querySelectorAll(selector);
      if (queryAllResult) {
        result.push.apply(result, queryAllResult);
      }
    }
  };

  Triple__proto__.findComponent = function findComponent () {
    return null;
  };

  Triple__proto__.firstNode = function firstNode () {
    return this.rendered && this.nodes[0];
  };

  Triple__proto__.render = function render (target, occupants, anchor) {
    var this$1 = this;

    if (!this.nodes) {
      var html = this.model ? this.model.get() : '';
      this.nodes = insertHtml(html, target);
    }

    var nodes = this.nodes;

    // progressive enhancement
    if (occupants) {
      var i = -1;
      var next;

      // start with the first node that should be rendered
      while (occupants.length && (next = this.nodes[i + 1])) {
        var n = (void 0);
        // look through the occupants until a matching node is found
        while ((n = occupants.shift())) {
          var t = n.nodeType;

          if (
            t === next.nodeType &&
            ((t === 1 && n.outerHTML === next.outerHTML) ||
              ((t === 3 || t === 8) && n.nodeValue === next.nodeValue))
          ) {
            this$1.nodes.splice(++i, 1, n); // replace the generated node with the existing one
            break;
          } else {
            target.removeChild(n); // remove the non-matching existing node
          }
        }
      }

      if (i >= 0) {
        // update the list of remaining nodes to attach, excluding any that were replaced by existing nodes
        nodes = this.nodes.slice(i);
      }

      // update the anchor to be the next occupant
      if (occupants.length) { anchor = occupants[0]; }
    }

    // attach any remainging nodes to the parent
    if (nodes.length) {
      var frag = createDocumentFragment();
      nodes.forEach(function (n) { return frag.appendChild(n); });

      if (anchor) {
        target.insertBefore(frag, anchor);
      } else {
        target.appendChild(frag);
      }
    }

    this.rendered = true;
  };

  Triple__proto__.toString = function toString () {
    var value = this.model && this.model.get();
    value = value != null ? '' + value : '';

    return inAttribute() ? decodeCharacterReferences(value) : value;
  };

  Triple__proto__.unrender = function unrender () {
    if (this.nodes)
      { this.nodes.forEach(function (node) {
        // defer detachment until all relevant outros are done
        runloop.detachWhenReady({
          node: node,
          detach: function detach() {
            detachNode(node);
          }
        });
      }); }
    this.rendered = false;
    this.nodes = null;
  };

  Triple__proto__.update = function update () {
    if (this.rendered && this.dirty) {
      this.dirty = false;

      this.unrender();
      this.render(this.up.findParentNode(), null, this.up.findNextNode(this));
    } else {
      // make sure to reset the dirty flag even if not rendered
      this.dirty = false;
    }
  };

  return Triple;
}(Mustache));

// finds the component constructor in the registry or view hierarchy registries
function getComponentConstructor(ractive, name) {
  var instance = findInstance('components', ractive, name);
  var Component;

  if (instance) {
    Component = instance.components[name];

    if (Component && !Component.isInstance) {
      if (Component.default && Component.default.isInstance) { Component = Component.default; }
      else if (!Component.then && isFunction(Component)) {
        // function option, execute and store for reset
        var fn = Component.bind(instance);
        fn.isOwner = hasOwn(instance.components, name);
        Component = fn();

        if (!Component) {
          warnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', {
            ractive: ractive
          });
          return;
        }

        if (isString(Component)) {
          // allow string lookup
          Component = getComponentConstructor(ractive, Component);
        }

        Component._fn = fn;
        instance.components[name] = Component;
      }
    }
  }

  return Component;
}

function asyncProxy(promise, options) {
  var partials = options.template.p || {};
  var name = options.template.e;

  var opts = assign({}, options, {
    template: { t: ELEMENT, e: name },
    macro: function macro(handle) {
      handle.setTemplate(partials['async-loading'] || []);
      promise.then(
        function (cmp) {
          options.up.ractive.components[name] = cmp;
          if (partials['async-loaded']) {
            handle.partials.component = [options.template];
            handle.setTemplate(partials['async-loaded']);
          } else {
            handle.setTemplate([options.template]);
          }
        },
        function (err) {
          if (partials['async-failed']) {
            handle.aliasLocal('error', 'error');
            handle.set('@local.error', err);
            handle.setTemplate(partials['async-failed']);
          } else {
            handle.setTemplate([]);
          }
        }
      );
    }
  });
  return new Partial(opts);
}

function extract(tpl, type, name) {
  var p = tpl.f.find(function (s) { return s.t === type; });
  if (p) {
    if (p.n)
      { return [
        {
          t: 19,
          n: 54,
          f: p.f || [],
          z: [{ n: p.n, x: { r: ("__await." + name) } }]
        }
      ]; }
    else { return p.f || []; }
  } else { return []; }
}

function Await(options) {
  var tpl = options.template;

  var success = extract(tpl, THEN, 'value');
  var error = extract(tpl, CATCH, 'error');
  var pending = extract(tpl, SECTION);
  var undef = extract(tpl, ELSE);

  var opts = assign({}, options, {
    template: {
      t: ELEMENT,
      m: [
        {
          t: ATTRIBUTE,
          n: 'for',
          f: [{ t: INTERPOLATOR, r: tpl.r, rx: tpl.rx, x: tpl.x }]
        }
      ]
    },
    macro: function macro(handle, attrs) {
      handle.aliasLocal('__await');

      function update(attrs) {
        if (attrs.for && isFunction(attrs.for.then)) {
          handle.setTemplate(pending);

          attrs.for.then(
            function (v) {
              handle.set('@local.value', v);
              handle.setTemplate(success);
            },
            function (e) {
              handle.set('@local.error', e);
              handle.setTemplate(error);
            }
          );
        } else if (isUndefined(attrs.for)) {
          handle.setTemplate(undef);
        } else {
          handle.set('@local.value', attrs.for);
          handle.setTemplate(success);
        }
      }

      update(attrs);

      return {
        update: update
      };
    }
  });

  opts.macro.attributes = ['for'];

  return new Partial(opts);
}

var constructors = {};
constructors[ALIAS] = Section;
constructors[ANCHOR] = Component;
constructors[AWAIT] = Await;
constructors[DOCTYPE] = Doctype;
constructors[INTERPOLATOR] = Interpolator;
constructors[PARTIAL] = Partial;
constructors[SECTION] = Section;
constructors[TRIPLE] = Triple;
constructors[YIELDER] = Partial;

constructors[ATTRIBUTE] = Attribute;
constructors[BINDING_FLAG] = BindingFlag;
constructors[DECORATOR] = Decorator;
constructors[EVENT] = EventDirective;
constructors[TRANSITION] = Transition;
constructors[COMMENT] = Comment;

var specialElements = {
  doctype: Doctype,
  form: Form,
  input: Input,
  option: Option,
  select: Select,
  textarea: Textarea
};

function createItem(options) {
  if (isString(options.template)) {
    return new Text(options);
  }

  var ctor;
  var name;
  var type = options.template.t;

  if (type === ELEMENT) {
    name = options.template.e;

    // could be a macro partial
    ctor = findInstance('partials', options.up.ractive, name);
    if (ctor) {
      ctor = ctor.partials[name];
      if (ctor.styleSet) {
        options.macro = ctor;
        return new Partial(options);
      }
    }

    // could be component or element
    ctor = getComponentConstructor(options.up.ractive, name);
    if (ctor) {
      if (isFunction(ctor.then)) {
        return asyncProxy(ctor, options);
      } else if (isFunction(ctor)) {
        return new Component(options, ctor);
      }
    }

    ctor = specialElements[name.toLowerCase()] || Element;
    return new ctor(options);
  }

  var Item;

  // component mappings are a special case of attribute
  if (type === ATTRIBUTE) {
    var el = options.owner;
    if (!el || (el.type !== ANCHOR && el.type !== COMPONENT && el.type !== ELEMENT)) {
      el = findElement(options.up);
    }
    options.element = el;

    Item = el.type === COMPONENT || el.type === ANCHOR ? Mapping : Attribute;
  } else {
    Item = constructors[type];
  }

  if (!Item) { throw new Error(("Unrecognised item type " + type)); }

  return new Item(options);
}

// TODO all this code needs to die
function processItems(items, values, guid, counter) {
  if ( counter === void 0 ) counter = 0;

  return items
    .map(function (item) {
      if (item.type === TEXT) {
        return item.template;
      }

      if (item.fragment) {
        if (item.fragment.iterations) {
          return item.fragment.iterations
            .map(function (fragment) {
              return processItems(fragment.items, values, guid, counter);
            })
            .join('');
        } else {
          return processItems(item.fragment.items, values, guid, counter);
        }
      }

      var placeholderId = guid + "-" + (counter++);
      var model = item.model || item.newModel;

      values[placeholderId] = model
        ? model.wrapper
          ? model.wrapperValue
          : model.get()
        : undefined;

      return '${' + placeholderId + '}';
    })
    .join('');
}

function resolveAliases(aliases, fragment, dest) {
  if ( dest === void 0 ) dest = {};

  for (var i = 0; i < aliases.length; i++) {
    if (!dest[aliases[i].n]) {
      var m = resolve(fragment, aliases[i].x);
      dest[aliases[i].n] = m;
      m.reference();
    }
  }

  return dest;
}

var Fragment = function Fragment(options) {
  this.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute

  this.isRoot = !options.owner.up;
  this.parent = this.isRoot ? null : this.owner.up;
  this.ractive = options.ractive || (this.isRoot ? options.owner : this.parent.ractive);

  this.componentParent = this.isRoot && this.ractive.component ? this.ractive.component.up : null;
  if (!this.isRoot || this.ractive.delegate) {
    this.delegate = this.owner.containerFragment
      ? this.owner.containerFragment && this.owner.containerFragment.delegate
      : (this.componentParent && this.componentParent.delegate) ||
        (this.parent && this.parent.delegate);
  } else {
    this.delegate = false;
  }

  this.context = null;
  this.rendered = false;

  // encapsulated styles should be inherited until they get applied by an element
  if ('cssIds' in options) {
    this.cssIds = options.cssIds && options.cssIds.length && options.cssIds;
  } else {
    this.cssIds = this.parent ? this.parent.cssIds : null;
  }

  this.dirty = false;
  this.dirtyValue = true; // used for attribute values

  this.template = options.template || [];
  this.createItems();
};
var Fragment__proto__ = Fragment.prototype;

Fragment__proto__.bind = function bind (context) {
    var this$1 = this;

  this.context = context;

  if (this.owner.template.z) {
    this.aliases = resolveAliases(
      this.owner.template.z,
      this.owner.containerFragment || this.parent
    );
  }

  var len = this.items.length;
  for (var i = 0; i < len; i++) { this$1.items[i].bind(); }
  this.bound = true;

  // in rare cases, a forced resolution (or similar) will cause the
  // fragment to be dirty before it's even finished binding. In those
  // cases we update immediately
  if (this.dirty) { this.update(); }

  return this;
};

Fragment__proto__.bubble = function bubble () {
  this.dirtyValue = true;

  if (!this.dirty) {
    this.dirty = true;

    if (this.isRoot) {
      // TODO encapsulate 'is component root, but not overall root' check?
      if (this.ractive.component) {
        this.ractive.component.bubble();
      } else if (this.bound) {
        runloop.addFragment(this);
      }
    } else {
      this.owner.bubble(this.index);
    }
  }
};

Fragment__proto__.createItems = function createItems () {
    var this$1 = this;

  // this is a hot code path
  var max = this.template.length;
  this.items = [];
  for (var i = 0; i < max; i++) {
    this$1.items[i] = createItem({
      up: this$1,
      template: this$1.template[i],
      index: i
    });
  }
};

Fragment__proto__.destroyed = function destroyed () {
    var this$1 = this;

  var len = this.items.length;
  for (var i = 0; i < len; i++) { this$1.items[i].destroyed(); }
  if (this.pathModel) { this.pathModel.destroyed(); }
  if (this.rootModel) { this.rootModel.destroyed(); }
};

Fragment__proto__.detach = function detach () {
  var docFrag = createDocumentFragment();
  var xs = this.items;
  var len = xs.length;
  for (var i = 0; i < len; i++) {
    docFrag.appendChild(xs[i].detach());
  }
  return docFrag;
};

Fragment__proto__.find = function find (selector, options) {
  return findMap(this.items, function (i) { return i.find(selector, options); });
};

Fragment__proto__.findAll = function findAll (selector, options) {
  if (this.items) {
    this.items.forEach(function (i) { return i.findAll && i.findAll(selector, options); });
  }
};

Fragment__proto__.findComponent = function findComponent (name, options) {
  return findMap(this.items, function (i) { return i.findComponent(name, options); });
};

Fragment__proto__.findAllComponents = function findAllComponents (name, options) {
  if (this.items) {
    this.items.forEach(function (i) { return i.findAllComponents && i.findAllComponents(name, options); });
  }
};

Fragment__proto__.findContext = function findContext () {
  var base = findParentWithContext(this);
  if (!base || !base.context) { return this.ractive.viewmodel; }
  else { return base.context; }
};

Fragment__proto__.findNextNode = function findNextNode (item) {
    var this$1 = this;

  // search for the next node going forward
  if (item) {
    var it;
    for (var i = item.index + 1; i < this.items.length; i++) {
      it = this$1.items[i];
      if (!it || !it.firstNode) { continue; }

      var node = it.firstNode(true);
      if (node) { return node; }
    }
  }

  // if this is the root fragment, and there are no more items,
  // it means we're at the end...
  if (this.isRoot) {
    if (this.ractive.component) {
      return this.ractive.component.up.findNextNode(this.ractive.component);
    }

    // TODO possible edge case with other content
    // appended to this.ractive.el?
    return null;
  }

  if (this.parent) { return this.owner.findNextNode(this); } // the argument is in case the parent is a RepeatedFragment
};

Fragment__proto__.findParentNode = function findParentNode () {
  var fragment = this;

  do {
    if (fragment.owner.type === ELEMENT) {
      return fragment.owner.node;
    }

    if (fragment.isRoot && !fragment.ractive.component) {
      // TODO encapsulate check
      return fragment.ractive.el;
    }

    if (fragment.owner.type === YIELDER) {
      fragment = fragment.owner.containerFragment;
    } else {
      fragment = fragment.componentParent || fragment.parent; // TODO ugh
    }
  } while (fragment);

  throw new Error('Could not find parent node'); // TODO link to issue tracker
};

Fragment__proto__.firstNode = function firstNode (skipParent) {
  var node = findMap(this.items, function (i) { return i.firstNode(true); });
  if (node) { return node; }
  if (skipParent) { return null; }

  return this.parent.findNextNode(this.owner);
};

Fragment__proto__.getKey = function getKey () {
  return this.keyModel || (this.keyModel = new KeyModel(this.key));
};

Fragment__proto__.getIndex = function getIndex () {
  return this.idxModel || (this.idxModel = new KeyModel(this.index));
};

Fragment__proto__.rebind = function rebind (next) {
  this.context = next;
  if (this.rootModel) { this.rootModel.context = this.context; }
  if (this.pathModel) { this.pathModel.context = this.context; }
};

Fragment__proto__.rebound = function rebound (update$$1) {
  if (this.owner.template.z) {
    var aliases = this.aliases;
    for (var k in aliases) {
      if (aliases[k].rebound) { aliases[k].rebound(update$$1); }
      else {
        aliases[k].unreference();
        aliases[k] = 0;
      }
    }

    resolveAliases(this.owner.template.z, this.owner.containerFragment || this.parent, aliases);
  }

  this.items.forEach(function (x) { return x.rebound(update$$1); });
  if (update$$1) {
    if (this.rootModel) { this.rootModel.applyValue(this.context.getKeypath(this.ractive.root)); }
    if (this.pathModel) { this.pathModel.applyValue(this.context.getKeypath()); }
  }
};

Fragment__proto__.render = function render (target, occupants) {
  if (this.rendered) { throw new Error('Fragment is already rendered!'); }
  this.rendered = true;

  var xs = this.items;
  var len = xs.length;
  for (var i = 0; i < len; i++) {
    xs[i].render(target, occupants);
  }
};

Fragment__proto__.resetTemplate = function resetTemplate (template) {
  var wasBound = this.bound;
  var wasRendered = this.rendered;

  // TODO ensure transitions are disabled globally during reset

  if (wasBound) {
    if (wasRendered) { this.unrender(true); }
    this.unbind();
  }

  this.template = template;
  this.createItems();

  if (wasBound) {
    this.bind(this.context);

    if (wasRendered) {
      var parentNode = this.findParentNode();
      var anchor = this.findNextNode();

      if (anchor) {
        var docFrag = createDocumentFragment();
        this.render(docFrag);
        parentNode.insertBefore(docFrag, anchor);
      } else {
        this.render(parentNode);
      }
    }
  }
};

Fragment__proto__.shuffled = function shuffled$2 () {
  this.items.forEach(shuffled);
  if (this.rootModel) { this.rootModel.applyValue(this.context.getKeypath(this.ractive.root)); }
  if (this.pathModel) { this.pathModel.applyValue(this.context.getKeypath()); }
};

Fragment__proto__.toString = function toString (escape) {
  return this.items.map(escape ? toEscapedString : toString$1).join('');
};

Fragment__proto__.unbind = function unbind (view) {
    var this$1 = this;

  if (this.owner.template.z && !this.owner.yielder) {
    for (var k in this$1.aliases) {
      this$1.aliases[k].unreference();
    }

    this.aliases = {};
  }

  this.context = null;
  var len = this.items.length;
  for (var i = 0; i < len; i++) { this$1.items[i].unbind(view); }
  this.bound = false;

  return this;
};

Fragment__proto__.unrender = function unrender (shouldDestroy) {
    var this$1 = this;

  var len = this.items.length;
  for (var i = 0; i < len; i++) { this$1.items[i].unrender(shouldDestroy); }
  this.rendered = false;
};

Fragment__proto__.update = function update () {
    var this$1 = this;

  if (this.dirty) {
    if (!this.updating) {
      this.dirty = false;
      this.updating = true;
      var len = this.items.length;
      for (var i = 0; i < len; i++) { this$1.items[i].update(); }
      this.updating = false;
    } else if (this.isRoot) {
      runloop.addFragmentToRoot(this);
    }
  }
};

Fragment__proto__.valueOf = function valueOf () {
  if (this.items.length === 1) {
    return this.items[0].valueOf();
  }

  if (this.dirtyValue) {
    var values = {};
    var source = processItems(this.items, values, this.ractive._guid);
    var parsed = parseJSON(source, values);

    this.value = parsed ? parsed.value : this.toString();

    this.dirtyValue = false;
  }

  return this.value;
};
Fragment.prototype.getContext = getContext;
Fragment.prototype.getKeypath = getKeypath;

function getKeypath(root) {
  var base = findParentWithContext(this);
  var model;
  if (root) {
    if (!this.rootModel) {
      this.rootModel = new KeyModel(
        this.context.getKeypath(this.ractive.root),
        this.context,
        this.ractive.root
      );
      model = this.rootModel;
    } else { return this.rootModel; }
  } else {
    if (!this.pathModel) {
      this.pathModel = new KeyModel(this.context.getKeypath(), this.context);
      model = this.pathModel;
    } else { return this.pathModel; }
  }

  if (base && base.context) { base.getKeypath(root).registerChild(model); }

  return model;
}

function initialise(ractive, userOptions, options) {
  // initialize settable computeds
  var computed = ractive.viewmodel.computed;
  if (computed) {
    for (var k in computed) {
      if (k in ractive.viewmodel.value && computed[k] && !computed[k].isReadonly) {
        computed[k].set(ractive.viewmodel.value[k]);
      }
    }
  }

  // init config from Parent and options
  config.init(ractive.constructor, ractive, userOptions);

  // call any passed in plugins
  if (isArray(userOptions.use))
    { ractive.use.apply(ractive, userOptions.use.filter(function (p) { return !p.construct; })); }

  hooks.config.fire(ractive);

  hooks.init.begin(ractive);

  var fragment = (ractive.fragment = createFragment$1(ractive, options));
  if (fragment) { fragment.bind(ractive.viewmodel); }

  hooks.init.end(ractive);

  // general config done, set up observers
  subscribe(ractive, userOptions, 'observe');

  if (fragment) {
    // render automatically ( if `el` is specified )
    var el = (ractive.el = ractive.target = getElement(ractive.el || ractive.target));
    if (el && !ractive.component) {
      var promise = ractive.render(el, ractive.append);

      if (Ractive.DEBUG_PROMISES) {
        promise.catch(function (err) {
          warnOnceIfDebug(
            'Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\n  Ractive.DEBUG_PROMISES = false;'
          );
          warnIfDebug('An error happened during rendering', { ractive: ractive });
          logIfDebug(err);

          throw err;
        });
      }
    }
  }
}

function createFragment$1(ractive, options) {
  if ( options === void 0 ) options = {};

  if (ractive.template) {
    var cssIds = [].concat(ractive.constructor._cssIds || [], options.cssIds || []);

    return new Fragment({
      owner: ractive,
      template: ractive.template,
      cssIds: cssIds
    });
  }
}

function render$1(ractive, target, anchor, occupants) {
  // set a flag to let any transitions know that this instance is currently rendering
  ractive.rendering = true;

  var promise = runloop.start();
  runloop.scheduleTask(function () { return hooks.render.fire(ractive); }, true);

  if (ractive.fragment.rendered) {
    throw new Error(
      'You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first'
    );
  }

  if (ractive.destroyed) {
    ractive.destroyed = false;
    ractive.fragment = createFragment$1(ractive).bind(ractive.viewmodel);
  }

  anchor = getElement(anchor) || ractive.anchor;

  ractive.el = ractive.target = target;
  ractive.anchor = anchor;

  // ensure encapsulated CSS is up-to-date
  if (ractive.cssId) { applyCSS(); }

  if (target) {
    (target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(ractive);

    if (anchor) {
      var docFrag = doc.createDocumentFragment();
      ractive.fragment.render(docFrag);
      target.insertBefore(docFrag, anchor);
    } else {
      ractive.fragment.render(target, occupants);
    }
  }

  runloop.end();
  ractive.rendering = false;

  return promise.then(function () {
    if (ractive.torndown) { return; }

    hooks.complete.fire(ractive);
  });
}

function Ractive$render(target, anchor) {
  if (this.torndown) {
    warnIfDebug('ractive.render() was called on a Ractive instance that was already torn down');
    return Promise.resolve();
  }

  target = getElement(target) || this.el;

  if (!this.append && target) {
    // Teardown any existing instances *before* trying to set up the new one -
    // avoids certain weird bugs
    var others = target.__ractive_instances__;
    if (others) { others.forEach(teardown); }

    // make sure we are the only occupants
    if (!this.enhance) {
      target.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive
    }
  }

  var occupants = this.enhance ? toArray(target.childNodes) : null;
  var promise = render$1(this, target, anchor, occupants);

  if (occupants) {
    while (occupants.length) { target.removeChild(occupants.pop()); }
  }

  return promise;
}

var shouldRerender = ['template', 'partials', 'components', 'decorators', 'events'];

function Ractive$reset(data) {
  data = data || {};

  if (!isObjectType(data)) {
    throw new Error('The reset method takes either no arguments, or an object containing new data');
  }

  // TEMP need to tidy this up
  data = dataConfigurator.init(this.constructor, this, { data: data });

  var promise = runloop.start();

  // If the root object is wrapped, try and use the wrapper's reset value
  var wrapper = this.viewmodel.wrapper;
  if (wrapper && wrapper.reset) {
    if (wrapper.reset(data) === false) {
      // reset was rejected, we need to replace the object
      this.viewmodel.set(data);
    }
  } else {
    this.viewmodel.set(data);
  }

  // reset config items and track if need to rerender
  var changes = config.reset(this);
  var rerender;

  var i = changes.length;
  while (i--) {
    if (shouldRerender.indexOf(changes[i]) > -1) {
      rerender = true;
      break;
    }
  }

  if (rerender) {
    hooks.unrender.fire(this);
    this.fragment.resetTemplate(this.template);
    hooks.render.fire(this);
    hooks.complete.fire(this);
  }

  runloop.end();

  hooks.reset.fire(this, data);

  return promise;
}

function collect$1(source, name, attr, dest) {
  source.forEach(function (item) {
    // queue to rerender if the item is a partial and the current name matches
    if (item.type === PARTIAL && (item.refName === name || item.name === name)) {
      item.inAttribute = attr;
      dest.push(item);
      return; // go no further
    }

    // if it has a fragment, process its items
    if (item.fragment) {
      collect$1(item.fragment.iterations || item.fragment.items, name, attr, dest);
    } else if (isArray(item.items)) {
      // or if it is itself a fragment, process its items
      collect$1(item.items, name, attr, dest);
    } else if (item.type === COMPONENT && item.instance) {
      // or if it is a component, step in and process its items
      // ...unless the partial is shadowed
      if (item.instance.partials[name]) { return; }
      collect$1(item.instance.fragment.items, name, attr, dest);
    }

    // if the item is an element, process its attributes too
    if (item.type === ELEMENT) {
      if (isArray(item.attributes)) {
        collect$1(item.attributes, name, true, dest);
      }
    }
  });
}

function resetPartial(name, partial) {
  var collection = [];
  collect$1(this.fragment.items, name, false, collection);

  var promise = runloop.start();

  this.partials[name] = partial;
  collection.forEach(handleChange);

  runloop.end();

  return promise;
}

// TODO should resetTemplate be asynchronous? i.e. should it be a case
// of outro, update template, intro? I reckon probably not, since that
// could be achieved with unrender-resetTemplate-render. Also, it should
// conceptually be similar to resetPartial, which couldn't be async

function Ractive$resetTemplate(template) {
  templateConfigurator.init(null, this, { template: template });

  var transitionsEnabled = this.transitionsEnabled;
  this.transitionsEnabled = false;

  // Is this is a component, we need to set the `shouldDestroy`
  // flag, otherwise it will assume by default that a parent node
  // will be detached, and therefore it doesn't need to bother
  // detaching its own nodes
  var component = this.component;
  if (component) { component.shouldDestroy = true; }
  this.unrender();
  if (component) { component.shouldDestroy = false; }

  var promise = runloop.start();

  // remove existing fragment and create new one
  this.fragment.unbind().unrender(true);

  this.fragment = new Fragment({
    template: this.template,
    root: this,
    owner: this
  });

  var docFrag = createDocumentFragment();
  this.fragment.bind(this.viewmodel).render(docFrag);

  // if this is a component, its el may not be valid, so find a
  // target based on the component container
  if (component && !component.external) {
    this.fragment.findParentNode().insertBefore(docFrag, component.findNextNode());
  } else {
    this.el.insertBefore(docFrag, this.anchor);
  }

  runloop.end();

  this.transitionsEnabled = transitionsEnabled;

  return promise;
}

var reverse = makeArrayMethod('reverse').path;

function Ractive$set(keypath, value, options) {
  var ractive = this;

  var opts = isObjectType(keypath) ? value : options;

  return set(build(ractive, keypath, value, opts && opts.isolated), opts);
}

var shift = makeArrayMethod('shift').path;

var sort = makeArrayMethod('sort').path;

var splice = makeArrayMethod('splice').path;

function Ractive$subtract(keypath, d, options) {
  var num = isNumber(d) ? -d : -1;
  var opts = isObjectType(d) ? d : options;
  return add(this, keypath, num, opts);
}

function Ractive$toggle(keypath, options) {
  if (!isString(keypath)) {
    throw new TypeError(badArguments);
  }

  return set(
    gather(this, keypath, null, options && options.isolated).map(function (m) { return [m, !m.get()]; }),
    options
  );
}

function Ractive$toCSS() {
  var cssIds = [this.cssId ].concat( this.findAllComponents().map(function (c) { return c.cssId; }));
  var uniqueCssIds = keys(cssIds.reduce(function (ids, id) { return (ids[id] = true, ids); }, {}));
  return getCSS(uniqueCssIds);
}

function Ractive$toHTML() {
  return this.fragment.toString(true);
}

function toText() {
  return this.fragment.toString(false);
}

function Ractive$transition(name, node, params) {
  if (node instanceof HTMLElement) {
    // good to go
  } else if (isObject(node)) {
    // omitted, use event node
    params = node;
  }

  // if we allow query selector, then it won't work
  // simple params like "fast"

  // else if ( typeof node === 'string' ) {
  // 	// query selector
  // 	node = this.find( node )
  // }

  node = node || this.event.node;

  if (!node || !node._ractive) {
    fatal(("No node was supplied for transition " + name));
  }

  params = params || {};
  var owner = node._ractive.proxy;
  var transition = new Transition({ owner: owner, up: owner.up, name: name, params: params });
  transition.bind();

  var promise = runloop.start();
  runloop.registerTransition(transition);
  runloop.end();

  promise.then(function () { return transition.unbind(); });
  return promise;
}

function unlink(here) {
  var promise = runloop.start();
  this.viewmodel.joinAll(splitKeypath(here), { lastLink: false }).unlink();
  runloop.end();
  return promise;
}

function Ractive$unrender() {
  if (!this.fragment.rendered) {
    warnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');
    return Promise.resolve();
  }

  this.unrendering = true;
  var promise = runloop.start();

  hooks.unrendering.fire(this);

  // If this is a component, and the component isn't marked for destruction,
  // don't detach nodes from the DOM unnecessarily
  var shouldDestroy =
    !this.component ||
    (this.component.anchor || {}).shouldDestroy ||
    this.component.shouldDestroy ||
    this.shouldDestroy;
  this.fragment.unrender(shouldDestroy);
  if (shouldDestroy) { this.destroyed = true; }

  removeFromArray(this.el.__ractive_instances__, this);

  hooks.unrender.fire(this);

  runloop.end();
  this.unrendering = false;

  return promise;
}

var unshift = makeArrayMethod('unshift').path;

function Ractive$updateModel(keypath, cascade) {
  var promise = runloop.start();

  if (!keypath) {
    this.viewmodel.updateFromBindings(true);
  } else {
    this.viewmodel.joinAll(splitKeypath(keypath)).updateFromBindings(cascade !== false);
  }

  runloop.end();

  return promise;
}

function use() {
  var this$1 = this;
  var plugins = [], len = arguments.length;
  while ( len-- ) plugins[ len ] = arguments[ len ];

  plugins.forEach(function (p) {
    p({
      proto: this$1,
      Ractive: this$1.constructor.Ractive,
      instance: this$1
    });
  });
  return this;
}

var proto$9 = {
  add: Ractive$add,
  animate: Ractive$animate,
  attachChild: attachChild,
  compute: Ractive$compute,
  detach: Ractive$detach,
  detachChild: detachChild,
  find: Ractive$find,
  findAll: Ractive$findAll,
  findAllComponents: Ractive$findAllComponents,
  findComponent: Ractive$findComponent,
  findContainer: Ractive$findContainer,
  findParent: Ractive$findParent,
  fire: Ractive$fire,
  get: Ractive$get,
  getContext: getContext$2,
  insert: Ractive$insert,
  link: link,
  observe: observe,
  observeOnce: observeOnce,
  off: Ractive$off,
  on: Ractive$on,
  once: Ractive$once,
  pop: pop,
  push: push,
  readLink: readLink,
  render: Ractive$render,
  reset: Ractive$reset,
  resetPartial: resetPartial,
  resetTemplate: Ractive$resetTemplate,
  reverse: reverse,
  set: Ractive$set,
  shift: shift,
  sort: sort,
  splice: splice,
  subtract: Ractive$subtract,
  teardown: Ractive$teardown,
  toggle: Ractive$toggle,
  toCSS: Ractive$toCSS,
  toCss: Ractive$toCSS,
  toHTML: Ractive$toHTML,
  toHtml: Ractive$toHTML,
  toText: toText,
  transition: Ractive$transition,
  unlink: unlink,
  unrender: Ractive$unrender,
  unshift: unshift,
  update: Ractive$update,
  updateModel: Ractive$updateModel,
  use: use
};

function isInstance(object) {
  return object && object instanceof this;
}

function styleGet(keypath, opts) {
  return this._cssModel.joinAll(splitKeypath(keypath)).get(true, opts);
}

var styles = [];

function addStyle(id, css) {
  if (styles.find(function (s) { return s.id === id; }))
    { throw new Error(("Extra styles with the id '" + id + "' have already been added.")); }
  styles.push({ id: id, css: css });

  if (!this.css) {
    Object.defineProperty(this, 'css', { configurable: false, writable: false, value: buildCSS });
  }

  if (!this._cssDef) {
    Object.defineProperty(this, '_cssDef', {
      configurable: true,
      writable: false,
      value: {
        transform: false,
        id: 'Ractive.addStyle'
      }
    });

    addCSS(this._cssDef);
  }

  recomputeCSS(this);
  applyCSS(true);
}

function buildCSS(data) {
  return styles
    .map(function (s) { return "\n/* ---- extra style " + (s.id) + " */\n" + (isFunction(s.css) ? s.css(data) : s.css); })
    .join('');
}

function hasStyle(id) {
  return !!styles.find(function (s) { return s.id === id; });
}

function sharedSet(keypath, value, options) {
  var opts = isObjectType(keypath) ? value : options;
  var model = SharedModel$1;

  return set(build({ viewmodel: model }, keypath, value, true), opts);
}

function sharedGet(keypath, opts) {
  return SharedModel$1.joinAll(splitKeypath(keypath)).get(true, opts);
}

function use$1() {
  var this$1 = this;
  var plugins = [], len = arguments.length;
  while ( len-- ) plugins[ len ] = arguments[ len ];

  plugins.forEach(function (p) {
    isFunction(p) &&
      p({
        proto: this$1.prototype,
        Ractive: this$1.Ractive,
        instance: this$1
      });
  });
  return this;
}

var callsSuper = /super\s*\(|\.call\s*\(\s*this/;

function extend() {
  var options = [], len = arguments.length;
  while ( len-- ) options[ len ] = arguments[ len ];

  if (!options.length) {
    return extendOne(this);
  } else {
    return options.reduce(extendOne, this);
  }
}

function extendWith(Class, options) {
  if ( options === void 0 ) options = {};

  return extendOne(this, options, Class);
}

function extendOne(Parent, options, Target) {
  if ( options === void 0 ) options = {};

  var proto;
  var Child = isFunction(Target) && Target;

  if (options.prototype instanceof Ractive) {
    throw new Error("Ractive no longer supports multiple inheritance.");
  }

  if (Child) {
    if (!(Child.prototype instanceof Parent)) {
      throw new Error(
        "Only classes that inherit the appropriate prototype may be used with extend"
      );
    }
    if (!callsSuper.test(Child.toString())) {
      throw new Error("Only classes that call super in their constructor may be used with extend");
    }

    proto = Child.prototype;
  } else {
    Child = function(options) {
      if (!(this instanceof Child)) { return new Child(options); }

      construct(this, options || {});
      initialise(this, options || {}, {});
    };

    proto = create(Parent.prototype);
    proto.constructor = Child;

    Child.prototype = proto;
  }

  // Static properties
  defineProperties(Child, {
    // alias prototype as defaults
    defaults: { value: proto },

    extend: { value: extend, writable: true, configurable: true },
    extendWith: { value: extendWith, writable: true, configurable: true },
    extensions: { value: [] },
    use: { value: use$1 },

    isInstance: { value: isInstance },

    Parent: { value: Parent },
    Ractive: { value: Ractive },

    styleGet: { value: styleGet.bind(Child), configurable: true },
    styleSet: { value: setCSSData.bind(Child), configurable: true }
  });

  // extend configuration
  config.extend(Parent, proto, options, Child);

  // store event and observer registries on the constructor when extending
  Child._on = (Parent._on || []).concat(toPairs(options.on));
  Child._observe = (Parent._observe || []).concat(toPairs(options.observe));

  Parent.extensions.push(Child);

  // attribute defs are not inherited, but they need to be stored
  if (options.attributes) {
    var attrs;

    // allow an array of optional props or an object with arrays for optional and required props
    if (isArray(options.attributes)) {
      attrs = { optional: options.attributes, required: [] };
    } else {
      attrs = options.attributes;
    }

    // make sure the requisite keys actually store arrays
    if (!isArray(attrs.required)) { attrs.required = []; }
    if (!isArray(attrs.optional)) { attrs.optional = []; }

    Child.attributes = attrs;
  }

  dataConfigurator.extend(Parent, proto, options, Child);

  defineProperty(Child, 'helpers', { writable: true, value: proto.helpers });

  if (isArray(options.use)) { Child.use.apply(Child, options.use); }

  return Child;
}

defineProperties(Ractive, {
  sharedGet: { value: sharedGet },
  sharedSet: { value: sharedSet },
  styleGet: { configurable: true, value: styleGet.bind(Ractive) },
  styleSet: { configurable: true, value: setCSSData.bind(Ractive) },
  addCSS: { configurable: false, value: addStyle.bind(Ractive) },
  hasCSS: { configurable: false, value: hasStyle.bind(Ractive) }
});

function macro(fn, opts) {
  if (!isFunction(fn)) { throw new Error("The macro must be a function"); }

  assign(fn, opts);

  defineProperties(fn, {
    extensions: { value: [] },
    _cssIds: { value: [] },
    cssData: { value: assign(create(this.cssData), fn.cssData || {}) },

    styleGet: { value: styleGet.bind(fn) },
    styleSet: { value: setCSSData.bind(fn) }
  });

  defineProperty(fn, '_cssModel', { value: new CSSModel(fn) });

  if (fn.css) { initCSS(fn, fn, fn); }

  this.extensions.push(fn);

  return fn;
}

function findPlugin(name, type, instance) {
  return findInViewHierarchy(type, instance, name);
}

function Ractive(options) {
  if (!(this instanceof Ractive)) { return new Ractive(options); }

  construct(this, options || {});
  initialise(this, options || {}, {});
}

// check to see if we're being asked to force Ractive as a global for some weird environments
if (win && !win.Ractive) {
  var opts$1 = '';
  var script =
    document.currentScript ||
    /* istanbul ignore next */ document.querySelector('script[data-ractive-options]');

  if (script) { opts$1 = script.getAttribute('data-ractive-options') || ''; }

  /* istanbul ignore next */
  if (~opts$1.indexOf('ForceGlobal')) { win.Ractive = Ractive; }
} else if (win) {
  warn("Ractive already appears to be loaded while loading 1.3.14.");
}

assign(Ractive.prototype, proto$9, defaults);
Ractive.prototype.constructor = Ractive;

// alias prototype as `defaults`
Ractive.defaults = Ractive.prototype;

// share defaults with the parser
shared.defaults = Ractive.defaults;
shared.Ractive = Ractive;

// static properties
defineProperties(Ractive, {
  // debug flag
  DEBUG: { writable: true, value: true },
  DEBUG_PROMISES: { writable: true, value: true },

  // static methods:
  extend: { value: extend },
  extendWith: { value: extendWith },
  escapeKey: { value: escapeKey },
  evalObjectString: { value: parseJSON },
  findPlugin: { value: findPlugin },
  getContext: { value: getContext$1 },
  getCSS: { value: getCSS },
  isInstance: { value: isInstance },
  joinKeys: { value: joinKeys },
  macro: { value: macro },
  normaliseKeypath: { value: normalise },
  parse: { value: parse },
  splitKeypath: { value: splitKeypath$1 },
  // sharedSet and styleSet are in _extend because circular refs
  unescapeKey: { value: unescapeKey },
  use: { value: use$1 },

  // support
  enhance: { writable: true, value: false },
  svg: { value: svg },
  tick: {
    get: function get() {
      return batch && batch.promise;
    }
  },

  // version
  VERSION: { value: '1.3.14' },

  // plugins
  adaptors: { writable: true, value: {} },
  components: { writable: true, value: {} },
  decorators: { writable: true, value: {} },
  easing: { writable: true, value: easing },
  events: { writable: true, value: {} },
  extensions: { value: [] },
  helpers: { writable: true, value: defaults.helpers },
  interpolators: { writable: true, value: interpolators },
  partials: { writable: true, value: {} },
  transitions: { writable: true, value: {} },

  // CSS variables
  cssData: { configurable: true, value: {} },

  // access to @shared without an instance
  sharedData: { value: data },

  // for getting the source Ractive lib from a constructor
  Ractive: { value: Ractive },

  // to allow extending contexts
  Context: { value: extern.Context.prototype }
});

// cssData must already be in place
defineProperty(Ractive, '_cssModel', {
  configurable: true,
  value: new CSSModel(Ractive)
});

defineProperty(Ractive.prototype, 'rendered', {
  get: function get() {
    return this.fragment && this.fragment.rendered;
  }
});

return Ractive;

})));
//# sourceMappingURL=ractive.js.map
</script>
    <script>!function(){return function t(e,r,n){function i(s,o){if(!r[s]){if(!e[s]){var h="function"==typeof require&&require;if(!o&&h)return h(s,!0);if(a)return a(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var l=r[s]={exports:{}};e[s][0].call(l.exports,function(t){return i(e[s][1][t]||t)},l,l.exports,t,e,r,n)}return r[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}}()({1:[function(t,e,r){"use strict";r.byteLength=function(t){var e=f(t),r=e[0],n=e[1];return 3*(r+n)/4-n},r.toByteArray=function(t){var e,r,n=f(t),s=n[0],o=n[1],h=new a(function(t,e,r){return 3*(e+r)/4-r}(0,s,o)),l=0,u=o>0?s-4:s;for(r=0;r<u;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],h[l++]=e>>16&255,h[l++]=e>>8&255,h[l++]=255&e;2===o&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,h[l++]=255&e);1===o&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,h[l++]=e>>8&255,h[l++]=255&e);return h},r.fromByteArray=function(t){for(var e,r=t.length,i=r%3,a=[],s=0,o=r-i;s<o;s+=16383)a.push(l(t,s,s+16383>o?o:s+16383));1===i?(e=t[r-1],a.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],a.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return a.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=s.length;o<h;++o)n[o]=s[o],i[s.charCodeAt(o)]=o;function f(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function l(t,e,r){for(var i,a,s=[],o=e;o<r;o+=3)i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),s.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],2:[function(t,e,r){(function(e){"use strict";var n=t("base64-js"),i=t("ieee754");r.Buffer=e,r.SlowBuffer=function(t){+t!=t&&(t=0);return e.alloc(+t)},r.INSPECT_MAX_BYTES=50;var a=2147483647;function s(t){if(t>a)throw new RangeError('The value "'+t+'" is invalid for option "size"');var r=new Uint8Array(t);return r.__proto__=e.prototype,r}function e(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return f(t)}return o(t,e,r)}function o(t,r,n){if("string"==typeof t)return function(t,r){"string"==typeof r&&""!==r||(r="utf8");if(!e.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var n=0|c(t,r),i=s(n),a=i.write(t,r);a!==n&&(i=i.slice(0,a));return i}(t,r);if(ArrayBuffer.isView(t))return l(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(N(t,ArrayBuffer)||t&&N(t.buffer,ArrayBuffer))return function(t,r,n){if(r<0||t.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<r+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;i=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);return i.__proto__=e.prototype,i}(t,r,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return e.from(i,r,n);var a=function(t){if(e.isBuffer(t)){var r=0|u(t.length),n=s(r);return 0===n.length?n:(t.copy(n,0,0,r),n)}if(void 0!==t.length)return"number"!=typeof t.length||j(t.length)?s(0):l(t);if("Buffer"===t.type&&Array.isArray(t.data))return l(t.data)}(t);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return e.from(t[Symbol.toPrimitive]("string"),r,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function f(t){return h(t),s(t<0?0:0|u(t))}function l(t){for(var e=t.length<0?0:0|u(t.length),r=s(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function u(t){if(t>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|t}function c(t,r){if(e.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||N(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var n=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var a=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return M(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return O(t).length;default:if(a)return i?-1:M(t).length;r=(""+r).toLowerCase(),a=!0}}function d(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function p(t,r,n,i,a){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),j(n=+n)&&(n=a?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(a)return-1;n=t.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof r&&(r=e.from(r,i)),e.isBuffer(r))return 0===r.length?-1:_(t,r,n,i,a);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(t,r,n):Uint8Array.prototype.lastIndexOf.call(t,r,n):_(t,[r],n,i,a);throw new TypeError("val must be string, number or Buffer")}function _(t,e,r,n,i){var a,s=1,o=t.length,h=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,o/=2,h/=2,r/=2}function f(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var l=-1;for(a=r;a<o;a++)if(f(t,a)===f(e,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===h)return l*s}else-1!==l&&(a-=a-l),l=-1}else for(r+h>o&&(r=o-h),a=r;a>=0;a--){for(var u=!0,c=0;c<h;c++)if(f(t,a+c)!==f(e,c)){u=!1;break}if(u)return a}return-1}function g(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=e.length;n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(e.substr(2*s,2),16);if(j(o))return s;t[r+s]=o}return s}function w(t,e,r,n){return P(M(e,t.length-r),t,r,n)}function b(t,e,r,n){return P(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function v(t,e,r,n){return b(t,e,r,n)}function m(t,e,r,n){return P(O(e),t,r,n)}function y(t,e,r,n){return P(function(t,e){for(var r,n,i,a=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(e,t.length-r),t,r,n)}function k(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function E(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var a,s,o,h,f=t[i],l=null,u=f>239?4:f>223?3:f>191?2:1;if(i+u<=r)switch(u){case 1:f<128&&(l=f);break;case 2:128==(192&(a=t[i+1]))&&(h=(31&f)<<6|63&a)>127&&(l=h);break;case 3:a=t[i+1],s=t[i+2],128==(192&a)&&128==(192&s)&&(h=(15&f)<<12|(63&a)<<6|63&s)>2047&&(h<55296||h>57343)&&(l=h);break;case 4:a=t[i+1],s=t[i+2],o=t[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(h=(15&f)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&h<1114112&&(l=h)}null===l?(l=65533,u=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=u}return function(t){var e=t.length;if(e<=x)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=x));return r}(n)}r.kMaxLength=a,e.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),e.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e.prototype,"parent",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.buffer}}),Object.defineProperty(e.prototype,"offset",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),e.poolSize=8192,e.from=function(t,e,r){return o(t,e,r)},e.prototype.__proto__=Uint8Array.prototype,e.__proto__=Uint8Array,e.alloc=function(t,e,r){return function(t,e,r){return h(t),t<=0?s(t):void 0!==e?"string"==typeof r?s(t).fill(e,r):s(t).fill(e):s(t)}(t,e,r)},e.allocUnsafe=function(t){return f(t)},e.allocUnsafeSlow=function(t){return f(t)},e.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==e.prototype},e.compare=function(t,r){if(N(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),N(r,Uint8Array)&&(r=e.from(r,r.offset,r.byteLength)),!e.isBuffer(t)||!e.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var n=t.length,i=r.length,a=0,s=Math.min(n,i);a<s;++a)if(t[a]!==r[a]){n=t[a],i=r[a];break}return n<i?-1:i<n?1:0},e.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<t.length;++n)r+=t[n].length;var i=e.allocUnsafe(r),a=0;for(n=0;n<t.length;++n){var s=t[n];if(N(s,Uint8Array)&&(s=e.from(s)),!e.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,a),a+=s.length}return i},e.byteLength=c,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},e.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},e.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},e.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?E(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return z(this,e,r);case"utf8":case"utf-8":return E(this,e,r);case"ascii":return A(this,e,r);case"latin1":case"binary":return B(this,e,r);case"base64":return k(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},e.prototype.toLocaleString=e.prototype.toString,e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},e.prototype.compare=function(t,r,n,i,a){if(N(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),!e.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===r&&(r=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===a&&(a=this.length),r<0||n>t.length||i<0||a>this.length)throw new RangeError("out of range index");if(i>=a&&r>=n)return 0;if(i>=a)return-1;if(r>=n)return 1;if(r>>>=0,n>>>=0,i>>>=0,a>>>=0,this===t)return 0;for(var s=a-i,o=n-r,h=Math.min(s,o),f=this.slice(i,a),l=t.slice(r,n),u=0;u<h;++u)if(f[u]!==l[u]){s=f[u],o=l[u];break}return s<o?-1:o<s?1:0},e.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},e.prototype.indexOf=function(t,e,r){return p(this,t,e,r,!0)},e.prototype.lastIndexOf=function(t,e,r){return p(this,t,e,r,!1)},e.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return g(this,t,e,r);case"utf8":case"utf-8":return w(this,t,e,r);case"ascii":return b(this,t,e,r);case"latin1":case"binary":return v(this,t,e,r);case"base64":return m(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function A(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function B(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function z(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=e;a<r;++a)i+=D(t[a]);return i}function U(t,e,r){for(var n=t.slice(e,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function I(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function C(t,r,n,i,a,s){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>a||r<s)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function S(t,e,r,n,i,a){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function T(t,e,r,n,a){return e=+e,r>>>=0,a||S(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function L(t,e,r,n,a){return e=+e,r>>>=0,a||S(t,0,r,8),i.write(t,e,r,n,52,8),r+8}e.prototype.slice=function(t,r){var n=this.length;t=~~t,r=void 0===r?n:~~r,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),r<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t);var i=this.subarray(t,r);return i.__proto__=e.prototype,i},e.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return n},e.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},e.prototype.readUInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),this[t]},e.prototype.readUInt16LE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]|this[t+1]<<8},e.prototype.readUInt16BE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]<<8|this[t+1]},e.prototype.readUInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},e.prototype.readUInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},e.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},e.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=e,i=1,a=this[t+--n];n>0&&(i*=256);)a+=this[t+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*e)),a},e.prototype.readInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},e.prototype.readInt16LE=function(t,e){t>>>=0,e||I(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt16BE=function(t,e){t>>>=0,e||I(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},e.prototype.readInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},e.prototype.readFloatLE=function(t,e){return t>>>=0,e||I(t,4,this.length),i.read(this,t,!0,23,4)},e.prototype.readFloatBE=function(t,e){return t>>>=0,e||I(t,4,this.length),i.read(this,t,!1,23,4)},e.prototype.readDoubleLE=function(t,e){return t>>>=0,e||I(t,8,this.length),i.read(this,t,!0,52,8)},e.prototype.readDoubleBE=function(t,e){return t>>>=0,e||I(t,8,this.length),i.read(this,t,!1,52,8)},e.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||C(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[e]=255&t;++a<r&&(i*=256);)this[e+a]=t/i&255;return e+r},e.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||C(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+r},e.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,1,255,0),this[e]=255&t,e+1},e.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},e.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},e.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},e.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},e.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,t,e,r,i-1,-i)}var a=0,s=1,o=0;for(this[e]=255&t;++a<r&&(s*=256);)t<0&&0===o&&0!==this[e+a-1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+r},e.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,t,e,r,i-1,-i)}var a=r-1,s=1,o=0;for(this[e+a]=255&t;--a>=0&&(s*=256);)t<0&&0===o&&0!==this[e+a+1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+r},e.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},e.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},e.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},e.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},e.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},e.prototype.writeFloatLE=function(t,e,r){return T(this,t,e,!0,r)},e.prototype.writeFloatBE=function(t,e,r){return T(this,t,e,!1,r)},e.prototype.writeDoubleLE=function(t,e,r){return L(this,t,e,!0,r)},e.prototype.writeDoubleBE=function(t,e,r){return L(this,t,e,!1,r)},e.prototype.copy=function(t,r,n,i){if(!e.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),r>=t.length&&(r=t.length),r||(r=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-r<i-n&&(i=t.length-r+n);var a=i-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===t&&n<r&&r<i)for(var s=a-1;s>=0;--s)t[s+r]=this[s+n];else Uint8Array.prototype.set.call(t,this.subarray(n,i),r);return a},e.prototype.fill=function(t,r,n,i){if("string"==typeof t){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!e.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var a=t.charCodeAt(0);("utf8"===i&&a<128||"latin1"===i)&&(t=a)}}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var s;if(r>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=r;s<n;++s)this[s]=t;else{var o=e.isBuffer(t)?t:e.from(t,i),h=o.length;if(0===h)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(s=0;s<n-r;++s)this[s+r]=o[s%h]}return this};var R=/[^+/0-9A-Za-z-_]/g;function D(t){return t<16?"0"+t.toString(16):t.toString(16)}function M(t,e){var r;e=e||1/0;for(var n=t.length,i=null,a=[],s=0;s<n;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function O(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(R,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function P(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function N(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function j(t){return t!=t}}).call(this,t("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:4}],3:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=(n=t("iobuffer"))&&"object"==typeof n&&"default"in n?n.default:n,a=t("pako");const s=[137,80,78,71,13,10,26,10],o=[];for(let t=0;t<256;t++){var h=t;for(let t=0;t<8;t++)1&h?h=3988292384^h>>>1:h>>>=1;o[t]=h}const f=4294967295;function l(t,e){return(function(t,e,r){for(var n=t,i=0;i<r;i++)n=o[255&(n^e[i])]^n>>>8;return n}(f,t,e)^f)>>>0}const u=new Uint8Array(0),c="\0",d=new Uint16Array([255]),p=255===new Uint8Array(d.buffer)[0];class _ extends i{constructor(t,e){super(t);const{checkCrc:r=!1}=e;this._checkCrc=r,this._inflator=new a.Inflate,this._png=null,this._end=!1,this.setBigEndian()}decode(){for(this._png={text:{}},this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(var t=0;t<s.length;t++)if(this.readUint8()!==s[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${s[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),r=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-r!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);if(this._checkCrc){const r=this.readUint32(),n=t+4,i=l(new Uint8Array(this.buffer,this.byteOffset+this.offset-n-4,n),n);if(i!==r)throw new Error(`CRC mismatch for chunk ${e}. Expected ${r}, found ${i}`)}else this.skip(4)}decodeIHDR(){var t=this._png;if(t.width=this.readUint32(),t.height=this.readUint32(),t.bitDepth=this.readUint8(),t.colourType=this.readUint8(),t.compressionMethod=this.readUint8(),t.filterMethod=this.readUint8(),t.interlaceMethod=this.readUint8(),0!==this._png.compressionMethod)throw new Error("Unsupported compression method: "+t.compressionMethod)}decodePLTE(t){if(t%3!=0)throw new RangeError("PLTE field length must be a multiple of 3. Got "+t);var e=t/3;this._hasPalette=!0;for(var r=this._palette=new Array(e),n=0;n<e;n++)r[n]=[this.readUint8(),this.readUint8(),this.readUint8()]}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t),!1),this.skip(t)}decodetEXt(t){for(var e,r="";(e=this.readChar())!==c;)r+=e;this._png.text[r]=this.readChars(t-r.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),r=this.readByte();this._png.resolution=[t,e],this._png.unitSpecifier=r}decodeImage(){if(this._inflator.push(u,!0),this._inflator.err)throw new Error("Error while decompressing the data: "+this._inflator.err);var t=this._inflator.result;if(this._inflator=null,0!==this._png.filterMethod)throw new Error("Filter method "+this._png.filterMethod+" not supported");if(0!==this._png.interlaceMethod)throw new Error("Interlace method "+this._png.interlaceMethod+" not supported");this.decodeInterlaceNull(t)}decodeInterlaceNull(t){var e;switch(this._png.colourType){case 0:e=1;break;case 2:e=3;break;case 3:if(!this._hasPalette)throw new Error("Missing palette");e=1;break;case 4:e=2;break;case 6:e=4;break;default:throw new Error("Unknown colour type: "+this._png.colourType)}const r=this._png.height,n=e*this._png.bitDepth/8,i=this._png.width*n,a=new Uint8Array(this._png.height*i);for(var s,o,h,f=u,l=0,c=0;c<r;c++){switch(s=t.subarray(l+1,l+1+i),o=a.subarray(c*i,(c+1)*i),t[l]){case 0:g(s,o,i);break;case 1:w(s,o,i,n);break;case 2:b(s,o,f,i);break;case 3:v(s,o,f,i,n);break;case 4:m(s,o,f,i,n);break;default:throw new Error("Unsupported filter: "+t[l])}f=o,l+=i+1}if(this._hasPalette&&(this._png.palette=this._palette),16===this._png.bitDepth){const t=new Uint16Array(a.buffer);if(p)for(var d=0;d<t.length;d++)t[d]=(255&(h=t[d]))<<8|h>>8&255;this._png.data=t}else this._png.data=a}}function g(t,e,r){for(var n=0;n<r;n++)e[n]=t[n]}function w(t,e,r,n){for(var i=0;i<n;i++)e[i]=t[i];for(;i<r;i++)e[i]=t[i]+e[i-n]&255}function b(t,e,r,n){var i=0;if(0===r.length)for(;i<n;i++)e[i]=t[i];else for(;i<n;i++)e[i]=t[i]+r[i]&255}function v(t,e,r,n,i){var a=0;if(0===r.length){for(;a<i;a++)e[a]=t[a];for(;a<n;a++)e[a]=t[a]+(e[a-i]>>1)&255}else{for(;a<i;a++)e[a]=t[a]+(r[a]>>1)&255;for(;a<n;a++)e[a]=t[a]+(e[a-i]+r[a]>>1)&255}}function m(t,e,r,n,i){var a=0;if(0===r.length){for(;a<i;a++)e[a]=t[a];for(;a<n;a++)e[a]=t[a]+e[a-i]&255}else{for(;a<i;a++)e[a]=t[a]+r[a]&255;for(;a<n;a++)e[a]=t[a]+y(e[a-i],r[a],r[a-i])&255}}function y(t,e,r){var n=t+e-r,i=Math.abs(n-t),a=Math.abs(n-e),s=Math.abs(n-r);return i<=a&&i<=s?t:a<=s?e:r}const k={level:3};class E extends i{constructor(t,e){super(),this._checkData(t),this._zlibOptions=Object.assign({},k,e.zlib),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(s)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.bitDepth),this.writeByte(this._png.colourType),this.writeByte(0),this.writeByte(0),this.writeByte(0),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:e,channels:r,bitDepth:n,data:s}=this._png,o=r*t,h=(new i).setBigEndian();for(var f=0,l=0;l<e;l++)if(h.writeByte(0),8===n)f=A(s,h,o,f);else{if(16!==n)throw new Error("unreachable");f=B(s,h,o,f)}const u=h.getBuffer(),c=a.deflate(u,this._zlibOptions);this.encodeIDAT(c)}_checkData(t){this._png={width:x(t.width,"width"),height:x(t.height,"height"),data:t.data};const{colourType:e,channels:r,bitDepth:n}=function(t){const{components:e=3,alpha:r=!0,bitDepth:n=8}=t;if(3!==e&&1!==e)throw new RangeError(`unsupported number of components: ${e}`);if(8!==n&&16!==n)throw new RangeError(`unsupported bit depth: ${n}`);const i=e+Number(r),a={channels:i,bitDepth:n};switch(i){case 4:a.colourType=6;break;case 3:a.colourType=2;break;case 1:a.colourType=0;break;case 2:a.colourType=4;break;default:throw new Error(`unsupported number of channels: ${i}`)}return a}(t);this._png.colourType=e,this._png.channels=r,this._png.bitDepth=n;const i=this._png.width*this._png.height*r;if(this._png.data.length!==i)throw new RangeError(`wrong data size. Found ${this._png.data.length}, expected ${i}`)}writeCrc(t){this.writeUint32(l(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function x(t,e){if(Number.isInteger(t)&&t>0)return t;throw new TypeError(`${e} must be a positive integer`)}function A(t,e,r,n){for(var i=0;i<r;i++)e.writeByte(t[n++]);return n}function B(t,e,r,n){for(var i=0;i<r;i++)e.writeUint16(t[n++]);return n}r.decode=function(t,e={}){return new _(t,e).decode()},r.encode=function(t,e={}){return new E(t,e).encode()}},{iobuffer:5,pako:9}],4:[function(t,e,r){r.read=function(t,e,r,n,i){var a,s,o=8*i-n-1,h=(1<<o)-1,f=h>>1,l=-7,u=r?i-1:0,c=r?-1:1,d=t[e+u];for(u+=c,a=d&(1<<-l)-1,d>>=-l,l+=o;l>0;a=256*a+t[e+u],u+=c,l-=8);for(s=a&(1<<-l)-1,a>>=-l,l+=n;l>0;s=256*s+t[e+u],u+=c,l-=8);if(0===a)a=1-f;else{if(a===h)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),a-=f}return(d?-1:1)*s*Math.pow(2,a-n)},r.write=function(t,e,r,n,i,a){var s,o,h,f=8*a-i-1,l=(1<<f)-1,u=l>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,p=n?1:-1,_=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-s))<1&&(s--,h*=2),(e+=s+u>=1?c/h:c*Math.pow(2,1-u))*h>=2&&(s++,h/=2),s+u>=l?(o=0,s=l):s+u>=1?(o=(e*h-1)*Math.pow(2,i),s+=u):(o=e*Math.pow(2,u-1)*Math.pow(2,i),s=0));i>=8;t[r+d]=255&o,d+=p,o/=256,i-=8);for(s=s<<i|o,f+=i;f>0;t[r+d]=255&s,d+=p,s/=256,f-=8);t[r+d-p]|=128*_}},{}],5:[function(t,e,r){(function(r){"use strict";const n=t("utf8"),i=8192,a=[];e.exports=class{constructor(t,e){e=e||{};var r=!1;void 0===t&&(t=i),"number"==typeof t?t=new ArrayBuffer(t):(r=!0,this._lastWrittenByte=t.byteLength);const n=e.offset?e.offset>>>0:0;let a=t.byteLength-n,s=n;t.buffer&&(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+n),t=t.buffer),this._lastWrittenByte=r?a:0,this.buffer=t,this.length=a,this.byteLength=a,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,a),this._mark=0,this._marks=[]}available(t){return void 0===t&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t){return void 0===t&&(t=1),this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t){if(void 0===t&&(t=1),!this.available(t)){const e=2*(this.offset+t),r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){void 0===t&&(t=1);for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){void 0===t&&(t=1),a.length=t;for(var e=0;e<t;e++)a[e]=this.readChar();return a.join("")}readUtf8(t){void 0===t&&(t=1);const e=this.readChars(t);return n.decode(e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){const e=n.encode(t);return this.writeChars(e)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return void 0!==r?r.from(this.toArray()):this.toArray()}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}}).call(this,t("buffer").Buffer)},{buffer:2,utf8:25}],6:[function(t,e,r){var n=t("./lib/encoder"),i=t("./lib/decoder");e.exports={encode:n,decode:i}},{"./lib/decoder":7,"./lib/encoder":8}],7:[function(t,e,r){(function(t){var r=function(){"use strict";var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),e=4017,r=799,n=3406,i=2276,a=1567,s=3784,o=5793,h=2896;function f(){}function l(t,e){for(var r,n,i=0,a=[],s=16;s>0&&!t[s-1];)s--;a.push({children:[],index:0});var o,h=a[0];for(r=0;r<s;r++){for(n=0;n<t[r];n++){for((h=a.pop()).children[h.index]=e[i];h.index>0;){if(0===a.length)throw new Error("Could not recreate Huffman Table");h=a.pop()}for(h.index++,a.push(h);a.length<=r;)a.push(o={children:[],index:0}),h.children[h.index]=o.children,h=o;i++}r+1<s&&(a.push(o={children:[],index:0}),h.children[h.index]=o.children,h=o)}return a[0].children}function u(e,r,n,i,a,s,o,h,f,l){n.precision,n.samplesPerLine,n.scanLines;var u=n.mcusPerLine,c=n.progressive,d=(n.maxH,n.maxV,r),p=0,_=0;function g(){if(_>0)return p>>--_&1;if(255==(p=e[r++])){var t=e[r++];if(t)throw new Error("unexpected marker: "+(p<<8|t).toString(16))}return _=7,p>>>7}function w(t){for(var e,r=t;null!==(e=g());){if("number"==typeof(r=r[e]))return r;if("object"!=typeof r)throw new Error("invalid huffman sequence")}return null}function b(t){for(var e=0;t>0;){var r=g();if(null===r)return;e=e<<1|r,t--}return e}function v(t){var e=b(t);return e>=1<<t-1?e:e+(-1<<t)+1}var m=0;var y,k=0;function E(t,e,r,n,i){var a=r%u,s=(r/u|0)*t.v+n,o=a*t.h+i;void 0===t.blocks[s]&&l.tolerantDecoding||e(t,t.blocks[s][o])}function x(t,e,r){var n=r/t.blocksPerLine|0,i=r%t.blocksPerLine;void 0===t.blocks[n]&&l.tolerantDecoding||e(t,t.blocks[n][i])}var A,B,z,U,I,C,S=i.length;C=c?0===s?0===h?function(t,e){var r=w(t.huffmanTableDC),n=0===r?0:v(r)<<f;e[0]=t.pred+=n}:function(t,e){e[0]|=g()<<f}:0===h?function(e,r){if(m>0)m--;else for(var n=s,i=o;n<=i;){var a=w(e.huffmanTableAC),h=15&a,l=a>>4;if(0!==h)r[t[n+=l]]=v(h)*(1<<f),n++;else{if(l<15){m=b(l)+(1<<l)-1;break}n+=16}}}:function(e,r){for(var n=s,i=o,a=0;n<=i;){var h=t[n],l=r[h]<0?-1:1;switch(k){case 0:var u=w(e.huffmanTableAC),c=15&u;if(a=u>>4,0===c)a<15?(m=b(a)+(1<<a),k=4):(a=16,k=1);else{if(1!==c)throw new Error("invalid ACn encoding");y=v(c),k=a?2:3}continue;case 1:case 2:r[h]?r[h]+=(g()<<f)*l:0==--a&&(k=2==k?3:0);break;case 3:r[h]?r[h]+=(g()<<f)*l:(r[h]=y<<f,k=0);break;case 4:r[h]&&(r[h]+=(g()<<f)*l)}n++}4===k&&0==--m&&(k=0)}:function(e,r){var n=w(e.huffmanTableDC),i=0===n?0:v(n);r[0]=e.pred+=i;for(var a=1;a<64;){var s=w(e.huffmanTableAC),o=15&s,h=s>>4;if(0!==o)r[t[a+=h]]=v(o),a++;else{if(h<15)break;a+=16}}};var T,L,R,D,M=0;for(L=1==S?i[0].blocksPerLine*i[0].blocksPerColumn:u*n.mcusPerColumn,a||(a=L);M<L;){for(B=0;B<S;B++)i[B].pred=0;if(m=0,1==S)for(A=i[0],I=0;I<a;I++)x(A,C,M),M++;else for(I=0;I<a;I++){for(B=0;B<S;B++)for(R=(A=i[B]).h,D=A.v,z=0;z<D;z++)for(U=0;U<R;U++)E(A,C,M,z,U);if(++M===L)break}if(M===L)do{if(255===e[r]&&0!==e[r+1])break;r+=1}while(r<e.length-2);if(_=0,(T=e[r]<<8|e[r+1])<65280)throw new Error("marker was not found");if(!(T>=65488&&T<=65495))break;r+=2}return r-d}function c(t,f){var l,u,c=[],d=f.blocksPerLine,p=f.blocksPerColumn,_=d<<3,w=new Int32Array(64),b=new Uint8Array(64);function v(t,l,u){var c,d,p,_,g,w,b,v,m,y,k=f.quantizationTable,E=u;for(y=0;y<64;y++)E[y]=t[y]*k[y];for(y=0;y<8;++y){var x=8*y;0!=E[1+x]||0!=E[2+x]||0!=E[3+x]||0!=E[4+x]||0!=E[5+x]||0!=E[6+x]||0!=E[7+x]?(c=o*E[0+x]+128>>8,d=o*E[4+x]+128>>8,p=E[2+x],_=E[6+x],g=h*(E[1+x]-E[7+x])+128>>8,v=h*(E[1+x]+E[7+x])+128>>8,w=E[3+x]<<4,b=E[5+x]<<4,m=c-d+1>>1,c=c+d+1>>1,d=m,m=p*s+_*a+128>>8,p=p*a-_*s+128>>8,_=m,m=g-b+1>>1,g=g+b+1>>1,b=m,m=v+w+1>>1,w=v-w+1>>1,v=m,m=c-_+1>>1,c=c+_+1>>1,_=m,m=d-p+1>>1,d=d+p+1>>1,p=m,m=g*i+v*n+2048>>12,g=g*n-v*i+2048>>12,v=m,m=w*r+b*e+2048>>12,w=w*e-b*r+2048>>12,b=m,E[0+x]=c+v,E[7+x]=c-v,E[1+x]=d+b,E[6+x]=d-b,E[2+x]=p+w,E[5+x]=p-w,E[3+x]=_+g,E[4+x]=_-g):(m=o*E[0+x]+512>>10,E[0+x]=m,E[1+x]=m,E[2+x]=m,E[3+x]=m,E[4+x]=m,E[5+x]=m,E[6+x]=m,E[7+x]=m)}for(y=0;y<8;++y){var A=y;0!=E[8+A]||0!=E[16+A]||0!=E[24+A]||0!=E[32+A]||0!=E[40+A]||0!=E[48+A]||0!=E[56+A]?(c=o*E[0+A]+2048>>12,d=o*E[32+A]+2048>>12,p=E[16+A],_=E[48+A],g=h*(E[8+A]-E[56+A])+2048>>12,v=h*(E[8+A]+E[56+A])+2048>>12,w=E[24+A],b=E[40+A],m=c-d+1>>1,c=c+d+1>>1,d=m,m=p*s+_*a+2048>>12,p=p*a-_*s+2048>>12,_=m,m=g-b+1>>1,g=g+b+1>>1,b=m,m=v+w+1>>1,w=v-w+1>>1,v=m,m=c-_+1>>1,c=c+_+1>>1,_=m,m=d-p+1>>1,d=d+p+1>>1,p=m,m=g*i+v*n+2048>>12,g=g*n-v*i+2048>>12,v=m,m=w*r+b*e+2048>>12,w=w*e-b*r+2048>>12,b=m,E[0+A]=c+v,E[56+A]=c-v,E[8+A]=d+b,E[48+A]=d-b,E[16+A]=p+w,E[40+A]=p-w,E[24+A]=_+g,E[32+A]=_-g):(m=o*u[y+0]+8192>>14,E[0+A]=m,E[8+A]=m,E[16+A]=m,E[24+A]=m,E[32+A]=m,E[40+A]=m,E[48+A]=m,E[56+A]=m)}for(y=0;y<64;++y){var B=128+(E[y]+8>>4);l[y]=B<0?0:B>255?255:B}}g(_*p*8);for(var m=0;m<p;m++){var y=m<<3;for(l=0;l<8;l++)c.push(new Uint8Array(_));for(var k=0;k<d;k++){v(f.blocks[m][k],b,w);var E=0,x=k<<3;for(u=0;u<8;u++){var A=c[y+u];for(l=0;l<8;l++)A[x+l]=b[E++]}}}return c}function d(t){return t<0?0:t>255?255:t}f.prototype={load:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){var t=new Uint8Array(e.response||e.mozResponseArrayBuffer);this.parse(t),this.onload&&this.onload()}.bind(this),e.send(null)},parse:function(e){var r=1e3*this.opts.maxResolutionInMP*1e3,n=0;e.length;function i(){var t=e[n]<<8|e[n+1];return n+=2,t}function a(){var t=i(),r=e.subarray(n,n+t-2);return n+=r.length,r}function s(t){var e,r,n=0,i=0;for(r in t.components)t.components.hasOwnProperty(r)&&(n<(e=t.components[r]).h&&(n=e.h),i<e.v&&(i=e.v));var a=Math.ceil(t.samplesPerLine/8/n),s=Math.ceil(t.scanLines/8/i);for(r in t.components)if(t.components.hasOwnProperty(r)){e=t.components[r];var o=Math.ceil(Math.ceil(t.samplesPerLine/8)*e.h/n),h=Math.ceil(Math.ceil(t.scanLines/8)*e.v/i),f=a*e.h,l=s*e.v,u=[];g(256*(l*f));for(var c=0;c<l;c++){for(var d=[],p=0;p<f;p++)d.push(new Int32Array(64));u.push(d)}e.blocksPerLine=o,e.blocksPerColumn=h,e.blocks=u}t.maxH=n,t.maxV=i,t.mcusPerLine=a,t.mcusPerColumn=s}var o,h,f=null,d=null,p=[],_=[],w=[],b=[],v=i();if(this.comments=[],65496!=v)throw new Error("SOI not found");for(v=i();65497!=v;){switch(v){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var m=a();if(65534===v){var y=String.fromCharCode.apply(null,m);this.comments.push(y)}65504===v&&74===m[0]&&70===m[1]&&73===m[2]&&70===m[3]&&0===m[4]&&(f={version:{major:m[5],minor:m[6]},densityUnits:m[7],xDensity:m[8]<<8|m[9],yDensity:m[10]<<8|m[11],thumbWidth:m[12],thumbHeight:m[13],thumbData:m.subarray(14,14+3*m[12]*m[13])}),65505===v&&69===m[0]&&120===m[1]&&105===m[2]&&102===m[3]&&0===m[4]&&(this.exifBuffer=m.subarray(5,m.length)),65518===v&&65===m[0]&&100===m[1]&&111===m[2]&&98===m[3]&&101===m[4]&&0===m[5]&&(d={version:m[6],flags0:m[7]<<8|m[8],flags1:m[9]<<8|m[10],transformCode:m[11]});break;case 65499:for(var k=i()+n-2;n<k;){var E=e[n++];g(256);var x=new Int32Array(64);if(E>>4==0)for(W=0;W<64;W++){x[t[W]]=e[n++]}else{if(E>>4!=1)throw new Error("DQT: invalid table spec");for(W=0;W<64;W++){x[t[W]]=i()}}p[15&E]=x}break;case 65472:case 65473:case 65474:i(),(o={}).extended=65473===v,o.progressive=65474===v,o.precision=e[n++],o.scanLines=i(),o.samplesPerLine=i(),o.components={},o.componentsOrder=[];var A=o.scanLines*o.samplesPerLine;if(A>r){var B=Math.ceil((A-r)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${B}MP`)}var z,U=e[n++];for(X=0;X<U;X++){z=e[n];var I=e[n+1]>>4,C=15&e[n+1],S=e[n+2];o.componentsOrder.push(z),o.components[z]={h:I,v:C,quantizationIdx:S},n+=3}s(o),_.push(o);break;case 65476:var T=i();for(X=2;X<T;){var L=e[n++],R=new Uint8Array(16),D=0;for(W=0;W<16;W++,n++)D+=R[W]=e[n];g(16+D);var M=new Uint8Array(D);for(W=0;W<D;W++,n++)M[W]=e[n];X+=17+D,(L>>4==0?b:w)[15&L]=l(R,M)}break;case 65501:i(),h=i();break;case 65498:i();var O=e[n++],P=[];for(X=0;X<O;X++){q=o.components[e[n++]];var N=e[n++];q.huffmanTableDC=b[N>>4],q.huffmanTableAC=w[15&N],P.push(q)}var j=e[n++],Z=e[n++],F=e[n++],H=u(e,n,o,P,h,j,Z,F>>4,15&F,this.opts);n+=H;break;case 65535:255!==e[n]&&n--;break;default:if(255==e[n-3]&&e[n-2]>=192&&e[n-2]<=254){n-=3;break}throw new Error("unknown JPEG marker "+v.toString(16))}v=i()}if(1!=_.length)throw new Error("only single frame JPEGs supported");for(var X=0;X<_.length;X++){var Y=_[X].components;for(var W in Y)Y[W].quantizationTable=p[Y[W].quantizationIdx],delete Y[W].quantizationIdx}this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=f,this.adobe=d,this.components=[];for(X=0;X<o.componentsOrder.length;X++){var q=o.components[o.componentsOrder[X]];this.components.push({lines:c(0,q),scaleX:q.h/o.maxH,scaleY:q.v/o.maxV})}},getData:function(t,e){var r,n,i,a,s,o,h,f,l,u,c,p,_,w,b,v,m,y,k,E,x,A=this.width/t,B=this.height/e,z=0,U=t*e*this.components.length;g(U);var I=new Uint8Array(U);switch(this.components.length){case 1:for(r=this.components[0],u=0;u<e;u++)for(s=r.lines[0|u*r.scaleY*B],l=0;l<t;l++)c=s[0|l*r.scaleX*A],I[z++]=c;break;case 2:for(r=this.components[0],n=this.components[1],u=0;u<e;u++)for(s=r.lines[0|u*r.scaleY*B],o=n.lines[0|u*n.scaleY*B],l=0;l<t;l++)c=s[0|l*r.scaleX*A],I[z++]=c,c=o[0|l*n.scaleX*A],I[z++]=c;break;case 3:for(x=!0,this.adobe&&this.adobe.transformCode?x=!0:void 0!==this.opts.colorTransform&&(x=!!this.opts.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],u=0;u<e;u++)for(s=r.lines[0|u*r.scaleY*B],o=n.lines[0|u*n.scaleY*B],h=i.lines[0|u*i.scaleY*B],l=0;l<t;l++)x?(c=s[0|l*r.scaleX*A],p=o[0|l*n.scaleX*A],y=d(c+1.402*((_=h[0|l*i.scaleX*A])-128)),k=d(c-.3441363*(p-128)-.71413636*(_-128)),E=d(c+1.772*(p-128))):(y=s[0|l*r.scaleX*A],k=o[0|l*n.scaleX*A],E=h[0|l*i.scaleX*A]),I[z++]=y,I[z++]=k,I[z++]=E;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(x=!1,this.adobe&&this.adobe.transformCode?x=!0:void 0!==this.opts.colorTransform&&(x=!!this.opts.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],a=this.components[3],u=0;u<e;u++)for(s=r.lines[0|u*r.scaleY*B],o=n.lines[0|u*n.scaleY*B],h=i.lines[0|u*i.scaleY*B],f=a.lines[0|u*a.scaleY*B],l=0;l<t;l++)x?(c=s[0|l*r.scaleX*A],p=o[0|l*n.scaleX*A],_=h[0|l*i.scaleX*A],w=f[0|l*a.scaleX*A],b=255-d(c+1.402*(_-128)),v=255-d(c-.3441363*(p-128)-.71413636*(_-128)),m=255-d(c+1.772*(p-128))):(b=s[0|l*r.scaleX*A],v=o[0|l*n.scaleX*A],m=h[0|l*i.scaleX*A],w=f[0|l*a.scaleX*A]),I[z++]=255-b,I[z++]=255-v,I[z++]=255-m,I[z++]=255-w;break;default:throw new Error("Unsupported color mode")}return I},copyToImageData:function(t,e){var r,n,i,a,s,o,h,f,l,u=t.width,c=t.height,p=t.data,_=this.getData(u,c),g=0,w=0;switch(this.components.length){case 1:for(n=0;n<c;n++)for(r=0;r<u;r++)i=_[g++],p[w++]=i,p[w++]=i,p[w++]=i,e&&(p[w++]=255);break;case 3:for(n=0;n<c;n++)for(r=0;r<u;r++)h=_[g++],f=_[g++],l=_[g++],p[w++]=h,p[w++]=f,p[w++]=l,e&&(p[w++]=255);break;case 4:for(n=0;n<c;n++)for(r=0;r<u;r++)s=_[g++],o=_[g++],i=_[g++],h=255-d(s*(1-(a=_[g++])/255)+a),f=255-d(o*(1-a/255)+a),l=255-d(i*(1-a/255)+a),p[w++]=h,p[w++]=f,p[w++]=l,e&&(p[w++]=255);break;default:throw new Error("Unsupported color mode")}}};var p=0,_=0;function g(t=0){var e=p+t;if(e>_){var r=Math.ceil((e-_)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${r}MB`)}p=e}return f.resetMaxMemoryUsage=function(t){p=0,_=t},f.getBytesAllocated=function(){return p},f.requestMemoryAllocation=g,f}();function n(e,n={}){var i={...{colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},...n},a=new Uint8Array(e),s=new r;s.opts=i,r.resetMaxMemoryUsage(1024*i.maxMemoryUsageInMB*1024),s.parse(a);var o=i.formatAsRGBA?4:3,h=s.width*s.height*o;try{r.requestMemoryAllocation(h);var f={width:s.width,height:s.height,exifBuffer:s.exifBuffer,data:i.useTArray?new Uint8Array(h):new t(h)};s.comments.length>0&&(f.comments=s.comments)}catch(t){throw t instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+h):t}return s.copyToImageData(f,i.formatAsRGBA),f}void 0!==e?e.exports=n:"undefined"!=typeof window&&(window["jpeg-js"]=window["jpeg-js"]||{},window["jpeg-js"].decode=n)}).call(this,t("buffer").Buffer)},{buffer:2}],8:[function(t,e,r){(function(t){function r(r){Math.round;var n,i,a,s,o,h=Math.floor,f=new Array(64),l=new Array(64),u=new Array(64),c=new Array(64),d=new Array(65535),p=new Array(65535),_=new Array(64),g=new Array(64),w=[],b=0,v=7,m=new Array(64),y=new Array(64),k=new Array(64),E=new Array(256),x=new Array(2048),A=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],B=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],z=[0,1,2,3,4,5,6,7,8,9,10,11],U=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],I=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],C=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],S=[0,1,2,3,4,5,6,7,8,9,10,11],T=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],L=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function R(t,e){for(var r=0,n=0,i=new Array,a=1;a<=16;a++){for(var s=1;s<=t[a];s++)i[e[n]]=[],i[e[n]][0]=r,i[e[n]][1]=a,n++,r++;r*=2}return i}function D(t){for(var e=t[0],r=t[1]-1;r>=0;)e&1<<r&&(b|=1<<v),r--,--v<0&&(255==b?(M(255),M(0)):M(b),v=7,b=0)}function M(t){w.push(t)}function O(t){M(t>>8&255),M(255&t)}function P(t,e,r,n,i){for(var a,s=i[0],o=i[240],h=function(t,e){var r,n,i,a,s,o,h,f,l,u,c=0;for(l=0;l<8;++l){r=t[c],n=t[c+1],i=t[c+2],a=t[c+3],s=t[c+4],o=t[c+5],h=t[c+6];var d=r+(f=t[c+7]),p=r-f,g=n+h,w=n-h,b=i+o,v=i-o,m=a+s,y=a-s,k=d+m,E=d-m,x=g+b,A=g-b;t[c]=k+x,t[c+4]=k-x;var B=.707106781*(A+E);t[c+2]=E+B,t[c+6]=E-B;var z=.382683433*((k=y+v)-(A=w+p)),U=.5411961*k+z,I=1.306562965*A+z,C=.707106781*(x=v+w),S=p+C,T=p-C;t[c+5]=T+U,t[c+3]=T-U,t[c+1]=S+I,t[c+7]=S-I,c+=8}for(c=0,l=0;l<8;++l){r=t[c],n=t[c+8],i=t[c+16],a=t[c+24],s=t[c+32],o=t[c+40],h=t[c+48];var L=r+(f=t[c+56]),R=r-f,D=n+h,M=n-h,O=i+o,P=i-o,N=a+s,j=a-s,Z=L+N,F=L-N,H=D+O,X=D-O;t[c]=Z+H,t[c+32]=Z-H;var Y=.707106781*(X+F);t[c+16]=F+Y,t[c+48]=F-Y;var W=.382683433*((Z=j+P)-(X=M+R)),q=.5411961*Z+W,G=1.306562965*X+W,$=.707106781*(H=P+M),K=R+$,V=R-$;t[c+40]=V+q,t[c+24]=V-q,t[c+8]=K+G,t[c+56]=K-G,c++}for(l=0;l<64;++l)u=t[l]*e[l],_[l]=u>0?u+.5|0:u-.5|0;return _}(t,e),f=0;f<64;++f)g[A[f]]=h[f];var l=g[0]-r;r=g[0],0==l?D(n[0]):(D(n[p[a=32767+l]]),D(d[a]));for(var u=63;u>0&&0==g[u];u--);if(0==u)return D(s),r;for(var c,w=1;w<=u;){for(var b=w;0==g[w]&&w<=u;++w);var v=w-b;if(v>=16){c=v>>4;for(var m=1;m<=c;++m)D(o);v&=15}a=32767+g[w],D(i[(v<<4)+p[a]]),D(d[a]),w++}return 63!=u&&D(s),r}function N(t){if(t<=0&&(t=1),t>100&&(t=100),o!=t){(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var n=h((e[r]*t+50)/100);n<1?n=1:n>255&&(n=255),f[A[r]]=n}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var s=h((i[a]*t+50)/100);s<1?s=1:s>255&&(s=255),l[A[a]]=s}for(var o=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],d=0,p=0;p<8;p++)for(var _=0;_<8;_++)u[d]=1/(f[A[d]]*o[p]*o[_]*8),c[d]=1/(l[A[d]]*o[p]*o[_]*8),d++})(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),o=t}}this.encode=function(r,o){(new Date).getTime();o&&N(o),w=new Array,b=0,v=7,O(65496),O(65504),O(16),M(74),M(70),M(73),M(70),M(0),M(1),M(1),M(0),O(1),O(1),M(0),M(0),function(t){if(t){O(65505),69===t[0]&&120===t[1]&&105===t[2]&&102===t[3]?O(t.length+2):(O(t.length+5+2),M(69),M(120),M(105),M(102),M(0));for(var e=0;e<t.length;e++)M(t[e])}}(r.exifBuffer),function(){O(65499),O(132),M(0);for(var t=0;t<64;t++)M(f[t]);M(1);for(var e=0;e<64;e++)M(l[e])}(),function(t,e){O(65472),O(17),M(8),O(e),O(t),M(3),M(1),M(17),M(0),M(2),M(17),M(1),M(3),M(17),M(1)}(r.width,r.height),function(){O(65476),O(418),M(0);for(var t=0;t<16;t++)M(B[t+1]);for(var e=0;e<=11;e++)M(z[e]);M(16);for(var r=0;r<16;r++)M(U[r+1]);for(var n=0;n<=161;n++)M(I[n]);M(1);for(var i=0;i<16;i++)M(C[i+1]);for(var a=0;a<=11;a++)M(S[a]);M(17);for(var s=0;s<16;s++)M(T[s+1]);for(var o=0;o<=161;o++)M(L[o])}(),O(65498),O(12),M(3),M(1),M(0),M(2),M(17),M(3),M(17),M(0),M(63),M(0);var h=0,d=0,p=0;b=0,v=7,this.encode.displayName="_encode_";for(var _,g,E,A,R,j,Z,F,H,X=r.data,Y=r.width,W=r.height,q=4*Y,G=0;G<W;){for(_=0;_<q;){for(j=R=q*G+_,Z=-1,F=0,H=0;H<64;H++)j=R+(F=H>>3)*q+(Z=4*(7&H)),G+F>=W&&(j-=q*(G+1+F-W)),_+Z>=q&&(j-=_+Z-q+4),g=X[j++],E=X[j++],A=X[j++],m[H]=(x[g]+x[E+256>>0]+x[A+512>>0]>>16)-128,y[H]=(x[g+768>>0]+x[E+1024>>0]+x[A+1280>>0]>>16)-128,k[H]=(x[g+1280>>0]+x[E+1536>>0]+x[A+1792>>0]>>16)-128;h=P(m,u,h,n,a),d=P(y,c,d,i,s),p=P(k,c,p,i,s),_+=32}G+=8}if(v>=0){var $=[];$[1]=v+1,$[0]=(1<<v+1)-1,D($)}return O(65497),void 0===e?new Uint8Array(w):new t(w)},function(){(new Date).getTime();r||(r=50),function(){for(var t=String.fromCharCode,e=0;e<256;e++)E[e]=t(e)}(),n=R(B,z),i=R(C,S),a=R(U,I),s=R(T,L),function(){for(var t=1,e=2,r=1;r<=15;r++){for(var n=t;n<e;n++)p[32767+n]=r,d[32767+n]=[],d[32767+n][1]=r,d[32767+n][0]=n;for(var i=-(e-1);i<=-t;i++)p[32767+i]=r,d[32767+i]=[],d[32767+i][1]=r,d[32767+i][0]=e-1+i;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)x[t]=19595*t,x[t+256>>0]=38470*t,x[t+512>>0]=7471*t+32768,x[t+768>>0]=-11059*t,x[t+1024>>0]=-21709*t,x[t+1280>>0]=32768*t+8421375,x[t+1536>>0]=-27439*t,x[t+1792>>0]=-5329*t}(),N(r),(new Date).getTime()}()}function n(t,e){return void 0===e&&(e=50),{data:new r(e).encode(t,e),width:t.width,height:t.height}}void 0!==e?e.exports=n:"undefined"!=typeof window&&(window["jpeg-js"]=window["jpeg-js"]||{},window["jpeg-js"].encode=n)}).call(this,t("buffer").Buffer)},{buffer:2}],9:[function(t,e,r){"use strict";var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=n},{"./lib/deflate":10,"./lib/inflate":11,"./lib/utils/common":12,"./lib/zlib/constants":15}],10:[function(t,e,r){"use strict";var n=t("./zlib/deflate"),i=t("./utils/common"),a=t("./utils/strings"),s=t("./zlib/messages"),o=t("./zlib/zstream"),h=Object.prototype.toString,f=0,l=-1,u=0,c=8;function d(t){if(!(this instanceof d))return new d(t);this.options=i.assign({level:l,method:c,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==f)throw new Error(s[r]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(r=n.deflateSetDictionary(this.strm,p))!==f)throw new Error(s[r]);this._dict_set=!0}}function p(t,e){var r=new d(e);if(r.push(t,!0),r.err)throw r.msg||s[r.err];return r.result}d.prototype.push=function(t,e){var r,s,o=this.strm,l=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=a.string2buf(t):"[object ArrayBuffer]"===h.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new i.Buf8(l),o.next_out=0,o.avail_out=l),1!==(r=n.deflate(o,s))&&r!==f)return this.onEnd(r),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(o.output,o.next_out))):this.onData(i.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==r);return 4===s?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===f):2!==s||(this.onEnd(f),o.avail_out=0,!0)},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===f&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Deflate=d,r.deflate=p,r.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},r.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},{"./utils/common":12,"./utils/strings":13,"./zlib/deflate":17,"./zlib/messages":22,"./zlib/zstream":24}],11:[function(t,e,r){"use strict";var n=t("./zlib/inflate"),i=t("./utils/common"),a=t("./utils/strings"),s=t("./zlib/constants"),o=t("./zlib/messages"),h=t("./zlib/zstream"),f=t("./zlib/gzheader"),l=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,e.windowBits);if(r!==s.Z_OK)throw new Error(o[r]);if(this.header=new f,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=a.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=n.inflateSetDictionary(this.strm,e.dictionary))!==s.Z_OK))throw new Error(o[r])}function c(t,e){var r=new u(e);if(r.push(t,!0),r.err)throw r.msg||o[r.err];return r.result}u.prototype.push=function(t,e){var r,o,h,f,u,c=this.strm,d=this.options.chunkSize,p=this.options.dictionary,_=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?c.input=a.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?c.input=new Uint8Array(t):c.input=t,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new i.Buf8(d),c.next_out=0,c.avail_out=d),(r=n.inflate(c,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===s.Z_BUF_ERROR&&!0===_&&(r=s.Z_OK,_=!1),r!==s.Z_STREAM_END&&r!==s.Z_OK)return this.onEnd(r),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&r!==s.Z_STREAM_END&&(0!==c.avail_in||o!==s.Z_FINISH&&o!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(h=a.utf8border(c.output,c.next_out),f=c.next_out-h,u=a.buf2string(c.output,h),c.next_out=f,c.avail_out=d-f,f&&i.arraySet(c.output,c.output,h,f,0),this.onData(u)):this.onData(i.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(_=!0)}while((c.avail_in>0||0===c.avail_out)&&r!==s.Z_STREAM_END);return r===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===s.Z_OK):o!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),c.avail_out=0,!0)},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=u,r.inflate=c,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,c(t,e)},r.ungzip=c},{"./utils/common":12,"./utils/strings":13,"./zlib/constants":15,"./zlib/gzheader":18,"./zlib/inflate":20,"./zlib/messages":22,"./zlib/zstream":24}],12:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(t[n]=r[n])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var a={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var a=0;a<n;a++)t[i+a]=e[r+a]},flattenChunks:function(t){var e,r,n,i,a,s;for(n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(s=new Uint8Array(n),i=0,e=0,r=t.length;e<r;e++)a=t[e],s.set(a,i),i+=a.length;return s}},s={arraySet:function(t,e,r,n,i){for(var a=0;a<n;a++)t[i+a]=e[r+a]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],13:[function(t,e,r){"use strict";var n=t("./common"),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new n.Buf8(256),o=0;o<256;o++)s[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function h(t,e){if(e<65534&&(t.subarray&&a||!t.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var r="",s=0;s<e;s++)r+=String.fromCharCode(t[s]);return r}s[254]=s[254]=1,r.string2buf=function(t){var e,r,i,a,s,o=t.length,h=0;for(a=0;a<o;a++)55296==(64512&(r=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(i=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),h+=r<128?1:r<2048?2:r<65536?3:4;for(e=new n.Buf8(h),s=0,a=0;s<h;a++)55296==(64512&(r=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(i=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?e[s++]=r:r<2048?(e[s++]=192|r>>>6,e[s++]=128|63&r):r<65536?(e[s++]=224|r>>>12,e[s++]=128|r>>>6&63,e[s++]=128|63&r):(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63,e[s++]=128|r>>>6&63,e[s++]=128|63&r);return e},r.buf2binstring=function(t){return h(t,t.length)},r.binstring2buf=function(t){for(var e=new n.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,n,i,a,o=e||t.length,f=new Array(2*o);for(n=0,r=0;r<o;)if((i=t[r++])<128)f[n++]=i;else if((a=s[i])>4)f[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<o;)i=i<<6|63&t[r++],a--;a>1?f[n++]=65533:i<65536?f[n++]=i:(i-=65536,f[n++]=55296|i>>10&1023,f[n++]=56320|1023&i)}return h(f,n)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+s[t[r]]>e?r:e}},{"./common":12}],14:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){for(var i=65535&t|0,a=t>>>16&65535|0,s=0;0!==r;){r-=s=r>2e3?2e3:r;do{a=a+(i=i+e[n++]|0)|0}while(--s);i%=65521,a%=65521}return i|a<<16|0}},{}],15:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],16:[function(t,e,r){"use strict";var n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,i){var a=n,s=i+r;t^=-1;for(var o=i;o<s;o++)t=t>>>8^a[255&(t^e[o])];return-1^t}},{}],17:[function(t,e,r){"use strict";var n,i=t("../utils/common"),a=t("./trees"),s=t("./adler32"),o=t("./crc32"),h=t("./messages"),f=0,l=1,u=3,c=4,d=5,p=0,_=1,g=-2,w=-3,b=-5,v=-1,m=1,y=2,k=3,E=4,x=0,A=2,B=8,z=9,U=15,I=8,C=286,S=30,T=19,L=2*C+1,R=15,D=3,M=258,O=M+D+1,P=32,N=42,j=69,Z=73,F=91,H=103,X=113,Y=666,W=1,q=2,G=3,$=4,K=3;function V(t,e){return t.msg=h[e],e}function J(t){return(t<<1)-(t>4?9:0)}function Q(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(i.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function et(t,e){a._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function rt(t,e){t.pending_buf[t.pending++]=e}function nt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function it(t,e){var r,n,i=t.max_chain_length,a=t.strstart,s=t.prev_length,o=t.nice_match,h=t.strstart>t.w_size-O?t.strstart-(t.w_size-O):0,f=t.window,l=t.w_mask,u=t.prev,c=t.strstart+M,d=f[a+s-1],p=f[a+s];t.prev_length>=t.good_match&&(i>>=2),o>t.lookahead&&(o=t.lookahead);do{if(f[(r=e)+s]===p&&f[r+s-1]===d&&f[r]===f[a]&&f[++r]===f[a+1]){a+=2,r++;do{}while(f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&f[++a]===f[++r]&&a<c);if(n=M-(c-a),a=c-M,n>s){if(t.match_start=e,s=n,n>=o)break;d=f[a+s-1],p=f[a+s]}}}while((e=u[e&l])>h&&0!=--i);return s<=t.lookahead?s:t.lookahead}function at(t){var e,r,n,a,h,f,l,u,c,d,p=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-O)){i.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=r=t.hash_size;do{n=t.head[--e],t.head[e]=n>=p?n-p:0}while(--r);e=r=p;do{n=t.prev[--e],t.prev[e]=n>=p?n-p:0}while(--r);a+=p}if(0===t.strm.avail_in)break;if(f=t.strm,l=t.window,u=t.strstart+t.lookahead,c=a,d=void 0,(d=f.avail_in)>c&&(d=c),r=0===d?0:(f.avail_in-=d,i.arraySet(l,f.input,f.next_in,d,u),1===f.state.wrap?f.adler=s(f.adler,l,d,u):2===f.state.wrap&&(f.adler=o(f.adler,l,d,u)),f.next_in+=d,f.total_in+=d,d),t.lookahead+=r,t.lookahead+t.insert>=D)for(h=t.strstart-t.insert,t.ins_h=t.window[h],t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+D-1])&t.hash_mask,t.prev[h&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=h,h++,t.insert--,!(t.lookahead+t.insert<D)););}while(t.lookahead<O&&0!==t.strm.avail_in)}function st(t,e){for(var r,n;;){if(t.lookahead<O){if(at(t),t.lookahead<O&&e===f)return W;if(0===t.lookahead)break}if(r=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-O&&(t.match_length=it(t,r)),t.match_length>=D)if(n=a._tr_tally(t,t.strstart-t.match_start,t.match_length-D),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=D){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=t.strstart<D-1?t.strstart:D-1,e===c?(et(t,!0),0===t.strm.avail_out?G:$):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:q}function ot(t,e){for(var r,n,i;;){if(t.lookahead<O){if(at(t),t.lookahead<O&&e===f)return W;if(0===t.lookahead)break}if(r=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=D-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-O&&(t.match_length=it(t,r),t.match_length<=5&&(t.strategy===m||t.match_length===D&&t.strstart-t.match_start>4096)&&(t.match_length=D-1)),t.prev_length>=D&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-D,n=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-D),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=D-1,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return W}else if(t.match_available){if((n=a._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return W}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<D-1?t.strstart:D-1,e===c?(et(t,!0),0===t.strm.avail_out?G:$):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:q}function ht(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function ft(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=A,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?N:X,t.adler=2===e.wrap?0:1,e.last_flush=f,a._tr_init(e),p):V(t,g)}function lt(t){var e,r=ft(t);return r===p&&((e=t.state).window_size=2*e.w_size,Q(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=D-1,e.match_available=0,e.ins_h=0),r}function ut(t,e,r,n,a,s){if(!t)return g;var o=1;if(e===v&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>z||r!==B||n<8||n>15||e<0||e>9||s<0||s>E)return V(t,g);8===n&&(n=9);var h=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=B,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*L),this.dyn_dtree=new i.Buf16(2*(2*S+1)),this.bl_tree=new i.Buf16(2*(2*T+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(R+1),this.heap=new i.Buf16(2*C+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*C+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return t.state=h,h.strm=t,h.wrap=o,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=a+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+D-1)/D),h.window=new i.Buf8(2*h.w_size),h.head=new i.Buf16(h.hash_size),h.prev=new i.Buf16(h.w_size),h.lit_bufsize=1<<a+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new i.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=s,h.method=r,lt(t)}n=[new ht(0,0,0,0,function(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(at(t),0===t.lookahead&&e===f)return W;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,et(t,!1),0===t.strm.avail_out))return W;if(t.strstart-t.block_start>=t.w_size-O&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===c?(et(t,!0),0===t.strm.avail_out?G:$):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),W)}),new ht(4,4,8,4,st),new ht(4,5,16,8,st),new ht(4,6,32,32,st),new ht(4,4,16,16,ot),new ht(8,16,32,32,ot),new ht(8,16,128,128,ot),new ht(8,32,128,256,ot),new ht(32,128,258,1024,ot),new ht(32,258,258,4096,ot)],r.deflateInit=function(t,e){return ut(t,e,B,U,I,x)},r.deflateInit2=ut,r.deflateReset=lt,r.deflateResetKeep=ft,r.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?g:(t.state.gzhead=e,p):g},r.deflate=function(t,e){var r,i,s,h;if(!t||!t.state||e>d||e<0)return t?V(t,g):g;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===Y&&e!==c)return V(t,0===t.avail_out?b:g);if(i.strm=t,r=i.last_flush,i.last_flush=e,i.status===N)if(2===i.wrap)t.adler=0,rt(i,31),rt(i,139),rt(i,8),i.gzhead?(rt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),rt(i,255&i.gzhead.time),rt(i,i.gzhead.time>>8&255),rt(i,i.gzhead.time>>16&255),rt(i,i.gzhead.time>>24&255),rt(i,9===i.level?2:i.strategy>=y||i.level<2?4:0),rt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(rt(i,255&i.gzhead.extra.length),rt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=o(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=j):(rt(i,0),rt(i,0),rt(i,0),rt(i,0),rt(i,0),rt(i,9===i.level?2:i.strategy>=y||i.level<2?4:0),rt(i,K),i.status=X);else{var w=B+(i.w_bits-8<<4)<<8;w|=(i.strategy>=y||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(w|=P),w+=31-w%31,i.status=X,nt(i,w),0!==i.strstart&&(nt(i,t.adler>>>16),nt(i,65535&t.adler)),t.adler=1}if(i.status===j)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending!==i.pending_buf_size));)rt(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Z)}else i.status=Z;if(i.status===Z)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending===i.pending_buf_size)){h=1;break}h=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,rt(i,h)}while(0!==h);i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),0===h&&(i.gzindex=0,i.status=F)}else i.status=F;if(i.status===F)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),tt(t),s=i.pending,i.pending===i.pending_buf_size)){h=1;break}h=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,rt(i,h)}while(0!==h);i.gzhead.hcrc&&i.pending>s&&(t.adler=o(t.adler,i.pending_buf,i.pending-s,s)),0===h&&(i.status=H)}else i.status=H;if(i.status===H&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&tt(t),i.pending+2<=i.pending_buf_size&&(rt(i,255&t.adler),rt(i,t.adler>>8&255),t.adler=0,i.status=X)):i.status=X),0!==i.pending){if(tt(t),0===t.avail_out)return i.last_flush=-1,p}else if(0===t.avail_in&&J(e)<=J(r)&&e!==c)return V(t,b);if(i.status===Y&&0!==t.avail_in)return V(t,b);if(0!==t.avail_in||0!==i.lookahead||e!==f&&i.status!==Y){var v=i.strategy===y?function(t,e){for(var r;;){if(0===t.lookahead&&(at(t),0===t.lookahead)){if(e===f)return W;break}if(t.match_length=0,r=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===c?(et(t,!0),0===t.strm.avail_out?G:$):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:q}(i,e):i.strategy===k?function(t,e){for(var r,n,i,s,o=t.window;;){if(t.lookahead<=M){if(at(t),t.lookahead<=M&&e===f)return W;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=D&&t.strstart>0&&(n=o[i=t.strstart-1])===o[++i]&&n===o[++i]&&n===o[++i]){s=t.strstart+M;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<s);t.match_length=M-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=D?(r=a._tr_tally(t,1,t.match_length-D),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(et(t,!1),0===t.strm.avail_out))return W}return t.insert=0,e===c?(et(t,!0),0===t.strm.avail_out?G:$):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?W:q}(i,e):n[i.level].func(i,e);if(v!==G&&v!==$||(i.status=Y),v===W||v===G)return 0===t.avail_out&&(i.last_flush=-1),p;if(v===q&&(e===l?a._tr_align(i):e!==d&&(a._tr_stored_block(i,0,0,!1),e===u&&(Q(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),tt(t),0===t.avail_out))return i.last_flush=-1,p}return e!==c?p:i.wrap<=0?_:(2===i.wrap?(rt(i,255&t.adler),rt(i,t.adler>>8&255),rt(i,t.adler>>16&255),rt(i,t.adler>>24&255),rt(i,255&t.total_in),rt(i,t.total_in>>8&255),rt(i,t.total_in>>16&255),rt(i,t.total_in>>24&255)):(nt(i,t.adler>>>16),nt(i,65535&t.adler)),tt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:_)},r.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==N&&e!==j&&e!==Z&&e!==F&&e!==H&&e!==X&&e!==Y?V(t,g):(t.state=null,e===X?V(t,w):p):g},r.deflateSetDictionary=function(t,e){var r,n,a,o,h,f,l,u,c=e.length;if(!t||!t.state)return g;if(2===(o=(r=t.state).wrap)||1===o&&r.status!==N||r.lookahead)return g;for(1===o&&(t.adler=s(t.adler,e,c,0)),r.wrap=0,c>=r.w_size&&(0===o&&(Q(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new i.Buf8(r.w_size),i.arraySet(u,e,c-r.w_size,r.w_size,0),e=u,c=r.w_size),h=t.avail_in,f=t.next_in,l=t.input,t.avail_in=c,t.next_in=0,t.input=e,at(r);r.lookahead>=D;){n=r.strstart,a=r.lookahead-(D-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+D-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--a);r.strstart=n,r.lookahead=D-1,at(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=D-1,r.match_available=0,t.next_in=f,t.input=l,t.avail_in=h,r.wrap=o,p},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":12,"./adler32":14,"./crc32":16,"./messages":22,"./trees":23}],18:[function(t,e,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],19:[function(t,e,r){"use strict";e.exports=function(t,e){var r,n,i,a,s,o,h,f,l,u,c,d,p,_,g,w,b,v,m,y,k,E,x,A,B;r=t.state,n=t.next_in,A=t.input,i=n+(t.avail_in-5),a=t.next_out,B=t.output,s=a-(e-t.avail_out),o=a+(t.avail_out-257),h=r.dmax,f=r.wsize,l=r.whave,u=r.wnext,c=r.window,d=r.hold,p=r.bits,_=r.lencode,g=r.distcode,w=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;t:do{p<15&&(d+=A[n++]<<p,p+=8,d+=A[n++]<<p,p+=8),v=_[d&w];e:for(;;){if(d>>>=m=v>>>24,p-=m,0===(m=v>>>16&255))B[a++]=65535&v;else{if(!(16&m)){if(0==(64&m)){v=_[(65535&v)+(d&(1<<m)-1)];continue e}if(32&m){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}y=65535&v,(m&=15)&&(p<m&&(d+=A[n++]<<p,p+=8),y+=d&(1<<m)-1,d>>>=m,p-=m),p<15&&(d+=A[n++]<<p,p+=8,d+=A[n++]<<p,p+=8),v=g[d&b];r:for(;;){if(d>>>=m=v>>>24,p-=m,!(16&(m=v>>>16&255))){if(0==(64&m)){v=g[(65535&v)+(d&(1<<m)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(k=65535&v,p<(m&=15)&&(d+=A[n++]<<p,(p+=8)<m&&(d+=A[n++]<<p,p+=8)),(k+=d&(1<<m)-1)>h){t.msg="invalid distance too far back",r.mode=30;break t}if(d>>>=m,p-=m,k>(m=a-s)){if((m=k-m)>l&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(E=0,x=c,0===u){if(E+=f-m,m<y){y-=m;do{B[a++]=c[E++]}while(--m);E=a-k,x=B}}else if(u<m){if(E+=f+u-m,(m-=u)<y){y-=m;do{B[a++]=c[E++]}while(--m);if(E=0,u<y){y-=m=u;do{B[a++]=c[E++]}while(--m);E=a-k,x=B}}}else if(E+=u-m,m<y){y-=m;do{B[a++]=c[E++]}while(--m);E=a-k,x=B}for(;y>2;)B[a++]=x[E++],B[a++]=x[E++],B[a++]=x[E++],y-=3;y&&(B[a++]=x[E++],y>1&&(B[a++]=x[E++]))}else{E=a-k;do{B[a++]=B[E++],B[a++]=B[E++],B[a++]=B[E++],y-=3}while(y>2);y&&(B[a++]=B[E++],y>1&&(B[a++]=B[E++]))}break}}break}}while(n<i&&a<o);n-=y=p>>3,d&=(1<<(p-=y<<3))-1,t.next_in=n,t.next_out=a,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=a<o?o-a+257:257-(a-o),r.hold=d,r.bits=p}},{}],20:[function(t,e,r){"use strict";var n=t("../utils/common"),i=t("./adler32"),a=t("./crc32"),s=t("./inffast"),o=t("./inftrees"),h=0,f=1,l=2,u=4,c=5,d=6,p=0,_=1,g=2,w=-2,b=-3,v=-4,m=-5,y=8,k=1,E=2,x=3,A=4,B=5,z=6,U=7,I=8,C=9,S=10,T=11,L=12,R=13,D=14,M=15,O=16,P=17,N=18,j=19,Z=20,F=21,H=22,X=23,Y=24,W=25,q=26,G=27,$=28,K=29,V=30,J=31,Q=32,tt=852,et=592,rt=15;function nt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function it(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=k,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(tt),e.distcode=e.distdyn=new n.Buf32(et),e.sane=1,e.back=-1,p):w}function at(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,it(t)):w}function st(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?w:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,at(t))):w}function ot(t,e){var r,i;return t?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},t.state=i,i.window=null,(r=st(t,e))!==p&&(t.state=null),r):w}var ht,ft,lt=!0;function ut(t){if(lt){var e;for(ht=new n.Buf32(512),ft=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(f,t.lens,0,288,ht,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(l,t.lens,0,32,ft,0,t.work,{bits:5}),lt=!1}t.lencode=ht,t.lenbits=9,t.distcode=ft,t.distbits=5}function ct(t,e,r,i){var a,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),i>=s.wsize?(n.arraySet(s.window,e,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((a=s.wsize-s.wnext)>i&&(a=i),n.arraySet(s.window,e,r-i,a,s.wnext),(i-=a)?(n.arraySet(s.window,e,r-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}r.inflateReset=at,r.inflateReset2=st,r.inflateResetKeep=it,r.inflateInit=function(t){return ot(t,rt)},r.inflateInit2=ot,r.inflate=function(t,e){var r,tt,et,rt,it,at,st,ot,ht,ft,lt,dt,pt,_t,gt,wt,bt,vt,mt,yt,kt,Et,xt,At,Bt=0,zt=new n.Buf8(4),Ut=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return w;(r=t.state).mode===L&&(r.mode=R),it=t.next_out,et=t.output,st=t.avail_out,rt=t.next_in,tt=t.input,at=t.avail_in,ot=r.hold,ht=r.bits,ft=at,lt=st,Et=p;t:for(;;)switch(r.mode){case k:if(0===r.wrap){r.mode=R;break}for(;ht<16;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(2&r.wrap&&35615===ot){r.check=0,zt[0]=255&ot,zt[1]=ot>>>8&255,r.check=a(r.check,zt,2,0),ot=0,ht=0,r.mode=E;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&ot)<<8)+(ot>>8))%31){t.msg="incorrect header check",r.mode=V;break}if((15&ot)!==y){t.msg="unknown compression method",r.mode=V;break}if(ht-=4,kt=8+(15&(ot>>>=4)),0===r.wbits)r.wbits=kt;else if(kt>r.wbits){t.msg="invalid window size",r.mode=V;break}r.dmax=1<<kt,t.adler=r.check=1,r.mode=512&ot?S:L,ot=0,ht=0;break;case E:for(;ht<16;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(r.flags=ot,(255&r.flags)!==y){t.msg="unknown compression method",r.mode=V;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=V;break}r.head&&(r.head.text=ot>>8&1),512&r.flags&&(zt[0]=255&ot,zt[1]=ot>>>8&255,r.check=a(r.check,zt,2,0)),ot=0,ht=0,r.mode=x;case x:for(;ht<32;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}r.head&&(r.head.time=ot),512&r.flags&&(zt[0]=255&ot,zt[1]=ot>>>8&255,zt[2]=ot>>>16&255,zt[3]=ot>>>24&255,r.check=a(r.check,zt,4,0)),ot=0,ht=0,r.mode=A;case A:for(;ht<16;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}r.head&&(r.head.xflags=255&ot,r.head.os=ot>>8),512&r.flags&&(zt[0]=255&ot,zt[1]=ot>>>8&255,r.check=a(r.check,zt,2,0)),ot=0,ht=0,r.mode=B;case B:if(1024&r.flags){for(;ht<16;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}r.length=ot,r.head&&(r.head.extra_len=ot),512&r.flags&&(zt[0]=255&ot,zt[1]=ot>>>8&255,r.check=a(r.check,zt,2,0)),ot=0,ht=0}else r.head&&(r.head.extra=null);r.mode=z;case z:if(1024&r.flags&&((dt=r.length)>at&&(dt=at),dt&&(r.head&&(kt=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,tt,rt,dt,kt)),512&r.flags&&(r.check=a(r.check,tt,dt,rt)),at-=dt,rt+=dt,r.length-=dt),r.length))break t;r.length=0,r.mode=U;case U:if(2048&r.flags){if(0===at)break t;dt=0;do{kt=tt[rt+dt++],r.head&&kt&&r.length<65536&&(r.head.name+=String.fromCharCode(kt))}while(kt&&dt<at);if(512&r.flags&&(r.check=a(r.check,tt,dt,rt)),at-=dt,rt+=dt,kt)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=I;case I:if(4096&r.flags){if(0===at)break t;dt=0;do{kt=tt[rt+dt++],r.head&&kt&&r.length<65536&&(r.head.comment+=String.fromCharCode(kt))}while(kt&&dt<at);if(512&r.flags&&(r.check=a(r.check,tt,dt,rt)),at-=dt,rt+=dt,kt)break t}else r.head&&(r.head.comment=null);r.mode=C;case C:if(512&r.flags){for(;ht<16;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(ot!==(65535&r.check)){t.msg="header crc mismatch",r.mode=V;break}ot=0,ht=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=L;break;case S:for(;ht<32;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}t.adler=r.check=nt(ot),ot=0,ht=0,r.mode=T;case T:if(0===r.havedict)return t.next_out=it,t.avail_out=st,t.next_in=rt,t.avail_in=at,r.hold=ot,r.bits=ht,g;t.adler=r.check=1,r.mode=L;case L:if(e===c||e===d)break t;case R:if(r.last){ot>>>=7&ht,ht-=7&ht,r.mode=G;break}for(;ht<3;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}switch(r.last=1&ot,ht-=1,3&(ot>>>=1)){case 0:r.mode=D;break;case 1:if(ut(r),r.mode=Z,e===d){ot>>>=2,ht-=2;break t}break;case 2:r.mode=P;break;case 3:t.msg="invalid block type",r.mode=V}ot>>>=2,ht-=2;break;case D:for(ot>>>=7&ht,ht-=7&ht;ht<32;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if((65535&ot)!=(ot>>>16^65535)){t.msg="invalid stored block lengths",r.mode=V;break}if(r.length=65535&ot,ot=0,ht=0,r.mode=M,e===d)break t;case M:r.mode=O;case O:if(dt=r.length){if(dt>at&&(dt=at),dt>st&&(dt=st),0===dt)break t;n.arraySet(et,tt,rt,dt,it),at-=dt,rt+=dt,st-=dt,it+=dt,r.length-=dt;break}r.mode=L;break;case P:for(;ht<14;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(r.nlen=257+(31&ot),ot>>>=5,ht-=5,r.ndist=1+(31&ot),ot>>>=5,ht-=5,r.ncode=4+(15&ot),ot>>>=4,ht-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=V;break}r.have=0,r.mode=N;case N:for(;r.have<r.ncode;){for(;ht<3;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}r.lens[Ut[r.have++]]=7&ot,ot>>>=3,ht-=3}for(;r.have<19;)r.lens[Ut[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,xt={bits:r.lenbits},Et=o(h,r.lens,0,19,r.lencode,0,r.work,xt),r.lenbits=xt.bits,Et){t.msg="invalid code lengths set",r.mode=V;break}r.have=0,r.mode=j;case j:for(;r.have<r.nlen+r.ndist;){for(;wt=(Bt=r.lencode[ot&(1<<r.lenbits)-1])>>>16&255,bt=65535&Bt,!((gt=Bt>>>24)<=ht);){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(bt<16)ot>>>=gt,ht-=gt,r.lens[r.have++]=bt;else{if(16===bt){for(At=gt+2;ht<At;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(ot>>>=gt,ht-=gt,0===r.have){t.msg="invalid bit length repeat",r.mode=V;break}kt=r.lens[r.have-1],dt=3+(3&ot),ot>>>=2,ht-=2}else if(17===bt){for(At=gt+3;ht<At;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}ht-=gt,kt=0,dt=3+(7&(ot>>>=gt)),ot>>>=3,ht-=3}else{for(At=gt+7;ht<At;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}ht-=gt,kt=0,dt=11+(127&(ot>>>=gt)),ot>>>=7,ht-=7}if(r.have+dt>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=V;break}for(;dt--;)r.lens[r.have++]=kt}}if(r.mode===V)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=V;break}if(r.lenbits=9,xt={bits:r.lenbits},Et=o(f,r.lens,0,r.nlen,r.lencode,0,r.work,xt),r.lenbits=xt.bits,Et){t.msg="invalid literal/lengths set",r.mode=V;break}if(r.distbits=6,r.distcode=r.distdyn,xt={bits:r.distbits},Et=o(l,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,xt),r.distbits=xt.bits,Et){t.msg="invalid distances set",r.mode=V;break}if(r.mode=Z,e===d)break t;case Z:r.mode=F;case F:if(at>=6&&st>=258){t.next_out=it,t.avail_out=st,t.next_in=rt,t.avail_in=at,r.hold=ot,r.bits=ht,s(t,lt),it=t.next_out,et=t.output,st=t.avail_out,rt=t.next_in,tt=t.input,at=t.avail_in,ot=r.hold,ht=r.bits,r.mode===L&&(r.back=-1);break}for(r.back=0;wt=(Bt=r.lencode[ot&(1<<r.lenbits)-1])>>>16&255,bt=65535&Bt,!((gt=Bt>>>24)<=ht);){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(wt&&0==(240&wt)){for(vt=gt,mt=wt,yt=bt;wt=(Bt=r.lencode[yt+((ot&(1<<vt+mt)-1)>>vt)])>>>16&255,bt=65535&Bt,!(vt+(gt=Bt>>>24)<=ht);){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}ot>>>=vt,ht-=vt,r.back+=vt}if(ot>>>=gt,ht-=gt,r.back+=gt,r.length=bt,0===wt){r.mode=q;break}if(32&wt){r.back=-1,r.mode=L;break}if(64&wt){t.msg="invalid literal/length code",r.mode=V;break}r.extra=15&wt,r.mode=H;case H:if(r.extra){for(At=r.extra;ht<At;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}r.length+=ot&(1<<r.extra)-1,ot>>>=r.extra,ht-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=X;case X:for(;wt=(Bt=r.distcode[ot&(1<<r.distbits)-1])>>>16&255,bt=65535&Bt,!((gt=Bt>>>24)<=ht);){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(0==(240&wt)){for(vt=gt,mt=wt,yt=bt;wt=(Bt=r.distcode[yt+((ot&(1<<vt+mt)-1)>>vt)])>>>16&255,bt=65535&Bt,!(vt+(gt=Bt>>>24)<=ht);){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}ot>>>=vt,ht-=vt,r.back+=vt}if(ot>>>=gt,ht-=gt,r.back+=gt,64&wt){t.msg="invalid distance code",r.mode=V;break}r.offset=bt,r.extra=15&wt,r.mode=Y;case Y:if(r.extra){for(At=r.extra;ht<At;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}r.offset+=ot&(1<<r.extra)-1,ot>>>=r.extra,ht-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=V;break}r.mode=W;case W:if(0===st)break t;if(dt=lt-st,r.offset>dt){if((dt=r.offset-dt)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=V;break}dt>r.wnext?(dt-=r.wnext,pt=r.wsize-dt):pt=r.wnext-dt,dt>r.length&&(dt=r.length),_t=r.window}else _t=et,pt=it-r.offset,dt=r.length;dt>st&&(dt=st),st-=dt,r.length-=dt;do{et[it++]=_t[pt++]}while(--dt);0===r.length&&(r.mode=F);break;case q:if(0===st)break t;et[it++]=r.length,st--,r.mode=F;break;case G:if(r.wrap){for(;ht<32;){if(0===at)break t;at--,ot|=tt[rt++]<<ht,ht+=8}if(lt-=st,t.total_out+=lt,r.total+=lt,lt&&(t.adler=r.check=r.flags?a(r.check,et,lt,it-lt):i(r.check,et,lt,it-lt)),lt=st,(r.flags?ot:nt(ot))!==r.check){t.msg="incorrect data check",r.mode=V;break}ot=0,ht=0}r.mode=$;case $:if(r.wrap&&r.flags){for(;ht<32;){if(0===at)break t;at--,ot+=tt[rt++]<<ht,ht+=8}if(ot!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=V;break}ot=0,ht=0}r.mode=K;case K:Et=_;break t;case V:Et=b;break t;case J:return v;case Q:default:return w}return t.next_out=it,t.avail_out=st,t.next_in=rt,t.avail_in=at,r.hold=ot,r.bits=ht,(r.wsize||lt!==t.avail_out&&r.mode<V&&(r.mode<G||e!==u))&&ct(t,t.output,t.next_out,lt-t.avail_out)?(r.mode=J,v):(ft-=t.avail_in,lt-=t.avail_out,t.total_in+=ft,t.total_out+=lt,r.total+=lt,r.wrap&&lt&&(t.adler=r.check=r.flags?a(r.check,et,lt,t.next_out-lt):i(r.check,et,lt,t.next_out-lt)),t.data_type=r.bits+(r.last?64:0)+(r.mode===L?128:0)+(r.mode===Z||r.mode===M?256:0),(0===ft&&0===lt||e===u)&&Et===p&&(Et=m),Et)},r.inflateEnd=function(t){if(!t||!t.state)return w;var e=t.state;return e.window&&(e.window=null),t.state=null,p},r.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?w:(r.head=e,e.done=!1,p):w},r.inflateSetDictionary=function(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&r.mode!==T?w:r.mode===T&&i(1,e,n,0)!==r.check?b:ct(t,e,n,n)?(r.mode=J,v):(r.havedict=1,p):w},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":12,"./adler32":14,"./crc32":16,"./inffast":19,"./inftrees":21}],21:[function(t,e,r){"use strict";var n=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,h,f,l,u,c){var d,p,_,g,w,b,v,m,y,k=c.bits,E=0,x=0,A=0,B=0,z=0,U=0,I=0,C=0,S=0,T=0,L=null,R=0,D=new n.Buf16(16),M=new n.Buf16(16),O=null,P=0;for(E=0;E<=15;E++)D[E]=0;for(x=0;x<h;x++)D[e[r+x]]++;for(z=k,B=15;B>=1&&0===D[B];B--);if(z>B&&(z=B),0===B)return f[l++]=20971520,f[l++]=20971520,c.bits=1,0;for(A=1;A<B&&0===D[A];A++);for(z<A&&(z=A),C=1,E=1;E<=15;E++)if(C<<=1,(C-=D[E])<0)return-1;if(C>0&&(0===t||1!==B))return-1;for(M[1]=0,E=1;E<15;E++)M[E+1]=M[E]+D[E];for(x=0;x<h;x++)0!==e[r+x]&&(u[M[e[r+x]]++]=x);if(0===t?(L=O=u,b=19):1===t?(L=i,R-=257,O=a,P-=257,b=256):(L=s,O=o,b=-1),T=0,x=0,E=A,w=l,U=z,I=0,_=-1,g=(S=1<<z)-1,1===t&&S>852||2===t&&S>592)return 1;for(;;){v=E-I,u[x]<b?(m=0,y=u[x]):u[x]>b?(m=O[P+u[x]],y=L[R+u[x]]):(m=96,y=0),d=1<<E-I,A=p=1<<U;do{f[w+(T>>I)+(p-=d)]=v<<24|m<<16|y|0}while(0!==p);for(d=1<<E-1;T&d;)d>>=1;if(0!==d?(T&=d-1,T+=d):T=0,x++,0==--D[E]){if(E===B)break;E=e[r+u[x]]}if(E>z&&(T&g)!==_){for(0===I&&(I=z),w+=A,C=1<<(U=E-I);U+I<B&&!((C-=D[U+I])<=0);)U++,C<<=1;if(S+=1<<U,1===t&&S>852||2===t&&S>592)return 1;f[_=T&g]=z<<24|U<<16|w-l|0}}return 0!==T&&(f[w+T]=E-I<<24|64<<16|0),c.bits=z,0}},{"../utils/common":12}],22:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],23:[function(t,e,r){"use strict";var n=t("../utils/common"),i=4,a=0,s=1,o=2;function h(t){for(var e=t.length;--e>=0;)t[e]=0}var f=0,l=1,u=2,c=29,d=256,p=d+1+c,_=30,g=19,w=2*p+1,b=15,v=16,m=7,y=256,k=16,E=17,x=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=new Array(2*(p+2));h(I);var C=new Array(2*_);h(C);var S=new Array(512);h(S);var T=new Array(256);h(T);var L=new Array(c);h(L);var R,D,M,O=new Array(_);function P(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function N(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function j(t){return t<256?S[t]:S[256+(t>>>7)]}function Z(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function F(t,e,r){t.bi_valid>v-r?(t.bi_buf|=e<<t.bi_valid&65535,Z(t,t.bi_buf),t.bi_buf=e>>v-t.bi_valid,t.bi_valid+=r-v):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function H(t,e,r){F(t,r[2*e],r[2*e+1])}function X(t,e){var r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1}function Y(t,e,r){var n,i,a=new Array(b+1),s=0;for(n=1;n<=b;n++)a[n]=s=s+r[n-1]<<1;for(i=0;i<=e;i++){var o=t[2*i+1];0!==o&&(t[2*i]=X(a[o]++,o))}}function W(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<_;e++)t.dyn_dtree[2*e]=0;for(e=0;e<g;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*y]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function q(t){t.bi_valid>8?Z(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function G(t,e,r,n){var i=2*e,a=2*r;return t[i]<t[a]||t[i]===t[a]&&n[e]<=n[r]}function $(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&G(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!G(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function K(t,e,r){var n,i,a,s,o=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],i=t.pending_buf[t.l_buf+o],o++,0===n?H(t,i,e):(H(t,(a=T[i])+d+1,e),0!==(s=A[a])&&F(t,i-=L[a],s),H(t,a=j(--n),r),0!==(s=B[a])&&F(t,n-=O[a],s))}while(o<t.last_lit);H(t,y,e)}function V(t,e){var r,n,i,a=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,h=e.stat_desc.elems,f=-1;for(t.heap_len=0,t.heap_max=w,r=0;r<h;r++)0!==a[2*r]?(t.heap[++t.heap_len]=f=r,t.depth[r]=0):a[2*r+1]=0;for(;t.heap_len<2;)a[2*(i=t.heap[++t.heap_len]=f<2?++f:0)]=1,t.depth[i]=0,t.opt_len--,o&&(t.static_len-=s[2*i+1]);for(e.max_code=f,r=t.heap_len>>1;r>=1;r--)$(t,a,r);i=h;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],$(t,a,1),n=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=n,a[2*i]=a[2*r]+a[2*n],t.depth[i]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1,a[2*r+1]=a[2*n+1]=i,t.heap[1]=i++,$(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var r,n,i,a,s,o,h=e.dyn_tree,f=e.max_code,l=e.stat_desc.static_tree,u=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,p=e.stat_desc.max_length,_=0;for(a=0;a<=b;a++)t.bl_count[a]=0;for(h[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<w;r++)(a=h[2*h[2*(n=t.heap[r])+1]+1]+1)>p&&(a=p,_++),h[2*n+1]=a,n>f||(t.bl_count[a]++,s=0,n>=d&&(s=c[n-d]),o=h[2*n],t.opt_len+=o*(a+s),u&&(t.static_len+=o*(l[2*n+1]+s)));if(0!==_){do{for(a=p-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[p]--,_-=2}while(_>0);for(a=p;0!==a;a--)for(n=t.bl_count[a];0!==n;)(i=t.heap[--r])>f||(h[2*i+1]!==a&&(t.opt_len+=(a-h[2*i+1])*h[2*i],h[2*i+1]=a),n--)}}(t,e),Y(a,f,t.bl_count)}function J(t,e,r){var n,i,a=-1,s=e[1],o=0,h=7,f=4;for(0===s&&(h=138,f=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=s,s=e[2*(n+1)+1],++o<h&&i===s||(o<f?t.bl_tree[2*i]+=o:0!==i?(i!==a&&t.bl_tree[2*i]++,t.bl_tree[2*k]++):o<=10?t.bl_tree[2*E]++:t.bl_tree[2*x]++,o=0,a=i,0===s?(h=138,f=3):i===s?(h=6,f=3):(h=7,f=4))}function Q(t,e,r){var n,i,a=-1,s=e[1],o=0,h=7,f=4;for(0===s&&(h=138,f=3),n=0;n<=r;n++)if(i=s,s=e[2*(n+1)+1],!(++o<h&&i===s)){if(o<f)do{H(t,i,t.bl_tree)}while(0!=--o);else 0!==i?(i!==a&&(H(t,i,t.bl_tree),o--),H(t,k,t.bl_tree),F(t,o-3,2)):o<=10?(H(t,E,t.bl_tree),F(t,o-3,3)):(H(t,x,t.bl_tree),F(t,o-11,7));o=0,a=i,0===s?(h=138,f=3):i===s?(h=6,f=3):(h=7,f=4)}}h(O);var tt=!1;function et(t,e,r,i){F(t,(f<<1)+(i?1:0),3),function(t,e,r,i){q(t),i&&(Z(t,r),Z(t,~r)),n.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}(t,e,r,!0)}r._tr_init=function(t){tt||(function(){var t,e,r,n,i,a=new Array(b+1);for(r=0,n=0;n<c-1;n++)for(L[n]=r,t=0;t<1<<A[n];t++)T[r++]=n;for(T[r-1]=n,i=0,n=0;n<16;n++)for(O[n]=i,t=0;t<1<<B[n];t++)S[i++]=n;for(i>>=7;n<_;n++)for(O[n]=i<<7,t=0;t<1<<B[n]-7;t++)S[256+i++]=n;for(e=0;e<=b;e++)a[e]=0;for(t=0;t<=143;)I[2*t+1]=8,t++,a[8]++;for(;t<=255;)I[2*t+1]=9,t++,a[9]++;for(;t<=279;)I[2*t+1]=7,t++,a[7]++;for(;t<=287;)I[2*t+1]=8,t++,a[8]++;for(Y(I,p+1,a),t=0;t<_;t++)C[2*t+1]=5,C[2*t]=X(t,5);R=new P(I,A,d+1,p,b),D=new P(C,B,0,_,b),M=new P(new Array(0),z,0,g,m)}(),tt=!0),t.l_desc=new N(t.dyn_ltree,R),t.d_desc=new N(t.dyn_dtree,D),t.bl_desc=new N(t.bl_tree,M),t.bi_buf=0,t.bi_valid=0,W(t)},r._tr_stored_block=et,r._tr_flush_block=function(t,e,r,n){var h,f,c=0;t.level>0?(t.strm.data_type===o&&(t.strm.data_type=function(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return a;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return s;for(e=32;e<d;e++)if(0!==t.dyn_ltree[2*e])return s;return a}(t)),V(t,t.l_desc),V(t,t.d_desc),c=function(t){var e;for(J(t,t.dyn_ltree,t.l_desc.max_code),J(t,t.dyn_dtree,t.d_desc.max_code),V(t,t.bl_desc),e=g-1;e>=3&&0===t.bl_tree[2*U[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),h=t.opt_len+3+7>>>3,(f=t.static_len+3+7>>>3)<=h&&(h=f)):h=f=r+5,r+4<=h&&-1!==e?et(t,e,r,n):t.strategy===i||f===h?(F(t,(l<<1)+(n?1:0),3),K(t,I,C)):(F(t,(u<<1)+(n?1:0),3),function(t,e,r,n){var i;for(F(t,e-257,5),F(t,r-1,5),F(t,n-4,4),i=0;i<n;i++)F(t,t.bl_tree[2*U[i]+1],3);Q(t,t.dyn_ltree,e-1),Q(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),K(t,t.dyn_ltree,t.dyn_dtree)),W(t),n&&q(t)},r._tr_tally=function(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(T[r]+d+1)]++,t.dyn_dtree[2*j(e)]++),t.last_lit===t.lit_bufsize-1},r._tr_align=function(t){F(t,l<<1,3),H(t,y,I),function(t){16===t.bi_valid?(Z(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":12}],24:[function(t,e,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],25:[function(t,e,r){(function(t){!function(n){var i="object"==typeof r&&r,a="object"==typeof e&&e&&e.exports==i&&e,s="object"==typeof t&&t;s.global!==s&&s.window!==s||(n=s);var o,h,f,l=String.fromCharCode;function u(t){for(var e,r,n=[],i=0,a=t.length;i<a;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<a?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function c(t){if(t>=55296&&t<=57343)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value")}function d(t,e){return l(t>>e&63|128)}function p(t){if(0==(4294967168&t))return l(t);var e="";return 0==(4294965248&t)?e=l(t>>6&31|192):0==(4294901760&t)?(c(t),e=l(t>>12&15|224),e+=d(t,6)):0==(4292870144&t)&&(e=l(t>>18&7|240),e+=d(t,12),e+=d(t,6)),e+=l(63&t|128)}function _(){if(f>=h)throw Error("Invalid byte index");var t=255&o[f];if(f++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function g(){var t,e;if(f>h)throw Error("Invalid byte index");if(f==h)return!1;if(t=255&o[f],f++,0==(128&t))return t;if(192==(224&t)){if((e=(31&t)<<6|_())>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&t)){if((e=(15&t)<<12|_()<<6|_())>=2048)return c(e),e;throw Error("Invalid continuation byte")}if(240==(248&t)&&(e=(7&t)<<18|_()<<12|_()<<6|_())>=65536&&e<=1114111)return e;throw Error("Invalid UTF-8 detected")}var w={version:"2.1.2",encode:function(t){for(var e=u(t),r=e.length,n=-1,i="";++n<r;)i+=p(e[n]);return i},decode:function(t){o=u(t),h=o.length,f=0;for(var e,r=[];!1!==(e=g());)r.push(e);return function(t){for(var e,r=t.length,n=-1,i="";++n<r;)(e=t[n])>65535&&(i+=l((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=l(e);return i}(r)}};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return w});else if(i&&!i.nodeType)if(a)a.exports=w;else{var b={}.hasOwnProperty;for(var v in w)b.call(w,v)&&(i[v]=w[v])}else n.utf8=w}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],26:[function(t,e,r){(function(){var r,n,i;n=t("fast-png"),r=t("jpeg-js"),i=function(t){var e;return e=window.atob(t.slice(t.indexOf(",")+1)),new Uint8Array(new ArrayBuffer(e.length)).map(function(t,r){return e.charCodeAt(r)})},window.synchroDecoder=function(t){var e,a,s;return e=i(t),s=function(){try{try{return n.decode(e)}catch(t){if((a=t).message.includes("wrong PNG signature"))return r.decode(e);throw a}}catch(t){return t,alert("Not a valid PNG or JPEG")}}(),new ImageData(new Uint8ClampedArray(s.data),s.width,s.height)},e.exports=synchroDecoder}).call(this)},{"fast-png":3,"jpeg-js":6}]},{},[26]);</script>
    <script>// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE

// This is CodeMirror (https://codemirror.net), a code editor
// implemented in JavaScript on top of the browser's DOM.
//
// You can find some technical background for some of the code below
// at http://marijnhaverbeke.nl/blog/#cm-internals .

(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global = global || self, global.CodeMirror = factory());
}(this, (function () { 'use strict';

  // Kludges for bugs and behavior differences that can't be feature
  // detected are enabled based on userAgent etc sniffing.
  var userAgent = navigator.userAgent;
  var platform = navigator.platform;

  var gecko = /gecko\/\d/i.test(userAgent);
  var ie_upto10 = /MSIE \d/.test(userAgent);
  var ie_11up = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(userAgent);
  var edge = /Edge\/(\d+)/.exec(userAgent);
  var ie = ie_upto10 || ie_11up || edge;
  var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : +(edge || ie_11up)[1]);
  var webkit = !edge && /WebKit\//.test(userAgent);
  var qtwebkit = webkit && /Qt\/\d+\.\d+/.test(userAgent);
  var chrome = !edge && /Chrome\//.test(userAgent);
  var presto = /Opera\//.test(userAgent);
  var safari = /Apple Computer/.test(navigator.vendor);
  var mac_geMountainLion = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(userAgent);
  var phantom = /PhantomJS/.test(userAgent);

  var ios = safari && (/Mobile\/\w+/.test(userAgent) || navigator.maxTouchPoints > 2);
  var android = /Android/.test(userAgent);
  // This is woefully incomplete. Suggestions for alternative methods welcome.
  var mobile = ios || android || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);
  var mac = ios || /Mac/.test(platform);
  var chromeOS = /\bCrOS\b/.test(userAgent);
  var windows = /win/i.test(platform);

  var presto_version = presto && userAgent.match(/Version\/(\d*\.\d*)/);
  if (presto_version) { presto_version = Number(presto_version[1]); }
  if (presto_version && presto_version >= 15) { presto = false; webkit = true; }
  // Some browsers use the wrong event properties to signal cmd/ctrl on OS X
  var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));
  var captureRightClick = gecko || (ie && ie_version >= 9);

  function classTest(cls) { return new RegExp("(^|\\s)" + cls + "(?:$|\\s)\\s*") }

  var rmClass = function(node, cls) {
    var current = node.className;
    var match = classTest(cls).exec(current);
    if (match) {
      var after = current.slice(match.index + match[0].length);
      node.className = current.slice(0, match.index) + (after ? match[1] + after : "");
    }
  };

  function removeChildren(e) {
    for (var count = e.childNodes.length; count > 0; --count)
      { e.removeChild(e.firstChild); }
    return e
  }

  function removeChildrenAndAdd(parent, e) {
    return removeChildren(parent).appendChild(e)
  }

  function elt(tag, content, className, style) {
    var e = document.createElement(tag);
    if (className) { e.className = className; }
    if (style) { e.style.cssText = style; }
    if (typeof content == "string") { e.appendChild(document.createTextNode(content)); }
    else if (content) { for (var i = 0; i < content.length; ++i) { e.appendChild(content[i]); } }
    return e
  }
  // wrapper for elt, which removes the elt from the accessibility tree
  function eltP(tag, content, className, style) {
    var e = elt(tag, content, className, style);
    e.setAttribute("role", "presentation");
    return e
  }

  var range;
  if (document.createRange) { range = function(node, start, end, endNode) {
    var r = document.createRange();
    r.setEnd(endNode || node, end);
    r.setStart(node, start);
    return r
  }; }
  else { range = function(node, start, end) {
    var r = document.body.createTextRange();
    try { r.moveToElementText(node.parentNode); }
    catch(e) { return r }
    r.collapse(true);
    r.moveEnd("character", end);
    r.moveStart("character", start);
    return r
  }; }

  function contains(parent, child) {
    if (child.nodeType == 3) // Android browser always returns false when child is a textnode
      { child = child.parentNode; }
    if (parent.contains)
      { return parent.contains(child) }
    do {
      if (child.nodeType == 11) { child = child.host; }
      if (child == parent) { return true }
    } while (child = child.parentNode)
  }

  function activeElt() {
    // IE and Edge may throw an "Unspecified Error" when accessing document.activeElement.
    // IE < 10 will throw when accessed while the page is loading or in an iframe.
    // IE > 9 and Edge will throw when accessed in an iframe if document.body is unavailable.
    var activeElement;
    try {
      activeElement = document.activeElement;
    } catch(e) {
      activeElement = document.body || null;
    }
    while (activeElement && activeElement.shadowRoot && activeElement.shadowRoot.activeElement)
      { activeElement = activeElement.shadowRoot.activeElement; }
    return activeElement
  }

  function addClass(node, cls) {
    var current = node.className;
    if (!classTest(cls).test(current)) { node.className += (current ? " " : "") + cls; }
  }
  function joinClasses(a, b) {
    var as = a.split(" ");
    for (var i = 0; i < as.length; i++)
      { if (as[i] && !classTest(as[i]).test(b)) { b += " " + as[i]; } }
    return b
  }

  var selectInput = function(node) { node.select(); };
  if (ios) // Mobile Safari apparently has a bug where select() is broken.
    { selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; }; }
  else if (ie) // Suppress mysterious IE10 errors
    { selectInput = function(node) { try { node.select(); } catch(_e) {} }; }

  function bind(f) {
    var args = Array.prototype.slice.call(arguments, 1);
    return function(){return f.apply(null, args)}
  }

  function copyObj(obj, target, overwrite) {
    if (!target) { target = {}; }
    for (var prop in obj)
      { if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))
        { target[prop] = obj[prop]; } }
    return target
  }

  // Counts the column offset in a string, taking tabs into account.
  // Used mostly to find indentation.
  function countColumn(string, end, tabSize, startIndex, startValue) {
    if (end == null) {
      end = string.search(/[^\s\u00a0]/);
      if (end == -1) { end = string.length; }
    }
    for (var i = startIndex || 0, n = startValue || 0;;) {
      var nextTab = string.indexOf("\t", i);
      if (nextTab < 0 || nextTab >= end)
        { return n + (end - i) }
      n += nextTab - i;
      n += tabSize - (n % tabSize);
      i = nextTab + 1;
    }
  }

  var Delayed = function() {
    this.id = null;
    this.f = null;
    this.time = 0;
    this.handler = bind(this.onTimeout, this);
  };
  Delayed.prototype.onTimeout = function (self) {
    self.id = 0;
    if (self.time <= +new Date) {
      self.f();
    } else {
      setTimeout(self.handler, self.time - +new Date);
    }
  };
  Delayed.prototype.set = function (ms, f) {
    this.f = f;
    var time = +new Date + ms;
    if (!this.id || time < this.time) {
      clearTimeout(this.id);
      this.id = setTimeout(this.handler, ms);
      this.time = time;
    }
  };

  function indexOf(array, elt) {
    for (var i = 0; i < array.length; ++i)
      { if (array[i] == elt) { return i } }
    return -1
  }

  // Number of pixels added to scroller and sizer to hide scrollbar
  var scrollerGap = 50;

  // Returned or thrown by various protocols to signal 'I'm not
  // handling this'.
  var Pass = {toString: function(){return "CodeMirror.Pass"}};

  // Reused option objects for setSelection & friends
  var sel_dontScroll = {scroll: false}, sel_mouse = {origin: "*mouse"}, sel_move = {origin: "+move"};

  // The inverse of countColumn -- find the offset that corresponds to
  // a particular column.
  function findColumn(string, goal, tabSize) {
    for (var pos = 0, col = 0;;) {
      var nextTab = string.indexOf("\t", pos);
      if (nextTab == -1) { nextTab = string.length; }
      var skipped = nextTab - pos;
      if (nextTab == string.length || col + skipped >= goal)
        { return pos + Math.min(skipped, goal - col) }
      col += nextTab - pos;
      col += tabSize - (col % tabSize);
      pos = nextTab + 1;
      if (col >= goal) { return pos }
    }
  }

  var spaceStrs = [""];
  function spaceStr(n) {
    while (spaceStrs.length <= n)
      { spaceStrs.push(lst(spaceStrs) + " "); }
    return spaceStrs[n]
  }

  function lst(arr) { return arr[arr.length-1] }

  function map(array, f) {
    var out = [];
    for (var i = 0; i < array.length; i++) { out[i] = f(array[i], i); }
    return out
  }

  function insertSorted(array, value, score) {
    var pos = 0, priority = score(value);
    while (pos < array.length && score(array[pos]) <= priority) { pos++; }
    array.splice(pos, 0, value);
  }

  function nothing() {}

  function createObj(base, props) {
    var inst;
    if (Object.create) {
      inst = Object.create(base);
    } else {
      nothing.prototype = base;
      inst = new nothing();
    }
    if (props) { copyObj(props, inst); }
    return inst
  }

  var nonASCIISingleCaseWordChar = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
  function isWordCharBasic(ch) {
    return /\w/.test(ch) || ch > "\x80" &&
      (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch))
  }
  function isWordChar(ch, helper) {
    if (!helper) { return isWordCharBasic(ch) }
    if (helper.source.indexOf("\\w") > -1 && isWordCharBasic(ch)) { return true }
    return helper.test(ch)
  }

  function isEmpty(obj) {
    for (var n in obj) { if (obj.hasOwnProperty(n) && obj[n]) { return false } }
    return true
  }

  // Extending unicode characters. A series of a non-extending char +
  // any number of extending chars is treated as a single unit as far
  // as editing and measuring is concerned. This is not fully correct,
  // since some scripts/fonts/browsers also treat other configurations
  // of code points as a group.
  var extendingChars = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
  function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch) }

  // Returns a number from the range [`0`; `str.length`] unless `pos` is outside that range.
  function skipExtendingChars(str, pos, dir) {
    while ((dir < 0 ? pos > 0 : pos < str.length) && isExtendingChar(str.charAt(pos))) { pos += dir; }
    return pos
  }

  // Returns the value from the range [`from`; `to`] that satisfies
  // `pred` and is closest to `from`. Assumes that at least `to`
  // satisfies `pred`. Supports `from` being greater than `to`.
  function findFirst(pred, from, to) {
    // At any point we are certain `to` satisfies `pred`, don't know
    // whether `from` does.
    var dir = from > to ? -1 : 1;
    for (;;) {
      if (from == to) { return from }
      var midF = (from + to) / 2, mid = dir < 0 ? Math.ceil(midF) : Math.floor(midF);
      if (mid == from) { return pred(mid) ? from : to }
      if (pred(mid)) { to = mid; }
      else { from = mid + dir; }
    }
  }

  // BIDI HELPERS

  function iterateBidiSections(order, from, to, f) {
    if (!order) { return f(from, to, "ltr", 0) }
    var found = false;
    for (var i = 0; i < order.length; ++i) {
      var part = order[i];
      if (part.from < to && part.to > from || from == to && part.to == from) {
        f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? "rtl" : "ltr", i);
        found = true;
      }
    }
    if (!found) { f(from, to, "ltr"); }
  }

  var bidiOther = null;
  function getBidiPartAt(order, ch, sticky) {
    var found;
    bidiOther = null;
    for (var i = 0; i < order.length; ++i) {
      var cur = order[i];
      if (cur.from < ch && cur.to > ch) { return i }
      if (cur.to == ch) {
        if (cur.from != cur.to && sticky == "before") { found = i; }
        else { bidiOther = i; }
      }
      if (cur.from == ch) {
        if (cur.from != cur.to && sticky != "before") { found = i; }
        else { bidiOther = i; }
      }
    }
    return found != null ? found : bidiOther
  }

  // Bidirectional ordering algorithm
  // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm
  // that this (partially) implements.

  // One-char codes used for character types:
  // L (L):   Left-to-Right
  // R (R):   Right-to-Left
  // r (AL):  Right-to-Left Arabic
  // 1 (EN):  European Number
  // + (ES):  European Number Separator
  // % (ET):  European Number Terminator
  // n (AN):  Arabic Number
  // , (CS):  Common Number Separator
  // m (NSM): Non-Spacing Mark
  // b (BN):  Boundary Neutral
  // s (B):   Paragraph Separator
  // t (S):   Segment Separator
  // w (WS):  Whitespace
  // N (ON):  Other Neutrals

  // Returns null if characters are ordered as they appear
  // (left-to-right), or an array of sections ({from, to, level}
  // objects) in the order in which they occur visually.
  var bidiOrdering = (function() {
    // Character types for codepoints 0 to 0xff
    var lowTypes = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";
    // Character types for codepoints 0x600 to 0x6f9
    var arabicTypes = "nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";
    function charType(code) {
      if (code <= 0xf7) { return lowTypes.charAt(code) }
      else if (0x590 <= code && code <= 0x5f4) { return "R" }
      else if (0x600 <= code && code <= 0x6f9) { return arabicTypes.charAt(code - 0x600) }
      else if (0x6ee <= code && code <= 0x8ac) { return "r" }
      else if (0x2000 <= code && code <= 0x200b) { return "w" }
      else if (code == 0x200c) { return "b" }
      else { return "L" }
    }

    var bidiRE = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;
    var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;

    function BidiSpan(level, from, to) {
      this.level = level;
      this.from = from; this.to = to;
    }

    return function(str, direction) {
      var outerType = direction == "ltr" ? "L" : "R";

      if (str.length == 0 || direction == "ltr" && !bidiRE.test(str)) { return false }
      var len = str.length, types = [];
      for (var i = 0; i < len; ++i)
        { types.push(charType(str.charCodeAt(i))); }

      // W1. Examine each non-spacing mark (NSM) in the level run, and
      // change the type of the NSM to the type of the previous
      // character. If the NSM is at the start of the level run, it will
      // get the type of sor.
      for (var i$1 = 0, prev = outerType; i$1 < len; ++i$1) {
        var type = types[i$1];
        if (type == "m") { types[i$1] = prev; }
        else { prev = type; }
      }

      // W2. Search backwards from each instance of a European number
      // until the first strong type (R, L, AL, or sor) is found. If an
      // AL is found, change the type of the European number to Arabic
      // number.
      // W3. Change all ALs to R.
      for (var i$2 = 0, cur = outerType; i$2 < len; ++i$2) {
        var type$1 = types[i$2];
        if (type$1 == "1" && cur == "r") { types[i$2] = "n"; }
        else if (isStrong.test(type$1)) { cur = type$1; if (type$1 == "r") { types[i$2] = "R"; } }
      }

      // W4. A single European separator between two European numbers
      // changes to a European number. A single common separator between
      // two numbers of the same type changes to that type.
      for (var i$3 = 1, prev$1 = types[0]; i$3 < len - 1; ++i$3) {
        var type$2 = types[i$3];
        if (type$2 == "+" && prev$1 == "1" && types[i$3+1] == "1") { types[i$3] = "1"; }
        else if (type$2 == "," && prev$1 == types[i$3+1] &&
                 (prev$1 == "1" || prev$1 == "n")) { types[i$3] = prev$1; }
        prev$1 = type$2;
      }

      // W5. A sequence of European terminators adjacent to European
      // numbers changes to all European numbers.
      // W6. Otherwise, separators and terminators change to Other
      // Neutral.
      for (var i$4 = 0; i$4 < len; ++i$4) {
        var type$3 = types[i$4];
        if (type$3 == ",") { types[i$4] = "N"; }
        else if (type$3 == "%") {
          var end = (void 0);
          for (end = i$4 + 1; end < len && types[end] == "%"; ++end) {}
          var replace = (i$4 && types[i$4-1] == "!") || (end < len && types[end] == "1") ? "1" : "N";
          for (var j = i$4; j < end; ++j) { types[j] = replace; }
          i$4 = end - 1;
        }
      }

      // W7. Search backwards from each instance of a European number
      // until the first strong type (R, L, or sor) is found. If an L is
      // found, then change the type of the European number to L.
      for (var i$5 = 0, cur$1 = outerType; i$5 < len; ++i$5) {
        var type$4 = types[i$5];
        if (cur$1 == "L" && type$4 == "1") { types[i$5] = "L"; }
        else if (isStrong.test(type$4)) { cur$1 = type$4; }
      }

      // N1. A sequence of neutrals takes the direction of the
      // surrounding strong text if the text on both sides has the same
      // direction. European and Arabic numbers act as if they were R in
      // terms of their influence on neutrals. Start-of-level-run (sor)
      // and end-of-level-run (eor) are used at level run boundaries.
      // N2. Any remaining neutrals take the embedding direction.
      for (var i$6 = 0; i$6 < len; ++i$6) {
        if (isNeutral.test(types[i$6])) {
          var end$1 = (void 0);
          for (end$1 = i$6 + 1; end$1 < len && isNeutral.test(types[end$1]); ++end$1) {}
          var before = (i$6 ? types[i$6-1] : outerType) == "L";
          var after = (end$1 < len ? types[end$1] : outerType) == "L";
          var replace$1 = before == after ? (before ? "L" : "R") : outerType;
          for (var j$1 = i$6; j$1 < end$1; ++j$1) { types[j$1] = replace$1; }
          i$6 = end$1 - 1;
        }
      }

      // Here we depart from the documented algorithm, in order to avoid
      // building up an actual levels array. Since there are only three
      // levels (0, 1, 2) in an implementation that doesn't take
      // explicit embedding into account, we can build up the order on
      // the fly, without following the level-based algorithm.
      var order = [], m;
      for (var i$7 = 0; i$7 < len;) {
        if (countsAsLeft.test(types[i$7])) {
          var start = i$7;
          for (++i$7; i$7 < len && countsAsLeft.test(types[i$7]); ++i$7) {}
          order.push(new BidiSpan(0, start, i$7));
        } else {
          var pos = i$7, at = order.length, isRTL = direction == "rtl" ? 1 : 0;
          for (++i$7; i$7 < len && types[i$7] != "L"; ++i$7) {}
          for (var j$2 = pos; j$2 < i$7;) {
            if (countsAsNum.test(types[j$2])) {
              if (pos < j$2) { order.splice(at, 0, new BidiSpan(1, pos, j$2)); at += isRTL; }
              var nstart = j$2;
              for (++j$2; j$2 < i$7 && countsAsNum.test(types[j$2]); ++j$2) {}
              order.splice(at, 0, new BidiSpan(2, nstart, j$2));
              at += isRTL;
              pos = j$2;
            } else { ++j$2; }
          }
          if (pos < i$7) { order.splice(at, 0, new BidiSpan(1, pos, i$7)); }
        }
      }
      if (direction == "ltr") {
        if (order[0].level == 1 && (m = str.match(/^\s+/))) {
          order[0].from = m[0].length;
          order.unshift(new BidiSpan(0, 0, m[0].length));
        }
        if (lst(order).level == 1 && (m = str.match(/\s+$/))) {
          lst(order).to -= m[0].length;
          order.push(new BidiSpan(0, len - m[0].length, len));
        }
      }

      return direction == "rtl" ? order.reverse() : order
    }
  })();

  // Get the bidi ordering for the given line (and cache it). Returns
  // false for lines that are fully left-to-right, and an array of
  // BidiSpan objects otherwise.
  function getOrder(line, direction) {
    var order = line.order;
    if (order == null) { order = line.order = bidiOrdering(line.text, direction); }
    return order
  }

  // EVENT HANDLING

  // Lightweight event framework. on/off also work on DOM nodes,
  // registering native DOM handlers.

  var noHandlers = [];

  var on = function(emitter, type, f) {
    if (emitter.addEventListener) {
      emitter.addEventListener(type, f, false);
    } else if (emitter.attachEvent) {
      emitter.attachEvent("on" + type, f);
    } else {
      var map = emitter._handlers || (emitter._handlers = {});
      map[type] = (map[type] || noHandlers).concat(f);
    }
  };

  function getHandlers(emitter, type) {
    return emitter._handlers && emitter._handlers[type] || noHandlers
  }

  function off(emitter, type, f) {
    if (emitter.removeEventListener) {
      emitter.removeEventListener(type, f, false);
    } else if (emitter.detachEvent) {
      emitter.detachEvent("on" + type, f);
    } else {
      var map = emitter._handlers, arr = map && map[type];
      if (arr) {
        var index = indexOf(arr, f);
        if (index > -1)
          { map[type] = arr.slice(0, index).concat(arr.slice(index + 1)); }
      }
    }
  }

  function signal(emitter, type /*, values...*/) {
    var handlers = getHandlers(emitter, type);
    if (!handlers.length) { return }
    var args = Array.prototype.slice.call(arguments, 2);
    for (var i = 0; i < handlers.length; ++i) { handlers[i].apply(null, args); }
  }

  // The DOM events that CodeMirror handles can be overridden by
  // registering a (non-DOM) handler on the editor for the event name,
  // and preventDefault-ing the event in that handler.
  function signalDOMEvent(cm, e, override) {
    if (typeof e == "string")
      { e = {type: e, preventDefault: function() { this.defaultPrevented = true; }}; }
    signal(cm, override || e.type, cm, e);
    return e_defaultPrevented(e) || e.codemirrorIgnore
  }

  function signalCursorActivity(cm) {
    var arr = cm._handlers && cm._handlers.cursorActivity;
    if (!arr) { return }
    var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);
    for (var i = 0; i < arr.length; ++i) { if (indexOf(set, arr[i]) == -1)
      { set.push(arr[i]); } }
  }

  function hasHandler(emitter, type) {
    return getHandlers(emitter, type).length > 0
  }

  // Add on and off methods to a constructor's prototype, to make
  // registering events on such objects more convenient.
  function eventMixin(ctor) {
    ctor.prototype.on = function(type, f) {on(this, type, f);};
    ctor.prototype.off = function(type, f) {off(this, type, f);};
  }

  // Due to the fact that we still support jurassic IE versions, some
  // compatibility wrappers are needed.

  function e_preventDefault(e) {
    if (e.preventDefault) { e.preventDefault(); }
    else { e.returnValue = false; }
  }
  function e_stopPropagation(e) {
    if (e.stopPropagation) { e.stopPropagation(); }
    else { e.cancelBubble = true; }
  }
  function e_defaultPrevented(e) {
    return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false
  }
  function e_stop(e) {e_preventDefault(e); e_stopPropagation(e);}

  function e_target(e) {return e.target || e.srcElement}
  function e_button(e) {
    var b = e.which;
    if (b == null) {
      if (e.button & 1) { b = 1; }
      else if (e.button & 2) { b = 3; }
      else if (e.button & 4) { b = 2; }
    }
    if (mac && e.ctrlKey && b == 1) { b = 3; }
    return b
  }

  // Detect drag-and-drop
  var dragAndDrop = function() {
    // There is *some* kind of drag-and-drop support in IE6-8, but I
    // couldn't get it to work yet.
    if (ie && ie_version < 9) { return false }
    var div = elt('div');
    return "draggable" in div || "dragDrop" in div
  }();

  var zwspSupported;
  function zeroWidthElement(measure) {
    if (zwspSupported == null) {
      var test = elt("span", "\u200b");
      removeChildrenAndAdd(measure, elt("span", [test, document.createTextNode("x")]));
      if (measure.firstChild.offsetHeight != 0)
        { zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8); }
    }
    var node = zwspSupported ? elt("span", "\u200b") :
      elt("span", "\u00a0", null, "display: inline-block; width: 1px; margin-right: -1px");
    node.setAttribute("cm-text", "");
    return node
  }

  // Feature-detect IE's crummy client rect reporting for bidi text
  var badBidiRects;
  function hasBadBidiRects(measure) {
    if (badBidiRects != null) { return badBidiRects }
    var txt = removeChildrenAndAdd(measure, document.createTextNode("A\u062eA"));
    var r0 = range(txt, 0, 1).getBoundingClientRect();
    var r1 = range(txt, 1, 2).getBoundingClientRect();
    removeChildren(measure);
    if (!r0 || r0.left == r0.right) { return false } // Safari returns null in some cases (#2780)
    return badBidiRects = (r1.right - r0.right < 3)
  }

  // See if "".split is the broken IE version, if so, provide an
  // alternative way to split lines.
  var splitLinesAuto = "\n\nb".split(/\n/).length != 3 ? function (string) {
    var pos = 0, result = [], l = string.length;
    while (pos <= l) {
      var nl = string.indexOf("\n", pos);
      if (nl == -1) { nl = string.length; }
      var line = string.slice(pos, string.charAt(nl - 1) == "\r" ? nl - 1 : nl);
      var rt = line.indexOf("\r");
      if (rt != -1) {
        result.push(line.slice(0, rt));
        pos += rt + 1;
      } else {
        result.push(line);
        pos = nl + 1;
      }
    }
    return result
  } : function (string) { return string.split(/\r\n?|\n/); };

  var hasSelection = window.getSelection ? function (te) {
    try { return te.selectionStart != te.selectionEnd }
    catch(e) { return false }
  } : function (te) {
    var range;
    try {range = te.ownerDocument.selection.createRange();}
    catch(e) {}
    if (!range || range.parentElement() != te) { return false }
    return range.compareEndPoints("StartToEnd", range) != 0
  };

  var hasCopyEvent = (function () {
    var e = elt("div");
    if ("oncopy" in e) { return true }
    e.setAttribute("oncopy", "return;");
    return typeof e.oncopy == "function"
  })();

  var badZoomedRects = null;
  function hasBadZoomedRects(measure) {
    if (badZoomedRects != null) { return badZoomedRects }
    var node = removeChildrenAndAdd(measure, elt("span", "x"));
    var normal = node.getBoundingClientRect();
    var fromRange = range(node, 0, 1).getBoundingClientRect();
    return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1
  }

  // Known modes, by name and by MIME
  var modes = {}, mimeModes = {};

  // Extra arguments are stored as the mode's dependencies, which is
  // used by (legacy) mechanisms like loadmode.js to automatically
  // load a mode. (Preferred mechanism is the require/define calls.)
  function defineMode(name, mode) {
    if (arguments.length > 2)
      { mode.dependencies = Array.prototype.slice.call(arguments, 2); }
    modes[name] = mode;
  }

  function defineMIME(mime, spec) {
    mimeModes[mime] = spec;
  }

  // Given a MIME type, a {name, ...options} config object, or a name
  // string, return a mode config object.
  function resolveMode(spec) {
    if (typeof spec == "string" && mimeModes.hasOwnProperty(spec)) {
      spec = mimeModes[spec];
    } else if (spec && typeof spec.name == "string" && mimeModes.hasOwnProperty(spec.name)) {
      var found = mimeModes[spec.name];
      if (typeof found == "string") { found = {name: found}; }
      spec = createObj(found, spec);
      spec.name = found.name;
    } else if (typeof spec == "string" && /^[\w\-]+\/[\w\-]+\+xml$/.test(spec)) {
      return resolveMode("application/xml")
    } else if (typeof spec == "string" && /^[\w\-]+\/[\w\-]+\+json$/.test(spec)) {
      return resolveMode("application/json")
    }
    if (typeof spec == "string") { return {name: spec} }
    else { return spec || {name: "null"} }
  }

  // Given a mode spec (anything that resolveMode accepts), find and
  // initialize an actual mode object.
  function getMode(options, spec) {
    spec = resolveMode(spec);
    var mfactory = modes[spec.name];
    if (!mfactory) { return getMode(options, "text/plain") }
    var modeObj = mfactory(options, spec);
    if (modeExtensions.hasOwnProperty(spec.name)) {
      var exts = modeExtensions[spec.name];
      for (var prop in exts) {
        if (!exts.hasOwnProperty(prop)) { continue }
        if (modeObj.hasOwnProperty(prop)) { modeObj["_" + prop] = modeObj[prop]; }
        modeObj[prop] = exts[prop];
      }
    }
    modeObj.name = spec.name;
    if (spec.helperType) { modeObj.helperType = spec.helperType; }
    if (spec.modeProps) { for (var prop$1 in spec.modeProps)
      { modeObj[prop$1] = spec.modeProps[prop$1]; } }

    return modeObj
  }

  // This can be used to attach properties to mode objects from
  // outside the actual mode definition.
  var modeExtensions = {};
  function extendMode(mode, properties) {
    var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});
    copyObj(properties, exts);
  }

  function copyState(mode, state) {
    if (state === true) { return state }
    if (mode.copyState) { return mode.copyState(state) }
    var nstate = {};
    for (var n in state) {
      var val = state[n];
      if (val instanceof Array) { val = val.concat([]); }
      nstate[n] = val;
    }
    return nstate
  }

  // Given a mode and a state (for that mode), find the inner mode and
  // state at the position that the state refers to.
  function innerMode(mode, state) {
    var info;
    while (mode.innerMode) {
      info = mode.innerMode(state);
      if (!info || info.mode == mode) { break }
      state = info.state;
      mode = info.mode;
    }
    return info || {mode: mode, state: state}
  }

  function startState(mode, a1, a2) {
    return mode.startState ? mode.startState(a1, a2) : true
  }

  // STRING STREAM

  // Fed to the mode parsers, provides helper functions to make
  // parsers more succinct.

  var StringStream = function(string, tabSize, lineOracle) {
    this.pos = this.start = 0;
    this.string = string;
    this.tabSize = tabSize || 8;
    this.lastColumnPos = this.lastColumnValue = 0;
    this.lineStart = 0;
    this.lineOracle = lineOracle;
  };

  StringStream.prototype.eol = function () {return this.pos >= this.string.length};
  StringStream.prototype.sol = function () {return this.pos == this.lineStart};
  StringStream.prototype.peek = function () {return this.string.charAt(this.pos) || undefined};
  StringStream.prototype.next = function () {
    if (this.pos < this.string.length)
      { return this.string.charAt(this.pos++) }
  };
  StringStream.prototype.eat = function (match) {
    var ch = this.string.charAt(this.pos);
    var ok;
    if (typeof match == "string") { ok = ch == match; }
    else { ok = ch && (match.test ? match.test(ch) : match(ch)); }
    if (ok) {++this.pos; return ch}
  };
  StringStream.prototype.eatWhile = function (match) {
    var start = this.pos;
    while (this.eat(match)){}
    return this.pos > start
  };
  StringStream.prototype.eatSpace = function () {
    var start = this.pos;
    while (/[\s\u00a0]/.test(this.string.charAt(this.pos))) { ++this.pos; }
    return this.pos > start
  };
  StringStream.prototype.skipToEnd = function () {this.pos = this.string.length;};
  StringStream.prototype.skipTo = function (ch) {
    var found = this.string.indexOf(ch, this.pos);
    if (found > -1) {this.pos = found; return true}
  };
  StringStream.prototype.backUp = function (n) {this.pos -= n;};
  StringStream.prototype.column = function () {
    if (this.lastColumnPos < this.start) {
      this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);
      this.lastColumnPos = this.start;
    }
    return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)
  };
  StringStream.prototype.indentation = function () {
    return countColumn(this.string, null, this.tabSize) -
      (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)
  };
  StringStream.prototype.match = function (pattern, consume, caseInsensitive) {
    if (typeof pattern == "string") {
      var cased = function (str) { return caseInsensitive ? str.toLowerCase() : str; };
      var substr = this.string.substr(this.pos, pattern.length);
      if (cased(substr) == cased(pattern)) {
        if (consume !== false) { this.pos += pattern.length; }
        return true
      }
    } else {
      var match = this.string.slice(this.pos).match(pattern);
      if (match && match.index > 0) { return null }
      if (match && consume !== false) { this.pos += match[0].length; }
      return match
    }
  };
  StringStream.prototype.current = function (){return this.string.slice(this.start, this.pos)};
  StringStream.prototype.hideFirstChars = function (n, inner) {
    this.lineStart += n;
    try { return inner() }
    finally { this.lineStart -= n; }
  };
  StringStream.prototype.lookAhead = function (n) {
    var oracle = this.lineOracle;
    return oracle && oracle.lookAhead(n)
  };
  StringStream.prototype.baseToken = function () {
    var oracle = this.lineOracle;
    return oracle && oracle.baseToken(this.pos)
  };

  // Find the line object corresponding to the given line number.
  function getLine(doc, n) {
    n -= doc.first;
    if (n < 0 || n >= doc.size) { throw new Error("There is no line " + (n + doc.first) + " in the document.") }
    var chunk = doc;
    while (!chunk.lines) {
      for (var i = 0;; ++i) {
        var child = chunk.children[i], sz = child.chunkSize();
        if (n < sz) { chunk = child; break }
        n -= sz;
      }
    }
    return chunk.lines[n]
  }

  // Get the part of a document between two positions, as an array of
  // strings.
  function getBetween(doc, start, end) {
    var out = [], n = start.line;
    doc.iter(start.line, end.line + 1, function (line) {
      var text = line.text;
      if (n == end.line) { text = text.slice(0, end.ch); }
      if (n == start.line) { text = text.slice(start.ch); }
      out.push(text);
      ++n;
    });
    return out
  }
  // Get the lines between from and to, as array of strings.
  function getLines(doc, from, to) {
    var out = [];
    doc.iter(from, to, function (line) { out.push(line.text); }); // iter aborts when callback returns truthy value
    return out
  }

  // Update the height of a line, propagating the height change
  // upwards to parent nodes.
  function updateLineHeight(line, height) {
    var diff = height - line.height;
    if (diff) { for (var n = line; n; n = n.parent) { n.height += diff; } }
  }

  // Given a line object, find its line number by walking up through
  // its parent links.
  function lineNo(line) {
    if (line.parent == null) { return null }
    var cur = line.parent, no = indexOf(cur.lines, line);
    for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {
      for (var i = 0;; ++i) {
        if (chunk.children[i] == cur) { break }
        no += chunk.children[i].chunkSize();
      }
    }
    return no + cur.first
  }

  // Find the line at the given vertical position, using the height
  // information in the document tree.
  function lineAtHeight(chunk, h) {
    var n = chunk.first;
    outer: do {
      for (var i$1 = 0; i$1 < chunk.children.length; ++i$1) {
        var child = chunk.children[i$1], ch = child.height;
        if (h < ch) { chunk = child; continue outer }
        h -= ch;
        n += child.chunkSize();
      }
      return n
    } while (!chunk.lines)
    var i = 0;
    for (; i < chunk.lines.length; ++i) {
      var line = chunk.lines[i], lh = line.height;
      if (h < lh) { break }
      h -= lh;
    }
    return n + i
  }

  function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size}

  function lineNumberFor(options, i) {
    return String(options.lineNumberFormatter(i + options.firstLineNumber))
  }

  // A Pos instance represents a position within the text.
  function Pos(line, ch, sticky) {
    if ( sticky === void 0 ) sticky = null;

    if (!(this instanceof Pos)) { return new Pos(line, ch, sticky) }
    this.line = line;
    this.ch = ch;
    this.sticky = sticky;
  }

  // Compare two positions, return 0 if they are the same, a negative
  // number when a is less, and a positive number otherwise.
  function cmp(a, b) { return a.line - b.line || a.ch - b.ch }

  function equalCursorPos(a, b) { return a.sticky == b.sticky && cmp(a, b) == 0 }

  function copyPos(x) {return Pos(x.line, x.ch)}
  function maxPos(a, b) { return cmp(a, b) < 0 ? b : a }
  function minPos(a, b) { return cmp(a, b) < 0 ? a : b }

  // Most of the external API clips given positions to make sure they
  // actually exist within the document.
  function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1))}
  function clipPos(doc, pos) {
    if (pos.line < doc.first) { return Pos(doc.first, 0) }
    var last = doc.first + doc.size - 1;
    if (pos.line > last) { return Pos(last, getLine(doc, last).text.length) }
    return clipToLen(pos, getLine(doc, pos.line).text.length)
  }
  function clipToLen(pos, linelen) {
    var ch = pos.ch;
    if (ch == null || ch > linelen) { return Pos(pos.line, linelen) }
    else if (ch < 0) { return Pos(pos.line, 0) }
    else { return pos }
  }
  function clipPosArray(doc, array) {
    var out = [];
    for (var i = 0; i < array.length; i++) { out[i] = clipPos(doc, array[i]); }
    return out
  }

  var SavedContext = function(state, lookAhead) {
    this.state = state;
    this.lookAhead = lookAhead;
  };

  var Context = function(doc, state, line, lookAhead) {
    this.state = state;
    this.doc = doc;
    this.line = line;
    this.maxLookAhead = lookAhead || 0;
    this.baseTokens = null;
    this.baseTokenPos = 1;
  };

  Context.prototype.lookAhead = function (n) {
    var line = this.doc.getLine(this.line + n);
    if (line != null && n > this.maxLookAhead) { this.maxLookAhead = n; }
    return line
  };

  Context.prototype.baseToken = function (n) {
    if (!this.baseTokens) { return null }
    while (this.baseTokens[this.baseTokenPos] <= n)
      { this.baseTokenPos += 2; }
    var type = this.baseTokens[this.baseTokenPos + 1];
    return {type: type && type.replace(/( |^)overlay .*/, ""),
            size: this.baseTokens[this.baseTokenPos] - n}
  };

  Context.prototype.nextLine = function () {
    this.line++;
    if (this.maxLookAhead > 0) { this.maxLookAhead--; }
  };

  Context.fromSaved = function (doc, saved, line) {
    if (saved instanceof SavedContext)
      { return new Context(doc, copyState(doc.mode, saved.state), line, saved.lookAhead) }
    else
      { return new Context(doc, copyState(doc.mode, saved), line) }
  };

  Context.prototype.save = function (copy) {
    var state = copy !== false ? copyState(this.doc.mode, this.state) : this.state;
    return this.maxLookAhead > 0 ? new SavedContext(state, this.maxLookAhead) : state
  };


  // Compute a style array (an array starting with a mode generation
  // -- for invalidation -- followed by pairs of end positions and
  // style strings), which is used to highlight the tokens on the
  // line.
  function highlightLine(cm, line, context, forceToEnd) {
    // A styles array always starts with a number identifying the
    // mode/overlays that it is based on (for easy invalidation).
    var st = [cm.state.modeGen], lineClasses = {};
    // Compute the base array of styles
    runMode(cm, line.text, cm.doc.mode, context, function (end, style) { return st.push(end, style); },
            lineClasses, forceToEnd);
    var state = context.state;

    // Run overlays, adjust style array.
    var loop = function ( o ) {
      context.baseTokens = st;
      var overlay = cm.state.overlays[o], i = 1, at = 0;
      context.state = true;
      runMode(cm, line.text, overlay.mode, context, function (end, style) {
        var start = i;
        // Ensure there's a token end at the current position, and that i points at it
        while (at < end) {
          var i_end = st[i];
          if (i_end > end)
            { st.splice(i, 1, end, st[i+1], i_end); }
          i += 2;
          at = Math.min(end, i_end);
        }
        if (!style) { return }
        if (overlay.opaque) {
          st.splice(start, i - start, end, "overlay " + style);
          i = start + 2;
        } else {
          for (; start < i; start += 2) {
            var cur = st[start+1];
            st[start+1] = (cur ? cur + " " : "") + "overlay " + style;
          }
        }
      }, lineClasses);
      context.state = state;
      context.baseTokens = null;
      context.baseTokenPos = 1;
    };

    for (var o = 0; o < cm.state.overlays.length; ++o) loop( o );

    return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null}
  }

  function getLineStyles(cm, line, updateFrontier) {
    if (!line.styles || line.styles[0] != cm.state.modeGen) {
      var context = getContextBefore(cm, lineNo(line));
      var resetState = line.text.length > cm.options.maxHighlightLength && copyState(cm.doc.mode, context.state);
      var result = highlightLine(cm, line, context);
      if (resetState) { context.state = resetState; }
      line.stateAfter = context.save(!resetState);
      line.styles = result.styles;
      if (result.classes) { line.styleClasses = result.classes; }
      else if (line.styleClasses) { line.styleClasses = null; }
      if (updateFrontier === cm.doc.highlightFrontier)
        { cm.doc.modeFrontier = Math.max(cm.doc.modeFrontier, ++cm.doc.highlightFrontier); }
    }
    return line.styles
  }

  function getContextBefore(cm, n, precise) {
    var doc = cm.doc, display = cm.display;
    if (!doc.mode.startState) { return new Context(doc, true, n) }
    var start = findStartLine(cm, n, precise);
    var saved = start > doc.first && getLine(doc, start - 1).stateAfter;
    var context = saved ? Context.fromSaved(doc, saved, start) : new Context(doc, startState(doc.mode), start);

    doc.iter(start, n, function (line) {
      processLine(cm, line.text, context);
      var pos = context.line;
      line.stateAfter = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo ? context.save() : null;
      context.nextLine();
    });
    if (precise) { doc.modeFrontier = context.line; }
    return context
  }

  // Lightweight form of highlight -- proceed over this line and
  // update state, but don't save a style array. Used for lines that
  // aren't currently visible.
  function processLine(cm, text, context, startAt) {
    var mode = cm.doc.mode;
    var stream = new StringStream(text, cm.options.tabSize, context);
    stream.start = stream.pos = startAt || 0;
    if (text == "") { callBlankLine(mode, context.state); }
    while (!stream.eol()) {
      readToken(mode, stream, context.state);
      stream.start = stream.pos;
    }
  }

  function callBlankLine(mode, state) {
    if (mode.blankLine) { return mode.blankLine(state) }
    if (!mode.innerMode) { return }
    var inner = innerMode(mode, state);
    if (inner.mode.blankLine) { return inner.mode.blankLine(inner.state) }
  }

  function readToken(mode, stream, state, inner) {
    for (var i = 0; i < 10; i++) {
      if (inner) { inner[0] = innerMode(mode, state).mode; }
      var style = mode.token(stream, state);
      if (stream.pos > stream.start) { return style }
    }
    throw new Error("Mode " + mode.name + " failed to advance stream.")
  }

  var Token = function(stream, type, state) {
    this.start = stream.start; this.end = stream.pos;
    this.string = stream.current();
    this.type = type || null;
    this.state = state;
  };

  // Utility for getTokenAt and getLineTokens
  function takeToken(cm, pos, precise, asArray) {
    var doc = cm.doc, mode = doc.mode, style;
    pos = clipPos(doc, pos);
    var line = getLine(doc, pos.line), context = getContextBefore(cm, pos.line, precise);
    var stream = new StringStream(line.text, cm.options.tabSize, context), tokens;
    if (asArray) { tokens = []; }
    while ((asArray || stream.pos < pos.ch) && !stream.eol()) {
      stream.start = stream.pos;
      style = readToken(mode, stream, context.state);
      if (asArray) { tokens.push(new Token(stream, style, copyState(doc.mode, context.state))); }
    }
    return asArray ? tokens : new Token(stream, style, context.state)
  }

  function extractLineClasses(type, output) {
    if (type) { for (;;) {
      var lineClass = type.match(/(?:^|\s+)line-(background-)?(\S+)/);
      if (!lineClass) { break }
      type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);
      var prop = lineClass[1] ? "bgClass" : "textClass";
      if (output[prop] == null)
        { output[prop] = lineClass[2]; }
      else if (!(new RegExp("(?:^|\\s)" + lineClass[2] + "(?:$|\\s)")).test(output[prop]))
        { output[prop] += " " + lineClass[2]; }
    } }
    return type
  }

  // Run the given mode's parser over a line, calling f for each token.
  function runMode(cm, text, mode, context, f, lineClasses, forceToEnd) {
    var flattenSpans = mode.flattenSpans;
    if (flattenSpans == null) { flattenSpans = cm.options.flattenSpans; }
    var curStart = 0, curStyle = null;
    var stream = new StringStream(text, cm.options.tabSize, context), style;
    var inner = cm.options.addModeClass && [null];
    if (text == "") { extractLineClasses(callBlankLine(mode, context.state), lineClasses); }
    while (!stream.eol()) {
      if (stream.pos > cm.options.maxHighlightLength) {
        flattenSpans = false;
        if (forceToEnd) { processLine(cm, text, context, stream.pos); }
        stream.pos = text.length;
        style = null;
      } else {
        style = extractLineClasses(readToken(mode, stream, context.state, inner), lineClasses);
      }
      if (inner) {
        var mName = inner[0].name;
        if (mName) { style = "m-" + (style ? mName + " " + style : mName); }
      }
      if (!flattenSpans || curStyle != style) {
        while (curStart < stream.start) {
          curStart = Math.min(stream.start, curStart + 5000);
          f(curStart, curStyle);
        }
        curStyle = style;
      }
      stream.start = stream.pos;
    }
    while (curStart < stream.pos) {
      // Webkit seems to refuse to render text nodes longer than 57444
      // characters, and returns inaccurate measurements in nodes
      // starting around 5000 chars.
      var pos = Math.min(stream.pos, curStart + 5000);
      f(pos, curStyle);
      curStart = pos;
    }
  }

  // Finds the line to start with when starting a parse. Tries to
  // find a line with a stateAfter, so that it can start with a
  // valid state. If that fails, it returns the line with the
  // smallest indentation, which tends to need the least context to
  // parse correctly.
  function findStartLine(cm, n, precise) {
    var minindent, minline, doc = cm.doc;
    var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);
    for (var search = n; search > lim; --search) {
      if (search <= doc.first) { return doc.first }
      var line = getLine(doc, search - 1), after = line.stateAfter;
      if (after && (!precise || search + (after instanceof SavedContext ? after.lookAhead : 0) <= doc.modeFrontier))
        { return search }
      var indented = countColumn(line.text, null, cm.options.tabSize);
      if (minline == null || minindent > indented) {
        minline = search - 1;
        minindent = indented;
      }
    }
    return minline
  }

  function retreatFrontier(doc, n) {
    doc.modeFrontier = Math.min(doc.modeFrontier, n);
    if (doc.highlightFrontier < n - 10) { return }
    var start = doc.first;
    for (var line = n - 1; line > start; line--) {
      var saved = getLine(doc, line).stateAfter;
      // change is on 3
      // state on line 1 looked ahead 2 -- so saw 3
      // test 1 + 2 < 3 should cover this
      if (saved && (!(saved instanceof SavedContext) || line + saved.lookAhead < n)) {
        start = line + 1;
        break
      }
    }
    doc.highlightFrontier = Math.min(doc.highlightFrontier, start);
  }

  // Optimize some code when these features are not used.
  var sawReadOnlySpans = false, sawCollapsedSpans = false;

  function seeReadOnlySpans() {
    sawReadOnlySpans = true;
  }

  function seeCollapsedSpans() {
    sawCollapsedSpans = true;
  }

  // TEXTMARKER SPANS

  function MarkedSpan(marker, from, to) {
    this.marker = marker;
    this.from = from; this.to = to;
  }

  // Search an array of spans for a span matching the given marker.
  function getMarkedSpanFor(spans, marker) {
    if (spans) { for (var i = 0; i < spans.length; ++i) {
      var span = spans[i];
      if (span.marker == marker) { return span }
    } }
  }

  // Remove a span from an array, returning undefined if no spans are
  // left (we don't store arrays for lines without spans).
  function removeMarkedSpan(spans, span) {
    var r;
    for (var i = 0; i < spans.length; ++i)
      { if (spans[i] != span) { (r || (r = [])).push(spans[i]); } }
    return r
  }

  // Add a span to a line.
  function addMarkedSpan(line, span, op) {
    var inThisOp = op && window.WeakSet && (op.markedSpans || (op.markedSpans = new WeakSet));
    if (inThisOp && inThisOp.has(line.markedSpans)) {
      line.markedSpans.push(span);
    } else {
      line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];
      if (inThisOp) { inThisOp.add(line.markedSpans); }
    }
    span.marker.attachLine(line);
  }

  // Used for the algorithm that adjusts markers for a change in the
  // document. These functions cut an array of spans at a given
  // character position, returning an array of remaining chunks (or
  // undefined if nothing remains).
  function markedSpansBefore(old, startCh, isInsert) {
    var nw;
    if (old) { for (var i = 0; i < old.length; ++i) {
      var span = old[i], marker = span.marker;
      var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);
      if (startsBefore || span.from == startCh && marker.type == "bookmark" && (!isInsert || !span.marker.insertLeft)) {
        var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh)
        ;(nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));
      }
    } }
    return nw
  }
  function markedSpansAfter(old, endCh, isInsert) {
    var nw;
    if (old) { for (var i = 0; i < old.length; ++i) {
      var span = old[i], marker = span.marker;
      var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);
      if (endsAfter || span.from == endCh && marker.type == "bookmark" && (!isInsert || span.marker.insertLeft)) {
        var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh)
        ;(nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,
                                              span.to == null ? null : span.to - endCh));
      }
    } }
    return nw
  }

  // Given a change object, compute the new set of marker spans that
  // cover the line in which the change took place. Removes spans
  // entirely within the change, reconnects spans belonging to the
  // same marker that appear on both sides of the change, and cuts off
  // spans partially within the change. Returns an array of span
  // arrays with one element for each line in (after) the change.
  function stretchSpansOverChange(doc, change) {
    if (change.full) { return null }
    var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;
    var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;
    if (!oldFirst && !oldLast) { return null }

    var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;
    // Get the spans that 'stick out' on both sides
    var first = markedSpansBefore(oldFirst, startCh, isInsert);
    var last = markedSpansAfter(oldLast, endCh, isInsert);

    // Next, merge those two ends
    var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);
    if (first) {
      // Fix up .to properties of first
      for (var i = 0; i < first.length; ++i) {
        var span = first[i];
        if (span.to == null) {
          var found = getMarkedSpanFor(last, span.marker);
          if (!found) { span.to = startCh; }
          else if (sameLine) { span.to = found.to == null ? null : found.to + offset; }
        }
      }
    }
    if (last) {
      // Fix up .from in last (or move them into first in case of sameLine)
      for (var i$1 = 0; i$1 < last.length; ++i$1) {
        var span$1 = last[i$1];
        if (span$1.to != null) { span$1.to += offset; }
        if (span$1.from == null) {
          var found$1 = getMarkedSpanFor(first, span$1.marker);
          if (!found$1) {
            span$1.from = offset;
            if (sameLine) { (first || (first = [])).push(span$1); }
          }
        } else {
          span$1.from += offset;
          if (sameLine) { (first || (first = [])).push(span$1); }
        }
      }
    }
    // Make sure we didn't create any zero-length spans
    if (first) { first = clearEmptySpans(first); }
    if (last && last != first) { last = clearEmptySpans(last); }

    var newMarkers = [first];
    if (!sameLine) {
      // Fill gap with whole-line-spans
      var gap = change.text.length - 2, gapMarkers;
      if (gap > 0 && first)
        { for (var i$2 = 0; i$2 < first.length; ++i$2)
          { if (first[i$2].to == null)
            { (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i$2].marker, null, null)); } } }
      for (var i$3 = 0; i$3 < gap; ++i$3)
        { newMarkers.push(gapMarkers); }
      newMarkers.push(last);
    }
    return newMarkers
  }

  // Remove spans that are empty and don't have a clearWhenEmpty
  // option of false.
  function clearEmptySpans(spans) {
    for (var i = 0; i < spans.length; ++i) {
      var span = spans[i];
      if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)
        { spans.splice(i--, 1); }
    }
    if (!spans.length) { return null }
    return spans
  }

  // Used to 'clip' out readOnly ranges when making a change.
  function removeReadOnlyRanges(doc, from, to) {
    var markers = null;
    doc.iter(from.line, to.line + 1, function (line) {
      if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {
        var mark = line.markedSpans[i].marker;
        if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))
          { (markers || (markers = [])).push(mark); }
      } }
    });
    if (!markers) { return null }
    var parts = [{from: from, to: to}];
    for (var i = 0; i < markers.length; ++i) {
      var mk = markers[i], m = mk.find(0);
      for (var j = 0; j < parts.length; ++j) {
        var p = parts[j];
        if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) { continue }
        var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);
        if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)
          { newParts.push({from: p.from, to: m.from}); }
        if (dto > 0 || !mk.inclusiveRight && !dto)
          { newParts.push({from: m.to, to: p.to}); }
        parts.splice.apply(parts, newParts);
        j += newParts.length - 3;
      }
    }
    return parts
  }

  // Connect or disconnect spans from a line.
  function detachMarkedSpans(line) {
    var spans = line.markedSpans;
    if (!spans) { return }
    for (var i = 0; i < spans.length; ++i)
      { spans[i].marker.detachLine(line); }
    line.markedSpans = null;
  }
  function attachMarkedSpans(line, spans) {
    if (!spans) { return }
    for (var i = 0; i < spans.length; ++i)
      { spans[i].marker.attachLine(line); }
    line.markedSpans = spans;
  }

  // Helpers used when computing which overlapping collapsed span
  // counts as the larger one.
  function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0 }
  function extraRight(marker) { return marker.inclusiveRight ? 1 : 0 }

  // Returns a number indicating which of two overlapping collapsed
  // spans is larger (and thus includes the other). Falls back to
  // comparing ids when the spans cover exactly the same range.
  function compareCollapsedMarkers(a, b) {
    var lenDiff = a.lines.length - b.lines.length;
    if (lenDiff != 0) { return lenDiff }
    var aPos = a.find(), bPos = b.find();
    var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);
    if (fromCmp) { return -fromCmp }
    var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);
    if (toCmp) { return toCmp }
    return b.id - a.id
  }

  // Find out whether a line ends or starts in a collapsed span. If
  // so, return the marker for that span.
  function collapsedSpanAtSide(line, start) {
    var sps = sawCollapsedSpans && line.markedSpans, found;
    if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {
      sp = sps[i];
      if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&
          (!found || compareCollapsedMarkers(found, sp.marker) < 0))
        { found = sp.marker; }
    } }
    return found
  }
  function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true) }
  function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false) }

  function collapsedSpanAround(line, ch) {
    var sps = sawCollapsedSpans && line.markedSpans, found;
    if (sps) { for (var i = 0; i < sps.length; ++i) {
      var sp = sps[i];
      if (sp.marker.collapsed && (sp.from == null || sp.from < ch) && (sp.to == null || sp.to > ch) &&
          (!found || compareCollapsedMarkers(found, sp.marker) < 0)) { found = sp.marker; }
    } }
    return found
  }

  // Test whether there exists a collapsed span that partially
  // overlaps (covers the start or end, but not both) of a new span.
  // Such overlap is not allowed.
  function conflictingCollapsedRange(doc, lineNo, from, to, marker) {
    var line = getLine(doc, lineNo);
    var sps = sawCollapsedSpans && line.markedSpans;
    if (sps) { for (var i = 0; i < sps.length; ++i) {
      var sp = sps[i];
      if (!sp.marker.collapsed) { continue }
      var found = sp.marker.find(0);
      var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);
      var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);
      if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) { continue }
      if (fromCmp <= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.to, from) >= 0 : cmp(found.to, from) > 0) ||
          fromCmp >= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.from, to) <= 0 : cmp(found.from, to) < 0))
        { return true }
    } }
  }

  // A visual line is a line as drawn on the screen. Folding, for
  // example, can cause multiple logical lines to appear on the same
  // visual line. This finds the start of the visual line that the
  // given line is part of (usually that is the line itself).
  function visualLine(line) {
    var merged;
    while (merged = collapsedSpanAtStart(line))
      { line = merged.find(-1, true).line; }
    return line
  }

  function visualLineEnd(line) {
    var merged;
    while (merged = collapsedSpanAtEnd(line))
      { line = merged.find(1, true).line; }
    return line
  }

  // Returns an array of logical lines that continue the visual line
  // started by the argument, or undefined if there are no such lines.
  function visualLineContinued(line) {
    var merged, lines;
    while (merged = collapsedSpanAtEnd(line)) {
      line = merged.find(1, true).line
      ;(lines || (lines = [])).push(line);
    }
    return lines
  }

  // Get the line number of the start of the visual line that the
  // given line number is part of.
  function visualLineNo(doc, lineN) {
    var line = getLine(doc, lineN), vis = visualLine(line);
    if (line == vis) { return lineN }
    return lineNo(vis)
  }

  // Get the line number of the start of the next visual line after
  // the given line.
  function visualLineEndNo(doc, lineN) {
    if (lineN > doc.lastLine()) { return lineN }
    var line = getLine(doc, lineN), merged;
    if (!lineIsHidden(doc, line)) { return lineN }
    while (merged = collapsedSpanAtEnd(line))
      { line = merged.find(1, true).line; }
    return lineNo(line) + 1
  }

  // Compute whether a line is hidden. Lines count as hidden when they
  // are part of a visual line that starts with another line, or when
  // they are entirely covered by collapsed, non-widget span.
  function lineIsHidden(doc, line) {
    var sps = sawCollapsedSpans && line.markedSpans;
    if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {
      sp = sps[i];
      if (!sp.marker.collapsed) { continue }
      if (sp.from == null) { return true }
      if (sp.marker.widgetNode) { continue }
      if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))
        { return true }
    } }
  }
  function lineIsHiddenInner(doc, line, span) {
    if (span.to == null) {
      var end = span.marker.find(1, true);
      return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker))
    }
    if (span.marker.inclusiveRight && span.to == line.text.length)
      { return true }
    for (var sp = (void 0), i = 0; i < line.markedSpans.length; ++i) {
      sp = line.markedSpans[i];
      if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&
          (sp.to == null || sp.to != span.from) &&
          (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&
          lineIsHiddenInner(doc, line, sp)) { return true }
    }
  }

  // Find the height above the given line.
  function heightAtLine(lineObj) {
    lineObj = visualLine(lineObj);

    var h = 0, chunk = lineObj.parent;
    for (var i = 0; i < chunk.lines.length; ++i) {
      var line = chunk.lines[i];
      if (line == lineObj) { break }
      else { h += line.height; }
    }
    for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {
      for (var i$1 = 0; i$1 < p.children.length; ++i$1) {
        var cur = p.children[i$1];
        if (cur == chunk) { break }
        else { h += cur.height; }
      }
    }
    return h
  }

  // Compute the character length of a line, taking into account
  // collapsed ranges (see markText) that might hide parts, and join
  // other lines onto it.
  function lineLength(line) {
    if (line.height == 0) { return 0 }
    var len = line.text.length, merged, cur = line;
    while (merged = collapsedSpanAtStart(cur)) {
      var found = merged.find(0, true);
      cur = found.from.line;
      len += found.from.ch - found.to.ch;
    }
    cur = line;
    while (merged = collapsedSpanAtEnd(cur)) {
      var found$1 = merged.find(0, true);
      len -= cur.text.length - found$1.from.ch;
      cur = found$1.to.line;
      len += cur.text.length - found$1.to.ch;
    }
    return len
  }

  // Find the longest line in the document.
  function findMaxLine(cm) {
    var d = cm.display, doc = cm.doc;
    d.maxLine = getLine(doc, doc.first);
    d.maxLineLength = lineLength(d.maxLine);
    d.maxLineChanged = true;
    doc.iter(function (line) {
      var len = lineLength(line);
      if (len > d.maxLineLength) {
        d.maxLineLength = len;
        d.maxLine = line;
      }
    });
  }

  // LINE DATA STRUCTURE

  // Line objects. These hold state related to a line, including
  // highlighting info (the styles array).
  var Line = function(text, markedSpans, estimateHeight) {
    this.text = text;
    attachMarkedSpans(this, markedSpans);
    this.height = estimateHeight ? estimateHeight(this) : 1;
  };

  Line.prototype.lineNo = function () { return lineNo(this) };
  eventMixin(Line);

  // Change the content (text, markers) of a line. Automatically
  // invalidates cached information and tries to re-estimate the
  // line's height.
  function updateLine(line, text, markedSpans, estimateHeight) {
    line.text = text;
    if (line.stateAfter) { line.stateAfter = null; }
    if (line.styles) { line.styles = null; }
    if (line.order != null) { line.order = null; }
    detachMarkedSpans(line);
    attachMarkedSpans(line, markedSpans);
    var estHeight = estimateHeight ? estimateHeight(line) : 1;
    if (estHeight != line.height) { updateLineHeight(line, estHeight); }
  }

  // Detach a line from the document tree and its markers.
  function cleanUpLine(line) {
    line.parent = null;
    detachMarkedSpans(line);
  }

  // Convert a style as returned by a mode (either null, or a string
  // containing one or more styles) to a CSS style. This is cached,
  // and also looks for line-wide styles.
  var styleToClassCache = {}, styleToClassCacheWithMode = {};
  function interpretTokenStyle(style, options) {
    if (!style || /^\s*$/.test(style)) { return null }
    var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;
    return cache[style] ||
      (cache[style] = style.replace(/\S+/g, "cm-$&"))
  }

  // Render the DOM representation of the text of a line. Also builds
  // up a 'line map', which points at the DOM nodes that represent
  // specific stretches of text, and is used by the measuring code.
  // The returned object contains the DOM node, this map, and
  // information about line-wide styles that were set by the mode.
  function buildLineContent(cm, lineView) {
    // The padding-right forces the element to have a 'border', which
    // is needed on Webkit to be able to get line-level bounding
    // rectangles for it (in measureChar).
    var content = eltP("span", null, null, webkit ? "padding-right: .1px" : null);
    var builder = {pre: eltP("pre", [content], "CodeMirror-line"), content: content,
                   col: 0, pos: 0, cm: cm,
                   trailingSpace: false,
                   splitSpaces: cm.getOption("lineWrapping")};
    lineView.measure = {};

    // Iterate over the logical lines that make up this visual line.
    for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {
      var line = i ? lineView.rest[i - 1] : lineView.line, order = (void 0);
      builder.pos = 0;
      builder.addToken = buildToken;
      // Optionally wire in some hacks into the token-rendering
      // algorithm, to deal with browser quirks.
      if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line, cm.doc.direction)))
        { builder.addToken = buildTokenBadBidi(builder.addToken, order); }
      builder.map = [];
      var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);
      insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));
      if (line.styleClasses) {
        if (line.styleClasses.bgClass)
          { builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || ""); }
        if (line.styleClasses.textClass)
          { builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || ""); }
      }

      // Ensure at least a single node is present, for measuring.
      if (builder.map.length == 0)
        { builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure))); }

      // Store the map and a cache object for the current logical line
      if (i == 0) {
        lineView.measure.map = builder.map;
        lineView.measure.cache = {};
      } else {
  (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map)
        ;(lineView.measure.caches || (lineView.measure.caches = [])).push({});
      }
    }

    // See issue #2901
    if (webkit) {
      var last = builder.content.lastChild;
      if (/\bcm-tab\b/.test(last.className) || (last.querySelector && last.querySelector(".cm-tab")))
        { builder.content.className = "cm-tab-wrap-hack"; }
    }

    signal(cm, "renderLine", cm, lineView.line, builder.pre);
    if (builder.pre.className)
      { builder.textClass = joinClasses(builder.pre.className, builder.textClass || ""); }

    return builder
  }

  function defaultSpecialCharPlaceholder(ch) {
    var token = elt("span", "\u2022", "cm-invalidchar");
    token.title = "\\u" + ch.charCodeAt(0).toString(16);
    token.setAttribute("aria-label", token.title);
    return token
  }

  // Build up the DOM representation for a single token, and add it to
  // the line map. Takes care to render special characters separately.
  function buildToken(builder, text, style, startStyle, endStyle, css, attributes) {
    if (!text) { return }
    var displayText = builder.splitSpaces ? splitSpaces(text, builder.trailingSpace) : text;
    var special = builder.cm.state.specialChars, mustWrap = false;
    var content;
    if (!special.test(text)) {
      builder.col += text.length;
      content = document.createTextNode(displayText);
      builder.map.push(builder.pos, builder.pos + text.length, content);
      if (ie && ie_version < 9) { mustWrap = true; }
      builder.pos += text.length;
    } else {
      content = document.createDocumentFragment();
      var pos = 0;
      while (true) {
        special.lastIndex = pos;
        var m = special.exec(text);
        var skipped = m ? m.index - pos : text.length - pos;
        if (skipped) {
          var txt = document.createTextNode(displayText.slice(pos, pos + skipped));
          if (ie && ie_version < 9) { content.appendChild(elt("span", [txt])); }
          else { content.appendChild(txt); }
          builder.map.push(builder.pos, builder.pos + skipped, txt);
          builder.col += skipped;
          builder.pos += skipped;
        }
        if (!m) { break }
        pos += skipped + 1;
        var txt$1 = (void 0);
        if (m[0] == "\t") {
          var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;
          txt$1 = content.appendChild(elt("span", spaceStr(tabWidth), "cm-tab"));
          txt$1.setAttribute("role", "presentation");
          txt$1.setAttribute("cm-text", "\t");
          builder.col += tabWidth;
        } else if (m[0] == "\r" || m[0] == "\n") {
          txt$1 = content.appendChild(elt("span", m[0] == "\r" ? "\u240d" : "\u2424", "cm-invalidchar"));
          txt$1.setAttribute("cm-text", m[0]);
          builder.col += 1;
        } else {
          txt$1 = builder.cm.options.specialCharPlaceholder(m[0]);
          txt$1.setAttribute("cm-text", m[0]);
          if (ie && ie_version < 9) { content.appendChild(elt("span", [txt$1])); }
          else { content.appendChild(txt$1); }
          builder.col += 1;
        }
        builder.map.push(builder.pos, builder.pos + 1, txt$1);
        builder.pos++;
      }
    }
    builder.trailingSpace = displayText.charCodeAt(text.length - 1) == 32;
    if (style || startStyle || endStyle || mustWrap || css || attributes) {
      var fullStyle = style || "";
      if (startStyle) { fullStyle += startStyle; }
      if (endStyle) { fullStyle += endStyle; }
      var token = elt("span", [content], fullStyle, css);
      if (attributes) {
        for (var attr in attributes) { if (attributes.hasOwnProperty(attr) && attr != "style" && attr != "class")
          { token.setAttribute(attr, attributes[attr]); } }
      }
      return builder.content.appendChild(token)
    }
    builder.content.appendChild(content);
  }

  // Change some spaces to NBSP to prevent the browser from collapsing
  // trailing spaces at the end of a line when rendering text (issue #1362).
  function splitSpaces(text, trailingBefore) {
    if (text.length > 1 && !/  /.test(text)) { return text }
    var spaceBefore = trailingBefore, result = "";
    for (var i = 0; i < text.length; i++) {
      var ch = text.charAt(i);
      if (ch == " " && spaceBefore && (i == text.length - 1 || text.charCodeAt(i + 1) == 32))
        { ch = "\u00a0"; }
      result += ch;
      spaceBefore = ch == " ";
    }
    return result
  }

  // Work around nonsense dimensions being reported for stretches of
  // right-to-left text.
  function buildTokenBadBidi(inner, order) {
    return function (builder, text, style, startStyle, endStyle, css, attributes) {
      style = style ? style + " cm-force-border" : "cm-force-border";
      var start = builder.pos, end = start + text.length;
      for (;;) {
        // Find the part that overlaps with the start of this text
        var part = (void 0);
        for (var i = 0; i < order.length; i++) {
          part = order[i];
          if (part.to > start && part.from <= start) { break }
        }
        if (part.to >= end) { return inner(builder, text, style, startStyle, endStyle, css, attributes) }
        inner(builder, text.slice(0, part.to - start), style, startStyle, null, css, attributes);
        startStyle = null;
        text = text.slice(part.to - start);
        start = part.to;
      }
    }
  }

  function buildCollapsedSpan(builder, size, marker, ignoreWidget) {
    var widget = !ignoreWidget && marker.widgetNode;
    if (widget) { builder.map.push(builder.pos, builder.pos + size, widget); }
    if (!ignoreWidget && builder.cm.display.input.needsContentAttribute) {
      if (!widget)
        { widget = builder.content.appendChild(document.createElement("span")); }
      widget.setAttribute("cm-marker", marker.id);
    }
    if (widget) {
      builder.cm.display.input.setUneditable(widget);
      builder.content.appendChild(widget);
    }
    builder.pos += size;
    builder.trailingSpace = false;
  }

  // Outputs a number of spans to make up a line, taking highlighting
  // and marked text into account.
  function insertLineContent(line, builder, styles) {
    var spans = line.markedSpans, allText = line.text, at = 0;
    if (!spans) {
      for (var i$1 = 1; i$1 < styles.length; i$1+=2)
        { builder.addToken(builder, allText.slice(at, at = styles[i$1]), interpretTokenStyle(styles[i$1+1], builder.cm.options)); }
      return
    }

    var len = allText.length, pos = 0, i = 1, text = "", style, css;
    var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, collapsed, attributes;
    for (;;) {
      if (nextChange == pos) { // Update current marker set
        spanStyle = spanEndStyle = spanStartStyle = css = "";
        attributes = null;
        collapsed = null; nextChange = Infinity;
        var foundBookmarks = [], endStyles = (void 0);
        for (var j = 0; j < spans.length; ++j) {
          var sp = spans[j], m = sp.marker;
          if (m.type == "bookmark" && sp.from == pos && m.widgetNode) {
            foundBookmarks.push(m);
          } else if (sp.from <= pos && (sp.to == null || sp.to > pos || m.collapsed && sp.to == pos && sp.from == pos)) {
            if (sp.to != null && sp.to != pos && nextChange > sp.to) {
              nextChange = sp.to;
              spanEndStyle = "";
            }
            if (m.className) { spanStyle += " " + m.className; }
            if (m.css) { css = (css ? css + ";" : "") + m.css; }
            if (m.startStyle && sp.from == pos) { spanStartStyle += " " + m.startStyle; }
            if (m.endStyle && sp.to == nextChange) { (endStyles || (endStyles = [])).push(m.endStyle, sp.to); }
            // support for the old title property
            // https://github.com/codemirror/CodeMirror/pull/5673
            if (m.title) { (attributes || (attributes = {})).title = m.title; }
            if (m.attributes) {
              for (var attr in m.attributes)
                { (attributes || (attributes = {}))[attr] = m.attributes[attr]; }
            }
            if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))
              { collapsed = sp; }
          } else if (sp.from > pos && nextChange > sp.from) {
            nextChange = sp.from;
          }
        }
        if (endStyles) { for (var j$1 = 0; j$1 < endStyles.length; j$1 += 2)
          { if (endStyles[j$1 + 1] == nextChange) { spanEndStyle += " " + endStyles[j$1]; } } }

        if (!collapsed || collapsed.from == pos) { for (var j$2 = 0; j$2 < foundBookmarks.length; ++j$2)
          { buildCollapsedSpan(builder, 0, foundBookmarks[j$2]); } }
        if (collapsed && (collapsed.from || 0) == pos) {
          buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,
                             collapsed.marker, collapsed.from == null);
          if (collapsed.to == null) { return }
          if (collapsed.to == pos) { collapsed = false; }
        }
      }
      if (pos >= len) { break }

      var upto = Math.min(len, nextChange);
      while (true) {
        if (text) {
          var end = pos + text.length;
          if (!collapsed) {
            var tokenText = end > upto ? text.slice(0, upto - pos) : text;
            builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,
                             spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : "", css, attributes);
          }
          if (end >= upto) {text = text.slice(upto - pos); pos = upto; break}
          pos = end;
          spanStartStyle = "";
        }
        text = allText.slice(at, at = styles[i++]);
        style = interpretTokenStyle(styles[i++], builder.cm.options);
      }
    }
  }


  // These objects are used to represent the visible (currently drawn)
  // part of the document. A LineView may correspond to multiple
  // logical lines, if those are connected by collapsed ranges.
  function LineView(doc, line, lineN) {
    // The starting line
    this.line = line;
    // Continuing lines, if any
    this.rest = visualLineContinued(line);
    // Number of logical lines in this visual line
    this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;
    this.node = this.text = null;
    this.hidden = lineIsHidden(doc, line);
  }

  // Create a range of LineView objects for the given lines.
  function buildViewArray(cm, from, to) {
    var array = [], nextPos;
    for (var pos = from; pos < to; pos = nextPos) {
      var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);
      nextPos = pos + view.size;
      array.push(view);
    }
    return array
  }

  var operationGroup = null;

  function pushOperation(op) {
    if (operationGroup) {
      operationGroup.ops.push(op);
    } else {
      op.ownsGroup = operationGroup = {
        ops: [op],
        delayedCallbacks: []
      };
    }
  }

  function fireCallbacksForOps(group) {
    // Calls delayed callbacks and cursorActivity handlers until no
    // new ones appear
    var callbacks = group.delayedCallbacks, i = 0;
    do {
      for (; i < callbacks.length; i++)
        { callbacks[i].call(null); }
      for (var j = 0; j < group.ops.length; j++) {
        var op = group.ops[j];
        if (op.cursorActivityHandlers)
          { while (op.cursorActivityCalled < op.cursorActivityHandlers.length)
            { op.cursorActivityHandlers[op.cursorActivityCalled++].call(null, op.cm); } }
      }
    } while (i < callbacks.length)
  }

  function finishOperation(op, endCb) {
    var group = op.ownsGroup;
    if (!group) { return }

    try { fireCallbacksForOps(group); }
    finally {
      operationGroup = null;
      endCb(group);
    }
  }

  var orphanDelayedCallbacks = null;

  // Often, we want to signal events at a point where we are in the
  // middle of some work, but don't want the handler to start calling
  // other methods on the editor, which might be in an inconsistent
  // state or simply not expect any other events to happen.
  // signalLater looks whether there are any handlers, and schedules
  // them to be executed when the last operation ends, or, if no
  // operation is active, when a timeout fires.
  function signalLater(emitter, type /*, values...*/) {
    var arr = getHandlers(emitter, type);
    if (!arr.length) { return }
    var args = Array.prototype.slice.call(arguments, 2), list;
    if (operationGroup) {
      list = operationGroup.delayedCallbacks;
    } else if (orphanDelayedCallbacks) {
      list = orphanDelayedCallbacks;
    } else {
      list = orphanDelayedCallbacks = [];
      setTimeout(fireOrphanDelayed, 0);
    }
    var loop = function ( i ) {
      list.push(function () { return arr[i].apply(null, args); });
    };

    for (var i = 0; i < arr.length; ++i)
      loop( i );
  }

  function fireOrphanDelayed() {
    var delayed = orphanDelayedCallbacks;
    orphanDelayedCallbacks = null;
    for (var i = 0; i < delayed.length; ++i) { delayed[i](); }
  }

  // When an aspect of a line changes, a string is added to
  // lineView.changes. This updates the relevant part of the line's
  // DOM structure.
  function updateLineForChanges(cm, lineView, lineN, dims) {
    for (var j = 0; j < lineView.changes.length; j++) {
      var type = lineView.changes[j];
      if (type == "text") { updateLineText(cm, lineView); }
      else if (type == "gutter") { updateLineGutter(cm, lineView, lineN, dims); }
      else if (type == "class") { updateLineClasses(cm, lineView); }
      else if (type == "widget") { updateLineWidgets(cm, lineView, dims); }
    }
    lineView.changes = null;
  }

  // Lines with gutter elements, widgets or a background class need to
  // be wrapped, and have the extra elements added to the wrapper div
  function ensureLineWrapped(lineView) {
    if (lineView.node == lineView.text) {
      lineView.node = elt("div", null, null, "position: relative");
      if (lineView.text.parentNode)
        { lineView.text.parentNode.replaceChild(lineView.node, lineView.text); }
      lineView.node.appendChild(lineView.text);
      if (ie && ie_version < 8) { lineView.node.style.zIndex = 2; }
    }
    return lineView.node
  }

  function updateLineBackground(cm, lineView) {
    var cls = lineView.bgClass ? lineView.bgClass + " " + (lineView.line.bgClass || "") : lineView.line.bgClass;
    if (cls) { cls += " CodeMirror-linebackground"; }
    if (lineView.background) {
      if (cls) { lineView.background.className = cls; }
      else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }
    } else if (cls) {
      var wrap = ensureLineWrapped(lineView);
      lineView.background = wrap.insertBefore(elt("div", null, cls), wrap.firstChild);
      cm.display.input.setUneditable(lineView.background);
    }
  }

  // Wrapper around buildLineContent which will reuse the structure
  // in display.externalMeasured when possible.
  function getLineContent(cm, lineView) {
    var ext = cm.display.externalMeasured;
    if (ext && ext.line == lineView.line) {
      cm.display.externalMeasured = null;
      lineView.measure = ext.measure;
      return ext.built
    }
    return buildLineContent(cm, lineView)
  }

  // Redraw the line's text. Interacts with the background and text
  // classes because the mode may output tokens that influence these
  // classes.
  function updateLineText(cm, lineView) {
    var cls = lineView.text.className;
    var built = getLineContent(cm, lineView);
    if (lineView.text == lineView.node) { lineView.node = built.pre; }
    lineView.text.parentNode.replaceChild(built.pre, lineView.text);
    lineView.text = built.pre;
    if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {
      lineView.bgClass = built.bgClass;
      lineView.textClass = built.textClass;
      updateLineClasses(cm, lineView);
    } else if (cls) {
      lineView.text.className = cls;
    }
  }

  function updateLineClasses(cm, lineView) {
    updateLineBackground(cm, lineView);
    if (lineView.line.wrapClass)
      { ensureLineWrapped(lineView).className = lineView.line.wrapClass; }
    else if (lineView.node != lineView.text)
      { lineView.node.className = ""; }
    var textClass = lineView.textClass ? lineView.textClass + " " + (lineView.line.textClass || "") : lineView.line.textClass;
    lineView.text.className = textClass || "";
  }

  function updateLineGutter(cm, lineView, lineN, dims) {
    if (lineView.gutter) {
      lineView.node.removeChild(lineView.gutter);
      lineView.gutter = null;
    }
    if (lineView.gutterBackground) {
      lineView.node.removeChild(lineView.gutterBackground);
      lineView.gutterBackground = null;
    }
    if (lineView.line.gutterClass) {
      var wrap = ensureLineWrapped(lineView);
      lineView.gutterBackground = elt("div", null, "CodeMirror-gutter-background " + lineView.line.gutterClass,
                                      ("left: " + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + "px; width: " + (dims.gutterTotalWidth) + "px"));
      cm.display.input.setUneditable(lineView.gutterBackground);
      wrap.insertBefore(lineView.gutterBackground, lineView.text);
    }
    var markers = lineView.line.gutterMarkers;
    if (cm.options.lineNumbers || markers) {
      var wrap$1 = ensureLineWrapped(lineView);
      var gutterWrap = lineView.gutter = elt("div", null, "CodeMirror-gutter-wrapper", ("left: " + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + "px"));
      gutterWrap.setAttribute("aria-hidden", "true");
      cm.display.input.setUneditable(gutterWrap);
      wrap$1.insertBefore(gutterWrap, lineView.text);
      if (lineView.line.gutterClass)
        { gutterWrap.className += " " + lineView.line.gutterClass; }
      if (cm.options.lineNumbers && (!markers || !markers["CodeMirror-linenumbers"]))
        { lineView.lineNumber = gutterWrap.appendChild(
          elt("div", lineNumberFor(cm.options, lineN),
              "CodeMirror-linenumber CodeMirror-gutter-elt",
              ("left: " + (dims.gutterLeft["CodeMirror-linenumbers"]) + "px; width: " + (cm.display.lineNumInnerWidth) + "px"))); }
      if (markers) { for (var k = 0; k < cm.display.gutterSpecs.length; ++k) {
        var id = cm.display.gutterSpecs[k].className, found = markers.hasOwnProperty(id) && markers[id];
        if (found)
          { gutterWrap.appendChild(elt("div", [found], "CodeMirror-gutter-elt",
                                     ("left: " + (dims.gutterLeft[id]) + "px; width: " + (dims.gutterWidth[id]) + "px"))); }
      } }
    }
  }

  function updateLineWidgets(cm, lineView, dims) {
    if (lineView.alignable) { lineView.alignable = null; }
    var isWidget = classTest("CodeMirror-linewidget");
    for (var node = lineView.node.firstChild, next = (void 0); node; node = next) {
      next = node.nextSibling;
      if (isWidget.test(node.className)) { lineView.node.removeChild(node); }
    }
    insertLineWidgets(cm, lineView, dims);
  }

  // Build a line's DOM representation from scratch
  function buildLineElement(cm, lineView, lineN, dims) {
    var built = getLineContent(cm, lineView);
    lineView.text = lineView.node = built.pre;
    if (built.bgClass) { lineView.bgClass = built.bgClass; }
    if (built.textClass) { lineView.textClass = built.textClass; }

    updateLineClasses(cm, lineView);
    updateLineGutter(cm, lineView, lineN, dims);
    insertLineWidgets(cm, lineView, dims);
    return lineView.node
  }

  // A lineView may contain multiple logical lines (when merged by
  // collapsed spans). The widgets for all of them need to be drawn.
  function insertLineWidgets(cm, lineView, dims) {
    insertLineWidgetsFor(cm, lineView.line, lineView, dims, true);
    if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)
      { insertLineWidgetsFor(cm, lineView.rest[i], lineView, dims, false); } }
  }

  function insertLineWidgetsFor(cm, line, lineView, dims, allowAbove) {
    if (!line.widgets) { return }
    var wrap = ensureLineWrapped(lineView);
    for (var i = 0, ws = line.widgets; i < ws.length; ++i) {
      var widget = ws[i], node = elt("div", [widget.node], "CodeMirror-linewidget" + (widget.className ? " " + widget.className : ""));
      if (!widget.handleMouseEvents) { node.setAttribute("cm-ignore-events", "true"); }
      positionLineWidget(widget, node, lineView, dims);
      cm.display.input.setUneditable(node);
      if (allowAbove && widget.above)
        { wrap.insertBefore(node, lineView.gutter || lineView.text); }
      else
        { wrap.appendChild(node); }
      signalLater(widget, "redraw");
    }
  }

  function positionLineWidget(widget, node, lineView, dims) {
    if (widget.noHScroll) {
  (lineView.alignable || (lineView.alignable = [])).push(node);
      var width = dims.wrapperWidth;
      node.style.left = dims.fixedPos + "px";
      if (!widget.coverGutter) {
        width -= dims.gutterTotalWidth;
        node.style.paddingLeft = dims.gutterTotalWidth + "px";
      }
      node.style.width = width + "px";
    }
    if (widget.coverGutter) {
      node.style.zIndex = 5;
      node.style.position = "relative";
      if (!widget.noHScroll) { node.style.marginLeft = -dims.gutterTotalWidth + "px"; }
    }
  }

  function widgetHeight(widget) {
    if (widget.height != null) { return widget.height }
    var cm = widget.doc.cm;
    if (!cm) { return 0 }
    if (!contains(document.body, widget.node)) {
      var parentStyle = "position: relative;";
      if (widget.coverGutter)
        { parentStyle += "margin-left: -" + cm.display.gutters.offsetWidth + "px;"; }
      if (widget.noHScroll)
        { parentStyle += "width: " + cm.display.wrapper.clientWidth + "px;"; }
      removeChildrenAndAdd(cm.display.measure, elt("div", [widget.node], null, parentStyle));
    }
    return widget.height = widget.node.parentNode.offsetHeight
  }

  // Return true when the given mouse event happened in a widget
  function eventInWidget(display, e) {
    for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {
      if (!n || (n.nodeType == 1 && n.getAttribute("cm-ignore-events") == "true") ||
          (n.parentNode == display.sizer && n != display.mover))
        { return true }
    }
  }

  // POSITION MEASUREMENT

  function paddingTop(display) {return display.lineSpace.offsetTop}
  function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight}
  function paddingH(display) {
    if (display.cachedPaddingH) { return display.cachedPaddingH }
    var e = removeChildrenAndAdd(display.measure, elt("pre", "x", "CodeMirror-line-like"));
    var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;
    var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};
    if (!isNaN(data.left) && !isNaN(data.right)) { display.cachedPaddingH = data; }
    return data
  }

  function scrollGap(cm) { return scrollerGap - cm.display.nativeBarWidth }
  function displayWidth(cm) {
    return cm.display.scroller.clientWidth - scrollGap(cm) - cm.display.barWidth
  }
  function displayHeight(cm) {
    return cm.display.scroller.clientHeight - scrollGap(cm) - cm.display.barHeight
  }

  // Ensure the lineView.wrapping.heights array is populated. This is
  // an array of bottom offsets for the lines that make up a drawn
  // line. When lineWrapping is on, there might be more than one
  // height.
  function ensureLineHeights(cm, lineView, rect) {
    var wrapping = cm.options.lineWrapping;
    var curWidth = wrapping && displayWidth(cm);
    if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {
      var heights = lineView.measure.heights = [];
      if (wrapping) {
        lineView.measure.width = curWidth;
        var rects = lineView.text.firstChild.getClientRects();
        for (var i = 0; i < rects.length - 1; i++) {
          var cur = rects[i], next = rects[i + 1];
          if (Math.abs(cur.bottom - next.bottom) > 2)
            { heights.push((cur.bottom + next.top) / 2 - rect.top); }
        }
      }
      heights.push(rect.bottom - rect.top);
    }
  }

  // Find a line map (mapping character offsets to text nodes) and a
  // measurement cache for the given line number. (A line view might
  // contain multiple lines when collapsed ranges are present.)
  function mapFromLineView(lineView, line, lineN) {
    if (lineView.line == line)
      { return {map: lineView.measure.map, cache: lineView.measure.cache} }
    for (var i = 0; i < lineView.rest.length; i++)
      { if (lineView.rest[i] == line)
        { return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]} } }
    for (var i$1 = 0; i$1 < lineView.rest.length; i$1++)
      { if (lineNo(lineView.rest[i$1]) > lineN)
        { return {map: lineView.measure.maps[i$1], cache: lineView.measure.caches[i$1], before: true} } }
  }

  // Render a line into the hidden node display.externalMeasured. Used
  // when measurement is needed for a line that's not in the viewport.
  function updateExternalMeasurement(cm, line) {
    line = visualLine(line);
    var lineN = lineNo(line);
    var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);
    view.lineN = lineN;
    var built = view.built = buildLineContent(cm, view);
    view.text = built.pre;
    removeChildrenAndAdd(cm.display.lineMeasure, built.pre);
    return view
  }

  // Get a {top, bottom, left, right} box (in line-local coordinates)
  // for a given character.
  function measureChar(cm, line, ch, bias) {
    return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias)
  }

  // Find a line view that corresponds to the given line number.
  function findViewForLine(cm, lineN) {
    if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)
      { return cm.display.view[findViewIndex(cm, lineN)] }
    var ext = cm.display.externalMeasured;
    if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)
      { return ext }
  }

  // Measurement can be split in two steps, the set-up work that
  // applies to the whole line, and the measurement of the actual
  // character. Functions like coordsChar, that need to do a lot of
  // measurements in a row, can thus ensure that the set-up work is
  // only done once.
  function prepareMeasureForLine(cm, line) {
    var lineN = lineNo(line);
    var view = findViewForLine(cm, lineN);
    if (view && !view.text) {
      view = null;
    } else if (view && view.changes) {
      updateLineForChanges(cm, view, lineN, getDimensions(cm));
      cm.curOp.forceUpdate = true;
    }
    if (!view)
      { view = updateExternalMeasurement(cm, line); }

    var info = mapFromLineView(view, line, lineN);
    return {
      line: line, view: view, rect: null,
      map: info.map, cache: info.cache, before: info.before,
      hasHeights: false
    }
  }

  // Given a prepared measurement object, measures the position of an
  // actual character (or fetches it from the cache).
  function measureCharPrepared(cm, prepared, ch, bias, varHeight) {
    if (prepared.before) { ch = -1; }
    var key = ch + (bias || ""), found;
    if (prepared.cache.hasOwnProperty(key)) {
      found = prepared.cache[key];
    } else {
      if (!prepared.rect)
        { prepared.rect = prepared.view.text.getBoundingClientRect(); }
      if (!prepared.hasHeights) {
        ensureLineHeights(cm, prepared.view, prepared.rect);
        prepared.hasHeights = true;
      }
      found = measureCharInner(cm, prepared, ch, bias);
      if (!found.bogus) { prepared.cache[key] = found; }
    }
    return {left: found.left, right: found.right,
            top: varHeight ? found.rtop : found.top,
            bottom: varHeight ? found.rbottom : found.bottom}
  }

  var nullRect = {left: 0, right: 0, top: 0, bottom: 0};

  function nodeAndOffsetInLineMap(map, ch, bias) {
    var node, start, end, collapse, mStart, mEnd;
    // First, search the line map for the text node corresponding to,
    // or closest to, the target character.
    for (var i = 0; i < map.length; i += 3) {
      mStart = map[i];
      mEnd = map[i + 1];
      if (ch < mStart) {
        start = 0; end = 1;
        collapse = "left";
      } else if (ch < mEnd) {
        start = ch - mStart;
        end = start + 1;
      } else if (i == map.length - 3 || ch == mEnd && map[i + 3] > ch) {
        end = mEnd - mStart;
        start = end - 1;
        if (ch >= mEnd) { collapse = "right"; }
      }
      if (start != null) {
        node = map[i + 2];
        if (mStart == mEnd && bias == (node.insertLeft ? "left" : "right"))
          { collapse = bias; }
        if (bias == "left" && start == 0)
          { while (i && map[i - 2] == map[i - 3] && map[i - 1].insertLeft) {
            node = map[(i -= 3) + 2];
            collapse = "left";
          } }
        if (bias == "right" && start == mEnd - mStart)
          { while (i < map.length - 3 && map[i + 3] == map[i + 4] && !map[i + 5].insertLeft) {
            node = map[(i += 3) + 2];
            collapse = "right";
          } }
        break
      }
    }
    return {node: node, start: start, end: end, collapse: collapse, coverStart: mStart, coverEnd: mEnd}
  }

  function getUsefulRect(rects, bias) {
    var rect = nullRect;
    if (bias == "left") { for (var i = 0; i < rects.length; i++) {
      if ((rect = rects[i]).left != rect.right) { break }
    } } else { for (var i$1 = rects.length - 1; i$1 >= 0; i$1--) {
      if ((rect = rects[i$1]).left != rect.right) { break }
    } }
    return rect
  }

  function measureCharInner(cm, prepared, ch, bias) {
    var place = nodeAndOffsetInLineMap(prepared.map, ch, bias);
    var node = place.node, start = place.start, end = place.end, collapse = place.collapse;

    var rect;
    if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.
      for (var i$1 = 0; i$1 < 4; i$1++) { // Retry a maximum of 4 times when nonsense rectangles are returned
        while (start && isExtendingChar(prepared.line.text.charAt(place.coverStart + start))) { --start; }
        while (place.coverStart + end < place.coverEnd && isExtendingChar(prepared.line.text.charAt(place.coverStart + end))) { ++end; }
        if (ie && ie_version < 9 && start == 0 && end == place.coverEnd - place.coverStart)
          { rect = node.parentNode.getBoundingClientRect(); }
        else
          { rect = getUsefulRect(range(node, start, end).getClientRects(), bias); }
        if (rect.left || rect.right || start == 0) { break }
        end = start;
        start = start - 1;
        collapse = "right";
      }
      if (ie && ie_version < 11) { rect = maybeUpdateRectForZooming(cm.display.measure, rect); }
    } else { // If it is a widget, simply get the box for the whole widget.
      if (start > 0) { collapse = bias = "right"; }
      var rects;
      if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)
        { rect = rects[bias == "right" ? rects.length - 1 : 0]; }
      else
        { rect = node.getBoundingClientRect(); }
    }
    if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {
      var rSpan = node.parentNode.getClientRects()[0];
      if (rSpan)
        { rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom}; }
      else
        { rect = nullRect; }
    }

    var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;
    var mid = (rtop + rbot) / 2;
    var heights = prepared.view.measure.heights;
    var i = 0;
    for (; i < heights.length - 1; i++)
      { if (mid < heights[i]) { break } }
    var top = i ? heights[i - 1] : 0, bot = heights[i];
    var result = {left: (collapse == "right" ? rect.right : rect.left) - prepared.rect.left,
                  right: (collapse == "left" ? rect.left : rect.right) - prepared.rect.left,
                  top: top, bottom: bot};
    if (!rect.left && !rect.right) { result.bogus = true; }
    if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }

    return result
  }

  // Work around problem with bounding client rects on ranges being
  // returned incorrectly when zoomed on IE10 and below.
  function maybeUpdateRectForZooming(measure, rect) {
    if (!window.screen || screen.logicalXDPI == null ||
        screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))
      { return rect }
    var scaleX = screen.logicalXDPI / screen.deviceXDPI;
    var scaleY = screen.logicalYDPI / screen.deviceYDPI;
    return {left: rect.left * scaleX, right: rect.right * scaleX,
            top: rect.top * scaleY, bottom: rect.bottom * scaleY}
  }

  function clearLineMeasurementCacheFor(lineView) {
    if (lineView.measure) {
      lineView.measure.cache = {};
      lineView.measure.heights = null;
      if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)
        { lineView.measure.caches[i] = {}; } }
    }
  }

  function clearLineMeasurementCache(cm) {
    cm.display.externalMeasure = null;
    removeChildren(cm.display.lineMeasure);
    for (var i = 0; i < cm.display.view.length; i++)
      { clearLineMeasurementCacheFor(cm.display.view[i]); }
  }

  function clearCaches(cm) {
    clearLineMeasurementCache(cm);
    cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;
    if (!cm.options.lineWrapping) { cm.display.maxLineChanged = true; }
    cm.display.lineNumChars = null;
  }

  function pageScrollX() {
    // Work around https://bugs.chromium.org/p/chromium/issues/detail?id=489206
    // which causes page_Offset and bounding client rects to use
    // different reference viewports and invalidate our calculations.
    if (chrome && android) { return -(document.body.getBoundingClientRect().left - parseInt(getComputedStyle(document.body).marginLeft)) }
    return window.pageXOffset || (document.documentElement || document.body).scrollLeft
  }
  function pageScrollY() {
    if (chrome && android) { return -(document.body.getBoundingClientRect().top - parseInt(getComputedStyle(document.body).marginTop)) }
    return window.pageYOffset || (document.documentElement || document.body).scrollTop
  }

  function widgetTopHeight(lineObj) {
    var height = 0;
    if (lineObj.widgets) { for (var i = 0; i < lineObj.widgets.length; ++i) { if (lineObj.widgets[i].above)
      { height += widgetHeight(lineObj.widgets[i]); } } }
    return height
  }

  // Converts a {top, bottom, left, right} box from line-local
  // coordinates into another coordinate system. Context may be one of
  // "line", "div" (display.lineDiv), "local"./null (editor), "window",
  // or "page".
  function intoCoordSystem(cm, lineObj, rect, context, includeWidgets) {
    if (!includeWidgets) {
      var height = widgetTopHeight(lineObj);
      rect.top += height; rect.bottom += height;
    }
    if (context == "line") { return rect }
    if (!context) { context = "local"; }
    var yOff = heightAtLine(lineObj);
    if (context == "local") { yOff += paddingTop(cm.display); }
    else { yOff -= cm.display.viewOffset; }
    if (context == "page" || context == "window") {
      var lOff = cm.display.lineSpace.getBoundingClientRect();
      yOff += lOff.top + (context == "window" ? 0 : pageScrollY());
      var xOff = lOff.left + (context == "window" ? 0 : pageScrollX());
      rect.left += xOff; rect.right += xOff;
    }
    rect.top += yOff; rect.bottom += yOff;
    return rect
  }

  // Coverts a box from "div" coords to another coordinate system.
  // Context may be "window", "page", "div", or "local"./null.
  function fromCoordSystem(cm, coords, context) {
    if (context == "div") { return coords }
    var left = coords.left, top = coords.top;
    // First move into "page" coordinate system
    if (context == "page") {
      left -= pageScrollX();
      top -= pageScrollY();
    } else if (context == "local" || !context) {
      var localBox = cm.display.sizer.getBoundingClientRect();
      left += localBox.left;
      top += localBox.top;
    }

    var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();
    return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top}
  }

  function charCoords(cm, pos, context, lineObj, bias) {
    if (!lineObj) { lineObj = getLine(cm.doc, pos.line); }
    return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context)
  }

  // Returns a box for a given cursor position, which may have an
  // 'other' property containing the position of the secondary cursor
  // on a bidi boundary.
  // A cursor Pos(line, char, "before") is on the same visual line as `char - 1`
  // and after `char - 1` in writing order of `char - 1`
  // A cursor Pos(line, char, "after") is on the same visual line as `char`
  // and before `char` in writing order of `char`
  // Examples (upper-case letters are RTL, lower-case are LTR):
  //     Pos(0, 1, ...)
  //     before   after
  // ab     a|b     a|b
  // aB     a|B     aB|
  // Ab     |Ab     A|b
  // AB     B|A     B|A
  // Every position after the last character on a line is considered to stick
  // to the last character on the line.
  function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {
    lineObj = lineObj || getLine(cm.doc, pos.line);
    if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }
    function get(ch, right) {
      var m = measureCharPrepared(cm, preparedMeasure, ch, right ? "right" : "left", varHeight);
      if (right) { m.left = m.right; } else { m.right = m.left; }
      return intoCoordSystem(cm, lineObj, m, context)
    }
    var order = getOrder(lineObj, cm.doc.direction), ch = pos.ch, sticky = pos.sticky;
    if (ch >= lineObj.text.length) {
      ch = lineObj.text.length;
      sticky = "before";
    } else if (ch <= 0) {
      ch = 0;
      sticky = "after";
    }
    if (!order) { return get(sticky == "before" ? ch - 1 : ch, sticky == "before") }

    function getBidi(ch, partPos, invert) {
      var part = order[partPos], right = part.level == 1;
      return get(invert ? ch - 1 : ch, right != invert)
    }
    var partPos = getBidiPartAt(order, ch, sticky);
    var other = bidiOther;
    var val = getBidi(ch, partPos, sticky == "before");
    if (other != null) { val.other = getBidi(ch, other, sticky != "before"); }
    return val
  }

  // Used to cheaply estimate the coordinates for a position. Used for
  // intermediate scroll updates.
  function estimateCoords(cm, pos) {
    var left = 0;
    pos = clipPos(cm.doc, pos);
    if (!cm.options.lineWrapping) { left = charWidth(cm.display) * pos.ch; }
    var lineObj = getLine(cm.doc, pos.line);
    var top = heightAtLine(lineObj) + paddingTop(cm.display);
    return {left: left, right: left, top: top, bottom: top + lineObj.height}
  }

  // Positions returned by coordsChar contain some extra information.
  // xRel is the relative x position of the input coordinates compared
  // to the found position (so xRel > 0 means the coordinates are to
  // the right of the character position, for example). When outside
  // is true, that means the coordinates lie outside the line's
  // vertical range.
  function PosWithInfo(line, ch, sticky, outside, xRel) {
    var pos = Pos(line, ch, sticky);
    pos.xRel = xRel;
    if (outside) { pos.outside = outside; }
    return pos
  }

  // Compute the character position closest to the given coordinates.
  // Input must be lineSpace-local ("div" coordinate system).
  function coordsChar(cm, x, y) {
    var doc = cm.doc;
    y += cm.display.viewOffset;
    if (y < 0) { return PosWithInfo(doc.first, 0, null, -1, -1) }
    var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;
    if (lineN > last)
      { return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, null, 1, 1) }
    if (x < 0) { x = 0; }

    var lineObj = getLine(doc, lineN);
    for (;;) {
      var found = coordsCharInner(cm, lineObj, lineN, x, y);
      var collapsed = collapsedSpanAround(lineObj, found.ch + (found.xRel > 0 || found.outside > 0 ? 1 : 0));
      if (!collapsed) { return found }
      var rangeEnd = collapsed.find(1);
      if (rangeEnd.line == lineN) { return rangeEnd }
      lineObj = getLine(doc, lineN = rangeEnd.line);
    }
  }

  function wrappedLineExtent(cm, lineObj, preparedMeasure, y) {
    y -= widgetTopHeight(lineObj);
    var end = lineObj.text.length;
    var begin = findFirst(function (ch) { return measureCharPrepared(cm, preparedMeasure, ch - 1).bottom <= y; }, end, 0);
    end = findFirst(function (ch) { return measureCharPrepared(cm, preparedMeasure, ch).top > y; }, begin, end);
    return {begin: begin, end: end}
  }

  function wrappedLineExtentChar(cm, lineObj, preparedMeasure, target) {
    if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }
    var targetTop = intoCoordSystem(cm, lineObj, measureCharPrepared(cm, preparedMeasure, target), "line").top;
    return wrappedLineExtent(cm, lineObj, preparedMeasure, targetTop)
  }

  // Returns true if the given side of a box is after the given
  // coordinates, in top-to-bottom, left-to-right order.
  function boxIsAfter(box, x, y, left) {
    return box.bottom <= y ? false : box.top > y ? true : (left ? box.left : box.right) > x
  }

  function coordsCharInner(cm, lineObj, lineNo, x, y) {
    // Move y into line-local coordinate space
    y -= heightAtLine(lineObj);
    var preparedMeasure = prepareMeasureForLine(cm, lineObj);
    // When directly calling `measureCharPrepared`, we have to adjust
    // for the widgets at this line.
    var widgetHeight = widgetTopHeight(lineObj);
    var begin = 0, end = lineObj.text.length, ltr = true;

    var order = getOrder(lineObj, cm.doc.direction);
    // If the line isn't plain left-to-right text, first figure out
    // which bidi section the coordinates fall into.
    if (order) {
      var part = (cm.options.lineWrapping ? coordsBidiPartWrapped : coordsBidiPart)
                   (cm, lineObj, lineNo, preparedMeasure, order, x, y);
      ltr = part.level != 1;
      // The awkward -1 offsets are needed because findFirst (called
      // on these below) will treat its first bound as inclusive,
      // second as exclusive, but we want to actually address the
      // characters in the part's range
      begin = ltr ? part.from : part.to - 1;
      end = ltr ? part.to : part.from - 1;
    }

    // A binary search to find the first character whose bounding box
    // starts after the coordinates. If we run across any whose box wrap
    // the coordinates, store that.
    var chAround = null, boxAround = null;
    var ch = findFirst(function (ch) {
      var box = measureCharPrepared(cm, preparedMeasure, ch);
      box.top += widgetHeight; box.bottom += widgetHeight;
      if (!boxIsAfter(box, x, y, false)) { return false }
      if (box.top <= y && box.left <= x) {
        chAround = ch;
        boxAround = box;
      }
      return true
    }, begin, end);

    var baseX, sticky, outside = false;
    // If a box around the coordinates was found, use that
    if (boxAround) {
      // Distinguish coordinates nearer to the left or right side of the box
      var atLeft = x - boxAround.left < boxAround.right - x, atStart = atLeft == ltr;
      ch = chAround + (atStart ? 0 : 1);
      sticky = atStart ? "after" : "before";
      baseX = atLeft ? boxAround.left : boxAround.right;
    } else {
      // (Adjust for extended bound, if necessary.)
      if (!ltr && (ch == end || ch == begin)) { ch++; }
      // To determine which side to associate with, get the box to the
      // left of the character and compare it's vertical position to the
      // coordinates
      sticky = ch == 0 ? "after" : ch == lineObj.text.length ? "before" :
        (measureCharPrepared(cm, preparedMeasure, ch - (ltr ? 1 : 0)).bottom + widgetHeight <= y) == ltr ?
        "after" : "before";
      // Now get accurate coordinates for this place, in order to get a
      // base X position
      var coords = cursorCoords(cm, Pos(lineNo, ch, sticky), "line", lineObj, preparedMeasure);
      baseX = coords.left;
      outside = y < coords.top ? -1 : y >= coords.bottom ? 1 : 0;
    }

    ch = skipExtendingChars(lineObj.text, ch, 1);
    return PosWithInfo(lineNo, ch, sticky, outside, x - baseX)
  }

  function coordsBidiPart(cm, lineObj, lineNo, preparedMeasure, order, x, y) {
    // Bidi parts are sorted left-to-right, and in a non-line-wrapping
    // situation, we can take this ordering to correspond to the visual
    // ordering. This finds the first part whose end is after the given
    // coordinates.
    var index = findFirst(function (i) {
      var part = order[i], ltr = part.level != 1;
      return boxIsAfter(cursorCoords(cm, Pos(lineNo, ltr ? part.to : part.from, ltr ? "before" : "after"),
                                     "line", lineObj, preparedMeasure), x, y, true)
    }, 0, order.length - 1);
    var part = order[index];
    // If this isn't the first part, the part's start is also after
    // the coordinates, and the coordinates aren't on the same line as
    // that start, move one part back.
    if (index > 0) {
      var ltr = part.level != 1;
      var start = cursorCoords(cm, Pos(lineNo, ltr ? part.from : part.to, ltr ? "after" : "before"),
                               "line", lineObj, preparedMeasure);
      if (boxIsAfter(start, x, y, true) && start.top > y)
        { part = order[index - 1]; }
    }
    return part
  }

  function coordsBidiPartWrapped(cm, lineObj, _lineNo, preparedMeasure, order, x, y) {
    // In a wrapped line, rtl text on wrapping boundaries can do things
    // that don't correspond to the ordering in our `order` array at
    // all, so a binary search doesn't work, and we want to return a
    // part that only spans one line so that the binary search in
    // coordsCharInner is safe. As such, we first find the extent of the
    // wrapped line, and then do a flat search in which we discard any
    // spans that aren't on the line.
    var ref = wrappedLineExtent(cm, lineObj, preparedMeasure, y);
    var begin = ref.begin;
    var end = ref.end;
    if (/\s/.test(lineObj.text.charAt(end - 1))) { end--; }
    var part = null, closestDist = null;
    for (var i = 0; i < order.length; i++) {
      var p = order[i];
      if (p.from >= end || p.to <= begin) { continue }
      var ltr = p.level != 1;
      var endX = measureCharPrepared(cm, preparedMeasure, ltr ? Math.min(end, p.to) - 1 : Math.max(begin, p.from)).right;
      // Weigh against spans ending before this, so that they are only
      // picked if nothing ends after
      var dist = endX < x ? x - endX + 1e9 : endX - x;
      if (!part || closestDist > dist) {
        part = p;
        closestDist = dist;
      }
    }
    if (!part) { part = order[order.length - 1]; }
    // Clip the part to the wrapped line.
    if (part.from < begin) { part = {from: begin, to: part.to, level: part.level}; }
    if (part.to > end) { part = {from: part.from, to: end, level: part.level}; }
    return part
  }

  var measureText;
  // Compute the default text height.
  function textHeight(display) {
    if (display.cachedTextHeight != null) { return display.cachedTextHeight }
    if (measureText == null) {
      measureText = elt("pre", null, "CodeMirror-line-like");
      // Measure a bunch of lines, for browsers that compute
      // fractional heights.
      for (var i = 0; i < 49; ++i) {
        measureText.appendChild(document.createTextNode("x"));
        measureText.appendChild(elt("br"));
      }
      measureText.appendChild(document.createTextNode("x"));
    }
    removeChildrenAndAdd(display.measure, measureText);
    var height = measureText.offsetHeight / 50;
    if (height > 3) { display.cachedTextHeight = height; }
    removeChildren(display.measure);
    return height || 1
  }

  // Compute the default character width.
  function charWidth(display) {
    if (display.cachedCharWidth != null) { return display.cachedCharWidth }
    var anchor = elt("span", "xxxxxxxxxx");
    var pre = elt("pre", [anchor], "CodeMirror-line-like");
    removeChildrenAndAdd(display.measure, pre);
    var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;
    if (width > 2) { display.cachedCharWidth = width; }
    return width || 10
  }

  // Do a bulk-read of the DOM positions and sizes needed to draw the
  // view, so that we don't interleave reading and writing to the DOM.
  function getDimensions(cm) {
    var d = cm.display, left = {}, width = {};
    var gutterLeft = d.gutters.clientLeft;
    for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {
      var id = cm.display.gutterSpecs[i].className;
      left[id] = n.offsetLeft + n.clientLeft + gutterLeft;
      width[id] = n.clientWidth;
    }
    return {fixedPos: compensateForHScroll(d),
            gutterTotalWidth: d.gutters.offsetWidth,
            gutterLeft: left,
            gutterWidth: width,
            wrapperWidth: d.wrapper.clientWidth}
  }

  // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,
  // but using getBoundingClientRect to get a sub-pixel-accurate
  // result.
  function compensateForHScroll(display) {
    return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left
  }

  // Returns a function that estimates the height of a line, to use as
  // first approximation until the line becomes visible (and is thus
  // properly measurable).
  function estimateHeight(cm) {
    var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;
    var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);
    return function (line) {
      if (lineIsHidden(cm.doc, line)) { return 0 }

      var widgetsHeight = 0;
      if (line.widgets) { for (var i = 0; i < line.widgets.length; i++) {
        if (line.widgets[i].height) { widgetsHeight += line.widgets[i].height; }
      } }

      if (wrapping)
        { return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th }
      else
        { return widgetsHeight + th }
    }
  }

  function estimateLineHeights(cm) {
    var doc = cm.doc, est = estimateHeight(cm);
    doc.iter(function (line) {
      var estHeight = est(line);
      if (estHeight != line.height) { updateLineHeight(line, estHeight); }
    });
  }

  // Given a mouse event, find the corresponding position. If liberal
  // is false, it checks whether a gutter or scrollbar was clicked,
  // and returns null if it was. forRect is used by rectangular
  // selections, and tries to estimate a character position even for
  // coordinates beyond the right of the text.
  function posFromMouse(cm, e, liberal, forRect) {
    var display = cm.display;
    if (!liberal && e_target(e).getAttribute("cm-not-content") == "true") { return null }

    var x, y, space = display.lineSpace.getBoundingClientRect();
    // Fails unpredictably on IE[67] when mouse is dragged around quickly.
    try { x = e.clientX - space.left; y = e.clientY - space.top; }
    catch (e$1) { return null }
    var coords = coordsChar(cm, x, y), line;
    if (forRect && coords.xRel > 0 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {
      var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;
      coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));
    }
    return coords
  }

  // Find the view element corresponding to a given line. Return null
  // when the line isn't visible.
  function findViewIndex(cm, n) {
    if (n >= cm.display.viewTo) { return null }
    n -= cm.display.viewFrom;
    if (n < 0) { return null }
    var view = cm.display.view;
    for (var i = 0; i < view.length; i++) {
      n -= view[i].size;
      if (n < 0) { return i }
    }
  }

  // Updates the display.view data structure for a given change to the
  // document. From and to are in pre-change coordinates. Lendiff is
  // the amount of lines added or subtracted by the change. This is
  // used for changes that span multiple lines, or change the way
  // lines are divided into visual lines. regLineChange (below)
  // registers single-line changes.
  function regChange(cm, from, to, lendiff) {
    if (from == null) { from = cm.doc.first; }
    if (to == null) { to = cm.doc.first + cm.doc.size; }
    if (!lendiff) { lendiff = 0; }

    var display = cm.display;
    if (lendiff && to < display.viewTo &&
        (display.updateLineNumbers == null || display.updateLineNumbers > from))
      { display.updateLineNumbers = from; }

    cm.curOp.viewChanged = true;

    if (from >= display.viewTo) { // Change after
      if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)
        { resetView(cm); }
    } else if (to <= display.viewFrom) { // Change before
      if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {
        resetView(cm);
      } else {
        display.viewFrom += lendiff;
        display.viewTo += lendiff;
      }
    } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap
      resetView(cm);
    } else if (from <= display.viewFrom) { // Top overlap
      var cut = viewCuttingPoint(cm, to, to + lendiff, 1);
      if (cut) {
        display.view = display.view.slice(cut.index);
        display.viewFrom = cut.lineN;
        display.viewTo += lendiff;
      } else {
        resetView(cm);
      }
    } else if (to >= display.viewTo) { // Bottom overlap
      var cut$1 = viewCuttingPoint(cm, from, from, -1);
      if (cut$1) {
        display.view = display.view.slice(0, cut$1.index);
        display.viewTo = cut$1.lineN;
      } else {
        resetView(cm);
      }
    } else { // Gap in the middle
      var cutTop = viewCuttingPoint(cm, from, from, -1);
      var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);
      if (cutTop && cutBot) {
        display.view = display.view.slice(0, cutTop.index)
          .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))
          .concat(display.view.slice(cutBot.index));
        display.viewTo += lendiff;
      } else {
        resetView(cm);
      }
    }

    var ext = display.externalMeasured;
    if (ext) {
      if (to < ext.lineN)
        { ext.lineN += lendiff; }
      else if (from < ext.lineN + ext.size)
        { display.externalMeasured = null; }
    }
  }

  // Register a change to a single line. Type must be one of "text",
  // "gutter", "class", "widget"
  function regLineChange(cm, line, type) {
    cm.curOp.viewChanged = true;
    var display = cm.display, ext = cm.display.externalMeasured;
    if (ext && line >= ext.lineN && line < ext.lineN + ext.size)
      { display.externalMeasured = null; }

    if (line < display.viewFrom || line >= display.viewTo) { return }
    var lineView = display.view[findViewIndex(cm, line)];
    if (lineView.node == null) { return }
    var arr = lineView.changes || (lineView.changes = []);
    if (indexOf(arr, type) == -1) { arr.push(type); }
  }

  // Clear the view.
  function resetView(cm) {
    cm.display.viewFrom = cm.display.viewTo = cm.doc.first;
    cm.display.view = [];
    cm.display.viewOffset = 0;
  }

  function viewCuttingPoint(cm, oldN, newN, dir) {
    var index = findViewIndex(cm, oldN), diff, view = cm.display.view;
    if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)
      { return {index: index, lineN: newN} }
    var n = cm.display.viewFrom;
    for (var i = 0; i < index; i++)
      { n += view[i].size; }
    if (n != oldN) {
      if (dir > 0) {
        if (index == view.length - 1) { return null }
        diff = (n + view[index].size) - oldN;
        index++;
      } else {
        diff = n - oldN;
      }
      oldN += diff; newN += diff;
    }
    while (visualLineNo(cm.doc, newN) != newN) {
      if (index == (dir < 0 ? 0 : view.length - 1)) { return null }
      newN += dir * view[index - (dir < 0 ? 1 : 0)].size;
      index += dir;
    }
    return {index: index, lineN: newN}
  }

  // Force the view to cover a given range, adding empty view element
  // or clipping off existing ones as needed.
  function adjustView(cm, from, to) {
    var display = cm.display, view = display.view;
    if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {
      display.view = buildViewArray(cm, from, to);
      display.viewFrom = from;
    } else {
      if (display.viewFrom > from)
        { display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view); }
      else if (display.viewFrom < from)
        { display.view = display.view.slice(findViewIndex(cm, from)); }
      display.viewFrom = from;
      if (display.viewTo < to)
        { display.view = display.view.concat(buildViewArray(cm, display.viewTo, to)); }
      else if (display.viewTo > to)
        { display.view = display.view.slice(0, findViewIndex(cm, to)); }
    }
    display.viewTo = to;
  }

  // Count the number of lines in the view whose DOM representation is
  // out of date (or nonexistent).
  function countDirtyView(cm) {
    var view = cm.display.view, dirty = 0;
    for (var i = 0; i < view.length; i++) {
      var lineView = view[i];
      if (!lineView.hidden && (!lineView.node || lineView.changes)) { ++dirty; }
    }
    return dirty
  }

  function updateSelection(cm) {
    cm.display.input.showSelection(cm.display.input.prepareSelection());
  }

  function prepareSelection(cm, primary) {
    if ( primary === void 0 ) primary = true;

    var doc = cm.doc, result = {};
    var curFragment = result.cursors = document.createDocumentFragment();
    var selFragment = result.selection = document.createDocumentFragment();

    for (var i = 0; i < doc.sel.ranges.length; i++) {
      if (!primary && i == doc.sel.primIndex) { continue }
      var range = doc.sel.ranges[i];
      if (range.from().line >= cm.display.viewTo || range.to().line < cm.display.viewFrom) { continue }
      var collapsed = range.empty();
      if (collapsed || cm.options.showCursorWhenSelecting)
        { drawSelectionCursor(cm, range.head, curFragment); }
      if (!collapsed)
        { drawSelectionRange(cm, range, selFragment); }
    }
    return result
  }

  // Draws a cursor for the given range
  function drawSelectionCursor(cm, head, output) {
    var pos = cursorCoords(cm, head, "div", null, null, !cm.options.singleCursorHeightPerLine);

    var cursor = output.appendChild(elt("div", "\u00a0", "CodeMirror-cursor"));
    cursor.style.left = pos.left + "px";
    cursor.style.top = pos.top + "px";
    cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + "px";

    if (/\bcm-fat-cursor\b/.test(cm.getWrapperElement().className)) {
      var charPos = charCoords(cm, head, "div", null, null);
      cursor.style.width = Math.max(0, charPos.right - charPos.left) + "px";
    }

    if (pos.other) {
      // Secondary cursor, shown when on a 'jump' in bi-directional text
      var otherCursor = output.appendChild(elt("div", "\u00a0", "CodeMirror-cursor CodeMirror-secondarycursor"));
      otherCursor.style.display = "";
      otherCursor.style.left = pos.other.left + "px";
      otherCursor.style.top = pos.other.top + "px";
      otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + "px";
    }
  }

  function cmpCoords(a, b) { return a.top - b.top || a.left - b.left }

  // Draws the given range as a highlighted selection
  function drawSelectionRange(cm, range, output) {
    var display = cm.display, doc = cm.doc;
    var fragment = document.createDocumentFragment();
    var padding = paddingH(cm.display), leftSide = padding.left;
    var rightSide = Math.max(display.sizerWidth, displayWidth(cm) - display.sizer.offsetLeft) - padding.right;
    var docLTR = doc.direction == "ltr";

    function add(left, top, width, bottom) {
      if (top < 0) { top = 0; }
      top = Math.round(top);
      bottom = Math.round(bottom);
      fragment.appendChild(elt("div", null, "CodeMirror-selected", ("position: absolute; left: " + left + "px;\n                             top: " + top + "px; width: " + (width == null ? rightSide - left : width) + "px;\n                             height: " + (bottom - top) + "px")));
    }

    function drawForLine(line, fromArg, toArg) {
      var lineObj = getLine(doc, line);
      var lineLen = lineObj.text.length;
      var start, end;
      function coords(ch, bias) {
        return charCoords(cm, Pos(line, ch), "div", lineObj, bias)
      }

      function wrapX(pos, dir, side) {
        var extent = wrappedLineExtentChar(cm, lineObj, null, pos);
        var prop = (dir == "ltr") == (side == "after") ? "left" : "right";
        var ch = side == "after" ? extent.begin : extent.end - (/\s/.test(lineObj.text.charAt(extent.end - 1)) ? 2 : 1);
        return coords(ch, prop)[prop]
      }

      var order = getOrder(lineObj, doc.direction);
      iterateBidiSections(order, fromArg || 0, toArg == null ? lineLen : toArg, function (from, to, dir, i) {
        var ltr = dir == "ltr";
        var fromPos = coords(from, ltr ? "left" : "right");
        var toPos = coords(to - 1, ltr ? "right" : "left");

        var openStart = fromArg == null && from == 0, openEnd = toArg == null && to == lineLen;
        var first = i == 0, last = !order || i == order.length - 1;
        if (toPos.top - fromPos.top <= 3) { // Single line
          var openLeft = (docLTR ? openStart : openEnd) && first;
          var openRight = (docLTR ? openEnd : openStart) && last;
          var left = openLeft ? leftSide : (ltr ? fromPos : toPos).left;
          var right = openRight ? rightSide : (ltr ? toPos : fromPos).right;
          add(left, fromPos.top, right - left, fromPos.bottom);
        } else { // Multiple lines
          var topLeft, topRight, botLeft, botRight;
          if (ltr) {
            topLeft = docLTR && openStart && first ? leftSide : fromPos.left;
            topRight = docLTR ? rightSide : wrapX(from, dir, "before");
            botLeft = docLTR ? leftSide : wrapX(to, dir, "after");
            botRight = docLTR && openEnd && last ? rightSide : toPos.right;
          } else {
            topLeft = !docLTR ? leftSide : wrapX(from, dir, "before");
            topRight = !docLTR && openStart && first ? rightSide : fromPos.right;
            botLeft = !docLTR && openEnd && last ? leftSide : toPos.left;
            botRight = !docLTR ? rightSide : wrapX(to, dir, "after");
          }
          add(topLeft, fromPos.top, topRight - topLeft, fromPos.bottom);
          if (fromPos.bottom < toPos.top) { add(leftSide, fromPos.bottom, null, toPos.top); }
          add(botLeft, toPos.top, botRight - botLeft, toPos.bottom);
        }

        if (!start || cmpCoords(fromPos, start) < 0) { start = fromPos; }
        if (cmpCoords(toPos, start) < 0) { start = toPos; }
        if (!end || cmpCoords(fromPos, end) < 0) { end = fromPos; }
        if (cmpCoords(toPos, end) < 0) { end = toPos; }
      });
      return {start: start, end: end}
    }

    var sFrom = range.from(), sTo = range.to();
    if (sFrom.line == sTo.line) {
      drawForLine(sFrom.line, sFrom.ch, sTo.ch);
    } else {
      var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);
      var singleVLine = visualLine(fromLine) == visualLine(toLine);
      var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;
      var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;
      if (singleVLine) {
        if (leftEnd.top < rightStart.top - 2) {
          add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);
          add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);
        } else {
          add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);
        }
      }
      if (leftEnd.bottom < rightStart.top)
        { add(leftSide, leftEnd.bottom, null, rightStart.top); }
    }

    output.appendChild(fragment);
  }

  // Cursor-blinking
  function restartBlink(cm) {
    if (!cm.state.focused) { return }
    var display = cm.display;
    clearInterval(display.blinker);
    var on = true;
    display.cursorDiv.style.visibility = "";
    if (cm.options.cursorBlinkRate > 0)
      { display.blinker = setInterval(function () {
        if (!cm.hasFocus()) { onBlur(cm); }
        display.cursorDiv.style.visibility = (on = !on) ? "" : "hidden";
      }, cm.options.cursorBlinkRate); }
    else if (cm.options.cursorBlinkRate < 0)
      { display.cursorDiv.style.visibility = "hidden"; }
  }

  function ensureFocus(cm) {
    if (!cm.hasFocus()) {
      cm.display.input.focus();
      if (!cm.state.focused) { onFocus(cm); }
    }
  }

  function delayBlurEvent(cm) {
    cm.state.delayingBlurEvent = true;
    setTimeout(function () { if (cm.state.delayingBlurEvent) {
      cm.state.delayingBlurEvent = false;
      if (cm.state.focused) { onBlur(cm); }
    } }, 100);
  }

  function onFocus(cm, e) {
    if (cm.state.delayingBlurEvent && !cm.state.draggingText) { cm.state.delayingBlurEvent = false; }

    if (cm.options.readOnly == "nocursor") { return }
    if (!cm.state.focused) {
      signal(cm, "focus", cm, e);
      cm.state.focused = true;
      addClass(cm.display.wrapper, "CodeMirror-focused");
      // This test prevents this from firing when a context
      // menu is closed (since the input reset would kill the
      // select-all detection hack)
      if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {
        cm.display.input.reset();
        if (webkit) { setTimeout(function () { return cm.display.input.reset(true); }, 20); } // Issue #1730
      }
      cm.display.input.receivedFocus();
    }
    restartBlink(cm);
  }
  function onBlur(cm, e) {
    if (cm.state.delayingBlurEvent) { return }

    if (cm.state.focused) {
      signal(cm, "blur", cm, e);
      cm.state.focused = false;
      rmClass(cm.display.wrapper, "CodeMirror-focused");
    }
    clearInterval(cm.display.blinker);
    setTimeout(function () { if (!cm.state.focused) { cm.display.shift = false; } }, 150);
  }

  // Read the actual heights of the rendered lines, and update their
  // stored heights to match.
  function updateHeightsInViewport(cm) {
    var display = cm.display;
    var prevBottom = display.lineDiv.offsetTop;
    for (var i = 0; i < display.view.length; i++) {
      var cur = display.view[i], wrapping = cm.options.lineWrapping;
      var height = (void 0), width = 0;
      if (cur.hidden) { continue }
      if (ie && ie_version < 8) {
        var bot = cur.node.offsetTop + cur.node.offsetHeight;
        height = bot - prevBottom;
        prevBottom = bot;
      } else {
        var box = cur.node.getBoundingClientRect();
        height = box.bottom - box.top;
        // Check that lines don't extend past the right of the current
        // editor width
        if (!wrapping && cur.text.firstChild)
          { width = cur.text.firstChild.getBoundingClientRect().right - box.left - 1; }
      }
      var diff = cur.line.height - height;
      if (diff > .005 || diff < -.005) {
        updateLineHeight(cur.line, height);
        updateWidgetHeight(cur.line);
        if (cur.rest) { for (var j = 0; j < cur.rest.length; j++)
          { updateWidgetHeight(cur.rest[j]); } }
      }
      if (width > cm.display.sizerWidth) {
        var chWidth = Math.ceil(width / charWidth(cm.display));
        if (chWidth > cm.display.maxLineLength) {
          cm.display.maxLineLength = chWidth;
          cm.display.maxLine = cur.line;
          cm.display.maxLineChanged = true;
        }
      }
    }
  }

  // Read and store the height of line widgets associated with the
  // given line.
  function updateWidgetHeight(line) {
    if (line.widgets) { for (var i = 0; i < line.widgets.length; ++i) {
      var w = line.widgets[i], parent = w.node.parentNode;
      if (parent) { w.height = parent.offsetHeight; }
    } }
  }

  // Compute the lines that are visible in a given viewport (defaults
  // the the current scroll position). viewport may contain top,
  // height, and ensure (see op.scrollToPos) properties.
  function visibleLines(display, doc, viewport) {
    var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;
    top = Math.floor(top - paddingTop(display));
    var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;

    var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);
    // Ensure is a {from: {line, ch}, to: {line, ch}} object, and
    // forces those lines into the viewport (if possible).
    if (viewport && viewport.ensure) {
      var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;
      if (ensureFrom < from) {
        from = ensureFrom;
        to = lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight);
      } else if (Math.min(ensureTo, doc.lastLine()) >= to) {
        from = lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight);
        to = ensureTo;
      }
    }
    return {from: from, to: Math.max(to, from + 1)}
  }

  // SCROLLING THINGS INTO VIEW

  // If an editor sits on the top or bottom of the window, partially
  // scrolled out of view, this ensures that the cursor is visible.
  function maybeScrollWindow(cm, rect) {
    if (signalDOMEvent(cm, "scrollCursorIntoView")) { return }

    var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;
    if (rect.top + box.top < 0) { doScroll = true; }
    else if (rect.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) { doScroll = false; }
    if (doScroll != null && !phantom) {
      var scrollNode = elt("div", "\u200b", null, ("position: absolute;\n                         top: " + (rect.top - display.viewOffset - paddingTop(cm.display)) + "px;\n                         height: " + (rect.bottom - rect.top + scrollGap(cm) + display.barHeight) + "px;\n                         left: " + (rect.left) + "px; width: " + (Math.max(2, rect.right - rect.left)) + "px;"));
      cm.display.lineSpace.appendChild(scrollNode);
      scrollNode.scrollIntoView(doScroll);
      cm.display.lineSpace.removeChild(scrollNode);
    }
  }

  // Scroll a given position into view (immediately), verifying that
  // it actually became visible (as line heights are accurately
  // measured, the position of something may 'drift' during drawing).
  function scrollPosIntoView(cm, pos, end, margin) {
    if (margin == null) { margin = 0; }
    var rect;
    if (!cm.options.lineWrapping && pos == end) {
      // Set pos and end to the cursor positions around the character pos sticks to
      // If pos.sticky == "before", that is around pos.ch - 1, otherwise around pos.ch
      // If pos == Pos(_, 0, "before"), pos and end are unchanged
      end = pos.sticky == "before" ? Pos(pos.line, pos.ch + 1, "before") : pos;
      pos = pos.ch ? Pos(pos.line, pos.sticky == "before" ? pos.ch - 1 : pos.ch, "after") : pos;
    }
    for (var limit = 0; limit < 5; limit++) {
      var changed = false;
      var coords = cursorCoords(cm, pos);
      var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);
      rect = {left: Math.min(coords.left, endCoords.left),
              top: Math.min(coords.top, endCoords.top) - margin,
              right: Math.max(coords.left, endCoords.left),
              bottom: Math.max(coords.bottom, endCoords.bottom) + margin};
      var scrollPos = calculateScrollPos(cm, rect);
      var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;
      if (scrollPos.scrollTop != null) {
        updateScrollTop(cm, scrollPos.scrollTop);
        if (Math.abs(cm.doc.scrollTop - startTop) > 1) { changed = true; }
      }
      if (scrollPos.scrollLeft != null) {
        setScrollLeft(cm, scrollPos.scrollLeft);
        if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) { changed = true; }
      }
      if (!changed) { break }
    }
    return rect
  }

  // Scroll a given set of coordinates into view (immediately).
  function scrollIntoView(cm, rect) {
    var scrollPos = calculateScrollPos(cm, rect);
    if (scrollPos.scrollTop != null) { updateScrollTop(cm, scrollPos.scrollTop); }
    if (scrollPos.scrollLeft != null) { setScrollLeft(cm, scrollPos.scrollLeft); }
  }

  // Calculate a new scroll position needed to scroll the given
  // rectangle into view. Returns an object with scrollTop and
  // scrollLeft properties. When these are undefined, the
  // vertical/horizontal position does not need to be adjusted.
  function calculateScrollPos(cm, rect) {
    var display = cm.display, snapMargin = textHeight(cm.display);
    if (rect.top < 0) { rect.top = 0; }
    var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;
    var screen = displayHeight(cm), result = {};
    if (rect.bottom - rect.top > screen) { rect.bottom = rect.top + screen; }
    var docBottom = cm.doc.height + paddingVert(display);
    var atTop = rect.top < snapMargin, atBottom = rect.bottom > docBottom - snapMargin;
    if (rect.top < screentop) {
      result.scrollTop = atTop ? 0 : rect.top;
    } else if (rect.bottom > screentop + screen) {
      var newTop = Math.min(rect.top, (atBottom ? docBottom : rect.bottom) - screen);
      if (newTop != screentop) { result.scrollTop = newTop; }
    }

    var gutterSpace = cm.options.fixedGutter ? 0 : display.gutters.offsetWidth;
    var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft - gutterSpace;
    var screenw = displayWidth(cm) - display.gutters.offsetWidth;
    var tooWide = rect.right - rect.left > screenw;
    if (tooWide) { rect.right = rect.left + screenw; }
    if (rect.left < 10)
      { result.scrollLeft = 0; }
    else if (rect.left < screenleft)
      { result.scrollLeft = Math.max(0, rect.left + gutterSpace - (tooWide ? 0 : 10)); }
    else if (rect.right > screenw + screenleft - 3)
      { result.scrollLeft = rect.right + (tooWide ? 0 : 10) - screenw; }
    return result
  }

  // Store a relative adjustment to the scroll position in the current
  // operation (to be applied when the operation finishes).
  function addToScrollTop(cm, top) {
    if (top == null) { return }
    resolveScrollToPos(cm);
    cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;
  }

  // Make sure that at the end of the operation the current cursor is
  // shown.
  function ensureCursorVisible(cm) {
    resolveScrollToPos(cm);
    var cur = cm.getCursor();
    cm.curOp.scrollToPos = {from: cur, to: cur, margin: cm.options.cursorScrollMargin};
  }

  function scrollToCoords(cm, x, y) {
    if (x != null || y != null) { resolveScrollToPos(cm); }
    if (x != null) { cm.curOp.scrollLeft = x; }
    if (y != null) { cm.curOp.scrollTop = y; }
  }

  function scrollToRange(cm, range) {
    resolveScrollToPos(cm);
    cm.curOp.scrollToPos = range;
  }

  // When an operation has its scrollToPos property set, and another
  // scroll action is applied before the end of the operation, this
  // 'simulates' scrolling that position into view in a cheap way, so
  // that the effect of intermediate scroll commands is not ignored.
  function resolveScrollToPos(cm) {
    var range = cm.curOp.scrollToPos;
    if (range) {
      cm.curOp.scrollToPos = null;
      var from = estimateCoords(cm, range.from), to = estimateCoords(cm, range.to);
      scrollToCoordsRange(cm, from, to, range.margin);
    }
  }

  function scrollToCoordsRange(cm, from, to, margin) {
    var sPos = calculateScrollPos(cm, {
      left: Math.min(from.left, to.left),
      top: Math.min(from.top, to.top) - margin,
      right: Math.max(from.right, to.right),
      bottom: Math.max(from.bottom, to.bottom) + margin
    });
    scrollToCoords(cm, sPos.scrollLeft, sPos.scrollTop);
  }

  // Sync the scrollable area and scrollbars, ensure the viewport
  // covers the visible area.
  function updateScrollTop(cm, val) {
    if (Math.abs(cm.doc.scrollTop - val) < 2) { return }
    if (!gecko) { updateDisplaySimple(cm, {top: val}); }
    setScrollTop(cm, val, true);
    if (gecko) { updateDisplaySimple(cm); }
    startWorker(cm, 100);
  }

  function setScrollTop(cm, val, forceScroll) {
    val = Math.max(0, Math.min(cm.display.scroller.scrollHeight - cm.display.scroller.clientHeight, val));
    if (cm.display.scroller.scrollTop == val && !forceScroll) { return }
    cm.doc.scrollTop = val;
    cm.display.scrollbars.setScrollTop(val);
    if (cm.display.scroller.scrollTop != val) { cm.display.scroller.scrollTop = val; }
  }

  // Sync scroller and scrollbar, ensure the gutter elements are
  // aligned.
  function setScrollLeft(cm, val, isScroller, forceScroll) {
    val = Math.max(0, Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth));
    if ((isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) && !forceScroll) { return }
    cm.doc.scrollLeft = val;
    alignHorizontally(cm);
    if (cm.display.scroller.scrollLeft != val) { cm.display.scroller.scrollLeft = val; }
    cm.display.scrollbars.setScrollLeft(val);
  }

  // SCROLLBARS

  // Prepare DOM reads needed to update the scrollbars. Done in one
  // shot to minimize update/measure roundtrips.
  function measureForScrollbars(cm) {
    var d = cm.display, gutterW = d.gutters.offsetWidth;
    var docH = Math.round(cm.doc.height + paddingVert(cm.display));
    return {
      clientHeight: d.scroller.clientHeight,
      viewHeight: d.wrapper.clientHeight,
      scrollWidth: d.scroller.scrollWidth, clientWidth: d.scroller.clientWidth,
      viewWidth: d.wrapper.clientWidth,
      barLeft: cm.options.fixedGutter ? gutterW : 0,
      docHeight: docH,
      scrollHeight: docH + scrollGap(cm) + d.barHeight,
      nativeBarWidth: d.nativeBarWidth,
      gutterWidth: gutterW
    }
  }

  var NativeScrollbars = function(place, scroll, cm) {
    this.cm = cm;
    var vert = this.vert = elt("div", [elt("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar");
    var horiz = this.horiz = elt("div", [elt("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
    vert.tabIndex = horiz.tabIndex = -1;
    place(vert); place(horiz);

    on(vert, "scroll", function () {
      if (vert.clientHeight) { scroll(vert.scrollTop, "vertical"); }
    });
    on(horiz, "scroll", function () {
      if (horiz.clientWidth) { scroll(horiz.scrollLeft, "horizontal"); }
    });

    this.checkedZeroWidth = false;
    // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).
    if (ie && ie_version < 8) { this.horiz.style.minHeight = this.vert.style.minWidth = "18px"; }
  };

  NativeScrollbars.prototype.update = function (measure) {
    var needsH = measure.scrollWidth > measure.clientWidth + 1;
    var needsV = measure.scrollHeight > measure.clientHeight + 1;
    var sWidth = measure.nativeBarWidth;

    if (needsV) {
      this.vert.style.display = "block";
      this.vert.style.bottom = needsH ? sWidth + "px" : "0";
      var totalHeight = measure.viewHeight - (needsH ? sWidth : 0);
      // A bug in IE8 can cause this value to be negative, so guard it.
      this.vert.firstChild.style.height =
        Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + "px";
    } else {
      this.vert.style.display = "";
      this.vert.firstChild.style.height = "0";
    }

    if (needsH) {
      this.horiz.style.display = "block";
      this.horiz.style.right = needsV ? sWidth + "px" : "0";
      this.horiz.style.left = measure.barLeft + "px";
      var totalWidth = measure.viewWidth - measure.barLeft - (needsV ? sWidth : 0);
      this.horiz.firstChild.style.width =
        Math.max(0, measure.scrollWidth - measure.clientWidth + totalWidth) + "px";
    } else {
      this.horiz.style.display = "";
      this.horiz.firstChild.style.width = "0";
    }

    if (!this.checkedZeroWidth && measure.clientHeight > 0) {
      if (sWidth == 0) { this.zeroWidthHack(); }
      this.checkedZeroWidth = true;
    }

    return {right: needsV ? sWidth : 0, bottom: needsH ? sWidth : 0}
  };

  NativeScrollbars.prototype.setScrollLeft = function (pos) {
    if (this.horiz.scrollLeft != pos) { this.horiz.scrollLeft = pos; }
    if (this.disableHoriz) { this.enableZeroWidthBar(this.horiz, this.disableHoriz, "horiz"); }
  };

  NativeScrollbars.prototype.setScrollTop = function (pos) {
    if (this.vert.scrollTop != pos) { this.vert.scrollTop = pos; }
    if (this.disableVert) { this.enableZeroWidthBar(this.vert, this.disableVert, "vert"); }
  };

  NativeScrollbars.prototype.zeroWidthHack = function () {
    var w = mac && !mac_geMountainLion ? "12px" : "18px";
    this.horiz.style.height = this.vert.style.width = w;
    this.horiz.style.pointerEvents = this.vert.style.pointerEvents = "none";
    this.disableHoriz = new Delayed;
    this.disableVert = new Delayed;
  };

  NativeScrollbars.prototype.enableZeroWidthBar = function (bar, delay, type) {
    bar.style.pointerEvents = "auto";
    function maybeDisable() {
      // To find out whether the scrollbar is still visible, we
      // check whether the element under the pixel in the bottom
      // right corner of the scrollbar box is the scrollbar box
      // itself (when the bar is still visible) or its filler child
      // (when the bar is hidden). If it is still visible, we keep
      // it enabled, if it's hidden, we disable pointer events.
      var box = bar.getBoundingClientRect();
      var elt = type == "vert" ? document.elementFromPoint(box.right - 1, (box.top + box.bottom) / 2)
          : document.elementFromPoint((box.right + box.left) / 2, box.bottom - 1);
      if (elt != bar) { bar.style.pointerEvents = "none"; }
      else { delay.set(1000, maybeDisable); }
    }
    delay.set(1000, maybeDisable);
  };

  NativeScrollbars.prototype.clear = function () {
    var parent = this.horiz.parentNode;
    parent.removeChild(this.horiz);
    parent.removeChild(this.vert);
  };

  var NullScrollbars = function () {};

  NullScrollbars.prototype.update = function () { return {bottom: 0, right: 0} };
  NullScrollbars.prototype.setScrollLeft = function () {};
  NullScrollbars.prototype.setScrollTop = function () {};
  NullScrollbars.prototype.clear = function () {};

  function updateScrollbars(cm, measure) {
    if (!measure) { measure = measureForScrollbars(cm); }
    var startWidth = cm.display.barWidth, startHeight = cm.display.barHeight;
    updateScrollbarsInner(cm, measure);
    for (var i = 0; i < 4 && startWidth != cm.display.barWidth || startHeight != cm.display.barHeight; i++) {
      if (startWidth != cm.display.barWidth && cm.options.lineWrapping)
        { updateHeightsInViewport(cm); }
      updateScrollbarsInner(cm, measureForScrollbars(cm));
      startWidth = cm.display.barWidth; startHeight = cm.display.barHeight;
    }
  }

  // Re-synchronize the fake scrollbars with the actual size of the
  // content.
  function updateScrollbarsInner(cm, measure) {
    var d = cm.display;
    var sizes = d.scrollbars.update(measure);

    d.sizer.style.paddingRight = (d.barWidth = sizes.right) + "px";
    d.sizer.style.paddingBottom = (d.barHeight = sizes.bottom) + "px";
    d.heightForcer.style.borderBottom = sizes.bottom + "px solid transparent";

    if (sizes.right && sizes.bottom) {
      d.scrollbarFiller.style.display = "block";
      d.scrollbarFiller.style.height = sizes.bottom + "px";
      d.scrollbarFiller.style.width = sizes.right + "px";
    } else { d.scrollbarFiller.style.display = ""; }
    if (sizes.bottom && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {
      d.gutterFiller.style.display = "block";
      d.gutterFiller.style.height = sizes.bottom + "px";
      d.gutterFiller.style.width = measure.gutterWidth + "px";
    } else { d.gutterFiller.style.display = ""; }
  }

  var scrollbarModel = {"native": NativeScrollbars, "null": NullScrollbars};

  function initScrollbars(cm) {
    if (cm.display.scrollbars) {
      cm.display.scrollbars.clear();
      if (cm.display.scrollbars.addClass)
        { rmClass(cm.display.wrapper, cm.display.scrollbars.addClass); }
    }

    cm.display.scrollbars = new scrollbarModel[cm.options.scrollbarStyle](function (node) {
      cm.display.wrapper.insertBefore(node, cm.display.scrollbarFiller);
      // Prevent clicks in the scrollbars from killing focus
      on(node, "mousedown", function () {
        if (cm.state.focused) { setTimeout(function () { return cm.display.input.focus(); }, 0); }
      });
      node.setAttribute("cm-not-content", "true");
    }, function (pos, axis) {
      if (axis == "horizontal") { setScrollLeft(cm, pos); }
      else { updateScrollTop(cm, pos); }
    }, cm);
    if (cm.display.scrollbars.addClass)
      { addClass(cm.display.wrapper, cm.display.scrollbars.addClass); }
  }

  // Operations are used to wrap a series of changes to the editor
  // state in such a way that each change won't have to update the
  // cursor and display (which would be awkward, slow, and
  // error-prone). Instead, display updates are batched and then all
  // combined and executed at once.

  var nextOpId = 0;
  // Start a new operation.
  function startOperation(cm) {
    cm.curOp = {
      cm: cm,
      viewChanged: false,      // Flag that indicates that lines might need to be redrawn
      startHeight: cm.doc.height, // Used to detect need to update scrollbar
      forceUpdate: false,      // Used to force a redraw
      updateInput: 0,       // Whether to reset the input textarea
      typing: false,           // Whether this reset should be careful to leave existing text (for compositing)
      changeObjs: null,        // Accumulated changes, for firing change events
      cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on
      cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already
      selectionChanged: false, // Whether the selection needs to be redrawn
      updateMaxLine: false,    // Set when the widest line needs to be determined anew
      scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet
      scrollToPos: null,       // Used to scroll to a specific position
      focus: false,
      id: ++nextOpId,          // Unique ID
      markArrays: null         // Used by addMarkedSpan
    };
    pushOperation(cm.curOp);
  }

  // Finish an operation, updating the display and signalling delayed events
  function endOperation(cm) {
    var op = cm.curOp;
    if (op) { finishOperation(op, function (group) {
      for (var i = 0; i < group.ops.length; i++)
        { group.ops[i].cm.curOp = null; }
      endOperations(group);
    }); }
  }

  // The DOM updates done when an operation finishes are batched so
  // that the minimum number of relayouts are required.
  function endOperations(group) {
    var ops = group.ops;
    for (var i = 0; i < ops.length; i++) // Read DOM
      { endOperation_R1(ops[i]); }
    for (var i$1 = 0; i$1 < ops.length; i$1++) // Write DOM (maybe)
      { endOperation_W1(ops[i$1]); }
    for (var i$2 = 0; i$2 < ops.length; i$2++) // Read DOM
      { endOperation_R2(ops[i$2]); }
    for (var i$3 = 0; i$3 < ops.length; i$3++) // Write DOM (maybe)
      { endOperation_W2(ops[i$3]); }
    for (var i$4 = 0; i$4 < ops.length; i$4++) // Read DOM
      { endOperation_finish(ops[i$4]); }
  }

  function endOperation_R1(op) {
    var cm = op.cm, display = cm.display;
    maybeClipScrollbars(cm);
    if (op.updateMaxLine) { findMaxLine(cm); }

    op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||
      op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||
                         op.scrollToPos.to.line >= display.viewTo) ||
      display.maxLineChanged && cm.options.lineWrapping;
    op.update = op.mustUpdate &&
      new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);
  }

  function endOperation_W1(op) {
    op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);
  }

  function endOperation_R2(op) {
    var cm = op.cm, display = cm.display;
    if (op.updatedDisplay) { updateHeightsInViewport(cm); }

    op.barMeasure = measureForScrollbars(cm);

    // If the max line changed since it was last measured, measure it,
    // and ensure the document's width matches it.
    // updateDisplay_W2 will use these properties to do the actual resizing
    if (display.maxLineChanged && !cm.options.lineWrapping) {
      op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;
      cm.display.sizerWidth = op.adjustWidthTo;
      op.barMeasure.scrollWidth =
        Math.max(display.scroller.clientWidth, display.sizer.offsetLeft + op.adjustWidthTo + scrollGap(cm) + cm.display.barWidth);
      op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo - displayWidth(cm));
    }

    if (op.updatedDisplay || op.selectionChanged)
      { op.preparedSelection = display.input.prepareSelection(); }
  }

  function endOperation_W2(op) {
    var cm = op.cm;

    if (op.adjustWidthTo != null) {
      cm.display.sizer.style.minWidth = op.adjustWidthTo + "px";
      if (op.maxScrollLeft < cm.doc.scrollLeft)
        { setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true); }
      cm.display.maxLineChanged = false;
    }

    var takeFocus = op.focus && op.focus == activeElt();
    if (op.preparedSelection)
      { cm.display.input.showSelection(op.preparedSelection, takeFocus); }
    if (op.updatedDisplay || op.startHeight != cm.doc.height)
      { updateScrollbars(cm, op.barMeasure); }
    if (op.updatedDisplay)
      { setDocumentHeight(cm, op.barMeasure); }

    if (op.selectionChanged) { restartBlink(cm); }

    if (cm.state.focused && op.updateInput)
      { cm.display.input.reset(op.typing); }
    if (takeFocus) { ensureFocus(op.cm); }
  }

  function endOperation_finish(op) {
    var cm = op.cm, display = cm.display, doc = cm.doc;

    if (op.updatedDisplay) { postUpdateDisplay(cm, op.update); }

    // Abort mouse wheel delta measurement, when scrolling explicitly
    if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))
      { display.wheelStartX = display.wheelStartY = null; }

    // Propagate the scroll position to the actual DOM scroller
    if (op.scrollTop != null) { setScrollTop(cm, op.scrollTop, op.forceScroll); }

    if (op.scrollLeft != null) { setScrollLeft(cm, op.scrollLeft, true, true); }
    // If we need to scroll a specific position into view, do so.
    if (op.scrollToPos) {
      var rect = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),
                                   clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);
      maybeScrollWindow(cm, rect);
    }

    // Fire events for markers that are hidden/unidden by editing or
    // undoing
    var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;
    if (hidden) { for (var i = 0; i < hidden.length; ++i)
      { if (!hidden[i].lines.length) { signal(hidden[i], "hide"); } } }
    if (unhidden) { for (var i$1 = 0; i$1 < unhidden.length; ++i$1)
      { if (unhidden[i$1].lines.length) { signal(unhidden[i$1], "unhide"); } } }

    if (display.wrapper.offsetHeight)
      { doc.scrollTop = cm.display.scroller.scrollTop; }

    // Fire change events, and delayed event handlers
    if (op.changeObjs)
      { signal(cm, "changes", cm, op.changeObjs); }
    if (op.update)
      { op.update.finish(); }
  }

  // Run the given function in an operation
  function runInOp(cm, f) {
    if (cm.curOp) { return f() }
    startOperation(cm);
    try { return f() }
    finally { endOperation(cm); }
  }
  // Wraps a function in an operation. Returns the wrapped function.
  function operation(cm, f) {
    return function() {
      if (cm.curOp) { return f.apply(cm, arguments) }
      startOperation(cm);
      try { return f.apply(cm, arguments) }
      finally { endOperation(cm); }
    }
  }
  // Used to add methods to editor and doc instances, wrapping them in
  // operations.
  function methodOp(f) {
    return function() {
      if (this.curOp) { return f.apply(this, arguments) }
      startOperation(this);
      try { return f.apply(this, arguments) }
      finally { endOperation(this); }
    }
  }
  function docMethodOp(f) {
    return function() {
      var cm = this.cm;
      if (!cm || cm.curOp) { return f.apply(this, arguments) }
      startOperation(cm);
      try { return f.apply(this, arguments) }
      finally { endOperation(cm); }
    }
  }

  // HIGHLIGHT WORKER

  function startWorker(cm, time) {
    if (cm.doc.highlightFrontier < cm.display.viewTo)
      { cm.state.highlight.set(time, bind(highlightWorker, cm)); }
  }

  function highlightWorker(cm) {
    var doc = cm.doc;
    if (doc.highlightFrontier >= cm.display.viewTo) { return }
    var end = +new Date + cm.options.workTime;
    var context = getContextBefore(cm, doc.highlightFrontier);
    var changedLines = [];

    doc.iter(context.line, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function (line) {
      if (context.line >= cm.display.viewFrom) { // Visible
        var oldStyles = line.styles;
        var resetState = line.text.length > cm.options.maxHighlightLength ? copyState(doc.mode, context.state) : null;
        var highlighted = highlightLine(cm, line, context, true);
        if (resetState) { context.state = resetState; }
        line.styles = highlighted.styles;
        var oldCls = line.styleClasses, newCls = highlighted.classes;
        if (newCls) { line.styleClasses = newCls; }
        else if (oldCls) { line.styleClasses = null; }
        var ischange = !oldStyles || oldStyles.length != line.styles.length ||
          oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);
        for (var i = 0; !ischange && i < oldStyles.length; ++i) { ischange = oldStyles[i] != line.styles[i]; }
        if (ischange) { changedLines.push(context.line); }
        line.stateAfter = context.save();
        context.nextLine();
      } else {
        if (line.text.length <= cm.options.maxHighlightLength)
          { processLine(cm, line.text, context); }
        line.stateAfter = context.line % 5 == 0 ? context.save() : null;
        context.nextLine();
      }
      if (+new Date > end) {
        startWorker(cm, cm.options.workDelay);
        return true
      }
    });
    doc.highlightFrontier = context.line;
    doc.modeFrontier = Math.max(doc.modeFrontier, context.line);
    if (changedLines.length) { runInOp(cm, function () {
      for (var i = 0; i < changedLines.length; i++)
        { regLineChange(cm, changedLines[i], "text"); }
    }); }
  }

  // DISPLAY DRAWING

  var DisplayUpdate = function(cm, viewport, force) {
    var display = cm.display;

    this.viewport = viewport;
    // Store some values that we'll need later (but don't want to force a relayout for)
    this.visible = visibleLines(display, cm.doc, viewport);
    this.editorIsHidden = !display.wrapper.offsetWidth;
    this.wrapperHeight = display.wrapper.clientHeight;
    this.wrapperWidth = display.wrapper.clientWidth;
    this.oldDisplayWidth = displayWidth(cm);
    this.force = force;
    this.dims = getDimensions(cm);
    this.events = [];
  };

  DisplayUpdate.prototype.signal = function (emitter, type) {
    if (hasHandler(emitter, type))
      { this.events.push(arguments); }
  };
  DisplayUpdate.prototype.finish = function () {
    for (var i = 0; i < this.events.length; i++)
      { signal.apply(null, this.events[i]); }
  };

  function maybeClipScrollbars(cm) {
    var display = cm.display;
    if (!display.scrollbarsClipped && display.scroller.offsetWidth) {
      display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;
      display.heightForcer.style.height = scrollGap(cm) + "px";
      display.sizer.style.marginBottom = -display.nativeBarWidth + "px";
      display.sizer.style.borderRightWidth = scrollGap(cm) + "px";
      display.scrollbarsClipped = true;
    }
  }

  function selectionSnapshot(cm) {
    if (cm.hasFocus()) { return null }
    var active = activeElt();
    if (!active || !contains(cm.display.lineDiv, active)) { return null }
    var result = {activeElt: active};
    if (window.getSelection) {
      var sel = window.getSelection();
      if (sel.anchorNode && sel.extend && contains(cm.display.lineDiv, sel.anchorNode)) {
        result.anchorNode = sel.anchorNode;
        result.anchorOffset = sel.anchorOffset;
        result.focusNode = sel.focusNode;
        result.focusOffset = sel.focusOffset;
      }
    }
    return result
  }

  function restoreSelection(snapshot) {
    if (!snapshot || !snapshot.activeElt || snapshot.activeElt == activeElt()) { return }
    snapshot.activeElt.focus();
    if (!/^(INPUT|TEXTAREA)$/.test(snapshot.activeElt.nodeName) &&
        snapshot.anchorNode && contains(document.body, snapshot.anchorNode) && contains(document.body, snapshot.focusNode)) {
      var sel = window.getSelection(), range = document.createRange();
      range.setEnd(snapshot.anchorNode, snapshot.anchorOffset);
      range.collapse(false);
      sel.removeAllRanges();
      sel.addRange(range);
      sel.extend(snapshot.focusNode, snapshot.focusOffset);
    }
  }

  // Does the actual updating of the line display. Bails out
  // (returning false) when there is nothing to be done and forced is
  // false.
  function updateDisplayIfNeeded(cm, update) {
    var display = cm.display, doc = cm.doc;

    if (update.editorIsHidden) {
      resetView(cm);
      return false
    }

    // Bail out if the visible area is already rendered and nothing changed.
    if (!update.force &&
        update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&
        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&
        display.renderedView == display.view && countDirtyView(cm) == 0)
      { return false }

    if (maybeUpdateLineNumberWidth(cm)) {
      resetView(cm);
      update.dims = getDimensions(cm);
    }

    // Compute a suitable new viewport (from & to)
    var end = doc.first + doc.size;
    var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);
    var to = Math.min(end, update.visible.to + cm.options.viewportMargin);
    if (display.viewFrom < from && from - display.viewFrom < 20) { from = Math.max(doc.first, display.viewFrom); }
    if (display.viewTo > to && display.viewTo - to < 20) { to = Math.min(end, display.viewTo); }
    if (sawCollapsedSpans) {
      from = visualLineNo(cm.doc, from);
      to = visualLineEndNo(cm.doc, to);
    }

    var different = from != display.viewFrom || to != display.viewTo ||
      display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;
    adjustView(cm, from, to);

    display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));
    // Position the mover div to align with the current scroll position
    cm.display.mover.style.top = display.viewOffset + "px";

    var toUpdate = countDirtyView(cm);
    if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view &&
        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))
      { return false }

    // For big changes, we hide the enclosing element during the
    // update, since that speeds up the operations on most browsers.
    var selSnapshot = selectionSnapshot(cm);
    if (toUpdate > 4) { display.lineDiv.style.display = "none"; }
    patchDisplay(cm, display.updateLineNumbers, update.dims);
    if (toUpdate > 4) { display.lineDiv.style.display = ""; }
    display.renderedView = display.view;
    // There might have been a widget with a focused element that got
    // hidden or updated, if so re-focus it.
    restoreSelection(selSnapshot);

    // Prevent selection and cursors from interfering with the scroll
    // width and height.
    removeChildren(display.cursorDiv);
    removeChildren(display.selectionDiv);
    display.gutters.style.height = display.sizer.style.minHeight = 0;

    if (different) {
      display.lastWrapHeight = update.wrapperHeight;
      display.lastWrapWidth = update.wrapperWidth;
      startWorker(cm, 400);
    }

    display.updateLineNumbers = null;

    return true
  }

  function postUpdateDisplay(cm, update) {
    var viewport = update.viewport;

    for (var first = true;; first = false) {
      if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == displayWidth(cm)) {
        // Clip forced viewport to actual scrollable area.
        if (viewport && viewport.top != null)
          { viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - displayHeight(cm), viewport.top)}; }
        // Updated line heights might result in the drawn area not
        // actually covering the viewport. Keep looping until it does.
        update.visible = visibleLines(cm.display, cm.doc, viewport);
        if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)
          { break }
      } else if (first) {
        update.visible = visibleLines(cm.display, cm.doc, viewport);
      }
      if (!updateDisplayIfNeeded(cm, update)) { break }
      updateHeightsInViewport(cm);
      var barMeasure = measureForScrollbars(cm);
      updateSelection(cm);
      updateScrollbars(cm, barMeasure);
      setDocumentHeight(cm, barMeasure);
      update.force = false;
    }

    update.signal(cm, "update", cm);
    if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {
      update.signal(cm, "viewportChange", cm, cm.display.viewFrom, cm.display.viewTo);
      cm.display.reportedViewFrom = cm.display.viewFrom; cm.display.reportedViewTo = cm.display.viewTo;
    }
  }

  function updateDisplaySimple(cm, viewport) {
    var update = new DisplayUpdate(cm, viewport);
    if (updateDisplayIfNeeded(cm, update)) {
      updateHeightsInViewport(cm);
      postUpdateDisplay(cm, update);
      var barMeasure = measureForScrollbars(cm);
      updateSelection(cm);
      updateScrollbars(cm, barMeasure);
      setDocumentHeight(cm, barMeasure);
      update.finish();
    }
  }

  // Sync the actual display DOM structure with display.view, removing
  // nodes for lines that are no longer in view, and creating the ones
  // that are not there yet, and updating the ones that are out of
  // date.
  function patchDisplay(cm, updateNumbersFrom, dims) {
    var display = cm.display, lineNumbers = cm.options.lineNumbers;
    var container = display.lineDiv, cur = container.firstChild;

    function rm(node) {
      var next = node.nextSibling;
      // Works around a throw-scroll bug in OS X Webkit
      if (webkit && mac && cm.display.currentWheelTarget == node)
        { node.style.display = "none"; }
      else
        { node.parentNode.removeChild(node); }
      return next
    }

    var view = display.view, lineN = display.viewFrom;
    // Loop over the elements in the view, syncing cur (the DOM nodes
    // in display.lineDiv) with the view as we go.
    for (var i = 0; i < view.length; i++) {
      var lineView = view[i];
      if (lineView.hidden) ; else if (!lineView.node || lineView.node.parentNode != container) { // Not drawn yet
        var node = buildLineElement(cm, lineView, lineN, dims);
        container.insertBefore(node, cur);
      } else { // Already drawn
        while (cur != lineView.node) { cur = rm(cur); }
        var updateNumber = lineNumbers && updateNumbersFrom != null &&
          updateNumbersFrom <= lineN && lineView.lineNumber;
        if (lineView.changes) {
          if (indexOf(lineView.changes, "gutter") > -1) { updateNumber = false; }
          updateLineForChanges(cm, lineView, lineN, dims);
        }
        if (updateNumber) {
          removeChildren(lineView.lineNumber);
          lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));
        }
        cur = lineView.node.nextSibling;
      }
      lineN += lineView.size;
    }
    while (cur) { cur = rm(cur); }
  }

  function updateGutterSpace(display) {
    var width = display.gutters.offsetWidth;
    display.sizer.style.marginLeft = width + "px";
    // Send an event to consumers responding to changes in gutter width.
    signalLater(display, "gutterChanged", display);
  }

  function setDocumentHeight(cm, measure) {
    cm.display.sizer.style.minHeight = measure.docHeight + "px";
    cm.display.heightForcer.style.top = measure.docHeight + "px";
    cm.display.gutters.style.height = (measure.docHeight + cm.display.barHeight + scrollGap(cm)) + "px";
  }

  // Re-align line numbers and gutter marks to compensate for
  // horizontal scrolling.
  function alignHorizontally(cm) {
    var display = cm.display, view = display.view;
    if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) { return }
    var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;
    var gutterW = display.gutters.offsetWidth, left = comp + "px";
    for (var i = 0; i < view.length; i++) { if (!view[i].hidden) {
      if (cm.options.fixedGutter) {
        if (view[i].gutter)
          { view[i].gutter.style.left = left; }
        if (view[i].gutterBackground)
          { view[i].gutterBackground.style.left = left; }
      }
      var align = view[i].alignable;
      if (align) { for (var j = 0; j < align.length; j++)
        { align[j].style.left = left; } }
    } }
    if (cm.options.fixedGutter)
      { display.gutters.style.left = (comp + gutterW) + "px"; }
  }

  // Used to ensure that the line number gutter is still the right
  // size for the current document size. Returns true when an update
  // is needed.
  function maybeUpdateLineNumberWidth(cm) {
    if (!cm.options.lineNumbers) { return false }
    var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;
    if (last.length != display.lineNumChars) {
      var test = display.measure.appendChild(elt("div", [elt("div", last)],
                                                 "CodeMirror-linenumber CodeMirror-gutter-elt"));
      var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;
      display.lineGutter.style.width = "";
      display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding) + 1;
      display.lineNumWidth = display.lineNumInnerWidth + padding;
      display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;
      display.lineGutter.style.width = display.lineNumWidth + "px";
      updateGutterSpace(cm.display);
      return true
    }
    return false
  }

  function getGutters(gutters, lineNumbers) {
    var result = [], sawLineNumbers = false;
    for (var i = 0; i < gutters.length; i++) {
      var name = gutters[i], style = null;
      if (typeof name != "string") { style = name.style; name = name.className; }
      if (name == "CodeMirror-linenumbers") {
        if (!lineNumbers) { continue }
        else { sawLineNumbers = true; }
      }
      result.push({className: name, style: style});
    }
    if (lineNumbers && !sawLineNumbers) { result.push({className: "CodeMirror-linenumbers", style: null}); }
    return result
  }

  // Rebuild the gutter elements, ensure the margin to the left of the
  // code matches their width.
  function renderGutters(display) {
    var gutters = display.gutters, specs = display.gutterSpecs;
    removeChildren(gutters);
    display.lineGutter = null;
    for (var i = 0; i < specs.length; ++i) {
      var ref = specs[i];
      var className = ref.className;
      var style = ref.style;
      var gElt = gutters.appendChild(elt("div", null, "CodeMirror-gutter " + className));
      if (style) { gElt.style.cssText = style; }
      if (className == "CodeMirror-linenumbers") {
        display.lineGutter = gElt;
        gElt.style.width = (display.lineNumWidth || 1) + "px";
      }
    }
    gutters.style.display = specs.length ? "" : "none";
    updateGutterSpace(display);
  }

  function updateGutters(cm) {
    renderGutters(cm.display);
    regChange(cm);
    alignHorizontally(cm);
  }

  // The display handles the DOM integration, both for input reading
  // and content drawing. It holds references to DOM nodes and
  // display-related state.

  function Display(place, doc, input, options) {
    var d = this;
    this.input = input;

    // Covers bottom-right square when both scrollbars are present.
    d.scrollbarFiller = elt("div", null, "CodeMirror-scrollbar-filler");
    d.scrollbarFiller.setAttribute("cm-not-content", "true");
    // Covers bottom of gutter when coverGutterNextToScrollbar is on
    // and h scrollbar is present.
    d.gutterFiller = elt("div", null, "CodeMirror-gutter-filler");
    d.gutterFiller.setAttribute("cm-not-content", "true");
    // Will contain the actual code, positioned to cover the viewport.
    d.lineDiv = eltP("div", null, "CodeMirror-code");
    // Elements are added to these to represent selection and cursors.
    d.selectionDiv = elt("div", null, null, "position: relative; z-index: 1");
    d.cursorDiv = elt("div", null, "CodeMirror-cursors");
    // A visibility: hidden element used to find the size of things.
    d.measure = elt("div", null, "CodeMirror-measure");
    // When lines outside of the viewport are measured, they are drawn in this.
    d.lineMeasure = elt("div", null, "CodeMirror-measure");
    // Wraps everything that needs to exist inside the vertically-padded coordinate system
    d.lineSpace = eltP("div", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],
                      null, "position: relative; outline: none");
    var lines = eltP("div", [d.lineSpace], "CodeMirror-lines");
    // Moved around its parent to cover visible view.
    d.mover = elt("div", [lines], null, "position: relative");
    // Set to the height of the document, allowing scrolling.
    d.sizer = elt("div", [d.mover], "CodeMirror-sizer");
    d.sizerWidth = null;
    // Behavior of elts with overflow: auto and padding is
    // inconsistent across browsers. This is used to ensure the
    // scrollable area is big enough.
    d.heightForcer = elt("div", null, null, "position: absolute; height: " + scrollerGap + "px; width: 1px;");
    // Will contain the gutters, if any.
    d.gutters = elt("div", null, "CodeMirror-gutters");
    d.lineGutter = null;
    // Actual scrollable element.
    d.scroller = elt("div", [d.sizer, d.heightForcer, d.gutters], "CodeMirror-scroll");
    d.scroller.setAttribute("tabIndex", "-1");
    // The element in which the editor lives.
    d.wrapper = elt("div", [d.scrollbarFiller, d.gutterFiller, d.scroller], "CodeMirror");

    // This attribute is respected by automatic translation systems such as Google Translate,
    // and may also be respected by tools used by human translators.
    d.wrapper.setAttribute('translate', 'no');

    // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)
    if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }
    if (!webkit && !(gecko && mobile)) { d.scroller.draggable = true; }

    if (place) {
      if (place.appendChild) { place.appendChild(d.wrapper); }
      else { place(d.wrapper); }
    }

    // Current rendered range (may be bigger than the view window).
    d.viewFrom = d.viewTo = doc.first;
    d.reportedViewFrom = d.reportedViewTo = doc.first;
    // Information about the rendered lines.
    d.view = [];
    d.renderedView = null;
    // Holds info about a single rendered line when it was rendered
    // for measurement, while not in view.
    d.externalMeasured = null;
    // Empty space (in pixels) above the view
    d.viewOffset = 0;
    d.lastWrapHeight = d.lastWrapWidth = 0;
    d.updateLineNumbers = null;

    d.nativeBarWidth = d.barHeight = d.barWidth = 0;
    d.scrollbarsClipped = false;

    // Used to only resize the line number gutter when necessary (when
    // the amount of lines crosses a boundary that makes its width change)
    d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;
    // Set to true when a non-horizontal-scrolling line widget is
    // added. As an optimization, line widget aligning is skipped when
    // this is false.
    d.alignWidgets = false;

    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;

    // Tracks the maximum line length so that the horizontal scrollbar
    // can be kept static when scrolling.
    d.maxLine = null;
    d.maxLineLength = 0;
    d.maxLineChanged = false;

    // Used for measuring wheel scrolling granularity
    d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;

    // True when shift is held down.
    d.shift = false;

    // Used to track whether anything happened since the context menu
    // was opened.
    d.selForContextMenu = null;

    d.activeTouch = null;

    d.gutterSpecs = getGutters(options.gutters, options.lineNumbers);
    renderGutters(d);

    input.init(d);
  }

  // Since the delta values reported on mouse wheel events are
  // unstandardized between browsers and even browser versions, and
  // generally horribly unpredictable, this code starts by measuring
  // the scroll effect that the first few mouse wheel events have,
  // and, from that, detects the way it can convert deltas to pixel
  // offsets afterwards.
  //
  // The reason we want to know the amount a wheel event will scroll
  // is that it gives us a chance to update the display before the
  // actual scrolling happens, reducing flickering.

  var wheelSamples = 0, wheelPixelsPerUnit = null;
  // Fill in a browser-detected starting value on browsers where we
  // know one. These don't have to be accurate -- the result of them
  // being wrong would just be a slight flicker on the first wheel
  // scroll (if it is large enough).
  if (ie) { wheelPixelsPerUnit = -.53; }
  else if (gecko) { wheelPixelsPerUnit = 15; }
  else if (chrome) { wheelPixelsPerUnit = -.7; }
  else if (safari) { wheelPixelsPerUnit = -1/3; }

  function wheelEventDelta(e) {
    var dx = e.wheelDeltaX, dy = e.wheelDeltaY;
    if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) { dx = e.detail; }
    if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) { dy = e.detail; }
    else if (dy == null) { dy = e.wheelDelta; }
    return {x: dx, y: dy}
  }
  function wheelEventPixels(e) {
    var delta = wheelEventDelta(e);
    delta.x *= wheelPixelsPerUnit;
    delta.y *= wheelPixelsPerUnit;
    return delta
  }

  function onScrollWheel(cm, e) {
    var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;

    var display = cm.display, scroll = display.scroller;
    // Quit if there's nothing to scroll here
    var canScrollX = scroll.scrollWidth > scroll.clientWidth;
    var canScrollY = scroll.scrollHeight > scroll.clientHeight;
    if (!(dx && canScrollX || dy && canScrollY)) { return }

    // Webkit browsers on OS X abort momentum scrolls when the target
    // of the scroll event is removed from the scrollable element.
    // This hack (see related code in patchDisplay) makes sure the
    // element is kept around.
    if (dy && mac && webkit) {
      outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {
        for (var i = 0; i < view.length; i++) {
          if (view[i].node == cur) {
            cm.display.currentWheelTarget = cur;
            break outer
          }
        }
      }
    }

    // On some browsers, horizontal scrolling will cause redraws to
    // happen before the gutter has been realigned, causing it to
    // wriggle around in a most unseemly way. When we have an
    // estimated pixels/delta value, we just handle horizontal
    // scrolling entirely here. It'll be slightly off from native, but
    // better than glitching out.
    if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {
      if (dy && canScrollY)
        { updateScrollTop(cm, Math.max(0, scroll.scrollTop + dy * wheelPixelsPerUnit)); }
      setScrollLeft(cm, Math.max(0, scroll.scrollLeft + dx * wheelPixelsPerUnit));
      // Only prevent default scrolling if vertical scrolling is
      // actually possible. Otherwise, it causes vertical scroll
      // jitter on OSX trackpads when deltaX is small and deltaY
      // is large (issue #3579)
      if (!dy || (dy && canScrollY))
        { e_preventDefault(e); }
      display.wheelStartX = null; // Abort measurement, if in progress
      return
    }

    // 'Project' the visible viewport to cover the area that is being
    // scrolled into view (if we know enough to estimate it).
    if (dy && wheelPixelsPerUnit != null) {
      var pixels = dy * wheelPixelsPerUnit;
      var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;
      if (pixels < 0) { top = Math.max(0, top + pixels - 50); }
      else { bot = Math.min(cm.doc.height, bot + pixels + 50); }
      updateDisplaySimple(cm, {top: top, bottom: bot});
    }

    if (wheelSamples < 20) {
      if (display.wheelStartX == null) {
        display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;
        display.wheelDX = dx; display.wheelDY = dy;
        setTimeout(function () {
          if (display.wheelStartX == null) { return }
          var movedX = scroll.scrollLeft - display.wheelStartX;
          var movedY = scroll.scrollTop - display.wheelStartY;
          var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||
            (movedX && display.wheelDX && movedX / display.wheelDX);
          display.wheelStartX = display.wheelStartY = null;
          if (!sample) { return }
          wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);
          ++wheelSamples;
        }, 200);
      } else {
        display.wheelDX += dx; display.wheelDY += dy;
      }
    }
  }

  // Selection objects are immutable. A new one is created every time
  // the selection changes. A selection is one or more non-overlapping
  // (and non-touching) ranges, sorted, and an integer that indicates
  // which one is the primary selection (the one that's scrolled into
  // view, that getCursor returns, etc).
  var Selection = function(ranges, primIndex) {
    this.ranges = ranges;
    this.primIndex = primIndex;
  };

  Selection.prototype.primary = function () { return this.ranges[this.primIndex] };

  Selection.prototype.equals = function (other) {
    if (other == this) { return true }
    if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) { return false }
    for (var i = 0; i < this.ranges.length; i++) {
      var here = this.ranges[i], there = other.ranges[i];
      if (!equalCursorPos(here.anchor, there.anchor) || !equalCursorPos(here.head, there.head)) { return false }
    }
    return true
  };

  Selection.prototype.deepCopy = function () {
    var out = [];
    for (var i = 0; i < this.ranges.length; i++)
      { out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head)); }
    return new Selection(out, this.primIndex)
  };

  Selection.prototype.somethingSelected = function () {
    for (var i = 0; i < this.ranges.length; i++)
      { if (!this.ranges[i].empty()) { return true } }
    return false
  };

  Selection.prototype.contains = function (pos, end) {
    if (!end) { end = pos; }
    for (var i = 0; i < this.ranges.length; i++) {
      var range = this.ranges[i];
      if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)
        { return i }
    }
    return -1
  };

  var Range = function(anchor, head) {
    this.anchor = anchor; this.head = head;
  };

  Range.prototype.from = function () { return minPos(this.anchor, this.head) };
  Range.prototype.to = function () { return maxPos(this.anchor, this.head) };
  Range.prototype.empty = function () { return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch };

  // Take an unsorted, potentially overlapping set of ranges, and
  // build a selection out of it. 'Consumes' ranges array (modifying
  // it).
  function normalizeSelection(cm, ranges, primIndex) {
    var mayTouch = cm && cm.options.selectionsMayTouch;
    var prim = ranges[primIndex];
    ranges.sort(function (a, b) { return cmp(a.from(), b.from()); });
    primIndex = indexOf(ranges, prim);
    for (var i = 1; i < ranges.length; i++) {
      var cur = ranges[i], prev = ranges[i - 1];
      var diff = cmp(prev.to(), cur.from());
      if (mayTouch && !cur.empty() ? diff > 0 : diff >= 0) {
        var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());
        var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;
        if (i <= primIndex) { --primIndex; }
        ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));
      }
    }
    return new Selection(ranges, primIndex)
  }

  function simpleSelection(anchor, head) {
    return new Selection([new Range(anchor, head || anchor)], 0)
  }

  // Compute the position of the end of a change (its 'to' property
  // refers to the pre-change end).
  function changeEnd(change) {
    if (!change.text) { return change.to }
    return Pos(change.from.line + change.text.length - 1,
               lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0))
  }

  // Adjust a position to refer to the post-change position of the
  // same text, or the end of the change if the change covers it.
  function adjustForChange(pos, change) {
    if (cmp(pos, change.from) < 0) { return pos }
    if (cmp(pos, change.to) <= 0) { return changeEnd(change) }

    var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;
    if (pos.line == change.to.line) { ch += changeEnd(change).ch - change.to.ch; }
    return Pos(line, ch)
  }

  function computeSelAfterChange(doc, change) {
    var out = [];
    for (var i = 0; i < doc.sel.ranges.length; i++) {
      var range = doc.sel.ranges[i];
      out.push(new Range(adjustForChange(range.anchor, change),
                         adjustForChange(range.head, change)));
    }
    return normalizeSelection(doc.cm, out, doc.sel.primIndex)
  }

  function offsetPos(pos, old, nw) {
    if (pos.line == old.line)
      { return Pos(nw.line, pos.ch - old.ch + nw.ch) }
    else
      { return Pos(nw.line + (pos.line - old.line), pos.ch) }
  }

  // Used by replaceSelections to allow moving the selection to the
  // start or around the replaced test. Hint may be "start" or "around".
  function computeReplacedSel(doc, changes, hint) {
    var out = [];
    var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;
    for (var i = 0; i < changes.length; i++) {
      var change = changes[i];
      var from = offsetPos(change.from, oldPrev, newPrev);
      var to = offsetPos(changeEnd(change), oldPrev, newPrev);
      oldPrev = change.to;
      newPrev = to;
      if (hint == "around") {
        var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;
        out[i] = new Range(inv ? to : from, inv ? from : to);
      } else {
        out[i] = new Range(from, from);
      }
    }
    return new Selection(out, doc.sel.primIndex)
  }

  // Used to get the editor into a consistent state again when options change.

  function loadMode(cm) {
    cm.doc.mode = getMode(cm.options, cm.doc.modeOption);
    resetModeState(cm);
  }

  function resetModeState(cm) {
    cm.doc.iter(function (line) {
      if (line.stateAfter) { line.stateAfter = null; }
      if (line.styles) { line.styles = null; }
    });
    cm.doc.modeFrontier = cm.doc.highlightFrontier = cm.doc.first;
    startWorker(cm, 100);
    cm.state.modeGen++;
    if (cm.curOp) { regChange(cm); }
  }

  // DOCUMENT DATA STRUCTURE

  // By default, updates that start and end at the beginning of a line
  // are treated specially, in order to make the association of line
  // widgets and marker elements with the text behave more intuitive.
  function isWholeLineUpdate(doc, change) {
    return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == "" &&
      (!doc.cm || doc.cm.options.wholeLineUpdateBefore)
  }

  // Perform a change on the document data structure.
  function updateDoc(doc, change, markedSpans, estimateHeight) {
    function spansFor(n) {return markedSpans ? markedSpans[n] : null}
    function update(line, text, spans) {
      updateLine(line, text, spans, estimateHeight);
      signalLater(line, "change", line, change);
    }
    function linesFor(start, end) {
      var result = [];
      for (var i = start; i < end; ++i)
        { result.push(new Line(text[i], spansFor(i), estimateHeight)); }
      return result
    }

    var from = change.from, to = change.to, text = change.text;
    var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);
    var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;

    // Adjust the line structure
    if (change.full) {
      doc.insert(0, linesFor(0, text.length));
      doc.remove(text.length, doc.size - text.length);
    } else if (isWholeLineUpdate(doc, change)) {
      // This is a whole-line replace. Treated specially to make
      // sure line objects move the way they are supposed to.
      var added = linesFor(0, text.length - 1);
      update(lastLine, lastLine.text, lastSpans);
      if (nlines) { doc.remove(from.line, nlines); }
      if (added.length) { doc.insert(from.line, added); }
    } else if (firstLine == lastLine) {
      if (text.length == 1) {
        update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);
      } else {
        var added$1 = linesFor(1, text.length - 1);
        added$1.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));
        update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));
        doc.insert(from.line + 1, added$1);
      }
    } else if (text.length == 1) {
      update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));
      doc.remove(from.line + 1, nlines);
    } else {
      update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));
      update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);
      var added$2 = linesFor(1, text.length - 1);
      if (nlines > 1) { doc.remove(from.line + 1, nlines - 1); }
      doc.insert(from.line + 1, added$2);
    }

    signalLater(doc, "change", doc, change);
  }

  // Call f for all linked documents.
  function linkedDocs(doc, f, sharedHistOnly) {
    function propagate(doc, skip, sharedHist) {
      if (doc.linked) { for (var i = 0; i < doc.linked.length; ++i) {
        var rel = doc.linked[i];
        if (rel.doc == skip) { continue }
        var shared = sharedHist && rel.sharedHist;
        if (sharedHistOnly && !shared) { continue }
        f(rel.doc, shared);
        propagate(rel.doc, doc, shared);
      } }
    }
    propagate(doc, null, true);
  }

  // Attach a document to an editor.
  function attachDoc(cm, doc) {
    if (doc.cm) { throw new Error("This document is already in use.") }
    cm.doc = doc;
    doc.cm = cm;
    estimateLineHeights(cm);
    loadMode(cm);
    setDirectionClass(cm);
    cm.options.direction = doc.direction;
    if (!cm.options.lineWrapping) { findMaxLine(cm); }
    cm.options.mode = doc.modeOption;
    regChange(cm);
  }

  function setDirectionClass(cm) {
  (cm.doc.direction == "rtl" ? addClass : rmClass)(cm.display.lineDiv, "CodeMirror-rtl");
  }

  function directionChanged(cm) {
    runInOp(cm, function () {
      setDirectionClass(cm);
      regChange(cm);
    });
  }

  function History(prev) {
    // Arrays of change events and selections. Doing something adds an
    // event to done and clears undo. Undoing moves events from done
    // to undone, redoing moves them in the other direction.
    this.done = []; this.undone = [];
    this.undoDepth = prev ? prev.undoDepth : Infinity;
    // Used to track when changes can be merged into a single undo
    // event
    this.lastModTime = this.lastSelTime = 0;
    this.lastOp = this.lastSelOp = null;
    this.lastOrigin = this.lastSelOrigin = null;
    // Used by the isClean() method
    this.generation = this.maxGeneration = prev ? prev.maxGeneration : 1;
  }

  // Create a history change event from an updateDoc-style change
  // object.
  function historyChangeFromChange(doc, change) {
    var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};
    attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);
    linkedDocs(doc, function (doc) { return attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1); }, true);
    return histChange
  }

  // Pop all selection events off the end of a history array. Stop at
  // a change event.
  function clearSelectionEvents(array) {
    while (array.length) {
      var last = lst(array);
      if (last.ranges) { array.pop(); }
      else { break }
    }
  }

  // Find the top change event in the history. Pop off selection
  // events that are in the way.
  function lastChangeEvent(hist, force) {
    if (force) {
      clearSelectionEvents(hist.done);
      return lst(hist.done)
    } else if (hist.done.length && !lst(hist.done).ranges) {
      return lst(hist.done)
    } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {
      hist.done.pop();
      return lst(hist.done)
    }
  }

  // Register a change in the history. Merges changes that are within
  // a single operation, or are close together with an origin that
  // allows merging (starting with "+") into a single event.
  function addChangeToHistory(doc, change, selAfter, opId) {
    var hist = doc.history;
    hist.undone.length = 0;
    var time = +new Date, cur;
    var last;

    if ((hist.lastOp == opId ||
         hist.lastOrigin == change.origin && change.origin &&
         ((change.origin.charAt(0) == "+" && hist.lastModTime > time - (doc.cm ? doc.cm.options.historyEventDelay : 500)) ||
          change.origin.charAt(0) == "*")) &&
        (cur = lastChangeEvent(hist, hist.lastOp == opId))) {
      // Merge this change into the last event
      last = lst(cur.changes);
      if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {
        // Optimized case for simple insertion -- don't want to add
        // new changesets for every character typed
        last.to = changeEnd(change);
      } else {
        // Add new sub-event
        cur.changes.push(historyChangeFromChange(doc, change));
      }
    } else {
      // Can not be merged, start a new event.
      var before = lst(hist.done);
      if (!before || !before.ranges)
        { pushSelectionToHistory(doc.sel, hist.done); }
      cur = {changes: [historyChangeFromChange(doc, change)],
             generation: hist.generation};
      hist.done.push(cur);
      while (hist.done.length > hist.undoDepth) {
        hist.done.shift();
        if (!hist.done[0].ranges) { hist.done.shift(); }
      }
    }
    hist.done.push(selAfter);
    hist.generation = ++hist.maxGeneration;
    hist.lastModTime = hist.lastSelTime = time;
    hist.lastOp = hist.lastSelOp = opId;
    hist.lastOrigin = hist.lastSelOrigin = change.origin;

    if (!last) { signal(doc, "historyAdded"); }
  }

  function selectionEventCanBeMerged(doc, origin, prev, sel) {
    var ch = origin.charAt(0);
    return ch == "*" ||
      ch == "+" &&
      prev.ranges.length == sel.ranges.length &&
      prev.somethingSelected() == sel.somethingSelected() &&
      new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500)
  }

  // Called whenever the selection changes, sets the new selection as
  // the pending selection in the history, and pushes the old pending
  // selection into the 'done' array when it was significantly
  // different (in number of selected ranges, emptiness, or time).
  function addSelectionToHistory(doc, sel, opId, options) {
    var hist = doc.history, origin = options && options.origin;

    // A new event is started when the previous origin does not match
    // the current, or the origins don't allow matching. Origins
    // starting with * are always merged, those starting with + are
    // merged when similar and close together in time.
    if (opId == hist.lastSelOp ||
        (origin && hist.lastSelOrigin == origin &&
         (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||
          selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))
      { hist.done[hist.done.length - 1] = sel; }
    else
      { pushSelectionToHistory(sel, hist.done); }

    hist.lastSelTime = +new Date;
    hist.lastSelOrigin = origin;
    hist.lastSelOp = opId;
    if (options && options.clearRedo !== false)
      { clearSelectionEvents(hist.undone); }
  }

  function pushSelectionToHistory(sel, dest) {
    var top = lst(dest);
    if (!(top && top.ranges && top.equals(sel)))
      { dest.push(sel); }
  }

  // Used to store marked span information in the history.
  function attachLocalSpans(doc, change, from, to) {
    var existing = change["spans_" + doc.id], n = 0;
    doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function (line) {
      if (line.markedSpans)
        { (existing || (existing = change["spans_" + doc.id] = {}))[n] = line.markedSpans; }
      ++n;
    });
  }

  // When un/re-doing restores text containing marked spans, those
  // that have been explicitly cleared should not be restored.
  function removeClearedSpans(spans) {
    if (!spans) { return null }
    var out;
    for (var i = 0; i < spans.length; ++i) {
      if (spans[i].marker.explicitlyCleared) { if (!out) { out = spans.slice(0, i); } }
      else if (out) { out.push(spans[i]); }
    }
    return !out ? spans : out.length ? out : null
  }

  // Retrieve and filter the old marked spans stored in a change event.
  function getOldSpans(doc, change) {
    var found = change["spans_" + doc.id];
    if (!found) { return null }
    var nw = [];
    for (var i = 0; i < change.text.length; ++i)
      { nw.push(removeClearedSpans(found[i])); }
    return nw
  }

  // Used for un/re-doing changes from the history. Combines the
  // result of computing the existing spans with the set of spans that
  // existed in the history (so that deleting around a span and then
  // undoing brings back the span).
  function mergeOldSpans(doc, change) {
    var old = getOldSpans(doc, change);
    var stretched = stretchSpansOverChange(doc, change);
    if (!old) { return stretched }
    if (!stretched) { return old }

    for (var i = 0; i < old.length; ++i) {
      var oldCur = old[i], stretchCur = stretched[i];
      if (oldCur && stretchCur) {
        spans: for (var j = 0; j < stretchCur.length; ++j) {
          var span = stretchCur[j];
          for (var k = 0; k < oldCur.length; ++k)
            { if (oldCur[k].marker == span.marker) { continue spans } }
          oldCur.push(span);
        }
      } else if (stretchCur) {
        old[i] = stretchCur;
      }
    }
    return old
  }

  // Used both to provide a JSON-safe object in .getHistory, and, when
  // detaching a document, to split the history in two
  function copyHistoryArray(events, newGroup, instantiateSel) {
    var copy = [];
    for (var i = 0; i < events.length; ++i) {
      var event = events[i];
      if (event.ranges) {
        copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);
        continue
      }
      var changes = event.changes, newChanges = [];
      copy.push({changes: newChanges});
      for (var j = 0; j < changes.length; ++j) {
        var change = changes[j], m = (void 0);
        newChanges.push({from: change.from, to: change.to, text: change.text});
        if (newGroup) { for (var prop in change) { if (m = prop.match(/^spans_(\d+)$/)) {
          if (indexOf(newGroup, Number(m[1])) > -1) {
            lst(newChanges)[prop] = change[prop];
            delete change[prop];
          }
        } } }
      }
    }
    return copy
  }

  // The 'scroll' parameter given to many of these indicated whether
  // the new cursor position should be scrolled into view after
  // modifying the selection.

  // If shift is held or the extend flag is set, extends a range to
  // include a given position (and optionally a second position).
  // Otherwise, simply returns the range between the given positions.
  // Used for cursor motion and such.
  function extendRange(range, head, other, extend) {
    if (extend) {
      var anchor = range.anchor;
      if (other) {
        var posBefore = cmp(head, anchor) < 0;
        if (posBefore != (cmp(other, anchor) < 0)) {
          anchor = head;
          head = other;
        } else if (posBefore != (cmp(head, other) < 0)) {
          head = other;
        }
      }
      return new Range(anchor, head)
    } else {
      return new Range(other || head, head)
    }
  }

  // Extend the primary selection range, discard the rest.
  function extendSelection(doc, head, other, options, extend) {
    if (extend == null) { extend = doc.cm && (doc.cm.display.shift || doc.extend); }
    setSelection(doc, new Selection([extendRange(doc.sel.primary(), head, other, extend)], 0), options);
  }

  // Extend all selections (pos is an array of selections with length
  // equal the number of selections)
  function extendSelections(doc, heads, options) {
    var out = [];
    var extend = doc.cm && (doc.cm.display.shift || doc.extend);
    for (var i = 0; i < doc.sel.ranges.length; i++)
      { out[i] = extendRange(doc.sel.ranges[i], heads[i], null, extend); }
    var newSel = normalizeSelection(doc.cm, out, doc.sel.primIndex);
    setSelection(doc, newSel, options);
  }

  // Updates a single range in the selection.
  function replaceOneSelection(doc, i, range, options) {
    var ranges = doc.sel.ranges.slice(0);
    ranges[i] = range;
    setSelection(doc, normalizeSelection(doc.cm, ranges, doc.sel.primIndex), options);
  }

  // Reset the selection to a single range.
  function setSimpleSelection(doc, anchor, head, options) {
    setSelection(doc, simpleSelection(anchor, head), options);
  }

  // Give beforeSelectionChange handlers a change to influence a
  // selection update.
  function filterSelectionChange(doc, sel, options) {
    var obj = {
      ranges: sel.ranges,
      update: function(ranges) {
        this.ranges = [];
        for (var i = 0; i < ranges.length; i++)
          { this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),
                                     clipPos(doc, ranges[i].head)); }
      },
      origin: options && options.origin
    };
    signal(doc, "beforeSelectionChange", doc, obj);
    if (doc.cm) { signal(doc.cm, "beforeSelectionChange", doc.cm, obj); }
    if (obj.ranges != sel.ranges) { return normalizeSelection(doc.cm, obj.ranges, obj.ranges.length - 1) }
    else { return sel }
  }

  function setSelectionReplaceHistory(doc, sel, options) {
    var done = doc.history.done, last = lst(done);
    if (last && last.ranges) {
      done[done.length - 1] = sel;
      setSelectionNoUndo(doc, sel, options);
    } else {
      setSelection(doc, sel, options);
    }
  }

  // Set a new selection.
  function setSelection(doc, sel, options) {
    setSelectionNoUndo(doc, sel, options);
    addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);
  }

  function setSelectionNoUndo(doc, sel, options) {
    if (hasHandler(doc, "beforeSelectionChange") || doc.cm && hasHandler(doc.cm, "beforeSelectionChange"))
      { sel = filterSelectionChange(doc, sel, options); }

    var bias = options && options.bias ||
      (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);
    setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));

    if (!(options && options.scroll === false) && doc.cm && doc.cm.getOption("readOnly") != "nocursor")
      { ensureCursorVisible(doc.cm); }
  }

  function setSelectionInner(doc, sel) {
    if (sel.equals(doc.sel)) { return }

    doc.sel = sel;

    if (doc.cm) {
      doc.cm.curOp.updateInput = 1;
      doc.cm.curOp.selectionChanged = true;
      signalCursorActivity(doc.cm);
    }
    signalLater(doc, "cursorActivity", doc);
  }

  // Verify that the selection does not partially select any atomic
  // marked ranges.
  function reCheckSelection(doc) {
    setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false));
  }

  // Return a selection that does not partially select any atomic
  // ranges.
  function skipAtomicInSelection(doc, sel, bias, mayClear) {
    var out;
    for (var i = 0; i < sel.ranges.length; i++) {
      var range = sel.ranges[i];
      var old = sel.ranges.length == doc.sel.ranges.length && doc.sel.ranges[i];
      var newAnchor = skipAtomic(doc, range.anchor, old && old.anchor, bias, mayClear);
      var newHead = skipAtomic(doc, range.head, old && old.head, bias, mayClear);
      if (out || newAnchor != range.anchor || newHead != range.head) {
        if (!out) { out = sel.ranges.slice(0, i); }
        out[i] = new Range(newAnchor, newHead);
      }
    }
    return out ? normalizeSelection(doc.cm, out, sel.primIndex) : sel
  }

  function skipAtomicInner(doc, pos, oldPos, dir, mayClear) {
    var line = getLine(doc, pos.line);
    if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {
      var sp = line.markedSpans[i], m = sp.marker;

      // Determine if we should prevent the cursor being placed to the left/right of an atomic marker
      // Historically this was determined using the inclusiveLeft/Right option, but the new way to control it
      // is with selectLeft/Right
      var preventCursorLeft = ("selectLeft" in m) ? !m.selectLeft : m.inclusiveLeft;
      var preventCursorRight = ("selectRight" in m) ? !m.selectRight : m.inclusiveRight;

      if ((sp.from == null || (preventCursorLeft ? sp.from <= pos.ch : sp.from < pos.ch)) &&
          (sp.to == null || (preventCursorRight ? sp.to >= pos.ch : sp.to > pos.ch))) {
        if (mayClear) {
          signal(m, "beforeCursorEnter");
          if (m.explicitlyCleared) {
            if (!line.markedSpans) { break }
            else {--i; continue}
          }
        }
        if (!m.atomic) { continue }

        if (oldPos) {
          var near = m.find(dir < 0 ? 1 : -1), diff = (void 0);
          if (dir < 0 ? preventCursorRight : preventCursorLeft)
            { near = movePos(doc, near, -dir, near && near.line == pos.line ? line : null); }
          if (near && near.line == pos.line && (diff = cmp(near, oldPos)) && (dir < 0 ? diff < 0 : diff > 0))
            { return skipAtomicInner(doc, near, pos, dir, mayClear) }
        }

        var far = m.find(dir < 0 ? -1 : 1);
        if (dir < 0 ? preventCursorLeft : preventCursorRight)
          { far = movePos(doc, far, dir, far.line == pos.line ? line : null); }
        return far ? skipAtomicInner(doc, far, pos, dir, mayClear) : null
      }
    } }
    return pos
  }

  // Ensure a given position is not inside an atomic range.
  function skipAtomic(doc, pos, oldPos, bias, mayClear) {
    var dir = bias || 1;
    var found = skipAtomicInner(doc, pos, oldPos, dir, mayClear) ||
        (!mayClear && skipAtomicInner(doc, pos, oldPos, dir, true)) ||
        skipAtomicInner(doc, pos, oldPos, -dir, mayClear) ||
        (!mayClear && skipAtomicInner(doc, pos, oldPos, -dir, true));
    if (!found) {
      doc.cantEdit = true;
      return Pos(doc.first, 0)
    }
    return found
  }

  function movePos(doc, pos, dir, line) {
    if (dir < 0 && pos.ch == 0) {
      if (pos.line > doc.first) { return clipPos(doc, Pos(pos.line - 1)) }
      else { return null }
    } else if (dir > 0 && pos.ch == (line || getLine(doc, pos.line)).text.length) {
      if (pos.line < doc.first + doc.size - 1) { return Pos(pos.line + 1, 0) }
      else { return null }
    } else {
      return new Pos(pos.line, pos.ch + dir)
    }
  }

  function selectAll(cm) {
    cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);
  }

  // UPDATING

  // Allow "beforeChange" event handlers to influence a change
  function filterChange(doc, change, update) {
    var obj = {
      canceled: false,
      from: change.from,
      to: change.to,
      text: change.text,
      origin: change.origin,
      cancel: function () { return obj.canceled = true; }
    };
    if (update) { obj.update = function (from, to, text, origin) {
      if (from) { obj.from = clipPos(doc, from); }
      if (to) { obj.to = clipPos(doc, to); }
      if (text) { obj.text = text; }
      if (origin !== undefined) { obj.origin = origin; }
    }; }
    signal(doc, "beforeChange", doc, obj);
    if (doc.cm) { signal(doc.cm, "beforeChange", doc.cm, obj); }

    if (obj.canceled) {
      if (doc.cm) { doc.cm.curOp.updateInput = 2; }
      return null
    }
    return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin}
  }

  // Apply a change to a document, and add it to the document's
  // history, and propagating it to all linked documents.
  function makeChange(doc, change, ignoreReadOnly) {
    if (doc.cm) {
      if (!doc.cm.curOp) { return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly) }
      if (doc.cm.state.suppressEdits) { return }
    }

    if (hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange")) {
      change = filterChange(doc, change, true);
      if (!change) { return }
    }

    // Possibly split or suppress the update based on the presence
    // of read-only spans in its range.
    var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);
    if (split) {
      for (var i = split.length - 1; i >= 0; --i)
        { makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [""] : change.text, origin: change.origin}); }
    } else {
      makeChangeInner(doc, change);
    }
  }

  function makeChangeInner(doc, change) {
    if (change.text.length == 1 && change.text[0] == "" && cmp(change.from, change.to) == 0) { return }
    var selAfter = computeSelAfterChange(doc, change);
    addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);

    makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));
    var rebased = [];

    linkedDocs(doc, function (doc, sharedHist) {
      if (!sharedHist && indexOf(rebased, doc.history) == -1) {
        rebaseHist(doc.history, change);
        rebased.push(doc.history);
      }
      makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));
    });
  }

  // Revert a change stored in a document's history.
  function makeChangeFromHistory(doc, type, allowSelectionOnly) {
    var suppress = doc.cm && doc.cm.state.suppressEdits;
    if (suppress && !allowSelectionOnly) { return }

    var hist = doc.history, event, selAfter = doc.sel;
    var source = type == "undo" ? hist.done : hist.undone, dest = type == "undo" ? hist.undone : hist.done;

    // Verify that there is a useable event (so that ctrl-z won't
    // needlessly clear selection events)
    var i = 0;
    for (; i < source.length; i++) {
      event = source[i];
      if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)
        { break }
    }
    if (i == source.length) { return }
    hist.lastOrigin = hist.lastSelOrigin = null;

    for (;;) {
      event = source.pop();
      if (event.ranges) {
        pushSelectionToHistory(event, dest);
        if (allowSelectionOnly && !event.equals(doc.sel)) {
          setSelection(doc, event, {clearRedo: false});
          return
        }
        selAfter = event;
      } else if (suppress) {
        source.push(event);
        return
      } else { break }
    }

    // Build up a reverse change object to add to the opposite history
    // stack (redo when undoing, and vice versa).
    var antiChanges = [];
    pushSelectionToHistory(selAfter, dest);
    dest.push({changes: antiChanges, generation: hist.generation});
    hist.generation = event.generation || ++hist.maxGeneration;

    var filter = hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange");

    var loop = function ( i ) {
      var change = event.changes[i];
      change.origin = type;
      if (filter && !filterChange(doc, change, false)) {
        source.length = 0;
        return {}
      }

      antiChanges.push(historyChangeFromChange(doc, change));

      var after = i ? computeSelAfterChange(doc, change) : lst(source);
      makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));
      if (!i && doc.cm) { doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)}); }
      var rebased = [];

      // Propagate to the linked documents
      linkedDocs(doc, function (doc, sharedHist) {
        if (!sharedHist && indexOf(rebased, doc.history) == -1) {
          rebaseHist(doc.history, change);
          rebased.push(doc.history);
        }
        makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));
      });
    };

    for (var i$1 = event.changes.length - 1; i$1 >= 0; --i$1) {
      var returned = loop( i$1 );

      if ( returned ) return returned.v;
    }
  }

  // Sub-views need their line numbers shifted when text is added
  // above or below them in the parent document.
  function shiftDoc(doc, distance) {
    if (distance == 0) { return }
    doc.first += distance;
    doc.sel = new Selection(map(doc.sel.ranges, function (range) { return new Range(
      Pos(range.anchor.line + distance, range.anchor.ch),
      Pos(range.head.line + distance, range.head.ch)
    ); }), doc.sel.primIndex);
    if (doc.cm) {
      regChange(doc.cm, doc.first, doc.first - distance, distance);
      for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)
        { regLineChange(doc.cm, l, "gutter"); }
    }
  }

  // More lower-level change function, handling only a single document
  // (not linked ones).
  function makeChangeSingleDoc(doc, change, selAfter, spans) {
    if (doc.cm && !doc.cm.curOp)
      { return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans) }

    if (change.to.line < doc.first) {
      shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));
      return
    }
    if (change.from.line > doc.lastLine()) { return }

    // Clip the change to the size of this doc
    if (change.from.line < doc.first) {
      var shift = change.text.length - 1 - (doc.first - change.from.line);
      shiftDoc(doc, shift);
      change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),
                text: [lst(change.text)], origin: change.origin};
    }
    var last = doc.lastLine();
    if (change.to.line > last) {
      change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),
                text: [change.text[0]], origin: change.origin};
    }

    change.removed = getBetween(doc, change.from, change.to);

    if (!selAfter) { selAfter = computeSelAfterChange(doc, change); }
    if (doc.cm) { makeChangeSingleDocInEditor(doc.cm, change, spans); }
    else { updateDoc(doc, change, spans); }
    setSelectionNoUndo(doc, selAfter, sel_dontScroll);

    if (doc.cantEdit && skipAtomic(doc, Pos(doc.firstLine(), 0)))
      { doc.cantEdit = false; }
  }

  // Handle the interaction of a change to a document with the editor
  // that this document is part of.
  function makeChangeSingleDocInEditor(cm, change, spans) {
    var doc = cm.doc, display = cm.display, from = change.from, to = change.to;

    var recomputeMaxLength = false, checkWidthStart = from.line;
    if (!cm.options.lineWrapping) {
      checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));
      doc.iter(checkWidthStart, to.line + 1, function (line) {
        if (line == display.maxLine) {
          recomputeMaxLength = true;
          return true
        }
      });
    }

    if (doc.sel.contains(change.from, change.to) > -1)
      { signalCursorActivity(cm); }

    updateDoc(doc, change, spans, estimateHeight(cm));

    if (!cm.options.lineWrapping) {
      doc.iter(checkWidthStart, from.line + change.text.length, function (line) {
        var len = lineLength(line);
        if (len > display.maxLineLength) {
          display.maxLine = line;
          display.maxLineLength = len;
          display.maxLineChanged = true;
          recomputeMaxLength = false;
        }
      });
      if (recomputeMaxLength) { cm.curOp.updateMaxLine = true; }
    }

    retreatFrontier(doc, from.line);
    startWorker(cm, 400);

    var lendiff = change.text.length - (to.line - from.line) - 1;
    // Remember that these lines changed, for updating the display
    if (change.full)
      { regChange(cm); }
    else if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))
      { regLineChange(cm, from.line, "text"); }
    else
      { regChange(cm, from.line, to.line + 1, lendiff); }

    var changesHandler = hasHandler(cm, "changes"), changeHandler = hasHandler(cm, "change");
    if (changeHandler || changesHandler) {
      var obj = {
        from: from, to: to,
        text: change.text,
        removed: change.removed,
        origin: change.origin
      };
      if (changeHandler) { signalLater(cm, "change", cm, obj); }
      if (changesHandler) { (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj); }
    }
    cm.display.selForContextMenu = null;
  }

  function replaceRange(doc, code, from, to, origin) {
    var assign;

    if (!to) { to = from; }
    if (cmp(to, from) < 0) { (assign = [to, from], from = assign[0], to = assign[1]); }
    if (typeof code == "string") { code = doc.splitLines(code); }
    makeChange(doc, {from: from, to: to, text: code, origin: origin});
  }

  // Rebasing/resetting history to deal with externally-sourced changes

  function rebaseHistSelSingle(pos, from, to, diff) {
    if (to < pos.line) {
      pos.line += diff;
    } else if (from < pos.line) {
      pos.line = from;
      pos.ch = 0;
    }
  }

  // Tries to rebase an array of history events given a change in the
  // document. If the change touches the same lines as the event, the
  // event, and everything 'behind' it, is discarded. If the change is
  // before the event, the event's positions are updated. Uses a
  // copy-on-write scheme for the positions, to avoid having to
  // reallocate them all on every rebase, but also avoid problems with
  // shared position objects being unsafely updated.
  function rebaseHistArray(array, from, to, diff) {
    for (var i = 0; i < array.length; ++i) {
      var sub = array[i], ok = true;
      if (sub.ranges) {
        if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }
        for (var j = 0; j < sub.ranges.length; j++) {
          rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);
          rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);
        }
        continue
      }
      for (var j$1 = 0; j$1 < sub.changes.length; ++j$1) {
        var cur = sub.changes[j$1];
        if (to < cur.from.line) {
          cur.from = Pos(cur.from.line + diff, cur.from.ch);
          cur.to = Pos(cur.to.line + diff, cur.to.ch);
        } else if (from <= cur.to.line) {
          ok = false;
          break
        }
      }
      if (!ok) {
        array.splice(0, i + 1);
        i = 0;
      }
    }
  }

  function rebaseHist(hist, change) {
    var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;
    rebaseHistArray(hist.done, from, to, diff);
    rebaseHistArray(hist.undone, from, to, diff);
  }

  // Utility for applying a change to a line by handle or number,
  // returning the number and optionally registering the line as
  // changed.
  function changeLine(doc, handle, changeType, op) {
    var no = handle, line = handle;
    if (typeof handle == "number") { line = getLine(doc, clipLine(doc, handle)); }
    else { no = lineNo(handle); }
    if (no == null) { return null }
    if (op(line, no) && doc.cm) { regLineChange(doc.cm, no, changeType); }
    return line
  }

  // The document is represented as a BTree consisting of leaves, with
  // chunk of lines in them, and branches, with up to ten leaves or
  // other branch nodes below them. The top node is always a branch
  // node, and is the document object itself (meaning it has
  // additional methods and properties).
  //
  // All nodes have parent links. The tree is used both to go from
  // line numbers to line objects, and to go from objects to numbers.
  // It also indexes by height, and is used to convert between height
  // and line object, and to find the total height of the document.
  //
  // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html

  function LeafChunk(lines) {
    this.lines = lines;
    this.parent = null;
    var height = 0;
    for (var i = 0; i < lines.length; ++i) {
      lines[i].parent = this;
      height += lines[i].height;
    }
    this.height = height;
  }

  LeafChunk.prototype = {
    chunkSize: function() { return this.lines.length },

    // Remove the n lines at offset 'at'.
    removeInner: function(at, n) {
      for (var i = at, e = at + n; i < e; ++i) {
        var line = this.lines[i];
        this.height -= line.height;
        cleanUpLine(line);
        signalLater(line, "delete");
      }
      this.lines.splice(at, n);
    },

    // Helper used to collapse a small branch into a single leaf.
    collapse: function(lines) {
      lines.push.apply(lines, this.lines);
    },

    // Insert the given array of lines at offset 'at', count them as
    // having the given height.
    insertInner: function(at, lines, height) {
      this.height += height;
      this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));
      for (var i = 0; i < lines.length; ++i) { lines[i].parent = this; }
    },

    // Used to iterate over a part of the tree.
    iterN: function(at, n, op) {
      for (var e = at + n; at < e; ++at)
        { if (op(this.lines[at])) { return true } }
    }
  };

  function BranchChunk(children) {
    this.children = children;
    var size = 0, height = 0;
    for (var i = 0; i < children.length; ++i) {
      var ch = children[i];
      size += ch.chunkSize(); height += ch.height;
      ch.parent = this;
    }
    this.size = size;
    this.height = height;
    this.parent = null;
  }

  BranchChunk.prototype = {
    chunkSize: function() { return this.size },

    removeInner: function(at, n) {
      this.size -= n;
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at < sz) {
          var rm = Math.min(n, sz - at), oldHeight = child.height;
          child.removeInner(at, rm);
          this.height -= oldHeight - child.height;
          if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }
          if ((n -= rm) == 0) { break }
          at = 0;
        } else { at -= sz; }
      }
      // If the result is smaller than 25 lines, ensure that it is a
      // single leaf node.
      if (this.size - n < 25 &&
          (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {
        var lines = [];
        this.collapse(lines);
        this.children = [new LeafChunk(lines)];
        this.children[0].parent = this;
      }
    },

    collapse: function(lines) {
      for (var i = 0; i < this.children.length; ++i) { this.children[i].collapse(lines); }
    },

    insertInner: function(at, lines, height) {
      this.size += lines.length;
      this.height += height;
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at <= sz) {
          child.insertInner(at, lines, height);
          if (child.lines && child.lines.length > 50) {
            // To avoid memory thrashing when child.lines is huge (e.g. first view of a large file), it's never spliced.
            // Instead, small slices are taken. They're taken in order because sequential memory accesses are fastest.
            var remaining = child.lines.length % 25 + 25;
            for (var pos = remaining; pos < child.lines.length;) {
              var leaf = new LeafChunk(child.lines.slice(pos, pos += 25));
              child.height -= leaf.height;
              this.children.splice(++i, 0, leaf);
              leaf.parent = this;
            }
            child.lines = child.lines.slice(0, remaining);
            this.maybeSpill();
          }
          break
        }
        at -= sz;
      }
    },

    // When a node has grown, check whether it should be split.
    maybeSpill: function() {
      if (this.children.length <= 10) { return }
      var me = this;
      do {
        var spilled = me.children.splice(me.children.length - 5, 5);
        var sibling = new BranchChunk(spilled);
        if (!me.parent) { // Become the parent node
          var copy = new BranchChunk(me.children);
          copy.parent = me;
          me.children = [copy, sibling];
          me = copy;
       } else {
          me.size -= sibling.size;
          me.height -= sibling.height;
          var myIndex = indexOf(me.parent.children, me);
          me.parent.children.splice(myIndex + 1, 0, sibling);
        }
        sibling.parent = me.parent;
      } while (me.children.length > 10)
      me.parent.maybeSpill();
    },

    iterN: function(at, n, op) {
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at < sz) {
          var used = Math.min(n, sz - at);
          if (child.iterN(at, used, op)) { return true }
          if ((n -= used) == 0) { break }
          at = 0;
        } else { at -= sz; }
      }
    }
  };

  // Line widgets are block elements displayed above or below a line.

  var LineWidget = function(doc, node, options) {
    if (options) { for (var opt in options) { if (options.hasOwnProperty(opt))
      { this[opt] = options[opt]; } } }
    this.doc = doc;
    this.node = node;
  };

  LineWidget.prototype.clear = function () {
    var cm = this.doc.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);
    if (no == null || !ws) { return }
    for (var i = 0; i < ws.length; ++i) { if (ws[i] == this) { ws.splice(i--, 1); } }
    if (!ws.length) { line.widgets = null; }
    var height = widgetHeight(this);
    updateLineHeight(line, Math.max(0, line.height - height));
    if (cm) {
      runInOp(cm, function () {
        adjustScrollWhenAboveVisible(cm, line, -height);
        regLineChange(cm, no, "widget");
      });
      signalLater(cm, "lineWidgetCleared", cm, this, no);
    }
  };

  LineWidget.prototype.changed = function () {
      var this$1 = this;

    var oldH = this.height, cm = this.doc.cm, line = this.line;
    this.height = null;
    var diff = widgetHeight(this) - oldH;
    if (!diff) { return }
    if (!lineIsHidden(this.doc, line)) { updateLineHeight(line, line.height + diff); }
    if (cm) {
      runInOp(cm, function () {
        cm.curOp.forceUpdate = true;
        adjustScrollWhenAboveVisible(cm, line, diff);
        signalLater(cm, "lineWidgetChanged", cm, this$1, lineNo(line));
      });
    }
  };
  eventMixin(LineWidget);

  function adjustScrollWhenAboveVisible(cm, line, diff) {
    if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))
      { addToScrollTop(cm, diff); }
  }

  function addLineWidget(doc, handle, node, options) {
    var widget = new LineWidget(doc, node, options);
    var cm = doc.cm;
    if (cm && widget.noHScroll) { cm.display.alignWidgets = true; }
    changeLine(doc, handle, "widget", function (line) {
      var widgets = line.widgets || (line.widgets = []);
      if (widget.insertAt == null) { widgets.push(widget); }
      else { widgets.splice(Math.min(widgets.length, Math.max(0, widget.insertAt)), 0, widget); }
      widget.line = line;
      if (cm && !lineIsHidden(doc, line)) {
        var aboveVisible = heightAtLine(line) < doc.scrollTop;
        updateLineHeight(line, line.height + widgetHeight(widget));
        if (aboveVisible) { addToScrollTop(cm, widget.height); }
        cm.curOp.forceUpdate = true;
      }
      return true
    });
    if (cm) { signalLater(cm, "lineWidgetAdded", cm, widget, typeof handle == "number" ? handle : lineNo(handle)); }
    return widget
  }

  // TEXTMARKERS

  // Created with markText and setBookmark methods. A TextMarker is a
  // handle that can be used to clear or find a marked position in the
  // document. Line objects hold arrays (markedSpans) containing
  // {from, to, marker} object pointing to such marker objects, and
  // indicating that such a marker is present on that line. Multiple
  // lines may point to the same marker when it spans across lines.
  // The spans will have null for their from/to properties when the
  // marker continues beyond the start/end of the line. Markers have
  // links back to the lines they currently touch.

  // Collapsed markers have unique ids, in order to be able to order
  // them, which is needed for uniquely determining an outer marker
  // when they overlap (they may nest, but not partially overlap).
  var nextMarkerId = 0;

  var TextMarker = function(doc, type) {
    this.lines = [];
    this.type = type;
    this.doc = doc;
    this.id = ++nextMarkerId;
  };

  // Clear the marker.
  TextMarker.prototype.clear = function () {
    if (this.explicitlyCleared) { return }
    var cm = this.doc.cm, withOp = cm && !cm.curOp;
    if (withOp) { startOperation(cm); }
    if (hasHandler(this, "clear")) {
      var found = this.find();
      if (found) { signalLater(this, "clear", found.from, found.to); }
    }
    var min = null, max = null;
    for (var i = 0; i < this.lines.length; ++i) {
      var line = this.lines[i];
      var span = getMarkedSpanFor(line.markedSpans, this);
      if (cm && !this.collapsed) { regLineChange(cm, lineNo(line), "text"); }
      else if (cm) {
        if (span.to != null) { max = lineNo(line); }
        if (span.from != null) { min = lineNo(line); }
      }
      line.markedSpans = removeMarkedSpan(line.markedSpans, span);
      if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)
        { updateLineHeight(line, textHeight(cm.display)); }
    }
    if (cm && this.collapsed && !cm.options.lineWrapping) { for (var i$1 = 0; i$1 < this.lines.length; ++i$1) {
      var visual = visualLine(this.lines[i$1]), len = lineLength(visual);
      if (len > cm.display.maxLineLength) {
        cm.display.maxLine = visual;
        cm.display.maxLineLength = len;
        cm.display.maxLineChanged = true;
      }
    } }

    if (min != null && cm && this.collapsed) { regChange(cm, min, max + 1); }
    this.lines.length = 0;
    this.explicitlyCleared = true;
    if (this.atomic && this.doc.cantEdit) {
      this.doc.cantEdit = false;
      if (cm) { reCheckSelection(cm.doc); }
    }
    if (cm) { signalLater(cm, "markerCleared", cm, this, min, max); }
    if (withOp) { endOperation(cm); }
    if (this.parent) { this.parent.clear(); }
  };

  // Find the position of the marker in the document. Returns a {from,
  // to} object by default. Side can be passed to get a specific side
  // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the
  // Pos objects returned contain a line object, rather than a line
  // number (used to prevent looking up the same line twice).
  TextMarker.prototype.find = function (side, lineObj) {
    if (side == null && this.type == "bookmark") { side = 1; }
    var from, to;
    for (var i = 0; i < this.lines.length; ++i) {
      var line = this.lines[i];
      var span = getMarkedSpanFor(line.markedSpans, this);
      if (span.from != null) {
        from = Pos(lineObj ? line : lineNo(line), span.from);
        if (side == -1) { return from }
      }
      if (span.to != null) {
        to = Pos(lineObj ? line : lineNo(line), span.to);
        if (side == 1) { return to }
      }
    }
    return from && {from: from, to: to}
  };

  // Signals that the marker's widget changed, and surrounding layout
  // should be recomputed.
  TextMarker.prototype.changed = function () {
      var this$1 = this;

    var pos = this.find(-1, true), widget = this, cm = this.doc.cm;
    if (!pos || !cm) { return }
    runInOp(cm, function () {
      var line = pos.line, lineN = lineNo(pos.line);
      var view = findViewForLine(cm, lineN);
      if (view) {
        clearLineMeasurementCacheFor(view);
        cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;
      }
      cm.curOp.updateMaxLine = true;
      if (!lineIsHidden(widget.doc, line) && widget.height != null) {
        var oldHeight = widget.height;
        widget.height = null;
        var dHeight = widgetHeight(widget) - oldHeight;
        if (dHeight)
          { updateLineHeight(line, line.height + dHeight); }
      }
      signalLater(cm, "markerChanged", cm, this$1);
    });
  };

  TextMarker.prototype.attachLine = function (line) {
    if (!this.lines.length && this.doc.cm) {
      var op = this.doc.cm.curOp;
      if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)
        { (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this); }
    }
    this.lines.push(line);
  };

  TextMarker.prototype.detachLine = function (line) {
    this.lines.splice(indexOf(this.lines, line), 1);
    if (!this.lines.length && this.doc.cm) {
      var op = this.doc.cm.curOp
      ;(op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);
    }
  };
  eventMixin(TextMarker);

  // Create a marker, wire it up to the right lines, and
  function markText(doc, from, to, options, type) {
    // Shared markers (across linked documents) are handled separately
    // (markTextShared will call out to this again, once per
    // document).
    if (options && options.shared) { return markTextShared(doc, from, to, options, type) }
    // Ensure we are in an operation.
    if (doc.cm && !doc.cm.curOp) { return operation(doc.cm, markText)(doc, from, to, options, type) }

    var marker = new TextMarker(doc, type), diff = cmp(from, to);
    if (options) { copyObj(options, marker, false); }
    // Don't connect empty markers unless clearWhenEmpty is false
    if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)
      { return marker }
    if (marker.replacedWith) {
      // Showing up as a widget implies collapsed (widget replaces text)
      marker.collapsed = true;
      marker.widgetNode = eltP("span", [marker.replacedWith], "CodeMirror-widget");
      if (!options.handleMouseEvents) { marker.widgetNode.setAttribute("cm-ignore-events", "true"); }
      if (options.insertLeft) { marker.widgetNode.insertLeft = true; }
    }
    if (marker.collapsed) {
      if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||
          from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))
        { throw new Error("Inserting collapsed marker partially overlapping an existing one") }
      seeCollapsedSpans();
    }

    if (marker.addToHistory)
      { addChangeToHistory(doc, {from: from, to: to, origin: "markText"}, doc.sel, NaN); }

    var curLine = from.line, cm = doc.cm, updateMaxLine;
    doc.iter(curLine, to.line + 1, function (line) {
      if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)
        { updateMaxLine = true; }
      if (marker.collapsed && curLine != from.line) { updateLineHeight(line, 0); }
      addMarkedSpan(line, new MarkedSpan(marker,
                                         curLine == from.line ? from.ch : null,
                                         curLine == to.line ? to.ch : null), doc.cm && doc.cm.curOp);
      ++curLine;
    });
    // lineIsHidden depends on the presence of the spans, so needs a second pass
    if (marker.collapsed) { doc.iter(from.line, to.line + 1, function (line) {
      if (lineIsHidden(doc, line)) { updateLineHeight(line, 0); }
    }); }

    if (marker.clearOnEnter) { on(marker, "beforeCursorEnter", function () { return marker.clear(); }); }

    if (marker.readOnly) {
      seeReadOnlySpans();
      if (doc.history.done.length || doc.history.undone.length)
        { doc.clearHistory(); }
    }
    if (marker.collapsed) {
      marker.id = ++nextMarkerId;
      marker.atomic = true;
    }
    if (cm) {
      // Sync editor state
      if (updateMaxLine) { cm.curOp.updateMaxLine = true; }
      if (marker.collapsed)
        { regChange(cm, from.line, to.line + 1); }
      else if (marker.className || marker.startStyle || marker.endStyle || marker.css ||
               marker.attributes || marker.title)
        { for (var i = from.line; i <= to.line; i++) { regLineChange(cm, i, "text"); } }
      if (marker.atomic) { reCheckSelection(cm.doc); }
      signalLater(cm, "markerAdded", cm, marker);
    }
    return marker
  }

  // SHARED TEXTMARKERS

  // A shared marker spans multiple linked documents. It is
  // implemented as a meta-marker-object controlling multiple normal
  // markers.
  var SharedTextMarker = function(markers, primary) {
    this.markers = markers;
    this.primary = primary;
    for (var i = 0; i < markers.length; ++i)
      { markers[i].parent = this; }
  };

  SharedTextMarker.prototype.clear = function () {
    if (this.explicitlyCleared) { return }
    this.explicitlyCleared = true;
    for (var i = 0; i < this.markers.length; ++i)
      { this.markers[i].clear(); }
    signalLater(this, "clear");
  };

  SharedTextMarker.prototype.find = function (side, lineObj) {
    return this.primary.find(side, lineObj)
  };
  eventMixin(SharedTextMarker);

  function markTextShared(doc, from, to, options, type) {
    options = copyObj(options);
    options.shared = false;
    var markers = [markText(doc, from, to, options, type)], primary = markers[0];
    var widget = options.widgetNode;
    linkedDocs(doc, function (doc) {
      if (widget) { options.widgetNode = widget.cloneNode(true); }
      markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));
      for (var i = 0; i < doc.linked.length; ++i)
        { if (doc.linked[i].isParent) { return } }
      primary = lst(markers);
    });
    return new SharedTextMarker(markers, primary)
  }

  function findSharedMarkers(doc) {
    return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())), function (m) { return m.parent; })
  }

  function copySharedMarkers(doc, markers) {
    for (var i = 0; i < markers.length; i++) {
      var marker = markers[i], pos = marker.find();
      var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);
      if (cmp(mFrom, mTo)) {
        var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);
        marker.markers.push(subMark);
        subMark.parent = marker;
      }
    }
  }

  function detachSharedMarkers(markers) {
    var loop = function ( i ) {
      var marker = markers[i], linked = [marker.primary.doc];
      linkedDocs(marker.primary.doc, function (d) { return linked.push(d); });
      for (var j = 0; j < marker.markers.length; j++) {
        var subMarker = marker.markers[j];
        if (indexOf(linked, subMarker.doc) == -1) {
          subMarker.parent = null;
          marker.markers.splice(j--, 1);
        }
      }
    };

    for (var i = 0; i < markers.length; i++) loop( i );
  }

  var nextDocId = 0;
  var Doc = function(text, mode, firstLine, lineSep, direction) {
    if (!(this instanceof Doc)) { return new Doc(text, mode, firstLine, lineSep, direction) }
    if (firstLine == null) { firstLine = 0; }

    BranchChunk.call(this, [new LeafChunk([new Line("", null)])]);
    this.first = firstLine;
    this.scrollTop = this.scrollLeft = 0;
    this.cantEdit = false;
    this.cleanGeneration = 1;
    this.modeFrontier = this.highlightFrontier = firstLine;
    var start = Pos(firstLine, 0);
    this.sel = simpleSelection(start);
    this.history = new History(null);
    this.id = ++nextDocId;
    this.modeOption = mode;
    this.lineSep = lineSep;
    this.direction = (direction == "rtl") ? "rtl" : "ltr";
    this.extend = false;

    if (typeof text == "string") { text = this.splitLines(text); }
    updateDoc(this, {from: start, to: start, text: text});
    setSelection(this, simpleSelection(start), sel_dontScroll);
  };

  Doc.prototype = createObj(BranchChunk.prototype, {
    constructor: Doc,
    // Iterate over the document. Supports two forms -- with only one
    // argument, it calls that for each line in the document. With
    // three, it iterates over the range given by the first two (with
    // the second being non-inclusive).
    iter: function(from, to, op) {
      if (op) { this.iterN(from - this.first, to - from, op); }
      else { this.iterN(this.first, this.first + this.size, from); }
    },

    // Non-public interface for adding and removing lines.
    insert: function(at, lines) {
      var height = 0;
      for (var i = 0; i < lines.length; ++i) { height += lines[i].height; }
      this.insertInner(at - this.first, lines, height);
    },
    remove: function(at, n) { this.removeInner(at - this.first, n); },

    // From here, the methods are part of the public interface. Most
    // are also available from CodeMirror (editor) instances.

    getValue: function(lineSep) {
      var lines = getLines(this, this.first, this.first + this.size);
      if (lineSep === false) { return lines }
      return lines.join(lineSep || this.lineSeparator())
    },
    setValue: docMethodOp(function(code) {
      var top = Pos(this.first, 0), last = this.first + this.size - 1;
      makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),
                        text: this.splitLines(code), origin: "setValue", full: true}, true);
      if (this.cm) { scrollToCoords(this.cm, 0, 0); }
      setSelection(this, simpleSelection(top), sel_dontScroll);
    }),
    replaceRange: function(code, from, to, origin) {
      from = clipPos(this, from);
      to = to ? clipPos(this, to) : from;
      replaceRange(this, code, from, to, origin);
    },
    getRange: function(from, to, lineSep) {
      var lines = getBetween(this, clipPos(this, from), clipPos(this, to));
      if (lineSep === false) { return lines }
      if (lineSep === '') { return lines.join('') }
      return lines.join(lineSep || this.lineSeparator())
    },

    getLine: function(line) {var l = this.getLineHandle(line); return l && l.text},

    getLineHandle: function(line) {if (isLine(this, line)) { return getLine(this, line) }},
    getLineNumber: function(line) {return lineNo(line)},

    getLineHandleVisualStart: function(line) {
      if (typeof line == "number") { line = getLine(this, line); }
      return visualLine(line)
    },

    lineCount: function() {return this.size},
    firstLine: function() {return this.first},
    lastLine: function() {return this.first + this.size - 1},

    clipPos: function(pos) {return clipPos(this, pos)},

    getCursor: function(start) {
      var range = this.sel.primary(), pos;
      if (start == null || start == "head") { pos = range.head; }
      else if (start == "anchor") { pos = range.anchor; }
      else if (start == "end" || start == "to" || start === false) { pos = range.to(); }
      else { pos = range.from(); }
      return pos
    },
    listSelections: function() { return this.sel.ranges },
    somethingSelected: function() {return this.sel.somethingSelected()},

    setCursor: docMethodOp(function(line, ch, options) {
      setSimpleSelection(this, clipPos(this, typeof line == "number" ? Pos(line, ch || 0) : line), null, options);
    }),
    setSelection: docMethodOp(function(anchor, head, options) {
      setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);
    }),
    extendSelection: docMethodOp(function(head, other, options) {
      extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);
    }),
    extendSelections: docMethodOp(function(heads, options) {
      extendSelections(this, clipPosArray(this, heads), options);
    }),
    extendSelectionsBy: docMethodOp(function(f, options) {
      var heads = map(this.sel.ranges, f);
      extendSelections(this, clipPosArray(this, heads), options);
    }),
    setSelections: docMethodOp(function(ranges, primary, options) {
      if (!ranges.length) { return }
      var out = [];
      for (var i = 0; i < ranges.length; i++)
        { out[i] = new Range(clipPos(this, ranges[i].anchor),
                           clipPos(this, ranges[i].head || ranges[i].anchor)); }
      if (primary == null) { primary = Math.min(ranges.length - 1, this.sel.primIndex); }
      setSelection(this, normalizeSelection(this.cm, out, primary), options);
    }),
    addSelection: docMethodOp(function(anchor, head, options) {
      var ranges = this.sel.ranges.slice(0);
      ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));
      setSelection(this, normalizeSelection(this.cm, ranges, ranges.length - 1), options);
    }),

    getSelection: function(lineSep) {
      var ranges = this.sel.ranges, lines;
      for (var i = 0; i < ranges.length; i++) {
        var sel = getBetween(this, ranges[i].from(), ranges[i].to());
        lines = lines ? lines.concat(sel) : sel;
      }
      if (lineSep === false) { return lines }
      else { return lines.join(lineSep || this.lineSeparator()) }
    },
    getSelections: function(lineSep) {
      var parts = [], ranges = this.sel.ranges;
      for (var i = 0; i < ranges.length; i++) {
        var sel = getBetween(this, ranges[i].from(), ranges[i].to());
        if (lineSep !== false) { sel = sel.join(lineSep || this.lineSeparator()); }
        parts[i] = sel;
      }
      return parts
    },
    replaceSelection: function(code, collapse, origin) {
      var dup = [];
      for (var i = 0; i < this.sel.ranges.length; i++)
        { dup[i] = code; }
      this.replaceSelections(dup, collapse, origin || "+input");
    },
    replaceSelections: docMethodOp(function(code, collapse, origin) {
      var changes = [], sel = this.sel;
      for (var i = 0; i < sel.ranges.length; i++) {
        var range = sel.ranges[i];
        changes[i] = {from: range.from(), to: range.to(), text: this.splitLines(code[i]), origin: origin};
      }
      var newSel = collapse && collapse != "end" && computeReplacedSel(this, changes, collapse);
      for (var i$1 = changes.length - 1; i$1 >= 0; i$1--)
        { makeChange(this, changes[i$1]); }
      if (newSel) { setSelectionReplaceHistory(this, newSel); }
      else if (this.cm) { ensureCursorVisible(this.cm); }
    }),
    undo: docMethodOp(function() {makeChangeFromHistory(this, "undo");}),
    redo: docMethodOp(function() {makeChangeFromHistory(this, "redo");}),
    undoSelection: docMethodOp(function() {makeChangeFromHistory(this, "undo", true);}),
    redoSelection: docMethodOp(function() {makeChangeFromHistory(this, "redo", true);}),

    setExtending: function(val) {this.extend = val;},
    getExtending: function() {return this.extend},

    historySize: function() {
      var hist = this.history, done = 0, undone = 0;
      for (var i = 0; i < hist.done.length; i++) { if (!hist.done[i].ranges) { ++done; } }
      for (var i$1 = 0; i$1 < hist.undone.length; i$1++) { if (!hist.undone[i$1].ranges) { ++undone; } }
      return {undo: done, redo: undone}
    },
    clearHistory: function() {
      var this$1 = this;

      this.history = new History(this.history);
      linkedDocs(this, function (doc) { return doc.history = this$1.history; }, true);
    },

    markClean: function() {
      this.cleanGeneration = this.changeGeneration(true);
    },
    changeGeneration: function(forceSplit) {
      if (forceSplit)
        { this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null; }
      return this.history.generation
    },
    isClean: function (gen) {
      return this.history.generation == (gen || this.cleanGeneration)
    },

    getHistory: function() {
      return {done: copyHistoryArray(this.history.done),
              undone: copyHistoryArray(this.history.undone)}
    },
    setHistory: function(histData) {
      var hist = this.history = new History(this.history);
      hist.done = copyHistoryArray(histData.done.slice(0), null, true);
      hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);
    },

    setGutterMarker: docMethodOp(function(line, gutterID, value) {
      return changeLine(this, line, "gutter", function (line) {
        var markers = line.gutterMarkers || (line.gutterMarkers = {});
        markers[gutterID] = value;
        if (!value && isEmpty(markers)) { line.gutterMarkers = null; }
        return true
      })
    }),

    clearGutter: docMethodOp(function(gutterID) {
      var this$1 = this;

      this.iter(function (line) {
        if (line.gutterMarkers && line.gutterMarkers[gutterID]) {
          changeLine(this$1, line, "gutter", function () {
            line.gutterMarkers[gutterID] = null;
            if (isEmpty(line.gutterMarkers)) { line.gutterMarkers = null; }
            return true
          });
        }
      });
    }),

    lineInfo: function(line) {
      var n;
      if (typeof line == "number") {
        if (!isLine(this, line)) { return null }
        n = line;
        line = getLine(this, line);
        if (!line) { return null }
      } else {
        n = lineNo(line);
        if (n == null) { return null }
      }
      return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,
              textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,
              widgets: line.widgets}
    },

    addLineClass: docMethodOp(function(handle, where, cls) {
      return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function (line) {
        var prop = where == "text" ? "textClass"
                 : where == "background" ? "bgClass"
                 : where == "gutter" ? "gutterClass" : "wrapClass";
        if (!line[prop]) { line[prop] = cls; }
        else if (classTest(cls).test(line[prop])) { return false }
        else { line[prop] += " " + cls; }
        return true
      })
    }),
    removeLineClass: docMethodOp(function(handle, where, cls) {
      return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function (line) {
        var prop = where == "text" ? "textClass"
                 : where == "background" ? "bgClass"
                 : where == "gutter" ? "gutterClass" : "wrapClass";
        var cur = line[prop];
        if (!cur) { return false }
        else if (cls == null) { line[prop] = null; }
        else {
          var found = cur.match(classTest(cls));
          if (!found) { return false }
          var end = found.index + found[0].length;
          line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? "" : " ") + cur.slice(end) || null;
        }
        return true
      })
    }),

    addLineWidget: docMethodOp(function(handle, node, options) {
      return addLineWidget(this, handle, node, options)
    }),
    removeLineWidget: function(widget) { widget.clear(); },

    markText: function(from, to, options) {
      return markText(this, clipPos(this, from), clipPos(this, to), options, options && options.type || "range")
    },
    setBookmark: function(pos, options) {
      var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),
                      insertLeft: options && options.insertLeft,
                      clearWhenEmpty: false, shared: options && options.shared,
                      handleMouseEvents: options && options.handleMouseEvents};
      pos = clipPos(this, pos);
      return markText(this, pos, pos, realOpts, "bookmark")
    },
    findMarksAt: function(pos) {
      pos = clipPos(this, pos);
      var markers = [], spans = getLine(this, pos.line).markedSpans;
      if (spans) { for (var i = 0; i < spans.length; ++i) {
        var span = spans[i];
        if ((span.from == null || span.from <= pos.ch) &&
            (span.to == null || span.to >= pos.ch))
          { markers.push(span.marker.parent || span.marker); }
      } }
      return markers
    },
    findMarks: function(from, to, filter) {
      from = clipPos(this, from); to = clipPos(this, to);
      var found = [], lineNo = from.line;
      this.iter(from.line, to.line + 1, function (line) {
        var spans = line.markedSpans;
        if (spans) { for (var i = 0; i < spans.length; i++) {
          var span = spans[i];
          if (!(span.to != null && lineNo == from.line && from.ch >= span.to ||
                span.from == null && lineNo != from.line ||
                span.from != null && lineNo == to.line && span.from >= to.ch) &&
              (!filter || filter(span.marker)))
            { found.push(span.marker.parent || span.marker); }
        } }
        ++lineNo;
      });
      return found
    },
    getAllMarks: function() {
      var markers = [];
      this.iter(function (line) {
        var sps = line.markedSpans;
        if (sps) { for (var i = 0; i < sps.length; ++i)
          { if (sps[i].from != null) { markers.push(sps[i].marker); } } }
      });
      return markers
    },

    posFromIndex: function(off) {
      var ch, lineNo = this.first, sepSize = this.lineSeparator().length;
      this.iter(function (line) {
        var sz = line.text.length + sepSize;
        if (sz > off) { ch = off; return true }
        off -= sz;
        ++lineNo;
      });
      return clipPos(this, Pos(lineNo, ch))
    },
    indexFromPos: function (coords) {
      coords = clipPos(this, coords);
      var index = coords.ch;
      if (coords.line < this.first || coords.ch < 0) { return 0 }
      var sepSize = this.lineSeparator().length;
      this.iter(this.first, coords.line, function (line) { // iter aborts when callback returns a truthy value
        index += line.text.length + sepSize;
      });
      return index
    },

    copy: function(copyHistory) {
      var doc = new Doc(getLines(this, this.first, this.first + this.size),
                        this.modeOption, this.first, this.lineSep, this.direction);
      doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;
      doc.sel = this.sel;
      doc.extend = false;
      if (copyHistory) {
        doc.history.undoDepth = this.history.undoDepth;
        doc.setHistory(this.getHistory());
      }
      return doc
    },

    linkedDoc: function(options) {
      if (!options) { options = {}; }
      var from = this.first, to = this.first + this.size;
      if (options.from != null && options.from > from) { from = options.from; }
      if (options.to != null && options.to < to) { to = options.to; }
      var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from, this.lineSep, this.direction);
      if (options.sharedHist) { copy.history = this.history
      ; }(this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});
      copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];
      copySharedMarkers(copy, findSharedMarkers(this));
      return copy
    },
    unlinkDoc: function(other) {
      if (other instanceof CodeMirror) { other = other.doc; }
      if (this.linked) { for (var i = 0; i < this.linked.length; ++i) {
        var link = this.linked[i];
        if (link.doc != other) { continue }
        this.linked.splice(i, 1);
        other.unlinkDoc(this);
        detachSharedMarkers(findSharedMarkers(this));
        break
      } }
      // If the histories were shared, split them again
      if (other.history == this.history) {
        var splitIds = [other.id];
        linkedDocs(other, function (doc) { return splitIds.push(doc.id); }, true);
        other.history = new History(null);
        other.history.done = copyHistoryArray(this.history.done, splitIds);
        other.history.undone = copyHistoryArray(this.history.undone, splitIds);
      }
    },
    iterLinkedDocs: function(f) {linkedDocs(this, f);},

    getMode: function() {return this.mode},
    getEditor: function() {return this.cm},

    splitLines: function(str) {
      if (this.lineSep) { return str.split(this.lineSep) }
      return splitLinesAuto(str)
    },
    lineSeparator: function() { return this.lineSep || "\n" },

    setDirection: docMethodOp(function (dir) {
      if (dir != "rtl") { dir = "ltr"; }
      if (dir == this.direction) { return }
      this.direction = dir;
      this.iter(function (line) { return line.order = null; });
      if (this.cm) { directionChanged(this.cm); }
    })
  });

  // Public alias.
  Doc.prototype.eachLine = Doc.prototype.iter;

  // Kludge to work around strange IE behavior where it'll sometimes
  // re-fire a series of drag-related events right after the drop (#1551)
  var lastDrop = 0;

  function onDrop(e) {
    var cm = this;
    clearDragCursor(cm);
    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))
      { return }
    e_preventDefault(e);
    if (ie) { lastDrop = +new Date; }
    var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;
    if (!pos || cm.isReadOnly()) { return }
    // Might be a file drop, in which case we simply extract the text
    // and insert it.
    if (files && files.length && window.FileReader && window.File) {
      var n = files.length, text = Array(n), read = 0;
      var markAsReadAndPasteIfAllFilesAreRead = function () {
        if (++read == n) {
          operation(cm, function () {
            pos = clipPos(cm.doc, pos);
            var change = {from: pos, to: pos,
                          text: cm.doc.splitLines(
                              text.filter(function (t) { return t != null; }).join(cm.doc.lineSeparator())),
                          origin: "paste"};
            makeChange(cm.doc, change);
            setSelectionReplaceHistory(cm.doc, simpleSelection(clipPos(cm.doc, pos), clipPos(cm.doc, changeEnd(change))));
          })();
        }
      };
      var readTextFromFile = function (file, i) {
        if (cm.options.allowDropFileTypes &&
            indexOf(cm.options.allowDropFileTypes, file.type) == -1) {
          markAsReadAndPasteIfAllFilesAreRead();
          return
        }
        var reader = new FileReader;
        reader.onerror = function () { return markAsReadAndPasteIfAllFilesAreRead(); };
        reader.onload = function () {
          var content = reader.result;
          if (/[\x00-\x08\x0e-\x1f]{2}/.test(content)) {
            markAsReadAndPasteIfAllFilesAreRead();
            return
          }
          text[i] = content;
          markAsReadAndPasteIfAllFilesAreRead();
        };
        reader.readAsText(file);
      };
      for (var i = 0; i < files.length; i++) { readTextFromFile(files[i], i); }
    } else { // Normal drop
      // Don't do a replace if the drop happened inside of the selected text.
      if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {
        cm.state.draggingText(e);
        // Ensure the editor is re-focused
        setTimeout(function () { return cm.display.input.focus(); }, 20);
        return
      }
      try {
        var text$1 = e.dataTransfer.getData("Text");
        if (text$1) {
          var selected;
          if (cm.state.draggingText && !cm.state.draggingText.copy)
            { selected = cm.listSelections(); }
          setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));
          if (selected) { for (var i$1 = 0; i$1 < selected.length; ++i$1)
            { replaceRange(cm.doc, "", selected[i$1].anchor, selected[i$1].head, "drag"); } }
          cm.replaceSelection(text$1, "around", "paste");
          cm.display.input.focus();
        }
      }
      catch(e$1){}
    }
  }

  function onDragStart(cm, e) {
    if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return }
    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) { return }

    e.dataTransfer.setData("Text", cm.getSelection());
    e.dataTransfer.effectAllowed = "copyMove";

    // Use dummy image instead of default browsers image.
    // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.
    if (e.dataTransfer.setDragImage && !safari) {
      var img = elt("img", null, null, "position: fixed; left: 0; top: 0;");
      img.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
      if (presto) {
        img.width = img.height = 1;
        cm.display.wrapper.appendChild(img);
        // Force a relayout, or Opera won't use our image for some obscure reason
        img._top = img.offsetTop;
      }
      e.dataTransfer.setDragImage(img, 0, 0);
      if (presto) { img.parentNode.removeChild(img); }
    }
  }

  function onDragOver(cm, e) {
    var pos = posFromMouse(cm, e);
    if (!pos) { return }
    var frag = document.createDocumentFragment();
    drawSelectionCursor(cm, pos, frag);
    if (!cm.display.dragCursor) {
      cm.display.dragCursor = elt("div", null, "CodeMirror-cursors CodeMirror-dragcursors");
      cm.display.lineSpace.insertBefore(cm.display.dragCursor, cm.display.cursorDiv);
    }
    removeChildrenAndAdd(cm.display.dragCursor, frag);
  }

  function clearDragCursor(cm) {
    if (cm.display.dragCursor) {
      cm.display.lineSpace.removeChild(cm.display.dragCursor);
      cm.display.dragCursor = null;
    }
  }

  // These must be handled carefully, because naively registering a
  // handler for each editor will cause the editors to never be
  // garbage collected.

  function forEachCodeMirror(f) {
    if (!document.getElementsByClassName) { return }
    var byClass = document.getElementsByClassName("CodeMirror"), editors = [];
    for (var i = 0; i < byClass.length; i++) {
      var cm = byClass[i].CodeMirror;
      if (cm) { editors.push(cm); }
    }
    if (editors.length) { editors[0].operation(function () {
      for (var i = 0; i < editors.length; i++) { f(editors[i]); }
    }); }
  }

  var globalsRegistered = false;
  function ensureGlobalHandlers() {
    if (globalsRegistered) { return }
    registerGlobalHandlers();
    globalsRegistered = true;
  }
  function registerGlobalHandlers() {
    // When the window resizes, we need to refresh active editors.
    var resizeTimer;
    on(window, "resize", function () {
      if (resizeTimer == null) { resizeTimer = setTimeout(function () {
        resizeTimer = null;
        forEachCodeMirror(onResize);
      }, 100); }
    });
    // When the window loses focus, we want to show the editor as blurred
    on(window, "blur", function () { return forEachCodeMirror(onBlur); });
  }
  // Called when the window resizes
  function onResize(cm) {
    var d = cm.display;
    // Might be a text scaling operation, clear size caches.
    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;
    d.scrollbarsClipped = false;
    cm.setSize();
  }

  var keyNames = {
    3: "Pause", 8: "Backspace", 9: "Tab", 13: "Enter", 16: "Shift", 17: "Ctrl", 18: "Alt",
    19: "Pause", 20: "CapsLock", 27: "Esc", 32: "Space", 33: "PageUp", 34: "PageDown", 35: "End",
    36: "Home", 37: "Left", 38: "Up", 39: "Right", 40: "Down", 44: "PrintScrn", 45: "Insert",
    46: "Delete", 59: ";", 61: "=", 91: "Mod", 92: "Mod", 93: "Mod",
    106: "*", 107: "=", 109: "-", 110: ".", 111: "/", 145: "ScrollLock",
    173: "-", 186: ";", 187: "=", 188: ",", 189: "-", 190: ".", 191: "/", 192: "`", 219: "[", 220: "\\",
    221: "]", 222: "'", 224: "Mod", 63232: "Up", 63233: "Down", 63234: "Left", 63235: "Right", 63272: "Delete",
    63273: "Home", 63275: "End", 63276: "PageUp", 63277: "PageDown", 63302: "Insert"
  };

  // Number keys
  for (var i = 0; i < 10; i++) { keyNames[i + 48] = keyNames[i + 96] = String(i); }
  // Alphabetic keys
  for (var i$1 = 65; i$1 <= 90; i$1++) { keyNames[i$1] = String.fromCharCode(i$1); }
  // Function keys
  for (var i$2 = 1; i$2 <= 12; i$2++) { keyNames[i$2 + 111] = keyNames[i$2 + 63235] = "F" + i$2; }

  var keyMap = {};

  keyMap.basic = {
    "Left": "goCharLeft", "Right": "goCharRight", "Up": "goLineUp", "Down": "goLineDown",
    "End": "goLineEnd", "Home": "goLineStartSmart", "PageUp": "goPageUp", "PageDown": "goPageDown",
    "Delete": "delCharAfter", "Backspace": "delCharBefore", "Shift-Backspace": "delCharBefore",
    "Tab": "defaultTab", "Shift-Tab": "indentAuto",
    "Enter": "newlineAndIndent", "Insert": "toggleOverwrite",
    "Esc": "singleSelection"
  };
  // Note that the save and find-related commands aren't defined by
  // default. User code or addons can define them. Unknown commands
  // are simply ignored.
  keyMap.pcDefault = {
    "Ctrl-A": "selectAll", "Ctrl-D": "deleteLine", "Ctrl-Z": "undo", "Shift-Ctrl-Z": "redo", "Ctrl-Y": "redo",
    "Ctrl-Home": "goDocStart", "Ctrl-End": "goDocEnd", "Ctrl-Up": "goLineUp", "Ctrl-Down": "goLineDown",
    "Ctrl-Left": "goGroupLeft", "Ctrl-Right": "goGroupRight", "Alt-Left": "goLineStart", "Alt-Right": "goLineEnd",
    "Ctrl-Backspace": "delGroupBefore", "Ctrl-Delete": "delGroupAfter", "Ctrl-S": "save", "Ctrl-F": "find",
    "Ctrl-G": "findNext", "Shift-Ctrl-G": "findPrev", "Shift-Ctrl-F": "replace", "Shift-Ctrl-R": "replaceAll",
    "Ctrl-[": "indentLess", "Ctrl-]": "indentMore",
    "Ctrl-U": "undoSelection", "Shift-Ctrl-U": "redoSelection", "Alt-U": "redoSelection",
    "fallthrough": "basic"
  };
  // Very basic readline/emacs-style bindings, which are standard on Mac.
  keyMap.emacsy = {
    "Ctrl-F": "goCharRight", "Ctrl-B": "goCharLeft", "Ctrl-P": "goLineUp", "Ctrl-N": "goLineDown",
    "Ctrl-A": "goLineStart", "Ctrl-E": "goLineEnd", "Ctrl-V": "goPageDown", "Shift-Ctrl-V": "goPageUp",
    "Ctrl-D": "delCharAfter", "Ctrl-H": "delCharBefore", "Alt-Backspace": "delWordBefore", "Ctrl-K": "killLine",
    "Ctrl-T": "transposeChars", "Ctrl-O": "openLine"
  };
  keyMap.macDefault = {
    "Cmd-A": "selectAll", "Cmd-D": "deleteLine", "Cmd-Z": "undo", "Shift-Cmd-Z": "redo", "Cmd-Y": "redo",
    "Cmd-Home": "goDocStart", "Cmd-Up": "goDocStart", "Cmd-End": "goDocEnd", "Cmd-Down": "goDocEnd", "Alt-Left": "goGroupLeft",
    "Alt-Right": "goGroupRight", "Cmd-Left": "goLineLeft", "Cmd-Right": "goLineRight", "Alt-Backspace": "delGroupBefore",
    "Ctrl-Alt-Backspace": "delGroupAfter", "Alt-Delete": "delGroupAfter", "Cmd-S": "save", "Cmd-F": "find",
    "Cmd-G": "findNext", "Shift-Cmd-G": "findPrev", "Cmd-Alt-F": "replace", "Shift-Cmd-Alt-F": "replaceAll",
    "Cmd-[": "indentLess", "Cmd-]": "indentMore", "Cmd-Backspace": "delWrappedLineLeft", "Cmd-Delete": "delWrappedLineRight",
    "Cmd-U": "undoSelection", "Shift-Cmd-U": "redoSelection", "Ctrl-Up": "goDocStart", "Ctrl-Down": "goDocEnd",
    "fallthrough": ["basic", "emacsy"]
  };
  keyMap["default"] = mac ? keyMap.macDefault : keyMap.pcDefault;

  // KEYMAP DISPATCH

  function normalizeKeyName(name) {
    var parts = name.split(/-(?!$)/);
    name = parts[parts.length - 1];
    var alt, ctrl, shift, cmd;
    for (var i = 0; i < parts.length - 1; i++) {
      var mod = parts[i];
      if (/^(cmd|meta|m)$/i.test(mod)) { cmd = true; }
      else if (/^a(lt)?$/i.test(mod)) { alt = true; }
      else if (/^(c|ctrl|control)$/i.test(mod)) { ctrl = true; }
      else if (/^s(hift)?$/i.test(mod)) { shift = true; }
      else { throw new Error("Unrecognized modifier name: " + mod) }
    }
    if (alt) { name = "Alt-" + name; }
    if (ctrl) { name = "Ctrl-" + name; }
    if (cmd) { name = "Cmd-" + name; }
    if (shift) { name = "Shift-" + name; }
    return name
  }

  // This is a kludge to keep keymaps mostly working as raw objects
  // (backwards compatibility) while at the same time support features
  // like normalization and multi-stroke key bindings. It compiles a
  // new normalized keymap, and then updates the old object to reflect
  // this.
  function normalizeKeyMap(keymap) {
    var copy = {};
    for (var keyname in keymap) { if (keymap.hasOwnProperty(keyname)) {
      var value = keymap[keyname];
      if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) { continue }
      if (value == "...") { delete keymap[keyname]; continue }

      var keys = map(keyname.split(" "), normalizeKeyName);
      for (var i = 0; i < keys.length; i++) {
        var val = (void 0), name = (void 0);
        if (i == keys.length - 1) {
          name = keys.join(" ");
          val = value;
        } else {
          name = keys.slice(0, i + 1).join(" ");
          val = "...";
        }
        var prev = copy[name];
        if (!prev) { copy[name] = val; }
        else if (prev != val) { throw new Error("Inconsistent bindings for " + name) }
      }
      delete keymap[keyname];
    } }
    for (var prop in copy) { keymap[prop] = copy[prop]; }
    return keymap
  }

  function lookupKey(key, map, handle, context) {
    map = getKeyMap(map);
    var found = map.call ? map.call(key, context) : map[key];
    if (found === false) { return "nothing" }
    if (found === "...") { return "multi" }
    if (found != null && handle(found)) { return "handled" }

    if (map.fallthrough) {
      if (Object.prototype.toString.call(map.fallthrough) != "[object Array]")
        { return lookupKey(key, map.fallthrough, handle, context) }
      for (var i = 0; i < map.fallthrough.length; i++) {
        var result = lookupKey(key, map.fallthrough[i], handle, context);
        if (result) { return result }
      }
    }
  }

  // Modifier key presses don't count as 'real' key presses for the
  // purpose of keymap fallthrough.
  function isModifierKey(value) {
    var name = typeof value == "string" ? value : keyNames[value.keyCode];
    return name == "Ctrl" || name == "Alt" || name == "Shift" || name == "Mod"
  }

  function addModifierNames(name, event, noShift) {
    var base = name;
    if (event.altKey && base != "Alt") { name = "Alt-" + name; }
    if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != "Ctrl") { name = "Ctrl-" + name; }
    if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != "Mod") { name = "Cmd-" + name; }
    if (!noShift && event.shiftKey && base != "Shift") { name = "Shift-" + name; }
    return name
  }

  // Look up the name of a key as indicated by an event object.
  function keyName(event, noShift) {
    if (presto && event.keyCode == 34 && event["char"]) { return false }
    var name = keyNames[event.keyCode];
    if (name == null || event.altGraphKey) { return false }
    // Ctrl-ScrollLock has keyCode 3, same as Ctrl-Pause,
    // so we'll use event.code when available (Chrome 48+, FF 38+, Safari 10.1+)
    if (event.keyCode == 3 && event.code) { name = event.code; }
    return addModifierNames(name, event, noShift)
  }

  function getKeyMap(val) {
    return typeof val == "string" ? keyMap[val] : val
  }

  // Helper for deleting text near the selection(s), used to implement
  // backspace, delete, and similar functionality.
  function deleteNearSelection(cm, compute) {
    var ranges = cm.doc.sel.ranges, kill = [];
    // Build up a set of ranges to kill first, merging overlapping
    // ranges.
    for (var i = 0; i < ranges.length; i++) {
      var toKill = compute(ranges[i]);
      while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {
        var replaced = kill.pop();
        if (cmp(replaced.from, toKill.from) < 0) {
          toKill.from = replaced.from;
          break
        }
      }
      kill.push(toKill);
    }
    // Next, remove those actual ranges.
    runInOp(cm, function () {
      for (var i = kill.length - 1; i >= 0; i--)
        { replaceRange(cm.doc, "", kill[i].from, kill[i].to, "+delete"); }
      ensureCursorVisible(cm);
    });
  }

  function moveCharLogically(line, ch, dir) {
    var target = skipExtendingChars(line.text, ch + dir, dir);
    return target < 0 || target > line.text.length ? null : target
  }

  function moveLogically(line, start, dir) {
    var ch = moveCharLogically(line, start.ch, dir);
    return ch == null ? null : new Pos(start.line, ch, dir < 0 ? "after" : "before")
  }

  function endOfLine(visually, cm, lineObj, lineNo, dir) {
    if (visually) {
      if (cm.doc.direction == "rtl") { dir = -dir; }
      var order = getOrder(lineObj, cm.doc.direction);
      if (order) {
        var part = dir < 0 ? lst(order) : order[0];
        var moveInStorageOrder = (dir < 0) == (part.level == 1);
        var sticky = moveInStorageOrder ? "after" : "before";
        var ch;
        // With a wrapped rtl chunk (possibly spanning multiple bidi parts),
        // it could be that the last bidi part is not on the last visual line,
        // since visual lines contain content order-consecutive chunks.
        // Thus, in rtl, we are looking for the first (content-order) character
        // in the rtl chunk that is on the last line (that is, the same line
        // as the last (content-order) character).
        if (part.level > 0 || cm.doc.direction == "rtl") {
          var prep = prepareMeasureForLine(cm, lineObj);
          ch = dir < 0 ? lineObj.text.length - 1 : 0;
          var targetTop = measureCharPrepared(cm, prep, ch).top;
          ch = findFirst(function (ch) { return measureCharPrepared(cm, prep, ch).top == targetTop; }, (dir < 0) == (part.level == 1) ? part.from : part.to - 1, ch);
          if (sticky == "before") { ch = moveCharLogically(lineObj, ch, 1); }
        } else { ch = dir < 0 ? part.to : part.from; }
        return new Pos(lineNo, ch, sticky)
      }
    }
    return new Pos(lineNo, dir < 0 ? lineObj.text.length : 0, dir < 0 ? "before" : "after")
  }

  function moveVisually(cm, line, start, dir) {
    var bidi = getOrder(line, cm.doc.direction);
    if (!bidi) { return moveLogically(line, start, dir) }
    if (start.ch >= line.text.length) {
      start.ch = line.text.length;
      start.sticky = "before";
    } else if (start.ch <= 0) {
      start.ch = 0;
      start.sticky = "after";
    }
    var partPos = getBidiPartAt(bidi, start.ch, start.sticky), part = bidi[partPos];
    if (cm.doc.direction == "ltr" && part.level % 2 == 0 && (dir > 0 ? part.to > start.ch : part.from < start.ch)) {
      // Case 1: We move within an ltr part in an ltr editor. Even with wrapped lines,
      // nothing interesting happens.
      return moveLogically(line, start, dir)
    }

    var mv = function (pos, dir) { return moveCharLogically(line, pos instanceof Pos ? pos.ch : pos, dir); };
    var prep;
    var getWrappedLineExtent = function (ch) {
      if (!cm.options.lineWrapping) { return {begin: 0, end: line.text.length} }
      prep = prep || prepareMeasureForLine(cm, line);
      return wrappedLineExtentChar(cm, line, prep, ch)
    };
    var wrappedLineExtent = getWrappedLineExtent(start.sticky == "before" ? mv(start, -1) : start.ch);

    if (cm.doc.direction == "rtl" || part.level == 1) {
      var moveInStorageOrder = (part.level == 1) == (dir < 0);
      var ch = mv(start, moveInStorageOrder ? 1 : -1);
      if (ch != null && (!moveInStorageOrder ? ch >= part.from && ch >= wrappedLineExtent.begin : ch <= part.to && ch <= wrappedLineExtent.end)) {
        // Case 2: We move within an rtl part or in an rtl editor on the same visual line
        var sticky = moveInStorageOrder ? "before" : "after";
        return new Pos(start.line, ch, sticky)
      }
    }

    // Case 3: Could not move within this bidi part in this visual line, so leave
    // the current bidi part

    var searchInVisualLine = function (partPos, dir, wrappedLineExtent) {
      var getRes = function (ch, moveInStorageOrder) { return moveInStorageOrder
        ? new Pos(start.line, mv(ch, 1), "before")
        : new Pos(start.line, ch, "after"); };

      for (; partPos >= 0 && partPos < bidi.length; partPos += dir) {
        var part = bidi[partPos];
        var moveInStorageOrder = (dir > 0) == (part.level != 1);
        var ch = moveInStorageOrder ? wrappedLineExtent.begin : mv(wrappedLineExtent.end, -1);
        if (part.from <= ch && ch < part.to) { return getRes(ch, moveInStorageOrder) }
        ch = moveInStorageOrder ? part.from : mv(part.to, -1);
        if (wrappedLineExtent.begin <= ch && ch < wrappedLineExtent.end) { return getRes(ch, moveInStorageOrder) }
      }
    };

    // Case 3a: Look for other bidi parts on the same visual line
    var res = searchInVisualLine(partPos + dir, dir, wrappedLineExtent);
    if (res) { return res }

    // Case 3b: Look for other bidi parts on the next visual line
    var nextCh = dir > 0 ? wrappedLineExtent.end : mv(wrappedLineExtent.begin, -1);
    if (nextCh != null && !(dir > 0 && nextCh == line.text.length)) {
      res = searchInVisualLine(dir > 0 ? 0 : bidi.length - 1, dir, getWrappedLineExtent(nextCh));
      if (res) { return res }
    }

    // Case 4: Nowhere to move
    return null
  }

  // Commands are parameter-less actions that can be performed on an
  // editor, mostly used for keybindings.
  var commands = {
    selectAll: selectAll,
    singleSelection: function (cm) { return cm.setSelection(cm.getCursor("anchor"), cm.getCursor("head"), sel_dontScroll); },
    killLine: function (cm) { return deleteNearSelection(cm, function (range) {
      if (range.empty()) {
        var len = getLine(cm.doc, range.head.line).text.length;
        if (range.head.ch == len && range.head.line < cm.lastLine())
          { return {from: range.head, to: Pos(range.head.line + 1, 0)} }
        else
          { return {from: range.head, to: Pos(range.head.line, len)} }
      } else {
        return {from: range.from(), to: range.to()}
      }
    }); },
    deleteLine: function (cm) { return deleteNearSelection(cm, function (range) { return ({
      from: Pos(range.from().line, 0),
      to: clipPos(cm.doc, Pos(range.to().line + 1, 0))
    }); }); },
    delLineLeft: function (cm) { return deleteNearSelection(cm, function (range) { return ({
      from: Pos(range.from().line, 0), to: range.from()
    }); }); },
    delWrappedLineLeft: function (cm) { return deleteNearSelection(cm, function (range) {
      var top = cm.charCoords(range.head, "div").top + 5;
      var leftPos = cm.coordsChar({left: 0, top: top}, "div");
      return {from: leftPos, to: range.from()}
    }); },
    delWrappedLineRight: function (cm) { return deleteNearSelection(cm, function (range) {
      var top = cm.charCoords(range.head, "div").top + 5;
      var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div");
      return {from: range.from(), to: rightPos }
    }); },
    undo: function (cm) { return cm.undo(); },
    redo: function (cm) { return cm.redo(); },
    undoSelection: function (cm) { return cm.undoSelection(); },
    redoSelection: function (cm) { return cm.redoSelection(); },
    goDocStart: function (cm) { return cm.extendSelection(Pos(cm.firstLine(), 0)); },
    goDocEnd: function (cm) { return cm.extendSelection(Pos(cm.lastLine())); },
    goLineStart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStart(cm, range.head.line); },
      {origin: "+move", bias: 1}
    ); },
    goLineStartSmart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStartSmart(cm, range.head); },
      {origin: "+move", bias: 1}
    ); },
    goLineEnd: function (cm) { return cm.extendSelectionsBy(function (range) { return lineEnd(cm, range.head.line); },
      {origin: "+move", bias: -1}
    ); },
    goLineRight: function (cm) { return cm.extendSelectionsBy(function (range) {
      var top = cm.cursorCoords(range.head, "div").top + 5;
      return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div")
    }, sel_move); },
    goLineLeft: function (cm) { return cm.extendSelectionsBy(function (range) {
      var top = cm.cursorCoords(range.head, "div").top + 5;
      return cm.coordsChar({left: 0, top: top}, "div")
    }, sel_move); },
    goLineLeftSmart: function (cm) { return cm.extendSelectionsBy(function (range) {
      var top = cm.cursorCoords(range.head, "div").top + 5;
      var pos = cm.coordsChar({left: 0, top: top}, "div");
      if (pos.ch < cm.getLine(pos.line).search(/\S/)) { return lineStartSmart(cm, range.head) }
      return pos
    }, sel_move); },
    goLineUp: function (cm) { return cm.moveV(-1, "line"); },
    goLineDown: function (cm) { return cm.moveV(1, "line"); },
    goPageUp: function (cm) { return cm.moveV(-1, "page"); },
    goPageDown: function (cm) { return cm.moveV(1, "page"); },
    goCharLeft: function (cm) { return cm.moveH(-1, "char"); },
    goCharRight: function (cm) { return cm.moveH(1, "char"); },
    goColumnLeft: function (cm) { return cm.moveH(-1, "column"); },
    goColumnRight: function (cm) { return cm.moveH(1, "column"); },
    goWordLeft: function (cm) { return cm.moveH(-1, "word"); },
    goGroupRight: function (cm) { return cm.moveH(1, "group"); },
    goGroupLeft: function (cm) { return cm.moveH(-1, "group"); },
    goWordRight: function (cm) { return cm.moveH(1, "word"); },
    delCharBefore: function (cm) { return cm.deleteH(-1, "codepoint"); },
    delCharAfter: function (cm) { return cm.deleteH(1, "char"); },
    delWordBefore: function (cm) { return cm.deleteH(-1, "word"); },
    delWordAfter: function (cm) { return cm.deleteH(1, "word"); },
    delGroupBefore: function (cm) { return cm.deleteH(-1, "group"); },
    delGroupAfter: function (cm) { return cm.deleteH(1, "group"); },
    indentAuto: function (cm) { return cm.indentSelection("smart"); },
    indentMore: function (cm) { return cm.indentSelection("add"); },
    indentLess: function (cm) { return cm.indentSelection("subtract"); },
    insertTab: function (cm) { return cm.replaceSelection("\t"); },
    insertSoftTab: function (cm) {
      var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;
      for (var i = 0; i < ranges.length; i++) {
        var pos = ranges[i].from();
        var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);
        spaces.push(spaceStr(tabSize - col % tabSize));
      }
      cm.replaceSelections(spaces);
    },
    defaultTab: function (cm) {
      if (cm.somethingSelected()) { cm.indentSelection("add"); }
      else { cm.execCommand("insertTab"); }
    },
    // Swap the two chars left and right of each selection's head.
    // Move cursor behind the two swapped characters afterwards.
    //
    // Doesn't consider line feeds a character.
    // Doesn't scan more than one line above to find a character.
    // Doesn't do anything on an empty line.
    // Doesn't do anything with non-empty selections.
    transposeChars: function (cm) { return runInOp(cm, function () {
      var ranges = cm.listSelections(), newSel = [];
      for (var i = 0; i < ranges.length; i++) {
        if (!ranges[i].empty()) { continue }
        var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;
        if (line) {
          if (cur.ch == line.length) { cur = new Pos(cur.line, cur.ch - 1); }
          if (cur.ch > 0) {
            cur = new Pos(cur.line, cur.ch + 1);
            cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),
                            Pos(cur.line, cur.ch - 2), cur, "+transpose");
          } else if (cur.line > cm.doc.first) {
            var prev = getLine(cm.doc, cur.line - 1).text;
            if (prev) {
              cur = new Pos(cur.line, 1);
              cm.replaceRange(line.charAt(0) + cm.doc.lineSeparator() +
                              prev.charAt(prev.length - 1),
                              Pos(cur.line - 1, prev.length - 1), cur, "+transpose");
            }
          }
        }
        newSel.push(new Range(cur, cur));
      }
      cm.setSelections(newSel);
    }); },
    newlineAndIndent: function (cm) { return runInOp(cm, function () {
      var sels = cm.listSelections();
      for (var i = sels.length - 1; i >= 0; i--)
        { cm.replaceRange(cm.doc.lineSeparator(), sels[i].anchor, sels[i].head, "+input"); }
      sels = cm.listSelections();
      for (var i$1 = 0; i$1 < sels.length; i$1++)
        { cm.indentLine(sels[i$1].from().line, null, true); }
      ensureCursorVisible(cm);
    }); },
    openLine: function (cm) { return cm.replaceSelection("\n", "start"); },
    toggleOverwrite: function (cm) { return cm.toggleOverwrite(); }
  };


  function lineStart(cm, lineN) {
    var line = getLine(cm.doc, lineN);
    var visual = visualLine(line);
    if (visual != line) { lineN = lineNo(visual); }
    return endOfLine(true, cm, visual, lineN, 1)
  }
  function lineEnd(cm, lineN) {
    var line = getLine(cm.doc, lineN);
    var visual = visualLineEnd(line);
    if (visual != line) { lineN = lineNo(visual); }
    return endOfLine(true, cm, line, lineN, -1)
  }
  function lineStartSmart(cm, pos) {
    var start = lineStart(cm, pos.line);
    var line = getLine(cm.doc, start.line);
    var order = getOrder(line, cm.doc.direction);
    if (!order || order[0].level == 0) {
      var firstNonWS = Math.max(start.ch, line.text.search(/\S/));
      var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;
      return Pos(start.line, inWS ? 0 : firstNonWS, start.sticky)
    }
    return start
  }

  // Run a handler that was bound to a key.
  function doHandleBinding(cm, bound, dropShift) {
    if (typeof bound == "string") {
      bound = commands[bound];
      if (!bound) { return false }
    }
    // Ensure previous input has been read, so that the handler sees a
    // consistent view of the document
    cm.display.input.ensurePolled();
    var prevShift = cm.display.shift, done = false;
    try {
      if (cm.isReadOnly()) { cm.state.suppressEdits = true; }
      if (dropShift) { cm.display.shift = false; }
      done = bound(cm) != Pass;
    } finally {
      cm.display.shift = prevShift;
      cm.state.suppressEdits = false;
    }
    return done
  }

  function lookupKeyForEditor(cm, name, handle) {
    for (var i = 0; i < cm.state.keyMaps.length; i++) {
      var result = lookupKey(name, cm.state.keyMaps[i], handle, cm);
      if (result) { return result }
    }
    return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle, cm))
      || lookupKey(name, cm.options.keyMap, handle, cm)
  }

  // Note that, despite the name, this function is also used to check
  // for bound mouse clicks.

  var stopSeq = new Delayed;

  function dispatchKey(cm, name, e, handle) {
    var seq = cm.state.keySeq;
    if (seq) {
      if (isModifierKey(name)) { return "handled" }
      if (/\'$/.test(name))
        { cm.state.keySeq = null; }
      else
        { stopSeq.set(50, function () {
          if (cm.state.keySeq == seq) {
            cm.state.keySeq = null;
            cm.display.input.reset();
          }
        }); }
      if (dispatchKeyInner(cm, seq + " " + name, e, handle)) { return true }
    }
    return dispatchKeyInner(cm, name, e, handle)
  }

  function dispatchKeyInner(cm, name, e, handle) {
    var result = lookupKeyForEditor(cm, name, handle);

    if (result == "multi")
      { cm.state.keySeq = name; }
    if (result == "handled")
      { signalLater(cm, "keyHandled", cm, name, e); }

    if (result == "handled" || result == "multi") {
      e_preventDefault(e);
      restartBlink(cm);
    }

    return !!result
  }

  // Handle a key from the keydown event.
  function handleKeyBinding(cm, e) {
    var name = keyName(e, true);
    if (!name) { return false }

    if (e.shiftKey && !cm.state.keySeq) {
      // First try to resolve full name (including 'Shift-'). Failing
      // that, see if there is a cursor-motion command (starting with
      // 'go') bound to the keyname without 'Shift-'.
      return dispatchKey(cm, "Shift-" + name, e, function (b) { return doHandleBinding(cm, b, true); })
          || dispatchKey(cm, name, e, function (b) {
               if (typeof b == "string" ? /^go[A-Z]/.test(b) : b.motion)
                 { return doHandleBinding(cm, b) }
             })
    } else {
      return dispatchKey(cm, name, e, function (b) { return doHandleBinding(cm, b); })
    }
  }

  // Handle a key from the keypress event
  function handleCharBinding(cm, e, ch) {
    return dispatchKey(cm, "'" + ch + "'", e, function (b) { return doHandleBinding(cm, b, true); })
  }

  var lastStoppedKey = null;
  function onKeyDown(e) {
    var cm = this;
    if (e.target && e.target != cm.display.input.getField()) { return }
    cm.curOp.focus = activeElt();
    if (signalDOMEvent(cm, e)) { return }
    // IE does strange things with escape.
    if (ie && ie_version < 11 && e.keyCode == 27) { e.returnValue = false; }
    var code = e.keyCode;
    cm.display.shift = code == 16 || e.shiftKey;
    var handled = handleKeyBinding(cm, e);
    if (presto) {
      lastStoppedKey = handled ? code : null;
      // Opera has no cut event... we try to at least catch the key combo
      if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))
        { cm.replaceSelection("", null, "cut"); }
    }
    if (gecko && !mac && !handled && code == 46 && e.shiftKey && !e.ctrlKey && document.execCommand)
      { document.execCommand("cut"); }

    // Turn mouse into crosshair when Alt is held on Mac.
    if (code == 18 && !/\bCodeMirror-crosshair\b/.test(cm.display.lineDiv.className))
      { showCrossHair(cm); }
  }

  function showCrossHair(cm) {
    var lineDiv = cm.display.lineDiv;
    addClass(lineDiv, "CodeMirror-crosshair");

    function up(e) {
      if (e.keyCode == 18 || !e.altKey) {
        rmClass(lineDiv, "CodeMirror-crosshair");
        off(document, "keyup", up);
        off(document, "mouseover", up);
      }
    }
    on(document, "keyup", up);
    on(document, "mouseover", up);
  }

  function onKeyUp(e) {
    if (e.keyCode == 16) { this.doc.sel.shift = false; }
    signalDOMEvent(this, e);
  }

  function onKeyPress(e) {
    var cm = this;
    if (e.target && e.target != cm.display.input.getField()) { return }
    if (eventInWidget(cm.display, e) || signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) { return }
    var keyCode = e.keyCode, charCode = e.charCode;
    if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return}
    if ((presto && (!e.which || e.which < 10)) && handleKeyBinding(cm, e)) { return }
    var ch = String.fromCharCode(charCode == null ? keyCode : charCode);
    // Some browsers fire keypress events for backspace
    if (ch == "\x08") { return }
    if (handleCharBinding(cm, e, ch)) { return }
    cm.display.input.onKeyPress(e);
  }

  var DOUBLECLICK_DELAY = 400;

  var PastClick = function(time, pos, button) {
    this.time = time;
    this.pos = pos;
    this.button = button;
  };

  PastClick.prototype.compare = function (time, pos, button) {
    return this.time + DOUBLECLICK_DELAY > time &&
      cmp(pos, this.pos) == 0 && button == this.button
  };

  var lastClick, lastDoubleClick;
  function clickRepeat(pos, button) {
    var now = +new Date;
    if (lastDoubleClick && lastDoubleClick.compare(now, pos, button)) {
      lastClick = lastDoubleClick = null;
      return "triple"
    } else if (lastClick && lastClick.compare(now, pos, button)) {
      lastDoubleClick = new PastClick(now, pos, button);
      lastClick = null;
      return "double"
    } else {
      lastClick = new PastClick(now, pos, button);
      lastDoubleClick = null;
      return "single"
    }
  }

  // A mouse down can be a single click, double click, triple click,
  // start of selection drag, start of text drag, new cursor
  // (ctrl-click), rectangle drag (alt-drag), or xwin
  // middle-click-paste. Or it might be a click on something we should
  // not interfere with, such as a scrollbar or widget.
  function onMouseDown(e) {
    var cm = this, display = cm.display;
    if (signalDOMEvent(cm, e) || display.activeTouch && display.input.supportsTouch()) { return }
    display.input.ensurePolled();
    display.shift = e.shiftKey;

    if (eventInWidget(display, e)) {
      if (!webkit) {
        // Briefly turn off draggability, to allow widgets to do
        // normal dragging things.
        display.scroller.draggable = false;
        setTimeout(function () { return display.scroller.draggable = true; }, 100);
      }
      return
    }
    if (clickInGutter(cm, e)) { return }
    var pos = posFromMouse(cm, e), button = e_button(e), repeat = pos ? clickRepeat(pos, button) : "single";
    window.focus();

    // #3261: make sure, that we're not starting a second selection
    if (button == 1 && cm.state.selectingText)
      { cm.state.selectingText(e); }

    if (pos && handleMappedButton(cm, button, pos, repeat, e)) { return }

    if (button == 1) {
      if (pos) { leftButtonDown(cm, pos, repeat, e); }
      else if (e_target(e) == display.scroller) { e_preventDefault(e); }
    } else if (button == 2) {
      if (pos) { extendSelection(cm.doc, pos); }
      setTimeout(function () { return display.input.focus(); }, 20);
    } else if (button == 3) {
      if (captureRightClick) { cm.display.input.onContextMenu(e); }
      else { delayBlurEvent(cm); }
    }
  }

  function handleMappedButton(cm, button, pos, repeat, event) {
    var name = "Click";
    if (repeat == "double") { name = "Double" + name; }
    else if (repeat == "triple") { name = "Triple" + name; }
    name = (button == 1 ? "Left" : button == 2 ? "Middle" : "Right") + name;

    return dispatchKey(cm,  addModifierNames(name, event), event, function (bound) {
      if (typeof bound == "string") { bound = commands[bound]; }
      if (!bound) { return false }
      var done = false;
      try {
        if (cm.isReadOnly()) { cm.state.suppressEdits = true; }
        done = bound(cm, pos) != Pass;
      } finally {
        cm.state.suppressEdits = false;
      }
      return done
    })
  }

  function configureMouse(cm, repeat, event) {
    var option = cm.getOption("configureMouse");
    var value = option ? option(cm, repeat, event) : {};
    if (value.unit == null) {
      var rect = chromeOS ? event.shiftKey && event.metaKey : event.altKey;
      value.unit = rect ? "rectangle" : repeat == "single" ? "char" : repeat == "double" ? "word" : "line";
    }
    if (value.extend == null || cm.doc.extend) { value.extend = cm.doc.extend || event.shiftKey; }
    if (value.addNew == null) { value.addNew = mac ? event.metaKey : event.ctrlKey; }
    if (value.moveOnDrag == null) { value.moveOnDrag = !(mac ? event.altKey : event.ctrlKey); }
    return value
  }

  function leftButtonDown(cm, pos, repeat, event) {
    if (ie) { setTimeout(bind(ensureFocus, cm), 0); }
    else { cm.curOp.focus = activeElt(); }

    var behavior = configureMouse(cm, repeat, event);

    var sel = cm.doc.sel, contained;
    if (cm.options.dragDrop && dragAndDrop && !cm.isReadOnly() &&
        repeat == "single" && (contained = sel.contains(pos)) > -1 &&
        (cmp((contained = sel.ranges[contained]).from(), pos) < 0 || pos.xRel > 0) &&
        (cmp(contained.to(), pos) > 0 || pos.xRel < 0))
      { leftButtonStartDrag(cm, event, pos, behavior); }
    else
      { leftButtonSelect(cm, event, pos, behavior); }
  }

  // Start a text drag. When it ends, see if any dragging actually
  // happen, and treat as a click if it didn't.
  function leftButtonStartDrag(cm, event, pos, behavior) {
    var display = cm.display, moved = false;
    var dragEnd = operation(cm, function (e) {
      if (webkit) { display.scroller.draggable = false; }
      cm.state.draggingText = false;
      if (cm.state.delayingBlurEvent) {
        if (cm.hasFocus()) { cm.state.delayingBlurEvent = false; }
        else { delayBlurEvent(cm); }
      }
      off(display.wrapper.ownerDocument, "mouseup", dragEnd);
      off(display.wrapper.ownerDocument, "mousemove", mouseMove);
      off(display.scroller, "dragstart", dragStart);
      off(display.scroller, "drop", dragEnd);
      if (!moved) {
        e_preventDefault(e);
        if (!behavior.addNew)
          { extendSelection(cm.doc, pos, null, null, behavior.extend); }
        // Work around unexplainable focus problem in IE9 (#2127) and Chrome (#3081)
        if ((webkit && !safari) || ie && ie_version == 9)
          { setTimeout(function () {display.wrapper.ownerDocument.body.focus({preventScroll: true}); display.input.focus();}, 20); }
        else
          { display.input.focus(); }
      }
    });
    var mouseMove = function(e2) {
      moved = moved || Math.abs(event.clientX - e2.clientX) + Math.abs(event.clientY - e2.clientY) >= 10;
    };
    var dragStart = function () { return moved = true; };
    // Let the drag handler handle this.
    if (webkit) { display.scroller.draggable = true; }
    cm.state.draggingText = dragEnd;
    dragEnd.copy = !behavior.moveOnDrag;
    on(display.wrapper.ownerDocument, "mouseup", dragEnd);
    on(display.wrapper.ownerDocument, "mousemove", mouseMove);
    on(display.scroller, "dragstart", dragStart);
    on(display.scroller, "drop", dragEnd);

    cm.state.delayingBlurEvent = true;
    setTimeout(function () { return display.input.focus(); }, 20);
    // IE's approach to draggable
    if (display.scroller.dragDrop) { display.scroller.dragDrop(); }
  }

  function rangeForUnit(cm, pos, unit) {
    if (unit == "char") { return new Range(pos, pos) }
    if (unit == "word") { return cm.findWordAt(pos) }
    if (unit == "line") { return new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))) }
    var result = unit(cm, pos);
    return new Range(result.from, result.to)
  }

  // Normal selection, as opposed to text dragging.
  function leftButtonSelect(cm, event, start, behavior) {
    if (ie) { delayBlurEvent(cm); }
    var display = cm.display, doc = cm.doc;
    e_preventDefault(event);

    var ourRange, ourIndex, startSel = doc.sel, ranges = startSel.ranges;
    if (behavior.addNew && !behavior.extend) {
      ourIndex = doc.sel.contains(start);
      if (ourIndex > -1)
        { ourRange = ranges[ourIndex]; }
      else
        { ourRange = new Range(start, start); }
    } else {
      ourRange = doc.sel.primary();
      ourIndex = doc.sel.primIndex;
    }

    if (behavior.unit == "rectangle") {
      if (!behavior.addNew) { ourRange = new Range(start, start); }
      start = posFromMouse(cm, event, true, true);
      ourIndex = -1;
    } else {
      var range = rangeForUnit(cm, start, behavior.unit);
      if (behavior.extend)
        { ourRange = extendRange(ourRange, range.anchor, range.head, behavior.extend); }
      else
        { ourRange = range; }
    }

    if (!behavior.addNew) {
      ourIndex = 0;
      setSelection(doc, new Selection([ourRange], 0), sel_mouse);
      startSel = doc.sel;
    } else if (ourIndex == -1) {
      ourIndex = ranges.length;
      setSelection(doc, normalizeSelection(cm, ranges.concat([ourRange]), ourIndex),
                   {scroll: false, origin: "*mouse"});
    } else if (ranges.length > 1 && ranges[ourIndex].empty() && behavior.unit == "char" && !behavior.extend) {
      setSelection(doc, normalizeSelection(cm, ranges.slice(0, ourIndex).concat(ranges.slice(ourIndex + 1)), 0),
                   {scroll: false, origin: "*mouse"});
      startSel = doc.sel;
    } else {
      replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);
    }

    var lastPos = start;
    function extendTo(pos) {
      if (cmp(lastPos, pos) == 0) { return }
      lastPos = pos;

      if (behavior.unit == "rectangle") {
        var ranges = [], tabSize = cm.options.tabSize;
        var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);
        var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);
        var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);
        for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));
             line <= end; line++) {
          var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);
          if (left == right)
            { ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos))); }
          else if (text.length > leftPos)
            { ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize)))); }
        }
        if (!ranges.length) { ranges.push(new Range(start, start)); }
        setSelection(doc, normalizeSelection(cm, startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),
                     {origin: "*mouse", scroll: false});
        cm.scrollIntoView(pos);
      } else {
        var oldRange = ourRange;
        var range = rangeForUnit(cm, pos, behavior.unit);
        var anchor = oldRange.anchor, head;
        if (cmp(range.anchor, anchor) > 0) {
          head = range.head;
          anchor = minPos(oldRange.from(), range.anchor);
        } else {
          head = range.anchor;
          anchor = maxPos(oldRange.to(), range.head);
        }
        var ranges$1 = startSel.ranges.slice(0);
        ranges$1[ourIndex] = bidiSimplify(cm, new Range(clipPos(doc, anchor), head));
        setSelection(doc, normalizeSelection(cm, ranges$1, ourIndex), sel_mouse);
      }
    }

    var editorSize = display.wrapper.getBoundingClientRect();
    // Used to ensure timeout re-tries don't fire when another extend
    // happened in the meantime (clearTimeout isn't reliable -- at
    // least on Chrome, the timeouts still happen even when cleared,
    // if the clear happens after their scheduled firing time).
    var counter = 0;

    function extend(e) {
      var curCount = ++counter;
      var cur = posFromMouse(cm, e, true, behavior.unit == "rectangle");
      if (!cur) { return }
      if (cmp(cur, lastPos) != 0) {
        cm.curOp.focus = activeElt();
        extendTo(cur);
        var visible = visibleLines(display, doc);
        if (cur.line >= visible.to || cur.line < visible.from)
          { setTimeout(operation(cm, function () {if (counter == curCount) { extend(e); }}), 150); }
      } else {
        var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;
        if (outside) { setTimeout(operation(cm, function () {
          if (counter != curCount) { return }
          display.scroller.scrollTop += outside;
          extend(e);
        }), 50); }
      }
    }

    function done(e) {
      cm.state.selectingText = false;
      counter = Infinity;
      // If e is null or undefined we interpret this as someone trying
      // to explicitly cancel the selection rather than the user
      // letting go of the mouse button.
      if (e) {
        e_preventDefault(e);
        display.input.focus();
      }
      off(display.wrapper.ownerDocument, "mousemove", move);
      off(display.wrapper.ownerDocument, "mouseup", up);
      doc.history.lastSelOrigin = null;
    }

    var move = operation(cm, function (e) {
      if (e.buttons === 0 || !e_button(e)) { done(e); }
      else { extend(e); }
    });
    var up = operation(cm, done);
    cm.state.selectingText = up;
    on(display.wrapper.ownerDocument, "mousemove", move);
    on(display.wrapper.ownerDocument, "mouseup", up);
  }

  // Used when mouse-selecting to adjust the anchor to the proper side
  // of a bidi jump depending on the visual position of the head.
  function bidiSimplify(cm, range) {
    var anchor = range.anchor;
    var head = range.head;
    var anchorLine = getLine(cm.doc, anchor.line);
    if (cmp(anchor, head) == 0 && anchor.sticky == head.sticky) { return range }
    var order = getOrder(anchorLine);
    if (!order) { return range }
    var index = getBidiPartAt(order, anchor.ch, anchor.sticky), part = order[index];
    if (part.from != anchor.ch && part.to != anchor.ch) { return range }
    var boundary = index + ((part.from == anchor.ch) == (part.level != 1) ? 0 : 1);
    if (boundary == 0 || boundary == order.length) { return range }

    // Compute the relative visual position of the head compared to the
    // anchor (<0 is to the left, >0 to the right)
    var leftSide;
    if (head.line != anchor.line) {
      leftSide = (head.line - anchor.line) * (cm.doc.direction == "ltr" ? 1 : -1) > 0;
    } else {
      var headIndex = getBidiPartAt(order, head.ch, head.sticky);
      var dir = headIndex - index || (head.ch - anchor.ch) * (part.level == 1 ? -1 : 1);
      if (headIndex == boundary - 1 || headIndex == boundary)
        { leftSide = dir < 0; }
      else
        { leftSide = dir > 0; }
    }

    var usePart = order[boundary + (leftSide ? -1 : 0)];
    var from = leftSide == (usePart.level == 1);
    var ch = from ? usePart.from : usePart.to, sticky = from ? "after" : "before";
    return anchor.ch == ch && anchor.sticky == sticky ? range : new Range(new Pos(anchor.line, ch, sticky), head)
  }


  // Determines whether an event happened in the gutter, and fires the
  // handlers for the corresponding event.
  function gutterEvent(cm, e, type, prevent) {
    var mX, mY;
    if (e.touches) {
      mX = e.touches[0].clientX;
      mY = e.touches[0].clientY;
    } else {
      try { mX = e.clientX; mY = e.clientY; }
      catch(e$1) { return false }
    }
    if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) { return false }
    if (prevent) { e_preventDefault(e); }

    var display = cm.display;
    var lineBox = display.lineDiv.getBoundingClientRect();

    if (mY > lineBox.bottom || !hasHandler(cm, type)) { return e_defaultPrevented(e) }
    mY -= lineBox.top - display.viewOffset;

    for (var i = 0; i < cm.display.gutterSpecs.length; ++i) {
      var g = display.gutters.childNodes[i];
      if (g && g.getBoundingClientRect().right >= mX) {
        var line = lineAtHeight(cm.doc, mY);
        var gutter = cm.display.gutterSpecs[i];
        signal(cm, type, cm, line, gutter.className, e);
        return e_defaultPrevented(e)
      }
    }
  }

  function clickInGutter(cm, e) {
    return gutterEvent(cm, e, "gutterClick", true)
  }

  // CONTEXT MENU HANDLING

  // To make the context menu work, we need to briefly unhide the
  // textarea (making it as unobtrusive as possible) to let the
  // right-click take effect on it.
  function onContextMenu(cm, e) {
    if (eventInWidget(cm.display, e) || contextMenuInGutter(cm, e)) { return }
    if (signalDOMEvent(cm, e, "contextmenu")) { return }
    if (!captureRightClick) { cm.display.input.onContextMenu(e); }
  }

  function contextMenuInGutter(cm, e) {
    if (!hasHandler(cm, "gutterContextMenu")) { return false }
    return gutterEvent(cm, e, "gutterContextMenu", false)
  }

  function themeChanged(cm) {
    cm.display.wrapper.className = cm.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") +
      cm.options.theme.replace(/(^|\s)\s*/g, " cm-s-");
    clearCaches(cm);
  }

  var Init = {toString: function(){return "CodeMirror.Init"}};

  var defaults = {};
  var optionHandlers = {};

  function defineOptions(CodeMirror) {
    var optionHandlers = CodeMirror.optionHandlers;

    function option(name, deflt, handle, notOnInit) {
      CodeMirror.defaults[name] = deflt;
      if (handle) { optionHandlers[name] =
        notOnInit ? function (cm, val, old) {if (old != Init) { handle(cm, val, old); }} : handle; }
    }

    CodeMirror.defineOption = option;

    // Passed to option handlers when there is no old value.
    CodeMirror.Init = Init;

    // These two are, on init, called from the constructor because they
    // have to be initialized before the editor can start at all.
    option("value", "", function (cm, val) { return cm.setValue(val); }, true);
    option("mode", null, function (cm, val) {
      cm.doc.modeOption = val;
      loadMode(cm);
    }, true);

    option("indentUnit", 2, loadMode, true);
    option("indentWithTabs", false);
    option("smartIndent", true);
    option("tabSize", 4, function (cm) {
      resetModeState(cm);
      clearCaches(cm);
      regChange(cm);
    }, true);

    option("lineSeparator", null, function (cm, val) {
      cm.doc.lineSep = val;
      if (!val) { return }
      var newBreaks = [], lineNo = cm.doc.first;
      cm.doc.iter(function (line) {
        for (var pos = 0;;) {
          var found = line.text.indexOf(val, pos);
          if (found == -1) { break }
          pos = found + val.length;
          newBreaks.push(Pos(lineNo, found));
        }
        lineNo++;
      });
      for (var i = newBreaks.length - 1; i >= 0; i--)
        { replaceRange(cm.doc, val, newBreaks[i], Pos(newBreaks[i].line, newBreaks[i].ch + val.length)); }
    });
    option("specialChars", /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g, function (cm, val, old) {
      cm.state.specialChars = new RegExp(val.source + (val.test("\t") ? "" : "|\t"), "g");
      if (old != Init) { cm.refresh(); }
    });
    option("specialCharPlaceholder", defaultSpecialCharPlaceholder, function (cm) { return cm.refresh(); }, true);
    option("electricChars", true);
    option("inputStyle", mobile ? "contenteditable" : "textarea", function () {
      throw new Error("inputStyle can not (yet) be changed in a running editor") // FIXME
    }, true);
    option("spellcheck", false, function (cm, val) { return cm.getInputField().spellcheck = val; }, true);
    option("autocorrect", false, function (cm, val) { return cm.getInputField().autocorrect = val; }, true);
    option("autocapitalize", false, function (cm, val) { return cm.getInputField().autocapitalize = val; }, true);
    option("rtlMoveVisually", !windows);
    option("wholeLineUpdateBefore", true);

    option("theme", "default", function (cm) {
      themeChanged(cm);
      updateGutters(cm);
    }, true);
    option("keyMap", "default", function (cm, val, old) {
      var next = getKeyMap(val);
      var prev = old != Init && getKeyMap(old);
      if (prev && prev.detach) { prev.detach(cm, next); }
      if (next.attach) { next.attach(cm, prev || null); }
    });
    option("extraKeys", null);
    option("configureMouse", null);

    option("lineWrapping", false, wrappingChanged, true);
    option("gutters", [], function (cm, val) {
      cm.display.gutterSpecs = getGutters(val, cm.options.lineNumbers);
      updateGutters(cm);
    }, true);
    option("fixedGutter", true, function (cm, val) {
      cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + "px" : "0";
      cm.refresh();
    }, true);
    option("coverGutterNextToScrollbar", false, function (cm) { return updateScrollbars(cm); }, true);
    option("scrollbarStyle", "native", function (cm) {
      initScrollbars(cm);
      updateScrollbars(cm);
      cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);
      cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);
    }, true);
    option("lineNumbers", false, function (cm, val) {
      cm.display.gutterSpecs = getGutters(cm.options.gutters, val);
      updateGutters(cm);
    }, true);
    option("firstLineNumber", 1, updateGutters, true);
    option("lineNumberFormatter", function (integer) { return integer; }, updateGutters, true);
    option("showCursorWhenSelecting", false, updateSelection, true);

    option("resetSelectionOnContextMenu", true);
    option("lineWiseCopyCut", true);
    option("pasteLinesPerSelection", true);
    option("selectionsMayTouch", false);

    option("readOnly", false, function (cm, val) {
      if (val == "nocursor") {
        onBlur(cm);
        cm.display.input.blur();
      }
      cm.display.input.readOnlyChanged(val);
    });

    option("screenReaderLabel", null, function (cm, val) {
      val = (val === '') ? null : val;
      cm.display.input.screenReaderLabelChanged(val);
    });

    option("disableInput", false, function (cm, val) {if (!val) { cm.display.input.reset(); }}, true);
    option("dragDrop", true, dragDropChanged);
    option("allowDropFileTypes", null);

    option("cursorBlinkRate", 530);
    option("cursorScrollMargin", 0);
    option("cursorHeight", 1, updateSelection, true);
    option("singleCursorHeightPerLine", true, updateSelection, true);
    option("workTime", 100);
    option("workDelay", 100);
    option("flattenSpans", true, resetModeState, true);
    option("addModeClass", false, resetModeState, true);
    option("pollInterval", 100);
    option("undoDepth", 200, function (cm, val) { return cm.doc.history.undoDepth = val; });
    option("historyEventDelay", 1250);
    option("viewportMargin", 10, function (cm) { return cm.refresh(); }, true);
    option("maxHighlightLength", 10000, resetModeState, true);
    option("moveInputWithCursor", true, function (cm, val) {
      if (!val) { cm.display.input.resetPosition(); }
    });

    option("tabindex", null, function (cm, val) { return cm.display.input.getField().tabIndex = val || ""; });
    option("autofocus", null);
    option("direction", "ltr", function (cm, val) { return cm.doc.setDirection(val); }, true);
    option("phrases", null);
  }

  function dragDropChanged(cm, value, old) {
    var wasOn = old && old != Init;
    if (!value != !wasOn) {
      var funcs = cm.display.dragFunctions;
      var toggle = value ? on : off;
      toggle(cm.display.scroller, "dragstart", funcs.start);
      toggle(cm.display.scroller, "dragenter", funcs.enter);
      toggle(cm.display.scroller, "dragover", funcs.over);
      toggle(cm.display.scroller, "dragleave", funcs.leave);
      toggle(cm.display.scroller, "drop", funcs.drop);
    }
  }

  function wrappingChanged(cm) {
    if (cm.options.lineWrapping) {
      addClass(cm.display.wrapper, "CodeMirror-wrap");
      cm.display.sizer.style.minWidth = "";
      cm.display.sizerWidth = null;
    } else {
      rmClass(cm.display.wrapper, "CodeMirror-wrap");
      findMaxLine(cm);
    }
    estimateLineHeights(cm);
    regChange(cm);
    clearCaches(cm);
    setTimeout(function () { return updateScrollbars(cm); }, 100);
  }

  // A CodeMirror instance represents an editor. This is the object
  // that user code is usually dealing with.

  function CodeMirror(place, options) {
    var this$1 = this;

    if (!(this instanceof CodeMirror)) { return new CodeMirror(place, options) }

    this.options = options = options ? copyObj(options) : {};
    // Determine effective options based on given values and defaults.
    copyObj(defaults, options, false);

    var doc = options.value;
    if (typeof doc == "string") { doc = new Doc(doc, options.mode, null, options.lineSeparator, options.direction); }
    else if (options.mode) { doc.modeOption = options.mode; }
    this.doc = doc;

    var input = new CodeMirror.inputStyles[options.inputStyle](this);
    var display = this.display = new Display(place, doc, input, options);
    display.wrapper.CodeMirror = this;
    themeChanged(this);
    if (options.lineWrapping)
      { this.display.wrapper.className += " CodeMirror-wrap"; }
    initScrollbars(this);

    this.state = {
      keyMaps: [],  // stores maps added by addKeyMap
      overlays: [], // highlighting overlays, as added by addOverlay
      modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info
      overwrite: false,
      delayingBlurEvent: false,
      focused: false,
      suppressEdits: false, // used to disable editing during key handlers when in readOnly mode
      pasteIncoming: -1, cutIncoming: -1, // help recognize paste/cut edits in input.poll
      selectingText: false,
      draggingText: false,
      highlight: new Delayed(), // stores highlight worker timeout
      keySeq: null,  // Unfinished key sequence
      specialChars: null
    };

    if (options.autofocus && !mobile) { display.input.focus(); }

    // Override magic textarea content restore that IE sometimes does
    // on our hidden textarea on reload
    if (ie && ie_version < 11) { setTimeout(function () { return this$1.display.input.reset(true); }, 20); }

    registerEventHandlers(this);
    ensureGlobalHandlers();

    startOperation(this);
    this.curOp.forceUpdate = true;
    attachDoc(this, doc);

    if ((options.autofocus && !mobile) || this.hasFocus())
      { setTimeout(function () {
        if (this$1.hasFocus() && !this$1.state.focused) { onFocus(this$1); }
      }, 20); }
    else
      { onBlur(this); }

    for (var opt in optionHandlers) { if (optionHandlers.hasOwnProperty(opt))
      { optionHandlers[opt](this, options[opt], Init); } }
    maybeUpdateLineNumberWidth(this);
    if (options.finishInit) { options.finishInit(this); }
    for (var i = 0; i < initHooks.length; ++i) { initHooks[i](this); }
    endOperation(this);
    // Suppress optimizelegibility in Webkit, since it breaks text
    // measuring on line wrapping boundaries.
    if (webkit && options.lineWrapping &&
        getComputedStyle(display.lineDiv).textRendering == "optimizelegibility")
      { display.lineDiv.style.textRendering = "auto"; }
  }

  // The default configuration options.
  CodeMirror.defaults = defaults;
  // Functions to run when options are changed.
  CodeMirror.optionHandlers = optionHandlers;

  // Attach the necessary event handlers when initializing the editor
  function registerEventHandlers(cm) {
    var d = cm.display;
    on(d.scroller, "mousedown", operation(cm, onMouseDown));
    // Older IE's will not fire a second mousedown for a double click
    if (ie && ie_version < 11)
      { on(d.scroller, "dblclick", operation(cm, function (e) {
        if (signalDOMEvent(cm, e)) { return }
        var pos = posFromMouse(cm, e);
        if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) { return }
        e_preventDefault(e);
        var word = cm.findWordAt(pos);
        extendSelection(cm.doc, word.anchor, word.head);
      })); }
    else
      { on(d.scroller, "dblclick", function (e) { return signalDOMEvent(cm, e) || e_preventDefault(e); }); }
    // Some browsers fire contextmenu *after* opening the menu, at
    // which point we can't mess with it anymore. Context menu is
    // handled in onMouseDown for these browsers.
    on(d.scroller, "contextmenu", function (e) { return onContextMenu(cm, e); });
    on(d.input.getField(), "contextmenu", function (e) {
      if (!d.scroller.contains(e.target)) { onContextMenu(cm, e); }
    });

    // Used to suppress mouse event handling when a touch happens
    var touchFinished, prevTouch = {end: 0};
    function finishTouch() {
      if (d.activeTouch) {
        touchFinished = setTimeout(function () { return d.activeTouch = null; }, 1000);
        prevTouch = d.activeTouch;
        prevTouch.end = +new Date;
      }
    }
    function isMouseLikeTouchEvent(e) {
      if (e.touches.length != 1) { return false }
      var touch = e.touches[0];
      return touch.radiusX <= 1 && touch.radiusY <= 1
    }
    function farAway(touch, other) {
      if (other.left == null) { return true }
      var dx = other.left - touch.left, dy = other.top - touch.top;
      return dx * dx + dy * dy > 20 * 20
    }
    on(d.scroller, "touchstart", function (e) {
      if (!signalDOMEvent(cm, e) && !isMouseLikeTouchEvent(e) && !clickInGutter(cm, e)) {
        d.input.ensurePolled();
        clearTimeout(touchFinished);
        var now = +new Date;
        d.activeTouch = {start: now, moved: false,
                         prev: now - prevTouch.end <= 300 ? prevTouch : null};
        if (e.touches.length == 1) {
          d.activeTouch.left = e.touches[0].pageX;
          d.activeTouch.top = e.touches[0].pageY;
        }
      }
    });
    on(d.scroller, "touchmove", function () {
      if (d.activeTouch) { d.activeTouch.moved = true; }
    });
    on(d.scroller, "touchend", function (e) {
      var touch = d.activeTouch;
      if (touch && !eventInWidget(d, e) && touch.left != null &&
          !touch.moved && new Date - touch.start < 300) {
        var pos = cm.coordsChar(d.activeTouch, "page"), range;
        if (!touch.prev || farAway(touch, touch.prev)) // Single tap
          { range = new Range(pos, pos); }
        else if (!touch.prev.prev || farAway(touch, touch.prev.prev)) // Double tap
          { range = cm.findWordAt(pos); }
        else // Triple tap
          { range = new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))); }
        cm.setSelection(range.anchor, range.head);
        cm.focus();
        e_preventDefault(e);
      }
      finishTouch();
    });
    on(d.scroller, "touchcancel", finishTouch);

    // Sync scrolling between fake scrollbars and real scrollable
    // area, ensure viewport is updated when scrolling.
    on(d.scroller, "scroll", function () {
      if (d.scroller.clientHeight) {
        updateScrollTop(cm, d.scroller.scrollTop);
        setScrollLeft(cm, d.scroller.scrollLeft, true);
        signal(cm, "scroll", cm);
      }
    });

    // Listen to wheel events in order to try and update the viewport on time.
    on(d.scroller, "mousewheel", function (e) { return onScrollWheel(cm, e); });
    on(d.scroller, "DOMMouseScroll", function (e) { return onScrollWheel(cm, e); });

    // Prevent wrapper from ever scrolling
    on(d.wrapper, "scroll", function () { return d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });

    d.dragFunctions = {
      enter: function (e) {if (!signalDOMEvent(cm, e)) { e_stop(e); }},
      over: function (e) {if (!signalDOMEvent(cm, e)) { onDragOver(cm, e); e_stop(e); }},
      start: function (e) { return onDragStart(cm, e); },
      drop: operation(cm, onDrop),
      leave: function (e) {if (!signalDOMEvent(cm, e)) { clearDragCursor(cm); }}
    };

    var inp = d.input.getField();
    on(inp, "keyup", function (e) { return onKeyUp.call(cm, e); });
    on(inp, "keydown", operation(cm, onKeyDown));
    on(inp, "keypress", operation(cm, onKeyPress));
    on(inp, "focus", function (e) { return onFocus(cm, e); });
    on(inp, "blur", function (e) { return onBlur(cm, e); });
  }

  var initHooks = [];
  CodeMirror.defineInitHook = function (f) { return initHooks.push(f); };

  // Indent the given line. The how parameter can be "smart",
  // "add"/null, "subtract", or "prev". When aggressive is false
  // (typically set to true for forced single-line indents), empty
  // lines are not indented, and places where the mode returns Pass
  // are left alone.
  function indentLine(cm, n, how, aggressive) {
    var doc = cm.doc, state;
    if (how == null) { how = "add"; }
    if (how == "smart") {
      // Fall back to "prev" when the mode doesn't have an indentation
      // method.
      if (!doc.mode.indent) { how = "prev"; }
      else { state = getContextBefore(cm, n).state; }
    }

    var tabSize = cm.options.tabSize;
    var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);
    if (line.stateAfter) { line.stateAfter = null; }
    var curSpaceString = line.text.match(/^\s*/)[0], indentation;
    if (!aggressive && !/\S/.test(line.text)) {
      indentation = 0;
      how = "not";
    } else if (how == "smart") {
      indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);
      if (indentation == Pass || indentation > 150) {
        if (!aggressive) { return }
        how = "prev";
      }
    }
    if (how == "prev") {
      if (n > doc.first) { indentation = countColumn(getLine(doc, n-1).text, null, tabSize); }
      else { indentation = 0; }
    } else if (how == "add") {
      indentation = curSpace + cm.options.indentUnit;
    } else if (how == "subtract") {
      indentation = curSpace - cm.options.indentUnit;
    } else if (typeof how == "number") {
      indentation = curSpace + how;
    }
    indentation = Math.max(0, indentation);

    var indentString = "", pos = 0;
    if (cm.options.indentWithTabs)
      { for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += "\t";} }
    if (pos < indentation) { indentString += spaceStr(indentation - pos); }

    if (indentString != curSpaceString) {
      replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), "+input");
      line.stateAfter = null;
      return true
    } else {
      // Ensure that, if the cursor was in the whitespace at the start
      // of the line, it is moved to the end of that space.
      for (var i$1 = 0; i$1 < doc.sel.ranges.length; i$1++) {
        var range = doc.sel.ranges[i$1];
        if (range.head.line == n && range.head.ch < curSpaceString.length) {
          var pos$1 = Pos(n, curSpaceString.length);
          replaceOneSelection(doc, i$1, new Range(pos$1, pos$1));
          break
        }
      }
    }
  }

  // This will be set to a {lineWise: bool, text: [string]} object, so
  // that, when pasting, we know what kind of selections the copied
  // text was made out of.
  var lastCopied = null;

  function setLastCopied(newLastCopied) {
    lastCopied = newLastCopied;
  }

  function applyTextInput(cm, inserted, deleted, sel, origin) {
    var doc = cm.doc;
    cm.display.shift = false;
    if (!sel) { sel = doc.sel; }

    var recent = +new Date - 200;
    var paste = origin == "paste" || cm.state.pasteIncoming > recent;
    var textLines = splitLinesAuto(inserted), multiPaste = null;
    // When pasting N lines into N selections, insert one line per selection
    if (paste && sel.ranges.length > 1) {
      if (lastCopied && lastCopied.text.join("\n") == inserted) {
        if (sel.ranges.length % lastCopied.text.length == 0) {
          multiPaste = [];
          for (var i = 0; i < lastCopied.text.length; i++)
            { multiPaste.push(doc.splitLines(lastCopied.text[i])); }
        }
      } else if (textLines.length == sel.ranges.length && cm.options.pasteLinesPerSelection) {
        multiPaste = map(textLines, function (l) { return [l]; });
      }
    }

    var updateInput = cm.curOp.updateInput;
    // Normal behavior is to insert the new text into every selection
    for (var i$1 = sel.ranges.length - 1; i$1 >= 0; i$1--) {
      var range = sel.ranges[i$1];
      var from = range.from(), to = range.to();
      if (range.empty()) {
        if (deleted && deleted > 0) // Handle deletion
          { from = Pos(from.line, from.ch - deleted); }
        else if (cm.state.overwrite && !paste) // Handle overwrite
          { to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length)); }
        else if (paste && lastCopied && lastCopied.lineWise && lastCopied.text.join("\n") == textLines.join("\n"))
          { from = to = Pos(from.line, 0); }
      }
      var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i$1 % multiPaste.length] : textLines,
                         origin: origin || (paste ? "paste" : cm.state.cutIncoming > recent ? "cut" : "+input")};
      makeChange(cm.doc, changeEvent);
      signalLater(cm, "inputRead", cm, changeEvent);
    }
    if (inserted && !paste)
      { triggerElectric(cm, inserted); }

    ensureCursorVisible(cm);
    if (cm.curOp.updateInput < 2) { cm.curOp.updateInput = updateInput; }
    cm.curOp.typing = true;
    cm.state.pasteIncoming = cm.state.cutIncoming = -1;
  }

  function handlePaste(e, cm) {
    var pasted = e.clipboardData && e.clipboardData.getData("Text");
    if (pasted) {
      e.preventDefault();
      if (!cm.isReadOnly() && !cm.options.disableInput)
        { runInOp(cm, function () { return applyTextInput(cm, pasted, 0, null, "paste"); }); }
      return true
    }
  }

  function triggerElectric(cm, inserted) {
    // When an 'electric' character is inserted, immediately trigger a reindent
    if (!cm.options.electricChars || !cm.options.smartIndent) { return }
    var sel = cm.doc.sel;

    for (var i = sel.ranges.length - 1; i >= 0; i--) {
      var range = sel.ranges[i];
      if (range.head.ch > 100 || (i && sel.ranges[i - 1].head.line == range.head.line)) { continue }
      var mode = cm.getModeAt(range.head);
      var indented = false;
      if (mode.electricChars) {
        for (var j = 0; j < mode.electricChars.length; j++)
          { if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {
            indented = indentLine(cm, range.head.line, "smart");
            break
          } }
      } else if (mode.electricInput) {
        if (mode.electricInput.test(getLine(cm.doc, range.head.line).text.slice(0, range.head.ch)))
          { indented = indentLine(cm, range.head.line, "smart"); }
      }
      if (indented) { signalLater(cm, "electricInput", cm, range.head.line); }
    }
  }

  function copyableRanges(cm) {
    var text = [], ranges = [];
    for (var i = 0; i < cm.doc.sel.ranges.length; i++) {
      var line = cm.doc.sel.ranges[i].head.line;
      var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};
      ranges.push(lineRange);
      text.push(cm.getRange(lineRange.anchor, lineRange.head));
    }
    return {text: text, ranges: ranges}
  }

  function disableBrowserMagic(field, spellcheck, autocorrect, autocapitalize) {
    field.setAttribute("autocorrect", autocorrect ? "" : "off");
    field.setAttribute("autocapitalize", autocapitalize ? "" : "off");
    field.setAttribute("spellcheck", !!spellcheck);
  }

  function hiddenTextarea() {
    var te = elt("textarea", null, null, "position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none");
    var div = elt("div", [te], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
    // The textarea is kept positioned near the cursor to prevent the
    // fact that it'll be scrolled into view on input from scrolling
    // our fake cursor out of view. On webkit, when wrap=off, paste is
    // very slow. So make the area wide instead.
    if (webkit) { te.style.width = "1000px"; }
    else { te.setAttribute("wrap", "off"); }
    // If border: 0; -- iOS fails to open keyboard (issue #1287)
    if (ios) { te.style.border = "1px solid black"; }
    disableBrowserMagic(te);
    return div
  }

  // The publicly visible API. Note that methodOp(f) means
  // 'wrap f in an operation, performed on its `this` parameter'.

  // This is not the complete set of editor methods. Most of the
  // methods defined on the Doc type are also injected into
  // CodeMirror.prototype, for backwards compatibility and
  // convenience.

  function addEditorMethods(CodeMirror) {
    var optionHandlers = CodeMirror.optionHandlers;

    var helpers = CodeMirror.helpers = {};

    CodeMirror.prototype = {
      constructor: CodeMirror,
      focus: function(){window.focus(); this.display.input.focus();},

      setOption: function(option, value) {
        var options = this.options, old = options[option];
        if (options[option] == value && option != "mode") { return }
        options[option] = value;
        if (optionHandlers.hasOwnProperty(option))
          { operation(this, optionHandlers[option])(this, value, old); }
        signal(this, "optionChange", this, option);
      },

      getOption: function(option) {return this.options[option]},
      getDoc: function() {return this.doc},

      addKeyMap: function(map, bottom) {
        this.state.keyMaps[bottom ? "push" : "unshift"](getKeyMap(map));
      },
      removeKeyMap: function(map) {
        var maps = this.state.keyMaps;
        for (var i = 0; i < maps.length; ++i)
          { if (maps[i] == map || maps[i].name == map) {
            maps.splice(i, 1);
            return true
          } }
      },

      addOverlay: methodOp(function(spec, options) {
        var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);
        if (mode.startState) { throw new Error("Overlays may not be stateful.") }
        insertSorted(this.state.overlays,
                     {mode: mode, modeSpec: spec, opaque: options && options.opaque,
                      priority: (options && options.priority) || 0},
                     function (overlay) { return overlay.priority; });
        this.state.modeGen++;
        regChange(this);
      }),
      removeOverlay: methodOp(function(spec) {
        var overlays = this.state.overlays;
        for (var i = 0; i < overlays.length; ++i) {
          var cur = overlays[i].modeSpec;
          if (cur == spec || typeof spec == "string" && cur.name == spec) {
            overlays.splice(i, 1);
            this.state.modeGen++;
            regChange(this);
            return
          }
        }
      }),

      indentLine: methodOp(function(n, dir, aggressive) {
        if (typeof dir != "string" && typeof dir != "number") {
          if (dir == null) { dir = this.options.smartIndent ? "smart" : "prev"; }
          else { dir = dir ? "add" : "subtract"; }
        }
        if (isLine(this.doc, n)) { indentLine(this, n, dir, aggressive); }
      }),
      indentSelection: methodOp(function(how) {
        var ranges = this.doc.sel.ranges, end = -1;
        for (var i = 0; i < ranges.length; i++) {
          var range = ranges[i];
          if (!range.empty()) {
            var from = range.from(), to = range.to();
            var start = Math.max(end, from.line);
            end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;
            for (var j = start; j < end; ++j)
              { indentLine(this, j, how); }
            var newRanges = this.doc.sel.ranges;
            if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)
              { replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll); }
          } else if (range.head.line > end) {
            indentLine(this, range.head.line, how, true);
            end = range.head.line;
            if (i == this.doc.sel.primIndex) { ensureCursorVisible(this); }
          }
        }
      }),

      // Fetch the parser token for a given character. Useful for hacks
      // that want to inspect the mode state (say, for completion).
      getTokenAt: function(pos, precise) {
        return takeToken(this, pos, precise)
      },

      getLineTokens: function(line, precise) {
        return takeToken(this, Pos(line), precise, true)
      },

      getTokenTypeAt: function(pos) {
        pos = clipPos(this.doc, pos);
        var styles = getLineStyles(this, getLine(this.doc, pos.line));
        var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;
        var type;
        if (ch == 0) { type = styles[2]; }
        else { for (;;) {
          var mid = (before + after) >> 1;
          if ((mid ? styles[mid * 2 - 1] : 0) >= ch) { after = mid; }
          else if (styles[mid * 2 + 1] < ch) { before = mid + 1; }
          else { type = styles[mid * 2 + 2]; break }
        } }
        var cut = type ? type.indexOf("overlay ") : -1;
        return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1)
      },

      getModeAt: function(pos) {
        var mode = this.doc.mode;
        if (!mode.innerMode) { return mode }
        return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode
      },

      getHelper: function(pos, type) {
        return this.getHelpers(pos, type)[0]
      },

      getHelpers: function(pos, type) {
        var found = [];
        if (!helpers.hasOwnProperty(type)) { return found }
        var help = helpers[type], mode = this.getModeAt(pos);
        if (typeof mode[type] == "string") {
          if (help[mode[type]]) { found.push(help[mode[type]]); }
        } else if (mode[type]) {
          for (var i = 0; i < mode[type].length; i++) {
            var val = help[mode[type][i]];
            if (val) { found.push(val); }
          }
        } else if (mode.helperType && help[mode.helperType]) {
          found.push(help[mode.helperType]);
        } else if (help[mode.name]) {
          found.push(help[mode.name]);
        }
        for (var i$1 = 0; i$1 < help._global.length; i$1++) {
          var cur = help._global[i$1];
          if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)
            { found.push(cur.val); }
        }
        return found
      },

      getStateAfter: function(line, precise) {
        var doc = this.doc;
        line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);
        return getContextBefore(this, line + 1, precise).state
      },

      cursorCoords: function(start, mode) {
        var pos, range = this.doc.sel.primary();
        if (start == null) { pos = range.head; }
        else if (typeof start == "object") { pos = clipPos(this.doc, start); }
        else { pos = start ? range.from() : range.to(); }
        return cursorCoords(this, pos, mode || "page")
      },

      charCoords: function(pos, mode) {
        return charCoords(this, clipPos(this.doc, pos), mode || "page")
      },

      coordsChar: function(coords, mode) {
        coords = fromCoordSystem(this, coords, mode || "page");
        return coordsChar(this, coords.left, coords.top)
      },

      lineAtHeight: function(height, mode) {
        height = fromCoordSystem(this, {top: height, left: 0}, mode || "page").top;
        return lineAtHeight(this.doc, height + this.display.viewOffset)
      },
      heightAtLine: function(line, mode, includeWidgets) {
        var end = false, lineObj;
        if (typeof line == "number") {
          var last = this.doc.first + this.doc.size - 1;
          if (line < this.doc.first) { line = this.doc.first; }
          else if (line > last) { line = last; end = true; }
          lineObj = getLine(this.doc, line);
        } else {
          lineObj = line;
        }
        return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || "page", includeWidgets || end).top +
          (end ? this.doc.height - heightAtLine(lineObj) : 0)
      },

      defaultTextHeight: function() { return textHeight(this.display) },
      defaultCharWidth: function() { return charWidth(this.display) },

      getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo}},

      addWidget: function(pos, node, scroll, vert, horiz) {
        var display = this.display;
        pos = cursorCoords(this, clipPos(this.doc, pos));
        var top = pos.bottom, left = pos.left;
        node.style.position = "absolute";
        node.setAttribute("cm-ignore-events", "true");
        this.display.input.setUneditable(node);
        display.sizer.appendChild(node);
        if (vert == "over") {
          top = pos.top;
        } else if (vert == "above" || vert == "near") {
          var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),
          hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);
          // Default to positioning above (if specified and possible); otherwise default to positioning below
          if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)
            { top = pos.top - node.offsetHeight; }
          else if (pos.bottom + node.offsetHeight <= vspace)
            { top = pos.bottom; }
          if (left + node.offsetWidth > hspace)
            { left = hspace - node.offsetWidth; }
        }
        node.style.top = top + "px";
        node.style.left = node.style.right = "";
        if (horiz == "right") {
          left = display.sizer.clientWidth - node.offsetWidth;
          node.style.right = "0px";
        } else {
          if (horiz == "left") { left = 0; }
          else if (horiz == "middle") { left = (display.sizer.clientWidth - node.offsetWidth) / 2; }
          node.style.left = left + "px";
        }
        if (scroll)
          { scrollIntoView(this, {left: left, top: top, right: left + node.offsetWidth, bottom: top + node.offsetHeight}); }
      },

      triggerOnKeyDown: methodOp(onKeyDown),
      triggerOnKeyPress: methodOp(onKeyPress),
      triggerOnKeyUp: onKeyUp,
      triggerOnMouseDown: methodOp(onMouseDown),

      execCommand: function(cmd) {
        if (commands.hasOwnProperty(cmd))
          { return commands[cmd].call(null, this) }
      },

      triggerElectric: methodOp(function(text) { triggerElectric(this, text); }),

      findPosH: function(from, amount, unit, visually) {
        var dir = 1;
        if (amount < 0) { dir = -1; amount = -amount; }
        var cur = clipPos(this.doc, from);
        for (var i = 0; i < amount; ++i) {
          cur = findPosH(this.doc, cur, dir, unit, visually);
          if (cur.hitSide) { break }
        }
        return cur
      },

      moveH: methodOp(function(dir, unit) {
        var this$1 = this;

        this.extendSelectionsBy(function (range) {
          if (this$1.display.shift || this$1.doc.extend || range.empty())
            { return findPosH(this$1.doc, range.head, dir, unit, this$1.options.rtlMoveVisually) }
          else
            { return dir < 0 ? range.from() : range.to() }
        }, sel_move);
      }),

      deleteH: methodOp(function(dir, unit) {
        var sel = this.doc.sel, doc = this.doc;
        if (sel.somethingSelected())
          { doc.replaceSelection("", null, "+delete"); }
        else
          { deleteNearSelection(this, function (range) {
            var other = findPosH(doc, range.head, dir, unit, false);
            return dir < 0 ? {from: other, to: range.head} : {from: range.head, to: other}
          }); }
      }),

      findPosV: function(from, amount, unit, goalColumn) {
        var dir = 1, x = goalColumn;
        if (amount < 0) { dir = -1; amount = -amount; }
        var cur = clipPos(this.doc, from);
        for (var i = 0; i < amount; ++i) {
          var coords = cursorCoords(this, cur, "div");
          if (x == null) { x = coords.left; }
          else { coords.left = x; }
          cur = findPosV(this, coords, dir, unit);
          if (cur.hitSide) { break }
        }
        return cur
      },

      moveV: methodOp(function(dir, unit) {
        var this$1 = this;

        var doc = this.doc, goals = [];
        var collapse = !this.display.shift && !doc.extend && doc.sel.somethingSelected();
        doc.extendSelectionsBy(function (range) {
          if (collapse)
            { return dir < 0 ? range.from() : range.to() }
          var headPos = cursorCoords(this$1, range.head, "div");
          if (range.goalColumn != null) { headPos.left = range.goalColumn; }
          goals.push(headPos.left);
          var pos = findPosV(this$1, headPos, dir, unit);
          if (unit == "page" && range == doc.sel.primary())
            { addToScrollTop(this$1, charCoords(this$1, pos, "div").top - headPos.top); }
          return pos
        }, sel_move);
        if (goals.length) { for (var i = 0; i < doc.sel.ranges.length; i++)
          { doc.sel.ranges[i].goalColumn = goals[i]; } }
      }),

      // Find the word at the given position (as returned by coordsChar).
      findWordAt: function(pos) {
        var doc = this.doc, line = getLine(doc, pos.line).text;
        var start = pos.ch, end = pos.ch;
        if (line) {
          var helper = this.getHelper(pos, "wordChars");
          if ((pos.sticky == "before" || end == line.length) && start) { --start; } else { ++end; }
          var startChar = line.charAt(start);
          var check = isWordChar(startChar, helper)
            ? function (ch) { return isWordChar(ch, helper); }
            : /\s/.test(startChar) ? function (ch) { return /\s/.test(ch); }
            : function (ch) { return (!/\s/.test(ch) && !isWordChar(ch)); };
          while (start > 0 && check(line.charAt(start - 1))) { --start; }
          while (end < line.length && check(line.charAt(end))) { ++end; }
        }
        return new Range(Pos(pos.line, start), Pos(pos.line, end))
      },

      toggleOverwrite: function(value) {
        if (value != null && value == this.state.overwrite) { return }
        if (this.state.overwrite = !this.state.overwrite)
          { addClass(this.display.cursorDiv, "CodeMirror-overwrite"); }
        else
          { rmClass(this.display.cursorDiv, "CodeMirror-overwrite"); }

        signal(this, "overwriteToggle", this, this.state.overwrite);
      },
      hasFocus: function() { return this.display.input.getField() == activeElt() },
      isReadOnly: function() { return !!(this.options.readOnly || this.doc.cantEdit) },

      scrollTo: methodOp(function (x, y) { scrollToCoords(this, x, y); }),
      getScrollInfo: function() {
        var scroller = this.display.scroller;
        return {left: scroller.scrollLeft, top: scroller.scrollTop,
                height: scroller.scrollHeight - scrollGap(this) - this.display.barHeight,
                width: scroller.scrollWidth - scrollGap(this) - this.display.barWidth,
                clientHeight: displayHeight(this), clientWidth: displayWidth(this)}
      },

      scrollIntoView: methodOp(function(range, margin) {
        if (range == null) {
          range = {from: this.doc.sel.primary().head, to: null};
          if (margin == null) { margin = this.options.cursorScrollMargin; }
        } else if (typeof range == "number") {
          range = {from: Pos(range, 0), to: null};
        } else if (range.from == null) {
          range = {from: range, to: null};
        }
        if (!range.to) { range.to = range.from; }
        range.margin = margin || 0;

        if (range.from.line != null) {
          scrollToRange(this, range);
        } else {
          scrollToCoordsRange(this, range.from, range.to, range.margin);
        }
      }),

      setSize: methodOp(function(width, height) {
        var this$1 = this;

        var interpret = function (val) { return typeof val == "number" || /^\d+$/.test(String(val)) ? val + "px" : val; };
        if (width != null) { this.display.wrapper.style.width = interpret(width); }
        if (height != null) { this.display.wrapper.style.height = interpret(height); }
        if (this.options.lineWrapping) { clearLineMeasurementCache(this); }
        var lineNo = this.display.viewFrom;
        this.doc.iter(lineNo, this.display.viewTo, function (line) {
          if (line.widgets) { for (var i = 0; i < line.widgets.length; i++)
            { if (line.widgets[i].noHScroll) { regLineChange(this$1, lineNo, "widget"); break } } }
          ++lineNo;
        });
        this.curOp.forceUpdate = true;
        signal(this, "refresh", this);
      }),

      operation: function(f){return runInOp(this, f)},
      startOperation: function(){return startOperation(this)},
      endOperation: function(){return endOperation(this)},

      refresh: methodOp(function() {
        var oldHeight = this.display.cachedTextHeight;
        regChange(this);
        this.curOp.forceUpdate = true;
        clearCaches(this);
        scrollToCoords(this, this.doc.scrollLeft, this.doc.scrollTop);
        updateGutterSpace(this.display);
        if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5 || this.options.lineWrapping)
          { estimateLineHeights(this); }
        signal(this, "refresh", this);
      }),

      swapDoc: methodOp(function(doc) {
        var old = this.doc;
        old.cm = null;
        // Cancel the current text selection if any (#5821)
        if (this.state.selectingText) { this.state.selectingText(); }
        attachDoc(this, doc);
        clearCaches(this);
        this.display.input.reset();
        scrollToCoords(this, doc.scrollLeft, doc.scrollTop);
        this.curOp.forceScroll = true;
        signalLater(this, "swapDoc", this, old);
        return old
      }),

      phrase: function(phraseText) {
        var phrases = this.options.phrases;
        return phrases && Object.prototype.hasOwnProperty.call(phrases, phraseText) ? phrases[phraseText] : phraseText
      },

      getInputField: function(){return this.display.input.getField()},
      getWrapperElement: function(){return this.display.wrapper},
      getScrollerElement: function(){return this.display.scroller},
      getGutterElement: function(){return this.display.gutters}
    };
    eventMixin(CodeMirror);

    CodeMirror.registerHelper = function(type, name, value) {
      if (!helpers.hasOwnProperty(type)) { helpers[type] = CodeMirror[type] = {_global: []}; }
      helpers[type][name] = value;
    };
    CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {
      CodeMirror.registerHelper(type, name, value);
      helpers[type]._global.push({pred: predicate, val: value});
    };
  }

  // Used for horizontal relative motion. Dir is -1 or 1 (left or
  // right), unit can be "codepoint", "char", "column" (like char, but
  // doesn't cross line boundaries), "word" (across next word), or
  // "group" (to the start of next group of word or
  // non-word-non-whitespace chars). The visually param controls
  // whether, in right-to-left text, direction 1 means to move towards
  // the next index in the string, or towards the character to the right
  // of the current position. The resulting position will have a
  // hitSide=true property if it reached the end of the document.
  function findPosH(doc, pos, dir, unit, visually) {
    var oldPos = pos;
    var origDir = dir;
    var lineObj = getLine(doc, pos.line);
    var lineDir = visually && doc.direction == "rtl" ? -dir : dir;
    function findNextLine() {
      var l = pos.line + lineDir;
      if (l < doc.first || l >= doc.first + doc.size) { return false }
      pos = new Pos(l, pos.ch, pos.sticky);
      return lineObj = getLine(doc, l)
    }
    function moveOnce(boundToLine) {
      var next;
      if (unit == "codepoint") {
        var ch = lineObj.text.charCodeAt(pos.ch + (dir > 0 ? 0 : -1));
        if (isNaN(ch)) {
          next = null;
        } else {
          var astral = dir > 0 ? ch >= 0xD800 && ch < 0xDC00 : ch >= 0xDC00 && ch < 0xDFFF;
          next = new Pos(pos.line, Math.max(0, Math.min(lineObj.text.length, pos.ch + dir * (astral ? 2 : 1))), -dir);
        }
      } else if (visually) {
        next = moveVisually(doc.cm, lineObj, pos, dir);
      } else {
        next = moveLogically(lineObj, pos, dir);
      }
      if (next == null) {
        if (!boundToLine && findNextLine())
          { pos = endOfLine(visually, doc.cm, lineObj, pos.line, lineDir); }
        else
          { return false }
      } else {
        pos = next;
      }
      return true
    }

    if (unit == "char" || unit == "codepoint") {
      moveOnce();
    } else if (unit == "column") {
      moveOnce(true);
    } else if (unit == "word" || unit == "group") {
      var sawType = null, group = unit == "group";
      var helper = doc.cm && doc.cm.getHelper(pos, "wordChars");
      for (var first = true;; first = false) {
        if (dir < 0 && !moveOnce(!first)) { break }
        var cur = lineObj.text.charAt(pos.ch) || "\n";
        var type = isWordChar(cur, helper) ? "w"
          : group && cur == "\n" ? "n"
          : !group || /\s/.test(cur) ? null
          : "p";
        if (group && !first && !type) { type = "s"; }
        if (sawType && sawType != type) {
          if (dir < 0) {dir = 1; moveOnce(); pos.sticky = "after";}
          break
        }

        if (type) { sawType = type; }
        if (dir > 0 && !moveOnce(!first)) { break }
      }
    }
    var result = skipAtomic(doc, pos, oldPos, origDir, true);
    if (equalCursorPos(oldPos, result)) { result.hitSide = true; }
    return result
  }

  // For relative vertical movement. Dir may be -1 or 1. Unit can be
  // "page" or "line". The resulting position will have a hitSide=true
  // property if it reached the end of the document.
  function findPosV(cm, pos, dir, unit) {
    var doc = cm.doc, x = pos.left, y;
    if (unit == "page") {
      var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);
      var moveAmount = Math.max(pageSize - .5 * textHeight(cm.display), 3);
      y = (dir > 0 ? pos.bottom : pos.top) + dir * moveAmount;

    } else if (unit == "line") {
      y = dir > 0 ? pos.bottom + 3 : pos.top - 3;
    }
    var target;
    for (;;) {
      target = coordsChar(cm, x, y);
      if (!target.outside) { break }
      if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break }
      y += dir * 5;
    }
    return target
  }

  // CONTENTEDITABLE INPUT STYLE

  var ContentEditableInput = function(cm) {
    this.cm = cm;
    this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;
    this.polling = new Delayed();
    this.composing = null;
    this.gracePeriod = false;
    this.readDOMTimeout = null;
  };

  ContentEditableInput.prototype.init = function (display) {
      var this$1 = this;

    var input = this, cm = input.cm;
    var div = input.div = display.lineDiv;
    div.contentEditable = true;
    disableBrowserMagic(div, cm.options.spellcheck, cm.options.autocorrect, cm.options.autocapitalize);

    function belongsToInput(e) {
      for (var t = e.target; t; t = t.parentNode) {
        if (t == div) { return true }
        if (/\bCodeMirror-(?:line)?widget\b/.test(t.className)) { break }
      }
      return false
    }

    on(div, "paste", function (e) {
      if (!belongsToInput(e) || signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }
      // IE doesn't fire input events, so we schedule a read for the pasted content in this way
      if (ie_version <= 11) { setTimeout(operation(cm, function () { return this$1.updateFromDOM(); }), 20); }
    });

    on(div, "compositionstart", function (e) {
      this$1.composing = {data: e.data, done: false};
    });
    on(div, "compositionupdate", function (e) {
      if (!this$1.composing) { this$1.composing = {data: e.data, done: false}; }
    });
    on(div, "compositionend", function (e) {
      if (this$1.composing) {
        if (e.data != this$1.composing.data) { this$1.readFromDOMSoon(); }
        this$1.composing.done = true;
      }
    });

    on(div, "touchstart", function () { return input.forceCompositionEnd(); });

    on(div, "input", function () {
      if (!this$1.composing) { this$1.readFromDOMSoon(); }
    });

    function onCopyCut(e) {
      if (!belongsToInput(e) || signalDOMEvent(cm, e)) { return }
      if (cm.somethingSelected()) {
        setLastCopied({lineWise: false, text: cm.getSelections()});
        if (e.type == "cut") { cm.replaceSelection("", null, "cut"); }
      } else if (!cm.options.lineWiseCopyCut) {
        return
      } else {
        var ranges = copyableRanges(cm);
        setLastCopied({lineWise: true, text: ranges.text});
        if (e.type == "cut") {
          cm.operation(function () {
            cm.setSelections(ranges.ranges, 0, sel_dontScroll);
            cm.replaceSelection("", null, "cut");
          });
        }
      }
      if (e.clipboardData) {
        e.clipboardData.clearData();
        var content = lastCopied.text.join("\n");
        // iOS exposes the clipboard API, but seems to discard content inserted into it
        e.clipboardData.setData("Text", content);
        if (e.clipboardData.getData("Text") == content) {
          e.preventDefault();
          return
        }
      }
      // Old-fashioned briefly-focus-a-textarea hack
      var kludge = hiddenTextarea(), te = kludge.firstChild;
      cm.display.lineSpace.insertBefore(kludge, cm.display.lineSpace.firstChild);
      te.value = lastCopied.text.join("\n");
      var hadFocus = activeElt();
      selectInput(te);
      setTimeout(function () {
        cm.display.lineSpace.removeChild(kludge);
        hadFocus.focus();
        if (hadFocus == div) { input.showPrimarySelection(); }
      }, 50);
    }
    on(div, "copy", onCopyCut);
    on(div, "cut", onCopyCut);
  };

  ContentEditableInput.prototype.screenReaderLabelChanged = function (label) {
    // Label for screenreaders, accessibility
    if(label) {
      this.div.setAttribute('aria-label', label);
    } else {
      this.div.removeAttribute('aria-label');
    }
  };

  ContentEditableInput.prototype.prepareSelection = function () {
    var result = prepareSelection(this.cm, false);
    result.focus = activeElt() == this.div;
    return result
  };

  ContentEditableInput.prototype.showSelection = function (info, takeFocus) {
    if (!info || !this.cm.display.view.length) { return }
    if (info.focus || takeFocus) { this.showPrimarySelection(); }
    this.showMultipleSelections(info);
  };

  ContentEditableInput.prototype.getSelection = function () {
    return this.cm.display.wrapper.ownerDocument.getSelection()
  };

  ContentEditableInput.prototype.showPrimarySelection = function () {
    var sel = this.getSelection(), cm = this.cm, prim = cm.doc.sel.primary();
    var from = prim.from(), to = prim.to();

    if (cm.display.viewTo == cm.display.viewFrom || from.line >= cm.display.viewTo || to.line < cm.display.viewFrom) {
      sel.removeAllRanges();
      return
    }

    var curAnchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);
    var curFocus = domToPos(cm, sel.focusNode, sel.focusOffset);
    if (curAnchor && !curAnchor.bad && curFocus && !curFocus.bad &&
        cmp(minPos(curAnchor, curFocus), from) == 0 &&
        cmp(maxPos(curAnchor, curFocus), to) == 0)
      { return }

    var view = cm.display.view;
    var start = (from.line >= cm.display.viewFrom && posToDOM(cm, from)) ||
        {node: view[0].measure.map[2], offset: 0};
    var end = to.line < cm.display.viewTo && posToDOM(cm, to);
    if (!end) {
      var measure = view[view.length - 1].measure;
      var map = measure.maps ? measure.maps[measure.maps.length - 1] : measure.map;
      end = {node: map[map.length - 1], offset: map[map.length - 2] - map[map.length - 3]};
    }

    if (!start || !end) {
      sel.removeAllRanges();
      return
    }

    var old = sel.rangeCount && sel.getRangeAt(0), rng;
    try { rng = range(start.node, start.offset, end.offset, end.node); }
    catch(e) {} // Our model of the DOM might be outdated, in which case the range we try to set can be impossible
    if (rng) {
      if (!gecko && cm.state.focused) {
        sel.collapse(start.node, start.offset);
        if (!rng.collapsed) {
          sel.removeAllRanges();
          sel.addRange(rng);
        }
      } else {
        sel.removeAllRanges();
        sel.addRange(rng);
      }
      if (old && sel.anchorNode == null) { sel.addRange(old); }
      else if (gecko) { this.startGracePeriod(); }
    }
    this.rememberSelection();
  };

  ContentEditableInput.prototype.startGracePeriod = function () {
      var this$1 = this;

    clearTimeout(this.gracePeriod);
    this.gracePeriod = setTimeout(function () {
      this$1.gracePeriod = false;
      if (this$1.selectionChanged())
        { this$1.cm.operation(function () { return this$1.cm.curOp.selectionChanged = true; }); }
    }, 20);
  };

  ContentEditableInput.prototype.showMultipleSelections = function (info) {
    removeChildrenAndAdd(this.cm.display.cursorDiv, info.cursors);
    removeChildrenAndAdd(this.cm.display.selectionDiv, info.selection);
  };

  ContentEditableInput.prototype.rememberSelection = function () {
    var sel = this.getSelection();
    this.lastAnchorNode = sel.anchorNode; this.lastAnchorOffset = sel.anchorOffset;
    this.lastFocusNode = sel.focusNode; this.lastFocusOffset = sel.focusOffset;
  };

  ContentEditableInput.prototype.selectionInEditor = function () {
    var sel = this.getSelection();
    if (!sel.rangeCount) { return false }
    var node = sel.getRangeAt(0).commonAncestorContainer;
    return contains(this.div, node)
  };

  ContentEditableInput.prototype.focus = function () {
    if (this.cm.options.readOnly != "nocursor") {
      if (!this.selectionInEditor() || activeElt() != this.div)
        { this.showSelection(this.prepareSelection(), true); }
      this.div.focus();
    }
  };
  ContentEditableInput.prototype.blur = function () { this.div.blur(); };
  ContentEditableInput.prototype.getField = function () { return this.div };

  ContentEditableInput.prototype.supportsTouch = function () { return true };

  ContentEditableInput.prototype.receivedFocus = function () {
    var input = this;
    if (this.selectionInEditor())
      { this.pollSelection(); }
    else
      { runInOp(this.cm, function () { return input.cm.curOp.selectionChanged = true; }); }

    function poll() {
      if (input.cm.state.focused) {
        input.pollSelection();
        input.polling.set(input.cm.options.pollInterval, poll);
      }
    }
    this.polling.set(this.cm.options.pollInterval, poll);
  };

  ContentEditableInput.prototype.selectionChanged = function () {
    var sel = this.getSelection();
    return sel.anchorNode != this.lastAnchorNode || sel.anchorOffset != this.lastAnchorOffset ||
      sel.focusNode != this.lastFocusNode || sel.focusOffset != this.lastFocusOffset
  };

  ContentEditableInput.prototype.pollSelection = function () {
    if (this.readDOMTimeout != null || this.gracePeriod || !this.selectionChanged()) { return }
    var sel = this.getSelection(), cm = this.cm;
    // On Android Chrome (version 56, at least), backspacing into an
    // uneditable block element will put the cursor in that element,
    // and then, because it's not editable, hide the virtual keyboard.
    // Because Android doesn't allow us to actually detect backspace
    // presses in a sane way, this code checks for when that happens
    // and simulates a backspace press in this case.
    if (android && chrome && this.cm.display.gutterSpecs.length && isInGutter(sel.anchorNode)) {
      this.cm.triggerOnKeyDown({type: "keydown", keyCode: 8, preventDefault: Math.abs});
      this.blur();
      this.focus();
      return
    }
    if (this.composing) { return }
    this.rememberSelection();
    var anchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);
    var head = domToPos(cm, sel.focusNode, sel.focusOffset);
    if (anchor && head) { runInOp(cm, function () {
      setSelection(cm.doc, simpleSelection(anchor, head), sel_dontScroll);
      if (anchor.bad || head.bad) { cm.curOp.selectionChanged = true; }
    }); }
  };

  ContentEditableInput.prototype.pollContent = function () {
    if (this.readDOMTimeout != null) {
      clearTimeout(this.readDOMTimeout);
      this.readDOMTimeout = null;
    }

    var cm = this.cm, display = cm.display, sel = cm.doc.sel.primary();
    var from = sel.from(), to = sel.to();
    if (from.ch == 0 && from.line > cm.firstLine())
      { from = Pos(from.line - 1, getLine(cm.doc, from.line - 1).length); }
    if (to.ch == getLine(cm.doc, to.line).text.length && to.line < cm.lastLine())
      { to = Pos(to.line + 1, 0); }
    if (from.line < display.viewFrom || to.line > display.viewTo - 1) { return false }

    var fromIndex, fromLine, fromNode;
    if (from.line == display.viewFrom || (fromIndex = findViewIndex(cm, from.line)) == 0) {
      fromLine = lineNo(display.view[0].line);
      fromNode = display.view[0].node;
    } else {
      fromLine = lineNo(display.view[fromIndex].line);
      fromNode = display.view[fromIndex - 1].node.nextSibling;
    }
    var toIndex = findViewIndex(cm, to.line);
    var toLine, toNode;
    if (toIndex == display.view.length - 1) {
      toLine = display.viewTo - 1;
      toNode = display.lineDiv.lastChild;
    } else {
      toLine = lineNo(display.view[toIndex + 1].line) - 1;
      toNode = display.view[toIndex + 1].node.previousSibling;
    }

    if (!fromNode) { return false }
    var newText = cm.doc.splitLines(domTextBetween(cm, fromNode, toNode, fromLine, toLine));
    var oldText = getBetween(cm.doc, Pos(fromLine, 0), Pos(toLine, getLine(cm.doc, toLine).text.length));
    while (newText.length > 1 && oldText.length > 1) {
      if (lst(newText) == lst(oldText)) { newText.pop(); oldText.pop(); toLine--; }
      else if (newText[0] == oldText[0]) { newText.shift(); oldText.shift(); fromLine++; }
      else { break }
    }

    var cutFront = 0, cutEnd = 0;
    var newTop = newText[0], oldTop = oldText[0], maxCutFront = Math.min(newTop.length, oldTop.length);
    while (cutFront < maxCutFront && newTop.charCodeAt(cutFront) == oldTop.charCodeAt(cutFront))
      { ++cutFront; }
    var newBot = lst(newText), oldBot = lst(oldText);
    var maxCutEnd = Math.min(newBot.length - (newText.length == 1 ? cutFront : 0),
                             oldBot.length - (oldText.length == 1 ? cutFront : 0));
    while (cutEnd < maxCutEnd &&
           newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1))
      { ++cutEnd; }
    // Try to move start of change to start of selection if ambiguous
    if (newText.length == 1 && oldText.length == 1 && fromLine == from.line) {
      while (cutFront && cutFront > from.ch &&
             newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1)) {
        cutFront--;
        cutEnd++;
      }
    }

    newText[newText.length - 1] = newBot.slice(0, newBot.length - cutEnd).replace(/^\u200b+/, "");
    newText[0] = newText[0].slice(cutFront).replace(/\u200b+$/, "");

    var chFrom = Pos(fromLine, cutFront);
    var chTo = Pos(toLine, oldText.length ? lst(oldText).length - cutEnd : 0);
    if (newText.length > 1 || newText[0] || cmp(chFrom, chTo)) {
      replaceRange(cm.doc, newText, chFrom, chTo, "+input");
      return true
    }
  };

  ContentEditableInput.prototype.ensurePolled = function () {
    this.forceCompositionEnd();
  };
  ContentEditableInput.prototype.reset = function () {
    this.forceCompositionEnd();
  };
  ContentEditableInput.prototype.forceCompositionEnd = function () {
    if (!this.composing) { return }
    clearTimeout(this.readDOMTimeout);
    this.composing = null;
    this.updateFromDOM();
    this.div.blur();
    this.div.focus();
  };
  ContentEditableInput.prototype.readFromDOMSoon = function () {
      var this$1 = this;

    if (this.readDOMTimeout != null) { return }
    this.readDOMTimeout = setTimeout(function () {
      this$1.readDOMTimeout = null;
      if (this$1.composing) {
        if (this$1.composing.done) { this$1.composing = null; }
        else { return }
      }
      this$1.updateFromDOM();
    }, 80);
  };

  ContentEditableInput.prototype.updateFromDOM = function () {
      var this$1 = this;

    if (this.cm.isReadOnly() || !this.pollContent())
      { runInOp(this.cm, function () { return regChange(this$1.cm); }); }
  };

  ContentEditableInput.prototype.setUneditable = function (node) {
    node.contentEditable = "false";
  };

  ContentEditableInput.prototype.onKeyPress = function (e) {
    if (e.charCode == 0 || this.composing) { return }
    e.preventDefault();
    if (!this.cm.isReadOnly())
      { operation(this.cm, applyTextInput)(this.cm, String.fromCharCode(e.charCode == null ? e.keyCode : e.charCode), 0); }
  };

  ContentEditableInput.prototype.readOnlyChanged = function (val) {
    this.div.contentEditable = String(val != "nocursor");
  };

  ContentEditableInput.prototype.onContextMenu = function () {};
  ContentEditableInput.prototype.resetPosition = function () {};

  ContentEditableInput.prototype.needsContentAttribute = true;

  function posToDOM(cm, pos) {
    var view = findViewForLine(cm, pos.line);
    if (!view || view.hidden) { return null }
    var line = getLine(cm.doc, pos.line);
    var info = mapFromLineView(view, line, pos.line);

    var order = getOrder(line, cm.doc.direction), side = "left";
    if (order) {
      var partPos = getBidiPartAt(order, pos.ch);
      side = partPos % 2 ? "right" : "left";
    }
    var result = nodeAndOffsetInLineMap(info.map, pos.ch, side);
    result.offset = result.collapse == "right" ? result.end : result.start;
    return result
  }

  function isInGutter(node) {
    for (var scan = node; scan; scan = scan.parentNode)
      { if (/CodeMirror-gutter-wrapper/.test(scan.className)) { return true } }
    return false
  }

  function badPos(pos, bad) { if (bad) { pos.bad = true; } return pos }

  function domTextBetween(cm, from, to, fromLine, toLine) {
    var text = "", closing = false, lineSep = cm.doc.lineSeparator(), extraLinebreak = false;
    function recognizeMarker(id) { return function (marker) { return marker.id == id; } }
    function close() {
      if (closing) {
        text += lineSep;
        if (extraLinebreak) { text += lineSep; }
        closing = extraLinebreak = false;
      }
    }
    function addText(str) {
      if (str) {
        close();
        text += str;
      }
    }
    function walk(node) {
      if (node.nodeType == 1) {
        var cmText = node.getAttribute("cm-text");
        if (cmText) {
          addText(cmText);
          return
        }
        var markerID = node.getAttribute("cm-marker"), range;
        if (markerID) {
          var found = cm.findMarks(Pos(fromLine, 0), Pos(toLine + 1, 0), recognizeMarker(+markerID));
          if (found.length && (range = found[0].find(0)))
            { addText(getBetween(cm.doc, range.from, range.to).join(lineSep)); }
          return
        }
        if (node.getAttribute("contenteditable") == "false") { return }
        var isBlock = /^(pre|div|p|li|table|br)$/i.test(node.nodeName);
        if (!/^br$/i.test(node.nodeName) && node.textContent.length == 0) { return }

        if (isBlock) { close(); }
        for (var i = 0; i < node.childNodes.length; i++)
          { walk(node.childNodes[i]); }

        if (/^(pre|p)$/i.test(node.nodeName)) { extraLinebreak = true; }
        if (isBlock) { closing = true; }
      } else if (node.nodeType == 3) {
        addText(node.nodeValue.replace(/\u200b/g, "").replace(/\u00a0/g, " "));
      }
    }
    for (;;) {
      walk(from);
      if (from == to) { break }
      from = from.nextSibling;
      extraLinebreak = false;
    }
    return text
  }

  function domToPos(cm, node, offset) {
    var lineNode;
    if (node == cm.display.lineDiv) {
      lineNode = cm.display.lineDiv.childNodes[offset];
      if (!lineNode) { return badPos(cm.clipPos(Pos(cm.display.viewTo - 1)), true) }
      node = null; offset = 0;
    } else {
      for (lineNode = node;; lineNode = lineNode.parentNode) {
        if (!lineNode || lineNode == cm.display.lineDiv) { return null }
        if (lineNode.parentNode && lineNode.parentNode == cm.display.lineDiv) { break }
      }
    }
    for (var i = 0; i < cm.display.view.length; i++) {
      var lineView = cm.display.view[i];
      if (lineView.node == lineNode)
        { return locateNodeInLineView(lineView, node, offset) }
    }
  }

  function locateNodeInLineView(lineView, node, offset) {
    var wrapper = lineView.text.firstChild, bad = false;
    if (!node || !contains(wrapper, node)) { return badPos(Pos(lineNo(lineView.line), 0), true) }
    if (node == wrapper) {
      bad = true;
      node = wrapper.childNodes[offset];
      offset = 0;
      if (!node) {
        var line = lineView.rest ? lst(lineView.rest) : lineView.line;
        return badPos(Pos(lineNo(line), line.text.length), bad)
      }
    }

    var textNode = node.nodeType == 3 ? node : null, topNode = node;
    if (!textNode && node.childNodes.length == 1 && node.firstChild.nodeType == 3) {
      textNode = node.firstChild;
      if (offset) { offset = textNode.nodeValue.length; }
    }
    while (topNode.parentNode != wrapper) { topNode = topNode.parentNode; }
    var measure = lineView.measure, maps = measure.maps;

    function find(textNode, topNode, offset) {
      for (var i = -1; i < (maps ? maps.length : 0); i++) {
        var map = i < 0 ? measure.map : maps[i];
        for (var j = 0; j < map.length; j += 3) {
          var curNode = map[j + 2];
          if (curNode == textNode || curNode == topNode) {
            var line = lineNo(i < 0 ? lineView.line : lineView.rest[i]);
            var ch = map[j] + offset;
            if (offset < 0 || curNode != textNode) { ch = map[j + (offset ? 1 : 0)]; }
            return Pos(line, ch)
          }
        }
      }
    }
    var found = find(textNode, topNode, offset);
    if (found) { return badPos(found, bad) }

    // FIXME this is all really shaky. might handle the few cases it needs to handle, but likely to cause problems
    for (var after = topNode.nextSibling, dist = textNode ? textNode.nodeValue.length - offset : 0; after; after = after.nextSibling) {
      found = find(after, after.firstChild, 0);
      if (found)
        { return badPos(Pos(found.line, found.ch - dist), bad) }
      else
        { dist += after.textContent.length; }
    }
    for (var before = topNode.previousSibling, dist$1 = offset; before; before = before.previousSibling) {
      found = find(before, before.firstChild, -1);
      if (found)
        { return badPos(Pos(found.line, found.ch + dist$1), bad) }
      else
        { dist$1 += before.textContent.length; }
    }
  }

  // TEXTAREA INPUT STYLE

  var TextareaInput = function(cm) {
    this.cm = cm;
    // See input.poll and input.reset
    this.prevInput = "";

    // Flag that indicates whether we expect input to appear real soon
    // now (after some event like 'keypress' or 'input') and are
    // polling intensively.
    this.pollingFast = false;
    // Self-resetting timeout for the poller
    this.polling = new Delayed();
    // Used to work around IE issue with selection being forgotten when focus moves away from textarea
    this.hasSelection = false;
    this.composing = null;
  };

  TextareaInput.prototype.init = function (display) {
      var this$1 = this;

    var input = this, cm = this.cm;
    this.createField(display);
    var te = this.textarea;

    display.wrapper.insertBefore(this.wrapper, display.wrapper.firstChild);

    // Needed to hide big blue blinking cursor on Mobile Safari (doesn't seem to work in iOS 8 anymore)
    if (ios) { te.style.width = "0px"; }

    on(te, "input", function () {
      if (ie && ie_version >= 9 && this$1.hasSelection) { this$1.hasSelection = null; }
      input.poll();
    });

    on(te, "paste", function (e) {
      if (signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }

      cm.state.pasteIncoming = +new Date;
      input.fastPoll();
    });

    function prepareCopyCut(e) {
      if (signalDOMEvent(cm, e)) { return }
      if (cm.somethingSelected()) {
        setLastCopied({lineWise: false, text: cm.getSelections()});
      } else if (!cm.options.lineWiseCopyCut) {
        return
      } else {
        var ranges = copyableRanges(cm);
        setLastCopied({lineWise: true, text: ranges.text});
        if (e.type == "cut") {
          cm.setSelections(ranges.ranges, null, sel_dontScroll);
        } else {
          input.prevInput = "";
          te.value = ranges.text.join("\n");
          selectInput(te);
        }
      }
      if (e.type == "cut") { cm.state.cutIncoming = +new Date; }
    }
    on(te, "cut", prepareCopyCut);
    on(te, "copy", prepareCopyCut);

    on(display.scroller, "paste", function (e) {
      if (eventInWidget(display, e) || signalDOMEvent(cm, e)) { return }
      if (!te.dispatchEvent) {
        cm.state.pasteIncoming = +new Date;
        input.focus();
        return
      }

      // Pass the `paste` event to the textarea so it's handled by its event listener.
      var event = new Event("paste");
      event.clipboardData = e.clipboardData;
      te.dispatchEvent(event);
    });

    // Prevent normal selection in the editor (we handle our own)
    on(display.lineSpace, "selectstart", function (e) {
      if (!eventInWidget(display, e)) { e_preventDefault(e); }
    });

    on(te, "compositionstart", function () {
      var start = cm.getCursor("from");
      if (input.composing) { input.composing.range.clear(); }
      input.composing = {
        start: start,
        range: cm.markText(start, cm.getCursor("to"), {className: "CodeMirror-composing"})
      };
    });
    on(te, "compositionend", function () {
      if (input.composing) {
        input.poll();
        input.composing.range.clear();
        input.composing = null;
      }
    });
  };

  TextareaInput.prototype.createField = function (_display) {
    // Wraps and hides input textarea
    this.wrapper = hiddenTextarea();
    // The semihidden textarea that is focused when the editor is
    // focused, and receives input.
    this.textarea = this.wrapper.firstChild;
  };

  TextareaInput.prototype.screenReaderLabelChanged = function (label) {
    // Label for screenreaders, accessibility
    if(label) {
      this.textarea.setAttribute('aria-label', label);
    } else {
      this.textarea.removeAttribute('aria-label');
    }
  };

  TextareaInput.prototype.prepareSelection = function () {
    // Redraw the selection and/or cursor
    var cm = this.cm, display = cm.display, doc = cm.doc;
    var result = prepareSelection(cm);

    // Move the hidden textarea near the cursor to prevent scrolling artifacts
    if (cm.options.moveInputWithCursor) {
      var headPos = cursorCoords(cm, doc.sel.primary().head, "div");
      var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();
      result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,
                                          headPos.top + lineOff.top - wrapOff.top));
      result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,
                                           headPos.left + lineOff.left - wrapOff.left));
    }

    return result
  };

  TextareaInput.prototype.showSelection = function (drawn) {
    var cm = this.cm, display = cm.display;
    removeChildrenAndAdd(display.cursorDiv, drawn.cursors);
    removeChildrenAndAdd(display.selectionDiv, drawn.selection);
    if (drawn.teTop != null) {
      this.wrapper.style.top = drawn.teTop + "px";
      this.wrapper.style.left = drawn.teLeft + "px";
    }
  };

  // Reset the input to correspond to the selection (or to be empty,
  // when not typing and nothing is selected)
  TextareaInput.prototype.reset = function (typing) {
    if (this.contextMenuPending || this.composing) { return }
    var cm = this.cm;
    if (cm.somethingSelected()) {
      this.prevInput = "";
      var content = cm.getSelection();
      this.textarea.value = content;
      if (cm.state.focused) { selectInput(this.textarea); }
      if (ie && ie_version >= 9) { this.hasSelection = content; }
    } else if (!typing) {
      this.prevInput = this.textarea.value = "";
      if (ie && ie_version >= 9) { this.hasSelection = null; }
    }
  };

  TextareaInput.prototype.getField = function () { return this.textarea };

  TextareaInput.prototype.supportsTouch = function () { return false };

  TextareaInput.prototype.focus = function () {
    if (this.cm.options.readOnly != "nocursor" && (!mobile || activeElt() != this.textarea)) {
      try { this.textarea.focus(); }
      catch (e) {} // IE8 will throw if the textarea is display: none or not in DOM
    }
  };

  TextareaInput.prototype.blur = function () { this.textarea.blur(); };

  TextareaInput.prototype.resetPosition = function () {
    this.wrapper.style.top = this.wrapper.style.left = 0;
  };

  TextareaInput.prototype.receivedFocus = function () { this.slowPoll(); };

  // Poll for input changes, using the normal rate of polling. This
  // runs as long as the editor is focused.
  TextareaInput.prototype.slowPoll = function () {
      var this$1 = this;

    if (this.pollingFast) { return }
    this.polling.set(this.cm.options.pollInterval, function () {
      this$1.poll();
      if (this$1.cm.state.focused) { this$1.slowPoll(); }
    });
  };

  // When an event has just come in that is likely to add or change
  // something in the input textarea, we poll faster, to ensure that
  // the change appears on the screen quickly.
  TextareaInput.prototype.fastPoll = function () {
    var missed = false, input = this;
    input.pollingFast = true;
    function p() {
      var changed = input.poll();
      if (!changed && !missed) {missed = true; input.polling.set(60, p);}
      else {input.pollingFast = false; input.slowPoll();}
    }
    input.polling.set(20, p);
  };

  // Read input from the textarea, and update the document to match.
  // When something is selected, it is present in the textarea, and
  // selected (unless it is huge, in which case a placeholder is
  // used). When nothing is selected, the cursor sits after previously
  // seen text (can be empty), which is stored in prevInput (we must
  // not reset the textarea when typing, because that breaks IME).
  TextareaInput.prototype.poll = function () {
      var this$1 = this;

    var cm = this.cm, input = this.textarea, prevInput = this.prevInput;
    // Since this is called a *lot*, try to bail out as cheaply as
    // possible when it is clear that nothing happened. hasSelection
    // will be the case when there is a lot of text in the textarea,
    // in which case reading its value would be expensive.
    if (this.contextMenuPending || !cm.state.focused ||
        (hasSelection(input) && !prevInput && !this.composing) ||
        cm.isReadOnly() || cm.options.disableInput || cm.state.keySeq)
      { return false }

    var text = input.value;
    // If nothing changed, bail.
    if (text == prevInput && !cm.somethingSelected()) { return false }
    // Work around nonsensical selection resetting in IE9/10, and
    // inexplicable appearance of private area unicode characters on
    // some key combos in Mac (#2689).
    if (ie && ie_version >= 9 && this.hasSelection === text ||
        mac && /[\uf700-\uf7ff]/.test(text)) {
      cm.display.input.reset();
      return false
    }

    if (cm.doc.sel == cm.display.selForContextMenu) {
      var first = text.charCodeAt(0);
      if (first == 0x200b && !prevInput) { prevInput = "\u200b"; }
      if (first == 0x21da) { this.reset(); return this.cm.execCommand("undo") }
    }
    // Find the part of the input that is actually new
    var same = 0, l = Math.min(prevInput.length, text.length);
    while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) { ++same; }

    runInOp(cm, function () {
      applyTextInput(cm, text.slice(same), prevInput.length - same,
                     null, this$1.composing ? "*compose" : null);

      // Don't leave long text in the textarea, since it makes further polling slow
      if (text.length > 1000 || text.indexOf("\n") > -1) { input.value = this$1.prevInput = ""; }
      else { this$1.prevInput = text; }

      if (this$1.composing) {
        this$1.composing.range.clear();
        this$1.composing.range = cm.markText(this$1.composing.start, cm.getCursor("to"),
                                           {className: "CodeMirror-composing"});
      }
    });
    return true
  };

  TextareaInput.prototype.ensurePolled = function () {
    if (this.pollingFast && this.poll()) { this.pollingFast = false; }
  };

  TextareaInput.prototype.onKeyPress = function () {
    if (ie && ie_version >= 9) { this.hasSelection = null; }
    this.fastPoll();
  };

  TextareaInput.prototype.onContextMenu = function (e) {
    var input = this, cm = input.cm, display = cm.display, te = input.textarea;
    if (input.contextMenuPending) { input.contextMenuPending(); }
    var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;
    if (!pos || presto) { return } // Opera is difficult.

    // Reset the current text selection only if the click is done outside of the selection
    // and 'resetSelectionOnContextMenu' option is true.
    var reset = cm.options.resetSelectionOnContextMenu;
    if (reset && cm.doc.sel.contains(pos) == -1)
      { operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll); }

    var oldCSS = te.style.cssText, oldWrapperCSS = input.wrapper.style.cssText;
    var wrapperBox = input.wrapper.offsetParent.getBoundingClientRect();
    input.wrapper.style.cssText = "position: static";
    te.style.cssText = "position: absolute; width: 30px; height: 30px;\n      top: " + (e.clientY - wrapperBox.top - 5) + "px; left: " + (e.clientX - wrapperBox.left - 5) + "px;\n      z-index: 1000; background: " + (ie ? "rgba(255, 255, 255, .05)" : "transparent") + ";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
    var oldScrollY;
    if (webkit) { oldScrollY = window.scrollY; } // Work around Chrome issue (#2712)
    display.input.focus();
    if (webkit) { window.scrollTo(null, oldScrollY); }
    display.input.reset();
    // Adds "Select all" to context menu in FF
    if (!cm.somethingSelected()) { te.value = input.prevInput = " "; }
    input.contextMenuPending = rehide;
    display.selForContextMenu = cm.doc.sel;
    clearTimeout(display.detectingSelectAll);

    // Select-all will be greyed out if there's nothing to select, so
    // this adds a zero-width space so that we can later check whether
    // it got selected.
    function prepareSelectAllHack() {
      if (te.selectionStart != null) {
        var selected = cm.somethingSelected();
        var extval = "\u200b" + (selected ? te.value : "");
        te.value = "\u21da"; // Used to catch context-menu undo
        te.value = extval;
        input.prevInput = selected ? "" : "\u200b";
        te.selectionStart = 1; te.selectionEnd = extval.length;
        // Re-set this, in case some other handler touched the
        // selection in the meantime.
        display.selForContextMenu = cm.doc.sel;
      }
    }
    function rehide() {
      if (input.contextMenuPending != rehide) { return }
      input.contextMenuPending = false;
      input.wrapper.style.cssText = oldWrapperCSS;
      te.style.cssText = oldCSS;
      if (ie && ie_version < 9) { display.scrollbars.setScrollTop(display.scroller.scrollTop = scrollPos); }

      // Try to detect the user choosing select-all
      if (te.selectionStart != null) {
        if (!ie || (ie && ie_version < 9)) { prepareSelectAllHack(); }
        var i = 0, poll = function () {
          if (display.selForContextMenu == cm.doc.sel && te.selectionStart == 0 &&
              te.selectionEnd > 0 && input.prevInput == "\u200b") {
            operation(cm, selectAll)(cm);
          } else if (i++ < 10) {
            display.detectingSelectAll = setTimeout(poll, 500);
          } else {
            display.selForContextMenu = null;
            display.input.reset();
          }
        };
        display.detectingSelectAll = setTimeout(poll, 200);
      }
    }

    if (ie && ie_version >= 9) { prepareSelectAllHack(); }
    if (captureRightClick) {
      e_stop(e);
      var mouseup = function () {
        off(window, "mouseup", mouseup);
        setTimeout(rehide, 20);
      };
      on(window, "mouseup", mouseup);
    } else {
      setTimeout(rehide, 50);
    }
  };

  TextareaInput.prototype.readOnlyChanged = function (val) {
    if (!val) { this.reset(); }
    this.textarea.disabled = val == "nocursor";
    this.textarea.readOnly = !!val;
  };

  TextareaInput.prototype.setUneditable = function () {};

  TextareaInput.prototype.needsContentAttribute = false;

  function fromTextArea(textarea, options) {
    options = options ? copyObj(options) : {};
    options.value = textarea.value;
    if (!options.tabindex && textarea.tabIndex)
      { options.tabindex = textarea.tabIndex; }
    if (!options.placeholder && textarea.placeholder)
      { options.placeholder = textarea.placeholder; }
    // Set autofocus to true if this textarea is focused, or if it has
    // autofocus and no other element is focused.
    if (options.autofocus == null) {
      var hasFocus = activeElt();
      options.autofocus = hasFocus == textarea ||
        textarea.getAttribute("autofocus") != null && hasFocus == document.body;
    }

    function save() {textarea.value = cm.getValue();}

    var realSubmit;
    if (textarea.form) {
      on(textarea.form, "submit", save);
      // Deplorable hack to make the submit method do the right thing.
      if (!options.leaveSubmitMethodAlone) {
        var form = textarea.form;
        realSubmit = form.submit;
        try {
          var wrappedSubmit = form.submit = function () {
            save();
            form.submit = realSubmit;
            form.submit();
            form.submit = wrappedSubmit;
          };
        } catch(e) {}
      }
    }

    options.finishInit = function (cm) {
      cm.save = save;
      cm.getTextArea = function () { return textarea; };
      cm.toTextArea = function () {
        cm.toTextArea = isNaN; // Prevent this from being ran twice
        save();
        textarea.parentNode.removeChild(cm.getWrapperElement());
        textarea.style.display = "";
        if (textarea.form) {
          off(textarea.form, "submit", save);
          if (!options.leaveSubmitMethodAlone && typeof textarea.form.submit == "function")
            { textarea.form.submit = realSubmit; }
        }
      };
    };

    textarea.style.display = "none";
    var cm = CodeMirror(function (node) { return textarea.parentNode.insertBefore(node, textarea.nextSibling); },
      options);
    return cm
  }

  function addLegacyProps(CodeMirror) {
    CodeMirror.off = off;
    CodeMirror.on = on;
    CodeMirror.wheelEventPixels = wheelEventPixels;
    CodeMirror.Doc = Doc;
    CodeMirror.splitLines = splitLinesAuto;
    CodeMirror.countColumn = countColumn;
    CodeMirror.findColumn = findColumn;
    CodeMirror.isWordChar = isWordCharBasic;
    CodeMirror.Pass = Pass;
    CodeMirror.signal = signal;
    CodeMirror.Line = Line;
    CodeMirror.changeEnd = changeEnd;
    CodeMirror.scrollbarModel = scrollbarModel;
    CodeMirror.Pos = Pos;
    CodeMirror.cmpPos = cmp;
    CodeMirror.modes = modes;
    CodeMirror.mimeModes = mimeModes;
    CodeMirror.resolveMode = resolveMode;
    CodeMirror.getMode = getMode;
    CodeMirror.modeExtensions = modeExtensions;
    CodeMirror.extendMode = extendMode;
    CodeMirror.copyState = copyState;
    CodeMirror.startState = startState;
    CodeMirror.innerMode = innerMode;
    CodeMirror.commands = commands;
    CodeMirror.keyMap = keyMap;
    CodeMirror.keyName = keyName;
    CodeMirror.isModifierKey = isModifierKey;
    CodeMirror.lookupKey = lookupKey;
    CodeMirror.normalizeKeyMap = normalizeKeyMap;
    CodeMirror.StringStream = StringStream;
    CodeMirror.SharedTextMarker = SharedTextMarker;
    CodeMirror.TextMarker = TextMarker;
    CodeMirror.LineWidget = LineWidget;
    CodeMirror.e_preventDefault = e_preventDefault;
    CodeMirror.e_stopPropagation = e_stopPropagation;
    CodeMirror.e_stop = e_stop;
    CodeMirror.addClass = addClass;
    CodeMirror.contains = contains;
    CodeMirror.rmClass = rmClass;
    CodeMirror.keyNames = keyNames;
  }

  // EDITOR CONSTRUCTOR

  defineOptions(CodeMirror);

  addEditorMethods(CodeMirror);

  // Set up methods on CodeMirror's prototype to redirect to the editor's document.
  var dontDelegate = "iter insert remove copy getEditor constructor".split(" ");
  for (var prop in Doc.prototype) { if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)
    { CodeMirror.prototype[prop] = (function(method) {
      return function() {return method.apply(this.doc, arguments)}
    })(Doc.prototype[prop]); } }

  eventMixin(Doc);
  CodeMirror.inputStyles = {"textarea": TextareaInput, "contenteditable": ContentEditableInput};

  // Extra arguments are stored as the mode's dependencies, which is
  // used by (legacy) mechanisms like loadmode.js to automatically
  // load a mode. (Preferred mechanism is the require/define calls.)
  CodeMirror.defineMode = function(name/*, mode, */) {
    if (!CodeMirror.defaults.mode && name != "null") { CodeMirror.defaults.mode = name; }
    defineMode.apply(this, arguments);
  };

  CodeMirror.defineMIME = defineMIME;

  // Minimal default mode.
  CodeMirror.defineMode("null", function () { return ({token: function (stream) { return stream.skipToEnd(); }}); });
  CodeMirror.defineMIME("text/plain", "null");

  // EXTENSIONS

  CodeMirror.defineExtension = function (name, func) {
    CodeMirror.prototype[name] = func;
  };
  CodeMirror.defineDocExtension = function (name, func) {
    Doc.prototype[name] = func;
  };

  CodeMirror.fromTextArea = fromTextArea;

  addLegacyProps(CodeMirror);

  CodeMirror.version = "5.62.3";

  return CodeMirror;

})));
</script>
    <script>// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  var noOptions = {};
  var nonWS = /[^\s\u00a0]/;
  var Pos = CodeMirror.Pos, cmp = CodeMirror.cmpPos;

  function firstNonWS(str) {
    var found = str.search(nonWS);
    return found == -1 ? 0 : found;
  }

  CodeMirror.commands.toggleComment = function(cm) {
    cm.toggleComment();
  };

  CodeMirror.defineExtension("toggleComment", function(options) {
    if (!options) options = noOptions;
    var cm = this;
    var minLine = Infinity, ranges = this.listSelections(), mode = null;
    for (var i = ranges.length - 1; i >= 0; i--) {
      var from = ranges[i].from(), to = ranges[i].to();
      if (from.line >= minLine) continue;
      if (to.line >= minLine) to = Pos(minLine, 0);
      minLine = from.line;
      if (mode == null) {
        if (cm.uncomment(from, to, options)) mode = "un";
        else { cm.lineComment(from, to, options); mode = "line"; }
      } else if (mode == "un") {
        cm.uncomment(from, to, options);
      } else {
        cm.lineComment(from, to, options);
      }
    }
  });

  // Rough heuristic to try and detect lines that are part of multi-line string
  function probablyInsideString(cm, pos, line) {
    return /\bstring\b/.test(cm.getTokenTypeAt(Pos(pos.line, 0))) && !/^[\'\"\`]/.test(line)
  }

  function getMode(cm, pos) {
    var mode = cm.getMode()
    return mode.useInnerComments === false || !mode.innerMode ? mode : cm.getModeAt(pos)
  }

  CodeMirror.defineExtension("lineComment", function(from, to, options) {
    if (!options) options = noOptions;
    var self = this, mode = getMode(self, from);
    var firstLine = self.getLine(from.line);
    if (firstLine == null || probablyInsideString(self, from, firstLine)) return;

    var commentString = options.lineComment || mode.lineComment;
    if (!commentString) {
      if (options.blockCommentStart || mode.blockCommentStart) {
        options.fullLines = true;
        self.blockComment(from, to, options);
      }
      return;
    }

    var end = Math.min(to.ch != 0 || to.line == from.line ? to.line + 1 : to.line, self.lastLine() + 1);
    var pad = options.padding == null ? " " : options.padding;
    var blankLines = options.commentBlankLines || from.line == to.line;

    self.operation(function() {
      if (options.indent) {
        var baseString = null;
        for (var i = from.line; i < end; ++i) {
          var line = self.getLine(i);
          var whitespace = line.slice(0, firstNonWS(line));
          if (baseString == null || baseString.length > whitespace.length) {
            baseString = whitespace;
          }
        }
        for (var i = from.line; i < end; ++i) {
          var line = self.getLine(i), cut = baseString.length;
          if (!blankLines && !nonWS.test(line)) continue;
          if (line.slice(0, cut) != baseString) cut = firstNonWS(line);
          self.replaceRange(baseString + commentString + pad, Pos(i, 0), Pos(i, cut));
        }
      } else {
        for (var i = from.line; i < end; ++i) {
          if (blankLines || nonWS.test(self.getLine(i)))
            self.replaceRange(commentString + pad, Pos(i, 0));
        }
      }
    });
  });

  CodeMirror.defineExtension("blockComment", function(from, to, options) {
    if (!options) options = noOptions;
    var self = this, mode = getMode(self, from);
    var startString = options.blockCommentStart || mode.blockCommentStart;
    var endString = options.blockCommentEnd || mode.blockCommentEnd;
    if (!startString || !endString) {
      if ((options.lineComment || mode.lineComment) && options.fullLines != false)
        self.lineComment(from, to, options);
      return;
    }
    if (/\bcomment\b/.test(self.getTokenTypeAt(Pos(from.line, 0)))) return

    var end = Math.min(to.line, self.lastLine());
    if (end != from.line && to.ch == 0 && nonWS.test(self.getLine(end))) --end;

    var pad = options.padding == null ? " " : options.padding;
    if (from.line > end) return;

    self.operation(function() {
      if (options.fullLines != false) {
        var lastLineHasText = nonWS.test(self.getLine(end));
        self.replaceRange(pad + endString, Pos(end));
        self.replaceRange(startString + pad, Pos(from.line, 0));
        var lead = options.blockCommentLead || mode.blockCommentLead;
        if (lead != null) for (var i = from.line + 1; i <= end; ++i)
          if (i != end || lastLineHasText)
            self.replaceRange(lead + pad, Pos(i, 0));
      } else {
        var atCursor = cmp(self.getCursor("to"), to) == 0, empty = !self.somethingSelected()
        self.replaceRange(endString, to);
        if (atCursor) self.setSelection(empty ? to : self.getCursor("from"), to)
        self.replaceRange(startString, from);
      }
    });
  });

  CodeMirror.defineExtension("uncomment", function(from, to, options) {
    if (!options) options = noOptions;
    var self = this, mode = getMode(self, from);
    var end = Math.min(to.ch != 0 || to.line == from.line ? to.line : to.line - 1, self.lastLine()), start = Math.min(from.line, end);

    // Try finding line comments
    var lineString = options.lineComment || mode.lineComment, lines = [];
    var pad = options.padding == null ? " " : options.padding, didSomething;
    lineComment: {
      if (!lineString) break lineComment;
      for (var i = start; i <= end; ++i) {
        var line = self.getLine(i);
        var found = line.indexOf(lineString);
        if (found > -1 && !/comment/.test(self.getTokenTypeAt(Pos(i, found + 1)))) found = -1;
        if (found == -1 && nonWS.test(line)) break lineComment;
        if (found > -1 && nonWS.test(line.slice(0, found))) break lineComment;
        lines.push(line);
      }
      self.operation(function() {
        for (var i = start; i <= end; ++i) {
          var line = lines[i - start];
          var pos = line.indexOf(lineString), endPos = pos + lineString.length;
          if (pos < 0) continue;
          if (line.slice(endPos, endPos + pad.length) == pad) endPos += pad.length;
          didSomething = true;
          self.replaceRange("", Pos(i, pos), Pos(i, endPos));
        }
      });
      if (didSomething) return true;
    }

    // Try block comments
    var startString = options.blockCommentStart || mode.blockCommentStart;
    var endString = options.blockCommentEnd || mode.blockCommentEnd;
    if (!startString || !endString) return false;
    var lead = options.blockCommentLead || mode.blockCommentLead;
    var startLine = self.getLine(start), open = startLine.indexOf(startString)
    if (open == -1) return false
    var endLine = end == start ? startLine : self.getLine(end)
    var close = endLine.indexOf(endString, end == start ? open + startString.length : 0);
    var insideStart = Pos(start, open + 1), insideEnd = Pos(end, close + 1)
    if (close == -1 ||
        !/comment/.test(self.getTokenTypeAt(insideStart)) ||
        !/comment/.test(self.getTokenTypeAt(insideEnd)) ||
        self.getRange(insideStart, insideEnd, "\n").indexOf(endString) > -1)
      return false;

    // Avoid killing block comments completely outside the selection.
    // Positions of the last startString before the start of the selection, and the first endString after it.
    var lastStart = startLine.lastIndexOf(startString, from.ch);
    var firstEnd = lastStart == -1 ? -1 : startLine.slice(0, from.ch).indexOf(endString, lastStart + startString.length);
    if (lastStart != -1 && firstEnd != -1 && firstEnd + endString.length != from.ch) return false;
    // Positions of the first endString after the end of the selection, and the last startString before it.
    firstEnd = endLine.indexOf(endString, to.ch);
    var almostLastStart = endLine.slice(to.ch).lastIndexOf(startString, firstEnd - to.ch);
    lastStart = (firstEnd == -1 || almostLastStart == -1) ? -1 : to.ch + almostLastStart;
    if (firstEnd != -1 && lastStart != -1 && lastStart != to.ch) return false;

    self.operation(function() {
      self.replaceRange("", Pos(end, close - (pad && endLine.slice(close - pad.length, close) == pad ? pad.length : 0)),
                        Pos(end, close + endString.length));
      var openEnd = open + startString.length;
      if (pad && startLine.slice(openEnd, openEnd + pad.length) == pad) openEnd += pad.length;
      self.replaceRange("", Pos(start, open), Pos(start, openEnd));
      if (lead) for (var i = start + 1; i <= end; ++i) {
        var line = self.getLine(i), found = line.indexOf(lead);
        if (found == -1 || nonWS.test(line.slice(0, found))) continue;
        var foundEnd = found + lead.length;
        if (pad && line.slice(foundEnd, foundEnd + pad.length) == pad) foundEnd += pad.length;
        self.replaceRange("", Pos(i, found), Pos(i, foundEnd));
      }
    });
    return true;
  });
});
</script>
    <script>// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE

// Open simple dialogs on top of an editor. Relies on dialog.css.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  function dialogDiv(cm, template, bottom) {
    var wrap = cm.getWrapperElement();
    var dialog;
    dialog = wrap.appendChild(document.createElement("div"));
    if (bottom)
      dialog.className = "CodeMirror-dialog CodeMirror-dialog-bottom";
    else
      dialog.className = "CodeMirror-dialog CodeMirror-dialog-top";

    if (typeof template == "string") {
      dialog.innerHTML = template;
    } else { // Assuming it's a detached DOM element.
      dialog.appendChild(template);
    }
    CodeMirror.addClass(wrap, 'dialog-opened');
    return dialog;
  }

  function closeNotification(cm, newVal) {
    if (cm.state.currentNotificationClose)
      cm.state.currentNotificationClose();
    cm.state.currentNotificationClose = newVal;
  }

  CodeMirror.defineExtension("openDialog", function(template, callback, options) {
    if (!options) options = {};

    closeNotification(this, null);

    var dialog = dialogDiv(this, template, options.bottom);
    var closed = false, me = this;
    function close(newVal) {
      if (typeof newVal == 'string') {
        inp.value = newVal;
      } else {
        if (closed) return;
        closed = true;
        CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');
        dialog.parentNode.removeChild(dialog);
        me.focus();

        if (options.onClose) options.onClose(dialog);
      }
    }

    var inp = dialog.getElementsByTagName("input")[0], button;
    if (inp) {
      inp.focus();

      if (options.value) {
        inp.value = options.value;
        if (options.selectValueOnOpen !== false) {
          inp.select();
        }
      }

      if (options.onInput)
        CodeMirror.on(inp, "input", function(e) { options.onInput(e, inp.value, close);});
      if (options.onKeyUp)
        CodeMirror.on(inp, "keyup", function(e) {options.onKeyUp(e, inp.value, close);});

      CodeMirror.on(inp, "keydown", function(e) {
        if (options && options.onKeyDown && options.onKeyDown(e, inp.value, close)) { return; }
        if (e.keyCode == 27 || (options.closeOnEnter !== false && e.keyCode == 13)) {
          inp.blur();
          CodeMirror.e_stop(e);
          close();
        }
        if (e.keyCode == 13) callback(inp.value, e);
      });

      if (options.closeOnBlur !== false) CodeMirror.on(dialog, "focusout", function (evt) {
        if (evt.relatedTarget !== null) close();
      });
    } else if (button = dialog.getElementsByTagName("button")[0]) {
      CodeMirror.on(button, "click", function() {
        close();
        me.focus();
      });

      if (options.closeOnBlur !== false) CodeMirror.on(button, "blur", close);

      button.focus();
    }
    return close;
  });

  CodeMirror.defineExtension("openConfirm", function(template, callbacks, options) {
    closeNotification(this, null);
    var dialog = dialogDiv(this, template, options && options.bottom);
    var buttons = dialog.getElementsByTagName("button");
    var closed = false, me = this, blurring = 1;
    function close() {
      if (closed) return;
      closed = true;
      CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');
      dialog.parentNode.removeChild(dialog);
      me.focus();
    }
    buttons[0].focus();
    for (var i = 0; i < buttons.length; ++i) {
      var b = buttons[i];
      (function(callback) {
        CodeMirror.on(b, "click", function(e) {
          CodeMirror.e_preventDefault(e);
          close();
          if (callback) callback(me);
        });
      })(callbacks[i]);
      CodeMirror.on(b, "blur", function() {
        --blurring;
        setTimeout(function() { if (blurring <= 0) close(); }, 200);
      });
      CodeMirror.on(b, "focus", function() { ++blurring; });
    }
  });

  /*
   * openNotification
   * Opens a notification, that can be closed with an optional timer
   * (default 5000ms timer) and always closes on click.
   *
   * If a notification is opened while another is opened, it will close the
   * currently opened one and open the new one immediately.
   */
  CodeMirror.defineExtension("openNotification", function(template, options) {
    closeNotification(this, close);
    var dialog = dialogDiv(this, template, options && options.bottom);
    var closed = false, doneTimer;
    var duration = options && typeof options.duration !== "undefined" ? options.duration : 5000;

    function close() {
      if (closed) return;
      closed = true;
      clearTimeout(doneTimer);
      CodeMirror.rmClass(dialog.parentNode, 'dialog-opened');
      dialog.parentNode.removeChild(dialog);
    }

    CodeMirror.on(dialog, 'click', function(e) {
      CodeMirror.e_preventDefault(e);
      close();
    });

    if (duration)
      doneTimer = setTimeout(close, duration);

    return close;
  });
});
</script>
    <script>// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  CodeMirror.defineSimpleMode = function(name, states) {
    CodeMirror.defineMode(name, function(config) {
      return CodeMirror.simpleMode(config, states);
    });
  };

  CodeMirror.simpleMode = function(config, states) {
    ensureState(states, "start");
    var states_ = {}, meta = states.meta || {}, hasIndentation = false;
    for (var state in states) if (state != meta && states.hasOwnProperty(state)) {
      var list = states_[state] = [], orig = states[state];
      for (var i = 0; i < orig.length; i++) {
        var data = orig[i];
        list.push(new Rule(data, states));
        if (data.indent || data.dedent) hasIndentation = true;
      }
    }
    var mode = {
      startState: function() {
        return {state: "start", pending: null,
                local: null, localState: null,
                indent: hasIndentation ? [] : null};
      },
      copyState: function(state) {
        var s = {state: state.state, pending: state.pending,
                 local: state.local, localState: null,
                 indent: state.indent && state.indent.slice(0)};
        if (state.localState)
          s.localState = CodeMirror.copyState(state.local.mode, state.localState);
        if (state.stack)
          s.stack = state.stack.slice(0);
        for (var pers = state.persistentStates; pers; pers = pers.next)
          s.persistentStates = {mode: pers.mode,
                                spec: pers.spec,
                                state: pers.state == state.localState ? s.localState : CodeMirror.copyState(pers.mode, pers.state),
                                next: s.persistentStates};
        return s;
      },
      token: tokenFunction(states_, config),
      innerMode: function(state) { return state.local && {mode: state.local.mode, state: state.localState}; },
      indent: indentFunction(states_, meta)
    };
    if (meta) for (var prop in meta) if (meta.hasOwnProperty(prop))
      mode[prop] = meta[prop];
    return mode;
  };

  function ensureState(states, name) {
    if (!states.hasOwnProperty(name))
      throw new Error("Undefined state " + name + " in simple mode");
  }

  function toRegex(val, caret) {
    if (!val) return /(?:)/;
    var flags = "";
    if (val instanceof RegExp) {
      if (val.ignoreCase) flags = "i";
      if (val.unicode) flags += "u"
      val = val.source;
    } else {
      val = String(val);
    }
    return new RegExp((caret === false ? "" : "^") + "(?:" + val + ")", flags);
  }

  function asToken(val) {
    if (!val) return null;
    if (val.apply) return val
    if (typeof val == "string") return val.replace(/\./g, " ");
    var result = [];
    for (var i = 0; i < val.length; i++)
      result.push(val[i] && val[i].replace(/\./g, " "));
    return result;
  }

  function Rule(data, states) {
    if (data.next || data.push) ensureState(states, data.next || data.push);
    this.regex = toRegex(data.regex);
    this.token = asToken(data.token);
    this.data = data;
  }

  function tokenFunction(states, config) {
    return function(stream, state) {
      if (state.pending) {
        var pend = state.pending.shift();
        if (state.pending.length == 0) state.pending = null;
        stream.pos += pend.text.length;
        return pend.token;
      }

      if (state.local) {
        if (state.local.end && stream.match(state.local.end)) {
          var tok = state.local.endToken || null;
          state.local = state.localState = null;
          return tok;
        } else {
          var tok = state.local.mode.token(stream, state.localState), m;
          if (state.local.endScan && (m = state.local.endScan.exec(stream.current())))
            stream.pos = stream.start + m.index;
          return tok;
        }
      }

      var curState = states[state.state];
      for (var i = 0; i < curState.length; i++) {
        var rule = curState[i];
        var matches = (!rule.data.sol || stream.sol()) && stream.match(rule.regex);
        if (matches) {
          if (rule.data.next) {
            state.state = rule.data.next;
          } else if (rule.data.push) {
            (state.stack || (state.stack = [])).push(state.state);
            state.state = rule.data.push;
          } else if (rule.data.pop && state.stack && state.stack.length) {
            state.state = state.stack.pop();
          }

          if (rule.data.mode)
            enterLocalMode(config, state, rule.data.mode, rule.token);
          if (rule.data.indent)
            state.indent.push(stream.indentation() + config.indentUnit);
          if (rule.data.dedent)
            state.indent.pop();
          var token = rule.token
          if (token && token.apply) token = token(matches)
          if (matches.length > 2 && rule.token && typeof rule.token != "string") {
            for (var j = 2; j < matches.length; j++)
              if (matches[j])
                (state.pending || (state.pending = [])).push({text: matches[j], token: rule.token[j - 1]});
            stream.backUp(matches[0].length - (matches[1] ? matches[1].length : 0));
            return token[0];
          } else if (token && token.join) {
            return token[0];
          } else {
            return token;
          }
        }
      }
      stream.next();
      return null;
    };
  }

  function cmp(a, b) {
    if (a === b) return true;
    if (!a || typeof a != "object" || !b || typeof b != "object") return false;
    var props = 0;
    for (var prop in a) if (a.hasOwnProperty(prop)) {
      if (!b.hasOwnProperty(prop) || !cmp(a[prop], b[prop])) return false;
      props++;
    }
    for (var prop in b) if (b.hasOwnProperty(prop)) props--;
    return props == 0;
  }

  function enterLocalMode(config, state, spec, token) {
    var pers;
    if (spec.persistent) for (var p = state.persistentStates; p && !pers; p = p.next)
      if (spec.spec ? cmp(spec.spec, p.spec) : spec.mode == p.mode) pers = p;
    var mode = pers ? pers.mode : spec.mode || CodeMirror.getMode(config, spec.spec);
    var lState = pers ? pers.state : CodeMirror.startState(mode);
    if (spec.persistent && !pers)
      state.persistentStates = {mode: mode, spec: spec.spec, state: lState, next: state.persistentStates};

    state.localState = lState;
    state.local = {mode: mode,
                   end: spec.end && toRegex(spec.end),
                   endScan: spec.end && spec.forceEnd !== false && toRegex(spec.end, false),
                   endToken: token && token.join ? token[token.length - 1] : token};
  }

  function indexOf(val, arr) {
    for (var i = 0; i < arr.length; i++) if (arr[i] === val) return true;
  }

  function indentFunction(states, meta) {
    return function(state, textAfter, line) {
      if (state.local && state.local.mode.indent)
        return state.local.mode.indent(state.localState, textAfter, line);
      if (state.indent == null || state.local || meta.dontIndentStates && indexOf(state.state, meta.dontIndentStates) > -1)
        return CodeMirror.Pass;

      var pos = state.indent.length - 1, rules = states[state.state];
      scan: for (;;) {
        for (var i = 0; i < rules.length; i++) {
          var rule = rules[i];
          if (rule.data.dedent && rule.data.dedentIfLineStart !== false) {
            var m = rule.regex.exec(textAfter);
            if (m && m[0]) {
              pos--;
              if (rule.next || rule.push) rules = states[rule.next || rule.push];
              textAfter = textAfter.slice(m[0].length);
              continue scan;
            }
          }
        }
        break;
      }
      return pos < 0 ? 0 : state.indent[pos];
    };
  }
});
</script>
    <script>// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"))
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod)
  else // Plain browser env
    mod(CodeMirror)
})(function(CodeMirror) {
  "use strict"
  var Pos = CodeMirror.Pos

  function regexpFlags(regexp) {
    var flags = regexp.flags
    return flags != null ? flags : (regexp.ignoreCase ? "i" : "")
      + (regexp.global ? "g" : "")
      + (regexp.multiline ? "m" : "")
  }

  function ensureFlags(regexp, flags) {
    var current = regexpFlags(regexp), target = current
    for (var i = 0; i < flags.length; i++) if (target.indexOf(flags.charAt(i)) == -1)
      target += flags.charAt(i)
    return current == target ? regexp : new RegExp(regexp.source, target)
  }

  function maybeMultiline(regexp) {
    return /\\s|\\n|\n|\\W|\\D|\[\^/.test(regexp.source)
  }

  function searchRegexpForward(doc, regexp, start) {
    regexp = ensureFlags(regexp, "g")
    for (var line = start.line, ch = start.ch, last = doc.lastLine(); line <= last; line++, ch = 0) {
      regexp.lastIndex = ch
      var string = doc.getLine(line), match = regexp.exec(string)
      if (match)
        return {from: Pos(line, match.index),
                to: Pos(line, match.index + match[0].length),
                match: match}
    }
  }

  function searchRegexpForwardMultiline(doc, regexp, start) {
    if (!maybeMultiline(regexp)) return searchRegexpForward(doc, regexp, start)

    regexp = ensureFlags(regexp, "gm")
    var string, chunk = 1
    for (var line = start.line, last = doc.lastLine(); line <= last;) {
      // This grows the search buffer in exponentially-sized chunks
      // between matches, so that nearby matches are fast and don't
      // require concatenating the whole document (in case we're
      // searching for something that has tons of matches), but at the
      // same time, the amount of retries is limited.
      for (var i = 0; i < chunk; i++) {
        if (line > last) break
        var curLine = doc.getLine(line++)
        string = string == null ? curLine : string + "\n" + curLine
      }
      chunk = chunk * 2
      regexp.lastIndex = start.ch
      var match = regexp.exec(string)
      if (match) {
        var before = string.slice(0, match.index).split("\n"), inside = match[0].split("\n")
        var startLine = start.line + before.length - 1, startCh = before[before.length - 1].length
        return {from: Pos(startLine, startCh),
                to: Pos(startLine + inside.length - 1,
                        inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),
                match: match}
      }
    }
  }

  function lastMatchIn(string, regexp, endMargin) {
    var match, from = 0
    while (from <= string.length) {
      regexp.lastIndex = from
      var newMatch = regexp.exec(string)
      if (!newMatch) break
      var end = newMatch.index + newMatch[0].length
      if (end > string.length - endMargin) break
      if (!match || end > match.index + match[0].length)
        match = newMatch
      from = newMatch.index + 1
    }
    return match
  }

  function searchRegexpBackward(doc, regexp, start) {
    regexp = ensureFlags(regexp, "g")
    for (var line = start.line, ch = start.ch, first = doc.firstLine(); line >= first; line--, ch = -1) {
      var string = doc.getLine(line)
      var match = lastMatchIn(string, regexp, ch < 0 ? 0 : string.length - ch)
      if (match)
        return {from: Pos(line, match.index),
                to: Pos(line, match.index + match[0].length),
                match: match}
    }
  }

  function searchRegexpBackwardMultiline(doc, regexp, start) {
    if (!maybeMultiline(regexp)) return searchRegexpBackward(doc, regexp, start)
    regexp = ensureFlags(regexp, "gm")
    var string, chunkSize = 1, endMargin = doc.getLine(start.line).length - start.ch
    for (var line = start.line, first = doc.firstLine(); line >= first;) {
      for (var i = 0; i < chunkSize && line >= first; i++) {
        var curLine = doc.getLine(line--)
        string = string == null ? curLine : curLine + "\n" + string
      }
      chunkSize *= 2

      var match = lastMatchIn(string, regexp, endMargin)
      if (match) {
        var before = string.slice(0, match.index).split("\n"), inside = match[0].split("\n")
        var startLine = line + before.length, startCh = before[before.length - 1].length
        return {from: Pos(startLine, startCh),
                to: Pos(startLine + inside.length - 1,
                        inside.length == 1 ? startCh + inside[0].length : inside[inside.length - 1].length),
                match: match}
      }
    }
  }

  var doFold, noFold
  if (String.prototype.normalize) {
    doFold = function(str) { return str.normalize("NFD").toLowerCase() }
    noFold = function(str) { return str.normalize("NFD") }
  } else {
    doFold = function(str) { return str.toLowerCase() }
    noFold = function(str) { return str }
  }

  // Maps a position in a case-folded line back to a position in the original line
  // (compensating for codepoints increasing in number during folding)
  function adjustPos(orig, folded, pos, foldFunc) {
    if (orig.length == folded.length) return pos
    for (var min = 0, max = pos + Math.max(0, orig.length - folded.length);;) {
      if (min == max) return min
      var mid = (min + max) >> 1
      var len = foldFunc(orig.slice(0, mid)).length
      if (len == pos) return mid
      else if (len > pos) max = mid
      else min = mid + 1
    }
  }

  function searchStringForward(doc, query, start, caseFold) {
    // Empty string would match anything and never progress, so we
    // define it to match nothing instead.
    if (!query.length) return null
    var fold = caseFold ? doFold : noFold
    var lines = fold(query).split(/\r|\n\r?/)

    search: for (var line = start.line, ch = start.ch, last = doc.lastLine() + 1 - lines.length; line <= last; line++, ch = 0) {
      var orig = doc.getLine(line).slice(ch), string = fold(orig)
      if (lines.length == 1) {
        var found = string.indexOf(lines[0])
        if (found == -1) continue search
        var start = adjustPos(orig, string, found, fold) + ch
        return {from: Pos(line, adjustPos(orig, string, found, fold) + ch),
                to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold) + ch)}
      } else {
        var cutFrom = string.length - lines[0].length
        if (string.slice(cutFrom) != lines[0]) continue search
        for (var i = 1; i < lines.length - 1; i++)
          if (fold(doc.getLine(line + i)) != lines[i]) continue search
        var end = doc.getLine(line + lines.length - 1), endString = fold(end), lastLine = lines[lines.length - 1]
        if (endString.slice(0, lastLine.length) != lastLine) continue search
        return {from: Pos(line, adjustPos(orig, string, cutFrom, fold) + ch),
                to: Pos(line + lines.length - 1, adjustPos(end, endString, lastLine.length, fold))}
      }
    }
  }

  function searchStringBackward(doc, query, start, caseFold) {
    if (!query.length) return null
    var fold = caseFold ? doFold : noFold
    var lines = fold(query).split(/\r|\n\r?/)

    search: for (var line = start.line, ch = start.ch, first = doc.firstLine() - 1 + lines.length; line >= first; line--, ch = -1) {
      var orig = doc.getLine(line)
      if (ch > -1) orig = orig.slice(0, ch)
      var string = fold(orig)
      if (lines.length == 1) {
        var found = string.lastIndexOf(lines[0])
        if (found == -1) continue search
        return {from: Pos(line, adjustPos(orig, string, found, fold)),
                to: Pos(line, adjustPos(orig, string, found + lines[0].length, fold))}
      } else {
        var lastLine = lines[lines.length - 1]
        if (string.slice(0, lastLine.length) != lastLine) continue search
        for (var i = 1, start = line - lines.length + 1; i < lines.length - 1; i++)
          if (fold(doc.getLine(start + i)) != lines[i]) continue search
        var top = doc.getLine(line + 1 - lines.length), topString = fold(top)
        if (topString.slice(topString.length - lines[0].length) != lines[0]) continue search
        return {from: Pos(line + 1 - lines.length, adjustPos(top, topString, top.length - lines[0].length, fold)),
                to: Pos(line, adjustPos(orig, string, lastLine.length, fold))}
      }
    }
  }

  function SearchCursor(doc, query, pos, options) {
    this.atOccurrence = false
    this.doc = doc
    pos = pos ? doc.clipPos(pos) : Pos(0, 0)
    this.pos = {from: pos, to: pos}

    var caseFold
    if (typeof options == "object") {
      caseFold = options.caseFold
    } else { // Backwards compat for when caseFold was the 4th argument
      caseFold = options
      options = null
    }

    if (typeof query == "string") {
      if (caseFold == null) caseFold = false
      this.matches = function(reverse, pos) {
        return (reverse ? searchStringBackward : searchStringForward)(doc, query, pos, caseFold)
      }
    } else {
      query = ensureFlags(query, "gm")
      if (!options || options.multiline !== false)
        this.matches = function(reverse, pos) {
          return (reverse ? searchRegexpBackwardMultiline : searchRegexpForwardMultiline)(doc, query, pos)
        }
      else
        this.matches = function(reverse, pos) {
          return (reverse ? searchRegexpBackward : searchRegexpForward)(doc, query, pos)
        }
    }
  }

  SearchCursor.prototype = {
    findNext: function() {return this.find(false)},
    findPrevious: function() {return this.find(true)},

    find: function(reverse) {
      var result = this.matches(reverse, this.doc.clipPos(reverse ? this.pos.from : this.pos.to))

      // Implements weird auto-growing behavior on null-matches for
      // backwards-compatibility with the vim code (unfortunately)
      while (result && CodeMirror.cmpPos(result.from, result.to) == 0) {
        if (reverse) {
          if (result.from.ch) result.from = Pos(result.from.line, result.from.ch - 1)
          else if (result.from.line == this.doc.firstLine()) result = null
          else result = this.matches(reverse, this.doc.clipPos(Pos(result.from.line - 1)))
        } else {
          if (result.to.ch < this.doc.getLine(result.to.line).length) result.to = Pos(result.to.line, result.to.ch + 1)
          else if (result.to.line == this.doc.lastLine()) result = null
          else result = this.matches(reverse, Pos(result.to.line + 1, 0))
        }
      }

      if (result) {
        this.pos = result
        this.atOccurrence = true
        return this.pos.match || true
      } else {
        var end = Pos(reverse ? this.doc.firstLine() : this.doc.lastLine() + 1, 0)
        this.pos = {from: end, to: end}
        return this.atOccurrence = false
      }
    },

    from: function() {if (this.atOccurrence) return this.pos.from},
    to: function() {if (this.atOccurrence) return this.pos.to},

    replace: function(newText, origin) {
      if (!this.atOccurrence) return
      var lines = CodeMirror.splitLines(newText)
      this.doc.replaceRange(lines, this.pos.from, this.pos.to, origin)
      this.pos.to = Pos(this.pos.from.line + lines.length - 1,
                        lines[lines.length - 1].length + (lines.length == 1 ? this.pos.from.ch : 0))
    }
  }

  CodeMirror.defineExtension("getSearchCursor", function(query, pos, caseFold) {
    return new SearchCursor(this.doc, query, pos, caseFold)
  })
  CodeMirror.defineDocExtension("getSearchCursor", function(query, pos, caseFold) {
    return new SearchCursor(this, query, pos, caseFold)
  })

  CodeMirror.defineExtension("selectMatches", function(query, caseFold) {
    var ranges = []
    var cur = this.getSearchCursor(query, this.getCursor("from"), caseFold)
    while (cur.findNext()) {
      if (CodeMirror.cmpPos(cur.to(), this.getCursor("to")) > 0) break
      ranges.push({anchor: cur.from(), head: cur.to()})
    }
    if (ranges.length)
      this.setSelections(ranges, 0)
  })
});
</script>
    <script>// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE

// Define search commands. Depends on dialog.js or another
// implementation of the openDialog method.

// Replace works a little oddly -- it will do the replace on the next
// Ctrl-G (or whatever is bound to findNext) press. You prevent a
// replace by making sure the match is no longer selected when hitting
// Ctrl-G.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("./searchcursor"), require("../dialog/dialog"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "./searchcursor", "../dialog/dialog"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  // default search panel location
  CodeMirror.defineOption("search", {bottom: false});

  function searchOverlay(query, caseInsensitive) {
    if (typeof query == "string")
      query = new RegExp(query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"), caseInsensitive ? "gi" : "g");
    else if (!query.global)
      query = new RegExp(query.source, query.ignoreCase ? "gi" : "g");

    return {token: function(stream) {
      query.lastIndex = stream.pos;
      var match = query.exec(stream.string);
      if (match && match.index == stream.pos) {
        stream.pos += match[0].length || 1;
        return "searching";
      } else if (match) {
        stream.pos = match.index;
      } else {
        stream.skipToEnd();
      }
    }};
  }

  function SearchState() {
    this.posFrom = this.posTo = this.lastQuery = this.query = null;
    this.overlay = null;
  }

  function getSearchState(cm) {
    return cm.state.search || (cm.state.search = new SearchState());
  }

  function queryCaseInsensitive(query) {
    return typeof query == "string" && query == query.toLowerCase();
  }

  function getSearchCursor(cm, query, pos) {
    // Heuristic: if the query string is all lowercase, do a case insensitive search.
    return cm.getSearchCursor(query, pos, {caseFold: queryCaseInsensitive(query), multiline: true});
  }

  function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {
    cm.openDialog(text, onEnter, {
      value: deflt,
      selectValueOnOpen: true,
      closeOnEnter: false,
      onClose: function() { clearSearch(cm); },
      onKeyDown: onKeyDown,
      bottom: cm.options.search.bottom
    });
  }

  function dialog(cm, text, shortText, deflt, f) {
    if (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: true, bottom: cm.options.search.bottom});
    else f(prompt(shortText, deflt));
  }

  function confirmDialog(cm, text, shortText, fs) {
    if (cm.openConfirm) cm.openConfirm(text, fs);
    else if (confirm(shortText)) fs[0]();
  }

  function parseString(string) {
    return string.replace(/\\([nrt\\])/g, function(match, ch) {
      if (ch == "n") return "\n"
      if (ch == "r") return "\r"
      if (ch == "t") return "\t"
      if (ch == "\\") return "\\"
      return match
    })
  }

  function parseQuery(query) {
    var isRE = query.match(/^\/(.*)\/([a-z]*)$/);
    if (isRE) {
      try { query = new RegExp(isRE[1], isRE[2].indexOf("i") == -1 ? "" : "i"); }
      catch(e) {} // Not a regular expression after all, do a string search
    } else {
      query = parseString(query)
    }
    if (typeof query == "string" ? query == "" : query.test(""))
      query = /x^/;
    return query;
  }

  function startSearch(cm, state, query) {
    state.queryText = query;
    state.query = parseQuery(query);
    cm.removeOverlay(state.overlay, queryCaseInsensitive(state.query));
    state.overlay = searchOverlay(state.query, queryCaseInsensitive(state.query));
    cm.addOverlay(state.overlay);
    if (cm.showMatchesOnScrollbar) {
      if (state.annotate) { state.annotate.clear(); state.annotate = null; }
      state.annotate = cm.showMatchesOnScrollbar(state.query, queryCaseInsensitive(state.query));
    }
  }

  function doSearch(cm, rev, persistent, immediate) {
    var state = getSearchState(cm);
    if (state.query) return findNext(cm, rev);
    var q = cm.getSelection() || state.lastQuery;
    if (q instanceof RegExp && q.source == "x^") q = null
    if (persistent && cm.openDialog) {
      var hiding = null
      var searchNext = function(query, event) {
        CodeMirror.e_stop(event);
        if (!query) return;
        if (query != state.queryText) {
          startSearch(cm, state, query);
          state.posFrom = state.posTo = cm.getCursor();
        }
        if (hiding) hiding.style.opacity = 1
        findNext(cm, event.shiftKey, function(_, to) {
          var dialog
          if (to.line < 3 && document.querySelector &&
              (dialog = cm.display.wrapper.querySelector(".CodeMirror-dialog")) &&
              dialog.getBoundingClientRect().bottom - 4 > cm.cursorCoords(to, "window").top)
            (hiding = dialog).style.opacity = .4
        })
      };
      persistentDialog(cm, getQueryDialog(cm), q, searchNext, function(event, query) {
        var keyName = CodeMirror.keyName(event)
        var extra = cm.getOption('extraKeys'), cmd = (extra && extra[keyName]) || CodeMirror.keyMap[cm.getOption("keyMap")][keyName]
        if (cmd == "findNext" || cmd == "findPrev" ||
          cmd == "findPersistentNext" || cmd == "findPersistentPrev") {
          CodeMirror.e_stop(event);
          startSearch(cm, getSearchState(cm), query);
          cm.execCommand(cmd);
        } else if (cmd == "find" || cmd == "findPersistent") {
          CodeMirror.e_stop(event);
          searchNext(query, event);
        }
      });
      if (immediate && q) {
        startSearch(cm, state, q);
        findNext(cm, rev);
      }
    } else {
      dialog(cm, getQueryDialog(cm), "Search for:", q, function(query) {
        if (query && !state.query) cm.operation(function() {
          startSearch(cm, state, query);
          state.posFrom = state.posTo = cm.getCursor();
          findNext(cm, rev);
        });
      });
    }
  }

  function findNext(cm, rev, callback) {cm.operation(function() {
    var state = getSearchState(cm);
    var cursor = getSearchCursor(cm, state.query, rev ? state.posFrom : state.posTo);
    if (!cursor.find(rev)) {
      cursor = getSearchCursor(cm, state.query, rev ? CodeMirror.Pos(cm.lastLine()) : CodeMirror.Pos(cm.firstLine(), 0));
      if (!cursor.find(rev)) return;
    }
    cm.setSelection(cursor.from(), cursor.to());
    cm.scrollIntoView({from: cursor.from(), to: cursor.to()}, 20);
    state.posFrom = cursor.from(); state.posTo = cursor.to();
    if (callback) callback(cursor.from(), cursor.to())
  });}

  function clearSearch(cm) {cm.operation(function() {
    var state = getSearchState(cm);
    state.lastQuery = state.query;
    if (!state.query) return;
    state.query = state.queryText = null;
    cm.removeOverlay(state.overlay);
    if (state.annotate) { state.annotate.clear(); state.annotate = null; }
  });}

  function el(tag, attrs) {
    var element = tag ? document.createElement(tag) : document.createDocumentFragment();
    for (var key in attrs) {
      element[key] = attrs[key];
    }
    for (var i = 2; i < arguments.length; i++) {
      var child = arguments[i]
      element.appendChild(typeof child == "string" ? document.createTextNode(child) : child);
    }
    return element;
  }

  function getQueryDialog(cm)  {
    return el("", null,
              el("span", {className: "CodeMirror-search-label"}, cm.phrase("Search:")), " ",
              el("input", {type: "text", "style": "width: 10em", className: "CodeMirror-search-field"}), " ",
              el("span", {style: "color: #888", className: "CodeMirror-search-hint"},
                 cm.phrase("(Use /re/ syntax for regexp search)")));
  }
  function getReplaceQueryDialog(cm) {
    return el("", null, " ",
              el("input", {type: "text", "style": "width: 10em", className: "CodeMirror-search-field"}), " ",
              el("span", {style: "color: #888", className: "CodeMirror-search-hint"},
                 cm.phrase("(Use /re/ syntax for regexp search)")));
  }
  function getReplacementQueryDialog(cm) {
    return el("", null,
              el("span", {className: "CodeMirror-search-label"}, cm.phrase("With:")), " ",
              el("input", {type: "text", "style": "width: 10em", className: "CodeMirror-search-field"}));
  }
  function getDoReplaceConfirm(cm) {
    return el("", null,
              el("span", {className: "CodeMirror-search-label"}, cm.phrase("Replace?")), " ",
              el("button", {}, cm.phrase("Yes")), " ",
              el("button", {}, cm.phrase("No")), " ",
              el("button", {}, cm.phrase("All")), " ",
              el("button", {}, cm.phrase("Stop")));
  }

  function replaceAll(cm, query, text) {
    cm.operation(function() {
      for (var cursor = getSearchCursor(cm, query); cursor.findNext();) {
        if (typeof query != "string") {
          var match = cm.getRange(cursor.from(), cursor.to()).match(query);
          cursor.replace(text.replace(/\$(\d)/g, function(_, i) {return match[i];}));
        } else cursor.replace(text);
      }
    });
  }

  function replace(cm, all) {
    if (cm.getOption("readOnly")) return;
    var query = cm.getSelection() || getSearchState(cm).lastQuery;
    var dialogText = all ? cm.phrase("Replace all:") : cm.phrase("Replace:")
    var fragment = el("", null,
                      el("span", {className: "CodeMirror-search-label"}, dialogText),
                      getReplaceQueryDialog(cm))
    dialog(cm, fragment, dialogText, query, function(query) {
      if (!query) return;
      query = parseQuery(query);
      dialog(cm, getReplacementQueryDialog(cm), cm.phrase("Replace with:"), "", function(text) {
        text = parseString(text)
        if (all) {
          replaceAll(cm, query, text)
        } else {
          clearSearch(cm);
          var cursor = getSearchCursor(cm, query, cm.getCursor("from"));
          var advance = function() {
            var start = cursor.from(), match;
            if (!(match = cursor.findNext())) {
              cursor = getSearchCursor(cm, query);
              if (!(match = cursor.findNext()) ||
                  (start && cursor.from().line == start.line && cursor.from().ch == start.ch)) return;
            }
            cm.setSelection(cursor.from(), cursor.to());
            cm.scrollIntoView({from: cursor.from(), to: cursor.to()});
            confirmDialog(cm, getDoReplaceConfirm(cm), cm.phrase("Replace?"),
                          [function() {doReplace(match);}, advance,
                           function() {replaceAll(cm, query, text)}]);
          };
          var doReplace = function(match) {
            cursor.replace(typeof query == "string" ? text :
                           text.replace(/\$(\d)/g, function(_, i) {return match[i];}));
            advance();
          };
          advance();
        }
      });
    });
  }

  CodeMirror.commands.find = function(cm) {clearSearch(cm); doSearch(cm);};
  CodeMirror.commands.findPersistent = function(cm) {clearSearch(cm); doSearch(cm, false, true);};
  CodeMirror.commands.findPersistentNext = function(cm) {doSearch(cm, false, true, true);};
  CodeMirror.commands.findPersistentPrev = function(cm) {doSearch(cm, true, true, true);};
  CodeMirror.commands.findNext = doSearch;
  CodeMirror.commands.findPrev = function(cm) {doSearch(cm, true);};
  CodeMirror.commands.clearSearch = clearSearch;
  CodeMirror.commands.replace = replace;
  CodeMirror.commands.replaceAll = function(cm) {replace(cm, true);};
});
</script>
    <script>// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE

// declare global: DOMRect

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  var HINT_ELEMENT_CLASS        = "CodeMirror-hint";
  var ACTIVE_HINT_ELEMENT_CLASS = "CodeMirror-hint-active";

  // This is the old interface, kept around for now to stay
  // backwards-compatible.
  CodeMirror.showHint = function(cm, getHints, options) {
    if (!getHints) return cm.showHint(options);
    if (options && options.async) getHints.async = true;
    var newOpts = {hint: getHints};
    if (options) for (var prop in options) newOpts[prop] = options[prop];
    return cm.showHint(newOpts);
  };

  CodeMirror.defineExtension("showHint", function(options) {
    options = parseOptions(this, this.getCursor("start"), options);
    var selections = this.listSelections()
    if (selections.length > 1) return;
    // By default, don't allow completion when something is selected.
    // A hint function can have a `supportsSelection` property to
    // indicate that it can handle selections.
    if (this.somethingSelected()) {
      if (!options.hint.supportsSelection) return;
      // Don't try with cross-line selections
      for (var i = 0; i < selections.length; i++)
        if (selections[i].head.line != selections[i].anchor.line) return;
    }

    if (this.state.completionActive) this.state.completionActive.close();
    var completion = this.state.completionActive = new Completion(this, options);
    if (!completion.options.hint) return;

    CodeMirror.signal(this, "startCompletion", this);
    completion.update(true);
  });

  CodeMirror.defineExtension("closeHint", function() {
    if (this.state.completionActive) this.state.completionActive.close()
  })

  function Completion(cm, options) {
    this.cm = cm;
    this.options = options;
    this.widget = null;
    this.debounce = 0;
    this.tick = 0;
    this.startPos = this.cm.getCursor("start");
    this.startLen = this.cm.getLine(this.startPos.line).length - this.cm.getSelection().length;

    if (this.options.updateOnCursorActivity) {
      var self = this;
      cm.on("cursorActivity", this.activityFunc = function() { self.cursorActivity(); });
    }
  }

  var requestAnimationFrame = window.requestAnimationFrame || function(fn) {
    return setTimeout(fn, 1000/60);
  };
  var cancelAnimationFrame = window.cancelAnimationFrame || clearTimeout;

  Completion.prototype = {
    close: function() {
      if (!this.active()) return;
      this.cm.state.completionActive = null;
      this.tick = null;
      if (this.options.updateOnCursorActivity) {
        this.cm.off("cursorActivity", this.activityFunc);
      }

      if (this.widget && this.data) CodeMirror.signal(this.data, "close");
      if (this.widget) this.widget.close();
      CodeMirror.signal(this.cm, "endCompletion", this.cm);
    },

    active: function() {
      return this.cm.state.completionActive == this;
    },

    pick: function(data, i) {
      var completion = data.list[i], self = this;
      this.cm.operation(function() {
        if (completion.hint)
          completion.hint(self.cm, data, completion);
        else
          self.cm.replaceRange(getText(completion), completion.from || data.from,
                               completion.to || data.to, "complete");
        CodeMirror.signal(data, "pick", completion);
        self.cm.scrollIntoView();
      });
      if (this.options.closeOnPick) {
        this.close();
      }
    },

    cursorActivity: function() {
      if (this.debounce) {
        cancelAnimationFrame(this.debounce);
        this.debounce = 0;
      }

      var identStart = this.startPos;
      if(this.data) {
        identStart = this.data.from;
      }

      var pos = this.cm.getCursor(), line = this.cm.getLine(pos.line);
      if (pos.line != this.startPos.line || line.length - pos.ch != this.startLen - this.startPos.ch ||
          pos.ch < identStart.ch || this.cm.somethingSelected() ||
          (!pos.ch || this.options.closeCharacters.test(line.charAt(pos.ch - 1)))) {
        this.close();
      } else {
        var self = this;
        this.debounce = requestAnimationFrame(function() {self.update();});
        if (this.widget) this.widget.disable();
      }
    },

    update: function(first) {
      if (this.tick == null) return
      var self = this, myTick = ++this.tick
      fetchHints(this.options.hint, this.cm, this.options, function(data) {
        if (self.tick == myTick) self.finishUpdate(data, first)
      })
    },

    finishUpdate: function(data, first) {
      if (this.data) CodeMirror.signal(this.data, "update");

      var picked = (this.widget && this.widget.picked) || (first && this.options.completeSingle);
      if (this.widget) this.widget.close();

      this.data = data;

      if (data && data.list.length) {
        if (picked && data.list.length == 1) {
          this.pick(data, 0);
        } else {
          this.widget = new Widget(this, data);
          CodeMirror.signal(data, "shown");
        }
      }
    }
  };

  function parseOptions(cm, pos, options) {
    var editor = cm.options.hintOptions;
    var out = {};
    for (var prop in defaultOptions) out[prop] = defaultOptions[prop];
    if (editor) for (var prop in editor)
      if (editor[prop] !== undefined) out[prop] = editor[prop];
    if (options) for (var prop in options)
      if (options[prop] !== undefined) out[prop] = options[prop];
    if (out.hint.resolve) out.hint = out.hint.resolve(cm, pos)
    return out;
  }

  function getText(completion) {
    if (typeof completion == "string") return completion;
    else return completion.text;
  }

  function buildKeyMap(completion, handle) {
    var baseMap = {
      Up: function() {handle.moveFocus(-1);},
      Down: function() {handle.moveFocus(1);},
      PageUp: function() {handle.moveFocus(-handle.menuSize() + 1, true);},
      PageDown: function() {handle.moveFocus(handle.menuSize() - 1, true);},
      Home: function() {handle.setFocus(0);},
      End: function() {handle.setFocus(handle.length - 1);},
      Enter: handle.pick,
      Tab: handle.pick,
      Esc: handle.close
    };

    var mac = /Mac/.test(navigator.platform);

    if (mac) {
      baseMap["Ctrl-P"] = function() {handle.moveFocus(-1);};
      baseMap["Ctrl-N"] = function() {handle.moveFocus(1);};
    }

    var custom = completion.options.customKeys;
    var ourMap = custom ? {} : baseMap;
    function addBinding(key, val) {
      var bound;
      if (typeof val != "string")
        bound = function(cm) { return val(cm, handle); };
      // This mechanism is deprecated
      else if (baseMap.hasOwnProperty(val))
        bound = baseMap[val];
      else
        bound = val;
      ourMap[key] = bound;
    }
    if (custom)
      for (var key in custom) if (custom.hasOwnProperty(key))
        addBinding(key, custom[key]);
    var extra = completion.options.extraKeys;
    if (extra)
      for (var key in extra) if (extra.hasOwnProperty(key))
        addBinding(key, extra[key]);
    return ourMap;
  }

  function getHintElement(hintsElement, el) {
    while (el && el != hintsElement) {
      if (el.nodeName.toUpperCase() === "LI" && el.parentNode == hintsElement) return el;
      el = el.parentNode;
    }
  }

  function Widget(completion, data) {
    this.id = "cm-complete-" + Math.floor(Math.random(1e6))
    this.completion = completion;
    this.data = data;
    this.picked = false;
    var widget = this, cm = completion.cm;
    var ownerDocument = cm.getInputField().ownerDocument;
    var parentWindow = ownerDocument.defaultView || ownerDocument.parentWindow;

    var hints = this.hints = ownerDocument.createElement("ul");
    hints.setAttribute("role", "listbox")
    hints.setAttribute("aria-expanded", "true")
    hints.id = this.id
    var theme = completion.cm.options.theme;
    hints.className = "CodeMirror-hints " + theme;
    this.selectedHint = data.selectedHint || 0;

    var completions = data.list;
    for (var i = 0; i < completions.length; ++i) {
      var elt = hints.appendChild(ownerDocument.createElement("li")), cur = completions[i];
      var className = HINT_ELEMENT_CLASS + (i != this.selectedHint ? "" : " " + ACTIVE_HINT_ELEMENT_CLASS);
      if (cur.className != null) className = cur.className + " " + className;
      elt.className = className;
      if (i == this.selectedHint) elt.setAttribute("aria-selected", "true")
      elt.id = this.id + "-" + i
      elt.setAttribute("role", "option")
      if (cur.render) cur.render(elt, data, cur);
      else elt.appendChild(ownerDocument.createTextNode(cur.displayText || getText(cur)));
      elt.hintId = i;
    }

    var container = completion.options.container || ownerDocument.body;
    var pos = cm.cursorCoords(completion.options.alignWithWord ? data.from : null);
    var left = pos.left, top = pos.bottom, below = true;
    var offsetLeft = 0, offsetTop = 0;
    if (container !== ownerDocument.body) {
      // We offset the cursor position because left and top are relative to the offsetParent's top left corner.
      var isContainerPositioned = ['absolute', 'relative', 'fixed'].indexOf(parentWindow.getComputedStyle(container).position) !== -1;
      var offsetParent = isContainerPositioned ? container : container.offsetParent;
      var offsetParentPosition = offsetParent.getBoundingClientRect();
      var bodyPosition = ownerDocument.body.getBoundingClientRect();
      offsetLeft = (offsetParentPosition.left - bodyPosition.left - offsetParent.scrollLeft);
      offsetTop = (offsetParentPosition.top - bodyPosition.top - offsetParent.scrollTop);
    }
    hints.style.left = (left - offsetLeft) + "px";
    hints.style.top = (top - offsetTop) + "px";

    // If we're at the edge of the screen, then we want the menu to appear on the left of the cursor.
    var winW = parentWindow.innerWidth || Math.max(ownerDocument.body.offsetWidth, ownerDocument.documentElement.offsetWidth);
    var winH = parentWindow.innerHeight || Math.max(ownerDocument.body.offsetHeight, ownerDocument.documentElement.offsetHeight);
    container.appendChild(hints);
    cm.getInputField().setAttribute("aria-autocomplete", "list")
    cm.getInputField().setAttribute("aria-owns", this.id)
    cm.getInputField().setAttribute("aria-activedescendant", this.id + "-" + this.selectedHint)

    var box = completion.options.moveOnOverlap ? hints.getBoundingClientRect() : new DOMRect();
    var scrolls = completion.options.paddingForScrollbar ? hints.scrollHeight > hints.clientHeight + 1 : false;

    // Compute in the timeout to avoid reflow on init
    var startScroll;
    setTimeout(function() { startScroll = cm.getScrollInfo(); });

    var overlapY = box.bottom - winH;
    if (overlapY > 0) {
      var height = box.bottom - box.top, curTop = pos.top - (pos.bottom - box.top);
      if (curTop - height > 0) { // Fits above cursor
        hints.style.top = (top = pos.top - height - offsetTop) + "px";
        below = false;
      } else if (height > winH) {
        hints.style.height = (winH - 5) + "px";
        hints.style.top = (top = pos.bottom - box.top - offsetTop) + "px";
        var cursor = cm.getCursor();
        if (data.from.ch != cursor.ch) {
          pos = cm.cursorCoords(cursor);
          hints.style.left = (left = pos.left - offsetLeft) + "px";
          box = hints.getBoundingClientRect();
        }
      }
    }
    var overlapX = box.right - winW;
    if (scrolls) overlapX += cm.display.nativeBarWidth;
    if (overlapX > 0) {
      if (box.right - box.left > winW) {
        hints.style.width = (winW - 5) + "px";
        overlapX -= (box.right - box.left) - winW;
      }
      hints.style.left = (left = pos.left - overlapX - offsetLeft) + "px";
    }
    if (scrolls) for (var node = hints.firstChild; node; node = node.nextSibling)
      node.style.paddingRight = cm.display.nativeBarWidth + "px"

    cm.addKeyMap(this.keyMap = buildKeyMap(completion, {
      moveFocus: function(n, avoidWrap) { widget.changeActive(widget.selectedHint + n, avoidWrap); },
      setFocus: function(n) { widget.changeActive(n); },
      menuSize: function() { return widget.screenAmount(); },
      length: completions.length,
      close: function() { completion.close(); },
      pick: function() { widget.pick(); },
      data: data
    }));

    if (completion.options.closeOnUnfocus) {
      var closingOnBlur;
      cm.on("blur", this.onBlur = function() { closingOnBlur = setTimeout(function() { completion.close(); }, 100); });
      cm.on("focus", this.onFocus = function() { clearTimeout(closingOnBlur); });
    }

    cm.on("scroll", this.onScroll = function() {
      var curScroll = cm.getScrollInfo(), editor = cm.getWrapperElement().getBoundingClientRect();
      if (!startScroll) startScroll = cm.getScrollInfo();
      var newTop = top + startScroll.top - curScroll.top;
      var point = newTop - (parentWindow.pageYOffset || (ownerDocument.documentElement || ownerDocument.body).scrollTop);
      if (!below) point += hints.offsetHeight;
      if (point <= editor.top || point >= editor.bottom) return completion.close();
      hints.style.top = newTop + "px";
      hints.style.left = (left + startScroll.left - curScroll.left) + "px";
    });

    CodeMirror.on(hints, "dblclick", function(e) {
      var t = getHintElement(hints, e.target || e.srcElement);
      if (t && t.hintId != null) {widget.changeActive(t.hintId); widget.pick();}
    });

    CodeMirror.on(hints, "click", function(e) {
      var t = getHintElement(hints, e.target || e.srcElement);
      if (t && t.hintId != null) {
        widget.changeActive(t.hintId);
        if (completion.options.completeOnSingleClick) widget.pick();
      }
    });

    CodeMirror.on(hints, "mousedown", function() {
      setTimeout(function(){cm.focus();}, 20);
    });

    // The first hint doesn't need to be scrolled to on init
    var selectedHintRange = this.getSelectedHintRange();
    if (selectedHintRange.from !== 0 || selectedHintRange.to !== 0) {
      this.scrollToActive();
    }

    CodeMirror.signal(data, "select", completions[this.selectedHint], hints.childNodes[this.selectedHint]);
    return true;
  }

  Widget.prototype = {
    close: function() {
      if (this.completion.widget != this) return;
      this.completion.widget = null;
      if (this.hints.parentNode) this.hints.parentNode.removeChild(this.hints);
      this.completion.cm.removeKeyMap(this.keyMap);
      var input = this.completion.cm.getInputField()
      input.removeAttribute("aria-activedescendant")
      input.removeAttribute("aria-owns")

      var cm = this.completion.cm;
      if (this.completion.options.closeOnUnfocus) {
        cm.off("blur", this.onBlur);
        cm.off("focus", this.onFocus);
      }
      cm.off("scroll", this.onScroll);
    },

    disable: function() {
      this.completion.cm.removeKeyMap(this.keyMap);
      var widget = this;
      this.keyMap = {Enter: function() { widget.picked = true; }};
      this.completion.cm.addKeyMap(this.keyMap);
    },

    pick: function() {
      this.completion.pick(this.data, this.selectedHint);
    },

    changeActive: function(i, avoidWrap) {
      if (i >= this.data.list.length)
        i = avoidWrap ? this.data.list.length - 1 : 0;
      else if (i < 0)
        i = avoidWrap ? 0  : this.data.list.length - 1;
      if (this.selectedHint == i) return;
      var node = this.hints.childNodes[this.selectedHint];
      if (node) {
        node.className = node.className.replace(" " + ACTIVE_HINT_ELEMENT_CLASS, "");
        node.removeAttribute("aria-selected")
      }
      node = this.hints.childNodes[this.selectedHint = i];
      node.className += " " + ACTIVE_HINT_ELEMENT_CLASS;
      node.setAttribute("aria-selected", "true")
      this.completion.cm.getInputField().setAttribute("aria-activedescendant", node.id)
      this.scrollToActive()
      CodeMirror.signal(this.data, "select", this.data.list[this.selectedHint], node);
    },

    scrollToActive: function() {
      var selectedHintRange = this.getSelectedHintRange();
      var node1 = this.hints.childNodes[selectedHintRange.from];
      var node2 = this.hints.childNodes[selectedHintRange.to];
      var firstNode = this.hints.firstChild;
      if (node1.offsetTop < this.hints.scrollTop)
        this.hints.scrollTop = node1.offsetTop - firstNode.offsetTop;
      else if (node2.offsetTop + node2.offsetHeight > this.hints.scrollTop + this.hints.clientHeight)
        this.hints.scrollTop = node2.offsetTop + node2.offsetHeight - this.hints.clientHeight + firstNode.offsetTop;
    },

    screenAmount: function() {
      return Math.floor(this.hints.clientHeight / this.hints.firstChild.offsetHeight) || 1;
    },

    getSelectedHintRange: function() {
      var margin = this.completion.options.scrollMargin || 0;
      return {
        from: Math.max(0, this.selectedHint - margin),
        to: Math.min(this.data.list.length - 1, this.selectedHint + margin),
      };
    }
  };

  function applicableHelpers(cm, helpers) {
    if (!cm.somethingSelected()) return helpers
    var result = []
    for (var i = 0; i < helpers.length; i++)
      if (helpers[i].supportsSelection) result.push(helpers[i])
    return result
  }

  function fetchHints(hint, cm, options, callback) {
    if (hint.async) {
      hint(cm, callback, options)
    } else {
      var result = hint(cm, options)
      if (result && result.then) result.then(callback)
      else callback(result)
    }
  }

  function resolveAutoHints(cm, pos) {
    var helpers = cm.getHelpers(pos, "hint"), words
    if (helpers.length) {
      var resolved = function(cm, callback, options) {
        var app = applicableHelpers(cm, helpers);
        function run(i) {
          if (i == app.length) return callback(null)
          fetchHints(app[i], cm, options, function(result) {
            if (result && result.list.length > 0) callback(result)
            else run(i + 1)
          })
        }
        run(0)
      }
      resolved.async = true
      resolved.supportsSelection = true
      return resolved
    } else if (words = cm.getHelper(cm.getCursor(), "hintWords")) {
      return function(cm) { return CodeMirror.hint.fromList(cm, {words: words}) }
    } else if (CodeMirror.hint.anyword) {
      return function(cm, options) { return CodeMirror.hint.anyword(cm, options) }
    } else {
      return function() {}
    }
  }

  CodeMirror.registerHelper("hint", "auto", {
    resolve: resolveAutoHints
  });

  CodeMirror.registerHelper("hint", "fromList", function(cm, options) {
    var cur = cm.getCursor(), token = cm.getTokenAt(cur)
    var term, from = CodeMirror.Pos(cur.line, token.start), to = cur
    if (token.start < cur.ch && /\w/.test(token.string.charAt(cur.ch - token.start - 1))) {
      term = token.string.substr(0, cur.ch - token.start)
    } else {
      term = ""
      from = cur
    }
    var found = [];
    for (var i = 0; i < options.words.length; i++) {
      var word = options.words[i];
      if (word.slice(0, term.length) == term)
        found.push(word);
    }

    if (found.length) return {list: found, from: from, to: to};
  });

  CodeMirror.commands.autocomplete = CodeMirror.showHint;

  var defaultOptions = {
    hint: CodeMirror.hint.auto,
    completeSingle: true,
    alignWithWord: true,
    closeCharacters: /[\s()\[\]{};:>,]/,
    closeOnPick: true,
    closeOnUnfocus: true,
    updateOnCursorActivity: true,
    completeOnSingleClick: true,
    container: null,
    customKeys: null,
    extraKeys: null,
    paddingForScrollbar: true,
    moveOnOverlap: true,
  };

  CodeMirror.defineOption("hintOptions", null);
});
</script>

    <script>(function(){'use strict';
'use strict';var c,aa="object"===typeof __ScalaJSEnv&&__ScalaJSEnv?__ScalaJSEnv:{},ba="object"===typeof aa.global&&aa.global?aa.global:"object"===typeof global&&global&&global.Object===Object?global:this;aa.global=ba;var ca="object"===typeof aa.exportsNamespace&&aa.exportsNamespace?aa.exportsNamespace:ba;aa.exportsNamespace=ca;ba.Object.freeze(aa);
var aaa={envInfo:aa,semantics:{asInstanceOfs:2,arrayIndexOutOfBounds:2,moduleInit:2,strictFloats:!1,productionMode:!0},assumingES6:!1,linkerVersion:"0.6.29",globalThis:this};ba.Object.freeze(aaa);ba.Object.freeze(aaa.semantics);
var da=ba.Math.imul||function(a,b){var d=a&65535,e=b&65535;return d*e+((a>>>16&65535)*e+d*(b>>>16&65535)<<16>>>0)|0},ea=ba.Math.fround||function(a){return+a},fa=ba.Math.clz32||function(a){if(0===a)return 32;var b=1;0===(a&4294901760)&&(a<<=16,b+=16);0===(a&4278190080)&&(a<<=8,b+=8);0===(a&4026531840)&&(a<<=4,b+=4);0===(a&3221225472)&&(a<<=2,b+=2);return b+(a>>31)},ha=0,ja=ba.WeakMap?new ba.WeakMap:null;
function ka(a){return function(b,d){return!(!b||!b.$classData||b.$classData.ls!==d||b.$classData.ks!==a)}}function baa(a){for(var b in a)return b}function la(a,b){return new a.nB(b)}function ma(a,b){return caa(a,b,0)}function caa(a,b,d){var e=new a.nB(b[d]);if(d<b.length-1){a=a.vu;d+=1;for(var f=e.j,g=0;g<f.length;g++)f[g]=caa(a,b,d)}return e}function oa(a){return void 0===a?"undefined":a.toString()}
function qa(a){switch(typeof a){case "string":return ra(sa);case "number":var b=a|0;return b===a?ta(b)?ra(va):wa(b)?ra(xa):ra(ya):za(a)?ra(Aa):ra(Ba);case "boolean":return ra(Ca);case "undefined":return ra(Ea);default:return null===a?a.zra():a instanceof Fa?ra(Ga):a&&a.$classData?ra(a.$classData):null}}function Ia(a,b){return a&&a.$classData||null===a?a.m(b):"number"===typeof a?"number"===typeof b&&(a===b?0!==a||1/a===1/b:a!==a&&b!==b):a===b}
function Ja(a){switch(typeof a){case "string":return Ma(Na(),a);case "number":return daa(Oa(),a);case "boolean":return a?1231:1237;case "undefined":return 0;default:return a&&a.$classData||null===a?a.p():null===ja?42:Pa(a)}}function Qa(a){return"string"===typeof a?a.length|0:a.ra()}function Ra(a,b,d){return"string"===typeof a?a.substring(b,d):a.aE(b,d)}function Sa(a){return 2147483647<a?2147483647:-2147483648>a?-2147483648:a|0}
function Ta(a,b,d,e,f){a=a.j;d=d.j;if(a!==d||e<b||(b+f|0)<e)for(var g=0;g<f;g=g+1|0)d[e+g|0]=a[b+g|0];else for(g=f-1|0;0<=g;g=g-1|0)d[e+g|0]=a[b+g|0]}
var Pa=null!==ja?function(a){switch(typeof a){case "string":case "number":case "boolean":case "undefined":return Ja(a);default:if(null===a)return 0;var b=ja.get(a);void 0===b&&(ha=b=ha+1|0,ja.set(a,b));return b}}:function(a){if(a&&a.$classData){var b=a.$idHashCode$0;if(void 0!==b)return b;if(ba.Object.isSealed(a))return 42;ha=b=ha+1|0;return a.$idHashCode$0=b}return null===a?0:Ja(a)};function ta(a){return"number"===typeof a&&a<<24>>24===a&&1/a!==1/-0}
function wa(a){return"number"===typeof a&&a<<16>>16===a&&1/a!==1/-0}function Ua(a){return"number"===typeof a&&(a|0)===a&&1/a!==1/-0}function za(a){return"number"===typeof a}function Va(a){return null===a?Wa().tq:a}function Xa(){this.Ky=this.nB=void 0;this.ks=this.vu=this.Sb=null;this.ls=0;this.Lz=null;this.Cx="";this.bl=this.vx=this.wx=void 0;this.name="";this.isRawJSType=this.isArrayClass=this.isInterface=this.isPrimitive=!1;this.isInstance=void 0}
function Ya(a,b,d){var e=new Xa;e.Sb={};e.vu=null;e.Lz=a;e.Cx=b;e.bl=function(){return!1};e.name=d;e.isPrimitive=!0;e.isInstance=function(){return!1};return e}function h(a,b,d,e,f,g,k,l){var n=new Xa,t=baa(a);k=k||function(u){return!!(u&&u.$classData&&u.$classData.Sb[t])};l=l||function(u,w){return!!(u&&u.$classData&&u.$classData.ls===w&&u.$classData.ks.Sb[t])};n.Ky=g;n.Sb=e;n.Cx="L"+d+";";n.bl=l;n.name=d;n.isInterface=b;n.isRawJSType=!!f;n.isInstance=k;return n}
function eaa(a){function b(l){if("number"===typeof l){this.j=Array(l);for(var n=0;n<l;n++)this.j[n]=f}else this.j=l}var d=new Xa,e=a.Lz,f="longZero"==e?Wa().tq:e;b.prototype=new m;b.prototype.constructor=b;b.prototype.Cq=function(){return this.j instanceof Array?new b(this.j.slice(0)):new b(new this.j.constructor(this.j))};b.prototype.$classData=d;e="["+a.Cx;var g=a.ks||a,k=a.ls+1;d.nB=b;d.Ky=Za;d.Sb={d:1,ue:1,h:1};d.vu=a;d.ks=g;d.ls=k;d.Lz=null;d.Cx=e;d.wx=void 0;d.vx=void 0;d.bl=void 0;d.name=e;
d.isPrimitive=!1;d.isInterface=!1;d.isArrayClass=!0;d.isInstance=function(l){return g.bl(l,k)};return d}function ra(a){if(!a.wx){var b=new $a;b.ik=a;a.wx=b}return a.wx}function ab(a){a.vx||(a.vx=eaa(a));return a.vx}Xa.prototype.getFakeInstance=function(){if(this===sa)return"some string";if(this===Ca)return!1;if(this===va||this===xa||this===ya||this===Aa||this===Ba)return 0;if(this===Ga)return Wa().tq;if(this!==Ea)return{$classData:this}};
Xa.prototype.getSuperclass=function(){return this.Ky?ra(this.Ky):null};Xa.prototype.getComponentType=function(){return this.vu?ra(this.vu):null};Xa.prototype.newArrayOfThisClass=function(a){for(var b=this,d=0;d<a.length;d++)b=ab(b);return ma(b,a)};var bb=Ya(void 0,"V","void"),cb=Ya(!1,"Z","boolean"),eb=Ya(0,"C","char"),fb=Ya(0,"B","byte"),gb=Ya(0,"S","short"),hb=Ya(0,"I","int"),ib=Ya("longZero","J","long"),jb=Ya(0,"F","float"),mb=Ya(0,"D","double"),nb=ka(cb);cb.bl=nb;var ob=ka(eb);eb.bl=ob;
var pb=ka(fb);fb.bl=pb;var qb=ka(gb);gb.bl=qb;var rb=ka(hb);hb.bl=rb;var sb=ka(ib);ib.bl=sb;var tb=ka(jb);jb.bl=tb;var ub=ka(mb);mb.bl=ub;function faa(a,b){return p(function(d,e){return function(f){return d.w(e.w(f))}}(a,b))}function vb(a,b){return p(function(d,e){return function(f){return e.w(d.w(f))}}(a,b))}function gaa(a){return p(function(b){return function(d){if(null!==d)return b.Cf(d.ha(),d.la());throw(new q).i(d);}}(a))}function wb(a){return p(function(b){return function(d){return p(function(e,f){return function(g){return e.Cf(f,g)}}(b,d))}}(a))}
function haa(a,b,d){return b.ta.Ub(d,xb(function(e){return function(f,g){return yb(e,g,f)}}(a)))}function yb(a,b,d){if(b instanceof zb)return iaa(a,b,d);if(b instanceof Ab)return jaa(a,b.De,d);if(b instanceof Bb)return iaa(a,b.zl,d);throw(new q).i(b);}function jaa(a,b,d){return b.fg.Ub(d,xb(function(e){return function(f,g){return haa(e,g,f)}}(a)))}function kaa(a,b,d){return b.ta.Ub(d,xb(function(e){return function(f,g){return yb(e,g,f)}}(a)))}
function Cb(a,b){if(b instanceof zb)return a.re(b);if(b instanceof Ab)return a=laa(a,b.De),Db(a,b.ja,b.Mj);if(b instanceof Bb)return a=a.re(b.zl),Eb(a,b.ja);throw(new q).i(b);}function laa(a,b){var d=b.fg;a=p(function(f){return function(g){return f.Pe(g)}}(a));var e=r();d=d.xa(a,e.P);return(new Gb).Zs(b.Hs,d,b.$e)}function Hb(a,b){var d=b.ta;a=p(function(f){return function(g){return Cb(f,g)}}(a));var e=r();d=d.xa(a,e.P);return(new Ib).xj(b.Od,d,b.ja)}
function Jb(a,b){var d=b.ta;a=p(function(f){return function(g){return Cb(f,g)}}(a));var e=r();d=d.xa(a,e.P);return(new zb).Jc(b.xe,d,b.ja)}function Kb(a,b){a=laa(a,b.De);return Lb(b.aj,a,b.Sz)}function maa(a,b){b.ta.ua(p(function(d){return function(e){Mb(d,e)}}(a)))}function Nb(a,b){b.fg.ua(p(function(d){return function(e){d.rM(e)}}(a)))}function naa(a,b){b.ta.ua(p(function(d){return function(e){Mb(d,e)}}(a)))}
function Mb(a,b){if(b instanceof zb)a.vE(b);else if(b instanceof Ab)Nb(a,b.De);else if(b instanceof Bb)a.vE(b.zl);else throw(new q).i(b);}function oaa(a,b){return-1!==(a.ee.indexOf("\x3cBREED\x3e")|0)?b.eg:b.pa}function Ob(a){var b="^"+Pb(Na(),Pb(Na(),a.ee,"\\?","\\\\?"),paa(Qb()),"(.+)")+"$";b=(new Sb).c(b);var d=v();a.Iy((new Ub).Bp(b.U,d))}
function qaa(a,b){var d=(new Vb).bC((new Fa).fa(1E8,0)),e=(new Wb).rk(0),f=raa(a);Xb(new Yb,f,p(function(){return function(g){return null!==g}}(a))).ua(p(function(g,k,l,n){return function(t){if(null!==t){var u=+t.la();var w=Sa(+t.ha());var y=255&k>>16,E=255&w>>16;t=y+(E/2|0)|0;y=y-E|0;E=(255&k>>8)-(255&w>>8)|0;w=(255&k)-(255&w)|0;t=((da(da(512+t|0,y),y)>>8)+da(E<<2,E)|0)+(da(da(767-t|0,w),w)>>8)|0;w=(new Fa).fa(t,t>>31);t=w.ga;w=w.na;y=l.Za;E=y.na;if(w===E?(-2147483648^t)<(-2147483648^y.ga):w<E)l.Za=
(new Fa).fa(t,w),n.Za=u}else throw(new q).i(t);}}(a,b,d,e)));return e.Za}function Zb(a,b,d,e){if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/Dump.scala: 56");return a.bI.w((new $b).te(b,d,e))}function saa(a,b,d,e){a=(new ac).bg(b,p(function(f,g,k){return function(l){return Zb(f,l,g,k)}}(a,d,e)));return bc(a,"["," ","]")}
function cc(a,b,d,e,f,g,k,l,n){var t=[(new z).e("",b)];b=(new dc).vb(ec());for(var u=0,w=t.length|0;u<w;)fc(b,t[u]),u=1+u|0;t=taa;u=new ic;u.Bt=b.La;u.Qg=k;u.zv=l;u.os=n;u.vs=e;u.go=g;u.ml=f;u.Cn=d;u.gw=!1;return t(a,u)}
function uaa(a){A();for(var b=jc(a).za(),d=(new lc).b(),e=0;e<b;){var f=mc();nc(d,f);e=1+e|0}b=d.gb();if(a.rt.Km){a=mc();d=B();C();e=qc();C();f=D();C();var g=D();C();C();C();var k=D();C();return F(new G,d,e,b,a,f,g,!1,"OTPL",k,k.aa(),!0)}return rc(C(),b,(C(),D()),(C(),D()),(C(),"OTPL"),(C(),D()),(C(),!1),(C(),!0))}function vaa(a){a.K("OTPL");waa(a,H(sc().pi,v()));a.a=(32|a.a)<<24>>24}function tc(a){return!!(a&&a.$classData&&a.$classData.Sb.IF)}
function xaa(a,b,d,e,f){var g=a.Up.w(f.Ze());b=uc(b,vc(f),wc());xc();g=g.Pa();zc||(zc=(new Ac).b());g=Bc(0,g,zc);var k=new Cc;d=Dc(d,a.ge);k.Zb=a.Zb;k.ge=d;k.aj=f;k.Qg=e;yaa(k);a=Bc(xc(),g,k);Ec();a=a.un();e=Fc();for(d=H(Gc(),v());;)if(g=a.Y().tb,null===g||g!==e){b=Hc(Ec(),a,!1,b);if(null===b)throw(new q).i(b);g=b.ha();b=b.la();d.Rj(g)}else break;b=d.tc();e=a.Y();b=(new Gb).Zs(e.sc().$a,b,!1);a=2147483647!==a.Y().sc().Ra?a.Y().sc().Ya:b.sc().Ra;return Lb(f,b,a)}
function zaa(a,b){a=Aaa(Ic(),Jc(a),b);var d=Baa(Ic(),a.Zb,Dc(b.go,a.ge)),e=a.ge,f=(new Kc).Gd(b.go);e=Lc(e,f);f=(new Mc).lg(e);e=Nc().P;e=Oc(f,e);for(f=f.Bf.mm();f.qa();){var g=f.ma();e.Ka(xaa(a,d,b.go,b.Qg,g))}b=e.Ea().tc();return(new z).e(b,a)}function Caa(a,b,d,e){b=b.ta;var f=r();return b.Pj(f.P).Ub(e,xb(function(g,k){return function(l,n){l=(new z).e(l,n);n=l.ub;var t=l.Hb;if(null!==t)return Pc(g,t.ha(),k,t.Qc(),n);throw(new q).i(l);}}(a,d)))}
function Qc(a,b,d,e){b=b.ta;var f=r();return b.Pj(f.P).Ub(e,xb(function(g,k){return function(l,n){l=(new z).e(l,n);n=l.ub;var t=l.Hb;if(null!==t)return Pc(g,t.ha(),k,t.Qc(),n);throw(new q).i(l);}}(a,d)))}
function Daa(a,b,d,e){b=b.fg;var f=r();return b.Pj(f.P).Ub(e,xb(function(g,k){return function(l,n){n=(new z).e(l,n);l=n.ub;var t=n.Hb;if(null!==t){n=t.ha();t=Rc(k,(new Uc).wb(t.Qc()));var u=l.zk.Cc(t);u.x()?u=D():(u=u.Q(),u=(new I).i(Vc(u,g,n,t,l)));u.x()?(u=Wc(l.Mf,t),u=Xc(Yc(l),""+u+l.Jm.w(n.Od)),n=Caa(g,n,t,u),l=Zc(n.Qb,n.zk,l.Jm,n.Mf)):l=u.Q();return l}throw(new q).i(n);}}(a,d)))}
function Pc(a,b,d,e,f){if(b instanceof zb)return d=Rc(d,(new $c).wb(e)),dd(a,b,d,f);if(b instanceof Ab){d=Rc(d,(new ed).wb(e));if(b.Mj&&b.De.fg.x())f=Xc(Yc(f),Wc(f.Mf,d));else if(b.Mj)e=f.zk.Cc(d),e.x()?e=D():(e=e.Q(),e=(new I).i(Vc(e,a,b,d,Xc(Yc(f),Wc(f.Mf,d))))),e.x()?(e=Xc(Yc(f),Wc(f.Mf,d)),a=Daa(a,b.De,d,e),f=Xc(Yc(a),fd(f.Mf,d))):f=e.Q();else{var g=Eaa(a);e=Faa(a);var k=f.zk.Cc(d);k.x()?k=D():(k=k.Q(),k=(new I).i(Vc(k,a,b,d,Xc(Yc(f),Wc(f.Mf,d)))));k.x()?(g=Xc(Yc(f),g.w(f.Mf).w(d)),a=Daa(a,b.De,
d,g),f=Xc(Yc(a),e.w(f.Mf).w(d))):f=k.Q()}return f}if(b instanceof Bb)return d=Rc(d,(new gd).wb(e)),g=Eaa(a),e=Faa(a),k=f.zk.Cc(d),k.x()?k=D():(k=k.Q(),k=(new I).i(Vc(k,a,b,d,Xc(Yc(f),Wc(f.Mf,d))))),k.x()?(g=Xc(Yc(f),g.w(f.Mf).w(d)),b=b.zl,k=Rc(d,(new $c).wb(0)),a=dd(a,b,k,g),f=Xc(Yc(a),e.w(f.Mf).w(d))):f=k.Q(),f;throw(new q).i(b);}function Gaa(a){return"notImplemented("+hd(id(),a)+", undefined)"}
function Haa(a,b,d,e){if(jd(ld(),md(C()),b)||0===d.Um.ra())return e;b=d.Um;a=p(function(){return function(f){return'ProcedurePrims.stack().currentContext().registerStringRunArg("'+f.ha()+'", '+f.la()+");"}}(a));d=r();return b.xa(a,d.P).Jb("\n")+"\n"+e}function nd(a,b,d,e){throw(new pd).Xs(a,b,d,e);}function qd(a){a=rd().ed(a);if(a.x())var b=!0;else b=a.Q(),b=(new Sb).c(b),b=sd(b);a=b?a:D();return a.x()?"LINKS":a.Q()}
function Iaa(a,b,d,e){if(jd(ld(),td(C()),b)||0===d.Um.ra())return e;b=d.Um;a=p(function(){return function(f){return'ProcedurePrims.stack().currentContext().registerStringRunArg("'+f.ha()+'", '+f.la()+")"}}(a));d=r();return"("+b.xa(a,d.P).Jb(",\n")+",\n"+e+")"}function Jaa(a,b){ud();return vd(new wd,Kaa(b)).ed(a)}function xd(a){return yd(zd(),Ad(zd(),a))}function Dd(a,b){return a.Co(b).tI(p(function(){return function(d){throw(new Ed).Ca(d);}}(a)),p(function(){return function(d){return d}}(a)))}
function Fd(a,b){return a.Co(b).hH()}var Laa=h({St:0},!0,"sbt.testing.Fingerprint",{St:1});function Gd(a){return!!(a&&a.$classData&&a.$classData.Sb.rA)}var Hd=h({rA:0},!0,"sbt.testing.Framework",{rA:1}),Maa=h({sA:0},!0,"sbt.testing.Logger",{sA:1}),Id=h({SF:0},!0,"sbt.testing.Task",{SF:1});function Jd(a,b){var d=Kd();a=[Ld(Kd(),a.yh(b))];b=a.length|0;var e=0,f=Md((new Nd).yj(d.yr));a:for(;;){if(e!==b){d=1+e|0;f=Od(f,a[e]);e=d;continue a}return f}}
function Naa(a){(new Pd).ne(a);(new Qd).ne(a);(new Rd).ne(a);(new Sd).ne(a);(new Td).ne(a);(new Ud).ne(a);(new Vd).ne(a);(new Wd).ne(a);(new Xd).ne(a);a.qL((new Yd).ne(a));(new Zd).ne(a);(new $d).ne(a);(new ae).ne(a);(new be).ne(a);(new ce).ne(a)}function Oaa(){(new de).wC();(new ee).wC()}function fe(){}function m(){}m.prototype=fe.prototype;fe.prototype.b=function(){return this};fe.prototype.m=function(a){return this===a};
fe.prototype.l=function(){var a=qa(this).yg(),b=(+(this.p()>>>0)).toString(16);return a+"@"+b};fe.prototype.p=function(){return Pa(this)};fe.prototype.toString=function(){return this.l()};function ge(a,b){if(a=a&&a.$classData){var d=a.ls||0;return!(d<b)&&(d>b||!a.ks.isPrimitive)}return!1}var Za=h({d:0},!1,"java.lang.Object",{d:1},void 0,void 0,function(a){return null!==a},ge);fe.prototype.$classData=Za;
function Paa(a,b){b!==a&&b.Qp(p(function(d){return function(e){return d.yw(e)}}(a)),he());return a}function ie(a,b){if(a.yw(b))return a;throw(new je).c("Promise already completed.");}
function Qaa(a,b){if(b instanceof ke)return b=null===b?0:b.W,a.MC()&&a.Wi()===b;if(ta(b))return b|=0,a.LC()&&a.Jx()===b;if(wa(b))return b|=0,a.NC()&&a.kz()===b;if(Ua(b))return b|=0,a.tv()&&a.Wi()===b;if(b instanceof Fa){var d=Va(b);b=d.ga;d=d.na;a=a.Dj();var e=a.na;return a.ga===b&&e===d}return za(b)?(b=+b,a.Kq()===b):"number"===typeof b?(b=+b,a.Am()===b):!1}function Raa(a,b){a.ED=b;return a}function Saa(a,b){return 0<=a.Br(b)?oa(Ra(a.WD(),a.Br(b),a.Lu(b))):null}
function Taa(a,b){return(new le).Ol(a,p(function(d,e){return function(f){return ne(d,e,f)}}(a,b)))}function oe(a,b){return(new le).Ol(a,p(function(d,e){return function(f){f=pe(e).Pi(f);if(f instanceof qe||f instanceof re)return f;if(f instanceof se)return(new re).Ln(d,f.el,f.we);throw(new q).i(f);}}(a,b)))}function te(a,b){return(new le).Ol(a,p(function(d,e){return function(f){return(new se).Ln(d,e,f)}}(a,b)))}
function ue(a,b,d){return(new le).Ol(a,p(function(e,f,g){return function(k){if(k.fn.x())var l=(new se).Ln(e,"end of input",k);else g.Sa(k.fn.Y())?(l=g.w(k.fn.Y()),k=Uaa(new ve,k.fn.X(),k.OB),l=ne(e,l,k)):l=(new se).Ln(e,f+" expected",k);return l}}(a,b,d)))}
function Vaa(a,b,d){return(new le).Ol(a,p(function(e,f,g){return function(k){var l=(new we).b(),n=(new lc).b(),t=pe(f).Pi(k);if(t instanceof qe){k=t.we;nc(n,t.Wm);if(l.Aa)l=l.Oa;else{if(null===l)throw(new xe).b();l=l.Aa?l.Oa:ye(l,pe(g))}a:for(;;)if(t=l.Pi(k),t instanceof qe)k=t,t=k.we,nc(n,k.Wm),k=t;else{n=t instanceof re?t:ne(e,n.gb(),k);break a}return n}if(t instanceof ze)return t;throw(new q).i(t);}}(a,b,d)))}
function Ae(a,b){return Be(Vaa(a,b,b),J(function(d){return function(){var e=v();return Taa(d,e)}}(a)))}function Waa(a,b){var d=a.Ta;a=Ce(De(a,p(function(e,f){return function(g){return Ee(oe(e.Ta,f),p(function(k,l){return function(n){return Ge(k.Ta,l,n)}}(e,g)))}}(a,b))),"~");return(new He).Ol(d,a)}
function Xaa(a){var b=(new Sb).c("");a=-1+a.Ec|0;b=Ie(Je(),b.U,0,a);b=(new Sb).c(b);a=Ke().rq;a=Oc(b,a);for(var d=0,e=b.U.length|0;d<e;){var f=b.R(d);f=null===f?0:f.W;a.Ka(Le(9===f?f:32));d=1+d|0}return"\n"+a.Ea()+"^"}function Me(a,b){b.ua(p(function(d){return function(e){return d.sl(e)}}(a)));return a}function Lc(a,b){return a instanceof Ne&&b instanceof Ne?Yaa(a,b):b.ob().qf(a,xb(function(){return function(d,e){return d.le(e)}}(a)))}
function Oe(a){var b=ma(ab(Za),[a.j.length]);Ta(a,0,b,0,a.j.length);return b}
function Zaa(a,b,d){if(32>d)return a.Ve().j[31&b];if(1024>d)return a.yb().j[31&(b>>>5|0)].j[31&b];if(32768>d)return a.Tb().j[31&(b>>>10|0)].j[31&(b>>>5|0)].j[31&b];if(1048576>d)return a.qc().j[31&(b>>>15|0)].j[31&(b>>>10|0)].j[31&(b>>>5|0)].j[31&b];if(33554432>d)return a.Pd().j[31&(b>>>20|0)].j[31&(b>>>15|0)].j[31&(b>>>10|0)].j[31&(b>>>5|0)].j[31&b];if(1073741824>d)return a.Zh().j[31&(b>>>25|0)].j[31&(b>>>20|0)].j[31&(b>>>15|0)].j[31&(b>>>10|0)].j[31&(b>>>5|0)].j[31&b];throw(new Pe).b();}
function $aa(a,b,d,e){if(!(32>e))if(1024>e)1===a.Rf()&&(a.uc(ma(ab(Za),[32])),a.yb().j[31&(b>>>5|0)]=a.Ve(),a.kk(1+a.Rf()|0)),a.$c(ma(ab(Za),[32]));else if(32768>e)2===a.Rf()&&(a.jd(ma(ab(Za),[32])),a.Tb().j[31&(b>>>10|0)]=a.yb(),a.kk(1+a.Rf()|0)),a.uc(a.Tb().j[31&(d>>>10|0)]),null===a.yb()&&a.uc(ma(ab(Za),[32])),a.$c(ma(ab(Za),[32]));else if(1048576>e)3===a.Rf()&&(a.We(ma(ab(Za),[32])),a.qc().j[31&(b>>>15|0)]=a.Tb(),a.kk(1+a.Rf()|0)),a.jd(a.qc().j[31&(d>>>15|0)]),null===a.Tb()&&a.jd(ma(ab(Za),[32])),
a.uc(a.Tb().j[31&(d>>>10|0)]),null===a.yb()&&a.uc(ma(ab(Za),[32])),a.$c(ma(ab(Za),[32]));else if(33554432>e)4===a.Rf()&&(a.Fh(ma(ab(Za),[32])),a.Pd().j[31&(b>>>20|0)]=a.qc(),a.kk(1+a.Rf()|0)),a.We(a.Pd().j[31&(d>>>20|0)]),null===a.qc()&&a.We(ma(ab(Za),[32])),a.jd(a.qc().j[31&(d>>>15|0)]),null===a.Tb()&&a.jd(ma(ab(Za),[32])),a.uc(a.Tb().j[31&(d>>>10|0)]),null===a.yb()&&a.uc(ma(ab(Za),[32])),a.$c(ma(ab(Za),[32]));else if(1073741824>e)5===a.Rf()&&(a.ip(ma(ab(Za),[32])),a.Zh().j[31&(b>>>25|0)]=a.Pd(),
a.kk(1+a.Rf()|0)),a.Fh(a.Zh().j[31&(d>>>25|0)]),null===a.Pd()&&a.Fh(ma(ab(Za),[32])),a.We(a.Pd().j[31&(d>>>20|0)]),null===a.qc()&&a.We(ma(ab(Za),[32])),a.jd(a.qc().j[31&(d>>>15|0)]),null===a.Tb()&&a.jd(ma(ab(Za),[32])),a.uc(a.Tb().j[31&(d>>>10|0)]),null===a.yb()&&a.uc(ma(ab(Za),[32])),a.$c(ma(ab(Za),[32]));else throw(new Pe).b();}function Qe(a,b,d){var e=ma(ab(Za),[32]);Ta(a,b,e,d,32-(d>b?d:b)|0);return e}
function aba(a,b,d){if(!(32>d))if(1024>d)a.$c(a.yb().j[31&(b>>>5|0)]);else if(32768>d)a.uc(a.Tb().j[31&(b>>>10|0)]),a.$c(a.yb().j[31&(b>>>5|0)]);else if(1048576>d)a.jd(a.qc().j[31&(b>>>15|0)]),a.uc(a.Tb().j[31&(b>>>10|0)]),a.$c(a.yb().j[31&(b>>>5|0)]);else if(33554432>d)a.We(a.Pd().j[31&(b>>>20|0)]),a.jd(a.qc().j[31&(b>>>15|0)]),a.uc(a.Tb().j[31&(b>>>10|0)]),a.$c(a.yb().j[31&(b>>>5|0)]);else if(1073741824>d)a.Fh(a.Zh().j[31&(b>>>25|0)]),a.We(a.Pd().j[31&(b>>>20|0)]),a.jd(a.qc().j[31&(b>>>15|0)]),
a.uc(a.Tb().j[31&(b>>>10|0)]),a.$c(a.yb().j[31&(b>>>5|0)]);else throw(new Pe).b();}
function bba(a,b){var d=-1+a.Rf()|0;switch(d){case 5:a.ip(Oe(a.Zh()));a.Fh(Oe(a.Pd()));a.We(Oe(a.qc()));a.jd(Oe(a.Tb()));a.uc(Oe(a.yb()));a.Zh().j[31&(b>>>25|0)]=a.Pd();a.Pd().j[31&(b>>>20|0)]=a.qc();a.qc().j[31&(b>>>15|0)]=a.Tb();a.Tb().j[31&(b>>>10|0)]=a.yb();a.yb().j[31&(b>>>5|0)]=a.Ve();break;case 4:a.Fh(Oe(a.Pd()));a.We(Oe(a.qc()));a.jd(Oe(a.Tb()));a.uc(Oe(a.yb()));a.Pd().j[31&(b>>>20|0)]=a.qc();a.qc().j[31&(b>>>15|0)]=a.Tb();a.Tb().j[31&(b>>>10|0)]=a.yb();a.yb().j[31&(b>>>5|0)]=a.Ve();break;
case 3:a.We(Oe(a.qc()));a.jd(Oe(a.Tb()));a.uc(Oe(a.yb()));a.qc().j[31&(b>>>15|0)]=a.Tb();a.Tb().j[31&(b>>>10|0)]=a.yb();a.yb().j[31&(b>>>5|0)]=a.Ve();break;case 2:a.jd(Oe(a.Tb()));a.uc(Oe(a.yb()));a.Tb().j[31&(b>>>10|0)]=a.yb();a.yb().j[31&(b>>>5|0)]=a.Ve();break;case 1:a.uc(Oe(a.yb()));a.yb().j[31&(b>>>5|0)]=a.Ve();break;case 0:break;default:throw(new q).i(d);}}function Re(a,b){var d=a.j[b];a.j[b]=null;return Oe(d)}
function Se(a,b,d){a.kk(d);d=-1+d|0;switch(d){case -1:break;case 0:a.$c(b.Ve());break;case 1:a.uc(b.yb());a.$c(b.Ve());break;case 2:a.jd(b.Tb());a.uc(b.yb());a.$c(b.Ve());break;case 3:a.We(b.qc());a.jd(b.Tb());a.uc(b.yb());a.$c(b.Ve());break;case 4:a.Fh(b.Pd());a.We(b.qc());a.jd(b.Tb());a.uc(b.yb());a.$c(b.Ve());break;case 5:a.ip(b.Zh());a.Fh(b.Pd());a.We(b.qc());a.jd(b.Tb());a.uc(b.yb());a.$c(b.Ve());break;default:throw(new q).i(d);}}function Te(a){return null===a?cba():a}
function dba(a){return a===cba()?null:a}var eba=h({gz:0},!0,"scala.collection.mutable.HashEntry",{gz:1});function Ue(){this.Ty=this.Py=null}Ue.prototype=new m;Ue.prototype.constructor=Ue;function fba(a){return la(ab(Ve),[a.Py,a.Ty])}function We(a,b,d){a.Py=b;a.Ty=d;return a}Ue.prototype.$classData=h({HM:0},!1,"java.math.BigInteger$QuotAndRem",{HM:1,d:1});function Xe(){}Xe.prototype=new m;Xe.prototype.constructor=Xe;Xe.prototype.b=function(){return this};
function gba(a,b,d,e){for(var f=a=0;f<e;){var g=f,k=d.j[g];b.j[g]=k<<1|a;a=k>>>31|0;f=1+f|0}0!==a&&(b.j[e]=a)}function hba(a,b,d){a=d>>5;d&=31;var e=(b.cc+a|0)+(0===d?0:1)|0,f=ma(ab(hb),[e]);Ye(0,f,b.zb,a,d);b=Ze(b.Yb,e,f);$e(b);return b}
function iba(a,b,d){a=d>>5;var e=31&d;if(a>=b.cc)return 0>b.Yb?af().mx:af().ak;d=b.cc-a|0;var f=ma(ab(hb),[1+d|0]);jba(0,f,d,b.zb,a,e);if(0>b.Yb){for(var g=0;g<a&&0===b.zb.j[g];)g=1+g|0;var k=0!==b.zb.j[g]<<(32-e|0);if(g<a||0<e&&k){for(g=0;g<d&&-1===f.j[g];)f.j[g]=0,g=1+g|0;g===d&&(d=1+d|0);a=g;f.j[a]=1+f.j[a]|0}}b=Ze(b.Yb,d,f);$e(b);return b}function bf(a,b){if(0===b.Yb)return 0;a=b.cc<<5;var d=b.zb.j[-1+b.cc|0];0>b.Yb&&cf(b)===(-1+b.cc|0)&&(d=-1+d|0);return a=a-fa(d)|0}
function jba(a,b,d,e,f,g){for(a=0;a<f;)a=1+a|0;if(0===g)Ta(e,f,b,0,d);else{var k=32-g|0;for(a=0;a<(-1+d|0);)b.j[a]=e.j[a+f|0]>>>g|0|e.j[1+(a+f|0)|0]<<k,a=1+a|0;b.j[a]=e.j[a+f|0]>>>g|0}}function Ye(a,b,d,e,f){if(0===f)Ta(d,0,b,e,b.j.length-e|0);else{a=32-f|0;b.j[-1+b.j.length|0]=0;for(var g=-1+b.j.length|0;g>e;){var k=g;b.j[k]=b.j[k]|d.j[-1+(g-e|0)|0]>>>a|0;b.j[-1+g|0]=d.j[-1+(g-e|0)|0]<<f;g=-1+g|0}}for(d=0;d<e;)b.j[d]=0,d=1+d|0}Xe.prototype.$classData=h({IM:0},!1,"java.math.BitLevel$",{IM:1,d:1});
var df=void 0;function ef(){df||(df=(new Xe).b());return df}function ff(){this.LE=this.$E=null}ff.prototype=new m;ff.prototype.constructor=ff;
ff.prototype.b=function(){gf=this;this.$E=la(ab(hb),[-1,-1,31,19,15,13,11,11,10,9,9,8,8,8,8,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5]);this.LE=la(ab(hb),[-2147483648,1162261467,1073741824,1220703125,362797056,1977326743,1073741824,387420489,1E9,214358881,429981696,815730721,1475789056,170859375,268435456,410338673,612220032,893871739,128E7,1801088541,113379904,148035889,191102976,244140625,308915776,387420489,481890304,594823321,729E6,887503681,1073741824,1291467969,1544804416,1838265625,60466176]);
return this};
function kba(a,b,d){if(0===b.ga&&0===b.na)switch(d){case 0:return"0";case 1:return"0.0";case 2:return"0.00";case 3:return"0.000";case 4:return"0.0000";case 5:return"0.00000";case 6:return"0.000000";default:return(0>d?"0E+":"0E")+(-2147483648===d?"2147483648":""+(-d|0))}else{a=0>b.na;var e="";var f=18;if(a){var g=b.ga;b=b.na;b=(new Fa).fa(-g|0,0!==g?~b:-b|0)}g=b.ga;for(var k=b.na;;){b=g;var l=k;k=Wa();g=hf(k,g,l,10,0);k=k.Pb;f=-1+f|0;l=k;var n=g,t=n>>>16|0;n=da(10,65535&n);t=da(10,t);t=n+(t<<16)|0;
da(10,l);e=""+(b-t|0)+e;b=k;if(0===g&&0===b)break}b=-1+((18-f|0)-d|0)|0;if(0<d&&-6<=b)if(d=1+b|0,0<d)e=e.substring(0,d)+"."+e.substring(d);else{d=-d|0;for(f=0;f<d;)e="0"+e,f=1+f|0;e="0."+e}else 0!==d&&(d=""+b,0<b&&(d="+"+d),d="E"+d,e=1<(18-f|0)?e.substring(0,1)+"."+e.substring(1)+d:""+e+d);return a?"-"+e:e}}
function jf(a,b){a=b.Yb;var d=b.cc,e=b.zb;if(0===a)return"0";if(1===d)return b=(+(e.j[0]>>>0)).toString(10),0>a?"-"+b:b;b="";var f=ma(ab(hb),[d]);Ta(e,0,f,0,d);do{var g=0;for(e=-1+d|0;0<=e;){var k=g;g=f.j[e];var l=kf(Wa(),g,k,1E9,0);f.j[e]=l;k=l>>31;var n=65535&l;l=l>>>16|0;var t=da(51712,n);n=da(15258,n);var u=da(51712,l);t=t+((n+u|0)<<16)|0;da(1E9,k);da(15258,l);g=g-t|0;e=-1+e|0}e=""+g;for(b="000000000".substring(e.length|0)+e+b;0!==d&&0===f.j[-1+d|0];)d=-1+d|0}while(0!==d);f=0;for(d=b.length|0;;)if(f<
d&&48===(65535&(b.charCodeAt(f)|0)))f=1+f|0;else break;b=b.substring(f);return 0>a?"-"+b:b}ff.prototype.$classData=h({JM:0},!1,"java.math.Conversion$",{JM:1,d:1});var gf=void 0;function lf(){gf||(gf=(new ff).b());return gf}function mf(){}mf.prototype=new m;mf.prototype.constructor=mf;mf.prototype.b=function(){return this};
function lba(a,b,d,e,f,g,k){a=ma(ab(hb),[1+f|0]);var l=ma(ab(hb),[1+k|0]),n=fa(g.j[-1+k|0]);0!==n?(Ye(ef(),l,g,0,n),Ye(ef(),a,e,0,n)):(Ta(e,0,a,0,f),Ta(g,0,l,0,k));e=l.j[-1+k|0];for(d=-1+d|0;0<=d;){if(a.j[f]===e)g=-1;else{var t=a.j[f],u=a.j[-1+f|0];g=Wa();var w=kf(g,u,t,e,0);t=g.Pb;g=w;var y=65535&w;w=w>>>16|0;var E=65535&e,L=e>>>16|0,S=da(y,E);E=da(w,E);y=da(y,L);y=S+((E+y|0)<<16)|0;da(t,e);da(w,L);u=u-y|0;if(0!==g)a:for(g=1+g|0;;){w=g=-1+g|0;L=l.j[-2+k|0];t=65535&w;w=w>>>16|0;S=65535&L;L=L>>>16|
0;y=da(t,S);S=da(w,S);E=da(t,L);t=y+((S+E|0)<<16)|0;y=(y>>>16|0)+E|0;y=(da(w,L)+(y>>>16|0)|0)+(((65535&y)+S|0)>>>16|0)|0;L=u;w=a.j[-2+f|0];S=u+e|0;if(0===((-2147483648^S)<(-2147483648^u)?1:0)&&(u=S,y^=-2147483648,L^=-2147483648,y===L?(-2147483648^t)>(-2147483648^w):y>L))continue a;break}}if(u=0!==g){nf();u=a;t=f-k|0;L=l;w=k;y=g;var ia=0;var na;for(S=na=0;S<w;){E=S;of();var pa=L.j[E],ua=65535&pa;pa=pa>>>16|0;var Ka=65535&y,Da=y>>>16|0,Ha=da(ua,Ka);Ka=da(pa,Ka);var kb=da(ua,Da);ua=Ha+((Ka+kb|0)<<16)|
0;Ha=(Ha>>>16|0)+kb|0;Da=(da(pa,Da)+(Ha>>>16|0)|0)+(((65535&Ha)+Ka|0)>>>16|0)|0;pa=ua+ia|0;ia=(-2147483648^pa)<(-2147483648^ua)?1+Da|0:Da;Da=u.j[t+E|0];pa=Da-pa|0;Da=(-2147483648^pa)>(-2147483648^Da)?-1:0;ua=na;na=ua>>31;ua=pa+ua|0;na=(-2147483648^ua)<(-2147483648^pa)?1+(Da+na|0)|0:Da+na|0;u.j[t+E|0]=ua;S=1+S|0}y=u.j[t+w|0];L=y-ia|0;y=(-2147483648^L)>(-2147483648^y)?-1:0;E=na;S=E>>31;E=L+E|0;u.j[t+w|0]=E;u=0!==((-2147483648^E)<(-2147483648^L)?1+(y+S|0)|0:y+S|0)}if(u)for(g=-1+g|0,u=S=y=0;u<k;)t=u,
L=a.j[(f-k|0)+t|0],w=L+l.j[t]|0,L=(-2147483648^w)<(-2147483648^L)?1:0,w=y+w|0,L=(-2147483648^w)<(-2147483648^y)?1+(S+L|0)|0:S+L|0,y=w,S=L,a.j[(f-k|0)+t|0]=y,y=S,S=0,u=1+u|0;null!==b&&(b.j[d]=g);f=-1+f|0;d=-1+d|0}return 0!==n?(jba(ef(),l,k,a,0,n),l):(Ta(a,0,l,0,k),a)}
function mba(a,b,d,e,f){a=0;for(e=-1+e|0;0<=e;){var g=a;a=d.j[e];var k=Wa();g=kf(k,a,g,f,0);k=k.Pb;var l=65535&g,n=g>>>16|0,t=65535&f,u=f>>>16|0,w=da(l,t);t=da(n,t);l=da(l,u);w=w+((t+l|0)<<16)|0;da(k,f);da(n,u);a=a-w|0;b.j[e]=g;e=-1+e|0}return a}mf.prototype.$classData=h({KM:0},!1,"java.math.Division$",{KM:1,d:1});var pf=void 0;function nf(){pf||(pf=(new mf).b());return pf}function qf(){}qf.prototype=new m;qf.prototype.constructor=qf;qf.prototype.b=function(){return this};
function rf(a,b,d,e){for(var f=ma(ab(hb),[b]),g=0,k=0;g<e;){var l=a.j[g],n=l-d.j[g]|0;l=(-2147483648^n)>(-2147483648^l)?-1:0;var t=k;k=t>>31;t=n+t|0;n=(-2147483648^t)<(-2147483648^n)?1+(l+k|0)|0:l+k|0;f.j[g]=t;k=n;g=1+g|0}for(;g<b;)d=a.j[g],n=k,e=n>>31,n=d+n|0,d=(-2147483648^n)<(-2147483648^d)?1+e|0:e,f.j[g]=n,k=d,g=1+g|0;return f}function sf(a,b,d,e){for(a=-1+e|0;0<=a&&b.j[a]===d.j[a];)a=-1+a|0;return 0>a?0:(-2147483648^b.j[a])<(-2147483648^d.j[a])?-1:1}
function tf(a,b,d,e){var f=ma(ab(hb),[1+b|0]),g=1,k=a.j[0],l=k+d.j[0]|0;f.j[0]=l;k=(-2147483648^l)<(-2147483648^k)?1:0;if(b>=e){for(;g<e;){var n=a.j[g];l=n+d.j[g]|0;n=(-2147483648^l)<(-2147483648^n)?1:0;k=l+k|0;l=(-2147483648^k)<(-2147483648^l)?1+n|0:n;f.j[g]=k;k=l;g=1+g|0}for(;g<b;)d=a.j[g],e=d+k|0,d=(-2147483648^e)<(-2147483648^d)?1:0,f.j[g]=e,k=d,g=1+g|0}else{for(;g<b;)n=a.j[g],l=n+d.j[g]|0,n=(-2147483648^l)<(-2147483648^n)?1:0,k=l+k|0,l=(-2147483648^k)<(-2147483648^l)?1+n|0:n,f.j[g]=k,k=l,g=1+
g|0;for(;g<e;)a=d.j[g],b=a+k|0,a=(-2147483648^b)<(-2147483648^a)?1:0,f.j[g]=b,k=a,g=1+g|0}0!==k&&(f.j[g]=k);return f}
function uf(a,b,d){a=b.Yb;var e=d.Yb,f=b.cc,g=d.cc;if(0===a)return d;if(0===e)return b;if(2===(f+g|0)){b=b.zb.j[0];d=d.zb.j[0];if(a===e)return e=b+d|0,d=(-2147483648^e)<(-2147483648^b)?1:0,0===d?(new vf).fa(a,e):Ze(a,2,la(ab(hb),[e,d]));e=af();0>a?(a=b=d-b|0,d=(-2147483648^b)>(-2147483648^d)?-1:0):(a=d=b-d|0,d=(-2147483648^d)>(-2147483648^b)?-1:0);return wf(e,(new Fa).fa(a,d))}if(a===e)e=f>=g?tf(b.zb,f,d.zb,g):tf(d.zb,g,b.zb,f);else{var k=f!==g?f>g?1:-1:sf(0,b.zb,d.zb,f);if(0===k)return af().ak;1===
k?e=rf(b.zb,f,d.zb,g):(d=rf(d.zb,g,b.zb,f),a=e,e=d)}a=Ze(a|0,e.j.length,e);$e(a);return a}
function xf(a,b,d){var e=b.Yb;a=d.Yb;var f=b.cc,g=d.cc;if(0===a)return b;if(0===e)return nba(d);if(2===(f+g|0))return b=b.zb.j[0],f=0,d=d.zb.j[0],g=0,0>e&&(e=b,b=-e|0,f=0!==e?~f:-f|0),0>a&&(a=d,e=g,d=-a|0,g=0!==a?~e:-e|0),a=af(),e=b,b=f,f=g,d=e-d|0,wf(a,(new Fa).fa(d,(-2147483648^d)>(-2147483648^e)?-1+(b-f|0)|0:b-f|0));var k=f!==g?f>g?1:-1:sf(yf(),b.zb,d.zb,f);if(e===a&&0===k)return af().ak;-1===k?(d=e===a?rf(d.zb,g,b.zb,f):tf(d.zb,g,b.zb,f),a=-a|0):e===a?(d=rf(b.zb,f,d.zb,g),a=e):(d=tf(b.zb,f,d.zb,
g),a=e);a=Ze(a|0,d.j.length,d);$e(a);return a}qf.prototype.$classData=h({LM:0},!1,"java.math.Elementary$",{LM:1,d:1});var zf=void 0;function yf(){zf||(zf=(new qf).b());return zf}function Bf(){this.hi=0;this.or=null}Bf.prototype=new m;Bf.prototype.constructor=Bf;Bf.prototype.m=function(a){return a instanceof Bf?this.hi===a.hi?this.or===a.or:!1:!1};Bf.prototype.l=function(){return"precision\x3d"+this.hi+" roundingMode\x3d"+this.or};Bf.prototype.p=function(){return this.hi<<3|this.or.EE};
Bf.prototype.$classData=h({MM:0},!1,"java.math.MathContext",{MM:1,d:1});function Cf(){this.XE=null}Cf.prototype=new m;Cf.prototype.constructor=Cf;Cf.prototype.b=function(){Df=this;Ef();var a=Ff().Uw,b=new Bf;b.hi=34;b.or=a;this.XE=b;Ef();Ff();Ef();Ff();Ef();Ff();return this};Cf.prototype.$classData=h({NM:0},!1,"java.math.MathContext$",{NM:1,d:1});var Df=void 0;function Ef(){Df||(Df=(new Cf).b());return Df}function Gf(){this.Ko=this.Lo=this.NA=null}Gf.prototype=new m;Gf.prototype.constructor=Gf;
Gf.prototype.b=function(){Hf=this;this.NA=oba(10,10);oba(14,5);this.Lo=ma(ab(Ve),[32]);this.Ko=ma(ab(Ve),[32]);var a;var b=1;for(var d=a=0;32>d;){var e=d;if(18>=e){of().Ko.j[e]=wf(af(),(new Fa).fa(b,a));var f=of().Lo,g=af(),k=b,l=a;f.j[e]=wf(g,(new Fa).fa(0===(32&e)?k<<e:0,0===(32&e)?(k>>>1|0)>>>(31-e|0)|0|l<<e:k<<e));e=b;b=e>>>16|0;e=da(5,65535&e);f=da(5,b);b=e+(f<<16)|0;e=(e>>>16|0)+f|0;a=da(5,a)+(e>>>16|0)|0}else of().Ko.j[e]=If(of().Ko.j[-1+e|0],of().Ko.j[1]),of().Lo.j[e]=If(of().Lo.j[-1+e|0],
af().sq);d=1+d|0}return this};
function pba(a,b,d){for(var e,f=0;f<b;){var g=f;e=0;for(var k=1+g|0;k<b;){var l=k;of();var n=a.j[g],t=a.j[l],u=d.j[g+l|0],w=65535&n;n=n>>>16|0;var y=65535&t;t=t>>>16|0;var E=da(w,y);y=da(n,y);var L=da(w,t);w=E+((y+L|0)<<16)|0;E=(E>>>16|0)+L|0;n=(da(n,t)+(E>>>16|0)|0)+(((65535&E)+y|0)>>>16|0)|0;u=w+u|0;n=(-2147483648^u)<(-2147483648^w)?1+n|0:n;e=u+e|0;u=(-2147483648^e)<(-2147483648^u)?1+n|0:n;d.j[g+l|0]=e;e=u;k=1+k|0}d.j[g+b|0]=e;f=1+f|0}gba(ef(),d,d,b<<1);for(g=f=e=0;f<b;)t=a.j[f],u=a.j[f],l=d.j[g],
k=e,n=65535&t,e=t>>>16|0,w=65535&u,u=u>>>16|0,t=da(n,w),w=da(e,w),E=da(n,u),n=t+((w+E|0)<<16)|0,t=(t>>>16|0)+E|0,e=(da(e,u)+(t>>>16|0)|0)+(((65535&t)+w|0)>>>16|0)|0,l=n+l|0,e=(-2147483648^l)<(-2147483648^n)?1+e|0:e,k=l+k|0,l=(-2147483648^k)<(-2147483648^l)?1+e|0:e,d.j[g]=k,g=1+g|0,k=l+d.j[g]|0,l=(-2147483648^k)<(-2147483648^l)?1:0,d.j[g]=k,e=l,f=1+f|0,g=1+g|0;return d}
function oba(a,b){var d=[];if(0<a){var e=1,f=1,g=e;for(d.push(null===g?0:g);f<a;)e=da(e|0,b),f=1+f|0,g=e,d.push(null===g?0:g)}return la(ab(hb),d)}
function Jf(a,b,d){if(d.cc>b.cc)var e=d;else e=b,b=d;var f=e,g=b;if(63>g.cc){e=f.cc;b=g.cc;d=e+b|0;a=f.Yb!==g.Yb?-1:1;if(2===d){e=f.zb.j[0];b=g.zb.j[0];d=65535&e;e=e>>>16|0;g=65535&b;b=b>>>16|0;f=da(d,g);g=da(e,g);var k=da(d,b);d=f+((g+k|0)<<16)|0;f=(f>>>16|0)+k|0;e=(da(e,b)+(f>>>16|0)|0)+(((65535&f)+g|0)>>>16|0)|0;a=0===e?(new vf).fa(a,d):Ze(a,2,la(ab(hb),[d,e]))}else{f=f.zb;g=g.zb;k=ma(ab(hb),[d]);if(0!==e&&0!==b)if(1===e)k.j[b]=Kf(0,k,g,b,f.j[0]);else if(1===b)k.j[e]=Kf(0,k,f,e,g.j[0]);else if(f===
g&&e===b)pba(f,e,k);else for(var l=0;l<e;){var n=l;var t=0;for(var u=f.j[n],w=0;w<b;){var y=w;of();var E=g.j[y],L=k.j[n+y|0],S=65535&u,ia=u>>>16|0,na=65535&E;E=E>>>16|0;var pa=da(S,na);na=da(ia,na);var ua=da(S,E);S=pa+((na+ua|0)<<16)|0;pa=(pa>>>16|0)+ua|0;ia=(da(ia,E)+(pa>>>16|0)|0)+(((65535&pa)+na|0)>>>16|0)|0;L=S+L|0;ia=(-2147483648^L)<(-2147483648^S)?1+ia|0:ia;t=L+t|0;L=(-2147483648^t)<(-2147483648^L)?1+ia|0:ia;k.j[n+y|0]=t;t=L;w=1+w|0}k.j[n+b|0]=t;l=1+l|0}a=Ze(a,d,k);$e(a)}return a}e=(-2&f.cc)<<
4;d=Lf(f,e);k=Lf(g,e);b=Mf(d,e);l=xf(yf(),f,b);b=Mf(k,e);g=xf(yf(),g,b);f=Jf(a,d,k);b=Jf(a,l,g);a=Jf(a,xf(yf(),d,l),xf(yf(),g,k));d=f;a=uf(yf(),a,d);a=uf(yf(),a,b);a=Mf(a,e);e=f=Mf(f,e<<1);a=uf(yf(),e,a);return uf(yf(),a,b)}
function Kf(a,b,d,e,f){var g;for(a=g=0;a<e;){var k=a;of();var l=d.j[k],n=65535&l;l=l>>>16|0;var t=65535&f,u=f>>>16|0,w=da(n,t);t=da(l,t);var y=da(n,u);n=w+((t+y|0)<<16)|0;w=(w>>>16|0)+y|0;l=(da(l,u)+(w>>>16|0)|0)+(((65535&w)+t|0)>>>16|0)|0;g=n+g|0;l=(-2147483648^g)<(-2147483648^n)?1+l|0:l;b.j[k]=g;g=l;a=1+a|0}return g}
function Nf(a,b){var d=a.Lo.j.length,e=d>>31,f=b.na;if(f===e?(-2147483648^b.ga)<(-2147483648^d):f<e)return a.Lo.j[b.ga];d=b.na;if(0===d?-2147483598>=(-2147483648^b.ga):0>d)return Of(af().sq,b.ga);d=b.na;if(0===d?-1>=(-2147483648^b.ga):0>d)return Mf(Of(a.Ko.j[1],b.ga),b.ga);var g=Of(a.Ko.j[1],2147483647);d=g;f=b.na;var k=-2147483647+b.ga|0;e=k;k=1>(-2147483648^k)?f:-1+f|0;for(f=Pf(Wa(),b.ga,b.na,2147483647,0);;){var l=e,n=k;if(0===n?-1<(-2147483648^l):0<n)d=If(d,g),e=-2147483647+e|0,k=1>(-2147483648^
e)?k:-1+k|0;else break}d=If(d,Of(a.Ko.j[1],f));d=Mf(d,2147483647);a=b.na;e=b=-2147483647+b.ga|0;for(k=1>(-2147483648^b)?a:-1+a|0;;)if(b=e,a=k,0===a?-1<(-2147483648^b):0<a)d=Mf(d,2147483647),b=k,a=-2147483647+e|0,b=1>(-2147483648^a)?b:-1+b|0,e=a,k=b;else break;return Mf(d,f)}Gf.prototype.$classData=h({OM:0},!1,"java.math.Multiplication$",{OM:1,d:1});var Hf=void 0;function of(){Hf||(Hf=(new Gf).b());return Hf}function Qf(){this.qk=this.mK=null;this.a=0}Qf.prototype=new m;Qf.prototype.constructor=Qf;
Qf.prototype.b=function(){Rf=this;this.mK="\x3cBREEDS?\x3e";this.a=(1|this.a)<<24>>24;A();for(var a=[(new Sf).Qd("CREATE-ORDERED-\x3cBREEDS\x3e",Tf(),"_createorderedturtles"),(new Sf).Qd("CREATE-\x3cBREEDS\x3e",Tf(),"_createturtles"),(new Sf).Qd("HATCH-\x3cBREEDS\x3e",Tf(),"_hatch"),(new Sf).Qd("SPROUT-\x3cBREEDS\x3e",Tf(),"_sprout"),(new Sf).Qd("\x3cBREEDS\x3e",Uf(),"_breed"),(new Sf).Qd("\x3cBREEDS\x3e-AT",Uf(),"etc._breedat"),(new Sf).Qd("\x3cBREEDS\x3e-HERE",Uf(),"etc._breedhere"),(new Sf).Qd("\x3cBREEDS\x3e-ON",
Uf(),"etc._breedon"),(new Sf).Qd("\x3cBREED\x3e",Uf(),"etc._breedsingular"),(new Sf).Qd("IS-\x3cBREED\x3e?",Uf(),"etc._isbreed"),(new Vf).Qd("CREATE-\x3cBREEDS\x3e-FROM",Tf(),"etc._createlinksfrom"),(new Vf).Qd("CREATE-\x3cBREED\x3e-FROM",Tf(),"etc._createlinkfrom"),(new Vf).Qd("CREATE-\x3cBREEDS\x3e-TO",Tf(),"etc._createlinksto"),(new Wf).Qd("CREATE-\x3cBREEDS\x3e-WITH",Tf(),"etc._createlinkswith"),(new Vf).Qd("CREATE-\x3cBREED\x3e-TO",Tf(),"etc._createlinkto"),(new Wf).Qd("CREATE-\x3cBREED\x3e-WITH",
Tf(),"etc._createlinkwith"),(new Xf).Qd("IN-\x3cBREED\x3e-FROM",Uf(),"etc._inlinkfrom"),(new Xf).Qd("IN-\x3cBREED\x3e-NEIGHBOR?",Uf(),"etc._inlinkneighbor"),(new Xf).Qd("IN-\x3cBREED\x3e-NEIGHBORS",Uf(),"etc._inlinkneighbors"),(new Xf).Qd("IS-\x3cBREED\x3e?",Uf(),"etc._isbreed"),(new Xf).Qd("\x3cBREEDS\x3e",Uf(),"etc._linkbreed"),(new Xf).Qd("\x3cBREED\x3e",Uf(),"etc._linkbreedsingular"),(new Xf).Qd("\x3cBREED\x3e-NEIGHBOR?",Uf(),"etc._linkneighbor"),(new Xf).Qd("\x3cBREED\x3e-NEIGHBORS",Uf(),"etc._linkneighbors"),
(new Xf).Qd("\x3cBREED\x3e-WITH",Uf(),"etc._linkwith"),(new Xf).Qd("MY-IN-\x3cBREEDS\x3e",Uf(),"etc._myinlinks"),(new Xf).Qd("MY-\x3cBREEDS\x3e",Uf(),"etc._mylinks"),(new Xf).Qd("MY-OUT-\x3cBREEDS\x3e",Uf(),"etc._myoutlinks"),(new Xf).Qd("OUT-\x3cBREED\x3e-NEIGHBOR?",Uf(),"etc._outlinkneighbor"),(new Xf).Qd("OUT-\x3cBREED\x3e-NEIGHBORS",Uf(),"etc._outlinkneighbors"),(new Xf).Qd("OUT-\x3cBREED\x3e-TO",Uf(),"etc._outlinkto")],b=-1+(a.length|0)|0,d=v();0<=b;)d=K(a[b],d),b=-1+b|0;this.qk=d;this.a=(2|
this.a)<<24>>24;return this};function qba(a,b,d){return Pb(Na(),Pb(Na(),d.ee,"\x3cBREEDS\x3e",b.am.pa),"\x3cBREED\x3e",b.eg.pa)}function Yf(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/BreedIdentifierHandler.scala: 16");return a.qk}function rba(a,b,d){return b.jh&&b.ih?(new ag).$u(a,d):b.jh?(new bg).$u(a,d):(new cg).$u(a,d)}
function paa(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/BreedIdentifierHandler.scala: 14");return a.mK}function sba(a,b){var d=Yf(a);a=tba(a,b,Uf()).bk(p(function(e,f){return function(g){return qba(Qb(),f,g)}}(a,b)));b=A();return d.ic(a,b.P)}
function tba(a,b,d){return rba(d,b,p(function(){return function(e){var f=Qb();f="^"+paa(f)+"$";if(null===e)throw(new xe).b();var g=dg();f=eg(g,f);return!uba(fg(f,e,Qa(e)))}}(a)))}function vba(a,b){var d=Yf(a);a=tba(a,b,Tf()).bk(p(function(e,f){return function(g){return qba(Qb(),f,g)}}(a,b)));b=A();return d.ic(a,b.P)}
function wba(a,b,d){return Yf(a).Yc().Ti(p(function(e,f,g){return function(k){var l=f.W;l=gg(k.Hy(),l);if(l.x())n=!1;else if(null!==l.Q()){n=l.Q();var n=0===hg(n,1)}else n=!1;if(n){l=l.Q().R(0);n=k.Ix(g).Pr();var t=new ig;if(null===k)throw jg(kg(),null);t.Ta=k;t.cr=l;k=lg(n,t)}else k=D();return k.gb()}}(a,b,d)),mg().$b).zg()}Qf.prototype.$classData=h({ZM:0},!1,"org.nlogo.core.BreedIdentifierHandler$",{ZM:1,d:1});var Rf=void 0;function Qb(){Rf||(Rf=(new Qf).b());return Rf}function ng(){}
ng.prototype=new m;ng.prototype.constructor=ng;ng.prototype.b=function(){return this};function xba(a,b){if(og(b))return(new pg).c(b);if("number"===typeof b)return qg(b);if("boolean"===typeof b)return yba(b);if(b instanceof rg)return zba(b);throw jg(kg(),(new sg).c("Invalid chooser option "+b));}ng.prototype.$classData=h({iN:0},!1,"org.nlogo.core.Chooseable$",{iN:1,d:1});var tg=void 0;function Aba(){tg||(tg=(new ng).b());return tg}
function ug(){this.SE=null;this.PG=this.ME=0;this.TE=null;this.a=0}ug.prototype=new m;ug.prototype.constructor=ug;
ug.prototype.b=function(){vg=this;this.SE=la(ab(sa),"gray red orange brown yellow green lime turquoise cyan sky blue violet magenta pink black white".split(" "));this.a=(1|this.a)<<24>>24;this.ME=0;this.a=(2|this.a)<<24>>24;this.PG=9.9;this.a=(4|this.a)<<24>>24;if(0===(2&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/ColorConstants.scala: 16");var a=[5,15,25,35,45,55,65,75,85,95,105,115,125,135,this.ME,Bba(this)],b=(new M).q(a);a=
b.wa.length|0;a=ma(ab(mb),[a]);var d=0;for(b=wg(b,0,b.wa.length|0);b.qa();){var e=b.ma();a.j[d]=+e;d=1+d|0}this.TE=a;this.a=(8|this.a)<<24>>24;return this};function Bba(a){if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/ColorConstants.scala: 17");return a.PG}
function Cba(){var a=xg();if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/ColorConstants.scala: 8");return a.SE}function Dba(a,b){if(0===(8&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/ColorConstants.scala: 19");return a.TE.j[b]}ug.prototype.$classData=h({tN:0},!1,"org.nlogo.core.ColorConstants$",{tN:1,d:1});var vg=void 0;
function xg(){vg||(vg=(new ug).b());return vg}
var Fba=function Eba(a,b){if(og(b))return'"'+yg(zg(),b)+'"';if("boolean"===typeof b)return b?"true":"false";if(b instanceof Ag){a=function(k){return function(l){return Eba(k,l)}}(a);var e=A().P;if(e===A().P)if(b===v())a=v();else{e=b.Y();var f=e=K(a(e),v());for(b=b.X();b!==v();){var g=b.Y();g=K(a(g),v());f=f.Da=g;b=b.X()}a=e}else{for(e=Oc(b,e);!b.x();)f=b.Y(),e.Ka(a(f)),b=b.X();a=e.Ea()}return a.od("["," ","]")}if(b instanceof rg){e=A().P;b=Bg(b,e);a=function(k){return function(l){return Eba(k,l)}}(a);
e=A().P;if(e===A().P)if(b===v())a=v();else{e=b.Y();f=e=K(a(e),v());for(b=b.X();b!==v();)g=b.Y(),g=K(a(g),v()),f=f.Da=g,b=b.X();a=e}else{for(e=Oc(b,e);!b.x();)f=b.Y(),e.Ka(a(f)),b=b.X();a=e.Ea()}return a.od("["," ","]")}if(null!==b)return oa(b);throw(new q).i(b);};function Dg(){this.f=null}Dg.prototype=new m;Dg.prototype.constructor=Dg;Dg.prototype.ag=function(a){this.f=a;return this};Dg.prototype.$classData=h({DN:0},!1,"org.nlogo.core.ErrorSource",{DN:1,d:1});function Eg(){}Eg.prototype=new m;
Eg.prototype.constructor=Eg;Eg.prototype.b=function(){return this};function Fg(a,b,d,e){throw(new pd).Xs(a,b,d,e);}Eg.prototype.$classData=h({EN:0},!1,"org.nlogo.core.Fail$",{EN:1,d:1});var Gba=void 0;function Gg(){Gba||(Gba=(new Eg).b())}function Hg(){this.kG=null;this.a=!1}Hg.prototype=new m;Hg.prototype.constructor=Hg;Hg.prototype.b=function(){Ig=this;this.kG=Jg(Kg(),v());this.a=!0;return this};
function Lg(){Ig||(Ig=(new Hg).b());var a=Ig;if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/FrontEndInterface.scala: 12");return a.kG}Hg.prototype.$classData=h({FN:0},!1,"org.nlogo.core.FrontEndInterface$",{FN:1,d:1});var Ig=void 0;function Mg(){this.lp=null;this.a=this.va=!1}Mg.prototype=new m;Mg.prototype.constructor=Mg;Mg.prototype.b=function(){return this};
function Ng(){Og||(Og=(new Mg).b());var a=Og;if(!a.va&&!a.va){for(var b=[(new z).e("org.nlogo.agent.Topology.cantMoveTurtleBeyondWorldEdge","Cannot move turtle beyond the world''s edge."),(new z).e("org.nlogo.prim.etc.$common.indexExceedsListSize","Can''t find element {0} of the list {1}, which is only of length {2}."),(new z).e("org.nlogo.prim._min.cantFindMinOfListWithNoNumbers","Can''t find the minimum of a list with no numbers: {0}"),(new z).e("org.nlogo.prim._returnreport.reportNotCalledInReportProcedure",
"Reached end of reporter procedure without REPORT being called."),(new z).e("org.nlogo.prim.$common.agentKind.link","a link"),(new z).e("org.nlogo.workspace.DefaultFileManager.cannotDeleteNonExistantFile","You cannot delete a non-existent file."),(new z).e("org.nlogo.prim.etc._sublist.endIsLessThanStart","{0} is less than {1}."),(new z).e("org.nlogo.prim.etc.$common.firstInputCantBeNegative","First input to {0} can''t be negative."),(new z).e("org.nlogo.prim.$common.onlyObserverCanAskAllPatches",
"Only the observer can ASK the set of all patches."),(new z).e("org.nlogo.prim.$common.agentKind.turtle","a turtle"),(new z).e("org.nlogo.prim.etc._setDefaultShape.notADefinedTurtleShape",'"{0}" is not a currently defined turtle shape.'),(new z).e("org.nlogo.prim.etc._randomgamma.noNegativeInputs","Both inputs to {0} must be positive."),(new z).e("org.nlogo.prim.etc._substring.endIsGreaterThanListSize","{0} is too big for {1}, which is only of length {2}."),(new z).e("org.nlogo.agent.Turtle.cantChangeWho",
"You can''t change a turtle''s ID number."),(new z).e("org.nlogo.prim.etc._setDefaultShape.notADefinedLinkShape",'"{0}" is not a currently defined link shape.'),(new z).e("org.nlogo.agent.Turtle.cantAccessLinkWithoutSpecifyingLink","A turtle can''t access a link variable without specifying which link."),(new z).e("org.nlogo.prim.etc._otherend.onlyTurtleCanGetLinkEnd","Only a turtle can get the OTHER-END of a link."),(new z).e("org.nlogo.prim.etc._setdefaultshape.canOnlySetDefaultShapeOfEntireBreed",
"Can only set the default shape of all turtles , all links, or an entire breed."),(new z).e("org.nlogo.agent.Patch.cantAccessTurtleWithoutSpecifyingTurtle","A patch can''t access a turtle variable without specifying which turtle."),(new z).e("org.nlogo.prim.etc._otherend.incorrectLink","{0} is not linked by {1}."),(new z).e("org.nlogo.prim.lambda.missingInputs","anonymous procedure expected {0} inputs, but only got {1}"),(new z).e("org.nlogo.prim.etc.$common.divByZero","Division by zero."),(new z).e("org.nlogo.agent.Turtle.patchBeyondLimits",
"Cannot get patch beyond limits of current world."),(new z).e("compiler.StructureParser.includeNotFound","Could not find {0}"),(new z).e("org.nlogo.prim.etc._foreach.listsMustBeSameLength","All the list arguments to FOREACH must be the same length."),(new z).e("org.nlogo.prim.$common.invalidAgentKind.alternative","this code can''t be run by {0}, only {1}"),(new z).e("org.nlogo.$common.tooBigForInt","{0} is too large to be represented exactly as an integer in NetLogo."),(new z).e("compiler.Backifier.replaced",
"{0} is no longer a primitive, use {1} instead."),(new z).e("org.nlogo.agent.Patch.cantAccessTurtleOrLinkWithoutSpecifyingAgent","A patch can''t access a turtle or link variable without specifying which agent."),(new z).e("org.nlogo.workspace.DefaultFileManager.noOpenFile","No file has been opened."),(new z).e("org.nlogo.prim.etc._resizeworld.worldMustIncludeOrigin","You must include the point (0, 0) in the world."),(new z).e("org.nlogo.agent.ImportPatchColors.unsupportedImageFormat","The following file is not in a supported image format: {0}"),
(new z).e("org.nlogo.agent.Agent.rgbValueError","RGB values must be 0-255"),(new z).e("org.nlogo.prim.etc._mean.cantFindMeanOfListWithNoNumbers","Can''t find the mean of a list with no numbers: {0}."),(new z).e("org.nlogo.prim.etc._linkset.invalidListInputs","List inputs to {0} must only contain link, link agentset, or list elements.  The list {1} contained {2} which is NOT a link or link agentset."),(new z).e("org.nlogo.prim.etc.$common.emptyList","List is empty."),(new z).e("org.nlogo.agent.Patch.cantChangePatchCoordinates",
"You can''t change a patch''s coordinates."),(new z).e("org.nlogo.prim._reduce.emptyListInvalidInput","The list argument to 'reduce' must not be empty."),(new z).e("org.nlogo.prim.$common.agentKind.observer","the observer"),(new z).e("org.nlogo.agent.Agent.shapeUndefined",'"{0}" is not a currently defined shape.'),(new z).e("org.nlogo.prim.etc._importdrawing.cantImportDrawingin3D","You can''t import drawing in 3D."),(new z).e("org.nlogo.prim.etc._sublist.startIsLessThanZero","{0} is less than zero."),
(new z).e("org.nlogo.agent.Protractor.noHeadingFromPointToSelf","No heading is defined from a point ({0},{1}) to that same point."),(new z).e("org.nlogo.agent.Patch.cantAccessLinkVarWithoutSpecifyingLink","A patch can''t access a link variable without specifying which link."),(new z).e("org.nlogo.prim.$common.onlyObserverCanAskAllTurtles","Only the observer can ASK the set of all turtles."),(new z).e("org.nlogo.prim.etc._exportoutput.emptyPath","Can''t export to empty pathname."),(new z).e("org.nlogo.prim.$common.noSumOfListWithNonNumbers",
"Can''t find the sum of a list that contains non-numbers {0} is a {1}."),(new z).e("org.nlogo.prim._greaterorequal.cannotCompareParameters","The \x3e\x3d operator can only be used on two numbers, two strings, or two agents of the same type, but not on {0} and {1}."),(new z).e("org.nlogo.agent.Agent.rgbListSizeError.3or4","An rgb list must contain 3 or 4 numbers 0-255"),(new z).e("org.nlogo.prim.etc.$common.emptyString","String is empty."),(new z).e("org.nlogo.prim.etc.$common.cantTakeLogarithmOf",
"Can''t take logarithm of {0}."),(new z).e("org.nlogo.prim.etc._sublist.endIsGreaterThanListSize","{0} is greater than the length of the input list ({1})."),(new z).e("org.nlogo.prim.etc._setxy.pointOutsideWorld","The point [ {0} , {1} ] is outside of the boundaries of the world and wrapping is not permitted in one or both directions."),(new z).e("org.nlogo.prim.etc._patchset.listInputNonPatchAgentset","List inputs to {0} must only contain patch, patch agentset, or list elements.  The list {1} contained a different type agentset: {2}."),
(new z).e("org.nlogo.prim.etc.$common.expectedTurtleOrPatchButGotLink","Expected a turtle or a patch but got a link."),(new z).e("org.nlogo.prim.etc.$common.syntaxError","Syntax Error: {0}"),(new z).e("org.nlogo.agent.Agent.cantSetUnknownVariable","Unknown variable {0}."),(new z).e("org.nlogo.prim.etc._myself.noAgentMyself","There is no agent for MYSELF to refer to."),(new z).e("org.nlogo.prim.$common.paramOutOfBounds","{0} is not in the range 0.0 to 1.0"),(new z).e("org.nlogo.prim.etc.$common.emptyStringInput",
"{0} got an empty string as input."),(new z).e("org.nlogo.prim.etc._median.emptyList","Can''t find the median of a list with no numbers: {0}."),(new z).e("org.nlogo.prim.$common.invalidAgentKind.simple","this code can''t be run by {0}"),(new z).e("compiler.SetVisitor.notSettable","This isn''t something you can use \"set\" on."),(new z).e("org.nlogo.prim.etc.$common.noNegativeAngle","{0} cannot take a negative angle."),(new z).e("org.nlogo.prim.etc.$common.indexExceedsStringSize","Can''t find element {0} of the string {1}, which is only of length {2}."),
(new z).e("org.nlogo.prim._report.canOnlyUseInToReport","{0} can only be used inside TO-REPORT."),(new z).e("org.nlogo.prim.etc.$common.noNegativeRadius","{0} cannot take a negative radius."),(new z).e("compiler.StructureConverter.noBreed",'There is no breed "{0}"'),(new z).e("org.nlogo.agent.Agent.rgbListSizeError.3","An rgb list must contain 3 numbers 0-255"),(new z).e("org.nlogo.prim._report.mustImmediatelyBeUsedInToReport","{0} must be immediately inside a TO-REPORT."),(new z).e("org.nlogo.$common.thatAgentIsDead",
"That {0} is dead."),(new z).e("org.nlogo.prim.etc._layoutcircle.patchesImmovable","Patches are immovable."),(new z).e("org.nlogo.prim.etc._patchset.listInputNonPatch","List inputs to {0} must only contain patch, patch agentset, or list elements.  The list {1} contained {2} which is NOT a patch or patch agentset."),(new z).e("org.nlogo.prim.etc._turtleset.incorrectInputType","List inputs to {0} must only contain turtle, turtle agentset, or list elements.  The list {1} contained {2} which is NOT a turtle or turtle agentset."),
(new z).e("org.nlogo.prim.etc.$common.notThatManyAgentsExist","Requested {0} random agents from a set of only {1} agents."),(new z).e("org.nlogo.prim.etc.median.cantFindMedianOfListWithNoNumbers","Can''t find the median of a list with no numbers: {0}."),(new z).e("org.nlogo.prim.etc.$common.noNegativeNumber","{0} cannot take a negative number."),(new z).e("org.nlogo.prim._lessorequal.cannotCompareParameters","The \x3c\x3d operator can only be used on two numbers, two strings, or two agents of the same type, but not on {0} and {1}."),
(new z).e("org.nlogo.prim.etc.$common.negativeIndex","{0} isn''t greater than or equal to zero."),(new z).e("org.nlogo.prim.etc._runresult.failedToReportResult","Failed to report a result."),(new z).e("org.nlogo.prim._max.cantFindMaxOfListWithNoNumbers","Can''t find the maximum of a list with no numbers: {0}"),(new z).e("org.nlogo.prim.etc._turtleset.listInputsMustBeTurtleOrTurtleAgentset","List inputs to {0} must only contain turtle, turtle agentset, or list elements.  The list {1} contained a different type agentset: {2}."),
(new z).e("org.nlogo.prim.$common.expectedBooleanValue","{0} expected a true/false value from {1}, but got {2} instead."),(new z).e("org.nlogo.prim.etc._linkheading.noLinkHeadingWithSameEndpoints","There is no heading of a link whose endpoints are in the same position."),(new z).e("org.nlogo.agent.Patch.pcolorNotADouble","Pcolor is not a double."),(new z).e("org.nlogo.prim.lambda.missingInput","anonymous procedure expected 1 input, but only got 0"),(new z).e("org.nlogo.prim.etc._randomNormal.secondInputNotNegative",
"random-normal''s second input can''t be negative."),(new z).e("org.nlogo.prim.etc._range.zeroStep","The step-size for range must be non-zero."),(new z).e("org.nlogo.prim.etc._setdefaultshape.cantSetDefaultShapeOfPatch","Cannot set the default shape of patches, because patches do not have shapes."),(new z).e("org.nlogo.prim.etc.$common.emptyListInput","{0} got an empty list as input."),(new z).e("org.nlogo.plot.noPlotSelected","There is no current plot. Please select a current plot using the set-current-plot command."),
(new z).e("org.nlogo.workspace.DefaultFileManager.canOnlyDeleteFiles","You can only delete files."),(new z).e("compiler.TaskVisitor.notDefined","This special variable isn''t defined here."),(new z).e("org.nlogo.prim.etc.$common.tickCounterNotStarted","The tick counter has not been started yet. Use RESET-TICKS."),(new z).e("org.nlogo.agent.Link.cantSetBreedToNonLinkBreedAgentSet","You can''t set BREED to a non-link-breed agentset."),(new z).e("org.nlogo.prim.etc._log.notAValidBase","{0} isn''t a valid base for a logarithm."),
(new z).e("org.nlogo.agent.BooleanConstraint.bool","Value must be a boolean."),(new z).e("compiler.LocalsVisitor.notDefined","Nothing named {0} has been defined."),(new z).e("org.nlogo.prim.$common.withExpectedBooleanValue","WITH expected a true/false value from {0}, but got {1} instead."),(new z).e("org.nlogo.prim.$common.turtleCantLinkToSelf","A turtle cannot link to itself."),(new z).e("compiler.LetVariable.notDefined","Nothing named {0} has been defined."),(new z).e("org.nlogo.prim.etc._standarddeviation.needListGreaterThanOneItem",
"Can''t find the standard deviation of a list without at least two numbers: {0}"),(new z).e("fileformat.invalidversion",'Invalid NetLogo file. Expected "{0}" formatted model to have version compatible with {1}, but this model had version {2}'),(new z).e("org.nlogo.prim.etc.$common.noAngleGreaterThan360","{0} cannot take an angle greater than 360."),(new z).e("org.nlogo.agent.ChooserConstraint.invalidValue","Value must be one of: {0}"),(new z).e("org.nlogo.agent.Protractor.noHeadingFromAgentToSelf",
"No heading is defined from an agent to itself."),(new z).e("org.nlogo.prim._askconcurrent.onlyObserverCanAskAllTurtles","only the observer can ASK the set of all turtles"),(new z).e("org.nlogo.prim.etc.$common.requestMoreItemsThanInList","Requested {0} random items from a list of length {1}."),(new z).e("org.nlogo.prim.etc._sqrt.squareRootIsImaginary","The square root of {0} is an imaginary number."),(new z).e("org.nlogo.prim.etc._otherend.onlyLinkCanGetTurtleEnd","Only a link can get the OTHER-END from a turtle."),
(new z).e("org.nlogo.agent.Agent.wrongTypeOnSetError","can''t set {0} variable {1} to non-{2} {3}"),(new z).e("org.nlogo.agent.Agent.breedDoesNotOwnVariable","{0} breed does not own variable {1}"),(new z).e("org.nlogo.prim._lessthan.cantUseLessthanOnDifferentArgs","The \x3c operator can only be used on two numbers, two strings, or two agents of the same type, but not on {0} and {1}."),(new z).e("org.nlogo.prim.etc._stop.notAllowedInsideToReport","{0} is not allowed inside TO-REPORT."),(new z).e("org.nlogo.prim.etc._linkset.invalidLAgentsetTypeInputToList",
"List inputs to {0} must only contain link, link agentset, or list elements.  The list {1} contained a different type agentset: {2}."),(new z).e("compiler.CarefullyVisitor.badNesting","{0} cannot be used outside of CAREFULLY."),(new z).e("org.nlogo.prim.etc._tickadvance.noNegativeTickAdvances","Cannot advance the tick counter by a negative amount."),(new z).e("org.nlogo.agent.Link.cantHaveBreededAndUnbreededLinks","You cannot have both breeded and unbreeded links in the same world."),(new z).e("org.nlogo.prim.etc._variance.listMustHaveMoreThanOneNumber",
"Can''t find the variance of a list without at least two numbers: {0}."),(new z).e("org.nlogo.prim.etc._atpoints.invalidListOfPoints","Invalid list of points: {0}"),(new z).e("org.nlogo.agent.Agent.cantMoveToLink","You can''t move-to a link."),(new z).e("org.nlogo.agent.Patch.cantSetTurtleWithoutSpecifyingTurtle","A patch can''t set a turtle variable without specifying which turtle."),(new z).e("org.nlogo.prim._greaterthan.cannotCompareParameters","The \x3e operator can only be used on two numbers, two strings, or two agents of the same type, but not on {0} and {1}."),
(new z).e("org.nlogo.agent.Agent.notADoubleVariable","{0} is not a double variable."),(new z).e("org.nlogo.prim.etc.atan.bothInputsCannotBeZero","atan is undefined when both inputs are zero."),(new z).e("org.nlogo.prim.$common.agentKind.patch","a patch"),(new z).e("org.nlogo.prim.etc.$common.expectedLastInputToBeLinkBreed","Expected the last input to be a link breed."),(new z).e("org.nlogo.agent.Turtle.cantSetBreedToNonBreedAgentSet","You can''t set BREED to a non-breed agentset.")],d=(new dc).vb(ec()),
e=0,f=b.length|0;e<f;)fc(d,b[e]),e=1+e|0;b=new Pg;b.Dm=d.La;a.lp=b;a.va=!0}return a.lp}Mg.prototype.$classData=h({HN:0},!1,"org.nlogo.core.I18N$",{HN:1,d:1});var Og=void 0;function Pg(){this.Dm=null}Pg.prototype=new m;Pg.prototype.constructor=Pg;Pg.prototype.$classData=h({IN:0},!1,"org.nlogo.core.I18N$BundleKind",{IN:1,d:1});function Qg(a){return a.E().Qb.toUpperCase()}function N(a){a.G(null);a.K(a.A().g);a.L(a.A().n)}function Rg(a,b){var d=a.E();b.G(Sg(d,b,d.Qb,d.tb));b.K(a.H());return b}
function Tg(){this.CJ=null;this.a=!1}Tg.prototype=new m;Tg.prototype.constructor=Tg;Tg.prototype.b=function(){Ug=this;this.CJ=H(Ke().rm,(new M).q("TO TO-REPORT END GLOBALS TURTLES-OWN LINKS-OWN PATCHES-OWN DIRECTED-LINK-BREED UNDIRECTED-LINK-BREED EXTENSIONS __INCLUDES".split(" ")));this.a=!0;return this};Tg.prototype.$classData=h({KN:0},!1,"org.nlogo.core.Keywords$",{KN:1,d:1});var Ug=void 0;function Vg(){}Vg.prototype=new m;Vg.prototype.constructor=Vg;Vg.prototype.b=function(){return this};
Vg.prototype.$classData=h({XN:0},!1,"org.nlogo.core.Nobody$",{XN:1,d:1});var Wg=void 0;function Xg(){Wg||(Wg=(new Vg).b());return Wg}function Yg(){this.eK=this.pF=this.uF=this.tF=null;this.a=0}Yg.prototype=new m;Yg.prototype.constructor=Yg;
Yg.prototype.b=function(){Zg=this;this.tF="Number too large";this.a=(1|this.a)<<24>>24;this.uF="is too large to be represented exactly as an integer in NetLogo";this.a=(2|this.a)<<24>>24;this.pF="Illegal number format";this.a=(4|this.a)<<24>>24;this.eK=(new Ub).Bp("^-?[0-9]*(\\.[0-9]*)?([Ee]-?[0-9]+)?$",(new M).q([]));this.a=(8|this.a)<<24>>24;return this};
function ch(a,b){try{var d=(new Sb).c(b).U.length|0;if(0<d){var e=0;45===(65535&(b.charCodeAt(e)|0))&&(e=1+e|0);e<d&&46===(65535&(b.charCodeAt(e)|0))&&(e=1+e|0);if(e<d)var f=65535&(b.charCodeAt(e)|0),g=dh(eh(),f);else g=!1}else g=!1;if(g){var k=fh(gh(),b);if(Infinity===k||-Infinity===k){sc();if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/core/NumberParser.scala: 12");return(new hh).i(a.tF)}var l=(new Sb).c(".eE");for(d=0;;){if(d<(l.U.length|
0))var n=l.R(d),t=null===n?0:n.W,u=(new Sb).c(b),w=!1===ih(u,Le(t));else w=!1;if(w)d=1+d|0;else break}if(d!==(l.U.length|0))return sc(),(new jh).i(k);var y=Hba(kh(),b),E=y.ga,L=y.na;if((2097152===L?0!==E:2097152<L)||-2097152>L){sc();var S=b+" "+Iba(a);return(new hh).i(S)}sc();return(new jh).i(k)}sc();return(new hh).i("Illegal number format")}catch(ia){if(ia instanceof lh){if(0===(8&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/core/NumberParser.scala: 21");
k=fg(a.eK.Gf,b,Qa(b));if((mh(k)?(new I).i(nh(k)):D()).aa())return sc(),a=b+" "+Iba(a),(new hh).i(a);sc();if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/core/NumberParser.scala: 15");return(new hh).i(a.pF)}throw ia;}}function Iba(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/core/NumberParser.scala: 13");return a.uF}
Yg.prototype.$classData=h({YN:0},!1,"org.nlogo.core.NumberParser$",{YN:1,d:1});var Zg=void 0;function oh(){Zg||(Zg=(new Yg).b());return Zg}function ph(){this.a=0}ph.prototype=new m;ph.prototype.constructor=ph;ph.prototype.b=function(){qh=this;this.a=(1|this.a)<<24>>24;this.a=(2|this.a)<<24>>24;this.a=(4|this.a)<<24>>24;this.a=(8|this.a)<<24>>24;this.a=(16|this.a)<<24>>24;return this};ph.prototype.$classData=h({gO:0},!1,"org.nlogo.core.PlotPenInterface$",{gO:1,d:1});var qh=void 0;function rh(){}
rh.prototype=new m;rh.prototype.constructor=rh;rh.prototype.b=function(){return this};rh.prototype.Gb=function(a){return(new I).i((new $b).te(a.xe,a.ta,a.ja))};rh.prototype.$classData=h({nO:0},!1,"org.nlogo.core.ReporterApp$",{nO:1,d:1});var sh=void 0;function th(){sh||(sh=(new rh).b());return sh}function uh(){}uh.prototype=new m;uh.prototype.constructor=uh;uh.prototype.b=function(){return this};function vh(a,b){return(new I).i((new z).e(b.zl,b.ja))}
uh.prototype.$classData=h({pO:0},!1,"org.nlogo.core.ReporterBlock$",{pO:1,d:1});var wh=void 0;function xh(){wh||(wh=(new uh).b());return wh}function yh(){this.Vk=null;this.a=!1}yh.prototype=new m;yh.prototype.constructor=yh;yh.prototype.b=function(){zh=this;var a=Ke().rm,b=H(r(),(new M).q([0,1])),d=H(r(),(new M).q([1,0])),e=H(r(),(new M).q([2,2])),f=H(r(),(new M).q([4,4])),g=r();b=[b,d,e,f,H(g,(new M).q([4,4,2,2]))];this.Vk=H(a,(new M).q(b));this.a=!0;return this};
function Jba(){zh||(zh=(new yh).b());var a=zh;if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/Shape.scala: 60");return a.Vk}yh.prototype.$classData=h({rO:0},!1,"org.nlogo.core.Shape$LinkLine$",{rO:1,d:1});var zh=void 0;function Kba(a){var b=a.My();a=p(function(){return function(e){return e.Qc()}}(a));var d=r();return b.xa(a,d.P)}
function Lba(a){var b=a.My();a=p(function(){return function(e){return e.Mi()}}(a));var d=r();return b.xa(a,d.P)}function Ah(){this.a=0}Ah.prototype=new m;Ah.prototype.constructor=Ah;Ah.prototype.b=function(){return this};
function Mba(a,b){var d=r(),e=b.Ze(),f=b.hk,g=b.cD(),k=p(function(){return function(n){Bh();var t=n.OC()?"1":"0",u=r();t=[n.xE(),t];u=H(u,(new M).q(t));n=n.sB();t=r();return u.oc(n,t.P).Jb(" ")}}(a)),l=r();a=[e,f,g.xa(k,l.P).Jb("\n"),Nba(a,b.$B())];return H(d,(new M).q(a)).Jb("\n")}function Gh(a){return""+(a.vq<<24|a.kr<<16|a.Nq<<8|a.Aq)}
function Oba(a,b){if(b&&b.$classData&&b.$classData.Sb.iA){var d=r();b=["Circle",Gh(b.Bb),b.Jl(),b.fc,b.Lk,b.Mk,b.vB()];return H(d,(new M).q(b)).Jb(" ")}if(b&&b.$classData&&b.$classData.Sb.jA)return d=r(),b=["Line",Gh(b.Bb),b.fc,b.jw().Mi(),b.jw().Qc(),b.Ku().Mi(),b.Ku().Qc()],H(d,(new M).q(b)).Jb(" ");if(b&&b.$classData&&b.$classData.Sb.kA){d=H(r(),(new M).q(["Polygon",Gh(b.Bb),b.Jl(),b.fc]));b=b.My();a=p(function(){return function(f){return H(r(),(new M).q([f.Mi(),f.Qc()]))}}(a));var e=r();b=b.Ti(a,
e.P);a=r();return d.oc(b,a.P).Jb(" ")}if(b&&b.$classData&&b.$classData.Sb.lA)return d=r(),b=["Rectangle",Gh(b.Bb),b.Jl(),b.fc,b.Bw().Mi(),b.Bw().Qc(),b.Bv().Mi(),b.Bv().Qc()],H(d,(new M).q(b)).Jb(" ");throw(new q).i(b);}
function Pba(a,b){try{for(var d=!1,e=null,f=(new Sb).c(b),g=Hh(f,32),k=-1+g.j.length|0,l=v();0<=k;)l=K(g.j[k],l),k=-1+k|0;var n=l;if(n instanceof Ih){d=!0;e=n;var t=e.Da;if("Circle"===e.Ib&&t instanceof Ih){var u=t.Ib,w=t.Da;if(w instanceof Ih){var y=w.Ib,E=w.Da;if(E instanceof Ih){var L=E.Ib,S=E.Da;if(S instanceof Ih){var ia=S.Ib,na=S.Da;if(na instanceof Ih){var pa=na.Ib,ua=na.Da;if(ua instanceof Ih){var Ka=ua.Ib,Da=ua.Da;if(v().m(Da)){var Ha=(new Sb).c(u),kb=Jh(),lb=Kh(Lh(kb,Ha.U,10)),Tb=(new Sb).c(y),
Rb=Mh(Tb.U),ad=(new Sb).c(L),oc=Mh(ad.U),kd=(new Sb).c(ia),Sc=Lh(Jh(),kd.U,10),bd=(new Sb).c(pa),yc=Lh(Jh(),bd.U,10),kc=(new Sb).c(Ka),Bd=Jh();return(new Nh).fC(lb,Rb,oc,Sc,yc,Lh(Bd,kc.U,10))}}}}}}}}if(d){var Tc=e.Da;if("Line"===e.Ib&&Tc instanceof Ih){var Af=Tc.Ib,me=Tc.Da;if(me instanceof Ih){var Ch=me.Ib,Fe=me.Da;if(Fe instanceof Ih){var Zf=Fe.Ib,Cd=Fe.Da;if(Cd instanceof Ih){var pc=Cd.Ib,Fb=Cd.Da;if(Fb instanceof Ih){var cd=Fb.Ib,La=Fb.Da;if(La instanceof Ih){var gc=La.Ib,hc=La.Da;if(v().m(hc)){var Ym=
(new Sb).c(Af),$g=Jh(),Zm=Kh(Lh($g,Ym.U,10)),jl=(new Sb).c(Ch),$m=Mh(jl.U),an=(new Sb).c(Zf),kl=Lh(Jh(),an.U,10),bn=(new Sb).c(pc),ll=Jh(),ml=(new Oh).fa(kl,Lh(ll,bn.U,10)),nl=(new Sb).c(cd),cn=Lh(Jh(),nl.U,10),ol=(new Sb).c(gc),dn=Jh();return Qba(new Ph,Zm,$m,ml,(new Oh).fa(cn,Lh(dn,ol.U,10)))}}}}}}}}if(d){var ei=e.Da;if("Rectangle"===e.Ib&&ei instanceof Ih){var Yj=ei.Ib,Ui=ei.Da;if(Ui instanceof Ih){var en=Ui.Ib,Vi=Ui.Da;if(Vi instanceof Ih){var fn=Vi.Ib,Wi=Vi.Da;if(Wi instanceof Ih){var Zj=Wi.Ib,
ak=Wi.Da;if(ak instanceof Ih){var pl=ak.Ib,Xi=ak.Da;if(Xi instanceof Ih){var gn=Xi.Ib,Yi=Xi.Da;if(Yi instanceof Ih){var hn=Yi.Ib,ql=Yi.Da;if(v().m(ql)){var jn=(new Sb).c(Yj),rl=Jh(),kn=Kh(Lh(rl,jn.U,10)),ln=(new Sb).c(en),sl=Mh(ln.U),mn=(new Sb).c(fn),tl=Mh(mn.U),ul=(new Sb).c(Zj),Cg=Lh(Jh(),ul.U,10),ah=(new Sb).c(pl),nn=Jh(),vl=(new Oh).fa(Cg,Lh(nn,ah.U,10)),fi=(new Sb).c(gn),bk=Lh(Jh(),fi.U,10),Zi=(new Sb).c(hn),wl=Jh();return Rba(new Qh,kn,sl,tl,vl,(new Oh).fa(bk,Lh(wl,Zi.U,10)))}}}}}}}}}if(d){var bh=
e.Da;if("Polygon"===e.Ib&&bh instanceof Ih){var ck=bh.Ib,gi=bh.Da;if(gi instanceof Ih){var Dh=gi.Ib,$i=gi.Da;if($i instanceof Ih){var aj=$i.Ib,dk=Sba($i.Da),Eh=(new ac).bg(dk,p(function(){return function(od){var $f=Rh(od,0);$f=(new Sb).c($f);$f=Lh(Jh(),$f.U,10);od=Rh(od,1);od=(new Sb).c(od);var bj=Jh();return(new Oh).fa($f,Lh(bj,od.U,10))}}(a))),on=H(r(),v()),ek=Sh(Eh,on,xb(function(){return function(od,$f){od=(new z).e(od,$f);$f=od.ub;var bj=od.Hb;if(null!==bj){var Fh=bj.Mi();bj=bj.Qc();if(0<$f.ra()){var pn=
$f.Y(),vE=(new Oh).fa(Fh,bj);pn=null!==pn&&Ia(pn,vE)}else pn=!1;if(pn)return od=(new Oh).fa(Fh,bj),Fh=r(),$f.Fd(od,Fh.P)}$f=od.ub;Fh=od.Hb;if(null!==Fh)return od=(new Oh).fa(Fh.Mi(),Fh.Qc()),Fh=r(),$f.Fd(od,Fh.P);throw(new q).i(od);}}(a))).Wf(),fk=(new Sb).c(ck),nP=Jh(),oP=Kh(Lh(nP,fk.U,10)),pP=(new Sb).c(Dh),qP=Mh(pP.U),rP=(new Sb).c(aj);return Tba(new Th,oP,qP,Mh(rP.U),ek)}}}}throw(new je).c("Invalid shape format in file: "+b);}catch(od){if(od instanceof Pe)throw(new je).c("Invalid shape format in file: "+
b);throw od;}}function Uba(a,b){a=p(function(){return function(e){return Mba(Bh(),e)}}(a));var d=r();return b.xa(a,d.P).Jb("\n\n")}
function Vba(a,b){var d=function(){return function(k){return Wba(Bh(),k)}}(a);A();for(var e=[v()],f=-1+(e.length|0)|0,g=v();0<=f;)g=K(e[f],g),f=-1+f|0;a=b.Ub(g,xb(function(){return function(k,l){k=(new z).e(k,l);l=k.ub;var n=k.Hb;if(null!==n&&""===n)return k=v(),K(k,l);var t=k.ub;l=k.Hb;if(t instanceof Ih&&(n=t.Ib,t=t.Da,null!==l))return k=A().P,k=Uh(n,l,k),K(k,t);throw(new q).i(k);}}(a))).Ub(v(),xb(function(){return function(k,l){if(k instanceof Ih){var n=k.Ib,t=k.Da;if(v().m(l))return k=A(),n=n.Fd("",
k.P),K(n,t)}return K(l,k)}}(a))).kg(p(function(){return function(k){return sd(k)}}(a)));b=A().P;if(b===A().P){if(a===v())return v();b=a.Y();e=b=K(d(b),v());for(a=a.X();a!==v();)f=a.Y(),f=K(d(f),v()),e=e.Da=f,a=a.X();return b}for(b=Oc(a,b);!a.x();)e=a.Y(),b.Ka(d(e)),a=a.X();return b.Ea()}
function Xba(a,b){var d=function(){return function(k){return Yba(Bh(),k)}}(a);A();for(var e=[v()],f=-1+(e.length|0)|0,g=v();0<=f;)g=K(e[f],g),f=-1+f|0;a=b.Ub(g,xb(function(){return function(k,l){k=(new z).e(k,l);l=k.ub;var n=k.Hb;if(null!==n&&""===n)return k=v(),K(k,l);var t=k.ub;l=k.Hb;if(t instanceof Ih&&(n=t.Ib,t=t.Da,null!==l))return k=A().P,k=Uh(n,l,k),K(k,t);throw(new q).i(k);}}(a))).Ub(v(),xb(function(){return function(k,l){if(k instanceof Ih){var n=k.Ib,t=k.Da;if(v().m(l))return k=A(),n=n.Fd("",
k.P),K(n,t)}return K(l,k)}}(a))).kg(p(function(){return function(k){return sd(k)}}(a)));b=A().P;if(b===A().P){if(a===v())return v();b=a.Y();e=b=K(d(b),v());for(a=a.X();a!==v();)f=a.Y(),f=K(d(f),v()),e=e.Da=f,a=a.X();return b}for(b=Oc(a,b);!a.x();)e=a.Y(),b.Ka(d(e)),a=a.X();return b.Ea()}
function Wba(a,b){if(b instanceof Ih){var d=b.Ib,e=b.Da;if(e instanceof Ih){var f=e.Ib,g=e.Da;if(g instanceof Ih){e=g.Ib;var k=g.Da;if(k instanceof Ih){g=k.Ib;var l=k.Da;if(l instanceof Ih)return k=l.Ib,b=l.Da,f=(new Sb).c(f),f=fh(gh(),f.U),e=H(r(),(new M).q([e,g,k])),g=p(function(){return function(n){return Zba(Bh(),n)}}(a)),k=r(),$ba(new Vh,d,f,e.xa(g,k.P),Yba(a,b))}}}}throw(new je).c("Invalid link shape: "+bc(b,"","\n",""));}function Kh(a){return aca(255&a>>16,255&a>>8,255&a,255)}
function Zba(a,b){var d=!1,e=null,f=(new Sb).c(b);f=Hh(f,32);for(var g=-1+f.j.length|0,k=v();0<=g;)k=K(f.j[g],k),g=-1+g|0;f=k;if(f instanceof Ih&&(d=!0,e=f,g=e.Ib,k=e.Da,k instanceof Ih)){f=k.Da;if("1"===k.Ib){k=Jba();Ke();var l=function(){return function(y){y=(new Sb).c(y).U;return ea(fh(gh(),y))}}(a),n=A().P;if(n===A().P)if(f===v())l=v();else{n=f.Y();for(var t=n=K(l(n),v()),u=f.X();u!==v();){var w=u.Y();w=K(l(w),v());t=t.Da=w;u=u.X()}l=n}else{n=Oc(f,n);for(t=f;!t.x();)u=t.Y(),n.Ka(l(u)),t=t.X();
l=n.Ea()}k=k.hb(bca(l.Ne(Wh())))}else k=!1;if(k){b=(new Sb).c(g);b=fh(gh(),b.U);e=function(){return function(y){y=(new Sb).c(y).U;return ea(fh(gh(),y))}}(a);a=A().P;if(a===A().P)if(f===v())e=v();else{a=f.Y();d=a=K(e(a),v());for(f=f.X();f!==v();)g=f.Y(),g=K(e(g),v()),d=d.Da=g,f=f.X();e=a}else{for(a=Oc(f,a);!f.x();)d=f.Y(),a.Ka(e(d)),f=f.X();e=a.Ea()}return(new Xh).Zu(b,!0,e)}}if(d&&(f=e.Ib,a=e.Da,a instanceof Ih&&"1"===a.Ib))return b=(new Sb).c(f),b=fh(gh(),b.U),e=r(),(new Xh).Zu(b,!0,H(e,(new M).q([1,
0])));if(d&&(f=e.Ib,e=e.Da,e instanceof Ih&&"0"===e.Ib))return b=(new Sb).c(f),b=fh(gh(),b.U),e=r(),(new Xh).Zu(b,!1,H(e,(new M).q([0,1])));throw(new je).c("Invalid link line: "+b);}function Nba(a,b){var d=r(),e=[b.Ze(),b.yD(),b.nk];d=H(d,(new M).q(e));b=b.Gh;a=p(function(){return function(f){return Oba(Bh(),f)}}(a));e=r();a=b.xa(a,e.P);b=r();return d.oc(a,b.P).Jb("\n")}function cca(a,b){a=p(function(){return function(e){return Nba(Bh(),e)}}(a));var d=r();return b.xa(a,d.P).Jb("\n\n")}
function Yba(a,b){if(b instanceof Ih){var d=b.Ib,e=b.Da;if(e instanceof Ih){var f=e.Ib,g=e.Da;if(g instanceof Ih){e=g.Da;b=(new Sb).c(g.Ib);b=Lh(Jh(),b.U,10);a=function(){return function(n){return Pba(Bh(),n)}}(a);g=A().P;if(g===A().P)if(e===v())a=v();else{g=e.Y();var k=g=K(a(g),v());for(e=e.X();e!==v();){var l=e.Y();l=K(a(l),v());k=k.Da=l;e=e.X()}a=g}else{for(g=Oc(e,g);!e.x();)k=e.Y(),g.Ka(a(k)),e=e.X();a=g.Ea()}return(new Yh).zC(d,"true"===f,b,a)}}}throw(new je).c("Invalid vector shape:\n "+bc(b,
"","\n",""));}Ah.prototype.$classData=h({vO:0},!1,"org.nlogo.core.ShapeParser$",{vO:1,d:1});var Zh=void 0;function Bh(){Zh||(Zh=(new Ah).b());return Zh}function $h(){this.ZG=null;this.a=!1}$h.prototype=new m;$h.prototype.constructor=$h;
$h.prototype.b=function(){ai=this;var a=bi();a=(new z).e(a,"__observercode");var b=ci();b=(new z).e(b,"__turtlecode");var d=di();d=(new z).e(d,"__patchcode");var e=hi();a=[a,b,d,(new z).e(e,"__linkcode")];b=(new dc).vb(ec());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.ZG=b.La;this.a=!0;return this};$h.prototype.$classData=h({FO:0},!1,"org.nlogo.core.SourceWrapping$",{FO:1,d:1});var ai=void 0;function dca(){ai||(ai=(new $h).b());return ai}function ii(){}ii.prototype=new m;
ii.prototype.constructor=ii;ii.prototype.b=function(){return this};function ji(a,b){return(new I).i((new $b).te(b.Od,b.ta,b.ja))}ii.prototype.$classData=h({HO:0},!1,"org.nlogo.core.Statement$",{HO:1,d:1});var ki=void 0;function li(){ki||(ki=(new ii).b());return ki}function mi(){}mi.prototype=new m;mi.prototype.constructor=mi;mi.prototype.b=function(){return this};
function yg(a,b){a=(new Sb).c(b);b=Ke().rq.wd(a.U);for(var d=0,e=a.U.length|0;d<e;){var f=a.R(d);f=null===f?0:f.W;switch(f){case 10:f="\\n";break;case 13:f="\\r";break;case 9:f="\\t";break;case 92:f="\\\\";break;case 34:f='\\"';break;default:f=ba.String.fromCharCode(f)}f=(new Sb).c(f).U;b.bc((new ni).c(f));d=1+d|0}return b.Ea()}
function oi(a,b){for(var d=(new Sb).c(b),e=d.U.length|0,f=0;;){if(f<e){var g=d.R(f);g=92!==(null===g?0:g.W)}else g=!1;if(g)f=1+f|0;else break}e=pi(d,f);if(null===e)throw(new q).i(e);d=e.ha();e=e.la();if(2>((new Sb).c(e).U.length|0))return b;b=eca(65535&(e.charCodeAt(1)|0));b=Le(b);e=(new Sb).c(e);f=e.U.length|0;return""+d+b+oi(a,Ie(Je(),e.U,2,f))}
function eca(a){switch(a){case 110:return 10;case 114:return 13;case 116:return 9;case 92:return 92;case 34:return 34;default:throw(new Pe).c("invalid escape sequence: \\"+Le(a));}}mi.prototype.$classData=h({JO:0},!1,"org.nlogo.core.StringEscaper$",{JO:1,d:1});var qi=void 0;function zg(){qi||(qi=(new mi).b());return qi}function ri(){}ri.prototype=new m;ri.prototype.constructor=ri;ri.prototype.b=function(){return this};
function fca(a,b){var d=si();b=b-(b&d)|0;d=ti();0!==(b&d)?(d=ti(),b=b-(b&d)|0,d="variable"):(b&ui())===ui()?(d=ui(),b=b-(b&d)|0,d="list or block"):(b&mc())===mc()?(d=mc(),b=b-(b&d)|0,d="anything"):(b&vi(C()))===vi(C())?(d=vi(C())|wi(C()),b=b-(b&d)|0,d="agent"):(d=O(C()),0!==(b&d)?(d=O(C()),b=b-(b&d)|0,d="number"):(d=xi(C()),0!==(b&d)?(d=xi(C()),b=b-(b&d)|0,d="TRUE/FALSE"):(d=yi(C()),0!==(b&d)?(d=yi(C()),b=b-(b&d)|0,d="string"):(d=zi(C()),0!==(b&d)?(d=zi(C()),b=b-(b&d)|0,d="list"):(b&Ai(C()))===Ai(C())?
(d=Ai(C()),b=b-(b&d)|0,d="agentset"):(d=Bi(C()),0!==(b&d)?(d=Bi(C()),b=b-(b&d)|0,d="turtle agentset"):(d=Ci(C()),0!==(b&d)?(d=Ci(C()),b=b-(b&d)|0,d="patch agentset"):(d=Di(C()),0!==(b&d)?(d=Di(C()),b=b-(b&d)|0,d="link agentset"):(d=Ei(C()),0!==(b&d)?(d=Ei(C())|wi(C()),b=b-(b&d)|0,d="turtle"):(d=Fi(C()),0!==(b&d)?(d=Fi(C())|wi(C()),b=b-(b&d)|0,d="patch"):(d=Gi(C()),0!==(b&d)?(d=Gi(C())|wi(C()),b=b-(b&d)|0,d="link"):(d=td(C()),0!==(b&d)?(d=td(C()),b=b-(b&d)|0,d="anonymous reporter"):(d=md(C()),0!==
(b&d)?(d=md(C()),b=b-(b&d)|0,d="anonymous command"):(d=wi(C()),0!==(b&d)?(d=wi(C()),b=b-(b&d)|0,d="NOBODY"):(d=Hi(C()),0!==(b&d)?(d=Hi(C()),b=b-(b&d)|0,d="command block"):(b&Ii(C()))===Ii(C())?(d=Ii(C()),b=b-(b&d)|0,d="reporter block"):(d=Ji(C()),0!==(b&d)?(d=Ii(C()),b=b-(b&d)|0,d="different kind of block"):(d=Ki(C()),0!==(b&d)?(d=Ki(C()),b=b-(b&d)|0,d="TRUE/FALSE block"):(d=Li(C()),0!==(b&d)?(d=Li(C()),b=b-(b&d)|0,d="number block"):(d=Mi(),0!==(b&d)?(d=Mi(),b=b-(b&d)|0,d="code block"):(d=Ni(),0!==
(b&d)?(d=Ni(),b=b-(b&d)|0,d="variable"):d="(none)")))))))))))))))))));var e=b;return 0===e?d:Oi()===e?d+" (optional)":d+" or "+fca(a,b)}function Pi(a,b){a=fca(a,b);if("NOBODY"!==a&&"anything"!==a)a:switch(b=(new Sb).c(a),b=Qi(b),b=null===b?0:b.W,eh(),65535&(ba.String.fromCharCode(b).toUpperCase().charCodeAt(0)|0)){case 65:case 69:case 73:case 79:case 85:a="an "+a;break a;default:a="a "+a}return a}ri.prototype.$classData=h({tP:0},!1,"org.nlogo.core.TypeNames$",{tP:1,d:1});var Ri=void 0;
function Si(){Ri||(Ri=(new ri).b());return Ri}function Ti(){this.BG=null;this.a=!1}Ti.prototype=new m;Ti.prototype.constructor=Ti;Ti.prototype.b=function(){this.BG="@#$#@#$#@";this.a=!0;return this};function gca(){var a=cj();return p(function(){return function(b){return b}}(a))}
function hca(a,b){a=dj();var d=Jg(Ke().Pk,v()),e=gca();var f=H(sc().pi,v());var g=H(sc().pi,v());var k=ica(),l=jca;Ke();b=null!==b?(new ni).c(b):null;b=l(k,b);for(b=(new ej).hv(b);fj(b).qa();)k=b.Tm(),l=gj(cj()),0<=(k.length|0)&&k.substring(0,l.length|0)===l?(f=f.wc(g,(hj(),ij().pc)),g=H(sc().pi,v())):g=g.wc(k,(hj(),ij().pc));f=f.wc(g,(hj(),ij().pc));H(sc().pi,v());if(12!==f.ra())throw jg(kg(),(new sg).c("Models must have 12 sections, this had "+f.ra()));sc();k=(new I).i(f);if(null!==k.M&&0===k.M.sb(12)){var n=
k.M.R(0),t=k.M.R(1);f=k.M.R(2);l=k.M.R(3);g=k.M.R(4);b=k.M.R(5);var u=k.M.R(6);var w=k.M.R(7);var y=k.M.R(8);var E=k.M.R(9);var L=k.M.R(10);var S=k.M.R(11);k=u}else throw(new q).i(f);b;k;w;y;k=E;L;S;b=Xba(Bh(),l);k=Vba(Bh(),k);l=bc(n,"","\n","");y=jj();E=A().P;w=new kj;L=Bg(t,E);E=H(sc().pi,v());for(t=H(sc().pi,v());!L.x();){n=L.Y();S=(new Sb).c(n);if(sd(S))t=t.wc(n,(hj(),ij().pc));else{n=lj(t);for(S=!0;S&&n.rj;){S=n.ma();if(null===S)throw(new xe).b();S=""===S}S||(n=jj(),S=A().P,E=E.wc(kca(n,Bg(t,
S),a,d,e),(hj(),ij().pc)));t=H(sc().pi,v())}L=L.X()}L=lj(t);for(n=!0;n&&L.rj;){n=L.ma();if(null===n)throw(new xe).b();n=""===n}n||(L=A().P,E=E.wc(kca(y,Bg(t,L),a,d,e),(hj(),ij().pc)));a=E;d=A().P;a=Bg(a,d);return mj(w,l,a,bc(f,"","\n",""),g.Y(),b.gb(),k.gb(),H(r(),v()))}
function lca(a,b){return b.Zc+("\n"+gj(a))+"\n"+mca(jj(),b.Wc)+("\n"+gj(a))+"\n"+b.Ff+("\n"+gj(a))+"\n"+cca(Bh(),b.Ph)+("\n"+gj(a))+"\n"+b.Ii+("\n"+gj(a))+"\n"+gj(a)+"\n"+gj(a)+"\n"+gj(a)+"\n"+gj(a)+"\n"+Uba(Bh(),b.Mh)+("\n"+gj(a))+"\n"+("\n"+gj(a))+"\n"}function gj(a){if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/model/ModelReader.scala: 9");return a.BG}Ti.prototype.$classData=h({MP:0},!1,"org.nlogo.core.model.ModelReader$",{MP:1,d:1});
var nj=void 0;function cj(){nj||(nj=(new Ti).b());return nj}function oj(){}oj.prototype=new m;oj.prototype.constructor=oj;oj.prototype.b=function(){return this};
function nca(a){var b="";for(;;){var d=a;if(null===d)throw(new xe).b();if(""===d)return(new z).e(b,a);d=(new Sb).c(a);d=Qi(d);if(34===(null===d?0:d.W))return a=(new Sb).c(a),a=pj(a),(new z).e(b,a.trim());d=(new Sb).c(a);d=Ie(Je(),d.U,0,2);null!==d&&'\\"'===d?(a=(new Sb).c(a),d=a.U.length|0,a=Ie(Je(),a.U,2,d),b+='"'):(d=(new Sb).c(a),d=pj(d),a=(new Sb).c(a),b=""+b+oa(Qi(a)),a=d)}}
function qj(a,b){var d=(new Sb).c(b);d=rj(d);if(d instanceof I&&(d=d.M,34===(null===d?0:d.W))){b=(new Sb).c(b);d=nca(pj(b));if(null===d)throw(new q).i(d);b=d.ha();a=qj(a,d.la());return K(b,a)}return v()}function sj(a){return""+Le(34)+a+Le(34)}oj.prototype.$classData=h({RP:0},!1,"org.nlogo.core.model.PenReader$",{RP:1,d:1});var tj=void 0;function uj(){tj||(tj=(new oj).b());return tj}function vj(){this.MH=null;this.a=!1}vj.prototype=new m;vj.prototype.constructor=vj;
vj.prototype.b=function(){wj=this;xj||(xj=(new yj).b());var a=(new z).e("BUTTON",xj);zj||(zj=(new Aj).b());var b=(new z).e("SLIDER",zj);Bj||(Bj=(new Cj).b());var d=(new z).e("GRAPHICS-WINDOW",Bj);Dj||(Dj=(new Ej).b());var e=(new z).e("MONITOR",Dj);Fj||(Fj=(new Gj).b());var f=(new z).e("SWITCH",Fj);Hj||(Hj=(new Ij).b());var g=(new z).e("PLOT",Hj);Jj||(Jj=(new Kj).b());var k=(new z).e("CHOOSER",Jj);Lj||(Lj=(new Mj).b());var l=(new z).e("OUTPUT",Lj);Nj||(Nj=(new Oj).b());var n=(new z).e("TEXTBOX",Nj);
Pj||(Pj=(new Qj).b());a=[a,b,d,e,f,g,k,l,n,(new z).e("INPUTBOX",Pj)];b=(new dc).vb(ec());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.MH=b.La;this.a=!0;return this};
function oca(a,b){var d=(jj(),Jg(Ke().Pk,v()));d=pca(a).ul(d).Pr();a=p(function(f,g){return function(k){var l=k.ym();l=null!==g&&(Rj(l.Rd(),g)||ta(g)&&Sj(l.Rd(),ra(fb))||wa(g)&&Sj(l.Rd(),ra(gb))||g instanceof ke&&Sj(l.Rd(),ra(eb))||Ua(g)&&Sj(l.Rd(),ra(hb))||g instanceof Fa&&Sj(l.Rd(),ra(ib))||za(g)&&Sj(l.Rd(),ra(jb))||"number"===typeof g&&Sj(l.Rd(),ra(mb))||"boolean"===typeof g&&Sj(l.Rd(),ra(cb))||void 0===g&&Sj(l.Rd(),ra(bb)))?(new I).i(g):D();l.x()?k=D():(l=l.Q(),k=(new I).i(k.uI(l)));return k.gb()}}(a,
b));var e=Nc();d=d.Ti(a,e.P).zg();if(d.x())throw(new Tj).c("Widget type is not supported: "+qa(b).yg());return d.Q()}function kca(a,b,d,e,f){a=pca(a).ul(e).Pr().Hh(p(function(g,k){return function(l){return l.rE(k)}}(a,b)));if(a instanceof I)return a.M.DK(b,d).zm(f);if(D()===a)throw jg(kg(),(new sg).c("Dimensions provided don't match the NetLogo file reader\nCouldn't find corresponding reader for "+b.Y()));throw(new q).i(a);}
function mca(a,b){a=p(function(){return function(e){return oca(jj(),e)}}(a));var d=r();return b.xa(a,d.P).Jb("\n\n")}function pca(a){if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/model/WidgetReader.scala: 107");return a.MH}vj.prototype.$classData=h({bQ:0},!1,"org.nlogo.core.model.WidgetReader$",{bQ:1,d:1});var wj=void 0;function jj(){wj||(wj=(new vj).b());return wj}function Uj(){this.a=0}Uj.prototype=new m;Uj.prototype.constructor=Uj;
Uj.prototype.b=function(){return this};Uj.prototype.$classData=h({qR:0},!1,"org.nlogo.core.prim.Lambda$",{qR:1,d:1});var qca=void 0;function Vj(){this.II=this.PH=this.JI=null;this.a=0}Vj.prototype=new m;Vj.prototype.constructor=Vj;
Vj.prototype.b=function(){Wj=this;this.JI="_.?\x3d*!\x3c\x3e:#+/%$^'\x26-";this.a=(1|this.a)<<24>>24;this.PH="0123456789";this.a=(2|this.a)<<24>>24;var a=Ke().rm,b=[(new P).N(65498,65500,1),(new P).N(65490,65495,1),(new P).N(65482,65487,1),(new P).N(65474,65479,1),(new P).N(65382,65470,1),(new P).N(65345,65370,1),(new P).N(65313,65338,1),(new P).N(65142,65276,1),(new P).N(65136,65140,1),(new P).N(65008,65019,1),(new P).N(64914,64967,1),(new P).N(64848,64911,1),(new P).N(64467,64829,1),(new P).N(64326,
64433,1),(new P).N(64323,64324,1),(new P).N(64320,64321,1),(new P).N(64318,64318,1),(new P).N(64312,64316,1),(new P).N(64298,64310,1),(new P).N(64287,64296,1),(new P).N(64285,64285,1),(new P).N(64275,64279,1),(new P).N(64256,64262,1),(new P).N(64112,64217,1),(new P).N(63744,64109,1),(new P).N(55243,55291,1),(new P).N(55216,55238,1),(new P).N(44032,55203,1),(new P).N(43968,44002,1),(new P).N(43816,43822,1),(new P).N(43808,43814,1),(new P).N(43793,43798,1),(new P).N(43785,43790,1),(new P).N(43777,43782,
1),(new P).N(43762,43764,1),(new P).N(43744,43754,1),(new P).N(43739,43741,1),(new P).N(43714,43714,1),(new P).N(43712,43712,1),(new P).N(43705,43709,1),(new P).N(43701,43702,1),(new P).N(43697,43697,1),(new P).N(43648,43695,1),(new P).N(43642,43642,1),(new P).N(43616,43638,1),(new P).N(43588,43595,1),(new P).N(43584,43586,1),(new P).N(43520,43560,1),(new P).N(43471,43471,1),(new P).N(43396,43442,1),(new P).N(43360,43388,1),(new P).N(43312,43334,1),(new P).N(43274,43301,1),(new P).N(43259,43259,1),
(new P).N(43250,43255,1),(new P).N(43138,43187,1),(new P).N(43072,43123,1),(new P).N(43020,43042,1),(new P).N(43015,43018,1),(new P).N(43011,43013,1),(new P).N(43E3,43009,1),(new P).N(42912,42922,1),(new P).N(42896,42899,1),(new P).N(42891,42894,1),(new P).N(42786,42888,1),(new P).N(42775,42783,1),(new P).N(42656,42725,1),(new P).N(42623,42647,1),(new P).N(42560,42606,1),(new P).N(42538,42539,1),(new P).N(42512,42527,1),(new P).N(42240,42508,1),(new P).N(42192,42237,1),(new P).N(40960,42124,1),(new P).N(19968,
40908,1),(new P).N(13312,19893,1),(new P).N(12784,12799,1),(new P).N(12704,12730,1),(new P).N(12593,12686,1),(new P).N(12549,12589,1),(new P).N(12540,12543,1),(new P).N(12449,12538,1),(new P).N(12445,12447,1),(new P).N(12353,12438,1),(new P).N(12347,12348,1),(new P).N(12337,12341,1),(new P).N(12293,12294,1),(new P).N(11823,11823,1),(new P).N(11736,11742,1),(new P).N(11728,11734,1),(new P).N(11720,11726,1),(new P).N(11712,11718,1),(new P).N(11704,11710,1),(new P).N(11696,11702,1),(new P).N(11688,11694,
1),(new P).N(11680,11686,1),(new P).N(11648,11670,1),(new P).N(11631,11631,1),(new P).N(11568,11623,1),(new P).N(11565,11565,1),(new P).N(11559,11559,1),(new P).N(11520,11557,1),(new P).N(11506,11507,1),(new P).N(11499,11502,1),(new P).N(11360,11492,1),(new P).N(11312,11358,1),(new P).N(11264,11310,1),(new P).N(8579,8580,1),(new P).N(8526,8526,1),(new P).N(8517,8521,1),(new P).N(8508,8511,1),(new P).N(8495,8505,1),(new P).N(8490,8493,1),(new P).N(8488,8488,1),(new P).N(8486,8486,1),(new P).N(8484,
8484,1),(new P).N(8473,8477,1),(new P).N(8469,8469,1),(new P).N(8458,8467,1),(new P).N(8455,8455,1),(new P).N(8450,8450,1),(new P).N(8336,8348,1),(new P).N(8319,8319,1),(new P).N(8305,8305,1),(new P).N(8182,8188,1),(new P).N(8178,8180,1),(new P).N(8160,8172,1),(new P).N(8150,8155,1),(new P).N(8144,8147,1),(new P).N(8134,8140,1),(new P).N(8130,8132,1),(new P).N(8126,8126,1),(new P).N(8118,8124,1),(new P).N(8064,8116,1),(new P).N(8031,8061,1),(new P).N(8029,8029,1),(new P).N(8027,8027,1),(new P).N(8025,
8025,1),(new P).N(8016,8023,1),(new P).N(8008,8013,1),(new P).N(7968,8005,1),(new P).N(7960,7965,1),(new P).N(7680,7957,1),(new P).N(7424,7615,1),(new P).N(7413,7414,1),(new P).N(7406,7409,1),(new P).N(7401,7404,1),(new P).N(7258,7293,1),(new P).N(7245,7247,1),(new P).N(7168,7203,1),(new P).N(7098,7141,1),(new P).N(7086,7087,1),(new P).N(7043,7072,1),(new P).N(6981,6987,1),(new P).N(6917,6963,1),(new P).N(6823,6823,1),(new P).N(6688,6740,1),(new P).N(6656,6678,1),(new P).N(6593,6599,1),(new P).N(6528,
6571,1),(new P).N(6512,6516,1),(new P).N(6480,6509,1),(new P).N(6400,6428,1),(new P).N(6320,6389,1),(new P).N(6314,6314,1),(new P).N(6272,6312,1),(new P).N(6176,6263,1),(new P).N(6108,6108,1),(new P).N(6103,6103,1),(new P).N(6016,6067,1),(new P).N(5998,6E3,1),(new P).N(5984,5996,1),(new P).N(5952,5969,1),(new P).N(5920,5937,1),(new P).N(5902,5905,1),(new P).N(5888,5900,1),(new P).N(5792,5866,1),(new P).N(5761,5786,1),(new P).N(5743,5759,1),(new P).N(5121,5740,1),(new P).N(5024,5108,1),(new P).N(4992,
5007,1),(new P).N(4888,4954,1),(new P).N(4882,4885,1),(new P).N(4824,4880,1),(new P).N(4808,4822,1),(new P).N(4802,4805,1),(new P).N(4800,4800,1),(new P).N(4792,4798,1),(new P).N(4786,4789,1),(new P).N(4752,4784,1),(new P).N(4746,4749,1),(new P).N(4704,4744,1),(new P).N(4698,4701,1),(new P).N(4696,4696,1),(new P).N(4688,4694,1),(new P).N(4682,4685,1),(new P).N(4348,4680,1),(new P).N(4304,4346,1),(new P).N(4301,4301,1),(new P).N(4295,4295,1),(new P).N(4256,4293,1),(new P).N(4238,4238,1),(new P).N(4213,
4225,1),(new P).N(4206,4208,1),(new P).N(4197,4198,1),(new P).N(4193,4193,1),(new P).N(4186,4189,1),(new P).N(4176,4181,1),(new P).N(4159,4159,1),(new P).N(4096,4138,1),(new P).N(3976,3980,1),(new P).N(3913,3948,1),(new P).N(3904,3911,1),(new P).N(3840,3840,1),(new P).N(3804,3807,1),(new P).N(3782,3782,1),(new P).N(3776,3780,1),(new P).N(3773,3773,1),(new P).N(3762,3763,1),(new P).N(3757,3760,1),(new P).N(3754,3755,1),(new P).N(3751,3751,1),(new P).N(3749,3749,1),(new P).N(3745,3747,1),(new P).N(3737,
3743,1),(new P).N(3732,3735,1),(new P).N(3725,3725,1),(new P).N(3722,3722,1),(new P).N(3719,3720,1),(new P).N(3716,3716,1),(new P).N(3713,3714,1),(new P).N(3648,3654,1),(new P).N(3634,3635,1),(new P).N(3585,3632,1),(new P).N(3520,3526,1),(new P).N(3517,3517,1),(new P).N(3507,3515,1),(new P).N(3482,3505,1),(new P).N(3461,3478,1),(new P).N(3450,3455,1),(new P).N(3424,3425,1),(new P).N(3406,3406,1),(new P).N(3389,3389,1),(new P).N(3346,3386,1),(new P).N(3342,3344,1),(new P).N(3333,3340,1),(new P).N(3313,
3314,1),(new P).N(3296,3297,1),(new P).N(3294,3294,1),(new P).N(3261,3261,1),(new P).N(3253,3257,1),(new P).N(3242,3251,1),(new P).N(3218,3240,1),(new P).N(3214,3216,1),(new P).N(3205,3212,1),(new P).N(3168,3169,1),(new P).N(3160,3161,1),(new P).N(3133,3133,1),(new P).N(3125,3129,1),(new P).N(3114,3123,1),(new P).N(3090,3112,1),(new P).N(3086,3088,1),(new P).N(3077,3084,1),(new P).N(3024,3024,1),(new P).N(2990,3001,1),(new P).N(2984,2986,1),(new P).N(2979,2980,1),(new P).N(2974,2975,1),(new P).N(2972,
2972,1),(new P).N(2969,2970,1),(new P).N(2962,2965,1),(new P).N(2958,2960,1),(new P).N(2949,2954,1),(new P).N(2947,2947,1),(new P).N(2929,2929,1),(new P).N(2911,2913,1),(new P).N(2908,2909,1),(new P).N(2877,2877,1),(new P).N(2869,2873,1),(new P).N(2866,2867,1),(new P).N(2858,2864,1),(new P).N(2835,2856,1),(new P).N(2831,2832,1),(new P).N(2821,2828,1),(new P).N(2784,2785,1),(new P).N(2768,2768,1),(new P).N(2749,2749,1),(new P).N(2741,2745,1),(new P).N(2738,2739,1),(new P).N(2730,2736,1),(new P).N(2707,
2728,1),(new P).N(2703,2705,1),(new P).N(2693,2701,1),(new P).N(2674,2676,1),(new P).N(2654,2654,1),(new P).N(2649,2652,1),(new P).N(2616,2617,1),(new P).N(2613,2614,1),(new P).N(2610,2611,1),(new P).N(2602,2608,1),(new P).N(2579,2600,1),(new P).N(2575,2576,1),(new P).N(2565,2570,1),(new P).N(2544,2545,1),(new P).N(2527,2529,1),(new P).N(2524,2525,1),(new P).N(2510,2510,1),(new P).N(2493,2493,1),(new P).N(2486,2489,1),(new P).N(2482,2482,1),(new P).N(2474,2480,1),(new P).N(2451,2472,1),(new P).N(2447,
2448,1),(new P).N(2437,2444,1),(new P).N(2425,2431,1),(new P).N(2417,2423,1),(new P).N(2392,2401,1),(new P).N(2384,2384,1),(new P).N(2365,2365,1),(new P).N(2308,2361,1),(new P).N(2210,2220,1),(new P).N(2208,2208,1),(new P).N(2112,2136,1),(new P).N(2088,2088,1),(new P).N(2084,2084,1),(new P).N(2074,2074,1),(new P).N(2048,2069,1),(new P).N(2042,2042,1),(new P).N(2036,2037,1),(new P).N(1994,2026,1),(new P).N(1969,1969,1),(new P).N(1869,1957,1),(new P).N(1810,1839,1),(new P).N(1808,1808,1),(new P).N(1791,
1791,1),(new P).N(1786,1788,1),(new P).N(1774,1775,1),(new P).N(1765,1766,1),(new P).N(1749,1749,1),(new P).N(1649,1747,1),(new P).N(1646,1647,1),(new P).N(1568,1610,1),(new P).N(1520,1522,1),(new P).N(1488,1514,1),(new P).N(1377,1415,1),(new P).N(1369,1369,1),(new P).N(1329,1366,1),(new P).N(1162,1319,1),(new P).N(1015,1153,1),(new P).N(931,1013,1),(new P).N(910,929,1),(new P).N(908,908,1),(new P).N(904,906,1),(new P).N(902,902,1),(new P).N(890,893,1),(new P).N(886,887,1),(new P).N(880,884,1),(new P).N(750,
750,1),(new P).N(748,748,1),(new P).N(736,740,1),(new P).N(710,721,1),(new P).N(248,705,1),(new P).N(216,246,1),(new P).N(192,214,1),(new P).N(186,186,1),(new P).N(181,181,1),(new P).N(170,170,1),(new P).N(97,122,1),(new P).N(65,90,1)];a=H(a,(new M).q(b));b=H(Xj(),v());a=Sh(a,b,xb(function(){return function(l,n){var t=gk().$b;n=Bg(n,t);return hk(l,n)}}(this)));if(0===(2&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/lex/Charset.scala: 9");
b=(new Sb).c(this.PH);Ke();for(var d=Oc(b,new ik),e=0,f=b.U.length|0;e<f;){var g=b.R(e);d.Ka(null===g?0:g.W);e=1+e|0}b=d.Ea().td();if(0===(1&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/lex/Charset.scala: 8");d=(new Sb).c(this.JI);Ke();e=Oc(d,new ik);f=0;for(g=d.U.length|0;f<g;){var k=d.R(f);e.Ka(null===k?0:k.W);f=1+f|0}this.II=a.Tj(b.Tj(e.Ea().td()));this.a=(4|this.a)<<24>>24;return this};
function rca(){Wj||(Wj=(new Vj).b());var a=Wj;if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/lex/Charset.scala: 11");return a.II}Vj.prototype.$classData=h({PY:0},!1,"org.nlogo.lex.Charset$",{PY:1,d:1});var Wj=void 0;function jk(){this.a=!1}jk.prototype=new m;jk.prototype.constructor=jk;function sca(a,b){return p(function(d,e){return function(f){return e.w(Le(null===f?0:f.W))?kk():lk()}}(a,b))}jk.prototype.b=function(){return this};
function mk(a,b){return nk(a,b,xb(function(){return function(d,e){a:for(e=null===e?0:e.W;;){var f=d.Y().w(Le(e));if(f===lk()&&d.X().ef())d=d.X();else{d=f===lk()?(new z).e(H(r(),v()),lk()):(new z).e(d,f);break a}}return d}}(a)))}function tca(a,b){return nk(a,!1,xb(function(d,e){return function(f,g){g=null===g?0:g.W;return f?(new z).e(!0,lk()):(new z).e(!0,e.w(Le(g)))}}(a,b)))}
function ok(a,b){return nk(a,b,xb(function(d){return function(e,f){f=null===f?0:f.W;if(e.x())return(new z).e(e,lk());f=p(function(l,n){return function(t){return t.w(Le(n))}}(d,f));var g=r();f=e.xa(f,g.P);g=r();e=e.Re(f,g.P).kg(p(function(){return function(l){l=l.la();var n=kk();return null!==l&&Ia(l,n)}}(d)));g=p(function(){return function(l){return l.ha()}}(d));var k=r();e=e.xa(g,k.P);return(new z).e(e,f.Ck(xb(function(){return function(l,n){return l.nD(n)}}(d))))}}(a)))}
function pk(a,b){return tca(a,p(function(d,e){return function(f){return e.w(Le(null===f?0:f.W))?kk():qk()}}(a,b)))}function nk(a,b,d){b=(new rk).i(b);return p(function(e,f,g){return function(k){k=f.Cf(g.Za,Le(null===k?0:k.W));if(null===k)throw(new q).i(k);var l=k.la();g.Za=k.ha();return l}}(a,d,b))}function uca(a,b){b=[pk(a,b),p(function(d,e){return function(f){return e.w(Le(null===f?0:f.W))?kk():lk()}}(a,b))];return mk(a,(new M).q(b))}
jk.prototype.$classData=h({SY:0},!1,"org.nlogo.lex.LexOperations$",{SY:1,d:1});var sk=void 0;function tk(){sk||(sk=(new jk).b());return sk}function uk(){}uk.prototype=new m;uk.prototype.constructor=uk;uk.prototype.b=function(){return this};function vk(a){wk||(wk=(new uk).b());var b=wk;return nk(tk(),!1,xb(function(d,e){return function(f,g){g=null===g?0:g.W;return f?(new z).e(!0,lk()):(new z).e(!0,g===e?kk():qk())}}(b,a)))}
uk.prototype.$classData=h({TY:0},!1,"org.nlogo.lex.LexOperations$PrefixConversions$",{TY:1,d:1});var wk=void 0;function xk(){this.MK=null;this.a=!1}xk.prototype=new m;xk.prototype.constructor=xk;function vca(){}vca.prototype=xk.prototype;
xk.prototype.b=function(){yk||(yk=(new zk).b());var a=(new z).e(",",yk),b=wca();b=(new z).e("{",b);Ak||(Ak=(new Bk).b());var d=(new z).e("}",Ak),e=Ck();e=(new z).e("(",e);var f=Dk();f=(new z).e(")",f);var g=Ek();g=(new z).e("[",g);var k=Fk();a=[a,b,d,e,f,g,(new z).e("]",k)];b=(new dc).vb(ec());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.MK=b.La;this.a=!0;return this};
function xca(a){return(new z).e(pk(tk(),p(function(b){return function(d){var e=null===d?0:d.W;d=yca(b);e=ba.String.fromCharCode(e);return d.hb(e)}}(a))),p(function(b){return function(d){var e=yca(b).Cc(d);if(e.x())return D();e=e.Q();return(new I).i((new $b).te(d,e,null))}}(a)))}function zca(a){return(new z).e(uca(tk(),p(function(){return function(b){b=null===b?0:b.W;return rca().hb(b)}}(a))),p(function(){return function(b){return(new I).i((new $b).te(b,Gk(),b.toUpperCase()))}}(a)))}
function Aca(a){var b=tk(),d=[vk(59),sca(tk(),p(function(){return function(e){e=null===e?0:e.W;return 13!==e&&10!==e}}(a)))];return(new z).e(mk(b,(new M).q(d)),p(function(){return function(e){return(new I).i((new $b).te(e,Hk(),null))}}(a)))}
xk.prototype.aB=function(a){return a.qa()?(a=Bca(this).Ub((new z).e(D(),a),xb(function(){return function(b,d){d=(new z).e(b,d);var e=d.ub;b=d.Hb;if(null!==e){var f=e.ha();e=e.la();if(f instanceof I&&(f=f.M,null!==b))return(new z).e((new I).i(f),e)}b=d.ub;e=d.Hb;if(null!==b&&(f=b.ha(),b=b.la(),D()===f&&null!==e)){f=e.la();d=b.Op;e=e.ha();Ik(b.Sk);b:{var g=(new Jk).b();c:for(;;){var k=Cca(b);if(k instanceof I&&(k=k.M,k=null===k?0:k.W,e.w(Le(k)).Ow())){g=Kk(g,k);continue c}e=g.kc.ec;break b}}b.Sk.mr();
k=e.length|0;g=b.Sk;k=(new Fa).fa(k,k>>31);g.po.hw(k);Lk(g,Mk(g)-k.ga|0);b.Op=b.Op+(e.length|0)|0;e=(new z).e(e,b);if(null===e)throw(new q).i(e);g=e.ha();e=e.la();if(""===g)f=D();else if(f=f.w(g),f.x())f=D();else{f=f.Q();if(null===f)throw(new q).i(f);f=(new I).i((new z).e(Nk(new Ok,f.Ia,f.Wa,f.Ig,Pk(d,e.Op,b.$a)),b))}f.x()?(b.Sk.mr(),b.Op=d,d=D()):d=f;d.x()?d=D():(d=d.Q(),d=(new I).i((new z).e((new I).i(d.ha()),d.la())));return d.x()?(new z).e(D(),b):d.Q()}throw(new q).i(d);}}(this))),(new z).e(a.ha().Q(),
a.la())):(new z).e(Qk(),a)};function Dca(a){return(new z).e(tca(tk(),p(function(){return function(){return kk()}}(a))),p(function(){return function(b){return(new I).i((new $b).te(b,Rk(),"This non-standard character is not allowed."))}}(a)))}
function Eca(a){var b=tk(),d=tk(),e=pk(tk(),p(function(){return function(u){u=null===u?0:u.W;return dh(eh(),u)}}(a))),f=tk(),g=tk(),k=[vk(46),vk(45)];g=ok(g,(new M).q(k));k=tk();var l=pk(tk(),p(function(){return function(u){u=null===u?0:u.W;return dh(eh(),u)}}(a))),n=tk(),t=[vk(46),pk(tk(),p(function(){return function(u){u=null===u?0:u.W;return dh(eh(),u)}}(a)))];l=[l,mk(n,(new M).q(t))];g=[g,ok(k,(new M).q(l))];e=[e,mk(f,(new M).q(g))];d=[ok(d,(new M).q(e)),sca(tk(),p(function(){return function(u){u=
null===u?0:u.W;return rca().hb(u)}}(a)))];return(new z).e(mk(b,(new M).q(d)),p(function(){return function(u){a:{for(var w=(new Sb).c(u),y=0;;){if(y<(w.U.length|0)){var E=w.R(y);E=null===E?0:E.W;E=!1===dh(eh(),E)}else E=!1;if(E)y=1+y|0;else break}if(y!==(w.U.length|0)){w=ch(oh(),u);if(w instanceof hh){w=w.M;u=(new I).i((new $b).te(u,Rk(),w));break a}if(w instanceof jh){w=w.M;u=(new I).i((new $b).te(u,Sk(),w));break a}throw(new q).i(w);}u=D()}return u}}(a)))}
function Fca(a){var b=tk(),d=[vk(34),Gca(a),vk(34)];return(new z).e(mk(b,(new M).q(d)),p(function(){return function(e){var f=(new Sb).c(e);f=Tk(f,1);f=(new Sb).c(f);var g=f.U.length|0,k=0,l=!1;b:for(;;){if(k!==g){var n=1+k|0;k=f.R(k);k=null===k?0:k.W;l=!(!0===!!l&&92===k)&&92===k;k=n;continue b}break}f=!!l;try{if(1===(e.length|0))var t=!0;else{var u=(new Sb).c(e),w=Uk(u);t=34!==(null===w?0:w.W)}if(t||f)var y=(new I).i((new $b).te(""+e,Rk(),"Closing double quote is missing"));else{var E=zg(),L=(new Sb).c(e),
S=L.U.length|0,ia=Ie(Je(),L.U,1,S),na=(new Sb).c(ia),pa=oi(E,Tk(na,1));y=(new I).i((new $b).te(""+e,Sk(),pa))}}catch(ua){if(ua instanceof Pe)y=(new I).i((new $b).te(""+e,Rk(),"Illegal character after backslash"));else throw ua;}return y}}(a)))}
function Gca(a){return nk(tk(),(new I).i(Le(34)),xb(function(){return function(b,d){d=null===d?0:d.W;if(b instanceof I){var e=b.M;if(92===(null===e?0:e.W)&&34===d)return(new z).e((new I).i(Le(34)),kk())}return b instanceof I&&(b=b.M,92===(null===b?0:b.W)&&92===d)?(new z).e(D(),kk()):34===d?(new z).e((new I).i(Le(34)),lk()):10===d?(new z).e(D(),qk()):(new z).e((new I).i(Le(d)),kk())}}(a)))}
function yca(a){if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/lex/TokenLexer.scala: 12");return a.MK}function Bca(a){var b=r();a=[Hca(a),xca(a),Aca(a),Eca(a),Fca(a),zca(a),Dca(a)];return H(b,(new M).q(a))}
function Hca(a){var b=Ica(a),d=tk(),e=tk(),f=[vk(125),vk(10),vk(13)];e=[b,ok(e,(new M).q(f))];return(new z).e(mk(d,(new M).q(e)),p(function(){return function(g){var k=(new Sb).c(g);k=Ie(Je(),k.U,0,2);if(null===k||"{{"!==k)g=D();else if(k=(new Sb).c(g),k=Uk(k),10===(null===k?0:k.W)?k=!0:(k=(new Sb).c(g),k=Uk(k),k=13===(null===k?0:k.W)),k)g=(new I).i((new $b).te("",Rk(),"End of line reached unexpectedly"));else{k=(new Sb).c(g);var l=D(),n=k.U.length|0,t=0,u=0,w=l;b:for(;;){if(t!==n){l=1+t|0;t=k.R(t);
t=null===t?0:t.W;u|=0;c:{if(w instanceof I){var y=w.M;if(123===(null===y?0:y.W)&&123===t){u=1+u|0;w=t=D();break c}}if(w instanceof I&&(w=w.M,125===(null===w?0:w.W)&&125===t)){u=-1+u|0;w=t=D();break c}w=t=(new I).i(Le(t))}t=l;continue b}break}g=0<(u|0)?(new I).i((new $b).te("",Rk(),"End of file reached unexpectedly")):(new I).i((new $b).te(g,Jca(),g))}return g}}(a,b)))}function Vk(){}Vk.prototype=new m;Vk.prototype.constructor=Vk;Vk.prototype.b=function(){return this};
function Kca(a,b){Lca||(Lca=(new Wk).b());a=(new Xk).c(a);if(a instanceof Yk)b=(new Zk).XI(a,b);else{var d=new Zk;Zk.prototype.XI.call(d,Mca(a),b);b=d}return b}Vk.prototype.$classData=h({YY:0},!1,"org.nlogo.lex.WrapStringInput$",{YY:1,d:1});var Nca=void 0;function Wk(){}Wk.prototype=new m;Wk.prototype.constructor=Wk;Wk.prototype.b=function(){return this};Wk.prototype.$classData=h({ZY:0},!1,"org.nlogo.lex.WrappedInput$",{ZY:1,d:1});var Lca=void 0;function $k(){this.tB=null}$k.prototype=new m;
$k.prototype.constructor=$k;function Oca(a){var b=Pca(a);a.tB.ua(p(function(e){return function(f){var g=al(e,"OTPL");Nb(g,f.De);f.aj.K(g.g)}}(a)));var d=Pca(a);(null===d?null===b:d.m(b))||Oca(a)}function Pca(a){var b=a.tB;a=p(function(){return function(e){return e.aj.H()}}(a));var d=r();return b.xa(a,d.P).gb()}$k.prototype.Ca=function(a){this.tB=a;return this};$k.prototype.$classData=h({$Y:0},!1,"org.nlogo.parse.AgentTypeChecker",{$Y:1,d:1});function bl(){}bl.prototype=new m;
bl.prototype.constructor=bl;bl.prototype.b=function(){return this};function Qca(a,b,d){for(;;){var e=b.Y(),f=(new cl).ag(e).gj.tb,g=Fk();if(null!==f&&f===g)return(new $b).te((new dl).Ca(a),b.X().X(),d);Rca((new cl).ag(e),d)?Sca(el(),fl(d,e.Qb.toUpperCase()),e):("-\x3e"===(new cl).ag(e).gj.Qb?f=!0:(f=e.tb,g=Uf(),f=!(null!==f&&f===g)),f?(Gg(),e=e.ja,Fg("Expected a variable name here",e.Ya,e.Ra,e.$a)):(f=r(),a=a.wc(e,f.P),b=b.X(),f=r(),e=[e.Qb.toUpperCase()],d=e=uc(d,H(f,(new M).q(e)),gl())))}}
function Tca(a,b){var d=a.Y();if(hl((new cl).ag(d)))d=(new I).i(Qca(H(r(),v()),a.X(),b));else if(d=a.Y(),"-\x3e"===(new cl).ag(d).gj.Qb)d=(new I).i((new $b).te((new il).md(!0),a.X(),b));else if(hl((new cl).ag(d)))d=D();else if(Rca((new cl).ag(d),b)){var e=r();d=Uca(H(e,(new M).q([d])),a.X(),b)}else{a=a.X();e=r();var f=[d.Qb.toUpperCase()];b=uc(b,H(e,(new M).q(f)),gl());e=a.Y();if("-\x3e"===(new cl).ag(e).gj.Qb)e=d.tb,f=Gk(),null!==e&&e===f||d.W instanceof xl?d=(new I).i((new $b).te((new yl).ag(d),
a.X(),b)):(Gg(),d=d.ja,Fg("Expected a variable name here",d.Ya,d.Ra,d.$a),d=void 0);else{f=e.tb;var g=Ek();null!==f&&f===g?d=D():(f=r(),d=Uca(H(f,(new M).q([d,e])),a.X(),b))}}return d}
function Vca(a){var b=0;a:for(;;){var d=zl(sc().It,a);if(!d.x()){var e=d.Q().ha();d=d.Q().la();if(null!==e&&(e=e.tb,Ek()===e)){b=1+b|0;a=d;continue a}}d=zl(sc().It,a);if(!d.x()&&(e=d.Q().ha(),d=d.Q().la(),null!==e&&(e=e.tb,Fk()===e))){b=-1+b|0;a=d;continue a}d=zl(sc().It,a);if(!d.x()&&(d=d.Q().ha(),null!==d&&"-\x3e"===d.Qb&&1===b))return!0;d=zl(sc().It,a);if(!d.x()){a=d.Q().la();continue a}r();b=(new I).i(a);if(null!==b.M&&0===b.M.sb(0))return!1;throw(new q).i(a);}}
function Wca(a,b,d){if(Vca(b)){var e=b.zg();if(e.x())e=!1;else{e=e.Q().tb;var f=Ek();e=null!==e&&e===f}}else e=!1;e?(e=b.Vn(),e.x()?e=!1:(e=e.Q().tb,f=Fk(),e=null!==e&&e===f)):e=!1;if(e){b=b.Td(1).me(1);d=Tca(b,d);if(d.x())return D();e=d.Q();if(null!==e)d=e.Ia,b=e.Wa,e=e.Ig,a=p(function(g,k){return function(l){if(null!==l){var n=l.Qb,t=l.tb,u=l.W;if(Uf()===t&&u instanceof xl&&k.Qk().hb(l.Qb.toUpperCase()))return Sg(l,(new Al).yC(n.toUpperCase(),!1),l.Qb,l.tb)}return l}}(a,d)),f=r(),a=b.xa(a,f.P),
a=(new $b).te(d,a,e);else throw(new q).i(e);return(new I).i(a)}return D()}function Uca(a,b,d){for(;;){var e=b.Y();if("-\x3e"===(new cl).ag(e).gj.Qb)if(1<a.ra()){Gg();var f=a.Y().sc().Ya,g=a.Hd();Fg("An anonymous procedures of two or more arguments must enclose its argument list in brackets",f,g.sc().Ra,e.ja.$a)}else e=a.Y(),Sca(el(),fl(d,e.Qb.toUpperCase()),e);else{if(hl((new cl).ag(e)))return D();f=r();a=a.wc(e,f.P);b=b.X()}}}
bl.prototype.$classData=h({gZ:0},!1,"org.nlogo.parse.ArrowLambdaScoper$",{gZ:1,d:1});var Bl=void 0;function cl(){this.gj=null}cl.prototype=new m;cl.prototype.constructor=cl;function Rca(a,b){return Cl(b,a.gj.Qb.toUpperCase())?!0:!1}cl.prototype.ag=function(a){this.gj=a;return this};function hl(a){a=a.gj.tb;var b=Ek();return null!==a&&a===b}cl.prototype.$classData=h({hZ:0},!1,"org.nlogo.parse.ArrowLambdaScoper$RichToken$1",{hZ:1,d:1});function Dl(){this.BH=this.vK=this.tH=null;this.a=0}
Dl.prototype=new m;Dl.prototype.constructor=Dl;
Dl.prototype.b=function(){El=this;var a=Cba(),b=null;b=[];for(var d=a.j.length,e=0;e<d;){var f=(new z).e(a.j[e],e);b.push(f);e=1+e|0}a=la(ab(Fl),b);a=Xb(new Yb,(new Gl).Vi(a),p(function(){return function(k){return null!==k}}(this)));b=p(function(){return function(k){if(null!==k){var l=k.Qc();k=k.ha().toUpperCase();l=Dba(xg(),l);return(new z).e(k,l)}throw(new q).i(k);}}(this));d=(new Hl).Cg(ra(Fl));a.ka.ua(p(function(k,l,n){return function(t){return k.Zl.w(t)?l.Ka(n.w(t)):void 0}}(a,d,b)));a=d.Ea();
Il();b=(new dc).vb(ec());d=0;for(e=a.j.length;d<e;)fc(b,a.j[d]),d=1+d|0;a=b.La;b=xg();d=Cba();e=d.j.length;for(f=0;;){if(f<e){var g=d.j[f];g=!Jl(Kl(),"gray",g)}else g=!1;if(g)f=1+f|0;else break}e=f;b=Dba(b,e>=d.j.length?-1:e);this.tH=a.Uj((new z).e("GREY",b));this.a=(1|this.a)<<24>>24;a=(new z).e("FALSE",!1);b=(new z).e("TRUE",!0);d=Xg();a=[a,b,(new z).e("NOBODY",d),(new z).e("E",2.718281828459045),(new z).e("PI",3.141592653589793)];b=(new dc).vb(ec());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;
this.vK=b.La;this.a=(2|this.a)<<24>>24;if(0===(2&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/Constants.scala: 13");this.BH=this.vK.ul(Xca(this));this.a=(4|this.a)<<24>>24;return this};function Xca(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/Constants.scala: 10");return a.tH}
Dl.prototype.Os=function(a){if(0===(4&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/Constants.scala: 20");return this.BH.Cc(a.toUpperCase())};Dl.prototype.$classData=h({wZ:0},!1,"org.nlogo.parse.Constants$",{wZ:1,d:1});var El=void 0;function Ll(){}Ll.prototype=new m;Ll.prototype.constructor=Ll;Ll.prototype.b=function(){return this};Ll.prototype.$classData=h({DZ:0},!1,"org.nlogo.parse.DelayedBlock$",{DZ:1,d:1});var Yca=void 0;
function Ml(){this.gG=0;this.jG=this.iG=this.hG=this.sF=this.lF=this.jF=this.iF=this.kF=null;this.a=0}Ml.prototype=new m;Ml.prototype.constructor=Ml;
function Zca(a,b,d,e,f,g){var k=H(Gc(),v()),l=Nl(b),n=-1+l|0;if(!(0>=l))for(l=0;;){var t=l,u=Ec(),w=b.Na,y=-1+Ol(b.Na)|0;k.Rj(Pl(u,b,f,d,e,Rh(w,t<y?t:y)|0,g));if(l===n)break;l=1+l|0}Ql(b)&&(n=f.Y().tb,l=Ek(),null!==n&&n===l?d=Pl(a,b,f,d,e,Rl(b.Na)|0,g):(a=f.Y().sc().$a,b=k.Vn(),b.x()?b=D():(b=b.Q(),b=(new I).i(b.sc().Ra)),d=(b.x()?d.Ra:b.Q())|0,d=Db((new Gb).c(a),Pk(d,d,a),!0)),k.Rj(d));return k.tc()}
Ml.prototype.b=function(){Sl=this;this.gG=-1;this.a|=1;this.kF="Expected command.";this.a|=2;this.iF="Expected closing bracket.";this.a|=4;this.jF="Expected a closing parenthesis here.";this.a|=8;this.lF="Expected reporter.";this.a|=16;this.sF="To use a non-default number of inputs, you need to put parentheses around this.";this.a|=32;this.hG="No closing bracket for this open bracket.";this.a|=64;this.iG="No closing parenthesis for this open parenthesis.";this.a|=128;this.jG="Missing input on the left.";
this.a|=256;return this};function $ca(a,b){if(null===a)throw(new xe).b();return a.Aa?a.Oa:ye(a,1<Nl(b)?"inputs":"input")}
function ada(a,b,d,e,f,g){if(d&&Tl(b)){d=e.sc();var k=Qg(e.ct());a:{var l=b.Na,n=H(r(),v());for(;;){var t=f.Y();if(null!==t){var u=t.tb;if(Dk()===u){f=n;break a}}if(null!==t&&(u=t.tb,t=t.W,Uf()===u&&t&&t.$classData&&t.$classData.Sb.$&&(l.Y()|0)!==td(C())&&Ul(t.A()))){Gg();if(n.za()!==Vl(b)){f=Ec();if(0===(32&f.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 702");Fg(f.sF,d.Ya,d.Ra,d.$a)}f=n;break a}t=Pl(a,b,f,d,k,l.Y()|
0,g);l=l.X().ef()?l.X():l;u=r();n=n.wc(t,u.P)}}}else d=e.sc(),f=Zca(a,b,d,Qg(e.ct()),f,g);d=e.sc();return bda(a,b,f,d,Qg(e.ct()),g)}
function cda(a,b,d,e){var f=b.wz().X().Pa().un(),g=!Wl(C(),d,zi(C()));if(Wl(C(),d,Mi())){if(b instanceof Xl)a=b.WA;else{if(!(b instanceof Yl))throw(new q).i(b);a=b.wz()}d=a.me(2);e=H(r(),v());a:for(;;){if(d.x())e.x()||(d=e.Y().tb,e=Ck(),null!==d&&d===e&&(Gg(),d=b.wz().Hd().sc(),Fg("Expected close paren here",d.Ya,d.Ra,d.$a)));else{f=d.Y().tb;g=Ek();null!==f&&f===g?(f=d.X(),d=d.Y(),g=r(),e=e.Fd(d,g.P),d=f):(f=d.Y().tb,g=Ck(),null!==f&&f===g?(f=d.X(),d=d.Y(),g=r(),e=e.Fd(d,g.P),d=f):(f=d.Y().tb,g=Fk(),
null!==f&&f===g?(e.x()?f=!1:(f=e.Y().tb,g=Ck(),f=null!==f&&f===g),f&&(Gg(),f=d.Y().sc(),Fg("Expected close paren before close bracket here",f.Ya,f.Ra,f.$a)),e.x()?f=!0:(f=e.Y().tb,g=Ek(),f=!(null!==f&&f===g)),f&&(Gg(),f=d.Y().sc(),Fg("Closing bracket has no matching open bracket here",f.Ya,f.Ra,f.$a)),d=d.X(),e=e.X()):(f=d.Y().tb,g=Dk(),null!==f&&f===g?(e.x()?f=!1:(f=e.Y().tb,g=Ek(),f=null!==f&&f===g),f&&(Gg(),f=d.Y().sc(),Fg("Expected close bracket before close paren here",f.Ya,f.Ra,f.$a)),e.x()?
f=!0:(f=e.Y().tb,g=Ck(),f=!(null!==f&&f===g)),f&&(Gg(),f=d.Y().sc(),Fg("Closing paren has no matching open paren here",f.Ya,f.Ra,f.$a)),d=d.X(),e=e.X()):d=d.X())));continue a}break}d=(new Zl).Ca(a.X().me(2));d.G(a.Y());e=a.Y().sc().Ya;b=b.sc().Ra;a=a.Y();return $l(new zb,d,Pk(e,b,a.sc().$a))}if(b.GC()&&!b.nv())return dda(a,b.Nd,f,b);if(b.GC()&&b.nv())return eda(b.Nd,f,b);if(Wl(C(),d,Ii(C()))){a=fda(a,d,e,f,b);if(null===a)throw(new q).i(a);d=a.la();return Eb(a.ha(),Pk(b.lh.ja.Ya,d.ja.Ra,d.ja.$a))}if(Wl(C(),
d,Hi(C()))){a=gda(f,e,b);if(null===a)throw(new q).i(a);d=a.la();return am(Pk(b.lh.ja.Ya,d.ja.Ra,d.ja.$a),a.ha(),!1)}if(Wl(C(),d,td(C()))&&!b.nv()&&g)return dda(a,(new il).md(!1),f,b);if(Wl(C(),d,md(C()))&&b.nv()&&g)return eda((new il).md(!1),f,b);if(Wl(C(),d,zi(C()))){d=hda(ida(new bm,cm()),b.lh,f);if(null===d)throw(new q).i(d);a=d.la();d=(new dm).i(d.ha());e=Sk();d.G(Nk(new Ok,"",e,null,Pk(b.lh.ja.Ya,a.ja.Ra,a.ja.$a)));return $l(new zb,d,Pk(b.lh.ja.Ya,a.ja.Ra,a.ja.$a))}Gg();a="Expected "+Pi(Si(),
d)+" here, rather than a list or block.";b=b.sc();Fg(a,b.Ya,b.Ra,b.$a)}function em(a,b,d){return b.Aa?b.Oa:jda(a,b,d)}function kda(a,b,d){var e=b.W;if(!e.A().ns)throw(new fm).ag(b);d=lda(a,Vl(e.A()),e.E(),d);if(null===d)throw(new q).i(d);a=d.ha();d=d.la();if(Ql(e.A())){var f=Db((new Gb).c(b.ja.$a),b.ja,!0),g=r();d=d.wc(f,g.P)}a=(new gm).bv((new hm).Ca(a));a.G(b);e=(new Ib).xj(e,d,b.ja);d=b.ja;f=r();e=am(d,H(f,(new M).q([e])),!0);d=r();return(new zb).Jc(a,H(d,(new M).q([e])),b.ja)}
function mda(a,b,d,e,f,g){var k=b.Y(),l=f===(td(C())|md(C())),n=l||f===td(C()),t=l||f===md(C()),u=k.tb;if(Ck()===u){d=k.ja.$a;l=b.ma();Ke();n=l.tb;t=Ck();im(0,null!==n&&n===t);n=nda(Ec(),b,!0,f,g);Gg();f=b.Y().tb;t=Tf();null!==f&&f===t&&(f=jm(),k=k.ja,Fg(f,k.Ya,k.Ra,k.$a));k=b.ma();Gg();f=k.tb;t=Fc();null!==f&&f===t&&(f=jm(),t=l.ja,Fg(f,t.Ya,t.Ra,t.$a));Gg();f=k.tb;t=Dk();if(null===f||f!==t)f=oda(),t=k.ja,Fg(f,t.Ya,t.Ra,t.$a);k=n.qu(Pk(l.ja.Ya,k.ja.Ra,d))}else if(Ek()===u)k=pda(a,k,b,g);else if(Uf()!==
u&&Tf()!==u||!Wl(C(),f,Ni()))if(Uf()===u||Sk()===u){b.ma();t=k.tb;if(Sk()===t)f=(new dm).i(k.W),f.G(k),f=(new z).e(f.A(),$l(new zb,f,k.ja));else if(Uf()!==t&&km(lm(),"unexpected token type: "+k.tb),t=k.W,t instanceof mm||t instanceof xl)if(f===Ni())f=(new z).e(t.A(),$l(new zb,t,k.ja));else{qda||(qda=(new nm).b());f=rda(t,k,g);if(f.x())f=D();else{f=f.Q();if(null===f)throw(new q).i(f);f=f.ha();f=(new I).i((new z).e(f.A(),$l(new zb,f,k.ja)))}if(f.x()){Gg();t=Ng();var w=[k.Qb.toUpperCase()];u=t.Dm.ci("compiler.LetVariable.notDefined",
J(function(pa,ua){return function(){throw(new Pe).c("coding error, bad translation key: "+ua+" for Errors");}}(t,"compiler.LetVariable.notDefined")));var y=w.length|0;if(0>=y)var E=0;else t=y>>31,E=(0===t?-1<(-2147483648^y):0<t)?-1:y;r();om();t=[];var L=0,S=w.length|0;0>E&&pm(qm(),0,y,1,!1);for(S=S<E?S:E;L<S;){var ia=w[L],na=L;0>E&&pm(qm(),0,y,1,!1);if(0>na||na>=E)throw(new Q).c(""+na);ia=(new z).e(ia,na);t.push(ia);L=1+L|0}w=t.length|0;y=0;E=u;a:for(;;){if(y!==w){u=1+y|0;E=(new z).e(E,t[y]);b:{y=
E.ub;S=E.Hb;if(null!==S&&(L=S.ha(),S=S.Qc(),og(L))){E=L;E=Pb(Na(),y,"\\{"+S+"\\}",E);break b}throw(new q).i(E);}y=u;continue a}break}k=k.ja;Fg(E,k.Ya,k.Ra,k.$a)}f=f.Q()}else if(!Ul(t.A())||n)f=(new z).e(t.A(),$l(new zb,t,k.ja));else{if(!(t instanceof rm&&d))throw(new sm).ag(k);f=(new tm).b();f.G(k);f=(new z).e(f.A(),$l(new zb,f,k.ja))}if(null===f)throw(new q).i(f);k=f.ha();f=f.la();k=n&&!d&&!sda(f.xe)&&(l||0<Vl(k))?tda(a,f,f.xe,g):uda(f,ada(a,k,d,f,b,g))}else{if(Tf()!==u||!t)throw(new fm).ag(k);b.ma();
k=kda(a,k,g)}else b.ma(),d=(new mm).b(),Sg(k,d,k.Qb,k.tb),k=$l(new zb,d,k.ja);return vda(a,k,b,e,g)}function dda(a,b,d,e){d=fda(a,mc(),e.Wq,d,e);if(null===d)throw(new q).i(d);a=d.ha();d=d.la();b=(new um).bv(b);b.G(e.lh);a=H(r(),(new M).q([a]));return(new zb).Jc(b,a,Pk(e.lh.ja.Ya,d.ja.Ra,e.sc().$a))}
function Pl(a,b,d,e,f,g,k){try{return mda(a,d,!1,b.Tp,g,k)}catch(l){if(d=vm(kg(),l),null!==d)if(d instanceof sm||d instanceof fm)Gg(),a=wm(a,b,f,!0),Fg(a,e.Ya,e.Ra,e.$a);else throw jg(kg(),d);else throw l;}}
function Hc(a,b,d,e){var f=b.Y(),g=f.tb;if(Ck()===g){f=f.ja.$a;a=b.ma();Ke();d=a.tb;g=Ck();im(0,null!==d&&d===g);e=Hc(Ec(),b,!0,e);b=b.ma();Gg();d=b.tb;g=Fc();null!==d&&d===g&&(d=jm(),g=a.ja,Fg(d,g.Ya,g.Ra,g.$a));Gg();d=b.tb;g=Dk();if(null===d||d!==g)d=oda(),g=b.ja,Fg(d,g.Ya,g.Ra,g.$a);e=(new z).e(e,Pk(a.ja.Ya,b.ja.Ra,f));b=e.ub;f=e.Hb;if(null!==b)e=b.la(),b=b.ha();else throw(new q).i(e);return(new z).e((new Ib).xj(b.Od,b.ta,f),e)}if(Tf()===g){b.ma();g=f.W;var k=b.Y().tb,l=Fc();k=null===k||k!==l?
(new I).i(b.Y()):D();wda||(wda=(new xm).b());k=xda(g,k,e);if(k.x())k=D();else{k=k.Q();if(null===k)throw(new q).i(k);l=k.la();k=(new I).i((new z).e(yda(k.ha(),f.ja),l))}e=k.x()?(new z).e(yda(g,f.ja),e):k.Q();if(null===e)throw(new q).i(e);f=e.ha();e=e.la();b=ada(a,g.A(),d,f,b,e);return(new z).e(zda(f,b),e)}b=f.W;if((b instanceof mm||b instanceof xl)&&!Cl(e,f.Qb.toUpperCase())){Gg();b=Ng();a=[f.Qb.toUpperCase()];e=b.Dm.ci("compiler.LetVariable.notDefined",J(function(u,w){return function(){throw(new Pe).c("coding error, bad translation key: "+
w+" for Errors");}}(b,"compiler.LetVariable.notDefined")));d=a.length|0;0>=d?g=0:(b=d>>31,g=(0===b?-1<(-2147483648^d):0<b)?-1:d);r();om();b=[];k=0;l=a.length|0;0>g&&pm(qm(),0,d,1,!1);for(l=l<g?l:g;k<l;){var n=a[k],t=k;0>g&&pm(qm(),0,d,1,!1);if(0>t||t>=g)throw(new Q).c(""+t);n=(new z).e(n,t);b.push(n);k=1+k|0}a=b.length|0;d=0;g=e;a:for(;;){if(d!==a){e=1+d|0;g=(new z).e(g,b[d]);b:{d=g.ub;l=g.Hb;if(null!==l&&(k=l.ha(),l=l.Qc(),og(k))){g=k;g=Pb(Na(),d,"\\{"+l+"\\}",g);break b}throw(new q).i(g);}d=e;continue a}break}f=
f.ja;Fg(g,f.Ya,f.Ra,f.$a)}else Gg(),b=Ada(a),f=f.ja,Fg(b,f.Ya,f.Ra,f.$a)}function sda(a){if(Wl(C(),a.A().Xa,Mi()|Ni()))return!0;for(a=a.A().Na;!a.x();){var b=a.Y()|0;if(Wl(C(),b,Mi()|Ni()))return!0;a=a.X()}return!1}
function jda(a,b,d){if(null===b)throw(new xe).b();if(b.Aa)return b.Oa;d=d.Na;a=function(){return function(k){k|=0;Na();k=Pi(Si(),k);if(null===k)throw(new xe).b();var l=eg(dg(),"anything");k=fg(l,k,k.length|0);ym(k);mh(k)?(l=(new zm).b(),Am(k,l,"any input"),Bm(k,l),k=l.l()):k=k.Ep;return k}}(a);var e=A().P;if(e===A().P)if(d===v())a=v();else{e=d.Y();var f=e=K(a(e),v());for(d=d.X();d!==v();){var g=d.Y();g=K(a(g),v());f=f.Da=g;d=d.X()}a=e}else{for(e=Oc(d,e);!d.x();)f=d.Y(),e.Ka(a(f)),d=d.X();a=e.Ea()}return ye(b,
a)}
function pda(a,b,d,e){a:{var f=(new Cm).Nl((new Dm).Cg(ra(Bda))),g=0;for(;;){var k=d.ma(),l=k.tb,n=Ek();if(null!==l&&l===n)f=f.Rj(k),g=1+g|0;else if(l=k.tb,n=Fk(),null!==l&&l===n){if(1===g){a=f.Rj(k).tc();break a}f=f.Rj(k);g=-1+g|0}else l=k.tb,n=Fc(),null===l||l!==n?f=f.Rj(k):(Gg(),k=Em(a),l=b.ja,Fg(k,l.Ya,l.Ra,l.$a))}}a=a.tc();Yca||(Yca=(new Ll).b());a:{a=a.X();Bl||(Bl=(new bl).b());d=Bl;f=r();d=Wca(d,a.Fd(b,f.P),e);if(d instanceof I&&(f=d.M,null!==f)){e=f.Ia;d=f.Wa;f=f.Ig;g=a.Hd();k=r();k=a.Fd(b,k.P);
l=Qk();n=r();a=new Xl;k=k.wc(l,n.P);Xl.prototype.YI.call(a,b,e,d,g,k,f,Pk(b.ja.Ya,g.ja.Ra,b.ja.$a));b=a;break a}if(D()===d)d=new Yl,f=a.Vn(),f.x()?f=D():(f=f.Q(),f=(new I).i(f.ja.Ra)),f=(f.x()?b.ja.Ra:f.Q())|0,Yl.prototype.ZI.call(d,b,a,e,Pk(b.ja.Ya,f,b.ja.$a)),b=d;else throw(new q).i(d);}return b}function am(a,b,d){b=(new Gb).Bp(a.$a,b);return Db(b,a,d)}
function nda(a,b,d,e,f){try{if(0===(1&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 23");return mda(a,b,d,a.gG,e,f)}catch(g){if(g instanceof sm)b=g,Gg(),a=Cda(a),b=b.vw.ja,Fg(a,b.Ya,b.Ra,b.$a);else if(g instanceof fm){b=g;Gg();if(0===(16&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 701");b=b.vw.ja;Fg(a.lF,b.Ya,b.Ra,b.$a)}else throw g;
}}function Ada(a){if(0===(2&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 698");return a.kF}function Fm(a,b,d,e,f){a=d&&d.$classData&&d.$classData.Sb.NF?cda(a,d,b,f):d;Gg();Wl(C(),b,a.Fj())||(d=0===(b&ti())&&0!==(a.Fj()&~ti())?a.Fj()&~ti():a.Fj(),b=e+" expected this input to be "+Pi(Si(),b)+", but got "+Pi(Si(),d)+" instead",e=a.sc(),Fg(b,e.Ya,e.Ra,e.$a));return a}
function jm(){var a=Ec();if(0===(128&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 705");return a.iG}function gda(a,b,d){for(var e=Fk(),f=H(Gc(),v());;){var g=a.Y().tb;if(null===g||g!==e){Gg();var k=a.Y().tb,l=Fc();g=d.lh;null!==k&&k===l&&(k=Em(Ec()),g=g.ja,Fg(k,g.Ya,g.Ra,g.$a));b=Hc(Ec(),a,!1,b);if(null===b)throw(new q).i(b);g=b.ha();b=b.la();f.Rj(g)}else break}d=f.tc();return(new z).e(d,a.ma())}
function wm(a,b,d,e){var f=(new we).b(),g=(new we).b(),k=(new we).b(),l=(new we).b(),n;if(n=e&&Tl(b))n=b.nt,n=0===((n.x()?Gm(b):n.Q())|0);if(n)k=d+" expected "+Nl(b)+" "+(f.Aa?f.Oa:$ca(f,b))+" on the right or any number of inputs when surrounded by parentheses";else if(e){if(g.Aa)g=g.Oa;else{if(null===g)throw(new xe).b();g=g.Aa?g.Oa:ye(g,Tl(b)?" at least":"")}d=d+" expected"+g+" "+Nl(b)+" "+(f.Aa?f.Oa:$ca(f,b));if(k.Aa)k=k.Oa;else{if(null===k)throw(new xe).b();k=k.Aa?k.Oa:ye(k,Ul(b)?" on the right":
"")}k=d+k}else k=d+" expected "+Pi(Si(),b.Xa)+" on the left";if(e){a:{for(e=em(a,l,b);!e.x();){if("any input"!==e.Y()){e=!1;break a}e=e.X()}e=!0}if(e)return k+".";e=em(a,l,b);if(1===Ol(e))return a=em(a,l,b),k+", "+bc(a,"","","")+".";e=em(a,l,b);e=Hm(e,1).Jb(", ");a=em(a,l,b);return k+", "+e+" and "+Rl(a)+"."}return k}
function oda(){var a=Ec();if(0===(8&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 700");return a.jF}
function lda(a,b,d,e){b=(new P).N(1,b,1);e=(new z).e(H(r(),v()),e);e=Sh(b,e,xb(function(){return function(f,g){f=(new z).e(f,g|0);g=f.ub;if(null!==g){f=g.ha();g=g.la();var k=gl();for(var l=D(),n=g.Mr;l.x();){var t=("_"+n).toUpperCase();Cl(g,t)?n=1+n|0:l=(new I).i((new z).e(t,n))}a:{if(l instanceof I&&(n=l.M,null!==n)){l=n.Qc();n=n.ha();break a}throw(new q).i(l);}l|=0;k=(new z).e(n,Im(new Jm,g.fj.Uj((new z).e(n,k)),1+l|0));if(null===k)throw(new q).i(k);g=k.ha();k=k.la();l=r();return(new z).e(f.wc(g,
l.P),k)}throw(new q).i(f);}}(a)));if(null===e)throw(new q).i(e);e=e.ha();a=p(function(f,g){return function(k){k=(new Al).yC(k,!0);k.G(g);return $l(new zb,k,Pk(g.ja.Ya,g.ja.Ra,g.ja.$a))}}(a,d));d=r();a=e.xa(a,d.P);return(new z).e(e,a)}
function fda(a,b,d,e,f){a=Fm(a,mc(),nda(a,e,!1,b,d),null,d);e=e.ma();Gg();b=e.tb;d=Fc();f=f.lh;null!==b&&b===d&&(b=Em(Ec()),f=f.ja,Fg(b,f.Ya,f.Ra,f.$a));Gg();f=e.tb;b=Fk();if(null===f||f!==b){f=Ec();if(0===(4&f.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 699");b=e.ja;Fg(f.iF,b.Ya,b.Ra,b.$a)}return(new z).e(a,e)}
function bda(a,b,d,e,f,g){Km||(Km=(new Lm).b());var k=H(Km,d),l=0;if(Ul(b)){l=b.Xa;Gg();if(!(1<=d.za())){var n=wm(Ec(),b,f,!1);Fg(n,e.Ya,e.Ra,e.$a)}k.Kf(0,Fm(a,l,d.R(0),f,g));l=1}n=0;for(var t=b.Na;;){if(n<Ol(t)){C();var u=si();u=!Wl(0,u,Rh(t,n)|0)}else u=!1;if(u){n===(-1+Ol(t)|0)&&d.za()===(-1+Ol(t)|0)?(C(),u=Oi(),u=Wl(0,u,Rh(t,n)|0)):u=!1;if(u)return H(Mm(),k);Gg();d.za()>l||(u=wm(Ec(),b,f,!0),Fg(u,e.Ya,e.Ra,e.$a));k.Kf(l,Fm(a,Rh(t,n)|0,d.R(l),f,g));n=1+n|0;l=1+l|0}else break}if(n<Ol(t)){u=-1+d.za()|
0;for(var w=-1+Ol(t)|0;;){if(0<=w){C();var y=si();y=!Wl(0,y,Rh(t,w)|0)}else y=!1;if(y)Gg(),d.za()>u&&-1<u||(y=wm(Ec(),b,f,!0),Fg(y,e.Ya,e.Ra,e.$a)),k.Kf(u,Fm(a,Rh(t,w)|0,d.R(u),f,g)),w=-1+w|0,u=-1+u|0;else break}for(;l<=u;)k.Kf(l,Fm(a,Rh(t,n)|0,d.R(l),f,g)),l=1+l|0}return H(Mm(),k)}
function eda(a,b,d){b=gda(b,d.Wq,d);if(null===b)throw(new q).i(b);var e=b.ha();b=b.la();a=(new gm).bv(a);a.G(d.lh);e=am(Pk(d.lh.ja.Ya,b.ja.Ra,d.sc().$a),e,!1);e=H(r(),(new M).q([e]));return(new zb).Jc(a,e,Pk(d.lh.ja.Ya,b.ja.Ra,d.sc().$a))}
function vda(a,b,d,e,f){var g=b;for(b=!1;!b;){var k=d.Y(),l=k.tb,n=Uf();if(null!==l&&l===n)if(l=k.W,n=l.A(),Ul(n)&&(n.Tp>e||n.it&&n.Tp===e)){d.ma();Gg();if(null===g){var t=Cda(Ec()),u=k.ja;Fg(t,u.Ya,u.Ra,u.$a)}k=Pk(g.sc().Ya,k.ja.Ra,k.ja.$a);t=Zca(a,n,k,Qg(l),d,f);u=r();g=bda(a,n,t.Fd(g,u.P),k,Qg(l),f);n=g.Hd().sc().Ra;g=(new zb).Jc(l,g,Pk(k.Ya,n,k.$a))}else b=!0;else b=!0}return g}
function tda(a,b,d,e){e=lda(a,Vl(d.A()),d.E(),e);if(null===e)throw(new q).i(e);a=e.la();e=(new um).bv((new hm).Ca(e.ha()));e.G(d.E());var f=r();b=[uda(b,a)];return(new zb).Jc(e,H(f,(new M).q(b)),d.E().ja)}function Cda(a){if(0===(256&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 706");return a.jG}
function Em(a){if(0===(64&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ExpressionParser.scala: 704");return a.hG}Ml.prototype.$classData=h({EZ:0},!1,"org.nlogo.parse.ExpressionParser$",{EZ:1,d:1});var Sl=void 0;function Ec(){Sl||(Sl=(new Ml).b());return Sl}function Nm(){}Nm.prototype=new m;Nm.prototype.constructor=Nm;Nm.prototype.b=function(){return this};
function Om(a,b){var d=!1,e=null;return b instanceof dm&&(d=!0,e=b,a=e.W,a instanceof rg)?(b=Pm(),Zb(b,a,!0,!1)):d?e.E().Qb:b instanceof gm||b instanceof Al&&b.Mj?"":b.E().Qb}function Dda(a,b,d){return Zc("",b,p(function(){return function(e){return Om(Qm(),e)}}(a)),d)}function Eda(){var a=Qm();p(function(){return function(b){return Om(Qm(),b)}}(a))}Nm.prototype.$classData=h({JZ:0},!1,"org.nlogo.parse.Formatter$",{JZ:1,d:1});var Rm=void 0;function Qm(){Rm||(Rm=(new Nm).b());return Rm}
function Sm(){this.sm=null}Sm.prototype=new m;Sm.prototype.constructor=Sm;function Yc(a){var b=new Sm;b.sm=a;return b}function Xc(a,b){return Zc(""+a.sm.Qb+b,a.sm.zk,a.sm.Jm,a.sm.Mf)}Sm.prototype.$classData=h({KZ:0},!1,"org.nlogo.parse.Formatter$RichFormat",{KZ:1,d:1});function Fda(){var a=r(),b=(new Tm).b(),d=(new Um).b(),e=(new Vm).b();return H(a,(new M).q([b,d,e,new Wm]))}
function taa(a,b){b=zaa(a,b);if(null===b)throw(new q).i(b);var d=b.ha();b=b.la();d=Fda().Ub(d,xb(function(f){return function(g,k){k=p(function(n,t){return function(u){return t.Fe(u)}}(f,k));var l=r();return g.xa(k,l.P)}}(a)));var e=(new Xm).b();d.ua(p(function(f,g){return function(k){Nb(g,k.De)}}(a,e)));Oca((new $k).Ca(d));e=(new qn).b();a=p(function(f,g){return function(k){return g.Fe(k)}}(a,e));e=r();a=d.xa(a,e.P);return(new z).e(a,b)}function xm(){}xm.prototype=new m;xm.prototype.constructor=xm;
xm.prototype.b=function(){return this};
function xda(a,b,d){var e=!1,f=null;if(a instanceof rn){e=!0;f=a;var g=f.fd;if(D()===g){e=!1;g=null;if(b instanceof I&&(e=!0,g=b,a=g.M,null!==a)){b=a.Qb;var k=a.tb;if(Uf()===k)return b=b.toUpperCase(),e=(new sn).c(b),g=d.Os(b),g.x()||(g=g.Q(),Gg(),g="There is already a "+tn(el(),g)+" called "+b,a=a.ja,Fg(g,a.Ya,a.Ra,a.$a)),(new I).i((new z).e(Gda(f,e),Hda(d,b,(new un).Ws(e))))}e&&(d=g.M,Gg(),d=d.ja,Fg("Expected variable name here",d.Ya,d.Ra,d.$a));return D()}}return e&&(f=f.fd,f instanceof I)?(f=
f.M,(new I).i((new z).e(a,Hda(d,f.pa.toUpperCase(),(new un).Ws(f))))):D()}xm.prototype.$classData=h({PZ:0},!1,"org.nlogo.parse.LetScope$",{PZ:1,d:1});var wda=void 0;function nm(){}nm.prototype=new m;nm.prototype.constructor=nm;nm.prototype.b=function(){return this};function rda(a,b,d){if(a instanceof xl){a=d.Os(b.Qb.toUpperCase());b=(new vn).ag(b);a.x()?a=D():(b=vd(new wd,b),a=a.Q(),a=b.ed(a));if(a.x())return D();a=a.Q();return(new I).i((new z).e(a,d))}return D()}
nm.prototype.$classData=h({QZ:0},!1,"org.nlogo.parse.LetVariableScope$",{QZ:1,d:1});var qda=void 0;function bm(){this.eF=this.cF=this.bF=this.aF=this.Bba=null;this.a=0}bm.prototype=new m;bm.prototype.constructor=bm;
function hda(a,b,d){for(var e=Ida(wn(),v()),f=D();!f.aa();){var g=d.ma(),k=g.tb;if(Fk()===k)f=(new I).i(g);else if(Fc()===k){Gg();g=a;if(0===(32&g.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/LiteralParser.scala: 25");k=b.ja;Fg(g.eF,k.Ya,k.Ra,k.$a)}else e=xn(e,yn(a,g,d))}return(new z).e(e,f.Q())}
function yn(a,b,d){var e=b.tb;if(Jca()===e)Gg(),a=Jda(),b=b.ja,Fg(a,b.Ya,b.Ra,b.$a);else{if(Sk()===e)return b.W;if(Ek()===e){a=hda(a,b,d);if(null===a)throw(new q).i(a);return a.ha()}if(wca()===e)Gg(),b=d.ma(),a=Jda(),b=b.sc(),Fg(a,b.Ya,b.Ra,b.$a);else{if(Ck()===e){b=yn(a,d.ma(),d);d=d.ma();Gg();e=d.tb;var f=Dk();if(null===e||e!==f){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/LiteralParser.scala: 20");d=d.ja;Fg(a.aF,d.Ya,
d.Ra,d.$a)}return b}if(Hk()===e)return yn(a,d.ma(),d);Gg();if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/LiteralParser.scala: 21");b=b.ja;Fg(a.bF,b.Ya,b.Ra,b.$a)}}}
function ida(a,b){a.Bba=b;a.aF="Expected a closing parenthesis.";a.a=(1|a.a)<<24>>24;a.bF="Expected a literal value.";a.a=(2|a.a)<<24>>24;a.a=(4|a.a)<<24>>24;a.cF="Extra characters after literal.";a.a=(8|a.a)<<24>>24;a.a=(16|a.a)<<24>>24;a.eF="No closing bracket for this open bracket.";a.a=(32|a.a)<<24>>24;return a}bm.prototype.$classData=h({TZ:0},!1,"org.nlogo.parse.LiteralParser",{TZ:1,d:1});function zn(){this.a=!1}zn.prototype=new m;zn.prototype.constructor=zn;
function Kda(a,b,d){var e=b.ep;if(e instanceof An){var f=vba(Qb(),e).Xk(p(function(n,t){return function(u){return Cl(t,u.toUpperCase())}}(a,d)),!1),g=p(function(){return function(n){return(new z).e(n,Bn())}}(a)),k=r();f=f.xa(g,k.P);g=sba(Qb(),e).Xk(p(function(n,t){return function(u){return Cl(t,u.toUpperCase())}}(a,d)),!1);k=p(function(){return function(n){return(new z).e(n,Cn())}}(a));var l=r();g=g.xa(k,l.P);k=r();f.oc(g,k.P).ua(p(function(n,t,u,w){return function(y){if(null!==y){y=y.ha();Gg();Dn();
var E=fl(u,y.toUpperCase());E=tn(el(),E);var L=w.Zk.f.ja;Fg("Defining a breed ["+t.am.pa+" "+t.eg.pa+"] redefines "+y+", a "+E,L.Ya,L.Ra,L.$a)}else throw(new q).i(y);}}(a,e,d,b)))}}zn.prototype.b=function(){return this};
function Lda(a,b,d){Gg();var e=d.Zk.pa;if(!(e=a.toLowerCase()!==(null===e?null:e.toLowerCase()))){if(a=!!(b&&b.$classData&&b.$classData.Sb.mn))a=d.yo,a=En()===b&&a instanceof Fn||b instanceof Fn&&En()===a?!0:Gn()===b&&a instanceof Hn||b instanceof Hn&&Gn()===a?!0:b instanceof Hn&&a instanceof Hn||b instanceof Fn&&a instanceof Fn;e=a}a=d.Zk.f;e||(Dn(),d=d.Zk.pa,b="There is already a "+tn(el(),b)+" called "+d,d=a.ja,Fg(b,d.Ya,d.Ra,d.$a))}
function Mda(a,b){var d=b.Pa();return(new In).bg(d,p(function(e,f){return function(g){var k=f.Do(p(function(n,t){return function(u){return t!==u}}(e,g)));g=p(function(n,t){return function(u){return(new z).e(t,u)}}(e,g));var l=r();return k.xa(g,l.P)}}(a,b)))}function Nda(a,b){Gg();a=b.f;"-\x3e"===b.pa&&(b=a.ja,Fg("-\x3e can only be used to create anonymous procedures",b.Ya,b.Ra,b.$a))}
function Oda(a,b){return b.Ub(Pda(),xb(function(){return function(d,e){return e instanceof An?uc(uc(d,vba(Qb(),e),Bn()),sba(Qb(),e),Cn()):d}}(a)))}function Qda(a,b){if(a instanceof Jn&&b instanceof Jn){var d=a.Tg,e=b.Tg;if(null===d?null===e:d.m(e))return(new I).i((new z).e(a.Tg.pa,b.Tg.f))}return a instanceof Kn&&b instanceof Kn?(new I).i((new z).e("EXTENSIONS",b.f)):a instanceof Ln&&b instanceof Ln?(new I).i((new z).e("INCLUDES",b.f)):D()}function Rda(a,b){return"Redeclaration of "+b}
function Sda(a,b){b.Do(p(function(){return function(f){return f instanceof Mn}}(a))).ua(p(function(f){return function(g){if(g instanceof Mn)g=g.Mn,g.ua(p(function(k,l){return function(n){Nda(Dn(),n);Gg();var t=1===l.pB(p(function(w,y){return function(E){return E.pa===y.pa}}(k,n))),u=n.f;t||(n=Tda(Dn(),n),u=u.ja,Fg(n,u.Ya,u.Ra,u.$a))}}(f,g)));else throw(new q).i(g);}}(a)));b=Mda(a,b);for(b=(new Nn).bg(b,p(function(){return function(f){return null!==f}}(a)));b.qa();){var d=b.ma();if(null!==d){d=Qda(d.ha(),
d.la());var e=Uda(new On,d,p(function(){return function(f){return null!==f}}(a)));d=e.ka;e=e.Zl;d=d.x()||e.w(d.Q())?d:D();if(!d.x())if(e=d.Q(),null!==e)d=e.ha(),e=e.la(),Gg(),d=Rda(Dn(),d),e=e.ja,Fg(d,e.Ya,e.Ra,e.$a);else throw(new q).i(e);}else throw(new q).i(d);}}function Tda(a,b){return"There is already a local variable called "+b.pa+" here"}
function Vda(a,b){b=b.Ub(H(r(),v()),xb(function(d){return function(e,f){if(f instanceof Jn){var g=f.dg,k=f.Tg.pa.toUpperCase();if("TURTLES-OWN"===k)f=p(function(t,u){return function(w){return Pn(new Qn,u,w,En(),!0)}}(d,f)),k=r(),f=g.xa(f,k.P);else if("PATCHES-OWN"===k)f=p(function(t,u){return function(w){return Pn(new Qn,u,w,Rn(),!0)}}(d,f)),k=r(),f=g.xa(f,k.P);else if("LINKS-OWN"===k)f=p(function(t,u){return function(w){return Pn(new Qn,u,w,Gn(),!0)}}(d,f)),k=r(),f=g.xa(f,k.P);else if("GLOBALS"===
k)f=p(function(t,u){return function(w){return Pn(new Qn,u,w,Sn(),!0)}}(d,f)),k=r(),f=g.xa(f,k.P);else{k=(new Sb).c(k);k=Wda(k);var l=e.Hh(p(function(t,u){return function(w){return w.Zk.pa===u}}(d,k)));l.x()?f=D():(l=l.Q().yo,Tn()===l?(f=p(function(t,u,w){return function(y){return Pn(new Qn,u,y,(new Hn).c(w),!0)}}(d,f,k)),k=r(),f=g.xa(f,k.P)):Un()===l?(f=p(function(t,u,w){return function(y){return Pn(new Qn,u,y,(new Fn).c(w),!0)}}(d,f,k)),k=r(),f=g.xa(f,k.P)):f=H(r(),v()),f=(new I).i(f));f=f.x()?H(r(),
v()):f.Q()}g=r();return e.oc(f,g.P)}if(f instanceof Mn)return k=f.Mn,g=Pn(new Qn,f,f.pa,Vn(),!0),f=p(function(t,u){return function(w){return Pn(new Qn,u,w,wc(),!1)}}(d,f)),l=r(),f=k.xa(f,l.P),k=r(),f=f.Fd(g,k.P),g=r(),f.oc(e,g.P);if(f instanceof An){g=f.am;k=f.eg;if(f.jh){l=Tn();var n=Wn()}else l=Un(),n=Xn();f=H(r(),(new M).q([Pn(new Qn,f,g,l,!0),Pn(new Qn,f,k,n,!0)]));g=r();return e.oc(f,g.P)}return e}}(a)));a=p(function(){return function(d){return d.yo}}(a));Yn||(Yn=(new Zn).b());return $n(b,a,
Yn)}
function Xda(a,b,d){var e=Vda(a,b),f=e.Pa();for(f=(new Nn).bg(f,p(function(){return function(k){return null!==k&&k.ep instanceof An?!0:!1}}(a)));f.qa();){var g=f.ma();if(null!==g&&g.ep instanceof An)Kda(Dn(),g,d);else throw(new q).i(g);}b=Yda(d,Oda(a,b));for(d=e.Pa();d.qa();)f=d.ma(),Nda(Dn(),f.Zk),b.Do(p(function(){return function(k){return null!==k}}(a))).ua(p(function(k,l){return function(n){if(null!==n)Lda(n.ha(),n.la(),l);else throw(new q).i(n);}}(a,f)));b=e.Pa();for(b=(new Nn).bg(b,p(function(){return function(k){return k.gt}}(a)));b.qa();)d=b.ma(),
e.Do(p(function(k,l){return function(n){return n!==l}}(a,d))).ua(p(function(k,l){return function(n){Lda(l.Zk.pa,l.yo,n)}}(a,d)))}zn.prototype.$classData=h({e_:0},!1,"org.nlogo.parse.StructureChecker$",{e_:1,d:1});var ao=void 0;function Dn(){ao||(ao=(new zn).b());return ao}function bo(){}bo.prototype=new m;bo.prototype.constructor=bo;bo.prototype.b=function(){return this};
function Zda(a){var b=co,d=Uaa(new ve,a.Yc(),p(function(){return function(f){return f.ja.Ya}}(b)));b=(new eo).b();d=$da(b).Pi(d);if(d instanceof qe)return a=d.Wm,sc(),(new jh).i(a);var e=aea(bea(b),d);if(!e.x())return b=e.Q().ha(),d=e.Q().la(),a=d.fn.x()?a.qa()?a.ma():Qk():d.fn.Y(),sc(),a=(new z).e(b,a),(new hh).i(a);throw(new q).i(d);}bo.prototype.$classData=h({h_:0},!1,"org.nlogo.parse.StructureCombinators$",{h_:1,d:1});var co=void 0;function fo(){}fo.prototype=new m;fo.prototype.constructor=fo;
fo.prototype.b=function(){return this};function cea(a,b,d){var e=(new Kc).Gd(b);e=go(e);d=b.Ft(d.pa,d);b=Kg();a=p(function(f,g){return function(k){return(new z).e(k,g.w(k))}}(a,d));d=r();a=Jg(b,e.xa(a,d.P).tc());Ke();b=(new Kc).Gd(a);im(0,e.gf(go(b)));return a}function dea(a,b,d){return eea(a,fea(a,b,d),d)}
function gea(a,b,d,e,f){var g=(new Kc).Gd(b.hg),k=(new Kc).Gd(b.Vf);if(hk(g,k).hb(d)){if(b.Vf.hb(d))return f=b.Vf,d=b.Vf.w(d),f=cea(a,f,ho(d.pa,d.eg,d.Rp,d.Sp,e,d.jh,d.ih)),io(b.Aj,b.Nj,b.Hi,b.$i,b.Ai,b.hg,f,b.Pg);f=b.hg;d=b.hg.w(d);f=cea(a,f,ho(d.pa,d.eg,d.Rp,d.Sp,e,d.jh,d.ih));return io(b.Aj,b.Nj,b.Hi,b.$i,b.Ai,f,b.Vf,b.Pg)}b=Ng();e=[d];a=b.Dm.ci("compiler.StructureConverter.noBreed",J(function(u,w){return function(){throw(new Pe).c("coding error, bad translation key: "+w+" for Errors");}}(b,"compiler.StructureConverter.noBreed")));
d=e.length|0;0>=d?g=0:(b=d>>31,g=(0===b?-1<(-2147483648^d):0<b)?-1:d);r();om();b=[];k=0;var l=e.length|0;0>g&&pm(qm(),0,d,1,!1);for(l=l<g?l:g;k<l;){var n=e[k],t=k;0>g&&pm(qm(),0,d,1,!1);if(0>t||t>=g)throw(new Q).c(""+t);n=(new z).e(n,t);b.push(n);k=1+k|0}e=b.length|0;d=0;g=a;a:for(;;){if(d!==e){a=1+d|0;g=(new z).e(g,b[d]);b:{d=g.ub;l=g.Hb;if(null!==l&&(k=l.ha(),l=l.Qc(),og(k))){g=k;g=Pb(Na(),d,"\\{"+l+"\\}",g);break b}throw(new q).i(g);}d=a;continue a}break}throw(new pd).Xs(g,f.ja.Ya,f.ja.Ra,f.ja.$a);
}
function hea(a,b,d,e,f){var g=(new jo).b(),k=r();g=b.ic(g,k.P).Ms(Ke().jl);d=(new ko).Ma(d);k=r();k=b.ic(d,k.P);k.ua(p(function(){return function(t){t=t.ha();t.a=(32|t.a)<<24>>24}}(a,f)));f=dea(a,e.Zb,b);d=e.ge;var l=p(function(){return function(t){if(null!==t){t=t.ha();var u=t.Ze();return(new z).e(u,t)}throw(new q).i(t);}}(a)),n=r();d=Dc(d,k.xa(l,n.P));l=e.Up;a=p(function(){return function(t){if(null!==t){var u=t.la();t=t.ha().Ze();return(new z).e(t,u)}throw(new q).i(t);}}(a));n=r();a=l.ul(k.xa(a,n.P));
k=e.Gm;l=r();g=k.oc(g,l.P);k=e.Vs;e=e.Hq;l=(new lo).b();n=r();b=b.ic(l,n.P).Ms(Ke().jl);l=r();return mo(new no,f,d,a,g,k,e.oc(b,l.P))}function fea(a,b,d){return d.Ub(b,xb(function(){return function(e,f){if(f instanceof An){var g=f.am,k=f.eg,l=f.jh;f=f.ih;var n=g.pa,t=k.pa;g=g.f.Qb;k=k.f.Qb;var u=H(r(),v());f=ho(n,t,g,k,u,l,f);if(l)return l=e.Vf.Ft(f.pa,f),io(e.Aj,e.Nj,e.Hi,e.$i,e.Ai,e.hg,l,e.Pg);l=e.hg.Ft(f.pa,f);return io(e.Aj,e.Nj,e.Hi,e.$i,e.Ai,l,e.Vf,e.Pg)}return e}}(a)))}
function eea(a,b,d){return d.Ub(b,xb(function(e){return function(f,g){if(g instanceof Jn){var k=g.Tg,l=g.dg;if(null!==k&&"GLOBALS"===k.pa){g=f.Nj;k=p(function(){return function(w){return w.pa}}(e));var n=r();l=l.xa(k,n.P);k=r();g=g.oc(l,k.P);return io(f.Aj,g,f.Hi,f.$i,f.Ai,f.hg,f.Vf,f.Pg)}}if(g instanceof Jn&&(k=g.Tg,l=g.dg,null!==k&&"TURTLES-OWN"===k.pa))return g=f.Hi,k=p(function(){return function(w){w=w.pa;var y=mc();return(new z).e(w,y)}}(e)),n=r(),g=Dc(g,l.xa(k,n.P)),io(f.Aj,f.Nj,g,f.$i,f.Ai,
f.hg,f.Vf,f.Pg);if(g instanceof Jn&&(k=g.Tg,l=g.dg,null!==k&&"PATCHES-OWN"===k.pa))return g=f.$i,k=p(function(){return function(w){w=w.pa;var y=mc();return(new z).e(w,y)}}(e)),n=r(),g=Dc(g,l.xa(k,n.P)),io(f.Aj,f.Nj,f.Hi,g,f.Ai,f.hg,f.Vf,f.Pg);if(g instanceof Jn&&(k=g.Tg,l=g.dg,null!==k&&"LINKS-OWN"===k.pa))return g=f.Ai,k=p(function(){return function(w){w=w.pa;var y=mc();return(new z).e(w,y)}}(e)),n=r(),g=Dc(g,l.xa(k,n.P)),io(f.Aj,f.Nj,f.Hi,f.$i,g,f.hg,f.Vf,f.Pg);if(g instanceof Jn&&(l=g.Tg,g=g.dg,
null!==l)){n=l.pa;l=l.f;k=oo();n=(new Sb).c(n);n=Wda(n);var t=p(function(){return function(w){return w.pa}}(e)),u=r();return gea(k,f,n,g.xa(t,u.P),l)}return f}}(a)))}fo.prototype.$classData=h({o_:0},!1,"org.nlogo.parse.StructureConverter$",{o_:1,d:1});var po=void 0;function oo(){po||(po=(new fo).b());return po}function qo(){this.Cn=null;this.ml=!1}qo.prototype=new m;qo.prototype.constructor=qo;
function iea(a,b,d){co||(co=(new bo).b());b=Zda(b);if(b instanceof jh)return b=b.M,Sda(Dn(),b),Xda(Dn(),b,Baa(Ic(),d.Zb,d.ge)),hea(oo(),b,a.Cn,a.ml?mo(new no,d.Zb,(ro(),Lg()),(ro(),Jg(Ke().Pk,v())),(ro(),H(r(),v())),(ro(),H(r(),v())),(ro(),H(r(),v()))):d,a.ml);b instanceof hh&&(d=b.M,null!==d&&(a=d.ha(),d=d.la(),Gg(),d=d.ja,Fg(a,d.Ya,d.Ra,d.$a)));throw(new q).i(b);}function jea(a,b){var d=new qo;d.Cn=a;d.ml=b;return d}qo.prototype.$classData=h({t_:0},!1,"org.nlogo.parse.StructureParser",{t_:1,d:1});
function so(){this.qF=null;this.a=!1}so.prototype=new m;so.prototype.constructor=so;
function Baa(a,b,d){var e=Pda(),f=to(b.Pg);e=uc(e,kea(f).Tn(),uo());f=to(b.Pg);e=uc(uc(uc(uc(e,lea(f).Tn(),vo()),wo(b),Sn()),xo(b),En()),mea(b),Rn());f=yo(b);e=uc(e,f.Xk(p(function(l,n){return function(t){return xo(n).hb(t)}}(a,b)),!0),Gn());var g=(new Mc).lg(b.hg);f=Nc().P;f=Oc(g,f);for(g=g.Bf.mm();g.qa();){var k=g.ma();f.Ka(k.eg)}e=uc(uc(e,f.Ea(),Xn()),(new Kc).Gd(b.hg),Un());g=(new Mc).lg(b.Vf);f=Nc().P;f=Oc(g,f);for(g=g.Bf.mm();g.qa();)k=g.ma(),f.Ka(k.eg);d=uc(uc(uc(e,f.Ea(),Wn()),(new Kc).Gd(b.Vf),
Tn()),(new Kc).Gd(d),Vn());b=(new Mc).lg(b.hg);return Sh(b,d,xb(function(){return function(l,n){return n.jh?uc(l,n.Ak,(new Hn).c(n.pa)):uc(l,n.Ak,(new Fn).c(n.pa))}}(a)))}so.prototype.b=function(){this.qF="Included files must end with .nls";this.a=!0;return this};function nea(){var a=Ic();if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/StructureParser.scala: 27");return a.qF}
function oea(a,b,d,e,f,g){b=zo(b,e,f);a=(new Nn).bg(b,p(function(){return function(k){k=k.tb;var l=Hk();return!(null!==k&&k===l)}}(a)));b=Ao();a=(new ac).bg(a,b);return iea(d,a,g)}function pea(){var a=Ic();return xb(function(){return function(){return D()}}(a))}
function Aaa(a,b,d){var e=pea();b=function(f,g,k,l){return function(){var n=jea(g.Cn,g.ml),t=g.Bt,u=mo(new no,g.vs,g.go,(ro(),Jg(Ke().Pk,v())),(ro(),H(r(),v())),(ro(),H(r(),v())),(ro(),H(r(),v())));t=Sh(t,u,xb(function(w,y,E){return function(L,S){var ia=(new z).e(L,S);L=ia.ub;S=ia.Hb;if(null!==S)return ia=S.ha(),S=S.la(),oea(Ic(),y,E,S,ia,L);throw(new q).i(ia);}}(f,k,n)));if(g.ml)return t;sc();return(new Bo).bg(qea(new Co,t,p(function(w,y,E,L,S){return function(ia){var na=ia.Gm.Y().W;Gg();var pa=
Do(Na(),na,".nls"),ua=ia.Gm.Y();pa||(pa=nea(),ua=ua.sc(),Fg(pa,ua.Ya,ua.Ra,ua.$a));ua=y.Cf(E.os,na);if(ua instanceof I&&(pa=ua.M,null!==pa)){ua=pa.ha();pa=pa.la();var Ka=Ic(),Da=ia.Gm.X(),Ha=ia.Vs,kb=r();na=Ha.wc(na,kb.P);return oea(Ka,L,S,pa,ua,mo(new no,ia.Zb,ia.ge,ia.Up,Da,na,ia.Hq))}if(D()===ua){Gg();pa=Ng();Ka=[na];pa=pa.Dm.ci("compiler.StructureParser.includeNotFound",J(function(ad,oc){return function(){throw(new Pe).c("coding error, bad translation key: "+oc+" for Errors");}}(pa,"compiler.StructureParser.includeNotFound")));
Da=Ka.length|0;0>=Da?Ha=0:(na=Da>>31,Ha=(0===na?-1<(-2147483648^Da):0<na)?-1:Da);r();om();na=[];kb=0;var lb=Ka.length|0;0>Ha&&pm(qm(),0,Da,1,!1);for(lb=lb<Ha?lb:Ha;kb<lb;){var Tb=Ka[kb],Rb=kb;0>Ha&&pm(qm(),0,Da,1,!1);if(0>Rb||Rb>=Ha)throw(new Q).c(""+Rb);Tb=(new z).e(Tb,Rb);na.push(Tb);kb=1+kb|0}Ka=na.length|0;Da=0;Ha=pa;a:for(;;){if(Da!==Ka){pa=1+Da|0;Ha=(new z).e(Ha,na[Da]);b:{Da=Ha.ub;lb=Ha.Hb;if(null!==lb&&(kb=lb.ha(),lb=lb.Qc(),og(kb))){Ha=kb;Ha=Pb(Na(),Da,"\\{"+lb+"\\}",Ha);break b}throw(new q).i(Ha);
}Da=pa;continue a}na=Ha;break}ia=ia.Gm.Y().sc();Fg(na,ia.Ya,ia.Ra,ia.$a)}throw(new q).i(ua);}}(f,l,g,k,n))),p(function(){return function(w){return w.Gm.ef()}}(f))).ma()}}(a,d,b,e);if(d.ml)return b();rea(d.Qg);b=b();b.Hq.ua(p(function(f,g){return function(k){var l=k.Qb.toLowerCase();sea(g.Qg,l,(new Dg).ag(k))}}(a,d)));return b}so.prototype.$classData=h({u_:0},!1,"org.nlogo.parse.StructureParser$",{u_:1,d:1});var Eo=void 0;function Ic(){Eo||(Eo=(new so).b());return Eo}function Fo(){}Fo.prototype=new m;
Fo.prototype.constructor=Fo;Fo.prototype.b=function(){return this};function Pda(){tea||(tea=(new Fo).b());return Im(new Jm,Jg(Il(),v()),0)}Fo.prototype.$classData=h({w_:0},!1,"org.nlogo.parse.SymbolTable$",{w_:1,d:1});var tea=void 0;function Go(){this.a=0}Go.prototype=new m;Go.prototype.constructor=Go;Go.prototype.b=function(){return this};
function tn(a,b){if(Sn()===b)return"global variable";if(En()===b)return"turtle variable";if(Rn()===b)return"patch variable";if(Gn()===b)return"link variable";if(Un()===b)return"breed";if(Xn()===b)return"singular breed name";if(Tn()===b)return"link breed";if(Wn()===b)return"singular link breed name";if(b instanceof Fn||b instanceof Hn)return b.ia+"-OWN variable";if(Vn()===b)return"procedure";if(uo()===b)return"primitive command";if(vo()===b)return"primitive reporter";if(Bn()===b)return"breed command";
if(Cn()===b)return"breed reporter";if(b instanceof un||gl()===b||wc()===b)return"local variable here";throw(new q).i(b);}function Sca(a,b,d){Gg();a="There is already a "+tn(el(),b)+" called "+d.Qb.toUpperCase();d=d.ja;Fg(a,d.Ya,d.Ra,d.$a)}Go.prototype.$classData=h({x_:0},!1,"org.nlogo.parse.SymbolType$",{x_:1,d:1});var Ho=void 0;function el(){Ho||(Ho=(new Go).b());return Ho}function Io(){}Io.prototype=new m;Io.prototype.constructor=Io;Io.prototype.b=function(){return this};
function Bc(a,b,d){a=new Jo;var e=new Ko;e.ui=b;e.bM=d;e.ZD=d.eJ();e.a=!0;return Lo(a,e)}Io.prototype.$classData=h({S_:0},!1,"org.nlogo.parse.TransformableTokenStream$",{S_:1,d:1});var Mo=void 0;function xc(){Mo||(Mo=(new Io).b());return Mo}function No(){this.uu=this.ZC=null;this.a=0}No.prototype=new m;No.prototype.constructor=No;
function uea(a,b,d){if(!(b instanceof R)){if(!(b instanceof T))throw(new q).i(b);var e=b.dc;b=function(){return function(n){if(n instanceof pd)return Oo(n);if(null!==n)return(new Po).Vd(n);throw(new q).i(n);}}(a);Qo();var f=b(e.Tc),g=Ro(e.Xc);e=So().de;a:for(;;){if(g instanceof To){var k=g;g=k.Ed;e=(new To).Xb(b(k.yd),e);continue a}if(!(g instanceof Uo))throw(new q).i(g);break}b=(new T).i((new Vo).Xb(f,e))}if(b instanceof R)b=b.ea,Wo(a,b),a=(new R).i(d.Cf(b,Xo(Yo(),b)));else{if(!(b instanceof T))throw(new q).i(b);
a=b}Zo();(new $o).b();try{var l=(new R).i(a)}catch(n){if(l=vm(kg(),n),null!==l)if(Rj(ra(ap),l))l=(new T).i(l);else throw jg(kg(),l);else throw n;}if(l instanceof R)return l.ea;if(!(l instanceof T))throw(new q).i(l);l=l.dc;bp();l=(new Po).Vd(l);return cp(Zo(),l)}No.prototype.b=function(){this.ZC=null;this.a=(1|this.a)<<24>>24;this.uu=(new dp).b();this.a=(2|this.a)<<24>>24;return this};function ep(a){return(new fp).c(a.toLowerCase())}
function vea(a){return xb(function(){return function(b,d){return d}}(a))}No.prototype.us=function(){if(0===(2&this.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/js/src/main/scala/BrowserCompiler.scala: 43");return this.uu};function wea(a,b,d,e,f){var g=p(function(l,n){return function(t){return xea(n,t)}}(a,e)),k=r();b=b.xa(g,k.P);a=p(function(l,n){return function(t){return yea(n,t)}}(a,e));e=r();d=d.xa(a,e.P);return gp(f.ng,f.Zc,f.Ff,f.Wc,b,d)}
function Wo(a,b){a.ZC=b;a.a=(1|a.a)<<24>>24}function zea(a,b){b=hp(a).dk.Zb.hg.Cc(b.toUpperCase());b=b.x()?H(r(),v()):b.Q().Ak;a=p(function(){return function(e){return ep(e)}}(a));var d=r();return(new ip).Ca(b.xa(a,d.P).tc())}function Aea(a,b){b=hp(a).dk.Zb.Vf.Cc(b.toUpperCase());b=b.x()?H(r(),v()):b.Q().Ak;a=p(function(){return function(e){return ep(e)}}(a));var d=r();return(new ip).Ca(b.xa(a,d.P).tc())}
function Bea(a,b){b=jp(a,b,kp());if(b instanceof R){b=b.ea;b=lp().Qy().w(b);if(!(b instanceof R)){if(!(b instanceof T))throw(new q).i(b);b=(new T).i(mp(b.dc))}if(b instanceof R){b=b.ea;var d=(new R).i(lca(cj(),b.uz()))}else{if(!(b instanceof T))throw(new q).i(b);d=b}}else{if(!(b instanceof T))throw(new q).i(b);d=b}b=zd();if(d instanceof R)a=d;else{if(!(d instanceof T))throw(new q).i(d);var e=d.dc;a=function(){return function(k){return k}}(a);Qo();d=a(e.Tc);var f=Ro(e.Xc);e=So().de;a:for(;;){if(f instanceof
To){var g=f;f=g.Ed;e=(new To).Xb(a(g.yd),e);continue a}if(!(f instanceof Uo))throw(new q).i(f);break}a=(new T).i((new Vo).Xb(d,e))}d=np();return Ad(b,op(d,a).Af())}function Cea(a){a=hp(a).dk.Zb.Hi;var b=(new Kc).Gd(a);a=Nc().P;a=Oc(b,a);for(b=b.Zd.Ip();b.qa();){var d=b.ma();a.Ka(ep(d))}return(new ip).Ca(a.Ea().tc())}
function jp(a,b,d){b=pp(zd(),b);d=d.bb(b);if(d instanceof R)return d;if(d instanceof T){b=d.dc;a=function(){return function(g){return(new qp).c(g)}}(a);Qo();d=a(b.Tc);var e=Ro(b.Xc);b=So().de;a:for(;;){if(e instanceof To){var f=e;e=f.Ed;b=(new To).Xb(a(f.yd),b);continue a}if(!(e instanceof Uo))throw(new q).i(e);break}return(new T).i((new Vo).Xb(d,b))}throw(new q).i(d);}
function hp(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/js/src/main/scala/BrowserCompiler.scala: 40");return a.ZC}function Dea(a){a=hp(a).dk.Zb.Ai;var b=(new Kc).Gd(a);a=Nc().P;a=Oc(b,a);for(b=b.Zd.Ip();b.qa();){var d=b.ma();a.Ka(ep(d))}return(new ip).Ca(a.Ea().tc())}
function Eea(a){var b=hp(a).dk.Zb,d=b.Aj,e=p(function(){return function(g){return(new z).e(g,"interface")}}(a)),f=r();d=d.xa(e,f.P);b=b.Nj;e=p(function(){return function(g){return(new z).e(g.toLowerCase(),"user")}}(a));f=r();b=b.xa(e,f.P);e=r();d=d.oc(b,e.P);a=p(function(){return function(g){if(null!==g){var k=g.ha();g=g.la();Kg();k=(new fp).c(k);k=(new z).e("name",k);g=(new fp).c(g);g=[k,(new z).e("type",g)];k=(new dc).vb(rp());for(var l=0,n=g.length|0;l<n;)fc(k,g[l]),l=1+l|0;return(new sp).ac(k.La)}throw(new q).i(g);
}}(a));b=r();a=(new ip).Ca(d.xa(a,b.P));return Ad(zd(),a)}
function Fea(a,b,d){var e=tp(up());d=jp(a,d,Gea());if(d instanceof T)bp(),d=(new qp).c("commands must be an Array of "+vp(ra(sa))),d=cp(Zo(),d);else if(!(d instanceof R))throw(new q).i(d);if(d instanceof R){d=d.ea.La;e=p(function(t,u){return function(w){w=u.bb(w);if(w instanceof T)return(new T).i(mp(w.dc));if(w instanceof R){w=w.ea;A();w=[w];for(var y=-1+(w.length|0)|0,E=v();0<=y;)E=K(w[y],E),y=-1+y|0;return(new R).i(E)}throw(new q).i(w);}}(a,e));var f=r();e=d.xa(e,f.P);bp();A();d=v();e=e.Ub(wp().w(d),
xb(function(t){return function(u,w){w=function(E,L){return function(){return L}}(t,w);xp();(new yp).ev();Qo();(new zp).Sq();if(u instanceof T){var y=u.dc;w=w();if(w instanceof T)return(new T).i(Ap(y,w.dc));if(w instanceof R)return u;throw(new q).i(w);}if(u instanceof R){u=u.ea;w=w();if(w instanceof T)return w;if(w instanceof R)return(new R).i(Bp(w.ea,u));throw(new q).i(w);}throw(new q).i(u);}}(a)));if(!(e instanceof R)){if(!(e instanceof T))throw(new q).i(e);f=e.dc;e=function(){return function(t){return t}}(a);
Qo();d=e(f.Tc);var g=Ro(f.Xc);f=So().de;a:for(;;){if(g instanceof To){var k=g;g=k.Ed;f=(new To).Xb(e(k.yd),f);continue a}if(!(g instanceof Uo))throw(new q).i(g);break}e=(new T).i((new Vo).Xb(d,f))}}else{if(!(d instanceof T))throw(new q).i(d);e=d}if(!(e instanceof R)){if(!(e instanceof T))throw(new q).i(e);f=e.dc;e=function(){return function(t){return t}}(a);Qo();d=e(f.Tc);g=Ro(f.Xc);f=So().de;a:for(;;){if(g instanceof To){k=g;g=k.Ed;f=(new To).Xb(e(k.yd),f);continue a}if(!(g instanceof Uo))throw(new q).i(g);
break}e=(new T).i((new Vo).Xb(d,f))}if(e instanceof R)e=e.ea,b=Hea(Cp(),b,a.us()),b=(new R).i((new z).e(e,b));else{if(!(e instanceof T))throw(new q).i(e);b=e}if(b instanceof R){e=b.ea;if(null===e)throw(new q).i(e);b=e.ha();d=e.la();e=H(r(),v());if(!(d instanceof R)){if(!(d instanceof T))throw(new q).i(d);g=d.dc;d=function(){return function(t){if(t instanceof pd)return Oo(t);if(null!==t)return(new Po).Vd(t);throw(new q).i(t);}}(a);Qo();f=d(g.Tc);k=Ro(g.Xc);g=So().de;a:for(;;){if(k instanceof To){var l=
k;k=l.Ed;g=(new To).Xb(d(l.yd),g);continue a}if(!(k instanceof Uo))throw(new q).i(k);break}d=(new T).i((new Vo).Xb(f,g))}if(d instanceof R)d=d.ea,Wo(a,d),f=Xo(Yo(),d),a=(new R).i(wea(a,b,e,d,f));else{if(!(d instanceof T))throw(new q).i(d);a=d}Zo();(new $o).b();try{var n=(new R).i(a)}catch(t){if(n=vm(kg(),t),null!==n)if(Rj(ra(ap),n))n=(new T).i(n);else throw jg(kg(),n);else throw t;}if(n instanceof R)n=n.ea;else{if(!(n instanceof T))throw(new q).i(n);n=n.dc;bp();n=(new Po).Vd(n);n=cp(Zo(),n)}if(n instanceof
R)n=(new R).i(n.ea);else if(!(n instanceof T))throw(new q).i(n);}else{if(!(b instanceof T))throw(new q).i(b);n=b}return Ad(zd(),Dp(Ep(),n).Af())}
function Iea(a,b){b=jp(a,b,kp());if(b instanceof R){b=b.ea;b=Fp().Qy().w(b);if(!(b instanceof R)){if(!(b instanceof T))throw(new q).i(b);b=(new T).i(mp(b.dc))}if(b instanceof R){b=b.ea;var d=Gp(Cp(),b.uz(),a.us(),Hp());if(!(d instanceof R)){if(!(d instanceof T))throw(new q).i(d);var e=d.dc;d=function(){return function(n){return n}}(a);Qo();var f=d(e.Tc),g=Ro(e.Xc);e=So().de;a:for(;;){if(g instanceof To){var k=g;g=k.Ed;e=(new To).Xb(d(k.yd),e);continue a}if(!(g instanceof Uo))throw(new q).i(g);break}d=
(new T).i((new Vo).Xb(f,e))}b=(new R).i((new z).e(b,d))}else if(!(b instanceof T))throw(new q).i(b);if(b instanceof R){d=b.ea;if(null===d)throw(new q).i(d);b=d.ha();d=d.la();if(!(d instanceof R)){if(!(d instanceof T))throw(new q).i(d);e=d.dc;d=function(){return function(n){if(n instanceof pd)return Oo(n);if(null!==n)return(new Po).Vd(n);throw(new q).i(n);}}(a);Qo();f=d(e.Tc);g=Ro(e.Xc);e=So().de;a:for(;;){if(g instanceof To){k=g;g=k.Ed;e=(new To).Xb(d(k.yd),e);continue a}if(!(g instanceof Uo))throw(new q).i(g);
break}d=(new T).i((new Vo).Xb(f,e))}if(d instanceof R)d=d.ea,Wo(a,d),f=Xo(Yo(),d),b=(new R).i(wea(a,Jea(b),Kea(b),d,f));else{if(!(d instanceof T))throw(new q).i(d);b=d}Zo();(new $o).b();try{var l=(new R).i(b)}catch(n){if(l=vm(kg(),n),null!==l)if(Rj(ra(ap),l))l=(new T).i(l);else throw jg(kg(),l);else throw n;}if(l instanceof R)l=l.ea;else{if(!(l instanceof T))throw(new q).i(l);l=l.dc;bp();l=(new Po).Vd(l);l=cp(Zo(),l)}if(l instanceof R)l=(new R).i(l.ea);else if(!(l instanceof T))throw(new q).i(l);
}else{if(!(b instanceof T))throw(new q).i(b);l=b}}else{if(!(b instanceof T))throw(new q).i(b);l=b}if(l instanceof R)a=l;else{if(!(l instanceof T))throw(new q).i(l);b=l.dc;a=function(){return function(n){return n}}(a);Qo();l=a(b.Tc);d=Ro(b.Xc);b=So().de;a:for(;;){if(d instanceof To){f=d;d=f.Ed;b=(new To).Xb(a(f.yd),b);continue a}if(!(d instanceof Uo))throw(new q).i(d);break}a=(new T).i((new Vo).Xb(l,b))}return Ad(zd(),Dp(Ep(),a).Af())}
No.prototype.listLinkVarsForBreed=function(a){var b=Dea(this),d=Aea(this,a);a=zd();b=b.La;d=d.La;var e=r();return Ad(a,(new ip).Ca(b.oc(d,e.P)))};No.prototype.listLinkOwnVarsForBreed=function(a){a=Aea(this,a);return Ad(zd(),a)};No.prototype.listLinkVars=function(){var a=Dea(this);return Ad(zd(),a)};No.prototype.listPatchVars=function(){var a=hp(this).dk.Zb.$i,b=(new Kc).Gd(a);a=Nc().P;a=Oc(b,a);for(b=b.Zd.Ip();b.qa();){var d=b.ma();a.Ka(ep(d))}a=(new ip).Ca(a.Ea().tc());return Ad(zd(),a)};
No.prototype.listVarsForBreed=function(a){var b=Cea(this),d=zea(this,a);a=zd();b=b.La;d=d.La;var e=r();return Ad(a,(new ip).Ca(b.oc(d,e.P)))};No.prototype.listOwnVarsForBreed=function(a){a=zea(this,a);return Ad(zd(),a)};No.prototype.listTurtleVars=function(){var a=Cea(this);return Ad(zd(),a)};
No.prototype.listProcedures=function(){var a=hp(this).dk.ge,b=(new Mc).lg(a);a=Nc().P;a=Oc(b,a);for(b=b.Bf.mm();b.qa();){var d=b.ma();Kg();var e=(new Ip).wb(jc(d).ra());e=(new z).e("argCount",e);var f=(new Jp).md(d.rt.Km);f=(new z).e("isReporter",f);var g=d.H();g=(new Jp).md(79===(65535&(g.charCodeAt(0)|0)));g=(new z).e("isUseableByObserver",g);var k=d.H();k=(new Jp).md(84===(65535&(k.charCodeAt(1)|0)));k=(new z).e("isUseableByTurtles",k);d=d.Ze();d=(new fp).c(d.toLowerCase());e=[e,f,g,k,(new z).e("name",
d)];d=(new dc).vb(rp());f=0;for(g=e.length|0;f<g;)fc(d,e[f]),f=1+f|0;a.Ka((new sp).ac(d.La))}a=(new ip).Ca(a.Ea().tc());return Ad(zd(),a)};No.prototype.listGlobalVars=function(){return Eea(this)};No.prototype.compileProceduresIncremental=function(a,b){for(var d=[],e=0,f=b.length|0;e<f;){var g=b[e].toUpperCase();d.push(g);e=1+e|0}b=(new M).q(d);a=Lea(hp(this),a,b);return Ad(zd(),Kp().Oi(a))};No.prototype.compileRawCommand=function(a){a=Mea(hp(this),a);return Ad(zd(),Kp().Oi(a))};
No.prototype.compileReporter=function(a){a=yea(hp(this),a);return Ad(zd(),Kp().Oi(a))};No.prototype.compileCommand=function(a){a=xea(hp(this),a);return Ad(zd(),Kp().Oi(a))};
No.prototype.isReporter=function(a){dj();var b=hp(this).dk.Zb,d=hp(this).dk.ge,e=Lp(this.us());try{var f=zo(Jc(Mp()),"to __is-reporter? report "+a+"\nend",(Jc(Mp()),"")),g=Ao(),k=(new ac).bg(f,g),l=iea(jea(D(),!0),k,mo(new no,b,d,(ro(),Jg(Ke().Pk,v())),(ro(),H(r(),v())),(ro(),H(r(),v())),(ro(),H(r(),v())))),n=(new Mc).lg(l.ge).Bf.mm().ma(),t=new Cc,u=Dc(d,l.ge);t.Zb=b;t.ge=u;t.aj=n;t.Qg=e;yaa(t);for(var w=Bc(xc(),l.Up.w(n.Ze()).Pa(),t),y=Np(Op(w),1);;){if(y.x())S=!1;else var E=y.Y().tb,L=Ck(),S=null!==
E&&E===L;if(S)y=y.X();else break}var ia=rj(y);if(ia.x())var na=!1;else{var pa=ia.Q();dj();var ua=pa.tb;na=Ek()===ua||Sk()===ua||Gk()===ua?!0:Uf()===ua?!(pa.W instanceof Pp||pa.W instanceof mm||pa.W instanceof xl):!1}}catch(Ka){if(Ka instanceof pd)na=!1;else throw Ka;}return na};No.prototype.exportNlogo=function(a){return Bea(this,a)};
No.prototype.fromNlogo=function(a){for(var b=arguments.length|0,d=1,e=[];d<b;)e.push(arguments[d]),d=d+1|0;switch(e.length|0){case 1:return Fea(this,a,e[0]);case 0:return Ad(zd(),Dp(Ep(),uea(this,Hea(Cp(),a,this.us()),vea(this))).Af());default:throw"No matching overload";}};No.prototype.fromModel=function(a){return Iea(this,a)};No.prototype.$classData=h({T_:0},!1,"org.nlogo.tortoise.compiler.BrowserCompiler",{T_:1,d:1});function Qp(){this.a=0}Qp.prototype=new m;Qp.prototype.constructor=Qp;
Qp.prototype.b=function(){return this};function Dp(a,b){if(b instanceof R)a=b.ea;else{if(!(b instanceof T))throw(new q).i(b);a=b.dc;a=gp((bp(),Nea().w(a)),"","",H(r(),v()),H(r(),v()),H(r(),v()))}Rp||(Rp=(new Sp).b());return op(Rp,a)}Qp.prototype.$classData=h({U_:0},!1,"org.nlogo.tortoise.compiler.BrowserCompiler$",{U_:1,d:1});var Tp=void 0;function Ep(){Tp||(Tp=(new Qp).b());return Tp}function Up(a,b,d,e,f){a=Vp(a);b=b.ta.R(1);return Wp(a,b,d,e,f)}
function Xp(a,b,d,e,f){b=b.ta;var g=new Yp;if(null===a)throw jg(kg(),null);g.Ta=a;g.mB=d;g.lB=e;g.sD=f;a=r();return b.ic(g,a.P)}
function Oea(a,b,d,e,f){var g=b.Od;ud();var k=(new Zp).b(),l=vd(new wd,k).ed(g);if(!l.x()){var n=l.Q();if(null===n)throw(new xe).b();return""===n?"":n+";"}ud();var t=(new $p).b(),u=vd(new wd,t).ed(g);if(!u.x()){var w=u.Q()+"(";var y=Xp(a,b,d,e,f).Jb(", ");return w+y+");"}ud();var E=(new aq).b(),L=vd(new wd,E).ed(g);if(!L.x()){var S=L.Q()+"(";var ia=Pea(ld(),b,Xp(a,b,d,e,f));return S+ia+");"}if(g instanceof bq){var na=b.ta.R(0).xe;if(na instanceof Pp){var pa=cq(dq(),na.fd.pa);var ua=pa+" \x3d "+Up(a,
b,d,e,f)+'; ProcedurePrims.stack().currentContext().updateStringRunVar("'+na.fd.pa+'", '+pa+");"}else if(na instanceof eq||na instanceof Al)ua=cq(dq(),na.pa)+" \x3d "+Up(a,b,d,e,f)+";";else{null===a.ux&&null===a.ux&&(a.ux=(new fq).lC(a));var Ka=a.ux.pE(na);if(Ka.x()){var Da=b.Od.E();nd('This isn\'t something you can use "set" on.',Da.ja.Ya,Da.ja.Ra,Da.ja.$a);ua=void 0}else ua=Ka.Q().w(Up(a,b,d,e,f))}return ua}if(g instanceof gq){var Ha=Vp(a),kb=b.ta.R(0),lb=hq(Ha,kb,d,e,f),Tb="|while (true) {\n        |"+
iq(id(),lb)+"\n        |};",Rb=(new Sb).c(Tb);return jq(Rb)}if(g instanceof kq){var ad=Vp(a),oc=b.ta.R(0),kd=Wp(ad,oc,d,e,f),Sc=Vp(a),bd=b.ta.R(1),yc=hq(Sc,bd,d,e,f);Vp(a);var kc=b.Od.E(),Bd=lq(kc,"index");Vp(a);var Tc=b.Od.E(),Af=lq(Tc,"repeatcount"),me="|for (let "+Bd+" \x3d 0, "+Af+" \x3d StrictMath.floor("+kd+"); "+Bd+" \x3c "+Af+"; "+Bd+"++) {\n        |"+iq(id(),yc)+"\n        |}",Ch=(new Sb).c(me);return jq(Ch)}if(g instanceof mq){var Fe=Vp(a),Zf=b.ta.R(0),Cd=Wp(Fe,Zf,d,e,f),pc=Vp(a),Fb=b.ta.R(1),
cd=hq(pc,Fb,d,e,f),La="|while ("+Cd+") {\n        |"+iq(id(),cd)+"\n        |}",gc=(new Sb).c(La);return jq(gc)}if(g instanceof nq){var hc=Vp(a),Ym=b.ta.R(0),$g=Wp(hc,Ym,d,e,f),Zm=Vp(a),jl=b.ta.R(1),$m=hq(Zm,jl,d,e,f),an="|if ("+$g+") {\n        |"+iq(id(),$m)+"\n        |}",kl=(new Sb).c(an);return jq(kl)}if(g instanceof oq)return Qea(a,b,d,e,f);if(g instanceof pq){var bn=Rea(a,b,d,e,f),ll=Vp(a),ml=b.ta.R(1),nl=qq(ll,ml,!1,d,e,f);return rq(bn,nl,!0)}if(g instanceof sq){Vp(a);var cn=b.Od.E(),ol=lq(cn,
"error"),dn=Vp(a),ei=b.ta.R(0),Yj=hq(dn,ei,d,e,f);Na();var Ui=Vp(a),en=b.ta.R(1),Vi=hq(Ui,en,d,e,f),fn=Sea(g),Wi=U(),Zj=Pb(0,Vi,"_error_"+V(Wi,fn),ol),ak="\n       |try {\n       |"+iq(id(),Yj)+"\n       |} catch ("+ol+") {\n       |"+iq(id(),Zj)+"\n       |}\n     ",pl=(new Sb).c(ak);return jq(pl)}if(g instanceof tq)return Tea(a,b,!1,d,e,f);if(g instanceof uq)return Tea(a,b,!0,d,e,f);if(g instanceof vq)return Uea(a,b,!1,d,e,f);if(g instanceof wq)return Uea(a,b,!0,d,e,f);if(g instanceof xq){var Xi=
Vp(a),gn=b.ta.R(0),Yi=Wp(Xi,gn,d,e,f),hn=Vp(a),ql=b.ta.R(1),jn=qq(hn,ql,!1,d,e,f),rl=b.Od.ia,kn=(new Sb).c(rl),ln=sd(kn)?rl:"TURTLES",sl="SelfManager.self().sprout("+Yi+", "+hd(id(),ln)+")";return rq(sl,jn,!0)}if(g instanceof yq){var mn=Vp(a),tl=b.ta.R(0),ul=Wp(mn,tl,d,e,f),Cg=b.Od;if(!(Cg instanceof yq))throw(new Pe).c("How did you get here with class of type "+qa(Cg).yg());var ah=Cg.ia,nn=(new Sb).c(ah),vl=sd(nn)?ah:"TURTLES";return"SelfManager.self().sprout("+ul+", "+hd(id(),vl)+");"}if(g instanceof
zq)return Aq(a,b,"createLinkFrom",g.ia,d,e,f);if(g instanceof Bq)return Aq(a,b,"createLinksFrom",g.ia,d,e,f);if(g instanceof Cq)return Aq(a,b,"createLinkTo",g.ia,d,e,f);if(g instanceof Dq)return Aq(a,b,"createLinksTo",g.ia,d,e,f);if(g instanceof Eq)return Aq(a,b,"createLinkWith",g.ia,d,e,f);if(g instanceof Fq)return Aq(a,b,"createLinksWith",g.ia,d,e,f);if(g instanceof Gq){var fi=Vp(a),bk=b.ta.R(0),Zi=Wp(fi,bk,d,e,f),wl=Vp(a),bh=b.ta.R(1),ck=hq(wl,bh,d,e,f),gi=Vp(a);if(!gi.a)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/Compiler.scala: 55");
var Dh=gi.rK;if(null===Dh)throw(new q).i(Dh);var $i=Dh.Mi(),aj=Dh.la();Hq(gi,(new z).e(1+$i|0,aj));var dk=aj+"_"+$i;var Eh='|if (Prims.isThrottleTimeElapsed("'+dk+'", workspace.selfManager.self(), '+Zi+')) {\n        |  Prims.resetThrottleTimerFor("'+dk+'", workspace.selfManager.self());\n        |'+iq(id(),ck)+"\n        |}",on=(new Sb).c(Eh);return jq(on)}if(g instanceof Iq)return"throw new Error("+Jq(a,0,b,d,e,f)+");";if(g instanceof Kq){var ek=g.ia,fk=Vp(a),nP=b.ta.R(0),oP=Wp(fk,nP,d,e,f),pP=
Vp(a),qP=b.ta.R(1),rP=qq(pP,qP,!1,d,e,f),od="SelfManager.self().hatch("+oP+", "+hd(id(),ek)+")";return rq(od,rP,!0)}if(g instanceof Lq){var $f=g.ia,bj=Vp(a),Fh=b.ta.R(0);return"SelfManager.self().hatch("+Wp(bj,Fh,d,e,f)+", "+hd(id(),$f)+");"}if(g instanceof Mq)return"SelfManager.self().fd(-("+Jq(a,0,b,d,e,f)+"));";if(g instanceof Nq)return"SelfManager.self().right(-("+Jq(a,0,b,d,e,f)+"));";if(g instanceof Oq)return"world.topology.diffuse("+hd(id(),Pq(b))+", "+Jq(a,1,b,d,e,f)+", false)";if(g instanceof
Qq)return"world.topology.diffuse("+hd(id(),Pq(b))+", "+Jq(a,1,b,d,e,f)+", true)";if(g instanceof Rq)return"Prims.uphill("+hd(id(),Pq(b))+")";if(g instanceof Sq)return"Prims.uphill4("+hd(id(),Pq(b))+")";if(g instanceof Tq)return"Prims.downhill("+hd(id(),Pq(b))+")";if(g instanceof Uq)return"Prims.downhill4("+hd(id(),Pq(b))+")";if(g instanceof Vq)return"BreedManager.setDefaultShape("+Jq(a,0,b,d,e,f)+".getSpecialName(), "+Jq(a,1,b,d,e,f)+")";if(g instanceof Wq)return"SelfManager.self().setVariable('hidden?', true)";
if(g instanceof Xq)return"SelfManager.self().setVariable('hidden?', false)";if(g instanceof Yq){var pn=Xp(a,b,d,e,f),vE="ProcedurePrims.callCommand("+Vea(ld(),g.ii.Ze(),pn)+")";if(!f.ht&&2>e.tn)var a_=vE;else{var b_=d.st,E7=Wea();a_="var R \x3d "+vE+"; if (R \x3d\x3d\x3d "+(null!==b_&&b_===E7&&1===e.tn?"StopInterrupt":"DeathInterrupt")+") { return R; }"}return a_}if(g instanceof Zq)return"return PrimChecks.procedure.report("+Jq(a,0,b,d,e,f)+");";if(g instanceof $q)return Jq(a,0,b,d,e,f)+";";if(g instanceof
rn){var c_=g.fd;if(c_.x())var tQ=D();else{var d_=c_.Q(),e_=cq(dq(),d_.pa);tQ=(new I).i("let "+e_+" \x3d "+Jq(a,0,b,d,e,f)+'; ProcedurePrims.stack().currentContext().registerStringRunVar("'+d_.pa+'", '+e_+");")}return tQ.x()?"":tQ.Q()}if(g instanceof ar){var F7=Vp(a),G7=b.ta.R(0);return"workspace.rng.withClone(function() { "+hq(F7,G7,d,e,f)+" })"}if(g instanceof br){var I7="var R \x3d PrimChecks.procedure.run("+Rea(a,b,d,e,f)+cr(ld(),Xp(a,b,d,e,f).Td(1))+"); if (R !\x3d\x3d undefined) { return R; }",
J7=b.ta.R(0).Fj();return Haa(a,J7,f,I7)}if(g instanceof dr){var K7=Xp(a,b,d,e,f).df().Jb(", "),L7=-1+b.ta.za()|0,M7="Tasks.forEach("+Jq(a,L7,b,d,e,f)+", "+K7+")";return Xea(M7)}if(g instanceof er){var N7=(new Sb).c("_extern\\(([^:]+):([^)]+)\\)"),O7=v(),P7=(new Ub).Bp(N7.U,O7),f_=g.l();var iz=gg(P7,f_);if(iz.x())uQ=!1;else if(null!==iz.Q())var Q7=iz.Q(),uQ=0===hg(Q7,2);else uQ=!1;if(uQ)var R7=iz.Q().R(0),S7=iz.Q().R(1);else throw(new q).i(f_);var T7=R7,U7=S7,V7="Extensions["+hd(id(),T7)+"].prims["+
hd(id(),U7)+"](";var W7=Xp(a,b,d,e,f).Jb(", ");return V7+W7+");"}if(d.qp){var X7=qa(b.Od).yg(),g_=(new Sb).c(X7),Y7=g_.U.length|0,Z7=Ie(Je(),g_.U,1,Y7);return Gaa(Z7)+";"}var $7="unimplemented primitive: "+b.Od.E().Qb,vQ=b.Od.E();nd($7,vQ.ja.Ya,vQ.ja.Ra,vQ.ja.$a)}function Pq(a){var b=a.ta.R(0).xe;if(b instanceof fr)return Qg(b).toLowerCase();b="unknown reference: "+qa(b).yg();a=a.Od.E();nd(b,a.ja.Ya,a.ja.Ra,a.ja.$a)}
function Qea(a,b,d,e,f){var g=Yea(A(),-1+b.ta.ra()|0),k=function(u,w,y,E,L){return function(S){var ia=S|0;S=w.ta.R(ia);if(!(S instanceof zb||S instanceof Bb)){var na=S.sc().Ya,pa=S.sc().Ra,ua=S.sc().$a;nd("IFELSE expected a reporter here but got a block.",na,pa,ua)}ia=w.ta.R(1+ia|0);ia instanceof Ab||(na=ia.sc().Ya,pa=ia.sc().Ra,ua=ia.sc().$a,nd("IFELSE expected a command block here but got a TRUE/FALSE.",na,pa,ua));na=Vp(u);S=Wp(na,S,y,E,L);na=Vp(u);ia=hq(na,ia,y,E,L);S="|if ("+S+") {\n            |"+
iq(id(),ia)+"\n            |}";S=(new Sb).c(S);return jq(S)}}(a,b,d,e,f),l=A().P;if(l===A().P)if(g===v())k=v();else{l=g.Y();var n=l=K(k(l),v());for(g=g.X();g!==v();){var t=g.Y();t=K(k(t),v());n=n.Da=t;g=g.X()}k=l}else{for(l=Oc(g,l);!g.x();)n=g.Y(),l.Ka(k(n)),g=g.X();k=l.Ea()}0===(b.ta.ra()%2|0)?d="":(a=Vp(a),b=b.ta.R(-1+b.ta.ra()|0),d=hq(a,b,d,e,f),d="|else {\n            |"+iq(id(),d)+"\n            |}",d=(new Sb).c(d),d=jq(d));d="|"+bc(k,""," else ","")+"\n          |"+d;d=(new Sb).c(d);return jq(d)}
function rq(a,b,d){return Xea("ProcedurePrims.ask("+a+", "+b+", "+d+")")}function Jq(a,b,d,e,f,g){a=Vp(a);b=d.ta.R(b);return Wp(a,b,e,f,g)}function Uea(a,b,d,e,f,g){a=Vp(a);var k=b.ta.R(0);e=Wp(a,k,e,f,g);d=d?"createOrderedTurtles":"createTurtles";b=b.Od;if(b instanceof vq)b=b.ia;else{if(!(b instanceof wq))throw(new Pe).c("How did you get here with class of type "+qa(b).yg());b=b.ia}return"world.turtleManager."+d+"("+e+", "+hd(id(),b)+");"}
function Rea(a,b,d,e,f){return Zea(ld(),b.Od,0,Jq(a,0,b,d,e,f),b.ta.R(0).Fj())}function Aq(a,b,d,e,f,g,k){var l=Vp(a),n=b.ta.R(0);n=Wp(l,n,f,g,k);l=b.ta.R(1).De.fg.ef();a=Vp(a);b=b.ta.R(1);f=qq(a,b,!1,f,g,k);d="LinkPrims."+d+"("+n+", "+hd(id(),qd(e))+")";return rq(d,f,l)}
function Tea(a,b,d,e,f,g){var k=Vp(a),l=b.ta.R(0);k=Wp(k,l,e,f,g);d=d?"createOrderedTurtles":"createTurtles";l=b.Od;if(l instanceof tq)l=l.ia;else{if(!(l instanceof uq))throw(new Pe).c("How did you get here with class of type "+qa(l).yg());l=l.ia}a=Vp(a);b=b.ta.R(1);e=qq(a,b,!1,e,f,g);f="world.turtleManager."+d+"("+k+", "+hd(id(),l)+")";return rq(f,e,!0)}function Xea(a){return"var R \x3d "+a+"; if (R !\x3d\x3d undefined) { PrimChecks.procedure.preReturnCheck(R); return R; }"}
function dp(){this.xI=this.Qg=this.pK=this.qK=null;this.a=0}dp.prototype=new m;dp.prototype.constructor=dp;dp.prototype.b=function(){this.qK=(new gr).kC(this);this.a=(1|this.a)<<24>>24;this.pK=(new hr).kC(this);this.a=(2|this.a)<<24>>24;this.Qg=(new ir).b();this.a=(4|this.a)<<24>>24;this.xI=Mp();this.a=(8|this.a)<<24>>24;return this};
function jr(a){if(0===(8&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/Compiler.scala: 59");return a.xI}
function $ea(a,b,d){var e=afa(bfa()),f=cfa(b);e=io(f,e.Nj,e.Hi,e.$i,e.Ai,e.hg,e.Vf,e.Pg);f=Lg();f=dfa(a,b,e,f);if(null===f)throw(new q).i(f);var g=f.Ia;e=f.Wa;f=f.Ig;var k=(new kr).c(b.Zc);g=efa(ffa(new lr,mr(a),d,k),g);k=Wea();k=vb(p(function(n,t){return function(u){return nr(t,u)}}(a,p(function(n,t,u,w){return function(y){return or(n,y,!0,t,u,!1,w)}}(a,f,e,gfa(d.qp,d.gr,k,d.ho))))),p(function(n){return function(t){if(t instanceof R)return t;if(t instanceof T){var u=t.dc;t=function(){return function(L){return L}}(n);
Qo();var w=t(u.Tc),y=Ro(u.Xc);u=So().de;a:for(;;){if(y instanceof To){var E=y;y=E.Ed;u=(new To).Xb(t(E.yd),u);continue a}if(!(y instanceof Uo))throw(new q).i(y);break}return(new T).i((new Vo).Xb(w,u))}throw(new q).i(t);}}(a)));var l=vb(p(function(n,t){return function(u){return nr(t,u)}}(a,p(function(n,t,u,w){return function(y){return or(n,y,!1,t,u,!1,w)}}(a,f,e,d)))),p(function(n){return function(t){if(t instanceof R)return t;if(t instanceof T){var u=t.dc;t=function(){return function(L){return L}}(n);
Qo();var w=t(u.Tc),y=Ro(u.Xc);u=So().de;a:for(;;){if(y instanceof To){var E=y;y=E.Ed;u=(new To).Xb(t(E.yd),u);continue a}if(!(y instanceof Uo))throw(new q).i(y);break}return(new T).i((new Vo).Xb(w,u))}throw(new q).i(t);}}(a)));k=hfa(ifa(k,l),b.Wc);a=p(function(n,t){return function(u){return nr(t,u)}}(a,p(function(n,t,u,w){return function(y){return or(n,y,!0,t,u,!0,w)}}(a,f,e,d))));d=jfa(b);l=r();a=d.xa(a,l.P);return kfa(g,k,a,b,f,e)}
function Lp(a){if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/Compiler.scala: 57");return a.Qg}function dfa(a,b,d,e){b=b.Zc;var f=Lp(a);jr(a);var g=D();jr(a);var k=(new pr).b();jr(a);var l=(new qr).b();jr(a);a=jr(a);d=cc(a,b,g,d,!1,e,f,k,l);if(null===d)throw(new q).i(d);e=d.la();return(new $b).te(d.ha(),e.Zb,e.ge)}
function nr(a,b){try{bp();var d=a.w(b);return wp().w(d)}catch(e){if(e instanceof pd)return a=e,bp(),cp(Zo(),a);throw e;}}
function lfa(){var a=(new Sb).c('var modelConfig \x3d\n        |  (\n        |    (typeof global !\x3d\x3d "undefined" \x26\x26 global !\x3d\x3d null) ? global :\n        |    (typeof window !\x3d\x3d "undefined" \x26\x26 window !\x3d\x3d null) ? window :\n        |    {}\n        |  ).modelConfig || {};');a=jq(a);var b=r();return(new rr).al("modelConfig",a,H(b,(new M).q(["global.modelConfig"])))}
function mfa(a,b,d){var e=p(function(n,t){return function(u){if(u instanceof R)return u.ea;if(!(u instanceof T))throw(new q).i(u);return t.w(u.dc)}}(a,p(function(n){return function(t){var u=function(){return function(L){return L.Vc}}(n);Qo();var w=u(t.Tc),y=Ro(t.Xc);t=So().de;a:for(;;){if(y instanceof To){var E=y;y=E.Ed;t=(new To).Xb(u(E.yd),t);continue a}if(!(y instanceof Uo))throw(new q).i(y);break}u=sr((new Vo).Xb(w,t)).gb();return'modelConfig.dialog.notify("Error(s) in interface global init: '+
bc(u,"",", ","")+'")'}}(a)))),f=b.Zb,g=b.Wc,k=b.ng;a=nfa(Lp(a));var l=gk().$b;f=ofa(pfa(new tr,f,g,k,Bg(a,l),d.gr));g=qfa(ur(),b.Wc);d=rfa(vr(),b.tu);b=b.kv;k=r();e=b.xa(e,k.P).Jb("\n");b=r();e=(new rr).al("interfaceInit",e,H(b,(new M).q(["world","procedures","modelConfig"])));k=(new rr).al("global.modelConfig",sfa(),H(r(),v()));wr||(wr=(new xr).b());b=wr;a=r();f=f.oc(g,a.P);g=r();d=f.wc(d,g.P);f=r();d=d.wc(k,f.P);f=lfa();g=r();d=d.wc(f,g.P);f=r();return tfa(b,d.wc(e,f.P))}
function mr(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/Compiler.scala: 55");return a.pK}
function ufa(a,b,d,e,f){var g=Hp();vfa(Lp(a),!0);f=function(u,w){return function(y){if(null!==y)return!w.hb(y.ha());throw(new q).i(y);}}(a,f);if(d instanceof Ag)a:b:for(;;)if(d.x()){f=v();break}else{var k=d.Y(),l=d.X();if(!1===!!f(k)){d=l;continue b}c:for(;;){if(l.x())f=d;else{k=l.Y();if(!1!==!!f(k)){l=l.X();continue c}k=l;l=K(d.Y(),v());var n=d.X();for(d=l;n!==k;){var t=K(n.Y(),v());d=d.Da=t;n=n.X()}for(n=k=k.X();!k.x();){t=k.Y();if(!1===!!f(t)){for(;n!==k;)t=K(n.Y(),v()),d=d.Da=t,n=n.X();n=k.X()}k=
k.X()}n.x()||(d.Da=n);f=l}break a}}else{l=(new dc).vb((Kg(),rp()));d=yr(d);for(d=zr(d);d.qa();)k=d.ma(),!1!==!!f(k)&&fc(l,k);f=l.La}l=Lp(a);jr(a);d=D();jr(a);k=(new pr).b();jr(a);n=(new qr).b();jr(a);t=jr(a);e=cc(t,b,d,e,!1,f,l,k,n);if(null===e)throw(new q).i(e);e=e.ha();b=(new kr).c(b);a=efa(ffa(new lr,mr(a),g,b),e);return wfa(vr(),a)}
function or(a,b,d,e,f,g,k){var l=dca();var n=bi();if(!l.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/SourceWrapping.scala: 7");l=l.ZG.w(n);l=d?"to __evaluator [] "+l+" ":"to-report __evaluator [] "+l+" report ( ";dca();l=""+l+b+(d?"\n__done end":"\n) __done end");b=(new kr).c(l);g=Ar(new Br,!g,H(r(),v()));n=Lp(a);jr(a);var t=D();jr(a);jr(a);var u=(new pr).b();jr(a);var w=(new qr).b();jr(a);var y=jr(a);e=cc(y,l,t,f,!0,e,n,u,w);if(null===e)throw(new q).i(e);
e=e.ha();e=k.ho?Cr(Dr(),e.Y()):e.Y();if(d)return a=mr(a),hq(a,e.De,k,b,g);a=mr(a);d=e.De.fg.R(1).ta.R(0);return Wp(a,d,k,b,g)}dp.prototype.$classData=h({v0:0},!1,"org.nlogo.tortoise.compiler.Compiler",{v0:1,d:1});function Er(){}Er.prototype=new m;Er.prototype.constructor=Er;Er.prototype.b=function(){return this};
function xfa(a,b){var d=Fr(Gr(),(new Hr).Bg(b),"returnType"),e=Ir();d=Fd(d,e);d=d.x()?"unit":d.Q();var f="unit"!==d;e=Jr(Gr(),(new Hr).Bg(b),"argTypes");var g=Kr();e=Dd(e,g).W;a=p(function(){return function(u){return yfa(Lr(),u)}}(a));g=ij().pc;var k=Mr(e,a,g);a=Nr(d);d=Fr(Gr(),(new Hr).Bg(b),"defaultArgCount");e=Or();d=Fd(d,e);e=Fr(Gr(),(new Hr).Bg(b),"minimumArgCount");g=Or();e=Fd(e,g);g=Fr(Gr(),(new Hr).Bg(b),"agentClassString");var l=Ir();g=Fd(g,l);g=g.x()?"OTPL":g.Q();l=Fr(Gr(),(new Hr).Bg(b),
"blockAgentClassString");var n=Ir();l=Fd(l,n);if(f){f=Fr(Gr(),(new Hr).Bg(b),"isInfix");n=Pr();f=Fd(f,n);(f.x()?0:f.Q())?(f=k.Y(),k=k.X()):f=qc();f|=0;n=Fr(Gr(),(new Hr).Bg(b),"precedenceOffset");var t=Or();n=Fd(n,t);n=(n.x()?0:n.Q())|0;n=B()+n|0;a=zfa(f,k,a,n,d,e,g,l)}else a=Afa(k,d,e,g,l);b=Jr(Gr(),(new Hr).Bg(b),"name");d=Ir();return Bfa(new Qr,a,Dd(b,d))}
function Nr(a){if("agentset"===a)return Ai(C());if("agent"===a)return vi(C());if("booleanblock"===a)return Ki(C());if("boolean"===a)return xi(C());if("bracketed"===a)return ui();if("codeblock"===a)return Mi();if("commandblock"===a)return Hi(C());if("command"===a)return md(C());if("linkset"===a)return Di(C());if("link"===a)return Gi(C());if("list"===a)return zi(C());if("nobody"===a)return wi(C());if("numberblock"===a)return Li(C());if("number"===a)return O(C());if("optional"===a)return Oi();if("otherblock"===
a)return Ji(C());if("patchset"===a)return Ci(C());if("patch"===a)return Fi(C());if("readable"===a)return Rr();if("reference"===a)return ti();if("repeatable"===a)return si();if("reporterblock"===a)return Ii(C());if("reporter"===a)return td(C());if("string"===a)return yi(C());if("symbol"===a)return Ni();if("turtleset"===a)return Bi(C());if("turtle"===a)return Ei(C());if("wildcard"===a)return mc();if("unit"===a)return qc();throw jg(kg(),(new Sr).c("Unknown type given in extension: "+a));}
function yfa(a,b){if(b instanceof Tr)return Nr(b.W);if(b instanceof Ur){var d=Fr(Gr(),(new Hr).Bg(b),"isRepeatable"),e=Pr();d=Fd(d,e);d=!(d.x()||!d.Q());e=Fr(Gr(),(new Hr).Bg(b),"isOptional");var f=Pr();e=Fd(e,f);e=!(e.x()||!e.Q());if(b.Dt.Hp().hb("type"))a=Fr(Gr(),(new Hr).Bg(b),"type"),b=Ir(),a=Nr(Dd(a,b));else{b=Fr(Gr(),(new Hr).Bg(b),"types");f=Kr();b=Dd(b,f).W;f=p(function(){return function(k){Lr();var l=Ir();return Nr(Dd(k,l))}}(a));var g=ij().pc;a=Mr(b,f,g).Ub(0,xb(function(){return function(k,
l){return k|0|l|0}}(a)))|0}d=d?si():0;e=e?Oi():0;return a|d|e}throw jg(kg(),(new Sr).c("Primitive argument types must be a string value or an object with the necessary fields."));}Er.prototype.$classData=h({E0:0},!1,"org.nlogo.tortoise.compiler.CreateExtension$",{E0:1,d:1});var Vr=void 0;function Lr(){Vr||(Vr=(new Er).b());return Vr}function qq(a,b,d,e,f,g){a=d?"return "+Wp(a,b,e,f,g)+";":hq(a,b,e,f,g);b=H(r(),v());return Wr(id(),b,a)}
var hq=function Cfa(a,b,d,e,f){e=(new kr).zp(1+e.tn|0,e.Fc);if(b instanceof Ab)return Cfa(a,b.De,d,e,f);if(!(b instanceof Gb))throw(new q).i(b);b=b.fg;d=p(function(k,l,n,t){return function(u){var w=k.va?k.Ny:Dfa(k);return Oea(w,u,l,n,t)}}(a,d,e,f));f=r();return b.xa(d,f.P).kg(p(function(){return function(k){k=(new Sb).c(k);return sd(k)}}(a))).Jb("\n")},Ffa=function Efa(a,b){if(b instanceof rg){id();var e=ij().pc;e=Oc(b,e);for(b=lj(b.Mc);b.rj;){var f=b.ma();e.Ka(Efa(a,f))}return Xr(0,e.Ea()," ")}if(Xg()===
b)return"Nobody";a=Pm();return Zb(a,b,!0,!1)};function lq(a,b){return"_"+b+"_"+a.ja.Ya+"_"+a.ja.Ra}var Wp=function Gfa(a,b,d,e,f){e=(new kr).zp(1+e.tn|0,e.Fc);if(b instanceof Bb)return Gfa(a,b.zl,d,e,f);if(!(b instanceof zb))throw(new q).i(b);a=a.va?a.Ny:Dfa(a);return Hfa(a,b,d,e,f)};function Yr(){this.vF=this.AG=this.rF=null;this.a=0}Yr.prototype=new m;Yr.prototype.constructor=Yr;
Yr.prototype.b=function(){Zr=this;for(var a=[(new z).e("-","H"),(new z).e("!","_EXC_"),(new z).e("#","_POU_"),(new z).e("\\$","_DOL_"),(new z).e("%","_PER_"),(new z).e("\\^","_CAR_"),(new z).e("\\\x26","_AMP_"),(new z).e("\\*","_AST_"),(new z).e("\x3c","_LT_"),(new z).e("\x3e","_GT_"),(new z).e("/","_SL_"),(new z).e("\\.","_DOT_"),(new z).e("\\?","_Q"),(new z).e("\x3d","_EQ"),(new z).e("\\+","_PLU_"),(new z).e(":","_COL_"),(new z).e("'","_PRI_")],b=(new dc).vb(ec()),d=0,e=a.length|0;d<e;)fc(b,a[d]),
d=1+d|0;this.rF=b.La;this.a=(1|this.a)<<24>>24;this.AG=H(r(),(new M).q("^(is)([A-Z].*)$ ^(on)([a-z].*)$ ^(screen)([A-Z].*)$ ^(scroll)([A-Zb].*)$ ^(webkit)([A-Z].*)$ ^(moz)([A-Z].*)$ ^(ms)([A-Z].*)$".split(" ")));this.a=(2|this.a)<<24>>24;this.vF=H(r(),(new M).q("alert atob break blur btoa case catch class clear close closed console content copy const confirm console constructor continue crypto debugger default delete do document dump else enum escape eval event export extends external false finally find focus for frames function history if implements import in instanceof inspect interface keys length let location localStorage monitor moveBy moveTo name navigator new null open opener package parent parseFloat parseInt performance print private profile profileEnd prompt protected public return screen scroll setInterval setTimeout static status statusbar stop super switch table this throw toolbar toString top true try typeof updateCommands undefined unescape uneval unmonitor unwatch valueOf values var void while window with yield".split(" ")));
this.a=(4|this.a)<<24>>24;return this};function Ifa(a){if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/JSIdentProvider.scala: 55");return a.vF}
function Jfa(a,b){return Kfa(a).Ub(b,xb(function(){return function(d,e){e=(new Sb).c(e);var f=v();f=(new Ub).Bp(e.U,f);var g=f.nL;e=new $r;e.VD=d;e.ut=f;e.Aba=g;e.Mm=fg(f.Gf,d,Qa(d));e.co=0;d=new as;if(null===e)throw jg(kg(),null);d.Ta=e;for(d.FD=(new zm).b();d.qa();)e=Lfa(d),e=Saa(e,1).toUpperCase()+"_"+Saa(e,2),Am(d.Ta.Mm,d.FD,e);e=(new zm).AC(d.FD);Bm(d.Ta.Mm,e);return e.l()}}(a)))}
function Mfa(a,b){var d=Nfa(a);return Sh(d,b,xb(function(){return function(e,f){var g=(new z).e(e,f);e=g.ub;f=g.Hb;if(null!==f)return g=f.ha(),f=f.la(),Pb(Na(),e,g,f);throw(new q).i(g);}}(a)))}function Nfa(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/JSIdentProvider.scala: 25");return a.rF}function Ofa(a,b){return Ifa(a).Ub(b,xb(function(){return function(d,e){return d!==e?d:"_"+d.toUpperCase()+"_"}}(a)))}
function cq(a,b){return vb(p(function(){return function(d){return d.toLowerCase()}}(a)),p(function(){return function(d){return Mfa(dq(),d)}}(a))).ya(p(function(){return function(d){return Ofa(dq(),d)}}(a))).ya(p(function(){return function(d){return Jfa(dq(),d)}}(a))).w(b)}function Kfa(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/JSIdentProvider.scala: 45");return a.AG}
Yr.prototype.$classData=h({Q0:0},!1,"org.nlogo.tortoise.compiler.JSIdentProvider$",{Q0:1,d:1});var Zr=void 0;function dq(){Zr||(Zr=(new Yr).b());return Zr}function bs(){this.Gh=null;this.va=0}bs.prototype=new m;bs.prototype.constructor=bs;function Pfa(a,b){b=cs(b.nh);var d=p(function(){return function(f){return(new z).e(f.ha(),Qfa(f.la()))}}(a)),e=r();b=b.xa(d,e.P);a=a.Gh;d=r();return(new bs).Ca(b.oc(a,d.P))}bs.prototype.Ca=function(a){this.Gh=a;return this};
bs.prototype.iE=function(){var a=this.Gh,b=p(function(){return function(e){return e.la().VK(e.ha())}}(this)),d=r();return a.xa(b,d.P).od("{",",","}")};bs.prototype.$classData=h({R0:0},!1,"org.nlogo.tortoise.compiler.JavascriptObject",{R0:1,d:1});function ds(){}ds.prototype=new m;ds.prototype.constructor=ds;ds.prototype.b=function(){return this};function Xr(a,b,d){return b.ef()?b.od("[",","+d,"]"):"[]"}
function Rfa(a,b){a=(new Sb).c(b).U.split("\\").join("\\\\");a=(new Sb).c(a).U.split("\n").join("\\n");a=(new Sb).c(a).U.split('"').join('\\"');return(new Sb).c(a).U.split("'").join("\\'")}function Sfa(a,b){var d=(new Sb).c(b);return sd(d)?(b="return "+b+";",d=H(r(),v()),Wr(a,d,b)):Wr(a,H(r(),v()),"")}
function Wr(a,b,d){b=b.od("(",", ",")");if(0===(d.length|0))return"function"+b+" {}";var e=(new Sb).c(d);e=Tfa(e);if(2>es(e)&&100>(d.length|0))return"function"+b+" { "+d+" }";a="|function"+b+" {\n          |"+iq(a,d)+"\n          |}";a=(new Sb).c(a);return jq(a)}function hd(a,b){return""+Le(34)+b+Le(34)}function iq(a,b){b=(new Sb).c(b);b=Tfa(b);a=(new ac).bg(b,p(function(){return function(d){return"  "+d}}(a)));return bc(a,"","\n","")}
function fs(a){var b=id(),d=(new Sb).c(a);return sd(d)?(a+=";",d=H(r(),v()),Wr(b,d,a)):Wr(b,H(r(),v()),"")}function gs(a){return"NIL"!==a?(new Sb).c(a).U.split("'").join("\\'"):""}ds.prototype.$classData=h({V0:0},!1,"org.nlogo.tortoise.compiler.JsOps$",{V0:1,d:1});var hs=void 0;function id(){hs||(hs=(new ds).b());return hs}function is(){this.uu=null;this.a=!1}is.prototype=new m;is.prototype.constructor=is;is.prototype.b=function(){js=this;this.uu=(new dp).b();this.a=!0;return this};
is.prototype.us=function(){if(!this.a)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/js/src/main/scala/LiteralConverter.scala: 30");return this.uu};
function Ufa(a,b,d,e,f){for(var g=-1+(f.length|0)|0,k=v();0<=g;)k=K(f[g],k),g=-1+g|0;g=bc(k,""," ","");d=e?"to-report __run ["+g+"] report ("+d+"\n) end":"to __run ["+g+"] "+d+"\nend";b=pp(zd(),b);b=kp().bb(b);if(!(b instanceof R)){if(!(b instanceof T))throw(new q).i(b);k=b.dc;b=function(){return function(t){return(new qp).c(t)}}(a);Qo();g=b(k.Tc);var l=Ro(k.Xc);k=So().de;a:for(;;){if(l instanceof To){var n=l;l=n.Ed;k=(new To).Xb(b(n.yd),k);continue a}if(!(l instanceof Uo))throw(new q).i(l);break}b=
(new T).i((new Vo).Xb(g,k))}if(b instanceof R){b=b.ea;b=Fp().Qy().w(b);if(!(b instanceof R)){if(!(b instanceof T))throw(new q).i(b);b=(new T).i(mp(b.dc))}if(b instanceof R)b=b.ea,g=b.uz(),b=(new R).i((new z).e(b,g));else if(!(b instanceof T))throw(new q).i(b);if(b instanceof R){b=b.ea;if(null===b)throw(new q).i(b);b=b.la();b=Gp(Cp(),b,ks().us(),Hp());if(b instanceof R)if(d=Vfa(b.ea,d,e),d instanceof R)d=(new R).i(d.ea);else{if(!(d instanceof T))throw(new q).i(d);}else{if(!(b instanceof T))throw(new q).i(b);
d=b}}else{if(!(b instanceof T))throw(new q).i(b);d=b}}else{if(!(b instanceof T))throw(new q).i(b);d=b}if(!(d instanceof R)){if(d instanceof T){d=d.dc;ls();null===ls().QB&&null===ls().QB&&(ls().QB=new ms);ls();e=function(){return function(t){return t.Tf()}}(a);Qo();f=e(d.Tc);d=Ro(d.Xc);a=So().de;a:for(;;){if(d instanceof To){b=d;d=b.Ed;a=(new To).Xb(e(b.yd),a);continue a}if(!(d instanceof Uo))throw(new q).i(d);break}e=(new Vo).Xb(f,a);f=Qo().kD;e=Wfa(e,f);e=e.Kt.Jk(e.zc);throw(new ns).c(bc(e,"","\n",
""));}throw(new q).i(d);}a=d.ea;d=[];b=0;for(g=f.length|0;b<g;)k=f[b],k=cq(dq(),k),d.push(k),b=1+b|0;f=bc((new os).q(d),"",", ","");return e?"(function("+f+") { return ("+a+"); })":"(function("+f+") { "+a+" })"}is.prototype.compileRunString=function(a,b,d,e){return Ufa(this,a,b,!!d,e)};is.prototype.stringToJSValue=function(a){try{var b=(new ps).b(),d=Xfa(dj(),a);var e=b.db(d,ud().zB)}catch(f){a=vm(kg(),f);if(a instanceof Sr)throw(new ns).c(a.Tf());throw f;}return e};
is.prototype.$classData=h({W0:0},!1,"org.nlogo.tortoise.compiler.LiteralConverter$",{W0:1,d:1});var js=void 0;function ks(){js||(js=(new is).b());return js}function qs(){}qs.prototype=new m;qs.prototype.constructor=qs;qs.prototype.b=function(){return this};qs.prototype.l=function(){return"nobody"};qs.prototype.toString=function(){return"nobody"};qs.prototype.getBreedName=function(){return"nobody"};qs.prototype.isDead=function(){return!0};
Object.defineProperty(qs.prototype,"id",{get:function(){return-1},configurable:!0});qs.prototype.ask=function(){};qs.prototype.$classData=h({b1:0},!1,"org.nlogo.tortoise.compiler.Nobody$",{b1:1,d:1});var rs=void 0;function Yfa(){rs||(rs=(new qs).b());return rs}function ss(){this.a=0}ss.prototype=new m;ss.prototype.constructor=ss;ss.prototype.b=function(){return this};
function Cr(a,b){return vb(p(function(){return function(d){ts||(ts=(new us).b());return Kb(ts,d)}}(a)),p(function(){return function(d){vs||(vs=(new ws).b());return Kb(vs,d)}}(a))).ya(p(function(){return function(d){xs||(xs=(new ys).b());return Kb(xs,d)}}(a))).ya(p(function(){return function(d){zs||(zs=(new As).b());return Kb(zs,d)}}(a))).ya(p(function(){return function(d){Bs||(Bs=(new Cs).b());return Kb(Bs,d)}}(a))).ya(p(function(){return function(d){Ds||(Ds=(new Es).b());return Kb(Ds,d)}}(a))).ya(p(function(){return function(d){Fs||
(Fs=(new Gs).b());return Kb(Fs,d)}}(a))).ya(p(function(){return function(d){Hs||(Hs=(new Is).b());return Kb(Hs,d)}}(a))).ya(p(function(){return function(d){Js||(Js=(new Ks).b());return Kb(Js,d)}}(a))).ya(p(function(){return function(d){Ls||(Ls=(new Ms).b());return Kb(Ls,d)}}(a))).ya(p(function(){return function(d){Ns||(Ns=(new Os).b());return Kb(Ns,d)}}(a))).ya(p(function(){return function(d){Ps||(Ps=(new Qs).b());return Kb(Ps,d)}}(a))).ya(p(function(){return function(d){Rs||(Rs=(new Ss).b());return Kb(Rs,
d)}}(a))).ya(p(function(){return function(d){Ts||(Ts=(new Us).b());return Kb(Ts,d)}}(a))).ya(p(function(){return function(d){Vs||(Vs=(new Ws).b());return Kb(Vs,d)}}(a))).ya(p(function(){return function(d){Xs||(Xs=(new Ys).b());return Kb(Xs,d)}}(a))).ya(p(function(){return function(d){Zs||(Zs=(new $s).b());return Kb(Zs,d)}}(a))).ya(p(function(){return function(d){at||(at=(new bt).b());return Kb(at,d)}}(a))).ya(p(function(){return function(d){ct||(ct=(new dt).b());return Kb(ct,d)}}(a))).ya(p(function(){return function(d){et||
(et=(new ft).b());return Kb(et,d)}}(a))).ya(p(function(){return function(d){gt||(gt=(new ht).b());return Kb(gt,d)}}(a))).ya(p(function(){return function(d){it||(it=(new jt).b());return Kb(it,d)}}(a))).ya(p(function(){return function(d){kt||(kt=(new lt).b());return Kb(kt,d)}}(a))).ya(p(function(){return function(d){mt||(mt=(new nt).b());return Kb(mt,d)}}(a))).ya(p(function(){return function(d){ot||(ot=(new pt).b());return Kb(ot,d)}}(a))).w(b)}
ss.prototype.$classData=h({c1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$",{c1:1,d:1});var qt=void 0;function Dr(){qt||(qt=(new ss).b());return qt}function rt(){}rt.prototype=new m;rt.prototype.constructor=rt;rt.prototype.b=function(){return this};
rt.prototype.Gb=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof st&&(r(),d=(new I).i(b),null!==d.M&&0===d.M.sb(2)&&(b=d.M.R(0),d=d.M.R(1),b instanceof zb&&(b=th().Gb(b),!b.x()&&(b=b.Q().Ia,b instanceof fr&&d instanceof zb)))))return(new I).i((new z).e(b,d))}d=th().Gb(a);return!d.x()&&(a=d.Q().Ia,d=d.Q().Wa,a instanceof st&&(r(),d=(new I).i(d),null!==d.M&&0===d.M.sb(2)&&(a=d.M.R(0),d=d.M.R(1),a instanceof zb&&d instanceof zb&&(d=th().Gb(d),!d.x()&&(d=d.Q().Ia,d instanceof
fr)))))?(new I).i((new z).e(d,a)):D()};rt.prototype.$classData=h({f2:0},!1,"org.nlogo.tortoise.compiler.Optimizer$WithTransformer$PatchVarEqualExpression$",{f2:1,d:1});var tt=void 0;function ut(){this.a=0}ut.prototype=new m;ut.prototype.constructor=ut;ut.prototype.b=function(){return this};
function qfa(a,b){var d=(new vt).b(),e=r();b=b.ic(d,e.P);a=p(function(){return function(n){var t=new wt;t.Cl=n;n=t.Cl.hq;if(n instanceof R)n=n.ea,t=Zfa(t,n.ek,n.fk,n.rs);else{if(!(n instanceof T))throw(new q).i(n);t=$fa(t,n.dc)}return t}}(a));d=r();a=b.xa(a,d.P);b=(new xt).b();d=r();b=a.ic(b,d.P);d=(new yt).b();e=r();d=a.ic(d,e.P).Ms(Ke().jl);a=Xr(id(),b," ");d=d.x()?"":aga(ur(),d.Jb(", "));b=r();e=(new zt).xf("PenBundle","engine/plot/pen");var f=(new zt).xf("Plot","engine/plot/plot"),g=(new zt).xf("PlotOps",
"engine/plot/plotops"),k=bga(0,"modelConfig.plotOps","{}"),l=r();k=(new At).al("modelPlotOps",k,H(l,(new M).q(["modelConfig"])));l=r();a=[e,f,g,k,(new rr).al("modelConfig.plots","modelConfig.plots \x3d "+a+";"+d,H(l,(new M).q(["PenBundle","Plot","PlotOps","modelConfig","modelPlotOps"])))];return H(b,(new M).q(a))}function aga(a,b){return'modelConfig.dialog.notify("Error: '+b+'");'}function bga(a,b,d){return"(typeof "+b+' !\x3d\x3d "undefined" \x26\x26 '+b+" !\x3d\x3d null) ? "+b+" : "+d}
ut.prototype.$classData=h({g2:0},!1,"org.nlogo.tortoise.compiler.PlotCompiler$",{g2:1,d:1});var Bt=void 0;function ur(){Bt||(Bt=(new ut).b());return Bt}function wt(){this.Cl=null}wt.prototype=new m;wt.prototype.constructor=wt;
function cga(a,b){a=function(){return function(g){return g.Tf()}}(a);Qo();var d=a(b.Tc),e=Ro(b.Xc);b=So().de;a:for(;;){if(e instanceof To){var f=e;e=f.Ed;b=(new To).Xb(a(f.yd),b);continue a}if(!(e instanceof Uo))throw(new q).i(e);break}return(new Ct).Ca(sr((new Vo).Xb(d,b)).gb())}
function $fa(a,b){a=function(){return function(g){return g.Tf()}}(a);Qo();var d=a(b.Tc),e=Ro(b.Xc);b=So().de;a:for(;;){if(e instanceof To){var f=e;e=f.Ed;b=(new To).Xb(a(f.yd),b);continue a}if(!(e instanceof Uo))throw(new q).i(e);break}return(new Ct).Ca(sr((new Vo).Xb(d,b)).gb())}
function Zfa(a,b,d,e){var f=fs(""),g=Sfa(id(),f);f="new PlotOps("+f+", "+f+", "+f+", "+g+", "+g+", "+g+", "+g+")";g=p(function(t){return function(u){var w=u.Et;if(w instanceof R){u=u.pt;w=w.ea;Dt||(Dt=(new Et).b());var y=Dt;var E=u.Bb,L=raa(y).Cc(E);y=+(L.x()?qaa(y,E):L.Q());switch(u.Ul){case 0:E="Line";break;case 1:E="Bar";break;case 2:E="Point";break;default:E="Line"}y="new PenBundle.State("+y+", "+u.Pl+", "+("PenBundle.DisplayMode."+E)+")";u=H(r(),(new M).q(["'"+u.ab+"'","plotOps.makePenOps","false",
y,w.ek,w.fk]));u=(new Ft).c("new PenBundle.Pen("+u.Jb(", ")+")")}else{if(!(w instanceof T))throw(new q).i(w);u=cga(t,w.dc)}return u}}(a));var k=r();e=e.xa(g,k.P);g=(new xt).b();k=r();g=e.ic(g,k.P);k=(new yt).b();var l=r();k=e.ic(k,l.P).Ms(Ke().jl);e=Xr(id(),g,"\n");g=k.x()?"":aga(ur(),k.Jb(", "));k=r();id();id();l=a.Cl.kj.Eo;l=hd(0,gs(l.x()?"":l.Q()));id();id();var n=a.Cl.kj.Go;n=hd(0,gs(n.x()?"":n.Q()));k=H(k,(new M).q(["name","pens","plotOps",l,n,a.Cl.kj.Wn,a.Cl.kj.sn,a.Cl.kj.mj,a.Cl.kj.lj,a.Cl.kj.oj,
a.Cl.kj.nj,"setup","update"])).Jb(", ");a="|var name    \x3d '"+a.Cl.qH+"';\n            |var plotOps \x3d "+bga(ur(),"modelPlotOps[name]",f)+";\n            |var pens    \x3d "+e+";"+g+"\n            |var setup   \x3d "+b+";\n            |var update  \x3d "+d+";\n            |return new Plot("+k+");";a=(new Sb).c(a);a=jq(a);b=H(r(),v());return(new Ft).c("("+Wr(id(),b,a)+")()")}wt.prototype.$classData=h({m2:0},!1,"org.nlogo.tortoise.compiler.PlotCompiler$RichCompiledPlot",{m2:1,d:1});
function Gt(){this.CH=null;this.a=!1}Gt.prototype=new m;Gt.prototype.constructor=Gt;Gt.prototype.b=function(){this.CH="";this.a=!0;return this};function sfa(){Ht||(Ht=(new Gt).b());var a=Ht;if(!a.a)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/js/src/main/scala/Polyfills.scala: 6");return a.CH}Gt.prototype.$classData=h({o2:0},!1,"org.nlogo.tortoise.compiler.Polyfills$",{o2:1,d:1});var Ht=void 0;function lr(){this.wH=this.yH=this.qk=null}lr.prototype=new m;
lr.prototype.constructor=lr;function dga(a,b,d,e){b=d.ho?Cr(Dr(),b):b;var f=b.aj.Ze().toLowerCase(),g=cq(dq(),f);Hq(a.qk,(new z).e(0,g));var k=vc(b.aj);hj();g=ij().pc;g=Oc(k,g);for(k=lj(k);k.rj;){var l=k.ma();g.Ka((new z).e(l,cq(dq(),l)))}g=g.Ea();g=Ar(new Br,!0,g);k=g.Um;l=p(function(){return function(t){return t.la()}}(a));var n=r();k=k.xa(l,n.P);a=hq(a.qk,b.De,d,e,g);a="("+Wr(id(),k,a)+")";return b.aj.rt.Km?(new It).xC(f,b.sc(),a):(new Jt).xC(f,b.sc(),a)}
function ffa(a,b,d,e){a.qk=b;a.yH=d;a.wH=e;return a}function efa(a,b){a=p(function(e){return function(f){return dga(e,f,e.yH,e.wH)}}(a));var d=r();return b.xa(a,d.P)}lr.prototype.$classData=h({t2:0},!1,"org.nlogo.tortoise.compiler.ProcedureCompiler",{t2:1,d:1});function Kt(){}Kt.prototype=new m;Kt.prototype.constructor=Kt;Kt.prototype.b=function(){return this};function rfa(a,b){a=wfa(vr(),b);b=r();return(new rr).al("procedures",a,H(b,(new M).q(["workspace","world"])))}
function wfa(a,b){a=p(function(){return function(e){return e.vI()}}(a));var d=r();return b.xa(a,d.P).Jb("\n")}Kt.prototype.$classData=h({u2:0},!1,"org.nlogo.tortoise.compiler.ProcedureCompiler$",{u2:1,d:1});var Lt=void 0;function vr(){Lt||(Lt=(new Kt).b());return Lt}function ega(a,b,d,e,f,g){var k=Mt(a,0,d,e,f,g);a=Mt(a,1,d,e,f,g);return"("+k+" "+b+" "+a+")"}function Nt(a,b,d,e,f){b=b.ta;var g=new Ot;if(null===a)throw jg(kg(),null);g.Ta=a;g.zH=d;g.xH=e;g.KK=f;a=r();return b.ic(g,a.P)}
function fga(a){r();var b=(new I).i(a);if(null!==b.M&&0===b.M.sb(1))return"Prims.rangeUnary("+b.M.R(0)+")";r();b=(new I).i(a);if(null!==b.M&&0===b.M.sb(2))return a=b.M.R(0),b=b.M.R(1),"Prims.rangeBinary("+a+", "+b+")";r();var d=(new I).i(a);if(null!==d.M&&0===d.M.sb(3))return a=d.M.R(0),b=d.M.R(1),d=d.M.R(2),"Prims.rangeTernary("+a+", "+b+", "+d+")";throw(new Pe).c("range expects at most three arguments");}function Pt(a,b,d,e,f){return Pea(ld(),b,Nt(a,b,d,e,f))}
function gga(a){return"SelfManager.self()._optimalNSum4("+hd(id(),a)+")"}function Qt(a,b,d,e,f,g){a=Vp(a);b=d.ta.R(b);return Wp(a,b,e,f,g)}function hga(a){return"SelfManager.self()._optimalNSum("+hd(id(),a)+")"}function Mt(a,b,d,e,f,g){return Zea(ld(),d.xe,b,Qt(a,b,d,e,f,g),d.ta.R(b).Fj())}
function Hfa(a,b,d,e,f){var g=b.xe;ud();var k=(new Rt).b(),l=vd(new wd,k).ed(g);if(!l.x())return l.Q();ud();var n=(new St).b(),t=vd(new wd,n).ed(g);if(!t.x())return t.Q()+"("+Nt(a,b,d,e,f).Jb(", ")+")";ud();var u=(new Tt).b(),w=vd(new wd,u).ed(g);if(!w.x())return w.Q()+"("+Pt(a,b,d,e,f)+")";ud();var y=(new Ut).b(),E=vd(new wd,y).ed(g);if(!E.x())return"NLType.checks."+E.Q()+Qt(a,0,b,d,e,f)+")";var L=iga(a).pE(g);if(!L.x())return L.Q();if(g instanceof dm){var S=Vp(a);return Ffa(S,g.W)}if(g instanceof
Pp)return cq(dq(),g.fd.pa);if(g instanceof eq||g instanceof Al)return cq(dq(),g.pa);if(g instanceof Vt)return"PrimChecks.procedure.callReporter("+Vea(ld(),g.ii.Ze(),Nt(a,b,d,e,f))+")";if(g instanceof Wt){var ia=Nt(a,b,d,e,f),na=r(),pa=ia.Fd("''",na.P),ua=p(function(){return function(fk){return"workspace.dump("+fk+")"}}(a)),Ka=r();return pa.xa(ua,Ka.P).od("("," + ",")")}if(g instanceof Xt)return jga(a,b.ta,d,e,f);if(g instanceof Yt)return"Tasks.nValues("+Qt(a,0,b,d,e,f)+", "+Qt(a,1,b,d,e,f)+")";if(g instanceof
Zt){var Da=g.fd;if(Da instanceof I){var Ha=Da.M;return"_error_"+V(U(),Ha)+".message"}}if(g instanceof $t)return ega(a,"\x26\x26",b,d,e,f);if(g instanceof au)return ega(a,"||",b,d,e,f);if(g instanceof bu){var kb=Mt(a,0,b,d,e,f),lb=Vp(a),Tb=b.ta.R(1);return"PrimChecks.agentset.all("+kb+", "+qq(lb,Tb,!0,d,e,f)+")"}if(g instanceof cu){var Rb=Mt(a,1,b,d,e,f),ad=Mt(a,0,b,d,e,f),oc=Vp(a),kd=b.ta.R(2);return"PrimChecks.agentset.maxNOf("+Rb+", "+ad+", "+qq(oc,kd,!0,d,e,f)+")"}if(g instanceof du){var Sc=Mt(a,
0,b,d,e,f),bd=Vp(a),yc=b.ta.R(1);return"PrimChecks.agentset.maxOneOf("+Sc+", "+qq(bd,yc,!0,d,e,f)+")"}if(g instanceof eu){var kc=Mt(a,1,b,d,e,f),Bd=Mt(a,0,b,d,e,f),Tc=Vp(a),Af=b.ta.R(2);return"PrimChecks.agentset.minNOf("+kc+", "+Bd+", "+qq(Tc,Af,!0,d,e,f)+")"}if(g instanceof fu){var me=Mt(a,0,b,d,e,f),Ch=Vp(a),Fe=b.ta.R(1);return"PrimChecks.agentset.minOneOf("+me+", "+qq(Ch,Fe,!0,d,e,f)+")"}if(g instanceof gu){var Zf=Mt(a,1,b,d,e,f),Cd=Vp(a),pc=b.ta.R(0);return"PrimChecks.agentset.of("+Zf+", "+qq(Cd,
pc,!0,d,e,f)+")"}if(g instanceof hu){var Fb=Mt(a,1,b,d,e,f),cd=Vp(a),La=b.ta.R(0);return"PrimChecks.agentset.sortOn("+Fb+", "+qq(cd,La,!0,d,e,f)+")"}if(g instanceof iu){var gc=Mt(a,0,b,d,e,f),hc=Vp(a),Ym=b.ta.R(1);return"PrimChecks.agentset.with("+gc+", "+qq(hc,Ym,!0,d,e,f)+")"}if(g instanceof ju){var $g=Mt(a,0,b,d,e,f),Zm=Vp(a),jl=b.ta.R(1);return"PrimChecks.agentset.withMax("+$g+", "+qq(Zm,jl,!0,d,e,f)+")"}if(g instanceof ku){var $m=Mt(a,0,b,d,e,f),an=Vp(a),kl=b.ta.R(1);return"PrimChecks.agentset.withMin("+
$m+", "+qq(an,kl,!0,d,e,f)+")"}if(g instanceof lu){var bn=Qt(a,0,b,d,e,f),ll=Vp(a),ml=b.ta.R(1);return"PrimChecks.agentset.countOtherWith("+bn+", "+qq(ll,ml,!0,d,e,f)+")"}if(g instanceof mu){var nl=Qt(a,0,b,d,e,f),cn=Vp(a),ol=b.ta.R(1);return"PrimChecks.agentset.countWith("+nl+", "+qq(cn,ol,!0,d,e,f)+")"}if(g instanceof nu){var dn=Qt(a,0,b,d,e,f),ei=Vp(a),Yj=b.ta.R(1);return"PrimChecks.agentset.otherWith("+dn+", "+qq(ei,Yj,!0,d,e,f)+")"}if(g instanceof ou){var Ui=Qt(a,0,b,d,e,f),en=Vp(a),Vi=b.ta.R(1);
return"PrimChecks.agentset.anyOtherWith("+Ui+", "+qq(en,Vi,!0,d,e,f)+")"}if(g instanceof pu){var fn=Qt(a,0,b,d,e,f),Wi=Vp(a),Zj=b.ta.R(1);return"PrimChecks.agentset.oneOfWith("+fn+", "+qq(Wi,Zj,!0,d,e,f)+")"}if(g instanceof qu){var ak=Qt(a,0,b,d,e,f),pl=Vp(a),Xi=b.ta.R(1);return"PrimChecks.agentset.anyWith("+ak+", "+qq(pl,Xi,!0,d,e,f)+")"}if(g instanceof ru)return"PrimChecks.agentset.optimizeCount("+Qt(a,0,b,d,e,f)+", "+g.nH+", "+g.lK+")";if(g instanceof su)return hga(g.rl);if(g instanceof tu)return gga(g.rl);
if(g instanceof uu)return"SelfManager.self()._optimalPatchHereInternal()";if(g instanceof vu)return"SelfManager.self()._optimalPatchNorth()";if(g instanceof wu)return"SelfManager.self()._optimalPatchEast()";if(g instanceof xu)return"SelfManager.self()._optimalPatchSouth()";if(g instanceof yu)return"SelfManager.self()._optimalPatchWest()";if(g instanceof zu)return"SelfManager.self()._optimalPatchNorthEast()";if(g instanceof Au)return"SelfManager.self()._optimalPatchSouthEast()";if(g instanceof Bu)return"SelfManager.self()._optimalPatchSouthWest()";
if(g instanceof Cu)return"SelfManager.self()._optimalPatchNorthWest()";if(g instanceof Du)return"world.turtleManager.turtlesOfBreed("+hd(id(),g.ia)+")";if(g instanceof Eu)return"world.turtleManager.getTurtleOfBreed("+hd(id(),g.ia)+", "+Qt(a,0,b,d,e,f)+")";if(g instanceof Fu)return"world.linkManager.linksOfBreed("+hd(id(),g.ia)+")";if(g instanceof Gu)return"world.linkManager.getLink("+Qt(a,0,b,d,e,f)+", "+Qt(a,1,b,d,e,f)+", "+hd(id(),g.ia)+")";if(g instanceof Hu)return"SelfManager.self().breedAt("+
hd(id(),g.ia)+", "+Qt(a,0,b,d,e,f)+", "+Qt(a,1,b,d,e,f)+")";if(g instanceof Iu)return"SelfManager.self().breedHere("+hd(id(),g.ia)+")";if(g instanceof Ju)return"PrimChecks.agentset.breedOn("+hd(id(),g.ia)+", "+Mt(a,0,b,d,e,f)+")";if(g instanceof Ku)return"PrimChecks.list.butFirst('"+g.E().Qb+"', "+Pt(a,b,d,e,f)+")";if(g instanceof Lu)return"PrimChecks.list.butLast('"+g.E().Qb+"', "+Pt(a,b,d,e,f)+")";if(g instanceof Mu)return"LinkPrims.inLinkFrom("+hd(id(),qd(g.ia))+", "+Qt(a,0,b,d,e,f)+")";if(g instanceof
Nu)return"LinkPrims.isInLinkNeighbor("+hd(id(),qd(g.ia))+", "+Qt(a,0,b,d,e,f)+")";if(g instanceof Ou)return"LinkPrims.inLinkNeighbors("+hd(id(),qd(g.ia))+")";if(g instanceof Pu)return"LinkPrims.isLinkNeighbor("+hd(id(),qd(g.ia))+", "+Qt(a,0,b,d,e,f)+")";if(g instanceof Qu)return"LinkPrims.linkNeighbors("+hd(id(),qd(g.ia))+")";if(g instanceof Ru)return"LinkPrims.linkWith("+hd(id(),qd(g.ia))+", "+Qt(a,0,b,d,e,f)+")";if(g instanceof Su)return"LinkPrims.myInLinks("+hd(id(),qd(g.ia))+")";if(g instanceof
Tu)return"LinkPrims.myLinks("+hd(id(),qd(g.ia))+")";if(g instanceof Uu)return"LinkPrims.myOutLinks("+hd(id(),qd(g.ia))+")";if(g instanceof Vu)return"LinkPrims.isOutLinkNeighbor("+hd(id(),qd(g.ia))+", "+Qt(a,0,b,d,e,f)+")";if(g instanceof Wu)return"LinkPrims.outLinkNeighbors("+hd(id(),qd(g.ia))+")";if(g instanceof Xu)return"LinkPrims.outLinkTo("+hd(id(),qd(g.ia))+", "+Qt(a,0,b,d,e,f)+")";if(g instanceof Yu){var gn="PrimChecks.procedure.runResult("+Mt(a,0,b,d,e,f)+cr(ld(),Nt(a,b,d,e,f).Td(1))+")",Yi=
b.ta.R(0).Fj();return Iaa(a,Yi,f,gn)}if(g instanceof um){var hn=b.ta.R(0),ql=g.Nd.Qk(),jn=p(function(){return function(fk){return cq(dq(),fk)}}(a)),rl=r(),kn=ql.xa(jn,rl.P);return"Tasks.reporterTask("+kga(a,hn,!0,kn,g.Fc,d,e,f)+")"}if(g instanceof gm){var ln=b.ta.R(0),sl=g.Nd.Qk(),mn=p(function(){return function(fk){return cq(dq(),fk)}}(a)),tl=r(),ul=sl.xa(mn,tl.P);return"Tasks.commandTask("+kga(a,ln,!1,ul,g.Fc,d,e,f)+")"}if(g instanceof Zu){var Cg=(new Sb).c("_externreport\\(([^:]+):([^)]+)\\)"),
ah=v(),nn=(new Ub).Bp(Cg.U,ah),vl=g.l();var fi=gg(nn,vl);if(fi.x())Zi=!1;else if(null!==fi.Q())var bk=fi.Q(),Zi=0===hg(bk,2);else Zi=!1;if(Zi)var wl=fi.Q().R(0),bh=fi.Q().R(1);else throw(new q).i(vl);var ck=wl,gi=bh;return"Extensions["+hd(id(),ck)+"].prims["+hd(id(),gi)+"]("+Nt(a,b,d,e,f).Jb(", ")+")"}if(g instanceof $u){var Dh=Nt(a,b,d,e,f);return fga(Dh)}if(d.qp){var $i=qa(b.xe).yg(),aj=(new Sb).c($i),dk=aj.U.length|0,Eh=Ie(Je(),aj.U,1,dk);return Gaa(Eh)}var on="unimplemented primitive: "+b.xe.E().Qb,
ek=b.xe.E();nd(on,ek.ja.Ya,ek.ja.Ra,ek.ja.$a)}function kga(a,b,d,e,f,g,k,l){a=Vp(a);b=d?"return "+Wp(a,b,g,k,l)+";":hq(a,b,g,k,l);0<e.ra()?(b="PrimChecks.procedure.runArgCountCheck("+e.ra()+", arguments.length);\n          |"+b,b=(new Sb).c(b),b=jq(b)):(b=(new Sb).c(""+b),b=jq(b));e=Wr(id(),e,b)+", ";id();f=f.x()?"":f.Q();f=hd(0,Rfa(0,f));return e+f}
var jga=function lga(a,b,d,e,f){if(0===b.ra())return"Prims.ifElseValueMissingElse()";if(1===b.ra())return a=Vp(a),b=b.R(0),Wp(a,b,d,e,f);var k=Vp(a),l=b.R(0);k=Wp(k,l,d,e,f);l=Vp(a);var n=b.R(1);l=Wp(l,n,d,e,f);b=b.Td(2);return"(Prims.ifElseValueBooleanCheck("+k+") ? "+l+" : "+lga(a,b,d,e,f)+")"};function av(){this.dM=null;this.a=!1}av.prototype=new m;av.prototype.constructor=av;
av.prototype.b=function(){bv=this;sc();cv();ij();cv();hj();for(var a=(new dv).b(),b=1;;){var d=Sa(+ba.Math.pow(2,b));ev(a,d);if(20===b)break;b=1+b|0}this.dM=fv(a);this.a=!0;return this};function jd(a,b,d){return mga(a).Xk(p(function(e,f,g){return function(k){k|=0;ld();var l;if(l=0===(f&k))ld(),l=0!==(g&k);return l}}(a,b,d)),!1).x()}function Vea(a,b,d){return'"'+b.toLowerCase()+'"'+cr(0,d)}function cr(a,b){a=b.Jb(", ");return""===a?"":", "+a}
function mga(a){if(!a.a)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/Prims.scala: 102");return a.dM}function Zea(a,b,d,e,f){a=b.A();d=Ul(a)?0===d?a.Xa:Rh(a.Na,-1+d|0)|0:Rh(a.Na,d)|0;return nga(ld(),b.E().Qb,d,f,e)}
function Pea(a,b,d){var e=b.ct().A();if(Ul(e)){A();for(var f=[e.Xa],g=-1+(f.length|0)|0,k=v();0<=g;)k=K(f[g],k),g=-1+g|0;f=k;e=e.Na;g=A();e=f.oc(e,g.P)}else e=e.Na;f=b.ta;g=A().P;e=gv(e,f,g);f=A();d=e.Re(d,f.P);a=function(l,n){return function(t){if(null!==t){var u=t.ha(),w=t.la();if(null!==u){var y=u.Mi();u=u.la();if(null!==u&&null!==w)return nga(ld(),n.ct().E().Qb,y,u.Fj(),w)}}throw(new q).i(t);}}(a,b);b=A().P;if(b===A().P)if(d===v())a=v();else{b=d.Y();e=b=K(a(b),v());for(d=d.X();d!==v();)f=d.Y(),
f=K(a(f),v()),e=e.Da=f,d=d.X();a=b}else{for(b=Oc(d,b);!d.x();)e=d.Y(),b.Ka(a(e)),d=d.X();a=b.Ea()}return bc(a,"",", ","")}function nga(a,b,d,e,f){return jd(ld(),d,e)?f:"PrimChecks.validator.checkArg('"+b.toUpperCase()+"', "+d+", "+f+")"}av.prototype.$classData=h({w2:0},!1,"org.nlogo.tortoise.compiler.ReporterPrims$",{w2:1,d:1});var bv=void 0;function ld(){bv||(bv=(new av).b());return bv}function tr(){this.iK=this.Us=this.ng=this.Wc=this.Zb=null}tr.prototype=new m;tr.prototype.constructor=tr;
function ofa(a){var b=r(),d=(new At).al("turtleShapes",oga(pga(new hv,ci(),qga(iv(),a.ng.Ph))),H(r(),v())),e=(new At).al("linkShapes",oga(pga(new hv,hi(),qga(iv(),a.ng.Mh))),H(r(),v())),f=r(),g=r(),k=[rga(a)];g=H(g,(new M).q(k));k=sga(a);var l=r(),n=["'"+Rfa(id(),a.ng.Zc)+"'"];l=H(l,(new M).q(n));n=r();id();var t=a.Wc,u=p(function(){return function(Cd){Cd=tga(Cd).Af();return xd(Cd)}}(a)),w=r();t=[Xr(0,t.xa(u,w.P)," ")];n=H(n,(new M).q(t));t=r();u=[uga(a)];g=[g,k,l,n,H(t,(new M).q(u)),vga(a)];f=H(f,
(new M).q(g));g=r();f=(new jv).iv(f,H(g,(new M).q(["turtleShapes","linkShapes"])));g=kv("BreedManager");k=kv("ImportExportPrims");l=kv("InspectionPrims");n=kv("LayoutManager");t=kv("LinkPrims");u=kv("ListPrims");w=kv("MousePrims");var y=kv("OutputPrims"),E=kv("plotManager"),L=kv("Prims"),S=kv("PrintPrims"),ia=kv("SelfPrims"),na=kv("SelfManager"),pa=kv("UserDialogPrims"),ua=kv("Updater"),Ka=kv("world"),Da=kv("PrimChecks"),Ha=kv("RandomPrims"),kb=kv("ProcedurePrims"),lb=(new zt).xf("{ DeathInterrupt, StopInterrupt }",
"util/interrupts"),Tb=(new zt).xf("Exception","util/exception"),Rb=(new zt).xf("NLMath","util/nlmath"),ad=(new zt).xf("notImplemented","util/notimplemented"),oc=(new zt).xf("ColorModel","engine/core/colormodel"),kd=(new zt).xf("Link","engine/core/link"),Sc=(new zt).xf("LinkSet","engine/core/linkset"),bd=(new zt).xf("PatchSet","engine/core/patchset"),yc=(new zt).xf("Turtle","engine/core/turtle"),kc=(new zt).xf("TurtleSet","engine/core/turtleset"),Bd=(new zt).xf("NLType","engine/core/typechecker"),
Tc=(new zt).xf("Tasks","engine/prim/tasks"),Af=(new zt).xf("AgentModel","agentmodel"),me=(new zt).xf("Meta","meta"),Ch=(new zt).xf("Random","shim/random"),Fe=(new zt).xf("StrictMath","shim/strictmath"),Zf=H(r(),(new M).q(["workspace"]));a=[d,e,f,g,k,l,n,t,u,w,y,E,L,S,ia,na,pa,ua,Ka,Da,Ha,kb,lb,Tb,Rb,ad,oc,kd,Sc,bd,yc,kc,Bd,Tc,Af,me,Ch,Fe,wga(new lv,Zf,go(a.Us))];return H(b,(new M).q(a))}function pfa(a,b,d,e,f,g){a.Zb=b;a.Wc=d;a.ng=e;a.Us=f;a.iK=g;return a}
function sga(a){var b=yo(a.Zb),d=mv(Ke(),xga());d=nv(b,d);b=xo(a.Zb);var e=mv(Ke(),yga());b=nv(b,e);id();e=p(function(){return function(g){return g.toLowerCase()}}(a));var f=r();d=d.xa(e,f.P);e=p(function(){return function(g){return hd(id(),g)}}(a));f=r();d=Xr(0,d.xa(e,f.P)," ");id();e=p(function(){return function(g){return g.toLowerCase()}}(a));f=r();b=b.xa(e,f.P);a=p(function(){return function(g){return hd(id(),g)}}(a));e=r();a=Xr(0,b.xa(a,e.P)," ");return H(r(),(new M).q([a,d]))}
function uga(a){var b=a.Us;a=p(function(){return function(e){return'"'+e+'"'}}(a));var d=gk().$b;b=Mr(b,a,d);return'tortoise_require("extensions/all").porters('+bc(b,"",", ","")+")"}function kv(a){var b=(new Sb).c(a);b=Qi(b);b=null===b?0:b.W;eh();b=65535&(ba.String.fromCharCode(b).toLowerCase().charCodeAt(0)|0);b=Le(b);var d=(new Sb).c(a);b=""+b+pj(d);d=r();return(new At).al(a,"workspace."+b,H(d,(new M).q(["workspace"])))}function oga(a){var b=a.wr.Tn().td();return sd(b)?zga(ov(),a):"{}"}
function vga(a){var b=mea(a.Zb),d=mv(Ke(),Aga());b=nv(b,d);id();d=wo(a.Zb);var e=p(function(){return function(k){return k.toLowerCase()}}(a)),f=r();d=d.xa(e,f.P);e=p(function(){return function(k){return hd(id(),k)}}(a));f=r();d=Xr(0,d.xa(e,f.P)," ");id();e=a.Zb.Aj;f=p(function(){return function(k){return k.toLowerCase()}}(a));var g=r();e=e.xa(f,g.P);f=p(function(){return function(k){return hd(id(),k)}}(a));g=r();e=Xr(0,e.xa(f,g.P)," ");id();f=p(function(){return function(k){return k.toLowerCase()}}(a));
g=r();b=b.xa(f,g.P);f=p(function(){return function(k){return hd(id(),k)}}(a));g=r();f=Xr(0,b.xa(f,g.P)," ");g=lg(a.ng.Wc,new pv).Q();b=r();d=[d,e,f,Bga(g),Cga(g),Dga(g),Ega(g),Fga(g),Gga(g),Hga(g),"turtleShapes","linkShapes",a.iK];b=H(b,(new M).q(d));a=p(function(){return function(k){return oa(k)}}(a));d=r();return b.xa(a,d.P)}
function rga(a){var b=(new Mc).lg(a.Zb.hg),d=(new Mc).lg(a.Zb.Vf),e=Nc().P;b=qv(b,d,e);a=p(function(f){return function(g){var k=hd(id(),g.Rp),l=hd(id(),g.Sp);id();var n=g.Ak,t=p(function(){return function(w){return w.toLowerCase()}}(f)),u=r();n=n.xa(t,u.P);t=p(function(){return function(w){return hd(id(),w)}}(f));u=r();n=Xr(0,n.xa(t,u.P)," ");return"{ name: "+k+", singular: "+l+", varNames: "+n+(g.jh?", isDirected: "+g.ih:"")+" }"}}(a));d=Nc();a=b.xa(a,d.P).tc();return Xr(id(),a," ")}
tr.prototype.$classData=h({C2:0},!1,"org.nlogo.tortoise.compiler.RuntimeInit",{C2:1,d:1});function xr(){}xr.prototype=new m;xr.prototype.constructor=xr;
function Iga(a,b){var d=p(function(){return function(k){return k.oo()}}(a)),e=r();d=b.xa(d,e.P);e=r();d=d.Re(b,e.P).Oe(Ke().jl);e=p(function(k){return function(l){var n=l.zs();l=p(function(u,w){return function(y){var E=w.oo();return(new z).e(y,E)}}(k,l));var t=r();return n.xa(l,t.P)}}(a));var f=r();b=b.Ti(e,f.P).td();e=d.Tn();f=p(function(){return function(k){return rv(k).Sf.la()}}(a));var g=gk().$b;f=Mr(b,f,g);e=Lc(e,f);f=r();b=Jga(a,H(f,(new M).q([e])),b);a=p(function(k,l){return function(n){var t=
gk().$b;n=Mr(n,l,t).tc();t=(new sv).b();return Kga(n,t)}}(a,d));d=r();return b.Ti(a,d.P)}xr.prototype.b=function(){return this};function Lga(a,b){var d=p(function(){return function(f){return f.oo()}}(a)),e=r();d=b.xa(d,e.P);a=p(function(){return function(f){return f.zs()}}(a));e=r();b=b.Ti(a,e.P).td();d=d.td();return Lc(b,d)}
function tfa(a,b){var d=Lga(a,b);if(d.x())return b=Iga(a,b),a=p(function(){return function(e){return e.uw()}}(a)),d=r(),b.xa(a,d.P).od("","\n","\n");throw(new Pe).c("Please provide the following dependencies: "+bc(d,"",", ",""));}
function Jga(a,b,d){for(;;)if(sd(d)){var e=tv(d,p(function(l,n){return function(t){return n.Hd().hb(rv(t).Sf.ha())}}(a,b)));if(null===e)throw(new q).i(e);var f=e.ha();e=e.la();var g=p(function(){return function(l){return rv(l).Sf.la()}}(a)),k=gk().$b;f=Mr(f,g,k);g=p(function(){return function(l){return rv(l).Sf.la()}}(a));k=gk().$b;f=f.Qj(Mr(e,g,k));if(sd(f))d=r(),b=b.wc(f,d.P),d=e;else throw e=d,a=p(function(){return function(l){return"from "+l.la()+" to "+l.ha()}}(a)),b=gk().$b,a=Mr(e,a,b).Jb(",\n"),
(new Pe).c("unable to satisfy dependencies: "+a);}else return b}xr.prototype.$classData=h({M2:0},!1,"org.nlogo.tortoise.compiler.TortoiseLoader$",{M2:1,d:1});var wr=void 0;function uv(){this.Sf=null}uv.prototype=new m;uv.prototype.constructor=uv;function rv(a){var b=new uv;b.Sf=a;return b}uv.prototype.$classData=h({N2:0},!1,"org.nlogo.tortoise.compiler.TortoiseLoader$RichEdge$1",{N2:1,d:1});function vv(){this.jB=this.iB=null}vv.prototype=new m;vv.prototype.constructor=vv;
function Mga(a,b){if(b instanceof wv){id();var d=b.ab;d=gs(d.x()?"":d.Q());var e=r(),f=[(new z).e("setup",b.Fg),(new z).e("update",b.Hg)];e=H(e,(new M).q(f));f=p(function(t,u){return function(w){if(null!==w){var y=w.ha();w=w.la();xv();w=Nga(t,w,u,D());return yv(zv(w),"plot",u,y)}throw(new q).i(w);}}(a,d));var g=r();f=e.xa(f,g.P);r();e=(new I).i(f);if(null!==e.M&&0===e.M.sb(2))f=e.M.R(0),e=e.M.R(1);else throw(new q).i(f);Zo();Qo();g=(new zp).Sq();g=Av(g);var k=(new R).i(xb(function(t,u,w){return function(y,
E){var L=u.mo,S=function(ua,Ka){return function(Da){return Oga(ua,Ka,Da)}}(t,w),ia=A().P;if(ia===A().P)if(L===v())S=v();else{ia=L.Y();var na=ia=K(S(ia),v());for(L=L.X();L!==v();){var pa=L.Y();pa=K(S(pa),v());na=na.Da=pa;L=L.X()}S=ia}else{for(ia=Oc(L,ia);!L.x();)na=L.Y(),ia.Ka(S(na)),L=L.X();S=ia.Ea()}return(new Bv).al(y,E,S)}}(a,b,d)));g=a=g.Gn;k=(new z).e(f,(new R).i(wb(k.ea)));a:{var l=k.ub,n=k.Hb;if(l instanceof R&&(l=l.ea,n instanceof R)){f=(new R).i(n.ea.w(l));break a}n=k.ub;l=k.Hb;if(n instanceof
T&&l instanceof R)f=n;else if(n=k.Hb,k.ub instanceof R&&n instanceof T)f=n;else{l=k.ub;n=k.Hb;if(l instanceof T&&(l=l.dc,n instanceof T)){f=(new T).i(g.xc(n.dc,J(function(t,u){return function(){return u}}(f,l))));break a}throw(new q).i(k);}}f=(new z).e(e,f);a:{k=f.ub;g=f.Hb;if(k instanceof R&&(k=k.ea,g instanceof R)){e=(new R).i(g.ea.w(k));break a}g=f.ub;k=f.Hb;if(g instanceof T&&k instanceof R)e=g;else if(g=f.Hb,f.ub instanceof R&&g instanceof T)e=g;else{k=f.ub;g=f.Hb;if(k instanceof T&&(k=k.dc,
g instanceof T)){e=(new T).i(a.xc(g.dc,J(function(t,u){return function(){return u}}(e,k))));break a}throw(new q).i(f);}}return Pga(b,d,e)}if(b instanceof Cv)return(new Dv).av(b,Qga(a,b));if(b instanceof Ev)return(new Dv).av(b,Rga(a,b));if(b instanceof Fv)return(new Dv).av(b,Sga(a,b));bp();d=Tga();return(new Dv).av(b,wp().w(d))}function Gv(a,b,d){d="ask "+a+" [ "+d+" ]";return b?"ifelse count "+a+" \x3d 0 [ stop ] [ "+d+" ]":d}
function Sga(a,b){var d=r(),e=(new z).e("min",b.$n),f=(new z).e("max",b.Nm);e=[e,f,(new z).e("step",b.bn)];d=H(d,(new M).q(e));b=gaa(xb(function(l,n){return function(t,u){xv();u=l.jB.w(u);var w=n.ab;return yv(zv(u),"slider",w.x()?n.Ht():w.Q(),t)}}(a,b)));e=r();b=d.xa(b,e.P);r();d=(new I).i(b);if(null!==d.M&&0===d.M.sb(3))f=d.M.R(0),b=d.M.R(1),e=d.M.R(2);else throw(new q).i(b);d=b;b=e;Zo();Qo();e=(new zp).Sq();e=Av(e);var g=J(function(l,n){return function(){return n}}(a,f));f=(new R).i(xb(function(l,
n){return function(t,u){var w=t.ha();t=t.la();return(0,n.Si)(w,t,u)}}(e,Hv(function(){return function(l,n,t){var u=new Iv;u.qs=l;u.ps=n;u.ts=t;return u}}(a)))));a=e.Gn;var k=(new R).i(xb(function(){return function(l,n){return(new z).e(l,n)}}(e)));d=Uga(d,J(function(l,n,t){return function(){return l.Pf(n,J(function(u,w){return function(){return u.zd(w,p(function(){return function(y){return wb(y)}}(u)))}}(l,t)))}}(e,g,k)),e.Gn);e=e.Gn;f=(new z).e(d,(new R).i(wb(f.ea)));a:{k=f.ub;g=f.Hb;if(k instanceof
R&&(k=k.ea,g instanceof R)){d=(new R).i(g.ea.w(k));break a}g=f.ub;k=f.Hb;if(g instanceof T&&k instanceof R)d=g;else if(g=f.Hb,f.ub instanceof R&&g instanceof T)d=g;else{k=f.ub;g=f.Hb;if(k instanceof T&&(k=k.dc,g instanceof T)){d=(new T).i(e.xc(g.dc,J(function(l,n){return function(){return n}}(d,k))));break a}throw(new q).i(f);}}d=(new z).e(b,d);f=d.ub;e=d.Hb;if(f instanceof R&&(f=f.ea,e instanceof R))return(new R).i(e.ea.w(f));e=d.ub;f=d.Hb;if(e instanceof T&&f instanceof R)return e;e=d.Hb;if(d.ub instanceof
R&&e instanceof T)return e;f=d.ub;e=d.Hb;if(f instanceof T&&(f=f.dc,e instanceof T))return(new T).i(a.xc(e.dc,J(function(l,n){return function(){return n}}(b,f))));throw(new q).i(d);}
function Oga(a,b,d){var e=r(),f=[(new z).e("setup",d.Fg),(new z).e("update",d.Hg)];e=H(e,(new M).q(f));b=p(function(n,t,u){return function(w){if(null!==w){var y=w.ha();w=w.la();xv();w=Nga(n,w,t,rd().ed(u.ab));w=zv(w);var E=rd().ed(u.ab);return yv(w,"pen",E.x()?"":E.Q(),y)}throw(new q).i(w);}}(a,b,d));f=r();e=e.xa(b,f.P);r();b=(new I).i(e);if(null!==b.M&&0===b.M.sb(2))e=b.M.R(0),b=b.M.R(1);else throw(new q).i(e);Zo();Qo();f=(new zp).Sq();f=Av(f);var g=(new R).i(xb(function(){return function(n,t){return(new Jv).xf(n,
t)}}(a)));f=a=f.Gn;g=(new z).e(e,(new R).i(wb(g.ea)));a:{var k=g.ub,l=g.Hb;if(k instanceof R&&(k=k.ea,l instanceof R)){e=(new R).i(l.ea.w(k));break a}l=g.ub;k=g.Hb;if(l instanceof T&&k instanceof R)e=l;else if(l=g.Hb,g.ub instanceof R&&l instanceof T)e=l;else{k=g.ub;l=g.Hb;if(k instanceof T&&(k=k.dc,l instanceof T)){e=(new T).i(f.xc(l.dc,J(function(n,t){return function(){return t}}(e,k))));break a}throw(new q).i(g);}}e=(new z).e(b,e);a:{g=e.ub;f=e.Hb;if(g instanceof R&&(g=g.ea,f instanceof R)){b=
(new R).i(f.ea.w(g));break a}f=e.ub;g=e.Hb;if(f instanceof T&&g instanceof R)b=f;else if(f=e.Hb,e.ub instanceof R&&f instanceof T)b=f;else{g=e.ub;f=e.Hb;if(g instanceof T&&(g=g.dc,f instanceof T)){b=(new T).i(a.xc(f.dc,J(function(n,t){return function(){return t}}(b,g))));break a}throw(new q).i(e);}}return Vga(d,b)}vv.prototype.Hl=function(a){throw(new Pe).c("This type of agent cannot be asked: "+a);};
function Qga(a,b){var d=b.vn.l().toUpperCase(),e=b.Fc;d=Wga(a,d,e.x()?"":e.Q()).split("\\n").join("\n").split("\\\\").join("\\").split('\\"').join('"');xv();a=a.iB.w(d);a=zv(a);d=b.ab;b=d.x()?b.Fc:d;b=yv(a,"button",b.x()?"":b.Q(),"source");if(b instanceof R)return(new R).i((new Kv).c(b.ea));if(b instanceof T)return b;throw(new q).i(b);}
function Nga(a,b,d,e){e.x()?e=D():(e=e.Q(),e=(new I).i("'"+e+"'"));e=e.x()?"undefined":e.Q();var f=b.trim();if(null===f)throw(new xe).b();if(""===f)return bp(),d=fs(""),wp().w(d);a=a.iB.w(b);if(a instanceof R)a=(new R).i(fs(a.ea));else if(!(a instanceof T))throw(new q).i(a);if(a instanceof R)return d="ProcedurePrims.runInPlotContext('"+d+"', "+e+", "+a.ea+")",(new R).i(Sfa(id(),d));if(a instanceof T)return a;throw(new q).i(a);}
function Wga(a,b,d){var e=(new z).e("OBSERVER",p(function(){return function(l){return l}}(a))),f=(new z).e("TURTLE",p(function(){return function(l){return Gv("turtles",!0,l)}}(a))),g=(new z).e("PATCH",p(function(){return function(l){return Gv("patches",!1,l)}}(a)));e=[e,f,g,(new z).e("LINK",p(function(){return function(l){return Gv("links",!0,l)}}(a)))];f=(new dc).vb(ec());g=0;for(var k=e.length|0;g<k;)fc(f,e[g]),g=1+g|0;return f.La.ci(b,J(function(l,n){return function(){l.Hl(n)}}(a,b))).w(d)}
function Xga(a,b){b=b.Xk(p(function(){return function(f){return f instanceof wv}}(a)),!1);a=Yga(b,p(function(){return function(f){if(f instanceof wv)return f.ab;throw(new q).i(f);}}(a))).kg(p(function(){return function(f){return 1<f.la().za()}}(a)));if(sd(a)){a=a.Tn();a="Having multiple plots with same display name is not supported. Duplicate names detected: "+bc(a,"",", ","");b=Qk().ja.Ya;var d=Qk().ja.Ra,e=Qk();throw(new pd).Xs(a,b,d,e.ja.$a);}}
function Rga(a,b){xv();var d=b.Fc;a=a.jB.w(d.x()?"":d.Q());a=zv(a);d=b.ab;b=d.x()?b.Fc:d;b=yv(a,"monitor",b.x()?"":b.Q(),"reporter");if(b instanceof R)return(new R).i((new Kv).c(b.ea));if(b instanceof T)return b;throw(new q).i(b);}function ifa(a,b){var d=new vv;d.iB=a;d.jB=b;return d}function hfa(a,b){Xga(a,b);a=p(function(e){return function(f){return Mga(e,f)}}(a));var d=r();return b.xa(a,d.P)}vv.prototype.$classData=h({h3:0},!1,"org.nlogo.tortoise.compiler.WidgetCompiler",{h3:1,d:1});
function Lv(){this.LL=this.QJ=null;this.a=0}Lv.prototype=new m;Lv.prototype.constructor=Lv;Lv.prototype.b=function(){Mv=this;for(var a=[(new z).e("compiledSource","reporter")],b=(new dc).vb(ec()),d=0,e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.QJ=b.La;this.a=(1|this.a)<<24>>24;a=[(new z).e("compiledMin","getMin"),(new z).e("compiledMax","getMax"),(new z).e("compiledStep","getStep")];b=(new dc).vb(ec());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.LL=b.La;this.a=(2|this.a)<<24>>24;return this};
function Zga(a,b){id();a=p(function(){return function(e){return $ga(xv(),e).iE()}}(a));var d=r();return Xr(0,b.xa(a,d.P),"\n")}
function $ga(a,b){var d=Pfa((new bs).Ca(v()),tga(b).Af());if(null!==b){var e=b.hq;if(b.kj instanceof Ev&&e instanceof R&&(e=e.ea,e instanceof Kv))return a=xb(function(){return function(f,g){xv();var k=xv();if(0===(1&k.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/WidgetCompiler.scala: 147");return aha(k.QJ,f,g)}}(a)),e.kB().Ub(d,a)}return null!==b&&(e=b.hq,b.kj instanceof Fv&&e instanceof R&&(b=e.ea,b instanceof Iv))?(a=xb(function(){return function(f,
g){xv();var k=xv();if(0===(2&k.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/WidgetCompiler.scala: 150");return aha(k.LL,f,g)}}(a)),b.kB().Ub(d,a)):d}function aha(a,b,d){if(null!==d){var e=d.la();a=a.w(d.ha());d=H(r(),v());var f=r();e=(new Nv).iv(d,H(f,(new M).q(["return "+e+";"])));e=(new z).e(a,e);b=b.Gh;a=r();return(new bs).Ca(b.Fd(e,a.P))}throw(new q).i(d);}
Lv.prototype.$classData=h({i3:0},!1,"org.nlogo.tortoise.compiler.WidgetCompiler$",{i3:1,d:1});var Mv=void 0;function xv(){Mv||(Mv=(new Lv).b());return Mv}function Ov(){this.oM=null}Ov.prototype=new m;Ov.prototype.constructor=Ov;
function yv(a,b,d,e){b=b+" '"+d+"' - "+b+"."+e;d=a.oM;if(d instanceof R)return d;if(d instanceof T){d=d.dc;a=function(g,k){return function(l){return(new Sr).c(k+": "+l.Tf())}}(a,b);Qo();b=a(d.Tc);e=Ro(d.Xc);d=So().de;a:for(;;){if(e instanceof To){var f=e;e=f.Ed;d=(new To).Xb(a(f.yd),d);continue a}if(!(e instanceof Uo))throw(new q).i(e);break}return(new T).i((new Vo).Xb(b,d))}throw(new q).i(d);}function zv(a){var b=new Ov;b.oM=a;return b}
Ov.prototype.$classData=h({j3:0},!1,"org.nlogo.tortoise.compiler.WidgetCompiler$ValidationContextualizer",{j3:1,d:1});function Pv(){}Pv.prototype=new m;Pv.prototype.constructor=Pv;Pv.prototype.b=function(){return this};Pv.prototype.$classData=h({k3:0},!1,"org.nlogo.tortoise.compiler.json.ElemToJsonConverters$",{k3:1,d:1});var Qv=void 0;function Rv(){this.Tv=null;this.a=0;this.va=!1}Rv.prototype=new m;Rv.prototype.constructor=Rv;Rv.prototype.b=function(){return this};
Rv.prototype.uD=function(){if(!this.va&&!this.va){var a=(new we).b();if(a.Aa)a=a.Oa;else{if(null===a)throw(new xe).b();a=a.Aa?a.Oa:ye(a,(new Sv).b())}a=(new z).e("line",a);var b=(new we).b();if(b.Aa)b=b.Oa;else{if(null===b)throw(new xe).b();b=b.Aa?b.Oa:ye(b,(new Tv).b())}b=(new z).e("circle",b);var d=(new we).b();if(d.Aa)d=d.Oa;else{if(null===d)throw(new xe).b();d=d.Aa?d.Oa:ye(d,(new Uv).b())}d=(new z).e("rectangle",d);var e=(new we).b();if(e.Aa)e=e.Oa;else{if(null===e)throw(new xe).b();e=e.Aa?e.Oa:
ye(e,(new Vv).b())}a=[a,b,d,(new z).e("polygon",e)];b=(new dc).vb(ec());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.Tv=b.La;this.va=!0}return this.Tv};Rv.prototype.$classData=h({q3:0},!1,"org.nlogo.tortoise.compiler.json.ElementReader$",{q3:1,d:1});var Wv=void 0;function Xv(a){return(new sp).ac(Dc(a.Iq().nh,a.yq().nh))}function bha(){var a=v();return(new sp).ac(Jg(Kg(),a))}function Yv(){}Yv.prototype=new m;Yv.prototype.constructor=Yv;Yv.prototype.b=function(){return this};
function yd(a,b){return ba.JSON.stringify(b)}
function pp(a,b){var d=(new z).e(b,typeof b);if(null===d.ub)return Zv();a=d.Hb;if("undefined"===a||"function"===a)return Zv();a=d.ub;if("number"===d.Hb)return b=+a,$v(aw(),b)?(new Ip).wb(Sa(b)):(new bw).rk(b);a=d.ub;if("string"===d.Hb)return(new fp).c(a);a=d.ub;if("boolean"===d.Hb)return(new Jp).md(!!a);a=d.ub;var e=d.Hb;if(a instanceof ba.Array&&"object"===e&&ba.Array.isArray(a)){b=[];d=0;for(e=a.length|0;d<e;){var f=a[d];f=pp(zd(),f);b.push(f);d=1+d|0}a=-1+(b.length|0)|0;for(d=v();0<=a;)d=K(b[a],
d),a=-1+a|0;return(new ip).Ca(d)}if("object"===d.Hb){d=ba.Object.keys(b);Nc();om();a=[];e=0;for(f=d.length|0;e<f;){var g=d[e];zd();if(!cw().il.call(b,g))throw(new dw).c("key not found: "+g);var k=pp(0,b[g]);g=(new z).e(g,k);a.push(g);e=1+e|0}Kg();b=(new dc).vb(rp());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;return(new sp).ac(b.La)}throw(new q).i(d);}
function Ad(a,b){if(Zv()===b)return null;if(b instanceof Ip)return b.ui;if(b instanceof bw)return b.El;if(b instanceof fp)return b.Vc;if(b instanceof Jp)return b.Qi;if(b instanceof ip){b=b.La;a=p(function(){return function(e){return Ad(zd(),e)}}(a));var d=r();a=b.xa(a,d.P);b=cha();if(a instanceof os)return a.kf;if(a instanceof M)return a.wa;d=[];a.ua(p(function(e,f){return function(g){return f.push(g)|0}}(b,d)));return d}if(b instanceof sp)return d=b.nh,ew||(ew=(new fw).b()),b=ew,a=(new gw).my(d,
p(function(){return function(e){return Ad(zd(),e)}}(a))),dha(b,cs(a));throw(new q).i(b);}Yv.prototype.$classData=h({y3:0},!1,"org.nlogo.tortoise.compiler.json.JsonLibrary$",{y3:1,d:1});var hw=void 0;function zd(){hw||(hw=(new Yv).b());return hw}function eha(a,b){bp();a="could not convert "+vp(a)+" to "+vp(b);return cp(Zo(),a)}
function iw(a,b,d){d=(new jw).Ma(d);kw();d=d.tL;if(d instanceof I)b=(new R).i(d.M);else{if(D()!==d)throw(new q).i(d);Qo();b="could not find key "+b;d=[];var e=So().de,f=d.length|0;a:for(;;){if(0!==f){e=(new To).Xb(d[-1+f|0],e);f=-1+f|0;continue a}break}b=(new T).i((new Vo).Xb(b,e))}if(b instanceof R)return a.bb(b.ea);if(b instanceof T)return b;throw(new q).i(b);}function lw(){this.pL=this.MJ=this.rJ=null;this.a=0}lw.prototype=new m;lw.prototype.constructor=lw;
lw.prototype.b=function(){mw=this;this.rJ=(new nw).b();this.a=(1|this.a)<<24>>24;this.MJ=(new ow).b();this.a=(2|this.a)<<24>>24;this.pL=(new pw).b();this.a=(4|this.a)<<24>>24;return this};function fha(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/json/JsonSerializer.scala: 99");return a.MJ}
function gha(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/json/JsonSerializer.scala: 90");return a.rJ}function qw(a,b){return gha(a).Wl(fha(a)).Wl(hha(a)).db(b,p(function(){return function(){return(new fp).c("XXX IMPLEMENT ME")}}(a)))}function hha(a){if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/json/JsonSerializer.scala: 108");return a.pL}
function zga(a,b){return vb(p(function(){return function(d){return qw(ov(),d)}}(a)),p(function(){return function(d){return Ad(zd(),d)}}(a))).ya(p(function(){return function(d){return yd(zd(),d)}}(a))).w(b)}lw.prototype.$classData=h({F3:0},!1,"org.nlogo.tortoise.compiler.json.JsonSerializer$",{F3:1,d:1});var mw=void 0;function ov(){mw||(mw=(new lw).b());return mw}function rw(a,b){return(new I).i(a.Bc(b))}function sw(){this.IJ=this.qM=null;this.a=0}sw.prototype=new m;sw.prototype.constructor=sw;
sw.prototype.b=function(){tw=this;this.qM=(new uw).b();this.a=(16|this.a)<<24>>24;this.IJ=(new vw).b();this.a=(32|this.a)<<24>>24;return this};function iha(a,b,d){return d instanceof sp?(a=d.nh,b=(new fp).c(b),(new sp).ac(a.hn((new z).e("name",b)))):d}function jha(a){if(null===a)throw(new xe).b();return a.Aa?a.Oa:ye(a,(new ww).b())}function xw(a,b){if(b instanceof sp)return a=(new we).b(),(a.Aa?a.Oa:kha(a)).eb(b);bp();b="Expected shape as json object, got "+b;return cp(Zo(),b)}
function kha(a){if(null===a)throw(new xe).b();return a.Aa?a.Oa:ye(a,(new yw).b())}function lha(a,b){if(b&&b.$classData&&b.$classData.Sb.FF)return mha(b);if(b&&b.$classData&&b.$classData.Sb.EF)return nha(b);throw(new q).i(b);}function oha(a,b){if(b instanceof sp){var d=b.nh;b=zw().P;b=Oc(d,b);d=yr(d);for(d=zr(d);d.qa();){var e=d.ma();if(null===e)throw(new q).i(e);var f=e.ha();e=e.la();b.Ka(iha(Aw(),f,e))}return a.bb((new ip).Ca(b.Ea().tc()))}return a.bb(b)}
sw.prototype.$classData=h({$3:0},!1,"org.nlogo.tortoise.compiler.json.ShapeToJsonConverters$",{$3:1,d:1});var tw=void 0;function Aw(){tw||(tw=(new sw).b());return tw}function Bw(){this.pa=null}Bw.prototype=new m;Bw.prototype.constructor=Bw;Bw.prototype.c=function(a){this.pa=a;return this};Bw.prototype.$classData=h({p4:0},!1,"org.nlogo.tortoise.compiler.json.TortoiseJson$JsField",{p4:1,d:1});function Cw(){this.Tv=null;this.a=0}Cw.prototype=new m;Cw.prototype.constructor=Cw;
Cw.prototype.b=function(){Dw=this;var a=(new we).b();if(a.Aa)a=a.Oa;else{if(null===a)throw(new xe).b();a=a.Aa?a.Oa:ye(a,(new Ew).b())}a=(new z).e("button",a);var b=(new we).b();if(b.Aa)b=b.Oa;else{if(null===b)throw(new xe).b();b=b.Aa?b.Oa:ye(b,(new Fw).b())}b=(new z).e("chooser",b);var d=(new we).b();if(d.Aa)d=d.Oa;else{if(null===d)throw(new xe).b();d=d.Aa?d.Oa:ye(d,(new Gw).b())}d=(new z).e("inputBox",d);var e=(new we).b();if(e.Aa)e=e.Oa;else{if(null===e)throw(new xe).b();e=e.Aa?e.Oa:ye(e,(new Hw).b())}e=
(new z).e("monitor",e);var f=(new we).b();if(f.Aa)f=f.Oa;else{if(null===f)throw(new xe).b();f=f.Aa?f.Oa:ye(f,(new Iw).b())}f=(new z).e("output",f);var g=(new we).b();if(g.Aa)g=g.Oa;else{if(null===g)throw(new xe).b();g=g.Aa?g.Oa:ye(g,(new Jw).b())}g=(new z).e("plot",g);var k=(new we).b();if(k.Aa)k=k.Oa;else{if(null===k)throw(new xe).b();k=k.Aa?k.Oa:ye(k,(new Kw).b())}k=(new z).e("slider",k);var l=(new we).b();if(l.Aa)l=l.Oa;else{if(null===l)throw(new xe).b();l=l.Aa?l.Oa:ye(l,(new Lw).b())}l=(new z).e("switch",
l);var n=(new we).b();if(n.Aa)n=n.Oa;else{if(null===n)throw(new xe).b();n=n.Aa?n.Oa:ye(n,(new Mw).b())}n=(new z).e("textBox",n);var t=(new we).b();if(t.Aa)t=t.Oa;else{if(null===t)throw(new xe).b();t=t.Aa?t.Oa:ye(t,(new Nw).b())}a=[a,b,d,e,f,g,k,l,n,(new z).e("view",t)];b=(new dc).vb(ec());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.Tv=b.La;this.a|=1024;return this};
Cw.prototype.uD=function(){if(0===(1024&this.a))throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/json/WidgetRead.scala: 178");return this.Tv};Cw.prototype.$classData=h({v4:0},!1,"org.nlogo.tortoise.compiler.json.WidgetRead$",{v4:1,d:1});var Dw=void 0;function Ow(){this.yu=this.sK=null}Ow.prototype=new m;Ow.prototype.constructor=Ow;
Ow.prototype.b=function(){Pw=this;this.sK=H(Ke().rm,(new M).q([Qw().$z,Qw().Sw]));Rw();var a=(new Sw).b();this.yu=pha(a);return this};Ow.prototype.$classData=h({J5:0},!1,"org.scalajs.testinterface.HTMLRunner$EventCounter$",{J5:1,d:1});var Pw=void 0;function Tw(){Pw||(Pw=(new Ow).b());return Pw}function Uw(){this.oD=null;this.Rz=!1;this.pD=this.lo=this.tK=this.Kv=this.Lv=null}Uw.prototype=new m;Uw.prototype.constructor=Uw;
function qha(a,b,d){b.ua(p(function(e,f){return function(g){g.IL(!!f.checked)}}(a,d)));return!0}function rha(a,b,d){var e=b.Ih(p(function(){return function(f){return f.hz()}}(a)));a=!e&&b.Xe(p(function(){return function(f){return f.hz()}}(a)));(d.indeterminate=a)||(d.checked=e);return!0}function Vw(a){return a?"success":"error"}
function sha(a){a=Ww(a.lo.dh,"","warn");Xw(Yw(),a,"There are new excluded tests in your project. You may wish to ");Zw(Yw(),a,"?","Run all");Xw(Yw(),a," to rediscover all available tests.")}function tha(a,b,d){return function(e,f,g){return function(){return qha(e,f,g)}}(a,b,d)}
function $w(a){var b=Tw().yu.Pr().tg(ax())|0;b=bx((new cx).Ca((new M).q(["Total: ",""])),(new M).q([b]));var d=Qw().Xr.Cq();var e=[];for(var f=0,g=d.j.length;f<g;){var k=d.j[f];k=bx((new cx).Ca((new M).q(["",": ",""])),(new M).q([k,Tw().yu.w(k)]));e.push(null===k?null:k);f=1+f|0}d=la(ab(sa),e);e=d.j.length;f=1+e|0;f=ma(ab(sa),[f]);f.j[0]=b;dx(ex(),d,0,f,1,e);b=bc((new Gl).Vi(f),"",", ","");a.lo.qB.textContent=a.Rz?b:"Running... "+b}function uha(a,b){b=(new fx).dv(a,b);a.Lv.Rj(b);return b}
function vha(a,b,d){return function(e,f,g){return function(){return rha(e,f,g)}}(a,b,d)}
function wha(a,b){var d=new Uw;d.oD=a;d.Rz=!1;Gc();d.Lv=(new M).b();Gc();d.Kv=(new M).b();var e=ba.document.body;d.tK=gx(Yw(),e,"","","div");e=new hx;var f=a.za();if(null===d)throw jg(kg(),null);e.ka=d;0===f?b=bx((new cx).Ca((new M).q(["Total Test Suites: ",""])),(new M).q([b])):(f=b-f|0,b=bx((new cx).Ca((new M).q(["Selected Test Suites "," (Total: ",")"])),(new M).q([f,b])));e.dh=(new ix).dv(d,b);jx(e.dh);e.dh.qi.onclick=tha(d,d.Lv,e.dh.qi);e.qB=Ww(e.dh,"","info");e.iM=vha(d,d.Lv,e.dh.qi);d.lo=e;
d.pD=a.ef()?xha(d):d.lo;$w(d);return d}Uw.prototype.yB=function(a){this.Rz=!0;a.JB().ua(p(function(b){return function(d){Ww(b.lo.dh,"Test framework crashed during execution:","error");var e=b.lo;d=d.l();return Ww(e.dh,d,"error")}}(this)));this.lo.Rx(!!a.TB(J(function(){return function(){return!1}}(this))));$w(this)};Uw.prototype.$classData=h({L5:0},!1,"org.scalajs.testinterface.HTMLRunner$UI",{L5:1,d:1});function kx(){}kx.prototype=new m;kx.prototype.constructor=kx;kx.prototype.b=function(){return this};
function yha(a,b,d){a=gx(Yw(),b,"","","input");a.setAttribute("type","checkbox");a.checked=d;return a}function gx(a,b,d,e,f){a=ba.document.createElement(f);f=(new Sb).c(d);sd(f)&&(a.className=d);d=(new Sb).c(e);sd(d)&&(a.textContent=e);b.appendChild(a);return a}function Xw(a,b,d){a=ba.document.createTextNode(d);b.appendChild(a);return a}function Zw(a,b,d,e){a=gx(Yw(),b,"",e,"a");a.setAttribute("href",d);return a}
kx.prototype.$classData=h({T5:0},!1,"org.scalajs.testinterface.HTMLRunner$dom$RichElement$",{T5:1,d:1});var lx=void 0;function Yw(){lx||(lx=(new kx).b());return lx}function mx(){}mx.prototype=new m;mx.prototype.constructor=mx;mx.prototype.b=function(){return this};
function zha(a,b){b=(new os).q(b);b=wg(b,0,b.kf.length|0);a=nx(Op(b).xa(p(function(){return function(d){var e=ox(px(),d);var f=(new qx).b();e.x()?e=D():(f=vd(new wd,f),e=e.Q(),e=f.ed(e));if(e.x()){var g=aa.exportsNamespace;d=(new Sb).c(d);d=Hh(d,46);e=d.j.length;f=0;a:for(;;){if(f!==e){var k=d.j[f];g=void 0===g?void 0:g[k];f=1+f|0;continue a}d=g;break}d=void 0===d?void 0:new d;(new rx).b();d=void 0===d?void 0:Gd(d)?d:void 0;d=void 0===d?D():(new I).i(d)}else d=e;return d}}(a)),mg().$b),p(function(){return function(d){return d.gb()}}(a)));
return rj(a)}
function Aha(){sx||(sx=(new mx).b());var a=sx;for(var b=ba.definedTests,d=[],e=0,f=b.length|0;e<f;){var g=b[e];g=tx(ux(),g);d.push(g);e=1+e|0}e=ba.testFrameworkNames;b=[];f=0;for(g=e.length|0;f<g;){var k=zha(a,e[f]).gb();if(null!==k)a:for(;;){if(sd(k)){var l=k.Y();b.push(l);k=k.X();continue a}break}else for(;!k.x();)l=k.Y(),b.push(l),k=k.X();f=1+f|0}e=-1+(b.length|0)|0;for(f=v();0<=e;)f=K(b[e],f),e=-1+e|0;b=f;a=function(n,t){return function(u){for(var w=Bha(),y=[],E=0,L=t.length|0;E<L;){for(var S=
t[E],ia=S,na=0;;){var pa;if(pa=na<w.j.length){pa=w.j[na];var ua=ia.iq;pa=!1===(vx(pa)&&vx(ua)?pa.rv()===ua.rv()&&pa.nw()===ua.nw():wx(pa)&&wx(ua)?pa.Zq===ua.Zq&&pa.zx===ua.zx:!1)}if(pa)na=1+na|0;else break}na!==w.j.length!==!1&&y.push(S);E=1+E|0}return(new z).e(u,(new M).q(y))}}(a,d);d=A().P;if(d===A().P){if(b===v())return v();d=b.Y();e=d=K(a(d),v());for(b=b.X();b!==v();)f=b.Y(),f=K(a(f),v()),e=e.Da=f,b=b.X();return d}for(d=Oc(b,d);!b.x();)e=b.Y(),d.Ka(a(e)),b=b.X();return d.Ea()}
mx.prototype.$classData=h({V5:0},!1,"org.scalajs.testinterface.TestDetector$",{V5:1,d:1});var sx=void 0;function xx(){}xx.prototype=new m;xx.prototype.constructor=xx;xx.prototype.b=function(){return this};
function Cha(a,b){var d=px();var e=a+"$";d=d.KJ;e=cw().il.call(d,e)?(new I).i(d[e]):D();if(e.x()){if(b instanceof yx)b=b.WJ;else throw(new Pe).c("Need a ScalaJSClassLoader.");a:for(a=(new Sb).c(a),a=Hh(a,46),e=a.j.length,d=0;;){if(d===e)break a;b=b[a.j[d]];d=1+d|0}a=b()}else a=e.Q().Kra();return a}xx.prototype.$classData=h({Y5:0},!1,"org.scalajs.testinterface.TestUtils$",{Y5:1,d:1});var Dha=void 0;function zx(){this.Su=null}zx.prototype=new m;zx.prototype.constructor=zx;function Ax(){}
Ax.prototype=zx.prototype;function Eha(a){ba.scalajsCom.init(function(b){return function(d){Fha(b,d)}}(a))}function Bx(a){var b=!1,d=null;a:{if(a instanceof Cx&&(b=!0,d=a,void 0===d.M)){ba.scalajsCom.send("ok:");break a}if(b)ba.scalajsCom.send("ok:"+d.M);else if(a instanceof Dx)a=a.Gl,a=ba.JSON.stringify(Ex(Fx(),a)),ba.scalajsCom.send("fail:"+a);else throw(new q).i(a);}}zx.prototype.c=function(a){this.Su=Gha(Hha(),a);return this};
function Iha(a){var b=Gx();var d=[];for(var e=0,f=a.j.length;e<f;){var g=a.j[e],k=g.qw;k=ba.JSON.stringify(Jha(ux(),k));g=Jha(ux(),g.qw);var l=Gx(),n=v();var t=Ol(n);t=ma(ab(sa),[t]);var u=0;for(n=zr(n);n.qa();){var w=n.ma();t.j[u]=w;u=1+u|0}k={serializedTask:k,taskDef:g,tags:Hx(l,Ix(Ke(),t))};d.push(null===k?null:k);e=1+e|0}a=la(ab(Kha),d);return Hx(b,Ix(Ke(),a))}
function Fha(a,b){var d=Jx(Na(),b,58),e=-1===d?b:b.substring(0,d);try{a.FI(e,J(function(f,g,k,l){return function(){if(-1===k)throw(new Pe).c(bx((new cx).Ca((new M).q([""," needs args"])),(new M).q([l])));return g.substring(1+k|0)}}(a,b,d,e)))}catch(f){if(a=vm(kg(),f),null!==a){b=Kx(Lx(),a);if(b.x())throw jg(kg(),a);a=b.Q();a=ba.JSON.stringify(Ex(Fx(),a));ba.scalajsCom.send("bad:"+a)}else throw f;}}zx.prototype.init=function(){Eha(this)};function Mx(){}Mx.prototype=new m;Mx.prototype.constructor=Mx;
Mx.prototype.b=function(){return this};Mx.prototype.$classData=h({$5:0},!1,"org.scalajs.testinterface.internal.EventSerializer$",{$5:1,d:1});var Lha=void 0;function Nx(){}Nx.prototype=new m;Nx.prototype.constructor=Nx;Nx.prototype.b=function(){return this};
function Ox(a,b){if(wx(b))return{fpType:"AnnotatedFingerprint",isModule:b.Zq,annotationName:b.zx};if(vx(b))return{fpType:"SubclassFingerprint",isModule:b.rv(),superclassName:b.nw(),requireNoArgConstructor:b.xD()};throw(new Pe).c(bx((new cx).Ca((new M).q(["Unknown Fingerprint type: ",""])),(new M).q([qa(b)])));}Nx.prototype.$classData=h({a6:0},!1,"org.scalajs.testinterface.internal.FingerprintSerializer$",{a6:1,d:1});var Px=void 0;function Qx(){Px||(Px=(new Nx).b());return Px}function Rx(){}
Rx.prototype=new m;Rx.prototype.constructor=Rx;Rx.prototype.b=function(){return this};Rx.prototype.$classData=h({d6:0},!1,"org.scalajs.testinterface.internal.FrameworkDetector$",{d6:1,d:1});var Mha=void 0;function Sx(){}Sx.prototype=new m;Sx.prototype.constructor=Sx;Sx.prototype.b=function(){return this};
function Gha(a,b){a=ox(px(),b);if(a.x()){a=aa.exportsNamespace;b=(new Sb).c(b);b=Hh(b,46);var d=b.j.length,e=0;a:for(;;){if(e!==d){a=a[b.j[e]];e=1+e|0;continue a}break}return new a}return Nha(a.Q())}Sx.prototype.$classData=h({e6:0},!1,"org.scalajs.testinterface.internal.FrameworkLoader$",{e6:1,d:1});var Tx=void 0;function Hha(){Tx||(Tx=(new Sx).b());return Tx}function Ux(){this.wI=null}Ux.prototype=new m;Ux.prototype.constructor=Ux;
function Oha(a){Gha(Hha(),a.wI);a=Gx();var b=Bha();var d=[];for(var e=0,f=b.j.length;e<f;){var g=b.j[e];g=Ox(Qx(),g);d.push(null===g?null:g);e=1+e|0}b=la(ab(Vx),d);a={name:"utest",fingerprints:Hx(a,Ix(Ke(),b))};ba.scalajsCom.send(ba.JSON.stringify(a))}function Pha(a){ba.scalajsCom.init(function(){return function(){}}(a));Oha(a);ba.scalajsCom.close()}Ux.prototype.c=function(a){this.wI=a;return this};Ux.prototype.initAndSend=function(){Pha(this)};
Ux.prototype.$classData=h({f6:0},!1,"org.scalajs.testinterface.internal.InfoSender",{f6:1,d:1});function Wx(){}Wx.prototype=new m;Wx.prototype.constructor=Wx;Wx.prototype.b=function(){return this};
function Qha(a,b){if(b instanceof Xx)return{selType:"SuiteSelector"};if(b instanceof Yx)return{selType:"TestSelector",testName:b.Wj};if(b instanceof Zx)return{selType:"NestedSuiteSelector",suiteId:b.Vj};if(b instanceof $x)return{selType:"NestedTestSelector",suiteId:b.Vj,testName:b.Wj};if(b instanceof ay)return{selType:"TestWildcardSelector",testWildcard:b.Wr};throw(new Pe).c(bx((new cx).Ca((new M).q(["Unknown Selector type: ",""])),(new M).q([qa(b)])));}
function Rha(a,b){a=b.selType;if("SuiteSelector"===a)return(new Xx).b();if("TestSelector"===a)return(new Yx).c(b.testName);if("NestedSuiteSelector"===a)return(new Zx).c(b.suiteId);if("NestedTestSelector"===a)return(new $x).xf(b.suiteId,b.testName);if("TestWildcardSelector"===a)return(new ay).c(b.testWildcard);throw(new Pe).c(bx((new cx).Ca((new M).q(["Unknown Selector type: ",""])),(new M).q([a])));}
Wx.prototype.$classData=h({h6:0},!1,"org.scalajs.testinterface.internal.SelectorSerializer$",{h6:1,d:1});var by=void 0;function cy(){by||(by=(new Wx).b());return by}function dy(){this.Kz=!1;this.ka=null}dy.prototype=new m;dy.prototype.constructor=dy;function ey(){}ey.prototype=dy.prototype;function Sha(a){if(!a.Kz)throw(new je).c(bx((new cx).Ca((new M).q([""," has been invalidated"])),(new M).q([a])));}dy.prototype.ky=function(a){if(null===a)throw jg(kg(),null);this.ka=a;this.Kz=!0;return this};
function fy(){}fy.prototype=new m;fy.prototype.constructor=fy;fy.prototype.b=function(){return this};
function tx(a,b){a=b.selectors;for(var d=[],e=0,f=a.length|0;e<f;){var g=a[e];g=Rha(cy(),g);d.push(g);e=1+e|0}a=d.length|0;a=ma(ab(Tha),[a]);g=a.j.length;f=e=0;var k=d.length|0;g=k<g?k:g;k=a.j.length;for(g=g<k?g:k;e<g;)a.j[f]=d[e],e=1+e|0,f=1+f|0;d=new gy;e=b.fullyQualifiedName;Qx();f=b.fingerprint;g=f.fpType;if("AnnotatedFingerprint"===g)g=f.annotationName,k=new hy,k.Zq=!!f.isModule,k.zx=g,f=k;else if("SubclassFingerprint"===g){g=f.superclassName;k=!!f.requireNoArgConstructor;var l=new iy;l.Zq=!!f.isModule;
l.QL=g;l.XK=k;f=l}else throw(new Pe).c(bx((new cx).Ca((new M).q(["Unknown Fingerprint type: ",""])),(new M).q([g])));b=!!b.explicitlySpecified;d.Nk=e;d.iq=f;d.Ur=b;d.Vr=a;if(null===e)throw(new xe).c("fullyQualifiedName was null");if(null===f)throw(new xe).c("fingerprint was null");if(null===a)throw(new xe).c("selectors was null");return d}
function Jha(a,b){a=b.Nk;var d=Ox(Qx(),b.iq),e=b.Ur,f=Gx();b=b.Vr;var g=[];for(var k=0,l=b.j.length;k<l;){var n=b.j[k];n=Qha(cy(),n);g.push(null===n?null:n);k=1+k|0}b=la(ab(Vx),g);return{fullyQualifiedName:a,fingerprint:d,explicitlySpecified:e,selectors:Hx(f,Ix(Ke(),b))}}fy.prototype.$classData=h({m6:0},!1,"org.scalajs.testinterface.internal.TaskDefSerializer$",{m6:1,d:1});var jy=void 0;function ux(){jy||(jy=(new fy).b());return jy}function ky(){}ky.prototype=new m;ky.prototype.constructor=ky;
ky.prototype.b=function(){return this};function Ex(a,b){var d=qa(b).l(),e=b.Tf(),f=b.l(),g=Gx(),k=ly(b);var l=[];for(var n=0,t=k.j.length;n<t;){var u=k.j[n];u={className:u.fp,methodName:u.mt,fileName:u.Is,lineNumber:u.kt};l.push(null===u?null:u);n=1+n|0}k=la(ab(Vx),l);d={"class":d,message:e,toString:f,stackTrace:Hx(g,Ix(Ke(),k))};null!==b.Sf&&(d.cause=Ex(a,b.Sf));return d}ky.prototype.$classData=h({n6:0},!1,"org.scalajs.testinterface.internal.ThrowableSerializer$",{n6:1,d:1});var my=void 0;
function Fx(){my||(my=(new ky).b());return my}function Uha(a,b){if(a instanceof Hr)return b.gl(a.W);if(a instanceof ny)return oy(py(),qy(pe(a.kp)));throw(new q).i(a);}var Vha=h({Oo:0},!0,"play.api.libs.json.JsValue",{Oo:1,nn:1});function ry(){}ry.prototype=new m;ry.prototype.constructor=ry;ry.prototype.b=function(){return this};function sy(a){var b=Wha();return ty(b,a,!1,0,p(function(){return function(){return""}}(b)),!1,":",(new $b).te("[",",","]"))}
function uy(a,b){if(null===b)return Xha();if(og(b))return(new Tr).c(b);if("number"===typeof b){var d=+b;a=vy();return wy(new xy,yy(d,a.jk))}if(za(b))return d=+b,a=vy(),wy(new xy,yy(d,a.jk));if(Ua(b))return d=b|0,a=vy(),wy(new xy,zy(a,d,a.jk));if(b instanceof Fa)return a=Va(b),d=a.ga,a=a.na,b=vy(),wy(new xy,Yha(b,(new Fa).fa(d,a)));if(Jl(Kl(),!0,b))return Zha();if(Jl(Kl(),!1,b))return $ha();if(b instanceof ba.Array){Ke();d=[];for(var e=0,f=b.length|0;e<f;){var g=uy(a,b[e]);d.push(g);e=1+e|0}a=d.length|
0;a=ma(ab(Vha),[a]);f=a.j.length;e=b=0;g=d.length|0;f=g<f?g:f;g=a.j.length;for(f=f<g?f:g;b<f;)a.j[e]=d[b],b=1+b|0,e=1+e|0;return aia(new Ay,mv(0,a))}if(b instanceof ba.Object)return bia||(bia=(new By).b()),d=(new Cy).Im(b),d=Xb(new Yb,d,p(function(){return function(k){return null!==k}}(a))).xa(p(function(k){return function(l){if(null!==l){var n=l.ha();l=uy(k,l.la());return(new z).e(n,l)}throw(new q).i(l);}}(a)),(new Dy).b()),Ey(Fy(d));km(lm(),bx((new cx).Ca((new M).q(["Unexpected JS value: ",""])),
(new M).q([b])))}
function cia(a){a=(new Sb).c(a);for(var b=Ke().rq.wd(a.U),d=0,e=a.U.length|0;d<e;){var f=a.R(d),g=null===f?0:f.W;if(31<g&&127>g)f=(new I).i(Le(g)).gb();else{f=(new cx).Ca((new M).q(["u",""]));g=(+(g>>>0)).toString(16);g=(new Sb).c(g);g=Gy(g);g=(new Sb).c(g);var k=Le(48),l=Ke().rq;l=l.wd(g.he());var n=g.ra();l.dd(4<n?n:4);n=4-n|0;for(l.bc(g.qe());0<n;)l.Ka(k),n=-1+n|0;g=l.Ea();g=(new Sb).c(g);g=Gy(g);f=bx(f,(new M).q([g.toUpperCase()]));f=(new Sb).c(f);g=Le(92);k=Ke().rq;f=Hy(f,g,k);f=(new Sb).c(f)}b.bc(f.ob());
d=1+d|0}return b.Ea()}
function ty(a,b,d,e,f,g,k,l){if(Xha()===b)return"null";if(b instanceof Tr)return l=b.W,d?cia(ba.JSON.stringify(l)):ba.JSON.stringify(l);if(b instanceof xy)return b.W.Rc.l();if(Zha().m(b))return"true";if($ha().m(b))return"false";if(b instanceof Ay)return b=b.W,d=p(function(w,y,E,L,S,ia,na){return function(pa){return ty(w,pa,y,na,E,L,S,ia)}}(a,d,f,g,k,l,1+e|0)),a=ij().pc,Mr(b,d,a).od(l.Ia,l.Wa,l.Ig);if(b instanceof Ur){b=b.Dt;var n=1+e|0;if(g){var t=bx((new cx).Ca((new M).q(["\\n",""])),(new M).q([f.w(n)])),
u=bx((new cx).Ca((new M).q(["\\n","}"])),(new M).q([f.w(e)]));e=t;t=u}else e=f.w(n),t="}";l=p(function(w,y,E,L,S,ia,na,pa){return function(ua){if(null!==ua){var Ka=ua.ha();ua=ua.la();return bx((new cx).Ca((new M).q(["","","","",""])),(new M).q([pa,y?cia(ba.JSON.stringify(Ka)):ba.JSON.stringify(Ka),S,ty(w,ua,y,na,E,L,S,ia)]))}throw(new q).i(ua);}}(a,d,f,g,k,l,n,e));d=Nc().P;return Mr(b,l,d).od("{",",",t)}throw(new q).i(b);}
ry.prototype.$classData=h({V6:0},!1,"play.api.libs.json.StaticBinding$",{V6:1,d:1});var Iy=void 0;function Wha(){Iy||(Iy=(new ry).b());return Iy}function wx(a){return!!(a&&a.$classData&&a.$classData.Sb.W6)}function Jy(){}Jy.prototype=new m;Jy.prototype.constructor=Jy;function Ky(){}Ky.prototype=Jy.prototype;var Tha=h({ds:0},!1,"sbt.testing.Selector",{ds:1,d:1});Jy.prototype.$classData=Tha;function vx(a){return!!(a&&a.$classData&&a.$classData.Sb.tA)}function Ly(){}Ly.prototype=new m;
Ly.prototype.constructor=Ly;function dia(){}dia.prototype=Ly.prototype;Ly.prototype.b=function(){(new My).nC();(new Ny).nC();return this};function Oy(){}Oy.prototype=new m;Oy.prototype.constructor=Oy;function eia(){}eia.prototype=Oy.prototype;function fia(a,b,d){var e=a.aA;d=pe(d);return e.xc(d,J(function(f,g){return function(){return g}}(a,b)))}function Py(){}Py.prototype=new m;Py.prototype.constructor=Py;function gia(){}gia.prototype=Py.prototype;function Qy(){}Qy.prototype=new m;
Qy.prototype.constructor=Qy;function hia(){}hia.prototype=Qy.prototype;Qy.prototype.b=function(){(new Ry).oC();return this};function Sy(){}Sy.prototype=new m;Sy.prototype.constructor=Sy;function Ty(){}Ty.prototype=Sy.prototype;Sy.prototype.gb=function(){return this.xy(p(function(){return function(a){return a}}(this)),iia()).lt()};function Uy(){this.da=null}Uy.prototype=new m;Uy.prototype.constructor=Uy;function Vy(){}Vy.prototype=Uy.prototype;
function jia(a,b){Wy();b=(new Xy).yc(b);return a.bi(p(function(d,e){return function(){return W(e)}}(a,b)),xb(function(d,e){return function(f,g){return Yy(W(e),J(function(k,l){return function(){return l}}(d,g)))}}(a,b)),Zy(function(d,e){return function(f,g,k,l){return W(e).bi(p(function(n){return function(){return n}}(d)),xb(function(n){return function(t,u){return $y(n,J(function(w,y){return function(){return y}}(n,u)))}}(d)),Zy(function(n,t,u,w,y){return function(E,L,S,ia){E=n.da.Vl().xc(t,J(function(na,
pa){return function(){return pa}}(n,E)));return az(new bz,n.da,J(function(na,pa,ua,Ka,Da){return function(){return kia(na,pe(pa),ua,Ka,Da)}}(n,w,y,L,S)),E,u,ia)}}(d,f,g,k,l)))}}(a,b)))}
function lia(a,b,d,e,f,g,k){Wy();e=(new Xy).yc(e);Wy();f=(new Xy).yc(f);Wy();k=(new Xy).yc(k);if(d instanceof cz){d=d.Ba;if(g instanceof cz)return dz(b,J(function(u,w,y){return function(){return ez(fz(),w,W(y),u.da)}}(a,d,e)),J(function(u,w,y){return function(){return ez(fz(),W(w),y,u.da)}}(a,f,g.Ba)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof gz)return dz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,W(y),W(E),u.da)}}(a,d,e,f)),J(function(u,w,y){return function(){return ez(fz(),
w,y,u.da)}}(a,g.Ba,g.Qa)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof jz)return dz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,W(y),W(E),u.da)}}(a,d,e,f)),J(function(u,w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,g.Ba,g.Qa,g.Ob)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof kz)return lz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,W(y),W(E),u.da)}}(a,d,e,f)),J(function(u,w,y){return function(){return ez(fz(),
w,y,u.da)}}(a,g.Ba,g.Qa)),J(function(u,w,y){return function(){return ez(fz(),w,y,u.da)}}(a,g.Ob,g.Sd)),J(function(u,w){return function(){return W(w)}}(a,k)));throw(new q).i(g);}if(d instanceof gz){var l=d.Ba;d=d.Qa;if(g instanceof cz)return dz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,W(E),u.da)}}(a,l,d,e)),J(function(u,w,y){return function(){return ez(fz(),W(w),y,u.da)}}(a,f,g.Ba)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof gz)return dz(b,J(function(u,
w,y,E){return function(){return hz(fz(),w,y,W(E),u.da)}}(a,l,d,e)),J(function(u,w,y,E){return function(){return hz(fz(),W(w),y,E,u.da)}}(a,f,g.Ba,g.Qa)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof jz)return lz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,W(E),u.da)}}(a,l,d,e)),J(function(u,w,y){return function(){return ez(fz(),W(w),y,u.da)}}(a,f,g.Ba)),J(function(u,w,y){return function(){return ez(fz(),w,y,u.da)}}(a,g.Qa,g.Ob)),J(function(u,w){return function(){return W(w)}}(a,
k)));if(g instanceof kz)return lz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,W(E),u.da)}}(a,l,d,e)),J(function(u,w,y,E){return function(){return hz(fz(),W(w),y,E,u.da)}}(a,f,g.Ba,g.Qa)),J(function(u,w,y){return function(){return ez(fz(),w,y,u.da)}}(a,g.Ob,g.Sd)),J(function(u,w){return function(){return W(w)}}(a,k)));throw(new q).i(g);}if(d instanceof jz){l=d.Ba;var n=d.Qa;d=d.Ob;if(g instanceof cz)return dz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,l,n,
d)),J(function(u,w,y,E){return function(){return hz(fz(),W(w),W(y),E,u.da)}}(a,e,f,g.Ba)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof gz)return lz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,l,n,d)),J(function(u,w,y){return function(){return ez(fz(),W(w),W(y),u.da)}}(a,e,f)),J(function(u,w,y){return function(){return ez(fz(),w,y,u.da)}}(a,g.Ba,g.Qa)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof jz)return lz(b,J(function(u,
w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,l,n,d)),J(function(u,w,y,E){return function(){return hz(fz(),W(w),W(y),E,u.da)}}(a,e,f,g.Ba)),J(function(u,w,y){return function(){return ez(fz(),w,y,u.da)}}(a,g.Qa,g.Ob)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof kz)return lz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,l,n,d)),J(function(u,w,y,E){return function(){return hz(fz(),W(w),W(y),E,u.da)}}(a,e,f,g.Ba)),J(function(u,w,y,E){return function(){return hz(fz(),
w,y,E,u.da)}}(a,g.Qa,g.Ob,g.Sd)),J(function(u,w){return function(){return W(w)}}(a,k)));throw(new q).i(g);}if(d instanceof kz){l=d.Ba;n=d.Qa;var t=d.Ob;d=d.Sd;if(g instanceof cz)return lz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,l,n,t)),J(function(u,w,y){return function(){return ez(fz(),w,W(y),u.da)}}(a,d,e)),J(function(u,w,y){return function(){return ez(fz(),W(w),y,u.da)}}(a,f,g.Ba)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof gz)return lz(b,
J(function(u,w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,l,n,t)),J(function(u,w,y,E){return function(){return hz(fz(),w,W(y),W(E),u.da)}}(a,d,e,f)),J(function(u,w,y){return function(){return ez(fz(),w,y,u.da)}}(a,g.Ba,g.Qa)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof jz)return lz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,l,n,t)),J(function(u,w,y,E){return function(){return hz(fz(),w,W(y),W(E),u.da)}}(a,d,e,f)),J(function(u,w,y,E){return function(){return hz(fz(),
w,y,E,u.da)}}(a,g.Ba,g.Qa,g.Ob)),J(function(u,w){return function(){return W(w)}}(a,k)));if(g instanceof kz)return mz(b,J(function(u,w,y,E){return function(){return hz(fz(),w,y,E,u.da)}}(a,l,n,t)),J(function(u,w,y,E){return function(){return hz(fz(),w,W(y),W(E),u.da)}}(a,d,e,f)),J(function(u,w,y){return function(){return ez(fz(),w,y,u.da)}}(a,g.Ba,g.Qa)),J(function(u,w,y){return function(){return ez(fz(),w,y,u.da)}}(a,g.Ob,g.Sd)),J(function(u,w){return function(){return W(w)}}(a,k)));throw(new q).i(g);
}throw(new q).i(d);}
function lz(a,b,d,e,f){Wy();f=(new Xy).yc(f);Wy();b=(new Xy).yc(b);Wy();d=(new Xy).yc(d);Wy();e=(new Xy).yc(e);return a.bi(p(function(g,k,l,n,t){return function(){var u=W(k),w=W(l),y=W(n);return Yy(Yy(Yy(W(t),J(function(E,L){return function(){return L}}(g,y))),J(function(E,L){return function(){return L}}(g,w))),J(function(E,L){return function(){return L}}(g,u)))}}(a,b,d,e,f)),xb(function(g,k,l,n,t){return function(u,w){u=W(k);var y=W(l),E=W(n);return Yy(Yy(Yy(Yy(W(t),J(function(L,S){return function(){return S}}(g,
E))),J(function(L,S){return function(){return S}}(g,y))),J(function(L,S){return function(){return S}}(g,u))),J(function(L,S){return function(){return S}}(g,w)))}}(a,b,d,e,f)),Zy(function(g,k,l,n,t){return function(u,w,y,E){return W(k).bi(p(function(L,S,ia,na){return function(){return $y($y($y(L,J(function(pa,ua){return function(){return W(ua)}}(L,S))),J(function(pa,ua){return function(){return W(ua)}}(L,ia))),J(function(pa,ua){return function(){return W(ua)}}(L,na)))}}(g,l,n,t)),xb(function(L,S,ia,
na){return function(pa,ua){return $y($y($y($y(L,J(function(Ka,Da){return function(){return W(Da)}}(L,S))),J(function(Ka,Da){return function(){return W(Da)}}(L,ia))),J(function(Ka,Da){return function(){return W(Da)}}(L,na))),J(function(Ka,Da){return function(){return Da}}(L,ua)))}}(g,l,n,t)),Zy(function(L,S,ia,na,pa,ua,Ka,Da){return function(Ha,kb,lb,Tb){var Rb=L.da,ad=L.da.of(L.da.of(L.da.of(S,W(ia)),W(na)),W(pa));Ha=Rb.Vl().xc(ad,J(function(oc,kd){return function(){return kd}}(L,Ha)));return az(new bz,
L.da,J(function(oc,kd,Sc,bd,yc,kc,Bd,Tc){return function(){return mia(oc,pe(kd),Sc,J(function(Af,me){return function(){return W(me)}}(oc,bd)),J(function(Af,me){return function(){return W(me)}}(oc,yc)),J(function(Af,me){return function(){return W(me)}}(oc,kc)),Bd,Tc)}}(L,Ka,Da,ia,na,pa,kb,lb)),Ha,ua,Tb)}}(g,u,l,n,t,w,y,E)))}}(a,f,b,d,e)))}Uy.prototype.yj=function(a){this.da=a;return this};
function dz(a,b,d,e){Wy();e=(new Xy).yc(e);Wy();b=(new Xy).yc(b);Wy();d=(new Xy).yc(d);return a.bi(p(function(f,g,k,l){return function(){var n=W(g),t=W(k);return Yy(Yy(W(l),J(function(u,w){return function(){return w}}(f,t))),J(function(u,w){return function(){return w}}(f,n)))}}(a,b,d,e)),xb(function(f,g,k,l){return function(n,t){n=W(g);var u=W(k);return Yy(Yy(Yy(W(l),J(function(w,y){return function(){return y}}(f,u))),J(function(w,y){return function(){return y}}(f,n))),J(function(w,y){return function(){return y}}(f,
t)))}}(a,b,d,e)),Zy(function(f,g,k,l){return function(n,t,u,w){return W(g).bi(p(function(y,E,L){return function(){return $y($y(y,J(function(S,ia){return function(){return W(ia)}}(y,E))),J(function(S,ia){return function(){return W(ia)}}(y,L)))}}(f,k,l)),xb(function(y,E,L){return function(S,ia){return $y($y($y(y,J(function(na,pa){return function(){return W(pa)}}(y,E))),J(function(na,pa){return function(){return W(pa)}}(y,L))),J(function(na,pa){return function(){return pa}}(y,ia)))}}(f,k,l)),Zy(function(y,
E,L,S,ia,na,pa){return function(ua,Ka,Da,Ha){var kb=y.da,lb=y.da.of(y.da.of(E,W(L)),W(S));ua=kb.Vl().xc(lb,J(function(Tb,Rb){return function(){return Rb}}(y,ua)));return az(new bz,y.da,J(function(Tb,Rb,ad,oc,kd,Sc,bd){return function(){return lia(Tb,pe(Rb),ad,J(function(yc,kc){return function(){return W(kc)}}(Tb,oc)),J(function(yc,kc){return function(){return W(kc)}}(Tb,kd)),Sc,bd)}}(y,na,pa,L,S,Ka,Da)),ua,ia,Ha)}}(f,n,k,l,t,u,w)))}}(a,e,b,d)))}
function mz(a,b,d,e,f,g){Wy();g=(new Xy).yc(g);Wy();b=(new Xy).yc(b);Wy();d=(new Xy).yc(d);Wy();e=(new Xy).yc(e);Wy();f=(new Xy).yc(f);return a.bi(p(function(k,l,n,t,u,w){return function(){var y=W(l),E=W(n),L=W(t),S=W(u);return Yy(Yy(Yy(Yy(W(w),J(function(ia,na){return function(){return na}}(k,S))),J(function(ia,na){return function(){return na}}(k,L))),J(function(ia,na){return function(){return na}}(k,E))),J(function(ia,na){return function(){return na}}(k,y)))}}(a,b,d,e,f,g)),xb(function(k,l,n,t,
u,w){return function(y,E){y=W(l);var L=W(n),S=W(t),ia=W(u);return Yy(Yy(Yy(Yy(Yy(W(w),J(function(na,pa){return function(){return pa}}(k,ia))),J(function(na,pa){return function(){return pa}}(k,S))),J(function(na,pa){return function(){return pa}}(k,L))),J(function(na,pa){return function(){return pa}}(k,y))),J(function(na,pa){return function(){return pa}}(k,E)))}}(a,b,d,e,f,g)),Zy(function(k,l,n,t,u,w){return function(y,E,L,S){return W(l).bi(p(function(ia,na,pa,ua,Ka){return function(){return $y($y($y($y(ia,
J(function(Da,Ha){return function(){return W(Ha)}}(ia,na))),J(function(Da,Ha){return function(){return W(Ha)}}(ia,pa))),J(function(Da,Ha){return function(){return W(Ha)}}(ia,ua))),J(function(Da,Ha){return function(){return W(Ha)}}(ia,Ka)))}}(k,n,t,u,w)),xb(function(ia,na,pa,ua,Ka){return function(Da,Ha){return $y($y($y($y($y(ia,J(function(kb,lb){return function(){return W(lb)}}(ia,na))),J(function(kb,lb){return function(){return W(lb)}}(ia,pa))),J(function(kb,lb){return function(){return W(lb)}}(ia,
ua))),J(function(kb,lb){return function(){return W(lb)}}(ia,Ka))),J(function(kb,lb){return function(){return lb}}(ia,Ha)))}}(k,n,t,u,w)),Zy(function(ia,na,pa,ua,Ka,Da,Ha,kb,lb){return function(Tb,Rb,ad,oc){var kd=ia.da,Sc=ia.da.of(ia.da.of(ia.da.of(ia.da.of(na,W(pa)),W(ua)),W(Ka)),W(Da));Tb=kd.Vl().xc(Sc,J(function(bd,yc){return function(){return yc}}(ia,Tb)));return az(new bz,ia.da,J(function(bd,yc,kc,Bd,Tc,Af,me,Ch,Fe){return function(){return nia(bd,pe(yc),kc,J(function(Zf,Cd){return function(){return W(Cd)}}(bd,
Bd)),J(function(Zf,Cd){return function(){return W(Cd)}}(bd,Tc)),J(function(Zf,Cd){return function(){return W(Cd)}}(bd,Af)),J(function(Zf,Cd){return function(){return W(Cd)}}(bd,me)),Ch,Fe)}}(ia,kb,lb,pa,ua,Ka,Da,Rb,ad)),Tb,Ha,oc)}}(k,y,n,t,u,w,E,L,S)))}}(a,g,b,d,e,f)))}
function mia(a,b,d,e,f,g,k,l){Wy();e=(new Xy).yc(e);Wy();f=(new Xy).yc(f);Wy();g=(new Xy).yc(g);Wy();l=(new Xy).yc(l);if(d instanceof cz){d=d.Ba;if(k instanceof cz)return dz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,W(E),W(L),w.da)}}(a,d,e,f)),J(function(w,y,E){return function(){return ez(fz(),W(y),E,w.da)}}(a,g,k.Ba)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof gz)return dz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,W(E),W(L),w.da)}}(a,d,e,
f)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),E,L,w.da)}}(a,g,k.Ba,k.Qa)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof jz)return lz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,W(E),W(L),w.da)}}(a,d,e,f)),J(function(w,y,E){return function(){return ez(fz(),W(y),E,w.da)}}(a,g,k.Ba)),J(function(w,y,E){return function(){return ez(fz(),y,E,w.da)}}(a,k.Qa,k.Ob)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof kz)return lz(b,J(function(w,
y,E,L){return function(){return hz(fz(),y,W(E),W(L),w.da)}}(a,d,e,f)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),E,L,w.da)}}(a,g,k.Ba,k.Qa)),J(function(w,y,E){return function(){return ez(fz(),y,E,w.da)}}(a,k.Ob,k.Sd)),J(function(w,y){return function(){return W(y)}}(a,l)));throw(new q).i(k);}if(d instanceof gz){var n=d.Ba;d=d.Qa;if(k instanceof cz)return dz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,W(L),w.da)}}(a,n,d,e)),J(function(w,y,E,L){return function(){return hz(fz(),
W(y),W(E),L,w.da)}}(a,f,g,k.Ba)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof gz)return lz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,W(L),w.da)}}(a,n,d,e)),J(function(w,y,E){return function(){return ez(fz(),W(y),W(E),w.da)}}(a,f,g)),J(function(w,y,E){return function(){return ez(fz(),y,E,w.da)}}(a,k.Ba,k.Qa)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof jz)return lz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,W(L),
w.da)}}(a,n,d,e)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),W(E),L,w.da)}}(a,f,g,k.Ba)),J(function(w,y,E){return function(){return ez(fz(),y,E,w.da)}}(a,k.Qa,k.Ob)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof kz)return lz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,W(L),w.da)}}(a,n,d,e)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),W(E),L,w.da)}}(a,f,g,k.Ba)),J(function(w,y,E,L){return function(){return hz(fz(),y,E,L,w.da)}}(a,
k.Qa,k.Ob,k.Sd)),J(function(w,y){return function(){return W(y)}}(a,l)));throw(new q).i(k);}if(d instanceof jz){n=d.Ba;var t=d.Qa;d=d.Ob;if(k instanceof cz)return lz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,L,w.da)}}(a,n,t,d)),J(function(w,y,E){return function(){return ez(fz(),W(y),W(E),w.da)}}(a,e,f)),J(function(w,y,E){return function(){return ez(fz(),W(y),E,w.da)}}(a,g,k.Ba)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof gz)return lz(b,J(function(w,y,E,
L){return function(){return hz(fz(),y,E,L,w.da)}}(a,n,t,d)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),W(E),W(L),w.da)}}(a,e,f,g)),J(function(w,y,E){return function(){return ez(fz(),y,E,w.da)}}(a,k.Ba,k.Qa)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof jz)return lz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,L,w.da)}}(a,n,t,d)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),W(E),W(L),w.da)}}(a,e,f,g)),J(function(w,y,E,L){return function(){return hz(fz(),
y,E,L,w.da)}}(a,k.Ba,k.Qa,k.Ob)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof kz)return mz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,L,w.da)}}(a,n,t,d)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),W(E),W(L),w.da)}}(a,e,f,g)),J(function(w,y,E){return function(){return ez(fz(),y,E,w.da)}}(a,k.Ba,k.Qa)),J(function(w,y,E){return function(){return ez(fz(),y,E,w.da)}}(a,k.Ob,k.Sd)),J(function(w,y){return function(){return W(y)}}(a,l)));throw(new q).i(k);
}if(d instanceof kz){n=d.Ba;t=d.Qa;var u=d.Ob;d=d.Sd;if(k instanceof cz)return lz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,L,w.da)}}(a,n,t,u)),J(function(w,y,E,L){return function(){return hz(fz(),y,W(E),W(L),w.da)}}(a,d,e,f)),J(function(w,y,E){return function(){return ez(fz(),W(y),E,w.da)}}(a,g,k.Ba)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof gz)return lz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,L,w.da)}}(a,n,t,u)),J(function(w,y,E,
L){return function(){return hz(fz(),y,W(E),W(L),w.da)}}(a,d,e,f)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),E,L,w.da)}}(a,g,k.Ba,k.Qa)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof jz)return mz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,L,w.da)}}(a,n,t,u)),J(function(w,y,E,L){return function(){return hz(fz(),y,W(E),W(L),w.da)}}(a,d,e,f)),J(function(w,y,E){return function(){return ez(fz(),W(y),E,w.da)}}(a,g,k.Ba)),J(function(w,y,E){return function(){return ez(fz(),
y,E,w.da)}}(a,k.Qa,k.Ob)),J(function(w,y){return function(){return W(y)}}(a,l)));if(k instanceof kz)return mz(b,J(function(w,y,E,L){return function(){return hz(fz(),y,E,L,w.da)}}(a,n,t,u)),J(function(w,y,E,L){return function(){return hz(fz(),y,W(E),W(L),w.da)}}(a,d,e,f)),J(function(w,y,E,L){return function(){return hz(fz(),W(y),E,L,w.da)}}(a,g,k.Ba,k.Qa)),J(function(w,y,E){return function(){return ez(fz(),y,E,w.da)}}(a,k.Ob,k.Sd)),J(function(w,y){return function(){return W(y)}}(a,l)));throw(new q).i(k);
}throw(new q).i(d);}Uy.prototype.l=function(){nz();var a=(new oz).b();nz();var b=(new oz).b();fz();var d=new pz;d.GE=b;d.sx=a;qz(d);nz();oia||(oia=(new rz).b());a=new sz;a.Mu=b;qz(a);d.Xz=a;return d.ie(this).l()};
function kia(a,b,d,e,f){if(d instanceof cz){d=d.Ba;if(e instanceof cz)return e=e.Ba,tz(b,ez(fz(),d,e,a.da),f);if(e instanceof gz){var g=e.Ba;e=e.Qa;return tz(b,hz(fz(),d,g,e,a.da),f)}if(e instanceof jz)return dz(b,J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,d,e.Ba)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,e.Qa,e.Ob)),f);if(e instanceof kz)return dz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,d,e.Ba,e.Qa)),J(function(n,t,u){return function(){return ez(fz(),
t,u,n.da)}}(a,e.Ob,e.Sd)),f);throw(new q).i(e);}if(d instanceof gz){g=d.Ba;d=d.Qa;if(e instanceof cz)return e=e.Ba,tz(b,hz(fz(),g,d,e,a.da),f);if(e instanceof gz)return dz(b,J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,g,d)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,e.Ba,e.Qa)),f);if(e instanceof jz)return dz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,d,e.Ba)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,
e.Qa,e.Ob)),f);if(e instanceof kz)return dz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,d,e.Ba)),J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,e.Qa,e.Ob,e.Sd)),f);throw(new q).i(e);}if(d instanceof jz){g=d.Ba;var k=d.Qa;d=d.Ob;if(e instanceof cz)return dz(b,J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,g,k)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,d,e.Ba)),f);if(e instanceof gz)return dz(b,J(function(n,
t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,k,d)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,e.Ba,e.Qa)),f);if(e instanceof jz)return dz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,k,d)),J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,e.Ba,e.Qa,e.Ob)),f);if(e instanceof kz)return lz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,k,d)),J(function(n,t,u){return function(){return ez(fz(),t,
u,n.da)}}(a,e.Ba,e.Qa)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,e.Ob,e.Sd)),f);throw(new q).i(e);}if(d instanceof kz){g=d.Ba;k=d.Qa;var l=d.Ob;d=d.Sd;if(e instanceof cz)return dz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,k,l)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,d,e.Ba)),f);if(e instanceof gz)return dz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,k,l)),J(function(n,t,u,w){return function(){return hz(fz(),
t,u,w,n.da)}}(a,d,e.Ba,e.Qa)),f);if(e instanceof jz)return lz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,k,l)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,d,e.Ba)),J(function(n,t,u){return function(){return ez(fz(),t,u,n.da)}}(a,e.Qa,e.Ob)),f);if(e instanceof kz)return lz(b,J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,g,k,l)),J(function(n,t,u,w){return function(){return hz(fz(),t,u,w,n.da)}}(a,d,e.Ba,e.Qa)),J(function(n,t,
u){return function(){return ez(fz(),t,u,n.da)}}(a,e.Ob,e.Sd)),f);throw(new q).i(e);}throw(new q).i(d);}Uy.prototype.ua=function(a){this.bi(p(function(){return function(){}}(this)),xb(function(b,d){return function(e,f){d.w(f)}}(this,a)),Zy(function(b,d){return function(e,f,g,k){f.ua(d);pe(g).ua(p(function(l,n){return function(t){t.ua(n)}}(b,d)));k.ua(d)}}(this,a)))};Uy.prototype.lt=function(){return pia(fz(),this.da).km(this)};
function nia(a,b,d,e,f,g,k,l,n){Wy();e=(new Xy).yc(e);Wy();f=(new Xy).yc(f);Wy();g=(new Xy).yc(g);Wy();k=(new Xy).yc(k);Wy();n=(new Xy).yc(n);if(d instanceof cz){d=d.Ba;if(l instanceof cz)return dz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,W(L),W(S),y.da)}}(a,d,e,f)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),S,y.da)}}(a,g,k,l.Ba)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof gz)return lz(b,J(function(y,E,L,S){return function(){return hz(fz(),
E,W(L),W(S),y.da)}}(a,d,e,f)),J(function(y,E,L){return function(){return ez(fz(),W(E),W(L),y.da)}}(a,g,k)),J(function(y,E,L){return function(){return ez(fz(),E,L,y.da)}}(a,l.Ba,l.Qa)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof jz)return lz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,W(L),W(S),y.da)}}(a,d,e,f)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),S,y.da)}}(a,g,k,l.Ba)),J(function(y,E,L){return function(){return ez(fz(),E,L,y.da)}}(a,
l.Qa,l.Ob)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof kz)return lz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,W(L),W(S),y.da)}}(a,d,e,f)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),S,y.da)}}(a,g,k,l.Ba)),J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,l.Qa,l.Ob,l.Sd)),J(function(y,E){return function(){return W(E)}}(a,n)));throw(new q).i(l);}if(d instanceof gz){var t=d.Ba;d=d.Qa;if(l instanceof cz)return lz(b,J(function(y,
E,L,S){return function(){return hz(fz(),E,L,W(S),y.da)}}(a,t,d,e)),J(function(y,E,L){return function(){return ez(fz(),W(E),W(L),y.da)}}(a,f,g)),J(function(y,E,L){return function(){return ez(fz(),W(E),L,y.da)}}(a,k,l.Ba)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof gz)return lz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,W(S),y.da)}}(a,t,d,e)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),W(S),y.da)}}(a,f,g,k)),J(function(y,E,L){return function(){return ez(fz(),
E,L,y.da)}}(a,l.Ba,l.Qa)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof jz)return lz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,W(S),y.da)}}(a,t,d,e)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),W(S),y.da)}}(a,f,g,k)),J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,l.Ba,l.Qa,l.Ob)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof kz)return mz(b,J(function(y,E,L,S){return function(){return hz(fz(),
E,L,W(S),y.da)}}(a,t,d,e)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),W(S),y.da)}}(a,f,g,k)),J(function(y,E,L){return function(){return ez(fz(),E,L,y.da)}}(a,l.Ba,l.Qa)),J(function(y,E,L){return function(){return ez(fz(),E,L,y.da)}}(a,l.Ob,l.Sd)),J(function(y,E){return function(){return W(E)}}(a,n)));throw(new q).i(l);}if(d instanceof jz){t=d.Ba;var u=d.Qa;d=d.Ob;if(l instanceof cz)return lz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,t,u,d)),J(function(y,
E,L,S){return function(){return hz(fz(),W(E),W(L),W(S),y.da)}}(a,e,f,g)),J(function(y,E,L){return function(){return ez(fz(),W(E),L,y.da)}}(a,k,l.Ba)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof gz)return lz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,t,u,d)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),W(S),y.da)}}(a,e,f,g)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),L,S,y.da)}}(a,k,l.Ba,l.Qa)),J(function(y,E){return function(){return W(E)}}(a,
n)));if(l instanceof jz)return mz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,t,u,d)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),W(S),y.da)}}(a,e,f,g)),J(function(y,E,L){return function(){return ez(fz(),W(E),L,y.da)}}(a,k,l.Ba)),J(function(y,E,L){return function(){return ez(fz(),E,L,y.da)}}(a,l.Qa,l.Ob)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof kz)return mz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,
t,u,d)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),W(S),y.da)}}(a,e,f,g)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),L,S,y.da)}}(a,k,l.Ba,l.Qa)),J(function(y,E,L){return function(){return ez(fz(),E,L,y.da)}}(a,l.Ob,l.Sd)),J(function(y,E){return function(){return W(E)}}(a,n)));throw(new q).i(l);}if(d instanceof kz){t=d.Ba;u=d.Qa;var w=d.Ob;d=d.Sd;if(l instanceof cz)return lz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,t,u,w)),J(function(y,
E,L,S){return function(){return hz(fz(),E,W(L),W(S),y.da)}}(a,d,e,f)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),S,y.da)}}(a,g,k,l.Ba)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof gz)return mz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,t,u,w)),J(function(y,E,L,S){return function(){return hz(fz(),E,W(L),W(S),y.da)}}(a,d,e,f)),J(function(y,E,L){return function(){return ez(fz(),W(E),W(L),y.da)}}(a,g,k)),J(function(y,E,L){return function(){return ez(fz(),
E,L,y.da)}}(a,l.Ba,l.Qa)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof jz)return mz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,t,u,w)),J(function(y,E,L,S){return function(){return hz(fz(),E,W(L),W(S),y.da)}}(a,d,e,f)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),S,y.da)}}(a,g,k,l.Ba)),J(function(y,E,L){return function(){return ez(fz(),E,L,y.da)}}(a,l.Qa,l.Ob)),J(function(y,E){return function(){return W(E)}}(a,n)));if(l instanceof
kz)return mz(b,J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,t,u,w)),J(function(y,E,L,S){return function(){return hz(fz(),E,W(L),W(S),y.da)}}(a,d,e,f)),J(function(y,E,L,S){return function(){return hz(fz(),W(E),W(L),S,y.da)}}(a,g,k,l.Ba)),J(function(y,E,L,S){return function(){return hz(fz(),E,L,S,y.da)}}(a,l.Qa,l.Ob,l.Sd)),J(function(y,E){return function(){return W(E)}}(a,n)));throw(new q).i(l);}throw(new q).i(d);}
function $y(a,b){var d=uz(fz(),a.da);Wy();b=(new Xy).yc(b);return a.bi(p(function(e,f){return function(g){g=e.da.of(g,W(f));return vz(new wz,e.da,g,J(function(k,l){return function(){return W(l)}}(e,f)))}}(a,b)),xb(function(e,f,g){return function(k,l){k=e.da.of(k,W(f));l=xz(fz(),l,e.da);var n=J(function(u,w){return function(){return(new Nd).yj(w)}}(e,g)),t=xz(fz(),W(f),e.da);return az(new bz,e.da,n,k,l,t)}}(a,b,d)),Zy(function(e,f){return function(g,k,l,n){l=pe(l);if(n instanceof kz){var t=n.Ba,u=
n.Qa,w=n.Ob;n=n.Sd;g=e.da.of(g,W(f));l=J(function(y,E,L,S,ia){return function(){return $y(E,J(function(na,pa,ua,Ka){return function(){return hz(fz(),pa,ua,Ka,na.da)}}(y,L,S,ia)))}}(e,l,t,u,w));n=yz(fz(),n,W(f),e.da);return az(new bz,e.da,l,g,k,n)}g=e.da.of(g,W(f));l=J(function(y,E){return function(){return E}}(e,l));n=n.Kw(W(f));return az(new bz,e.da,l,g,k,n)}}(a,b)))}
function qia(a,b,d,e,f,g){Wy();e=(new Xy).yc(e);Wy();g=(new Xy).yc(g);if(d instanceof cz){d=d.Ba;if(f instanceof cz)return f=f.Ba,tz(b,hz(fz(),d,W(e),f,a.da),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof gz)return dz(b,J(function(t,u,w){return function(){return ez(fz(),u,W(w),t.da)}}(a,d,e)),J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,f.Ba,f.Qa)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof jz)return dz(b,J(function(t,u,w,y){return function(){return hz(fz(),
u,W(w),y,t.da)}}(a,d,e,f.Ba)),J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,f.Qa,f.Ob)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof kz)return dz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,W(w),y,t.da)}}(a,d,e,f.Ba)),J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,f.Qa,f.Ob,f.Sd)),J(function(t,u){return function(){return W(u)}}(a,g)));throw(new q).i(f);}if(d instanceof gz){var k=d.Ba;d=d.Qa;if(f instanceof cz)return dz(b,
J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,k,d)),J(function(t,u,w){return function(){return ez(fz(),W(u),w,t.da)}}(a,e,f.Ba)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof gz)return dz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,W(y),t.da)}}(a,k,d,e)),J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,f.Ba,f.Qa)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof jz)return dz(b,J(function(t,u,w,y){return function(){return hz(fz(),
u,w,W(y),t.da)}}(a,k,d,e)),J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,f.Ba,f.Qa,f.Ob)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof kz)return lz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,W(y),t.da)}}(a,k,d,e)),J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,f.Ba,f.Qa)),J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,f.Ob,f.Sd)),J(function(t,u){return function(){return W(u)}}(a,g)));throw(new q).i(f);
}if(d instanceof jz){k=d.Ba;var l=d.Qa;d=d.Ob;if(f instanceof cz)return dz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,k,l,d)),J(function(t,u,w){return function(){return ez(fz(),W(u),w,t.da)}}(a,e,f.Ba)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof gz)return dz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,k,l,d)),J(function(t,u,w,y){return function(){return hz(fz(),W(u),w,y,t.da)}}(a,e,f.Ba,f.Qa)),J(function(t,u){return function(){return W(u)}}(a,
g)));if(f instanceof jz)return lz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,k,l,d)),J(function(t,u,w){return function(){return ez(fz(),W(u),w,t.da)}}(a,e,f.Ba)),J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,f.Qa,f.Ob)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof kz)return lz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,k,l,d)),J(function(t,u,w,y){return function(){return hz(fz(),W(u),w,y,t.da)}}(a,
e,f.Ba,f.Qa)),J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,f.Ob,f.Sd)),J(function(t,u){return function(){return W(u)}}(a,g)));throw(new q).i(f);}if(d instanceof kz){k=d.Ba;l=d.Qa;var n=d.Ob;d=d.Sd;if(f instanceof cz)return dz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,k,l,n)),J(function(t,u,w,y){return function(){return hz(fz(),u,W(w),y,t.da)}}(a,d,e,f.Ba)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof gz)return lz(b,J(function(t,
u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,k,l,n)),J(function(t,u,w){return function(){return ez(fz(),u,W(w),t.da)}}(a,d,e)),J(function(t,u,w){return function(){return ez(fz(),u,w,t.da)}}(a,f.Ba,f.Qa)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof jz)return lz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,k,l,n)),J(function(t,u,w,y){return function(){return hz(fz(),u,W(w),y,t.da)}}(a,d,e,f.Ba)),J(function(t,u,w){return function(){return ez(fz(),
u,w,t.da)}}(a,f.Qa,f.Ob)),J(function(t,u){return function(){return W(u)}}(a,g)));if(f instanceof kz)return lz(b,J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,k,l,n)),J(function(t,u,w,y){return function(){return hz(fz(),u,W(w),y,t.da)}}(a,d,e,f.Ba)),J(function(t,u,w,y){return function(){return hz(fz(),u,w,y,t.da)}}(a,f.Qa,f.Ob,f.Sd)),J(function(t,u){return function(){return W(u)}}(a,g)));throw(new q).i(f);}throw(new q).i(d);}
function tz(a,b,d){Wy();d=(new Xy).yc(d);return a.bi(p(function(e,f,g){return function(){return Yy(W(g),J(function(k,l){return function(){return l}}(e,f)))}}(a,b,d)),xb(function(e,f,g){return function(k,l){return Yy(Yy(W(g),J(function(n,t){return function(){return t}}(e,f))),J(function(n,t){return function(){return t}}(e,l)))}}(a,b,d)),Zy(function(e,f,g){return function(k,l,n,t){return W(f).bi(p(function(u,w){return function(){return $y(u,J(function(y,E){return function(){return E}}(u,w)))}}(e,g)),
xb(function(u,w){return function(y,E){return $y($y(u,J(function(L,S){return function(){return S}}(u,w))),J(function(L,S){return function(){return S}}(u,E)))}}(e,g)),Zy(function(u,w,y,E,L,S){return function(ia,na,pa,ua){var Ka=u.da,Da=u.da.of(w,y);ia=Ka.Vl().xc(Da,J(function(Ha,kb){return function(){return kb}}(u,ia)));return az(new bz,u.da,J(function(Ha,kb,lb,Tb,Rb,ad){return function(){return qia(Ha,pe(kb),lb,J(function(oc,kd){return function(){return kd}}(Ha,Tb)),Rb,ad)}}(u,L,S,y,na,pa)),ia,E,ua)}}(e,
k,g,l,n,t)))}}(a,d,b)))}
function Yy(a,b){var d=uz(fz(),a.da);Wy();b=(new Xy).yc(b);return a.bi(p(function(e,f){return function(g){g=e.da.ap(W(f),g);return vz(new wz,e.da,g,J(function(k,l){return function(){return W(l)}}(e,f)))}}(a,b)),xb(function(e,f,g){return function(k,l){k=e.da.ap(W(f),k);var n=xz(fz(),W(f),e.da),t=J(function(u,w){return function(){return(new Nd).yj(w)}}(e,g));l=xz(fz(),l,e.da);return az(new bz,e.da,t,k,n,l)}}(a,b,d)),Zy(function(e,f){return function(g,k,l,n){l=pe(l);if(k instanceof kz){var t=k.Ba,u=
k.Qa,w=k.Ob;k=k.Sd;g=e.da.ap(W(f),g);t=yz(fz(),W(f),t,e.da);return az(new bz,e.da,J(function(y,E,L,S,ia){return function(){var na=hz(fz(),E,L,S,y.da);return Yy(ia,J(function(pa,ua){return function(){return ua}}(y,na)))}}(e,u,w,k,l)),g,t,n)}u=e.da.ap(W(f),g);w=W(f);k=k.Mw(w);return az(new bz,e.da,J(function(y,E){return function(){return E}}(e,l)),u,k,n)}}(a,b)))}function zz(){}zz.prototype=new m;zz.prototype.constructor=zz;function ria(){}ria.prototype=zz.prototype;
function uz(a,b){return Az(new Bz,b.Vl(),p(function(d){return function(e){return e.PB(Hv(function(){return function(f){return f}}(d)),Zy(function(){return function(f){return f}}(d)))}}(a)))}function pia(a,b){return Az(new Bz,b.Vl(),p(function(d){return function(e){return e.bi(p(function(){return function(f){return f}}(d)),xb(function(){return function(f){return f}}(d)),Zy(function(){return function(f){return f}}(d)))}}(a)))}
function Cz(a,b){return a.Ui(b,(A(),(new lc).b()),xb(function(){return function(d,e){return d.Ka(e)}}(a))).Ea()}function sia(a,b,d,e){e=p(function(g,k){return function(l){Dz();var n=tia;Ez||(Ez=(new Fz).b());n=n(Ez,k);l=wb(n).w(l);return(new Gz).Jn(l)}}(a,e));uia||(uia=(new Hz).b());Dz();var f=(new Iz).oC();return a.pk(b,e,via(f)).pr.w(d)}function Jz(){}Jz.prototype=new m;Jz.prototype.constructor=Jz;function Kz(){}Kz.prototype=Jz.prototype;
function wia(a,b){for(;;){var d=a;if(d instanceof Lz)return(new Mz).i(d.ea);if(d instanceof Nz)return(new Oz).i(b.zd(d.ea,p(function(){return function(f){return(new Lz).i(f)}}(a))));if(d instanceof Pz){var e=d.gs;if(e instanceof Lz)a=d.op.w(e.ea);else{if(e instanceof Nz)return(new Oz).i(b.zd(e.ea,d.op));if(e instanceof Pz)a=Qz(new Pz,e.gs,p(function(f,g,k){return function(l){l=g.op.w(l);return Qz(new Pz,l,k.op)}}(a,e,d)));else throw(new q).i(e);}}else throw(new q).i(d);}}
function xia(a,b){return Qz(new Pz,a,p(function(d,e){return function(f){return(new Lz).i(e.w(f))}}(a,b)))}function Rz(){}Rz.prototype=new m;Rz.prototype.constructor=Rz;function yia(){}yia.prototype=Rz.prototype;function Sz(a,b){return p(function(d,e){return function(f){return d.zd(f,e)}}(a,b))}function Tz(){}Tz.prototype=new m;Tz.prototype.constructor=Tz;function zia(){}zia.prototype=Tz.prototype;function Uz(){}Uz.prototype=new m;Uz.prototype.constructor=Uz;function Aia(){}Aia.prototype=Uz.prototype;
function Vz(){}Vz.prototype=new m;Vz.prototype.constructor=Vz;function Wz(){}Wz.prototype=Vz.prototype;function Bia(a,b){return(new Xz).Jn(p(function(d,e){return function(f){return e.w(p(function(g,k){return function(l){return Yz(g,l,k)}}(d,f)))}}(a,b)))}function Yz(a,b,d){return d.Bj(d.zd(a.RB().w(d),p(function(e,f){return function(g){return g.w(f)}}(a,b))))}
function Cia(a,b,d){return Bia(a,p(function(e,f,g){return function(k){return p(function(l,n,t,u){return function(w){return n.zd(t.w(w),p(function(y,E){return function(L){return(new z).e(L.ha(),E.w(L.la()))}}(l,u)))}}(e,f,k,g))}}(a,d,b)))}function Dia(a,b){var d=Zz();return(new Xz).Jn(p(function(e,f,g){return function(){return p(function(k,l,n){return function(t){return l.fe(J(function(u,w,y){return function(){return Yz(u,w,y)}}(k,t,n)))}}(e,f,g))}}(a,d,b)))}
function Eia(a,b,d){return Bia(a,p(function(e,f,g){return function(k){return p(function(l,n,t,u){return function(w){return n.Eh(t.w(w),p(function(y,E,L){return function(S){var ia=E.w(S.la()).RB().w(L);return L.Eh(ia,p(function(na,pa){return function(ua){return ua.w(pa.ha())}}(y,S)))}}(l,u,n)))}}(e,f,k,g))}}(a,d,b)))}function $z(){}$z.prototype=new m;$z.prototype.constructor=$z;function Fia(){}Fia.prototype=$z.prototype;function aA(a){(new bA).pC(a);(new cA).pC(a)}
function dA(a){(new eA).qC(a);(new fA).qC(a)}function gA(){}gA.prototype=new m;gA.prototype.constructor=gA;function Gia(){}Gia.prototype=gA.prototype;function hA(){}hA.prototype=new m;hA.prototype.constructor=hA;function Hia(){}Hia.prototype=hA.prototype;function iA(){}iA.prototype=new m;iA.prototype.constructor=iA;function Iia(){}Iia.prototype=iA.prototype;iA.prototype.b=function(){var a=new jA;kA(a);lA(a);return this};function mA(){}mA.prototype=new m;mA.prototype.constructor=mA;
function Jia(){}Jia.prototype=mA.prototype;function nA(){}nA.prototype=new m;nA.prototype.constructor=nA;function Kia(){}Kia.prototype=nA.prototype;function oA(){}oA.prototype=new m;oA.prototype.constructor=oA;oA.prototype.b=function(){pA=this;(new qA).b();return this};oA.prototype.$classData=h({Y8:0},!1,"scalaz.Need$",{Y8:1,d:1});var pA=void 0;function Wy(){pA||(pA=(new oA).b())}function rA(){}rA.prototype=new m;rA.prototype.constructor=rA;function sA(){}sA.prototype=rA.prototype;
rA.prototype.yj=function(){return this};rA.prototype.ua=function(a){this.PB(Hv(function(b,d){return function(e,f,g){d.w(pe(f));d.w(pe(g))}}(this,a)),Zy(function(b,d){return function(e,f,g,k){d.w(pe(f));d.w(pe(g));d.w(pe(k))}}(this,a)))};function Vo(){this.Xc=this.Tc=null}Vo.prototype=new m;Vo.prototype.constructor=Vo;c=Vo.prototype;c.m=function(a){if(a instanceof Vo){var b=sr(this);a=sr(a);return null===b?null===a:b.m(a)}return!1};function sr(a){return(new To).Xb(a.Tc,a.Xc)}
c.l=function(){return"NonEmpty"+(new To).Xb(this.Tc,this.Xc)};
function Lia(a,b,d){var e=a.Xc;if(e instanceof Uo)return d.zd(b.w(a.Tc),p(function(){return function(f){Qo();var g=So().de;return(new Vo).Xb(f,g)}}(a)));if(e instanceof To)return tA(d,J(function(f,g){return function(){return g.w(f.Tc)}}(a,b)),J(function(f,g,k,l,n){return function(){uA||(uA=(new vA).b());var t=So().EC,u=new wA;u.Fn=t;xA(u);yA(u);zA(u);AA(u);BA(u);CA(u);t=(new DA).e(g,k);return Mia(u,t,l,n)}}(a,e.yd,e.Ed,b,d)),xb(function(){return function(f,g){Qo();return(new Vo).Xb(f,(new To).Xb(g.Tc,
g.Xc))}}(a)));throw(new q).i(e);}function Ap(a,b){var d=sr(a);if(d instanceof Uo)a=b;else if(d instanceof To)a=d.yd,d=d.Ed,Qo(),b=sr(b),b=Nia(d,b),a=(new Vo).Xb(a,b);else throw(new q).i(d);return a}function mp(a){EA||(EA=(new FA).b());var b=EA;Qo();var d=b.w(a.Tc);a=Ro(a.Xc);b=Oia(a,So().de,b);return(new Vo).Xb(d,b)}c.Xb=function(a,b){this.Tc=a;this.Xc=b;return this};c.p=function(){return sr(this).p()};c.$classData=h({b9:0},!1,"scalaz.NonEmptyList",{b9:1,d:1});function GA(){}GA.prototype=new m;
GA.prototype.constructor=GA;function Pia(){}Pia.prototype=GA.prototype;function HA(){}HA.prototype=new m;HA.prototype.constructor=HA;function Qia(){}Qia.prototype=HA.prototype;function IA(){}IA.prototype=new m;IA.prototype.constructor=IA;function JA(){}JA.prototype=IA.prototype;function KA(){}KA.prototype=new m;KA.prototype.constructor=KA;function Ria(){}Ria.prototype=KA.prototype;
KA.prototype.b=function(){var a=LA();null===LA().nu&&null===LA().nu&&(LA().nu=(new MA).ne(a));a=LA().nu;if(null===a.wB&&null===a.wB){var b=new NA;OA(b);PA(b);a.wB=b}LA();LA();LA();LA();LA();LA();QA||(QA=(new RA).b());return this};function iia(){SA||(SA=(new TA).b());var a=SA;var b=p(function(){return function(e){var f=v();return K(e,f)}}(a));a=p(function(e){return function(f){return p(function(g,k){return function(l){return K(k,l)}}(e,f))}}(a));xp();var d=(new yp).ev();return Sia(d,b,a)}
function UA(){}UA.prototype=new m;UA.prototype.constructor=UA;UA.prototype.b=function(){VA=this;(new WA).b();return this};UA.prototype.$classData=h({z9:0},!1,"scalaz.Show$",{z9:1,d:1});var VA=void 0;function nz(){VA||(VA=(new UA).b())}function Tia(a,b){a=p(function(d,e){return function(f){f=e.w(f);return(new z).e(f,void 0)}}(a,b));b=XA().Ag;return YA(b,a)}function ZA(){}ZA.prototype=new m;ZA.prototype.constructor=ZA;
ZA.prototype.b=function(){$A=this;(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();(new aB).b();return this};ZA.prototype.$classData=h({L9:0},!1,"scalaz.Tags$",{L9:1,d:1});var $A=void 0;function bB(){$A||($A=(new ZA).b())}function cB(){this.ka=this.nF=null}cB.prototype=new m;cB.prototype.constructor=cB;cB.prototype.$classData=h({P9:0},!1,"scalaz.Traverse$Traversal",{P9:1,d:1});
function dB(){}dB.prototype=new m;dB.prototype.constructor=dB;function Uia(){}Uia.prototype=dB.prototype;function eB(){}eB.prototype=new m;eB.prototype.constructor=eB;function Via(){}Via.prototype=eB.prototype;eB.prototype.b=function(){var a=new fB;gB(a);hB(a);iB(a);return this};function jB(){this.Ag=null}jB.prototype=new m;jB.prototype.constructor=jB;
jB.prototype.b=function(){kB=this;lB||(lB=(new mB).b());this.Ag=lB.iy;(new nB).b();Wia||(Wia=(new oB).b());Xia||(Xia=(new pB).b());Yia||(Yia=(new qB).b());Zia||(Zia=(new rB).b());$ia||($ia=(new sB).b());aja||(aja=(new tB).b());bja();cja||(cja=(new uB).b());dja||(dja=(new vB).b());eja||(eja=(new wB).b());return this};jB.prototype.$classData=h({a$:0},!1,"scalaz.package$",{a$:1,d:1});var kB=void 0;function XA(){kB||(kB=(new jB).b());return kB}function nB(){}nB.prototype=new m;
nB.prototype.constructor=nB;nB.prototype.b=function(){return this};nB.prototype.$classData=h({g$:0},!1,"scalaz.package$TagModule",{g$:1,d:1});function xB(){}xB.prototype=new m;xB.prototype.constructor=xB;xB.prototype.b=function(){return this};function fja(a){Qo();var b=[],d=So().de,e=b.length|0;a:for(;;){if(0!==e){d=(new To).Xb(b[-1+e|0],d);e=-1+e|0;continue a}break}return(new Vo).Xb(a,d)}xB.prototype.$classData=h({Kaa:0},!1,"scalaz.syntax.NelOps$",{Kaa:1,d:1});var gja=void 0;function Fz(){}
Fz.prototype=new m;Fz.prototype.constructor=Fz;Fz.prototype.b=function(){return this};function tia(a,b){return xb(function(d,e){return function(f,g){return e.Cf(g,f)}}(a,b))}Fz.prototype.$classData=h({bba:0},!1,"scalaz.syntax.std.Function2Ops$",{bba:1,d:1});var Ez=void 0;function jw(){this.tL=null}jw.prototype=new m;jw.prototype.constructor=jw;jw.prototype.Ma=function(a){this.tL=a;return this};jw.prototype.$classData=h({cba:0},!1,"scalaz.syntax.std.OptionOps",{cba:1,d:1});
function yB(){this.sw=null}yB.prototype=new m;yB.prototype.constructor=yB;function hja(a,b){Gc();for(var d=(new M).b(),e=a.sw,f=b.gb();;)if(sd(f)){if(!(f instanceof Ih))throw(new q).i(f);var g=f.Ib;f=f.Da;g=e.wn.ZB(p(function(t,u){return function(w){return w.W.Ze()===u}}(a,g)));for(var k=[g],l=0,n=k.length|0;l<n;)d.wa.push(k[l]),l=1+l|0;if(!e.wn.Fp(g))throw(new zB).Ca(b);e=e.wn.R(g)}else break;return(new z).e(d,e)}function AB(a){var b=new yB;b.sw=a;return b}
function ija(a,b,d,e,f,g,k,l,n,t){var u=b.zg();if(D()===u)return BB(CB(),J(function(L,S){return function(){return S}}(a,d)),n);if(u instanceof I){var w=u.M;u=AB(w);var y=r();y=g.wc(e,y.P);w=w.W.Ze();var E=r();return jja(u,f,y,k.wc(w,E.P),l,t,n).Kl(p(function(L,S,ia,na,pa,ua,Ka,Da,Ha,kb){return function(lb){var Tb=Da.X(),Rb=A().P;return ija(L,Tb,Uh(Ha,lb,Rb),1+kb|0,S,ia,na,pa,ua,Ka)}}(a,f,g,k,l,n,t,b,d,e)),n)}throw(new q).i(u);}
function kja(a,b,d,e,f,g){e=hja(a,e);if(null===e)throw(new q).i(e);a=e.ha();e=AB(e.la());var k=DB(CB(),D());return jja(e,b,a,d,f,k,g)}
function jja(a,b,d,e,f,g,k){return BB(CB(),J(function(l,n,t,u,w,y,E){return function(){var L=lja(),S=w.w(J(function(na,pa,ua,Ka){return function(){return ua.Kl(p(function(Da,Ha,kb){return function(lb){if(D()===lb)return BB(CB(),J(function(Tb,Rb){return function(){try{return DB(CB(),Tb.sw.W.vra().Lra(Rb.gb()))}catch(oc){var ad=vm(kg(),oc);if(null!==ad)return CB(),EB||(EB=(new FB).b()),ad=(new Dx).Vd(ad),mja(nja(),ad);throw oc;}}}(Da,Ha)),kb).Kl(p(function(){return function(Tb){return Tb}}(Da)),kb);
if(lb instanceof I)throw lb.M;throw(new q).i(lb);}}(na,pa,Ka)),Ka).Kl(p(function(){return function(Da){return Da&&Da.$classData&&Da.$classData.Sb.AD?Da:DB(CB(),Da)}}(na)),Ka)}}(l,t,y,E))),ia=S.gi(p(function(){return function(){return D()}}(l)),E).tt(oja(l,u),E);ia=ija(l,l.sw.wn,v(),0,n,t,u,w,E,ia);return S.gi(p(function(){return function(na){return(new Cx).i(na)}}(l)),E).tt(new GB,E).Kl(p(function(na,pa,ua,Ka,Da,Ha){return function(kb){return Ha.gi(p(function(lb,Tb,Rb,ad,oc){return function(kd){a:{if(oc instanceof
Dx){var Sc=oc.Gl;if(Sc instanceof HB&&"Boxed Error"===Sc.Vc){var bd=(new Dx).Vd(Sc.Sf);break a}}bd=oc}var yc=lja();Sc=lb.sw.W.Ze();yc=yc.eq;var kc=yc.Ao.xo(yc.dl);yc=kc.ga;var Bd=kc.na;kc=ad.eq;kc=kc.Ao.xo(kc.dl);var Tc=kc.na;kc=yc-kc.ga|0;Bd=(-2147483648^kc)>(-2147483648^yc)?-1+(Bd-Tc|0)|0:Bd-Tc|0;yc=new IB;kc=(new Fa).fa(kc,Bd);yc.pa=Sc;yc.W=bd;yc.Dv=kc;Tb.Cf(Rb,yc);Sc=new JB;Sc.W=yc;Sc.wn=kd;return Sc}}(na,pa,ua,Da,kb)),Ka)}}(l,n,u,E,L,ia)),E)}}(a,b,d,e,f,g,k)),k).Kl(p(function(){return function(l){return l}}(a)),
k)}yB.prototype.$classData=h({hba:0},!1,"utest.framework.TestTreeSeq",{hba:1,d:1});function KB(){}KB.prototype=new m;KB.prototype.constructor=KB;KB.prototype.b=function(){LB=this;var a=(new MB).wb(100),b=NB().Zt;pja(OB(),a.yt,b);a=(new MB).wb(1);b=NB().au;pja(OB(),a.yt,b);return this};KB.prototype.$classData=h({lba:0},!1,"utest.package$",{lba:1,d:1});var LB=void 0;function $a(){this.ik=null}$a.prototype=new m;$a.prototype.constructor=$a;$a.prototype.yg=function(){return this.ik.name};
function PB(a){return a.ik.getComponentType()}function QB(a){return!!a.ik.isPrimitive}$a.prototype.l=function(){return(this.ik.isInterface?"interface ":QB(this)?"":"class ")+this.yg()};function Sj(a,b){return QB(a)||QB(b)?a===b||(a===ra(gb)?b===ra(fb):a===ra(hb)?b===ra(fb)||b===ra(gb):a===ra(jb)?b===ra(fb)||b===ra(gb)||b===ra(hb):a===ra(mb)&&(b===ra(fb)||b===ra(gb)||b===ra(hb)||b===ra(jb))):Rj(a,b.ik.getFakeInstance())}function Rj(a,b){return!!a.ik.isInstance(b)}
function vp(a){a=a.ik.name;for(var b=-1+(a.length|0)|0;;)if(0<=b&&36===(65535&(a.charCodeAt(b)|0)))b=-1+b|0;else break;for(;;){if(0<=b){var d=65535&(a.charCodeAt(b)|0);d=46!==d&&36!==d}else d=!1;if(d)b=-1+b|0;else break}return a.substring(1+b|0)}$a.prototype.$classData=h({Uba:0},!1,"java.lang.Class",{Uba:1,d:1});function RB(){}RB.prototype=new m;RB.prototype.constructor=RB;function qja(){}qja.prototype=RB.prototype;function SB(){this.oH=0;this.QK=TB();this.xK=TB()}SB.prototype=new m;
SB.prototype.constructor=SB;SB.prototype.$classData=h({eca:0},!1,"java.lang.Long$StringRadixInfo",{eca:1,d:1});function UB(){this.AI=this.kp=this.wK=null}UB.prototype=new m;UB.prototype.constructor=UB;
UB.prototype.b=function(){VB=this;this.wK=(new WB).md(!1);this.kp=(new WB).md(!0);this.AI=ba.performance?ba.performance.now?function(){XB();return+ba.performance.now()}:ba.performance.webkitNow?function(){XB();return+ba.performance.webkitNow()}:function(){XB();return+(new ba.Date).getTime()}:function(){XB();return+(new ba.Date).getTime()};return this};UB.prototype.$classData=h({qca:0},!1,"java.lang.System$",{qca:1,d:1});var VB=void 0;function XB(){VB||(VB=(new UB).b());return VB}
function YB(){this.DG=null}YB.prototype=new m;YB.prototype.constructor=YB;YB.prototype.b=function(){ZB=this;var a=new $B;a.pa="main";this.DG=a;return this};YB.prototype.$classData=h({sca:0},!1,"java.lang.Thread$",{sca:1,d:1});var ZB=void 0;function aC(){this.fy=!1;this.Mc=null}aC.prototype=new m;aC.prototype.constructor=aC;aC.prototype.b=function(){this.fy=!1;return this};aC.prototype.Q=function(){this.fy||bC(this,null);return this.Mc};function bC(a,b){a.Mc=b;a.fy=!0}
aC.prototype.$classData=h({tca:0},!1,"java.lang.ThreadLocal",{tca:1,d:1});function cC(){}cC.prototype=new m;cC.prototype.constructor=cC;cC.prototype.b=function(){return this};function dC(a,b,d){return b.ik.newArrayOfThisClass([d])}cC.prototype.$classData=h({vca:0},!1,"java.lang.reflect.Array$",{vca:1,d:1});var eC=void 0;function fC(){eC||(eC=(new cC).b());return eC}function gC(){}gC.prototype=new m;gC.prototype.constructor=gC;
function hC(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),b.j[e],d.j[e]))return!1;e=1+e|0}return!0}gC.prototype.b=function(){return this};function rja(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),b.j[e],d.j[e]))return!1;e=1+e|0}return!0}
function sja(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),b.j[e],d.j[e]))return!1;e=1+e|0}return!0}function tja(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),b.j[e],d.j[e]))return!1;e=1+e|0}return!0}
function uja(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),b.j[e],d.j[e]))return!1;e=1+e|0}return!0}function iC(a,b,d){a=0;var e=b.j.length;for(;;){if(a===e)return-1-a|0;var f=(a+e|0)>>>1|0,g=b.j[f];if(d<g)e=f;else{if(Jl(Kl(),d,g))return f;a=1+f|0}}}
function vja(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),b.j[e],d.j[e]))return!1;e=1+e|0}return!0}function wja(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),b.j[e],d.j[e]))return!1;e=1+e|0}return!0}
function xja(a,b,d,e){d=d-b|0;if(2<=d){if(0<e.Se(a.j[b],a.j[1+b|0])){var f=a.j[b];a.j[b]=a.j[1+b|0];a.j[1+b|0]=f}for(f=2;f<d;){var g=a.j[b+f|0];if(0>e.Se(g,a.j[-1+(b+f|0)|0])){for(var k=b,l=-1+(b+f|0)|0;1<(l-k|0);){var n=(k+l|0)>>>1|0;0>e.Se(g,a.j[n])?l=n:k=n}k=k+(0>e.Se(g,a.j[k])?0:1)|0;for(l=b+f|0;l>k;)a.j[l]=a.j[-1+l|0],l=-1+l|0;a.j[k]=g}f=1+f|0}}}function yja(a,b){a=b.j.length;for(var d=0;d!==a;)b.j[d]=0,d=1+d|0}
function zja(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),Le(b.j[e]),Le(d.j[e])))return!1;e=1+e|0}return!0}function Aja(a,b,d){if(b===d)return!0;if(null===b||null===d)return!1;a=b.j.length;if(d.j.length!==a)return!1;for(var e=0;e!==a;){if(!Jl(Kl(),b.j[e],d.j[e]))return!1;e=1+e|0}return!0}function Bja(a,b,d){var e=new jC;e.sH=d;d=b.j.length;16<d?kC(a,b,ma(ab(Za),[b.j.length]),0,d,e):xja(b,0,d,e)}
function kC(a,b,d,e,f,g){var k=f-e|0;if(16<k){var l=e+(k/2|0)|0;kC(a,b,d,e,l,g);kC(a,b,d,l,f,g);for(var n=a=e,t=l;a<f;)n<l&&(t>=f||0>=g.Se(b.j[n],b.j[t]))?(d.j[a]=b.j[n],n=1+n|0):(d.j[a]=b.j[t],t=1+t|0),a=1+a|0;Ta(d,e,b,e,k)}else xja(b,e,f,g)}gC.prototype.$classData=h({xca:0},!1,"java.util.Arrays$",{xca:1,d:1});var lC=void 0;function mC(){lC||(lC=(new gC).b());return lC}function nC(){this.oJ=null}nC.prototype=new m;nC.prototype.constructor=nC;
nC.prototype.b=function(){oC=this;this.oJ=new ba.RegExp("(?:(\\d+)\\$)?([-#+ 0,\\(\x3c]*)(\\d+)?(?:\\.(\\d+))?[%A-Za-z]","g");return this};nC.prototype.$classData=h({Dca:0},!1,"java.util.Formatter$",{Dca:1,d:1});var oC=void 0;function pC(){this.ZJ=this.rI=this.Gf=null;this.Uu=0;this.yx=null}pC.prototype=new m;pC.prototype.constructor=pC;pC.prototype.$classData=h({fda:0},!1,"java.util.regex.GroupStartMapper",{fda:1,d:1});function qC(){}qC.prototype=new m;qC.prototype.constructor=qC;
qC.prototype.b=function(){return this};qC.prototype.$classData=h({gda:0},!1,"java.util.regex.GroupStartMapper$",{gda:1,d:1});var Cja=void 0;function rC(){this.fl=0}rC.prototype=new m;rC.prototype.constructor=rC;function sC(){}sC.prototype=rC.prototype;function tC(a,b,d,e){var f=b[a.fl];f=void 0===f?-1:e+(f.length|0)|0;a.Vp(b,d,e,f);return f}rC.prototype.Fi=function(a){this.fl=a;return 1+a|0};function uC(){this.Gf=null;this.Dc=0;this.Ps=null}uC.prototype=new m;uC.prototype.constructor=uC;
function Dja(a){switch(a.length|0){case 0:return(new vC).c("");case 1:return a[0];default:return(new wC).q(a)}}uC.prototype.c=function(a){this.Gf=""+a+Le(41);this.Dc=0;this.Ps=[null];return this};
function xC(a){for(var b=[],d=[];;){switch(65535&(a.Gf.charCodeAt(a.Dc)|0)){case 124:b.push(Dja(d));d=[];a.Dc=1+a.Dc|0;var e=null;break;case 41:a.Dc=1+a.Dc|0;a=Dja(d);if(0===(b.length|0))return a;b.push(a);return(new yC).q(b);case 40:e=a.Gf.substring(1+a.Dc|0,3+a.Dc|0);if("?\x3d"===e||"?!"===e){a.Dc=3+a.Dc|0;var f=xC(a),g=new zC;g.RI=e;g.zj=f;e=g}else"?:"===e?(a.Dc=3+a.Dc|0,e=xC(a)):(a.Dc=1+a.Dc|0,e=a.Ps.length|0,a.Ps.push(null),f=xC(a),g=new AC,g.dK=e,g.zj=f,f=g,e=a.Ps[e]=f);break;case 92:e=65535&
(a.Gf.charCodeAt(1+a.Dc|0)|0);if(48<=e&&57>=e){e=a.Dc;for(a.Dc=2+a.Dc|0;;)if(f=65535&(a.Gf.charCodeAt(a.Dc)|0),48<=f&&57>=f)a.Dc=1+a.Dc|0;else break;f=Jh();e=a.Gf.substring(1+e|0,a.Dc);e=(new BC).wb(Lh(f,e,10))}else e=a.Gf.substring(a.Dc,2+a.Dc|0),a.Dc=2+a.Dc|0,e=(new vC).c(e);break;case 91:e=a.Dc;f=a;a:{g=a;var k=1+e|0;b:for(;;)switch(65535&(g.Gf.charCodeAt(k)|0)){case 92:k=2+k|0;continue b;case 93:g=1+k|0;break a;default:k=1+k|0}}f.Dc=g;e=a.Gf.substring(e,a.Dc);e=(new vC).c(e);break;default:e=a.Gf.substring(a.Dc,
1+a.Dc|0),a.Dc=1+a.Dc|0,e=(new vC).c(e)}if(null!==e)switch(65535&(a.Gf.charCodeAt(a.Dc)|0)){case 43:case 42:case 63:f=a.Dc;63===(65535&(a.Gf.charCodeAt(1+f|0)|0))?a.Dc=2+a.Dc|0:a.Dc=1+a.Dc|0;f=a.Gf.substring(f,a.Dc);d.push(Eja(e,f))|0;break;case 123:f=a.Dc;a.Dc=1+(a.Gf.indexOf("}",1+f|0)|0)|0;63===(65535&(a.Gf.charCodeAt(a.Dc)|0))&&(a.Dc=1+a.Dc|0);f=a.Gf.substring(f,a.Dc);d.push(Eja(e,f))|0;break;default:f=d.length|0,0!==f&&e instanceof vC&&d[-1+f|0]instanceof vC?(e=(new vC).c(""+d[-1+f|0].ut+e.ut),
d[-1+f|0]=e):d.push(e)|0}}}uC.prototype.$classData=h({lda:0},!1,"java.util.regex.GroupStartMapper$Parser",{lda:1,d:1});function CC(){}CC.prototype=new m;CC.prototype.constructor=CC;CC.prototype.b=function(){return this};function DC(a,b,d){null!==b?a=-1+(b.length|0)|0:(0===(1&d.va)<<24>>24&&0===(1&d.va)<<24>>24&&(d.Uu=-1+((new ba.RegExp("|"+d.Rn.source)).exec("").length|0)|0,d.va=(1|d.va)<<24>>24),a=d.Uu);return a}CC.prototype.$classData=h({qda:0},!1,"java.util.regex.Matcher$",{qda:1,d:1});
var EC=void 0;function FC(){EC||(EC=(new CC).b());return EC}function GC(){}GC.prototype=new m;GC.prototype.constructor=GC;function Fja(){}Fja.prototype=GC.prototype;function HC(){}HC.prototype=new m;HC.prototype.constructor=HC;function Gja(){}Gja.prototype=HC.prototype;function IC(){}IC.prototype=new m;IC.prototype.constructor=IC;function Hja(){}Hja.prototype=IC.prototype;function mv(a,b){return null===b?null:0===b.j.length?JC().gF:(new KC).Vi(b)}
function bca(a){return null!==a?(new LC).In(a):null}function On(){this.ka=this.Zl=null}On.prototype=new m;On.prototype.constructor=On;function Uda(a,b,d){a.Zl=d;if(null===b)throw jg(kg(),null);a.ka=b;return a}On.prototype.$classData=h({Bda:0},!1,"scala.Option$WithFilter",{Bda:1,d:1});function MC(a,b){return p(function(d,e){return function(f){f=d.db(f,ud().qr);return!NC(ud(),f)&&(e.w(f),!0)}}(a,b))}function OC(a,b,d){return a.Sa(b)?a.w(b):d.w(b)}function PC(){this.zB=this.lL=this.qr=null}
PC.prototype=new m;PC.prototype.constructor=PC;PC.prototype.b=function(){QC=this;this.qr=(new RC).b();this.lL=p(function(){return function(){return!1}}(this));this.zB=(new SC).b();return this};function NC(a,b){return a.qr===b}PC.prototype.$classData=h({Cda:0},!1,"scala.PartialFunction$",{Cda:1,d:1});var QC=void 0;function ud(){QC||(QC=(new PC).b());return QC}function TC(){}TC.prototype=new m;TC.prototype.constructor=TC;TC.prototype.b=function(){return this};
TC.prototype.$classData=h({Mda:0},!1,"scala.Predef$DummyImplicit",{Mda:1,d:1});function UC(){}UC.prototype=new m;UC.prototype.constructor=UC;UC.prototype.b=function(){return this};function Ija(a,b,d){return""+b+d}UC.prototype.$classData=h({Nda:0},!1,"scala.Predef$any2stringadd$",{Nda:1,d:1});var VC=void 0;function Jja(){VC||(VC=(new UC).b());return VC}function WC(){this.wu=null}WC.prototype=new m;WC.prototype.constructor=WC;WC.prototype.b=function(){XC=this;this.wu=(new aC).b();return this};
WC.prototype.$classData=h({Yda:0},!1,"scala.concurrent.BlockContext$",{Yda:1,d:1});var XC=void 0;function Kja(){XC||(XC=(new WC).b());return XC}function YC(){this.CI=null;this.va=!1}YC.prototype=new m;YC.prototype.constructor=YC;YC.prototype.b=function(){return this};function ZC(){$C||($C=(new YC).b());var a=$C;a.va||a.va||(aD||(aD=(new bD).b()),a.CI=aD.PK,a.va=!0);return a.CI}YC.prototype.$classData=h({$da:0},!1,"scala.concurrent.ExecutionContext$Implicits$",{$da:1,d:1});var $C=void 0;
function Lja(a,b,d){return Mja(a,p(function(e,f){return function(g){if(g instanceof Cx)return f.w(g.M);if(g instanceof Dx)return e;throw(new q).i(g);}}(a,b)),d)}function Nja(a,b,d){return Oja(a,p(function(e,f){return function(g){return g.NJ(f)}}(a,b)),d)}function Pja(a,b,d,e){return a.Kl(p(function(f,g,k,l){return function(n){return g.gi(p(function(t,u,w){return function(y){return u.Cf(w,y)}}(f,k,n)),l)}}(a,b,d,e)),he())}
function Qja(a,b,d){return a.gi(p(function(e,f){return function(g){if(f.w(g))return g;throw(new dw).c("Future.filter predicate is not satisfied");}}(a,b)),d)}function Rja(a,b,d){return Oja(a,p(function(e,f){return function(g){return g.RK(f)}}(a,b)),d)}function cD(){this.hM=null}cD.prototype=new m;cD.prototype.constructor=cD;
cD.prototype.b=function(){dD=this;for(var a=[(new z).e(ra(cb),ra(Ca)),(new z).e(ra(fb),ra(va)),(new z).e(ra(eb),ra(Sja)),(new z).e(ra(gb),ra(xa)),(new z).e(ra(hb),ra(ya)),(new z).e(ra(ib),ra(Ga)),(new z).e(ra(jb),ra(Aa)),(new z).e(ra(mb),ra(Ba)),(new z).e(ra(bb),ra(Ea))],b=(new dc).vb(ec()),d=0,e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.hM=DB(0,void 0);return this};
function eD(a,b,d,e){return b.Ub(DB(0,d.wd(b)),xb(function(f,g){return function(k,l){return k.zE(l,xb(function(){return function(n,t){return n.Ka(t)}}(f)),g)}}(a,e))).gi(p(function(){return function(f){return f.Ea()}}(a)),he())}function DB(a,b){EB||(EB=(new FB).b());a=(new Cx).i(b);return mja(nja(),a)}function BB(a,b,d){return a.hM.gi(p(function(e,f){return function(){return pe(f)}}(a,b)),d)}cD.prototype.$classData=h({aea:0},!1,"scala.concurrent.Future$",{aea:1,d:1});var dD=void 0;
function CB(){dD||(dD=(new cD).b());return dD}function FB(){}FB.prototype=new m;FB.prototype.constructor=FB;FB.prototype.b=function(){return this};FB.prototype.$classData=h({dea:0},!1,"scala.concurrent.Promise$",{dea:1,d:1});var EB=void 0;function fD(){}fD.prototype=new m;fD.prototype.constructor=fD;fD.prototype.b=function(){return this};function pja(a,b,d){gD();a=b>>31;hD(new iD,(new Fa).fa(b,a),d)}fD.prototype.$classData=h({mea:0},!1,"scala.concurrent.duration.package$DurationInt$",{mea:1,d:1});
var jD=void 0;function OB(){jD||(jD=(new fD).b());return jD}function kD(){}kD.prototype=new m;kD.prototype.constructor=kD;kD.prototype.b=function(){return this};function Tja(a,b){b instanceof Dx?(a=b.Gl,a=a instanceof lD?(new Cx).i(a.sE):mD(a)?(new Dx).Vd((new HB).Ys("Boxed ControlThrowable",a)):a instanceof nD?(new Dx).Vd((new HB).Ys("Boxed Error",a)):(new Dx).Vd(a)):a=b;return a}kD.prototype.$classData=h({oea:0},!1,"scala.concurrent.impl.Promise$",{oea:1,d:1});var oD=void 0;
function Uja(){oD||(oD=(new kD).b());return oD}function pD(){}pD.prototype=new m;pD.prototype.constructor=pD;pD.prototype.b=function(){return this};function mja(a,b){a=Tja(Uja(),b);if(a instanceof Cx)return b=new qD,b.ye=a,b;if(a instanceof Dx)return b=new rD,b.ye=a,b;throw(new q).i(a);}pD.prototype.$classData=h({qea:0},!1,"scala.concurrent.impl.Promise$KeptPromise$",{qea:1,d:1});var sD=void 0;function nja(){sD||(sD=(new pD).b());return sD}function tD(){}tD.prototype=new m;
tD.prototype.constructor=tD;function Vja(){}Vja.prototype=tD.prototype;function uD(){}uD.prototype=new m;uD.prototype.constructor=uD;uD.prototype.b=function(){return this};function jca(a,b){return Wja(Xja(b),J(function(d,e){return function(){return jca(ica(),e)}}(a,b)))}uD.prototype.$classData=h({uea:0},!1,"scala.io.Source$",{uea:1,d:1});var vD=void 0;function ica(){vD||(vD=(new uD).b());return vD}function wD(){this.SL=this.Bq=this.Mx=this.Ec=this.fB=0;this.ka=null}wD.prototype=new m;
wD.prototype.constructor=wD;function Yja(){}Yja.prototype=wD.prototype;wD.prototype.Ey=function(){var a=this.ka.Uf.ma();this.fB=null===a?0:a.W;a=this.Mx;var b=this.Bq;this.Ec=1048575<=a?2147481600:a<<11|(2047<b?2047:b);switch(this.fB){case 10:this.Bq=1;this.Mx=1+this.Mx|0;break;case 9:this.Bq=this.Bq+this.SL|0;break;default:this.Bq=1+this.Bq|0}return this.fB};wD.prototype.Iba=function(a){if(null===a)throw jg(kg(),null);this.ka=a;this.Ec=0;this.Bq=this.Mx=1;this.SL=4};
function xD(){this.ka=this.yv=null}xD.prototype=new m;xD.prototype.constructor=xD;function Zja(){}Zja.prototype=xD.prototype;xD.prototype.Jba=function(a,b){this.yv=b;if(null===a)throw jg(kg(),null);this.ka=a};function yD(){}yD.prototype=new m;yD.prototype.constructor=yD;yD.prototype.b=function(){return this};yD.prototype.$classData=h({Nea:0},!1,"scala.math.Ordered$",{Nea:1,d:1});var $ja=void 0;function zD(){this.ka=this.yv=null}zD.prototype=new m;zD.prototype.constructor=zD;
function AD(a,b){return 0>a.ka.Se(a.yv,b)}function BD(a,b){var d=new zD;d.yv=b;if(null===a)throw jg(kg(),null);d.ka=a;return d}zD.prototype.$classData=h({Yea:0},!1,"scala.math.Ordering$Ops",{Yea:1,d:1});function CD(){this.pi=this.FG=this.It=this.JE=null;this.va=0}CD.prototype=new m;CD.prototype.constructor=CD;
CD.prototype.b=function(){DD=this;(new ED).b();FD||(FD=(new GD).b());Nc();r();ij();HD();A();v();aka||(aka=(new ID).b());JD||(JD=(new KD).b());this.It=JD;bka||(bka=(new LD).b());this.FG=mg();cka||(cka=(new MD).b());this.pi=hj();dka||(dka=(new ND).b());qm();eka||(eka=(new OD).b());fka||(fka=(new PD).b());gka||(gka=(new QD).b());hka||(hka=(new RD).b());$ja||($ja=(new yD).b());ika||(ika=(new SD).b());jka||(jka=(new TD).b());kka||(kka=(new UD).b());lka||(lka=(new VD).b());return this};
CD.prototype.$classData=h({dfa:0},!1,"scala.package$",{dfa:1,d:1});var DD=void 0;function sc(){DD||(DD=(new CD).b());return DD}function WD(){}WD.prototype=new m;WD.prototype.constructor=WD;WD.prototype.b=function(){XD=this;YD();ZD();$D();aE();bE();Wh();cE();dE();eE();mka||(mka=(new fE).b());gE();nka||(nka=(new hE).b());oka();pka();return this};WD.prototype.$classData=h({ffa:0},!1,"scala.reflect.ClassManifestFactory$",{ffa:1,d:1});var XD=void 0;function iE(){}iE.prototype=new m;
iE.prototype.constructor=iE;iE.prototype.b=function(){return this};iE.prototype.$classData=h({ifa:0},!1,"scala.reflect.ManifestFactory$",{ifa:1,d:1});var qka=void 0;function jE(){}jE.prototype=new m;jE.prototype.constructor=jE;jE.prototype.b=function(){kE=this;XD||(XD=(new WD).b());qka||(qka=(new iE).b());return this};jE.prototype.$classData=h({yfa:0},!1,"scala.reflect.package$",{yfa:1,d:1});var kE=void 0;function lE(){kE||(kE=(new jE).b())}function mE(){}mE.prototype=new m;
mE.prototype.constructor=mE;mE.prototype.b=function(){return this};function km(a,b){throw jg(kg(),(new sg).c(b));}mE.prototype.$classData=h({zfa:0},!1,"scala.sys.package$",{zfa:1,d:1});var nE=void 0;function lm(){nE||(nE=(new mE).b());return nE}function oE(){this.Mc=null}oE.prototype=new m;oE.prototype.constructor=oE;oE.prototype.l=function(){return"DynamicVariable("+this.Mc+")"};oE.prototype.i=function(a){this.Mc=a;return this};
oE.prototype.$classData=h({Afa:0},!1,"scala.util.DynamicVariable",{Afa:1,d:1});function pE(){}pE.prototype=new m;pE.prototype.constructor=pE;pE.prototype.b=function(){(new qE).b();return this};pE.prototype.$classData=h({Mfa:0},!1,"scala.util.control.Breaks",{Mfa:1,d:1});function mD(a){return!!(a&&a.$classData&&a.$classData.Sb.iL)}function rE(){this.cK=null}rE.prototype=new m;rE.prototype.constructor=rE;
rE.prototype.b=function(){sE=this;this.cK=rka(p(function(){return function(){return!1}}(this)),p(function(){return function(b){throw jg(kg(),b);}}(this)));var a=tE(new uE,this.cK,D(),ska());Raa(a,"\x3cnothing\x3e");return this};function tka(a,b,d){return d.Xe(p(function(e,f){return function(g){return Sj(g,qa(f))}}(a,b)))}
function uka(){var a=wE(),b=(new M).q([ra(vka)]),d=tE(new uE,(new xE).Ca(b),D(),ska());a=p(function(){return function(f){return f.yg()}}(a));var e=r();b=b.xa(a,e.P).Jb(", ");return Raa(d,b)}function rka(a,b){var d=(new Dm).Cg(ra(ap)),e=new yE;e.Mu=d;e.iJ=a;e.wj=b;return e}rE.prototype.$classData=h({Nfa:0},!1,"scala.util.control.Exception$",{Nfa:1,d:1});var sE=void 0;function wE(){sE||(sE=(new rE).b());return sE}function zE(){}zE.prototype=new m;zE.prototype.constructor=zE;zE.prototype.b=function(){return this};
function ska(){AE||(AE=(new zE).b());return p(function(){return function(a){wE();return mD(a)||!1}}(AE))}zE.prototype.$classData=h({Rfa:0},!1,"scala.util.control.Exception$Catch$",{Rfa:1,d:1});var AE=void 0;function BE(){}BE.prototype=new m;BE.prototype.constructor=BE;BE.prototype.b=function(){return this};function Kx(a,b){return mD(b)?D():(new I).i(b)}BE.prototype.$classData=h({Vfa:0},!1,"scala.util.control.NonFatal$",{Vfa:1,d:1});var CE=void 0;function Lx(){CE||(CE=(new BE).b());return CE}
function DE(){}DE.prototype=new m;DE.prototype.constructor=DE;function wka(){}wka.prototype=DE.prototype;DE.prototype.Tl=function(a,b){b=da(-862048943,b);b=da(461845907,b<<15|b>>>17|0);return a^b};function EE(a,b,d){if(null===b)throw(new xe).b();if(b.Aa)a=b.Oa;else{var e=new FE;if(null===a)throw jg(kg(),null);e.ka=a;e.ao=0;e.ey=d;a=ye(b,e)}return a}DE.prototype.ba=function(a,b){a=this.Tl(a,b);return-430675100+da(5,a<<13|a>>>19|0)|0};
function V(a,b){var d=b.t();if(0===d)return a=b.s(),Ma(Na(),a);for(var e=-889275714,f=0;f<d;)e=a.ba(e,GE(X(),b.u(f))),f=1+f|0;return a.qb(e,d)}function HE(a,b,d){if(b.x()){var e=a.ba(d,0);e=a.ba(e,0);e=a.Tl(e,1);return a.qb(e,0)}e=(new we).b();b.ua(IE(e));b=a.ba(d,IE(e).sm);b=a.ba(b,IE(e).Qi);b=a.Tl(b,IE(e).Kx);return a.qb(b,IE(e).ao)}DE.prototype.qb=function(a,b){a^=b;a=da(-2048144789,a^(a>>>16|0));a=da(-1028477387,a^(a>>>13|0));return a^(a>>>16|0)};
function JE(a,b,d){b=a.ba(-889275714,GE(X(),b));b=a.ba(b,GE(X(),d));return a.qb(b,2)}function IE(a){if(a.Aa)a=a.Oa;else{if(null===a)throw(new xe).b();if(a.Aa)a=a.Oa;else{var b=new KE;b.sm=0;b.Qi=0;b.ao=0;b.Kx=1;a=ye(a,b)}}return a}function LE(){}LE.prototype=new m;LE.prototype.constructor=LE;LE.prototype.b=function(){return this};function xka(a,b){a=da(-1640532531,b);Jh();return da(-1640532531,a<<24|16711680&a<<8|65280&(a>>>8|0)|a>>>24|0)}
LE.prototype.$classData=h({Zfa:0},!1,"scala.util.hashing.package$",{Zfa:1,d:1});var ME=void 0;function yka(){ME||(ME=(new LE).b());return ME}function NE(){}NE.prototype=new m;NE.prototype.constructor=NE;function aea(a,b){return b instanceof se?(new I).i((new z).e(b.el,b.we)):b instanceof re?(new I).i((new z).e(b.el,b.we)):D()}NE.prototype.Dp=function(){return this};NE.prototype.$classData=h({mga:0},!1,"scala.util.parsing.combinator.Parsers$NoSuccess$",{mga:1,d:1});function OE(){this.ka=null}
OE.prototype=new m;OE.prototype.constructor=OE;function PE(){}PE.prototype=OE.prototype;OE.prototype.Dp=function(a){if(null===a)throw jg(kg(),null);this.ka=a;return this};function QE(){}QE.prototype=new m;QE.prototype.constructor=QE;function zka(){}zka.prototype=QE.prototype;function LD(){}LD.prototype=new m;LD.prototype.constructor=LD;LD.prototype.b=function(){return this};LD.prototype.$classData=h({oga:0},!1,"scala.collection.$colon$plus$",{oga:1,d:1});var bka=void 0;function KD(){}
KD.prototype=new m;KD.prototype.constructor=KD;KD.prototype.b=function(){return this};function zl(a,b){if(b.x())return D();a=b.Y();b=b.X();return(new I).i((new z).e(a,b))}KD.prototype.$classData=h({pga:0},!1,"scala.collection.$plus$colon$",{pga:1,d:1});var JD=void 0;function RE(){this.ae=null}RE.prototype=new m;RE.prototype.constructor=RE;RE.prototype.b=function(){SE=this;this.ae=(new TE).b();return this};RE.prototype.$classData=h({wga:0},!1,"scala.collection.Iterator$",{wga:1,d:1});var SE=void 0;
function HD(){SE||(SE=(new RE).b());return SE}function Aka(a,b){if(null===a)throw(new xe).b();if(a.Aa)a=a.Oa;else{var d=new UE;d.yK=b;d.ye=0;a=ye(a,d)}return a}function VE(a,b,d){a.Te(b,d,WE(XE(),b)-d|0)}function Bka(a,b){if(null===a)throw(new xe).b();if(a.Aa)a=a.Oa;else{var d=new YE;d.kK=b;d.Jq=!0;d.bu=0;a=ye(a,d)}return a}function ZE(a,b){b=b.wg();b.bc(a.ob());return b.Ea()}function $E(a,b){var d=(new we).b();a.ua(d.Aa?d.Oa:Aka(d,b));return(d.Aa?d.Oa:Aka(d,b)).ye}
function bc(a,b,d,e){return a.gg((new Jk).b(),b,d,e).kc.ec}function Sh(a,b,d){var e=(new we).b();a.ua(e.Aa?e.Oa:Cka(e,b,d));return(e.Aa?e.Oa:Cka(e,b,d)).ye}function es(a){var b=(new we).b();a.ua(b.Aa?b.Oa:Dka(b));return(b.Aa?b.Oa:Dka(b)).ye}
function lg(a,b){var d=(new fe).b();try{if(a&&a.$classData&&a.$classData.Sb.bd)var e=a;else{if(!(a&&a.$classData&&a.$classData.Sb.Ab))return a.ua(b.Xm(p(function(k,l){return function(n){throw(new lD).e(l,(new I).i(n));}}(a,d)))),D();e=a.$g()}for(var f=(new aF).DC();e.qa();){var g=b.db(e.ma(),f);if(g!==f)return(new I).i(g)}return D()}catch(k){if(k instanceof lD){a=k;if(a.BJ===d)return a.sE;throw a;}throw k;}}
function Eka(a,b,d){if(null===a)throw(new xe).b();if(a.Aa)a=a.Oa;else{var e=new bF;e.Dx=b;e.JL=d;e.Jq=!0;a=ye(a,e)}return a}function cF(a,b,d,e,f){var g=(new we).b();dF(b,d);a.ua(g.Aa?g.Oa:Eka(g,b,e));dF(b,f);return b}function Dka(a){if(null===a)throw(new xe).b();return a.Aa?a.Oa:ye(a,(new eF).DC())}function fF(a,b){return a.Ub(b.gh(0),xb(function(d,e){return function(f,g){return e.Ej(f,g)}}(a,b)))}function gF(a,b){return a.Sg()?(b=b.kh(a.za()),a.Og(b,0),b):a.je().Ne(b)}
function Cka(a,b,d){if(null===a)throw(new xe).b();if(a.Aa)a=a.Oa;else{var e=new hF;e.Hv=d;e.ye=b;a=ye(a,e)}return a}function sd(a){return!a.x()}function iF(a,b){var d=(new we).b();if(a.x())throw(new Tj).c("empty.reduceLeft");a.ua(d.Aa?d.Oa:Bka(d,b));return(d.Aa?d.Oa:Bka(d,b)).bu}function Fka(a,b){return(new jF).yc(J(function(d,e){return function(){if(null===e)var f=null;else f=new kF,lF||(lF=(new mF).b()),f=nF(f,lF,e);return f}}(a,b)))}function jF(){this.jK=null}jF.prototype=new m;
jF.prototype.constructor=jF;jF.prototype.yc=function(a){this.jK=a;return this};jF.prototype.$classData=h({Uga:0},!1,"scala.collection.convert.Decorators$AsScala",{Uga:1,d:1});function oF(){}oF.prototype=new m;oF.prototype.constructor=oF;function Gka(){}Gka.prototype=oF.prototype;function Jg(a,b){return a.Va().bc(b).Ea()}oF.prototype.Va=function(){return(new dc).vb(this.Ds())};function pF(){}pF.prototype=new m;pF.prototype.constructor=pF;function Hka(){}Hka.prototype=pF.prototype;function qF(){}
qF.prototype=new m;qF.prototype.constructor=qF;function rF(){}rF.prototype=qF.prototype;function H(a,b){if(b.x())return a.Wk();a=a.Va();a.bc(b);return a.Ea()}qF.prototype.Wk=function(){return this.Va().Ea()};function Ika(a,b){var d=a.hd().Va();a.ob().ua(p(function(e,f,g){return function(k){return f.bc(g.w(k).ob())}}(a,d,b)));return d.Ea()}function Jka(a,b){a:for(;;){if(sd(b)){a.vd(b.Y());b=b.X();continue a}break}}
function sF(a,b){b&&b.$classData&&b.$classData.Sb.Zp?Jka(a,b):b.ua(p(function(d){return function(e){return d.vd(e)}}(a)));return a}function tF(){}tF.prototype=new m;tF.prototype.constructor=tF;function uF(){}uF.prototype=tF.prototype;tF.prototype.Wp=function(){return!1};function MD(){}MD.prototype=new m;MD.prototype.constructor=MD;MD.prototype.b=function(){return this};MD.prototype.$classData=h({hia:0},!1,"scala.collection.immutable.Stream$$hash$colon$colon$",{hia:1,d:1});var cka=void 0;
function vF(){this.hE=null}vF.prototype=new m;vF.prototype.constructor=vF;vF.prototype.yc=function(a){this.hE=a;return this};function Kka(a,b){return wF(b,a.hE)}function Lka(a,b){return xF(b,a.hE)}vF.prototype.$classData=h({jia:0},!1,"scala.collection.immutable.Stream$ConsWrapper",{jia:1,d:1});function yF(){this.XD=this.Mc=null;this.va=!1;this.ka=null}yF.prototype=new m;yF.prototype.constructor=yF;function zF(a,b,d){a.XD=d;if(null===b)throw jg(kg(),null);a.ka=b;return a}
function AF(a){a.va||(a.va||(a.Mc=pe(a.XD),a.va=!0),a.XD=null);return a.Mc}yF.prototype.$classData=h({pia:0},!1,"scala.collection.immutable.StreamIterator$LazyCell",{pia:1,d:1});function BF(){}BF.prototype=new m;BF.prototype.constructor=BF;BF.prototype.b=function(){return this};function Ie(a,b,d,e){a=0>d?0:d;return e<=a||a>=(b.length|0)?"":b.substring(a,e>(b.length|0)?b.length|0:e)}BF.prototype.$classData=h({sia:0},!1,"scala.collection.immutable.StringOps$",{sia:1,d:1});var CF=void 0;
function Je(){CF||(CF=(new BF).b());return CF}function DF(){}DF.prototype=new m;DF.prototype.constructor=DF;DF.prototype.b=function(){EF=this;(new FF).b();return this};DF.prototype.Va=function(){var a=(new Jk).b();return GF(new HF,a,p(function(){return function(b){return(new ni).c(b)}}(this)))};DF.prototype.$classData=h({Bia:0},!1,"scala.collection.immutable.WrappedString$",{Bia:1,d:1});var EF=void 0;function IF(){EF||(EF=(new DF).b());return EF}function JF(){}JF.prototype=new m;
JF.prototype.constructor=JF;JF.prototype.b=function(){return this};JF.prototype.$classData=h({Tia:0},!1,"scala.collection.mutable.ArrayOps$ofBoolean$",{Tia:1,d:1});var Mka=void 0;function KF(){}KF.prototype=new m;KF.prototype.constructor=KF;KF.prototype.b=function(){return this};KF.prototype.$classData=h({Via:0},!1,"scala.collection.mutable.ArrayOps$ofByte$",{Via:1,d:1});var Nka=void 0;function LF(){}LF.prototype=new m;LF.prototype.constructor=LF;LF.prototype.b=function(){return this};
LF.prototype.$classData=h({Xia:0},!1,"scala.collection.mutable.ArrayOps$ofChar$",{Xia:1,d:1});var Oka=void 0;function MF(){}MF.prototype=new m;MF.prototype.constructor=MF;MF.prototype.b=function(){return this};MF.prototype.$classData=h({Zia:0},!1,"scala.collection.mutable.ArrayOps$ofDouble$",{Zia:1,d:1});var Pka=void 0;function NF(){}NF.prototype=new m;NF.prototype.constructor=NF;NF.prototype.b=function(){return this};
NF.prototype.$classData=h({aja:0},!1,"scala.collection.mutable.ArrayOps$ofFloat$",{aja:1,d:1});var Qka=void 0;function OF(){}OF.prototype=new m;OF.prototype.constructor=OF;OF.prototype.b=function(){return this};OF.prototype.$classData=h({cja:0},!1,"scala.collection.mutable.ArrayOps$ofInt$",{cja:1,d:1});var Rka=void 0;function PF(){}PF.prototype=new m;PF.prototype.constructor=PF;PF.prototype.b=function(){return this};
PF.prototype.$classData=h({eja:0},!1,"scala.collection.mutable.ArrayOps$ofLong$",{eja:1,d:1});var Ska=void 0;function QF(){}QF.prototype=new m;QF.prototype.constructor=QF;QF.prototype.b=function(){return this};QF.prototype.$classData=h({gja:0},!1,"scala.collection.mutable.ArrayOps$ofRef$",{gja:1,d:1});var Tka=void 0;function RF(){}RF.prototype=new m;RF.prototype.constructor=RF;RF.prototype.b=function(){return this};
RF.prototype.$classData=h({ija:0},!1,"scala.collection.mutable.ArrayOps$ofShort$",{ija:1,d:1});var Uka=void 0;function SF(){}SF.prototype=new m;SF.prototype.constructor=SF;SF.prototype.b=function(){return this};SF.prototype.$classData=h({kja:0},!1,"scala.collection.mutable.ArrayOps$ofUnit$",{kja:1,d:1});var Vka=void 0;function Wka(a){return TF(Jh(),-1+a.Wb.j.length|0)}
function UF(a,b){var d=Ja(b);d=VF(a,d);for(var e=a.Wb.j[d];null!==e;){if(Jl(Kl(),e,b))return;d=(1+d|0)%a.Wb.j.length|0;e=a.Wb.j[d]}a.Wb.j[d]=b;a.Yf=1+a.Yf|0;null!==a.sg&&(b=d>>5,d=a.sg,d.j[b]=1+d.j[b]|0);if(a.Yf>=a.gm)for(b=a.Wb,a.Wb=ma(ab(Za),[a.Wb.j.length<<1]),a.Yf=0,null!==a.sg&&(d=1+(a.Wb.j.length>>5)|0,a.sg.j.length!==d?a.sg=ma(ab(hb),[d]):yja(mC(),a.sg)),a.an=Wka(a),a.gm=Xka().Fv(a.vl,a.Wb.j.length),d=0;d<b.j.length;)e=b.j[d],null!==e&&UF(a,e),d=1+d|0}
function VF(a,b){var d=a.an;b=xka(yka(),b);a=-1+a.Wb.j.length|0;return((b>>>d|0|b<<(-d|0))>>>(32-TF(Jh(),a)|0)|0)&a}function Yka(a,b){b=Te(b);var d=Ja(b);d=VF(a,d);for(var e=a.Wb.j[d];null!==e&&!Jl(Kl(),e,b);)d=(1+d|0)%a.Wb.j.length|0,e=a.Wb.j[d];return e}function WF(){}WF.prototype=new m;WF.prototype.constructor=WF;WF.prototype.b=function(){return this};
WF.prototype.Fv=function(a,b){if(!(500>a))throw(new XF).i("assertion failed: loadFactor too large; must be \x3c 0.5");var d=b>>31,e=a>>31,f=65535&b,g=b>>>16|0,k=65535&a,l=a>>>16|0,n=da(f,k);k=da(g,k);var t=da(f,l);f=n+((k+t|0)<<16)|0;n=(n>>>16|0)+t|0;a=(((da(b,e)+da(d,a)|0)+da(g,l)|0)+(n>>>16|0)|0)+(((65535&n)+k|0)>>>16|0)|0;return hf(Wa(),f,a,1E3,0)};WF.prototype.$classData=h({tja:0},!1,"scala.collection.mutable.FlatHashTable$",{tja:1,d:1});var YF=void 0;
function Xka(){YF||(YF=(new WF).b());return YF}function ZF(){}ZF.prototype=new m;ZF.prototype.constructor=ZF;ZF.prototype.b=function(){return this};ZF.prototype.l=function(){return"NullSentinel"};ZF.prototype.p=function(){return 0};ZF.prototype.$classData=h({vja:0},!1,"scala.collection.mutable.FlatHashTable$NullSentinel$",{vja:1,d:1});var $F=void 0;function cba(){$F||($F=(new ZF).b());return $F}function Zka(a){return TF(Jh(),-1+a.Wb.j.length|0)}
function $ka(a){for(var b=-1+a.Wb.j.length|0;0<=b;)a.Wb.j[b]=null,b=-1+b|0;a.Dr(0);ala(a,0)}function bla(a,b,d){for(a=a.Wb.j[d];;)if(null!==a?(d=a.wi(),d=!Jl(Kl(),d,b)):d=!1,d)a=a.ma();else break;return a}function aG(a,b){var d=-1+a.Wb.j.length|0,e=fa(d);a=a.an;b=xka(yka(),b);return((b>>>a|0|b<<(-a|0))>>>e|0)&d}function bG(a){a.Tz(750);cG();a.qz(ma(ab(eba),[dG(0,16)]));a.Dr(0);var b=a.vl,d=cG();cG();a.sz(d.Fv(b,dG(0,16)));a.lz(null);a.SD(Zka(a))}
function eG(a,b){var d=GE(X(),b);d=aG(a,d);var e=a.Wb.j[d];if(null!==e){var f=e.wi();if(Jl(Kl(),f,b))return a.Wb.j[d]=e.ma(),a.Dr(-1+a.Yf|0),cla(a,d),e.dr(null),e;for(f=e.ma();;){if(null!==f){var g=f.wi();g=!Jl(Kl(),g,b)}else g=!1;if(g)e=f,f=f.ma();else break}if(null!==f)return e.dr(f.ma()),a.Dr(-1+a.Yf|0),cla(a,d),f.dr(null),f}return null}function fG(a){for(var b=-1+a.Wb.j.length|0;null===a.Wb.j[b]&&0<b;)b=-1+b|0;return b}
function gG(a,b,d){var e=GE(X(),b);e=aG(a,e);var f=bla(a,b,e);if(null!==f)return f;b=a.rB(b,d);dla(a,b,e);return null}function hG(a,b){var d=GE(X(),b);d=aG(a,d);return bla(a,b,d)}
function dla(a,b,d){b.dr(a.Wb.j[d]);a.Wb.j[d]=b;a.Dr(1+a.Yf|0);iG(a,d);if(a.Yf>a.gm){b=a.Wb.j.length<<1;d=a.Wb;a.qz(ma(ab(eba),[b]));ala(a,a.Wb.j.length);for(var e=-1+d.j.length|0;0<=e;){for(var f=d.j[e];null!==f;){var g=f.wi();g=GE(X(),g);g=aG(a,g);var k=f.ma();f.dr(a.Wb.j[g]);a.Wb.j[g]=f;f=k;iG(a,g)}e=-1+e|0}a.sz(cG().Fv(a.vl,b))}}function cla(a,b){null!==a.sg&&(a=a.sg,b>>=5,a.j[b]=-1+a.j[b]|0)}function ala(a,b){null!==a.sg&&(b=1+(b>>5)|0,a.sg.j.length!==b?a.lz(ma(ab(hb),[b])):yja(mC(),a.sg))}
function iG(a,b){null!==a.sg&&(a=a.sg,b>>=5,a.j[b]=1+a.j[b]|0)}function jG(){}jG.prototype=new m;jG.prototype.constructor=jG;jG.prototype.b=function(){return this};function dG(a,b){return 1<<(-fa(-1+b|0)|0)}jG.prototype.Fv=function(a,b){var d=b>>31,e=a>>31,f=65535&b,g=b>>>16|0,k=65535&a,l=a>>>16|0,n=da(f,k);k=da(g,k);var t=da(f,l);f=n+((k+t|0)<<16)|0;n=(n>>>16|0)+t|0;a=(((da(b,e)+da(d,a)|0)+da(g,l)|0)+(n>>>16|0)|0)+(((65535&n)+k|0)>>>16|0)|0;return hf(Wa(),f,a,1E3,0)};
jG.prototype.$classData=h({Eja:0},!1,"scala.collection.mutable.HashTable$",{Eja:1,d:1});var kG=void 0;function cG(){kG||(kG=(new jG).b());return kG}function lG(){this.Ld=0;this.GB=this.eB=this.Lc=this.Xh=null}lG.prototype=new m;lG.prototype.constructor=lG;c=lG.prototype;c.WI=function(a,b,d){this.Ld=0;this.Xh=a;this.Lc=null;this.eB=b;this.GB=d;return this};c.R=function(a){var b=this;for(;;){if(a<b.Ld)return mG(XE(),b.Xh,a);a=a-b.Ld|0;b=b.Lc}};
c.Kf=function(a,b){var d=this;a:for(;;){if(a<d.Ld)nG(XE(),d.Xh,a,b);else{a=a-d.Ld|0;d=d.Lc;continue a}break}};
c.l=function(){Ke();var a=Ix(Ke(),this.Xh),b=Ix(0,oG(a,0,this.Ld)),d=(new Sb).c("Unrolled@%08x"),e=[Pa(this)];Na();var f=d.U;r();om();for(var g=[],k=0,l=e.length|0;k<l;){var n=e[k];g.push(n instanceof pG?n.fM():n);k=1+k|0}gE();for(var t=g.length|0,u=ma(ab(Za),[t]),w=u.j.length,y=0,E=0,L=g.length|0,S=L<w?L:w,ia=u.j.length,na=S<ia?S:ia;y<na;)u.j[E]=g[y],y=1+y|0,E=1+E|0;var pa=(new qG).b();if(pa.uv)throw(new rG).b();for(var ua=0,Ka=0,Da=f.length|0,Ha=0;Ha!==Da;){var kb=f.indexOf("%",Ha)|0;if(0>kb){sG(pa,
f.substring(Ha));break}sG(pa,f.substring(Ha,kb));var lb=1+kb|0;oC||(oC=(new nC).b());var Tb=oC.oJ;Tb.lastIndex=lb;var Rb=Tb.exec(f);if(null===Rb||(Rb.index|0)!==lb){var ad=lb===Da?"%":f.substring(lb,1+lb|0);throw(new tG).c(ad);}Ha=Tb.lastIndex|0;for(var oc=65535&(f.charCodeAt(-1+Ha|0)|0),kd,Sc=Rb[2],bd=90>=oc?256:0,yc=Sc.length|0,kc=0;kc!==yc;){var Bd=65535&(Sc.charCodeAt(kc)|0);switch(Bd){case 45:var Tc=1;break;case 35:Tc=2;break;case 43:Tc=4;break;case 32:Tc=8;break;case 48:Tc=16;break;case 44:Tc=
32;break;case 40:Tc=64;break;case 60:Tc=128;break;default:throw(new q).i(Le(Bd));}if(0!==(bd&Tc))throw(new uG).c(ba.String.fromCharCode(Bd));bd|=Tc;kc=1+kc|0}kd=bd;var Af=vG(Rb[3],-1),me=vG(Rb[4],-1);if(37===oc||110===oc)var Ch=null;else{if(0!==(1&kd)&&0>Af)throw(new wG).c("%"+Rb[0]);if(0!==(128&kd))var Fe=Ka;else{var Zf=vG(Rb[1],0);Fe=0===Zf?ua=1+ua|0:0>Zf?Ka:Zf}if(0>=Fe||Fe>u.j.length){var Cd=ba.String.fromCharCode(oc);if(0>("bBhHsHcCdoxXeEgGfn%".indexOf(Cd)|0))throw(new tG).c(Cd);throw(new xG).c("%"+
Rb[0]);}Ka=Fe;Ch=u.j[-1+Fe|0]}var pc=pa,Fb=Ch,cd=oc,La=kd,gc=Af,hc=me;switch(cd){case 98:case 66:0!==(126&La)&&yG(La,126,cd);zG(pc,La,gc,hc,!1===Fb||null===Fb?"false":"true");break;case 104:case 72:0!==(126&La)&&yG(La,126,cd);var Ym=null===Fb?"null":(+(Ja(Fb)>>>0)).toString(16);zG(pc,La,gc,hc,Ym);break;case 115:case 83:Fb&&Fb.$classData&&Fb.$classData.Sb.Fra?(0!==(124&La)&&yG(La,124,cd),Fb.xra(pc,(0!==(1&La)?1:0)|(0!==(2&La)?4:0)|(0!==(256&La)?2:0),gc,hc)):(0!==(126&La)&&yG(La,126,cd),zG(pc,La,gc,
hc,""+Fb));break;case 99:case 67:0!==(126&La)&&yG(La,126,cd);if(0<=hc)throw(new AG).wb(hc);if(Fb instanceof ke)zG(pc,La,gc,-1,ba.String.fromCharCode(null===Fb?0:Fb.W));else if(Ua(Fb)){var $g=Fb|0;if(!(0<=$g&&1114111>=$g))throw(new BG).wb($g);var Zm=65536>$g?ba.String.fromCharCode($g):ba.String.fromCharCode(-64+($g>>10)|55296,56320|1023&$g);zG(pc,La,gc,-1,Zm)}else CG(pc,Fb,La,gc,hc,cd);break;case 100:0!==(2&La)&&yG(La,2,cd);17!==(17&La)&&12!==(12&La)||DG(La);if(0<=hc)throw(new AG).wb(hc);if(Ua(Fb))EG(pc,
La,gc,""+(Fb|0));else if(Fb instanceof Fa){var jl=Va(Fb),$m=jl.ga,an=jl.na;EG(pc,La,gc,FG(Wa(),$m,an))}else CG(pc,Fb,La,gc,hc,cd);break;case 111:0!==(108&La)&&yG(La,108,cd);17===(17&La)&&DG(La);if(0<=hc)throw(new AG).wb(hc);var kl=0!==(2&La)?"0":"";if(Ua(Fb)){var bn=(+((Fb|0)>>>0)).toString(8);GG(pc,La,gc,kl,bn)}else if(Fb instanceof Fa){var ll=Va(Fb),ml=ll.ga,nl=ll.na;kh();var cn=pc,ol=La,dn=gc;var ei=1073741823&ml,Yj=1073741823&((ml>>>30|0)+(nl<<2)|0),Ui=nl>>>28|0;if(0!==Ui){var en=(+(Ui>>>0)).toString(8),
Vi=(+(Yj>>>0)).toString(8),fn="0000000000".substring(Vi.length|0),Wi=(+(ei>>>0)).toString(8);var Zj=en+(""+fn+Vi)+(""+"0000000000".substring(Wi.length|0)+Wi)}else if(0!==Yj){var ak=(+(Yj>>>0)).toString(8),pl=(+(ei>>>0)).toString(8);Zj=ak+(""+"0000000000".substring(pl.length|0)+pl)}else Zj=(+(ei>>>0)).toString(8);GG(cn,ol,dn,kl,Zj)}else CG(pc,Fb,La,gc,hc,cd);break;case 120:case 88:0!==(108&La)&&yG(La,108,cd);17===(17&La)&&DG(La);if(0<=hc)throw(new AG).wb(hc);var Xi=0===(2&La)?"":0!==(256&La)?"0X":
"0x";if(Ua(Fb)){var gn=(+((Fb|0)>>>0)).toString(16);GG(pc,La,gc,Xi,HG(La,gn))}else if(Fb instanceof Fa){var Yi=Va(Fb),hn=Yi.ga,ql=Yi.na;kh();var jn=pc,rl=La,kn=gc,ln=La;var sl=hn;if(0!==ql){var mn=(+(ql>>>0)).toString(16),tl=(+(sl>>>0)).toString(16);var ul=mn+(""+"00000000".substring(tl.length|0)+tl)}else ul=(+(sl>>>0)).toString(16);GG(jn,rl,kn,Xi,HG(ln,ul))}else CG(pc,Fb,La,gc,hc,cd);break;case 101:case 69:0!==(32&La)&&yG(La,32,cd);17!==(17&La)&&12!==(12&La)||DG(La);if("number"===typeof Fb){var Cg=
+Fb;Cg!==Cg||Infinity===Cg||-Infinity===Cg?IG(pc,La,gc,Cg):EG(pc,La,gc,ela(Cg,0<=hc?hc:6,0!==(2&La)))}else CG(pc,Fb,La,gc,hc,cd);break;case 103:case 71:0!==(2&La)&&yG(La,2,cd);17!==(17&La)&&12!==(12&La)||DG(La);if("number"===typeof Fb){var ah=+Fb;if(ah!==ah||Infinity===ah||-Infinity===ah)IG(pc,La,gc,ah);else{var nn=pc,vl=La,fi=gc;var bk=ah,Zi=0<=hc?hc:6,wl=0!==(2&La),bh=+ba.Math.abs(bk),ck=0===Zi?1:Zi;if(1E-4<=bh&&bh<+ba.Math.pow(10,ck)){var gi=void 0!==ba.Math.log10?+ba.Math.log10(bh):+ba.Math.log(bh)/
2.302585092994046,Dh=Sa(+ba.Math.ceil(gi)),$i=+ba.Math.pow(10,Dh)<=bh?1+Dh|0:Dh,aj=ck-$i|0;var dk=fla(bk,0<aj?aj:0,wl)}else dk=ela(bk,-1+ck|0,wl);EG(nn,vl,fi,dk)}}else CG(pc,Fb,La,gc,hc,cd);break;case 102:17!==(17&La)&&12!==(12&La)||DG(La);if("number"===typeof Fb){var Eh=+Fb;Eh!==Eh||Infinity===Eh||-Infinity===Eh?IG(pc,La,gc,Eh):EG(pc,La,gc,fla(Eh,0<=hc?hc:6,0!==(2&La)))}else CG(pc,Fb,La,gc,hc,cd);break;case 37:if(0!==(254&La))throw(new JG).c(KG(La));if(0<=hc)throw(new AG).wb(hc);if(0!==(1&La)&&0>
gc)throw(new wG).c("%-%");LG(pc,La,gc,"%");break;case 110:if(0!==(255&La))throw(new JG).c(KG(La));if(0<=hc)throw(new AG).wb(hc);if(0<=gc)throw(new MG).wb(gc);sG(pc,"\n");break;default:throw(new tG).c(ba.String.fromCharCode(cd));}}var on=pa.l();pa.$o();var ek=on+"["+this.Ld+"/"+WE(XE(),this.Xh)+"](";return bc(b,ek,", ",")")+" -\x3e "+(null!==this.Lc?this.Lc.l():"")};c.ua=function(a){for(var b=this,d=0;null!==b;){for(var e=b.Xh,f=b.Ld;d<f;){var g=mG(XE(),e,d);a.w(g);d=1+d|0}d=0;b=b.Lc}};
function gla(a){return null===a.eB?NG().qE:WE(XE(),a.Xh)}c.$classData=h({nka:0},!1,"scala.collection.mutable.UnrolledBuffer$Unrolled",{nka:1,d:1});function OG(){this.gF=null}OG.prototype=new m;OG.prototype.constructor=OG;OG.prototype.b=function(){PG=this;this.gF=(new KC).Vi(ma(ab(Za),[0]));ra(Za);(new QG).b();(new RG).b();(new SG).b();(new TG).b();(new UG).b();(new VG).b();(new WG).b();(new XG).b();(new YG).b();var a=gE();(new ZG).Nl(a);return this};
function $G(a,b){if(null===b)return null;if(ge(b,1))return(new KC).Vi(b);if(rb(b,1))return(new aH).up(b);if(ub(b,1))return(new bH).tp(b);if(sb(b,1))return(new cH).vp(b);if(tb(b,1))return(new LC).In(b);if(ob(b,1))return(new dH).sp(b);if(pb(b,1))return(new eH).rp(b);if(qb(b,1))return(new fH).wp(b);if(nb(b,1))return(new gH).xp(b);if(hH(b))return(new iH).yp(b);throw(new q).i(b);}OG.prototype.$classData=h({oka:0},!1,"scala.collection.mutable.WrappedArray$",{oka:1,d:1});var PG=void 0;
function JC(){PG||(PG=(new OG).b());return PG}function bD(){this.PK=null}bD.prototype=new m;bD.prototype.constructor=bD;bD.prototype.b=function(){aD=this;hla||(hla=(new jH).b());ila||(ila=(new kH).b());this.PK=void 0===ba.Promise?(new lH).b():(new mH).b();return this};bD.prototype.$classData=h({Kka:0},!1,"scala.scalajs.concurrent.JSExecutionContext$",{Kka:1,d:1});var aD=void 0;function kH(){}kH.prototype=new m;kH.prototype.constructor=kH;kH.prototype.b=function(){return this};
kH.prototype.$classData=h({Lka:0},!1,"scala.scalajs.concurrent.QueueExecutionContext$",{Lka:1,d:1});var ila=void 0;function fw(){}fw.prototype=new m;fw.prototype.constructor=fw;fw.prototype.b=function(){return this};function dha(a,b){var d={};b.Do(p(function(){return function(e){return null!==e}}(a))).ua(p(function(e,f){return function(g){if(null!==g)f[g.ha()]=g.la();else throw(new q).i(g);}}(a,d)));return d}fw.prototype.$classData=h({Rka:0},!1,"scala.scalajs.js.Dictionary$",{Rka:1,d:1});var ew=void 0;
function nH(){}nH.prototype=new m;nH.prototype.constructor=nH;nH.prototype.b=function(){return this};function Hx(a,b){if(b instanceof os)return b.kf;if(b instanceof M)return b.wa;var d=[];b.ua(p(function(e,f){return function(g){return f.push(g)|0}}(a,d)));return d}nH.prototype.$classData=h({Tka:0},!1,"scala.scalajs.js.JSConverters$JSRichGenTraversableOnce$",{Tka:1,d:1});var oH=void 0;function Gx(){oH||(oH=(new nH).b());return oH}function pH(){this.il=null}pH.prototype=new m;
pH.prototype.constructor=pH;pH.prototype.b=function(){qH=this;this.il=ba.Object.prototype.hasOwnProperty;return this};pH.prototype.$classData=h({$ka:0},!1,"scala.scalajs.js.WrappedDictionary$Cache$",{$ka:1,d:1});var qH=void 0;function cw(){qH||(qH=(new pH).b());return qH}function rH(){this.IH=this.bm=null}rH.prototype=new m;rH.prototype.constructor=rH;
function Nha(a){a:{var b=v();for(var d=a.IH;!d.x();){var e=d.Y().rD;if(sH(e,b)){b=(new I).i(d.Y());break a}d=d.X()}b=D()}if(b.x())throw kg(),b=(new tH).c(a.bm.yg()),a=(new uH).c(a.bm.yg()+".\x3cinit\x3e()"),b.Sf=a,jg(0,b);return jla(b.Q())}rH.prototype.$classData=h({cla:0},!1,"scala.scalajs.reflect.InstantiatableClass",{cla:1,d:1});function vH(){this.YJ=this.rD=null}vH.prototype=new m;vH.prototype.constructor=vH;function kla(){var a=lla[1],b=new vH;b.rD=wH;b.YJ=a;return b}
function jla(a){var b=v();Ke();var d=b.za();xH(0,d===Ol(a.rD));a=a.YJ;d=cha();if(b instanceof os)b=b.kf;else if(b instanceof M)b=b.wa;else{var e=[];b.ua(p(function(f,g){return function(k){return g.push(k)|0}}(d,e)));b=e}return a.apply(void 0,b)}vH.prototype.$classData=h({dla:0},!1,"scala.scalajs.reflect.InvokableConstructor",{dla:1,d:1});function yH(){this.FC=this.KJ=null}yH.prototype=new m;yH.prototype.constructor=yH;yH.prototype.b=function(){zH=this;this.KJ={};this.FC={};return this};
function ox(a,b){a=a.FC;return cw().il.call(a,b)?(new I).i(a[b]):D()}yH.prototype.$classData=h({ela:0},!1,"scala.scalajs.reflect.Reflect$",{ela:1,d:1});var zH=void 0;function px(){zH||(zH=(new yH).b());return zH}function AH(){this.bq=!1;this.NB=this.dt=this.ju=null;this.cB=!1;this.eD=this.XB=0}AH.prototype=new m;AH.prototype.constructor=AH;
AH.prototype.b=function(){BH=this;this.ju=(this.bq=!!(ba.ArrayBuffer&&ba.Int32Array&&ba.Float32Array&&ba.Float64Array))?new ba.ArrayBuffer(8):null;this.dt=this.bq?new ba.Int32Array(this.ju,0,2):null;this.bq&&new ba.Float32Array(this.ju,0,2);this.NB=this.bq?new ba.Float64Array(this.ju,0,1):null;if(this.bq)this.dt[0]=16909060,a=1===((new ba.Int8Array(this.ju,0,8))[0]|0);else var a=!0;this.XB=(this.cB=a)?0:1;this.eD=this.cB?1:0;return this};
function daa(a,b){var d=b|0;if(d===b&&-Infinity!==1/b)return d;if(a.bq)a.NB[0]=b,a=(new Fa).fa(a.dt[a.eD]|0,a.dt[a.XB]|0);else{if(b!==b)a=!1,b=2047,d=+ba.Math.pow(2,51);else if(Infinity===b||-Infinity===b)a=0>b,b=2047,d=0;else if(0===b)a=-Infinity===1/b,d=b=0;else{var e=(a=0>b)?-b:b;if(e>=+ba.Math.pow(2,-1022)){b=+ba.Math.pow(2,52);d=+ba.Math.log(e)/.6931471805599453;d=+ba.Math.floor(d)|0;d=1023>d?d:1023;var f=+ba.Math.pow(2,d);f>e&&(d=-1+d|0,f/=2);f=e/f*b;e=+ba.Math.floor(f);f-=e;e=.5>f?e:.5<f?1+
e:0!==e%2?1+e:e;2<=e/b&&(d=1+d|0,e=1);1023<d?(d=2047,e=0):(d=1023+d|0,e-=b);b=d;d=e}else b=e/+ba.Math.pow(2,-1074),d=+ba.Math.floor(b),e=b-d,b=0,d=.5>e?d:.5<e?1+d:0!==d%2?1+d:d}d=+d;a=(new Fa).fa(d|0,(a?-2147483648:0)|(b|0)<<20|d/4294967296|0)}return a.ga^a.na}
AH.prototype.tda=function(a){var b=a.na,d=0>b,e=2047&b>>20;a=4294967296*(1048575&b)+ +(a.ga>>>0);return 2047===e?0!==a?NaN:d?-Infinity:Infinity:0<e?(e=+ba.Math.pow(2,-1023+e|0)*(1+a/+ba.Math.pow(2,52)),d?-e:e):0!==a?(e=+ba.Math.pow(2,-1022)*(a/+ba.Math.pow(2,52)),d?-e:e):d?-0:0};AH.prototype.$classData=h({kla:0},!1,"scala.scalajs.runtime.Bits$",{kla:1,d:1});var BH=void 0;function Oa(){BH||(BH=(new AH).b());return BH}function CH(){}CH.prototype=new m;CH.prototype.constructor=CH;CH.prototype.b=function(){return this};
CH.prototype.$classData=h({lla:0},!1,"scala.scalajs.runtime.Compat$",{lla:1,d:1});var DH=void 0;function cha(){DH||(DH=(new CH).b());return DH}function EH(){this.va=!1}EH.prototype=new m;EH.prototype.constructor=EH;function Do(a,b,d){return b.substring((b.length|0)-(d.length|0)|0)===d}EH.prototype.b=function(){return this};function FH(a,b){a=b.length|0;for(var d=ma(ab(eb),[a]),e=0;e<a;)d.j[e]=65535&(b.charCodeAt(e)|0),e=1+e|0;return d}
function GH(a,b,d){if(null===b)throw(new xe).b();a=eg(dg(),d);b=oa(b);if(""===b)b=la(ab(sa),[""]);else{d=fg(a,b,b.length|0);a=[];for(var e=0,f=0;2147483646>f&&mh(d);){if(0!==d.En()){var g=d.kl();e=b.substring(e,g);a.push(null===e?null:e);f=1+f|0}e=d.En()}b=b.substring(e);a.push(null===b?null:b);b=la(ab(sa),a);for(a=b.j.length;0!==a&&""===b.j[-1+a|0];)a=-1+a|0;a!==b.j.length&&(d=ma(ab(sa),[a]),Ta(b,0,d,0,a),b=d)}return b}function Jx(a,b,d){a=mla(d);return b.indexOf(a)|0}
function HH(a,b,d,e){a=d+e|0;if(0>d||a<d||a>b.j.length)throw(new IH).b();for(e="";d!==a;)e=""+e+ba.String.fromCharCode(b.j[d]),d=1+d|0;return e}function mla(a){if(0===(-65536&a))return ba.String.fromCharCode(a);if(0>a||1114111<a)throw(new Pe).b();a=-65536+a|0;return ba.String.fromCharCode(55296|a>>10,56320|1023&a)}function Ma(a,b){a=0;for(var d=1,e=-1+(b.length|0)|0;0<=e;)a=a+da(65535&(b.charCodeAt(e)|0),d)|0,d=da(31,d),e=-1+e|0;return a}
function Pb(a,b,d,e){if(null===b)throw(new xe).b();a=eg(dg(),d);b=fg(a,b,b.length|0);ym(b);for(a=(new zm).b();mh(b);)Am(b,a,e);Bm(b,a);return a.l()}EH.prototype.$classData=h({ola:0},!1,"scala.scalajs.runtime.RuntimeString$",{ola:1,d:1});var JH=void 0;function Na(){JH||(JH=(new EH).b());return JH}function KH(){this.kJ=!1;this.AH=this.KH=this.JH=null;this.va=0}KH.prototype=new m;KH.prototype.constructor=KH;KH.prototype.b=function(){return this};
function nla(a){return(a.stack+"\n").replace(LH("^[\\s\\S]+?\\s+at\\s+")," at ").replace(MH("^\\s+(at eval )?at\\s+","gm"),"").replace(MH("^([^\\(]+?)([\\n])","gm"),"{anonymous}() ($1)$2").replace(MH("^Object.\x3canonymous\x3e\\s*\\(([^\\)]+)\\)","gm"),"{anonymous}() ($1)").replace(MH("^([^\\(]+|\\{anonymous\\}\\(\\)) \\((.+)\\)$","gm"),"$1@$2").split("\n").slice(0,-1)}function ola(a){0===(8&a.va)<<24>>24&&0===(8&a.va)<<24>>24&&(a.AH=ba.Object.keys(pla(a)),a.va=(8|a.va)<<24>>24);return a.AH}
function qla(a){if(0===(2&a.va)<<24>>24&&0===(2&a.va)<<24>>24){for(var b={O:"java_lang_Object",T:"java_lang_String",V:"scala_Unit",Z:"scala_Boolean",C:"scala_Char",B:"scala_Byte",S:"scala_Short",I:"scala_Int",J:"scala_Long",F:"scala_Float",D:"scala_Double"},d=0;22>=d;)2<=d&&(b["T"+d]="scala_Tuple"+d),b["F"+d]="scala_Function"+d,d=1+d|0;a.JH=b;a.va=(2|a.va)<<24>>24}return a.JH}
function rla(a,b){var d=LH("^(?:Object\\.|\\[object Object\\]\\.)?(?:ScalaJS\\.c\\.|\\$c_)([^\\.]+)(?:\\.prototype)?\\.([^\\.]+)$"),e=LH("^(?:Object\\.|\\[object Object\\]\\.)?(?:ScalaJS\\.(?:s|f)\\.|\\$(?:s|f)_)((?:_[^_]|[^_])+)__([^\\.]+)$"),f=LH("^(?:Object\\.|\\[object Object\\]\\.)?(?:ScalaJS\\.m\\.|\\$m_)([^\\.]+)$"),g=!1;d=d.exec(b);null===d&&(d=e.exec(b),null===d&&(d=f.exec(b),g=!0));if(null!==d){b=d[1];if(void 0===b)throw(new dw).c("undefined.get");b=36===(65535&(b.charCodeAt(0)|0))?b.substring(1):
b;e=qla(a);if(cw().il.call(e,b)){a=qla(a);if(!cw().il.call(a,b))throw(new dw).c("key not found: "+b);a=a[b]}else a:for(f=0;;)if(f<(ola(a).length|0)){e=ola(a)[f];if(0<=(b.length|0)&&b.substring(0,e.length|0)===e){a=pla(a);if(!cw().il.call(a,e))throw(new dw).c("key not found: "+e);a=""+a[e]+b.substring(e.length|0);break a}f=1+f|0}else{a=0<=(b.length|0)&&"L"===b.substring(0,1)?b.substring(1):b;break a}a=a.split("_").join(".").split("$und").join("_");if(g)g="\x3cclinit\x3e";else{g=d[2];if(void 0===g)throw(new dw).c("undefined.get");
0<=(g.length|0)&&"init___"===g.substring(0,7)?g="\x3cinit\x3e":(d=g.indexOf("__")|0,g=0>d?g:g.substring(0,d))}return(new z).e(a,g)}return(new z).e("\x3cjscode\x3e",b)}function sla(a){var b=MH("Line (\\d+).*script (?:in )?(\\S+)","i");a=a.message.split("\n");for(var d=[],e=2,f=a.length|0;e<f;){var g=b.exec(a[e]);if(null!==g){var k=g[2];if(void 0===k)throw(new dw).c("undefined.get");g=g[1];if(void 0===g)throw(new dw).c("undefined.get");d.push("{anonymous}()@"+k+":"+g)}e=2+e|0}return d}
function pla(a){0===(4&a.va)<<24>>24&&0===(4&a.va)<<24>>24&&(a.KH={sjsr_:"scala_scalajs_runtime_",sjs_:"scala_scalajs_",sci_:"scala_collection_immutable_",scm_:"scala_collection_mutable_",scg_:"scala_collection_generic_",sc_:"scala_collection_",sr_:"scala_runtime_",s_:"scala_",jl_:"java_lang_",ju_:"java_util_"},a.va=(4|a.va)<<24>>24);return a.KH}KH.prototype.$classData=h({pla:0},!1,"scala.scalajs.runtime.StackTrace$",{pla:1,d:1});var tla=void 0;function NH(){}NH.prototype=new m;
NH.prototype.constructor=NH;NH.prototype.b=function(){return this};function MH(a,b){OH||(OH=(new NH).b());return new ba.RegExp(a,b)}function LH(a){OH||(OH=(new NH).b());return new ba.RegExp(a)}NH.prototype.$classData=h({qla:0},!1,"scala.scalajs.runtime.StackTrace$StringRE$",{qla:1,d:1});var OH=void 0;function PH(){}PH.prototype=new m;PH.prototype.constructor=PH;PH.prototype.b=function(){return this};function jg(a,b){return b instanceof QH?b.mp:b}
function vm(a,b){return b instanceof RH?b:(new QH).i(b)}PH.prototype.$classData=h({rla:0},!1,"scala.scalajs.runtime.package$",{rla:1,d:1});var ula=void 0;function kg(){ula||(ula=(new PH).b());return ula}function SH(){}SH.prototype=new m;SH.prototype.constructor=SH;SH.prototype.b=function(){return this};
function vla(a,b){if(b instanceof ke)return a.W===b.W;if(wla(b)){if("number"===typeof b)return+b===a.W;if(b instanceof Fa){b=Va(b);var d=b.na;a=a.W;return b.ga===a&&d===a>>31}return null===b?null===a:Ia(b,a)}return null===a&&null===b}function TH(a,b,d){if(wla(d))return UH(0,b,d);if(d instanceof ke){if("number"===typeof b)return+b===d.W;if(b instanceof Fa)return a=Va(b),b=a.na,d=d.W,a.ga===d&&b===d>>31}return null===b?null===d:Ia(b,d)}
function Jl(a,b,d){return b===d?!0:wla(b)?TH(0,b,d):b instanceof ke?vla(b,d):null===b?null===d:Ia(b,d)}function UH(a,b,d){if("number"===typeof b)return a=+b,"number"===typeof d?a===+d:d instanceof Fa?(b=Va(d),d=b.ga,b=b.na,a===VH(Wa(),d,b)):d instanceof pG?d.m(a):!1;if(b instanceof Fa){b=Va(b);a=b.ga;b=b.na;if(d instanceof Fa){d=Va(d);var e=d.na;return a===d.ga&&b===e}return"number"===typeof d?(d=+d,VH(Wa(),a,b)===d):d instanceof pG?d.m((new Fa).fa(a,b)):!1}return null===b?null===d:Ia(b,d)}
SH.prototype.$classData=h({ula:0},!1,"scala.runtime.BoxesRunTime$",{ula:1,d:1});var xla=void 0;function Kl(){xla||(xla=(new SH).b());return xla}var WH=h({Dla:0},!1,"scala.runtime.Null$",{Dla:1,d:1});function XH(){}XH.prototype=new m;XH.prototype.constructor=XH;XH.prototype.b=function(){return this};function $v(a,b){return Sa(b)===b}XH.prototype.$classData=h({Fla:0},!1,"scala.runtime.RichDouble$",{Fla:1,d:1});var yla=void 0;function aw(){yla||(yla=(new XH).b());return yla}function YH(){}
YH.prototype=new m;YH.prototype.constructor=YH;YH.prototype.b=function(){return this};YH.prototype.$classData=h({Hla:0},!1,"scala.runtime.RichLong$",{Hla:1,d:1});var zla=void 0;function ZH(){zla||(zla=(new YH).b())}function $H(){}$H.prototype=new m;$H.prototype.constructor=$H;$H.prototype.b=function(){return this};function WE(a,b){if(ge(b,1)||rb(b,1)||ub(b,1)||sb(b,1)||tb(b,1)||ob(b,1)||pb(b,1)||qb(b,1)||nb(b,1)||hH(b))return b.j.length;if(null===b)throw(new xe).b();throw(new q).i(b);}
function nG(a,b,d,e){if(ge(b,1))b.j[d]=e;else if(rb(b,1))b.j[d]=e|0;else if(ub(b,1))b.j[d]=+e;else if(sb(b,1))b.j[d]=Va(e);else if(tb(b,1))b.j[d]=+e;else if(ob(b,1))b.j[d]=null===e?0:e.W;else if(pb(b,1))b.j[d]=e|0;else if(qb(b,1))b.j[d]=e|0;else if(nb(b,1))b.j[d]=!!e;else if(hH(b))b.j[d]=void 0;else{if(null===b)throw(new xe).b();throw(new q).i(b);}}function Y(a){XE();var b=a.v();return bc(b,a.s()+"(",",",")")}
function mG(a,b,d){if(ge(b,1)||rb(b,1)||ub(b,1)||sb(b,1)||tb(b,1))return b.j[d];if(ob(b,1))return Le(b.j[d]);if(pb(b,1)||qb(b,1)||nb(b,1)||hH(b))return b.j[d];if(null===b)throw(new xe).b();throw(new q).i(b);}$H.prototype.$classData=h({Ila:0},!1,"scala.runtime.ScalaRunTime$",{Ila:1,d:1});var Ala=void 0;function XE(){Ala||(Ala=(new $H).b());return Ala}function aI(){}aI.prototype=new m;aI.prototype.constructor=aI;c=aI.prototype;c.b=function(){return this};
c.Tl=function(a,b){b=da(-862048943,b);b=da(461845907,b<<15|b>>>17|0);return a^b};function bI(a,b){a=Sa(b);if(a===b)return a;var d=Wa();a=cI(d,b);d=d.Pb;return VH(Wa(),a,d)===b?a^d:daa(Oa(),b)}function GE(a,b){return null===b?0:"number"===typeof b?bI(0,+b):b instanceof Fa?(a=Va(b),dI(0,(new Fa).fa(a.ga,a.na))):Ja(b)}c.ba=function(a,b){a=this.Tl(a,b);return-430675100+da(5,a<<13|a>>>19|0)|0};function dI(a,b){a=b.ga;b=b.na;return b===a>>31?a:a^b}
c.qb=function(a,b){a^=b;a=da(-2048144789,a^(a>>>16|0));a=da(-1028477387,a^(a>>>13|0));return a^(a>>>16|0)};c.$classData=h({Kla:0},!1,"scala.runtime.Statics$",{Kla:1,d:1});var Bla=void 0;function X(){Bla||(Bla=(new aI).b());return Bla}function eI(){this.LI=null;this.uH=0;this.BI=this.KI=this.MI=this.NI=null;this.a=0}eI.prototype=new m;eI.prototype.constructor=eI;
eI.prototype.b=function(){fI=this;this.LI=Jg(Kg(),v());this.a|=1;this.uH=O(C())|zi(C());this.a|=2;Kg();var a=O(C());a=(new z).e("WHO",a);var b=gI(this);b=(new z).e("COLOR",b);var d=O(C());d=(new z).e("HEADING",d);var e=O(C());e=(new z).e("XCOR",e);var f=O(C());f=(new z).e("YCOR",f);var g=yi(C());g=(new z).e("SHAPE",g);var k=mc();k=(new z).e("LABEL",k);var l=gI(this);l=(new z).e("LABEL-COLOR",l);var n=Ai(C());n=(new z).e("BREED",n);var t=xi(C());t=(new z).e("HIDDEN?",t);var u=O(C());u=(new z).e("SIZE",
u);var w=O(C());w=(new z).e("PEN-SIZE",w);var y=yi(C());a=[a,b,d,e,f,g,k,l,n,t,u,w,(new z).e("PEN-MODE",y)];b=(new dc).vb(rp());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.NI=b.La;this.a|=4;Kg();a=O(C());a=(new z).e("PXCOR",a);b=O(C());b=(new z).e("PYCOR",b);d=gI(this);d=(new z).e("PCOLOR",d);e=mc();e=(new z).e("PLABEL",e);f=gI(this);a=[a,b,d,e,(new z).e("PLABEL-COLOR",f)];b=(new dc).vb(rp());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.MI=b.La;this.a|=8;Kg();a=Ei(C());a=(new z).e("END1",
a);b=Ei(C());b=(new z).e("END2",b);d=gI(this);d=(new z).e("COLOR",d);e=mc();e=(new z).e("LABEL",e);f=gI(this);f=(new z).e("LABEL-COLOR",f);g=xi(C());g=(new z).e("HIDDEN?",g);k=Di(C());k=(new z).e("BREED",k);l=O(C());l=(new z).e("THICKNESS",l);n=yi(C());n=(new z).e("SHAPE",n);t=yi(C());a=[a,b,d,e,f,g,k,l,n,(new z).e("TIE-MODE",t)];b=(new dc).vb(rp());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.KI=b.La;this.a|=16;a=Cla(this);a=(new Kc).Gd(a);go(a);this.a|=32;a=Dla(this);a=(new Kc).Gd(a);go(a);
this.a|=64;a=hI(this);a=(new Kc).Gd(a);go(a);this.a|=128;a=Ela(this);a=(new Kc).Gd(a);go(a);this.a|=256;a=Cla(this);a=(new Kc).Gd(a);go(a).Ne((new Dm).Cg(ra(sa)));this.a|=512;a=Ela(this);a=(new Kc).Gd(a);this.BI=go(a).Ne((new Dm).Cg(ra(sa)));this.a|=1024;return this};function Dla(a){if(0===(4&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/AgentVariables.scala: 14");return a.NI}
function Cla(a){if(0===(1&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/AgentVariables.scala: 9");return a.LI}function Aga(){var a=iI();a=hI(a);a=(new Kc).Gd(a);return go(a).Ne((new Dm).Cg(ra(sa)))}function yga(){var a=iI();a=Dla(a);a=(new Kc).Gd(a);return go(a).Ne((new Dm).Cg(ra(sa)))}
function gI(a){if(0===(2&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/AgentVariables.scala: 12");return a.uH}function Ela(a){if(0===(16&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/AgentVariables.scala: 36");return a.KI}
function xga(){var a=iI();if(0===(1024&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/AgentVariables.scala: 56");return a.BI}function hI(a){if(0===(8&a.a))throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/AgentVariables.scala: 29");return a.MI}eI.prototype.$classData=h({VM:0},!1,"org.nlogo.core.AgentVariables$",{VM:1,d:1,Sla:1});var fI=void 0;function iI(){fI||(fI=(new eI).b());return fI}
function jI(a){return!!(a&&a.$classData&&a.$classData.Sb.AF)}function Et(){this.fG=this.nG=0;this.$K=this.nK=this.oK=null;this.a=0}Et.prototype=new m;Et.prototype.constructor=Et;function raa(a){if(0===(64&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/Color.scala: 232");return a.$K}
Et.prototype.b=function(){Dt=this;this.nG=14;this.a=(1|this.a)<<24>>24;if(0===(1&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/Color.scala: 232");this.fG=da(10,this.nG);this.a=(2|this.a)<<24>>24;this.a=(4|this.a)<<24>>24;Bba(xg());this.a=(8|this.a)<<24>>24;var a=(new M).q([140,140,140,215,48,39,241,105,19,156,109,70,237,237,47,87,176,58,42,209,57,27,158,119,82,196,196,43,140,190,50,92,168,123,78,163,166,25,105,224,126,149,0,0,0,255,
255,255]),b=a.wa.length|0;b=ma(ab(hb),[b]);var d=0;for(a=wg(a,0,a.wa.length|0);a.qa();){var e=a.ma();b.j[d]=e|0;d=1+d|0}this.oK=b;this.a=(16|this.a)<<24>>24;a=da(10,Fla(this));if(e=0>=a)var f=0;else b=a>>31,f=(0===b?-1<(-2147483648^a):0<b)?-1:a;b=-1+a|0;cv();ij();cv();hj();d=(new dv).b();0>f&&pm(qm(),0,a,1,!1);if(!e)for(a=0;;){var g=a,k=g/100|0;e=Gla(this).j[da(3,k)];f=Gla(this).j[1+da(3,k)|0];k=Gla(this).j[2+da(3,k)|0];g=.012+(-50+(g%100|0)|0)/50.48;0>g?(e=e+Sa(e*g)|0,f=f+Sa(f*g)|0,k=k+Sa(k*g)|0):
0<g&&(e=e+Sa((255-e|0)*g)|0,f=f+Sa((255-f|0)*g)|0,k=k+Sa((255-k|0)*g)|0);ev(d,((-16777216+(e<<16)|0)+(f<<8)|0)+k|0);if(a===b)break;a=1+a|0}b=fv(d);d=b.ra();d=ma(ab(hb),[d]);VE(b,d,0);d.j[0]=-16777216;d.j[99]=-1;this.nK=d;this.a=(32|this.a)<<24>>24;b=Jg(kI(),v());a=da(10,Fla(this));d=-1+a|0;if(!(0>=a))for(a=0;;){f=e=a/10;if(0===(32&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/Color.scala: 232");b.Sj((new z).e(this.nK.j[Sa(10*f)],
e));if(a===d)break;a=1+a|0}this.$K=b;this.a=(64|this.a)<<24>>24;return this};function Fla(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/Color.scala: 232");return a.fG}function Gla(a){if(0===(16&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/Color.scala: 232");return a.oK}Et.prototype.$classData=h({sN:0},!1,"org.nlogo.core.Color$",{sN:1,d:1,Ula:1});var Dt=void 0;
function qr(){}qr.prototype=new m;qr.prototype.constructor=qr;qr.prototype.b=function(){return this};qr.prototype.$classData=h({zN:0},!1,"org.nlogo.core.DummyCompilationEnvironment",{zN:1,d:1,Vla:1});function pr(){}pr.prototype=new m;pr.prototype.constructor=pr;pr.prototype.b=function(){return this};pr.prototype.$classData=h({AN:0},!1,"org.nlogo.core.DummyLibraryManager",{AN:1,d:1,dma:1});function lI(){this.bI=null;this.a=!1}lI.prototype=new m;lI.prototype.constructor=lI;
lI.prototype.b=function(){mI=this;var a=new nI;if(null===this)throw jg(kg(),null);a.Ta=this;this.bI=a;this.a=!0;return this};lI.prototype.$classData=h({BN:0},!1,"org.nlogo.core.Dump$",{BN:1,d:1,$la:1});var mI=void 0;function Pm(){mI||(mI=(new lI).b());return mI}function oI(){this.ck=this.Dk=this.jH=null;this.a=0}oI.prototype=new m;oI.prototype.constructor=oI;function Hla(){}Hla.prototype=oI.prototype;
oI.prototype.xf=function(){var a=Ke().Pk,b=(new z).e("org.nlogo.core.prim._breed",p(function(){return function(db){return(new Du).c(db)}}(this))),d=(new z).e("org.nlogo.core.prim._breedvariable",p(function(){return function(db){return(new pI).c(db)}}(this))),e=(new z).e("org.nlogo.core.prim._createorderedturtles",p(function(){return function(db){return(new uq).c(db)}}(this))),f=(new z).e("org.nlogo.core.prim._createturtles",p(function(){return function(db){return(new tq).c(db)}}(this))),g=(new z).e("org.nlogo.core.prim._hatch",
p(function(){return function(db){return(new Kq).c(db)}}(this))),k=(new z).e("org.nlogo.core.prim._lambdavariable",p(function(){return function(db){return(new Al).c(db)}}(this))),l=(new z).e("org.nlogo.core.prim._linkbreedvariable",p(function(){return function(db){return(new qI).c(db)}}(this))),n=(new z).e("org.nlogo.core.prim._sprout",p(function(){return function(db){return(new xq).c(db)}}(this))),t=(new z).e("org.nlogo.core.prim.etc._breedat",p(function(){return function(db){return(new Hu).c(db)}}(this))),
u=(new z).e("org.nlogo.core.prim.etc._breedhere",p(function(){return function(db){return(new Iu).c(db)}}(this))),w=(new z).e("org.nlogo.core.prim.etc._breedon",p(function(){return function(db){return(new Ju).c(db)}}(this))),y=(new z).e("org.nlogo.core.prim.etc._breedsingular",p(function(){return function(db){return(new Eu).c(db)}}(this))),E=(new z).e("org.nlogo.core.prim.etc._inlinkfrom",p(function(){return function(db){return(new Mu).c(db)}}(this))),L=(new z).e("org.nlogo.core.prim.etc._inlinkneighbor",
p(function(){return function(db){return(new Nu).c(db)}}(this))),S=(new z).e("org.nlogo.core.prim.etc._inlinkneighbors",p(function(){return function(db){return(new Ou).c(db)}}(this))),ia=(new z).e("org.nlogo.core.prim.etc._isbreed",p(function(){return function(db){return(new rI).c(db)}}(this))),na=(new z).e("org.nlogo.core.prim.etc._linkbreed",p(function(){return function(db){return(new Fu).c(db)}}(this))),pa=(new z).e("org.nlogo.core.prim.etc._linkbreedsingular",p(function(){return function(db){return(new Gu).c(db)}}(this))),
ua=(new z).e("org.nlogo.core.prim.etc._linkneighbor",p(function(){return function(db){return(new Pu).c(db)}}(this))),Ka=(new z).e("org.nlogo.core.prim.etc._linkneighbors",p(function(){return function(db){return(new Qu).c(db)}}(this))),Da=(new z).e("org.nlogo.core.prim.etc._linkwith",p(function(){return function(db){return(new Ru).c(db)}}(this))),Ha=(new z).e("org.nlogo.core.prim.etc._myinlinks",p(function(){return function(db){return(new Su).c(db)}}(this))),kb=(new z).e("org.nlogo.core.prim.etc._mylinks",
p(function(){return function(db){return(new Tu).c(db)}}(this))),lb=(new z).e("org.nlogo.core.prim.etc._myoutlinks",p(function(){return function(db){return(new Uu).c(db)}}(this))),Tb=(new z).e("org.nlogo.core.prim.etc._outlinkneighbor",p(function(){return function(db){return(new Vu).c(db)}}(this))),Rb=(new z).e("org.nlogo.core.prim.etc._outlinkneighbors",p(function(){return function(db){return(new Wu).c(db)}}(this))),ad=(new z).e("org.nlogo.core.prim.etc._outlinkto",p(function(){return function(db){return(new Xu).c(db)}}(this))),
oc=(new z).e("org.nlogo.core.prim.etc._createlinkwith",p(function(){return function(db){return(new Eq).c(db)}}(this))),kd=(new z).e("org.nlogo.core.prim.etc._createlinkto",p(function(){return function(db){return(new Cq).c(db)}}(this))),Sc=(new z).e("org.nlogo.core.prim.etc._createlinkfrom",p(function(){return function(db){return(new zq).c(db)}}(this))),bd=(new z).e("org.nlogo.core.prim.etc._createlinkswith",p(function(){return function(db){return(new Fq).c(db)}}(this))),yc=(new z).e("org.nlogo.core.prim.etc._createlinksto",
p(function(){return function(db){return(new Dq).c(db)}}(this))),kc=[b,d,e,f,g,k,l,n,t,u,w,y,E,L,S,ia,na,pa,ua,Ka,Da,Ha,kb,lb,Tb,Rb,ad,oc,kd,Sc,bd,yc,(new z).e("org.nlogo.core.prim.etc._createlinksfrom",p(function(){return function(db){return(new Bq).c(db)}}(this)))];this.jH=Jg(a,(new M).q(kc));this.a=(1|this.a)<<24>>24;var Bd=Ke().Pk,Tc=(new z).e("!\x3d",J(function(){return function(){return(new sI).b()}}(this))),Af=(new z).e("*",J(function(){return function(){return(new tI).b()}}(this))),me=(new z).e("+",
J(function(){return function(){return(new uI).b()}}(this))),Ch=(new z).e("-",J(function(){return function(){return(new rm).b()}}(this))),Fe=(new z).e("/",J(function(){return function(){return(new vI).b()}}(this))),Zf=(new z).e("\x3c",J(function(){return function(){return(new wI).b()}}(this))),Cd=(new z).e("\x3c\x3d",J(function(){return function(){return(new xI).b()}}(this))),pc=(new z).e("\x3d",J(function(){return function(){return(new st).b()}}(this))),Fb=(new z).e("\x3e",J(function(){return function(){return(new yI).b()}}(this))),
cd=(new z).e("\x3e\x3d",J(function(){return function(){return(new zI).b()}}(this))),La=(new z).e("^",J(function(){return function(){return(new AI).b()}}(this))),gc=(new z).e("__APPLY-RESULT",J(function(){return function(){return(new BI).b()}}(this))),hc=(new z).e("__BOOM",J(function(){return function(){return(new CI).b()}}(this))),Ym=(new z).e("__BLOCK",J(function(){return function(){return(new DI).b()}}(this))),$g=(new z).e("__CHECK-SYNTAX",J(function(){return function(){return(new EI).b()}}(this))),
Zm=(new z).e("__CHECKSUM",J(function(){return function(){return(new FI).b()}}(this))),jl=(new z).e("__DUMP",J(function(){return function(){return(new GI).b()}}(this))),$m=(new z).e("__DUMP-EXTENSION-PRIMS",J(function(){return function(){return(new HI).b()}}(this))),an=(new z).e("__DUMP-EXTENSIONS",J(function(){return function(){return(new II).b()}}(this))),kl=(new z).e("__DUMP1",J(function(){return function(){return(new JI).b()}}(this))),bn=(new z).e("__NANO-TIME",J(function(){return function(){return(new KI).b()}}(this))),
ll=(new z).e("__PROCESSORS",J(function(){return function(){return(new LI).b()}}(this))),ml=(new z).e("__RANDOM-STATE",J(function(){return function(){return(new MI).b()}}(this))),nl=(new z).e("__REFERENCE",J(function(){return function(){return(new NI).b()}}(this))),cn=(new z).e("__STACK-TRACE",J(function(){return function(){return(new OI).b()}}(this))),ol=(new z).e("__SYMBOL",J(function(){return function(){return(new PI).b()}}(this))),dn=(new z).e("__TO-STRING",J(function(){return function(){return(new QI).b()}}(this))),
ei=(new z).e("ABS",J(function(){return function(){return(new RI).b()}}(this))),Yj=(new z).e("ACOS",J(function(){return function(){return(new SI).b()}}(this))),Ui=(new z).e("ALL?",J(function(){return function(){return(new bu).b()}}(this))),en=(new z).e("AND",J(function(){return function(){return(new $t).b()}}(this))),Vi=(new z).e("ANY?",J(function(){return function(){return(new TI).b()}}(this))),fn=(new z).e("APPROXIMATE-HSB",J(function(){return function(){return(new UI).b()}}(this))),Wi=(new z).e("APPROXIMATE-RGB",
J(function(){return function(){return(new VI).b()}}(this))),Zj=(new z).e("ASIN",J(function(){return function(){return(new WI).b()}}(this))),ak=(new z).e("AT-POINTS",J(function(){return function(){return(new XI).b()}}(this))),pl=(new z).e("ATAN",J(function(){return function(){return(new YI).b()}}(this))),Xi=(new z).e("AUTOPLOT?",J(function(){return function(){return(new ZI).b()}}(this))),gn=(new z).e("BASE-COLORS",J(function(){return function(){return(new $I).b()}}(this))),Yi=(new z).e("BEHAVIORSPACE-EXPERIMENT-NAME",
J(function(){return function(){return(new aJ).b()}}(this))),hn=(new z).e("BEHAVIORSPACE-RUN-NUMBER",J(function(){return function(){return(new bJ).b()}}(this))),ql=(new z).e("BF",J(function(){return function(){return(new Ku).b()}}(this))),jn=(new z).e("BL",J(function(){return function(){return(new Lu).b()}}(this))),rl=(new z).e("BOTH-ENDS",J(function(){return function(){return(new cJ).b()}}(this))),kn=(new z).e("BUT-FIRST",J(function(){return function(){return(new Ku).b()}}(this))),ln=(new z).e("BUT-LAST",
J(function(){return function(){return(new Lu).b()}}(this))),sl=(new z).e("BUTFIRST",J(function(){return function(){return(new Ku).b()}}(this))),mn=(new z).e("BUTLAST",J(function(){return function(){return(new Lu).b()}}(this))),tl=(new z).e("CAN-MOVE?",J(function(){return function(){return(new dJ).b()}}(this))),ul=(new z).e("CEILING",J(function(){return function(){return(new eJ).b()}}(this))),Cg=(new z).e("COS",J(function(){return function(){return(new fJ).b()}}(this))),ah=(new z).e("COUNT",J(function(){return function(){return(new gJ).b()}}(this))),
nn=(new z).e("DATE-AND-TIME",J(function(){return function(){return(new hJ).b()}}(this))),vl=(new z).e("DISTANCE",J(function(){return function(){return(new iJ).b()}}(this))),fi=(new z).e("DISTANCEXY",J(function(){return function(){return(new jJ).b()}}(this))),bk=(new z).e("DX",J(function(){return function(){return(new kJ).b()}}(this))),Zi=(new z).e("DY",J(function(){return function(){return(new lJ).b()}}(this))),wl=(new z).e("EMPTY?",J(function(){return function(){return(new mJ).b()}}(this))),bh=(new z).e("ERROR-MESSAGE",
J(function(){return function(){return(new Zt).b()}}(this))),ck=(new z).e("EXP",J(function(){return function(){return(new nJ).b()}}(this))),gi=(new z).e("EXTRACT-HSB",J(function(){return function(){return(new oJ).b()}}(this))),Dh=(new z).e("EXTRACT-RGB",J(function(){return function(){return(new pJ).b()}}(this))),$i=(new z).e("FILE-AT-END?",J(function(){return function(){return(new qJ).b()}}(this))),aj=(new z).e("FILE-EXISTS?",J(function(){return function(){return(new rJ).b()}}(this))),dk=(new z).e("FILE-READ",
J(function(){return function(){return(new sJ).b()}}(this))),Eh=(new z).e("FILE-READ-CHARACTERS",J(function(){return function(){return(new tJ).b()}}(this))),on=(new z).e("FILE-READ-LINE",J(function(){return function(){return(new uJ).b()}}(this))),ek=(new z).e("FILTER",J(function(){return function(){return(new vJ).b()}}(this))),fk=(new z).e("FIRST",J(function(){return function(){return(new wJ).b()}}(this))),nP=(new z).e("FLOOR",J(function(){return function(){return(new xJ).b()}}(this))),oP=(new z).e("FPUT",
J(function(){return function(){return(new yJ).b()}}(this))),pP=(new z).e("HSB",J(function(){return function(){return(new zJ).b()}}(this))),qP=(new z).e("HUBNET-CLIENTS-LIST",J(function(){return function(){return(new AJ).b()}}(this))),rP=(new z).e("HUBNET-ENTER-MESSAGE?",J(function(){return function(){return(new BJ).b()}}(this))),od=(new z).e("HUBNET-EXIT-MESSAGE?",J(function(){return function(){return(new CJ).b()}}(this))),$f=(new z).e("HUBNET-MESSAGE",J(function(){return function(){return(new DJ).b()}}(this))),
bj=(new z).e("HUBNET-MESSAGE-SOURCE",J(function(){return function(){return(new EJ).b()}}(this))),Fh=(new z).e("HUBNET-MESSAGE-TAG",J(function(){return function(){return(new FJ).b()}}(this))),pn=(new z).e("HUBNET-MESSAGE-WAITING?",J(function(){return function(){return(new GJ).b()}}(this))),vE=(new z).e("IFELSE-VALUE",J(function(){return function(){return(new Xt).b()}}(this))),a_=(new z).e("IN-CONE",J(function(){return function(){return(new HJ).b()}}(this))),b_=(new z).e("IN-LINK-FROM",J(function(){return function(){return(new Mu).b()}}(this))),
E7=(new z).e("IN-LINK-NEIGHBOR?",J(function(){return function(){return(new Nu).b()}}(this))),c_=(new z).e("IN-LINK-NEIGHBORS",J(function(){return function(){return(new Ou).b()}}(this))),tQ=(new z).e("IN-RADIUS",J(function(){return function(){return(new IJ).b()}}(this))),d_=(new z).e("INSERT-ITEM",J(function(){return function(){return(new JJ).b()}}(this))),e_=(new z).e("INT",J(function(){return function(){return(new KJ).b()}}(this))),F7=(new z).e("IS-AGENT?",J(function(){return function(){return(new LJ).b()}}(this))),
G7=(new z).e("IS-AGENTSET?",J(function(){return function(){return(new MJ).b()}}(this))),I7=(new z).e("IS-ANONYMOUS-COMMAND?",J(function(){return function(){return(new NJ).b()}}(this))),J7=(new z).e("IS-ANONYMOUS-REPORTER?",J(function(){return function(){return(new OJ).b()}}(this))),K7=(new z).e("IS-BOOLEAN?",J(function(){return function(){return(new PJ).b()}}(this))),L7=(new z).e("IS-DIRECTED-LINK?",J(function(){return function(){return(new QJ).b()}}(this))),M7=(new z).e("IS-LINK-SET?",J(function(){return function(){return(new RJ).b()}}(this))),
N7=(new z).e("IS-LINK?",J(function(){return function(){return(new SJ).b()}}(this))),O7=(new z).e("IS-LIST?",J(function(){return function(){return(new TJ).b()}}(this))),P7=(new z).e("IS-NUMBER?",J(function(){return function(){return(new UJ).b()}}(this))),f_=(new z).e("IS-PATCH-SET?",J(function(){return function(){return(new VJ).b()}}(this))),iz=(new z).e("IS-PATCH?",J(function(){return function(){return(new WJ).b()}}(this))),Q7=(new z).e("IS-STRING?",J(function(){return function(){return(new XJ).b()}}(this))),
uQ=(new z).e("IS-TURTLE-SET?",J(function(){return function(){return(new YJ).b()}}(this))),R7=(new z).e("IS-TURTLE?",J(function(){return function(){return(new ZJ).b()}}(this))),S7=(new z).e("IS-UNDIRECTED-LINK?",J(function(){return function(){return(new $J).b()}}(this))),T7=(new z).e("ITEM",J(function(){return function(){return(new aK).b()}}(this))),U7=(new z).e("LAST",J(function(){return function(){return(new bK).b()}}(this))),V7=(new z).e("LENGTH",J(function(){return function(){return(new cK).b()}}(this))),
W7=(new z).e("LINK",J(function(){return function(){return(new dK).b()}}(this))),X7=(new z).e("LINK-HEADING",J(function(){return function(){return(new eK).b()}}(this))),g_=(new z).e("LINK-LENGTH",J(function(){return function(){return(new fK).b()}}(this))),Y7=(new z).e("LINK-NEIGHBOR?",J(function(){return function(){return(new Pu).b()}}(this))),Z7=(new z).e("LINK-NEIGHBORS",J(function(){return function(){return(new Qu).b()}}(this))),$7=(new z).e("LINK-SET",J(function(){return function(){return(new gK).b()}}(this))),
vQ=(new z).e("LINK-SHAPES",J(function(){return function(){return(new hK).b()}}(this))),Qxa=(new z).e("LINK-WITH",J(function(){return function(){return(new Ru).b()}}(this))),Rxa=(new z).e("LINKS",J(function(){return function(){return(new iK).b()}}(this))),Sxa=(new z).e("LIST",J(function(){return function(){return(new jK).b()}}(this))),Txa=(new z).e("LN",J(function(){return function(){return(new kK).b()}}(this))),Uxa=(new z).e("LOG",J(function(){return function(){return(new lK).b()}}(this))),Vxa=(new z).e("LPUT",
J(function(){return function(){return(new mK).b()}}(this))),Wxa=(new z).e("MAP",J(function(){return function(){return(new nK).b()}}(this))),Xxa=(new z).e("MAX",J(function(){return function(){return(new oK).b()}}(this))),Yxa=(new z).e("MAX-N-OF",J(function(){return function(){return(new cu).b()}}(this))),Zxa=(new z).e("MAX-ONE-OF",J(function(){return function(){return(new du).b()}}(this))),$xa=(new z).e("MAX-PXCOR",J(function(){return function(){return(new pK).b()}}(this))),aya=(new z).e("MAX-PYCOR",
J(function(){return function(){return(new qK).b()}}(this))),bya=(new z).e("MEAN",J(function(){return function(){return(new rK).b()}}(this))),cya=(new z).e("MEDIAN",J(function(){return function(){return(new sK).b()}}(this))),dya=(new z).e("MEMBER?",J(function(){return function(){return(new tK).b()}}(this))),eya=(new z).e("MIN",J(function(){return function(){return(new uK).b()}}(this))),fya=(new z).e("MIN-N-OF",J(function(){return function(){return(new eu).b()}}(this))),gya=(new z).e("MIN-ONE-OF",J(function(){return function(){return(new fu).b()}}(this))),
hya=(new z).e("MIN-PXCOR",J(function(){return function(){return(new vK).b()}}(this))),iya=(new z).e("MIN-PYCOR",J(function(){return function(){return(new wK).b()}}(this))),jya=(new z).e("MOD",J(function(){return function(){return(new xK).b()}}(this))),kya=(new z).e("MODES",J(function(){return function(){return(new yK).b()}}(this))),lya=(new z).e("MOUSE-DOWN?",J(function(){return function(){return(new zK).b()}}(this))),mya=(new z).e("MOUSE-INSIDE?",J(function(){return function(){return(new AK).b()}}(this))),
nya=(new z).e("MOUSE-XCOR",J(function(){return function(){return(new BK).b()}}(this))),oya=(new z).e("MOUSE-YCOR",J(function(){return function(){return(new CK).b()}}(this))),pya=(new z).e("MY-IN-LINKS",J(function(){return function(){return(new Su).b()}}(this))),qya=(new z).e("MY-LINKS",J(function(){return function(){return(new Tu).b()}}(this))),rya=(new z).e("MY-OUT-LINKS",J(function(){return function(){return(new Uu).b()}}(this))),sya=(new z).e("MYSELF",J(function(){return function(){return(new DK).b()}}(this))),
tya=(new z).e("N-OF",J(function(){return function(){return(new EK).b()}}(this))),uya=(new z).e("N-VALUES",J(function(){return function(){return(new Yt).b()}}(this))),vya=(new z).e("NEIGHBORS",J(function(){return function(){return(new FK).b()}}(this))),wya=(new z).e("NEIGHBORS4",J(function(){return function(){return(new GK).b()}}(this))),xya=(new z).e("NETLOGO-APPLET?",J(function(){return function(){return(new HK).b()}}(this))),yya=(new z).e("NETLOGO-VERSION",J(function(){return function(){return(new IK).b()}}(this))),
zya=(new z).e("NETLOGO-WEB?",J(function(){return function(){return(new JK).b()}}(this))),Aya=(new z).e("NEW-SEED",J(function(){return function(){return(new KK).b()}}(this))),Bya=(new z).e("NO-LINKS",J(function(){return function(){return(new LK).b()}}(this))),Cya=(new z).e("NO-PATCHES",J(function(){return function(){return(new MK).b()}}(this))),Dya=(new z).e("NO-TURTLES",J(function(){return function(){return(new NK).b()}}(this))),Eya=(new z).e("NOT",J(function(){return function(){return(new OK).b()}}(this))),
Fya=(new z).e("OF",J(function(){return function(){return(new gu).b()}}(this))),Gya=(new z).e("ONE-OF",J(function(){return function(){return(new PK).b()}}(this))),Hya=(new z).e("OR",J(function(){return function(){return(new au).b()}}(this))),Iya=(new z).e("OTHER",J(function(){return function(){return(new QK).b()}}(this))),Jya=(new z).e("OTHER-END",J(function(){return function(){return(new RK).b()}}(this))),Kya=(new z).e("OUT-LINK-NEIGHBOR?",J(function(){return function(){return(new Vu).b()}}(this))),
Lya=(new z).e("OUT-LINK-NEIGHBORS",J(function(){return function(){return(new Wu).b()}}(this))),Mya=(new z).e("OUT-LINK-TO",J(function(){return function(){return(new Xu).b()}}(this))),Nya=(new z).e("PATCH",J(function(){return function(){return(new SK).b()}}(this))),Oya=(new z).e("PATCH-AHEAD",J(function(){return function(){return(new TK).b()}}(this))),Pya=(new z).e("PATCH-AT",J(function(){return function(){return(new UK).b()}}(this))),Qya=(new z).e("PATCH-AT-HEADING-AND-DISTANCE",J(function(){return function(){return(new VK).b()}}(this))),
Rya=(new z).e("PATCH-HERE",J(function(){return function(){return(new WK).b()}}(this))),Sya=(new z).e("PATCH-LEFT-AND-AHEAD",J(function(){return function(){return(new XK).b()}}(this))),Tya=(new z).e("PATCH-RIGHT-AND-AHEAD",J(function(){return function(){return(new YK).b()}}(this))),Uya=(new z).e("PATCH-SET",J(function(){return function(){return(new ZK).b()}}(this))),Vya=(new z).e("PATCH-SIZE",J(function(){return function(){return(new $K).b()}}(this))),Wya=(new z).e("PATCHES",J(function(){return function(){return(new aL).b()}}(this))),
Xya=(new z).e("PLOT-NAME",J(function(){return function(){return(new bL).b()}}(this))),Yya=(new z).e("PLOT-PEN-EXISTS?",J(function(){return function(){return(new cL).b()}}(this))),Zya=(new z).e("PLOT-X-MAX",J(function(){return function(){return(new dL).b()}}(this))),$ya=(new z).e("PLOT-X-MIN",J(function(){return function(){return(new eL).b()}}(this))),aza=(new z).e("PLOT-Y-MAX",J(function(){return function(){return(new fL).b()}}(this))),bza=(new z).e("PLOT-Y-MIN",J(function(){return function(){return(new gL).b()}}(this))),
cza=(new z).e("POSITION",J(function(){return function(){return(new hL).b()}}(this))),dza=(new z).e("PRECISION",J(function(){return function(){return(new iL).b()}}(this))),eza=(new z).e("RANDOM",J(function(){return function(){return(new jL).b()}}(this))),fza=(new z).e("RANDOM-EXPONENTIAL",J(function(){return function(){return(new kL).b()}}(this))),gza=(new z).e("RANDOM-FLOAT",J(function(){return function(){return(new lL).b()}}(this))),hza=(new z).e("RANDOM-GAMMA",J(function(){return function(){return(new mL).b()}}(this))),
iza=(new z).e("RANDOM-NORMAL",J(function(){return function(){return(new nL).b()}}(this))),jza=(new z).e("RANDOM-POISSON",J(function(){return function(){return(new oL).b()}}(this))),kza=(new z).e("RANDOM-PXCOR",J(function(){return function(){return(new pL).b()}}(this))),lza=(new z).e("RANDOM-PYCOR",J(function(){return function(){return(new qL).b()}}(this))),mza=(new z).e("RANDOM-XCOR",J(function(){return function(){return(new rL).b()}}(this))),nza=(new z).e("RANDOM-YCOR",J(function(){return function(){return(new sL).b()}}(this))),
oza=(new z).e("RANGE",J(function(){return function(){return(new $u).b()}}(this))),pza=(new z).e("READ-FROM-STRING",J(function(){return function(){return(new tL).b()}}(this))),qza=(new z).e("REDUCE",J(function(){return function(){return(new uL).b()}}(this))),rza=(new z).e("REMAINDER",J(function(){return function(){return(new vL).b()}}(this))),sza=(new z).e("REMOVE",J(function(){return function(){return(new wL).b()}}(this))),tza=(new z).e("REMOVE-DUPLICATES",J(function(){return function(){return(new xL).b()}}(this))),
uza=(new z).e("REMOVE-ITEM",J(function(){return function(){return(new yL).b()}}(this))),vza=(new z).e("REPLACE-ITEM",J(function(){return function(){return(new zL).b()}}(this))),wza=(new z).e("REVERSE",J(function(){return function(){return(new AL).b()}}(this))),xza=(new z).e("RGB",J(function(){return function(){return(new BL).b()}}(this))),yza=(new z).e("ROUND",J(function(){return function(){return(new CL).b()}}(this))),zza=(new z).e("RUN-RESULT",J(function(){return function(){return(new Yu).b()}}(this))),
Aza=(new z).e("RUNRESULT",J(function(){return function(){return(new Yu).b()}}(this))),Bza=(new z).e("SCALE-COLOR",J(function(){return function(){return(new DL).b()}}(this))),Cza=(new z).e("SE",J(function(){return function(){return(new EL).b()}}(this))),Dza=(new z).e("SELF",J(function(){return function(){return(new FL).b()}}(this))),Eza=(new z).e("SENTENCE",J(function(){return function(){return(new EL).b()}}(this))),Fza=(new z).e("SHADE-OF?",J(function(){return function(){return(new GL).b()}}(this))),
Gza=(new z).e("SHAPES",J(function(){return function(){return(new HL).b()}}(this))),Hza=(new z).e("SHUFFLE",J(function(){return function(){return(new IL).b()}}(this))),Iza=(new z).e("SIN",J(function(){return function(){return(new JL).b()}}(this))),Jza=(new z).e("SORT",J(function(){return function(){return(new KL).b()}}(this))),Kza=(new z).e("SORT-BY",J(function(){return function(){return(new LL).b()}}(this))),Lza=(new z).e("SORT-ON",J(function(){return function(){return(new hu).b()}}(this))),Mza=(new z).e("SQRT",
J(function(){return function(){return(new ML).b()}}(this))),Nza=(new z).e("STANDARD-DEVIATION",J(function(){return function(){return(new NL).b()}}(this))),Oza=(new z).e("SUBJECT",J(function(){return function(){return(new OL).b()}}(this))),Pza=(new z).e("SUBLIST",J(function(){return function(){return(new PL).b()}}(this))),Qza=(new z).e("SUBSTRING",J(function(){return function(){return(new QL).b()}}(this))),Rza=(new z).e("SUBTRACT-HEADINGS",J(function(){return function(){return(new RL).b()}}(this))),
Sza=(new z).e("SUM",J(function(){return function(){return(new SL).b()}}(this))),Tza=(new z).e("TAN",J(function(){return function(){return(new TL).b()}}(this))),Uza=(new z).e("TICKS",J(function(){return function(){return(new UL).b()}}(this))),Vza=(new z).e("TIMER",J(function(){return function(){return(new VL).b()}}(this))),Wza=(new z).e("TOWARDS",J(function(){return function(){return(new WL).b()}}(this))),Xza=(new z).e("TOWARDSXY",J(function(){return function(){return(new XL).b()}}(this))),Yza=(new z).e("TURTLE",
J(function(){return function(){return(new YL).b()}}(this))),Zza=(new z).e("TURTLE-SET",J(function(){return function(){return(new ZL).b()}}(this))),$za=(new z).e("TURTLES",J(function(){return function(){return(new $L).b()}}(this))),aAa=(new z).e("TURTLES-AT",J(function(){return function(){return(new aM).b()}}(this))),bAa=(new z).e("TURTLES-HERE",J(function(){return function(){return(new bM).b()}}(this))),cAa=(new z).e("TURTLES-ON",J(function(){return function(){return(new cM).b()}}(this))),dAa=(new z).e("UP-TO-N-OF",
J(function(){return function(){return(new dM).b()}}(this))),eAa=(new z).e("USER-DIRECTORY",J(function(){return function(){return(new eM).b()}}(this))),fAa=(new z).e("USER-FILE",J(function(){return function(){return(new fM).b()}}(this))),gAa=(new z).e("USER-INPUT",J(function(){return function(){return(new gM).b()}}(this))),hAa=(new z).e("USER-NEW-FILE",J(function(){return function(){return(new hM).b()}}(this))),iAa=(new z).e("USER-ONE-OF",J(function(){return function(){return(new iM).b()}}(this))),
jAa=(new z).e("USER-YES-OR-NO?",J(function(){return function(){return(new jM).b()}}(this))),kAa=(new z).e("VARIANCE",J(function(){return function(){return(new kM).b()}}(this))),lAa=(new z).e("WITH",J(function(){return function(){return(new iu).b()}}(this))),mAa=(new z).e("WITH-MAX",J(function(){return function(){return(new ju).b()}}(this))),nAa=(new z).e("WITH-MIN",J(function(){return function(){return(new ku).b()}}(this))),oAa=(new z).e("WORD",J(function(){return function(){return(new Wt).b()}}(this))),
pAa=(new z).e("WORLD-HEIGHT",J(function(){return function(){return(new lM).b()}}(this))),qAa=(new z).e("WORLD-WIDTH",J(function(){return function(){return(new mM).b()}}(this))),rAa=(new z).e("WRAP-COLOR",J(function(){return function(){return(new nM).b()}}(this))),sAa=[Tc,Af,me,Ch,Fe,Zf,Cd,pc,Fb,cd,La,gc,hc,Ym,$g,Zm,jl,$m,an,kl,bn,ll,ml,nl,cn,ol,dn,ei,Yj,Ui,en,Vi,fn,Wi,Zj,ak,pl,Xi,gn,Yi,hn,ql,jn,rl,kn,ln,sl,mn,tl,ul,Cg,ah,nn,vl,fi,bk,Zi,wl,bh,ck,gi,Dh,$i,aj,dk,Eh,on,ek,fk,nP,oP,pP,qP,rP,od,$f,bj,Fh,
pn,vE,a_,b_,E7,c_,tQ,d_,e_,F7,G7,I7,J7,K7,L7,M7,N7,O7,P7,f_,iz,Q7,uQ,R7,S7,T7,U7,V7,W7,X7,g_,Y7,Z7,$7,vQ,Qxa,Rxa,Sxa,Txa,Uxa,Vxa,Wxa,Xxa,Yxa,Zxa,$xa,aya,bya,cya,dya,eya,fya,gya,hya,iya,jya,kya,lya,mya,nya,oya,pya,qya,rya,sya,tya,uya,vya,wya,xya,yya,zya,Aya,Bya,Cya,Dya,Eya,Fya,Gya,Hya,Iya,Jya,Kya,Lya,Mya,Nya,Oya,Pya,Qya,Rya,Sya,Tya,Uya,Vya,Wya,Xya,Yya,Zya,$ya,aza,bza,cza,dza,eza,fza,gza,hza,iza,jza,kza,lza,mza,nza,oza,pza,qza,rza,sza,tza,uza,vza,wza,xza,yza,zza,Aza,Bza,Cza,Dza,Eza,Fza,Gza,Hza,Iza,
Jza,Kza,Lza,Mza,Nza,Oza,Pza,Qza,Rza,Sza,Tza,Uza,Vza,Wza,Xza,Yza,Zza,$za,aAa,bAa,cAa,dAa,eAa,fAa,gAa,hAa,iAa,jAa,kAa,lAa,mAa,nAa,oAa,pAa,qAa,rAa,(new z).e("XOR",J(function(){return function(){return(new oM).b()}}(this)))];this.Dk=Jg(Bd,(new M).q(sAa));this.a=(2|this.a)<<24>>24;var tAa=Ke().Pk,uAa=(new z).e("__APPLY",J(function(){return function(){return(new pM).b()}}(this))),vAa=(new z).e("__BENCH",J(function(){return function(){return(new qM).b()}}(this))),wAa=(new z).e("__CHANGE-TOPOLOGY",J(function(){return function(){return(new rM).b()}}(this))),
xAa=(new z).e("__DONE",J(function(){return function(){return(new sM).b()}}(this))),yAa=(new z).e("__EXPERIMENTSTEPEND",J(function(){return function(){return(new tM).b()}}(this))),zAa=(new z).e("__EXPORT-DRAWING",J(function(){return function(){return(new uM).b()}}(this))),AAa=(new z).e("__FOREVERBUTTONEND",J(function(){return function(){return(new vM).b()}}(this))),BAa=(new z).e("__IGNORE",J(function(){return function(){return(new $q).b()}}(this))),CAa=(new z).e("__LET",J(function(){return function(){return(new rn).b()}}(this))),
DAa=(new z).e("__LINKCODE",J(function(){return function(){return(new wM).b()}}(this))),EAa=(new z).e("__MKDIR",J(function(){return function(){return(new xM).b()}}(this))),FAa=(new z).e("__OBSERVERCODE",J(function(){return function(){return(new yM).b()}}(this))),GAa=(new z).e("__PATCHCODE",J(function(){return function(){return(new zM).b()}}(this))),HAa=(new z).e("__PLOT-PEN-HIDE",J(function(){return function(){return(new AM).b()}}(this))),IAa=(new z).e("__PLOT-PEN-SHOW",J(function(){return function(){return(new BM).b()}}(this))),
JAa=(new z).e("__PWD",J(function(){return function(){return(new CM).b()}}(this))),KAa=(new z).e("__RELOAD-EXTENSIONS",J(function(){return function(){return(new DM).b()}}(this))),LAa=(new z).e("__SET-LINE-THICKNESS",J(function(){return function(){return(new EM).b()}}(this))),MAa=(new z).e("__STDERR",J(function(){return function(){return(new FM).b()}}(this))),NAa=(new z).e("__STDOUT",J(function(){return function(){return(new GM).b()}}(this))),OAa=(new z).e("__THUNK-DID-FINISH",J(function(){return function(){return(new HM).b()}}(this))),
PAa=(new z).e("__TURTLECODE",J(function(){return function(){return(new IM).b()}}(this))),QAa=(new z).e("ASK",J(function(){return function(){return(new pq).b()}}(this))),RAa=(new z).e("ASK-CONCURRENT",J(function(){return function(){return(new JM).b()}}(this))),SAa=(new z).e("AUTO-PLOT-OFF",J(function(){return function(){return(new KM).b()}}(this))),TAa=(new z).e("AUTO-PLOT-ON",J(function(){return function(){return(new LM).b()}}(this))),UAa=(new z).e("BACK",J(function(){return function(){return(new Mq).b()}}(this))),
VAa=(new z).e("BEEP",J(function(){return function(){return(new MM).b()}}(this))),WAa=(new z).e("BK",J(function(){return function(){return(new Mq).b()}}(this))),XAa=(new z).e("CA",J(function(){return function(){return(new NM).b()}}(this))),YAa=(new z).e("CAREFULLY",J(function(){return function(){return(new sq).b()}}(this))),ZAa=(new z).e("CD",J(function(){return function(){return(new OM).b()}}(this))),$Aa=(new z).e("CLEAR-ALL",J(function(){return function(){return(new NM).b()}}(this))),aBa=(new z).e("CLEAR-ALL-PLOTS",
J(function(){return function(){return(new PM).b()}}(this))),bBa=(new z).e("CLEAR-DRAWING",J(function(){return function(){return(new OM).b()}}(this))),cBa=(new z).e("CLEAR-GLOBALS",J(function(){return function(){return(new QM).b()}}(this))),dBa=(new z).e("CLEAR-LINKS",J(function(){return function(){return(new RM).b()}}(this))),eBa=(new z).e("CLEAR-OUTPUT",J(function(){return function(){return(new SM).b()}}(this))),fBa=(new z).e("CLEAR-PATCHES",J(function(){return function(){return(new TM).b()}}(this))),
gBa=(new z).e("CLEAR-PLOT",J(function(){return function(){return(new UM).b()}}(this))),hBa=(new z).e("CLEAR-TICKS",J(function(){return function(){return(new VM).b()}}(this))),iBa=(new z).e("CLEAR-TURTLES",J(function(){return function(){return(new WM).b()}}(this))),jBa=(new z).e("CP",J(function(){return function(){return(new TM).b()}}(this))),kBa=(new z).e("CREATE-LINK-FROM",J(function(){return function(){return(new zq).b()}}(this))),lBa=(new z).e("CREATE-LINK-TO",J(function(){return function(){return(new Cq).b()}}(this))),
mBa=(new z).e("CREATE-LINK-WITH",J(function(){return function(){return(new Eq).b()}}(this))),nBa=(new z).e("CREATE-LINKS-FROM",J(function(){return function(){return(new Bq).b()}}(this))),oBa=(new z).e("CREATE-LINKS-TO",J(function(){return function(){return(new Dq).b()}}(this))),pBa=(new z).e("CREATE-LINKS-WITH",J(function(){return function(){return(new Fq).b()}}(this))),qBa=(new z).e("CREATE-ORDERED-TURTLES",J(function(){return function(){return(new uq).b()}}(this))),rBa=(new z).e("CREATE-TEMPORARY-PLOT-PEN",
J(function(){return function(){return(new XM).b()}}(this))),sBa=(new z).e("CREATE-TURTLES",J(function(){return function(){return(new tq).b()}}(this))),tBa=(new z).e("CRO",J(function(){return function(){return(new uq).b()}}(this))),uBa=(new z).e("CRT",J(function(){return function(){return(new tq).b()}}(this))),vBa=(new z).e("CT",J(function(){return function(){return(new WM).b()}}(this))),wBa=(new z).e("DIE",J(function(){return function(){return(new YM).b()}}(this))),xBa=(new z).e("DIFFUSE",J(function(){return function(){return(new Oq).b()}}(this))),
yBa=(new z).e("DIFFUSE4",J(function(){return function(){return(new Qq).b()}}(this))),zBa=(new z).e("DISPLAY",J(function(){return function(){return(new ZM).b()}}(this))),ABa=(new z).e("DOWNHILL",J(function(){return function(){return(new Tq).b()}}(this))),BBa=(new z).e("DOWNHILL4",J(function(){return function(){return(new Uq).b()}}(this))),CBa=(new z).e("ERROR",J(function(){return function(){return(new Iq).b()}}(this))),DBa=(new z).e("EVERY",J(function(){return function(){return(new Gq).b()}}(this))),
EBa=(new z).e("EXPORT-ALL-PLOTS",J(function(){return function(){return(new $M).b()}}(this))),FBa=(new z).e("EXPORT-INTERFACE",J(function(){return function(){return(new aN).b()}}(this))),GBa=(new z).e("EXPORT-OUTPUT",J(function(){return function(){return(new bN).b()}}(this))),HBa=(new z).e("EXPORT-PLOT",J(function(){return function(){return(new cN).b()}}(this))),IBa=(new z).e("EXPORT-VIEW",J(function(){return function(){return(new dN).b()}}(this))),JBa=(new z).e("EXPORT-WORLD",J(function(){return function(){return(new eN).b()}}(this))),
KBa=(new z).e("FACE",J(function(){return function(){return(new fN).b()}}(this))),LBa=(new z).e("FACEXY",J(function(){return function(){return(new gN).b()}}(this))),MBa=(new z).e("FD",J(function(){return function(){return(new hN).b()}}(this))),NBa=(new z).e("FILE-CLOSE",J(function(){return function(){return(new iN).b()}}(this))),OBa=(new z).e("FILE-CLOSE-ALL",J(function(){return function(){return(new jN).b()}}(this))),PBa=(new z).e("FILE-DELETE",J(function(){return function(){return(new kN).b()}}(this))),
QBa=(new z).e("FILE-FLUSH",J(function(){return function(){return(new lN).b()}}(this))),RBa=(new z).e("FILE-OPEN",J(function(){return function(){return(new mN).b()}}(this))),SBa=(new z).e("FILE-PRINT",J(function(){return function(){return(new nN).b()}}(this))),TBa=(new z).e("FILE-SHOW",J(function(){return function(){return(new oN).b()}}(this))),UBa=(new z).e("FILE-TYPE",J(function(){return function(){return(new pN).b()}}(this))),VBa=(new z).e("FILE-WRITE",J(function(){return function(){return(new qN).b()}}(this))),
WBa=(new z).e("FOLLOW",J(function(){return function(){return(new rN).b()}}(this))),XBa=(new z).e("FOLLOW-ME",J(function(){return function(){return(new sN).b()}}(this))),YBa=(new z).e("FOREACH",J(function(){return function(){return(new dr).b()}}(this))),ZBa=(new z).e("FORWARD",J(function(){return function(){return(new hN).b()}}(this))),$Ba=(new z).e("HATCH",J(function(){return function(){return(new Kq).b()}}(this))),aCa=(new z).e("HIDE-LINK",J(function(){return function(){return(new Wq).b()}}(this))),
bCa=(new z).e("HIDE-TURTLE",J(function(){return function(){return(new tN).b()}}(this))),cCa=(new z).e("HISTOGRAM",J(function(){return function(){return(new uN).b()}}(this))),dCa=(new z).e("HOME",J(function(){return function(){return(new vN).b()}}(this))),eCa=(new z).e("HT",J(function(){return function(){return(new tN).b()}}(this))),fCa=(new z).e("HUBNET-BROADCAST",J(function(){return function(){return(new wN).b()}}(this))),gCa=(new z).e("HUBNET-BROADCAST-CLEAR-OUTPUT",J(function(){return function(){return(new xN).b()}}(this))),
hCa=(new z).e("HUBNET-BROADCAST-MESSAGE",J(function(){return function(){return(new yN).b()}}(this))),iCa=(new z).e("HUBNET-CLEAR-OVERRIDE",J(function(){return function(){return(new zN).b()}}(this))),jCa=(new z).e("HUBNET-CLEAR-OVERRIDES",J(function(){return function(){return(new AN).b()}}(this))),kCa=(new z).e("HUBNET-FETCH-MESSAGE",J(function(){return function(){return(new BN).b()}}(this))),lCa=(new z).e("HUBNET-KICK-ALL-CLIENTS",J(function(){return function(){return(new CN).b()}}(this))),mCa=(new z).e("HUBNET-KICK-CLIENT",
J(function(){return function(){return(new DN).b()}}(this))),nCa=(new z).e("HUBNET-RESET",J(function(){return function(){return(new EN).b()}}(this))),oCa=(new z).e("HUBNET-RESET-PERSPECTIVE",J(function(){return function(){return(new FN).b()}}(this))),pCa=(new z).e("HUBNET-SEND",J(function(){return function(){return(new GN).b()}}(this))),qCa=(new z).e("HUBNET-SEND-CLEAR-OUTPUT",J(function(){return function(){return(new HN).b()}}(this))),rCa=(new z).e("HUBNET-SEND-FOLLOW",J(function(){return function(){return(new IN).b()}}(this))),
sCa=(new z).e("HUBNET-SEND-MESSAGE",J(function(){return function(){return(new JN).b()}}(this))),tCa=(new z).e("HUBNET-SEND-OVERRIDE",J(function(){return function(){return(new KN).b()}}(this))),uCa=(new z).e("HUBNET-SEND-WATCH",J(function(){return function(){return(new LN).b()}}(this))),vCa=(new z).e("IF",J(function(){return function(){return(new nq).b()}}(this))),wCa=(new z).e("IF-ELSE",J(function(){return function(){return(new oq).b()}}(this))),xCa=(new z).e("IFELSE",J(function(){return function(){return(new oq).b()}}(this))),
yCa=(new z).e("IMPORT-DRAWING",J(function(){return function(){return(new MN).b()}}(this))),zCa=(new z).e("IMPORT-PCOLORS",J(function(){return function(){return(new NN).b()}}(this))),ACa=(new z).e("IMPORT-PCOLORS-RGB",J(function(){return function(){return(new ON).b()}}(this))),BCa=(new z).e("IMPORT-WORLD",J(function(){return function(){return(new PN).b()}}(this))),CCa=(new z).e("INSPECT",J(function(){return function(){return(new QN).b()}}(this))),DCa=(new z).e("JUMP",J(function(){return function(){return(new RN).b()}}(this))),
ECa=(new z).e("LAYOUT-CIRCLE",J(function(){return function(){return(new SN).b()}}(this))),FCa=(new z).e("LAYOUT-RADIAL",J(function(){return function(){return(new TN).b()}}(this))),GCa=(new z).e("LAYOUT-SPRING",J(function(){return function(){return(new UN).b()}}(this))),HCa=(new z).e("LAYOUT-TUTTE",J(function(){return function(){return(new VN).b()}}(this))),ICa=(new z).e("LEFT",J(function(){return function(){return(new Nq).b()}}(this))),JCa=(new z).e("LET",J(function(){return function(){return(new rn).b()}}(this))),
KCa=(new z).e("LOOP",J(function(){return function(){return(new gq).b()}}(this))),LCa=(new z).e("LT",J(function(){return function(){return(new Nq).b()}}(this))),MCa=(new z).e("MOVE-TO",J(function(){return function(){return(new WN).b()}}(this))),NCa=(new z).e("NO-DISPLAY",J(function(){return function(){return(new XN).b()}}(this))),OCa=(new z).e("OUTPUT-PRINT",J(function(){return function(){return(new YN).b()}}(this))),PCa=(new z).e("OUTPUT-SHOW",J(function(){return function(){return(new ZN).b()}}(this))),
QCa=(new z).e("OUTPUT-TYPE",J(function(){return function(){return(new $N).b()}}(this))),RCa=(new z).e("OUTPUT-WRITE",J(function(){return function(){return(new aO).b()}}(this))),SCa=(new z).e("PD",J(function(){return function(){return(new bO).b()}}(this))),TCa=(new z).e("PE",J(function(){return function(){return(new cO).b()}}(this))),UCa=(new z).e("PEN-DOWN",J(function(){return function(){return(new bO).b()}}(this))),VCa=(new z).e("PEN-ERASE",J(function(){return function(){return(new cO).b()}}(this))),
WCa=(new z).e("PEN-UP",J(function(){return function(){return(new dO).b()}}(this))),XCa=(new z).e("PENDOWN",J(function(){return function(){return(new bO).b()}}(this))),YCa=(new z).e("PENUP",J(function(){return function(){return(new dO).b()}}(this))),ZCa=(new z).e("PLOT",J(function(){return function(){return(new eO).b()}}(this))),$Ca=(new z).e("PLOT-PEN-DOWN",J(function(){return function(){return(new fO).b()}}(this))),aDa=(new z).e("PLOT-PEN-RESET",J(function(){return function(){return(new gO).b()}}(this))),
bDa=(new z).e("PLOT-PEN-UP",J(function(){return function(){return(new hO).b()}}(this))),cDa=(new z).e("PLOTXY",J(function(){return function(){return(new iO).b()}}(this))),dDa=(new z).e("PRINT",J(function(){return function(){return(new jO).b()}}(this))),eDa=(new z).e("PU",J(function(){return function(){return(new dO).b()}}(this))),fDa=(new z).e("RANDOM-SEED",J(function(){return function(){return(new kO).b()}}(this))),gDa=(new z).e("REPEAT",J(function(){return function(){return(new kq).b()}}(this))),
hDa=(new z).e("REPORT",J(function(){return function(){return(new Zq).b()}}(this))),iDa=(new z).e("RESET-PERSPECTIVE",J(function(){return function(){return(new lO).b()}}(this))),jDa=(new z).e("RESET-TICKS",J(function(){return function(){return(new mO).b()}}(this))),kDa=(new z).e("RESET-TIMER",J(function(){return function(){return(new nO).b()}}(this))),lDa=(new z).e("RESIZE-WORLD",J(function(){return function(){return(new oO).b()}}(this))),mDa=(new z).e("RIDE",J(function(){return function(){return(new pO).b()}}(this))),
nDa=(new z).e("RIDE-ME",J(function(){return function(){return(new qO).b()}}(this))),oDa=(new z).e("RIGHT",J(function(){return function(){return(new rO).b()}}(this))),pDa=(new z).e("RP",J(function(){return function(){return(new lO).b()}}(this))),qDa=(new z).e("RT",J(function(){return function(){return(new rO).b()}}(this))),rDa=(new z).e("RUN",J(function(){return function(){return(new br).b()}}(this))),sDa=(new z).e("SET",J(function(){return function(){return(new bq).b()}}(this))),tDa=(new z).e("SET-CURRENT-DIRECTORY",
J(function(){return function(){return(new sO).b()}}(this))),uDa=(new z).e("SET-CURRENT-PLOT",J(function(){return function(){return(new tO).b()}}(this))),vDa=(new z).e("SET-CURRENT-PLOT-PEN",J(function(){return function(){return(new uO).b()}}(this))),wDa=(new z).e("SET-DEFAULT-SHAPE",J(function(){return function(){return(new Vq).b()}}(this))),xDa=(new z).e("SET-HISTOGRAM-NUM-BARS",J(function(){return function(){return(new vO).b()}}(this))),yDa=(new z).e("SET-PATCH-SIZE",J(function(){return function(){return(new wO).b()}}(this))),
zDa=(new z).e("SET-PLOT-PEN-COLOR",J(function(){return function(){return(new xO).b()}}(this))),ADa=(new z).e("SET-PLOT-PEN-INTERVAL",J(function(){return function(){return(new yO).b()}}(this))),BDa=(new z).e("SET-PLOT-PEN-MODE",J(function(){return function(){return(new zO).b()}}(this))),CDa=(new z).e("SET-PLOT-X-RANGE",J(function(){return function(){return(new AO).b()}}(this))),DDa=(new z).e("SET-PLOT-Y-RANGE",J(function(){return function(){return(new BO).b()}}(this))),EDa=(new z).e("SETUP-PLOTS",
J(function(){return function(){return(new CO).b()}}(this))),FDa=(new z).e("SETXY",J(function(){return function(){return(new DO).b()}}(this))),GDa=(new z).e("SHOW",J(function(){return function(){return(new EO).b()}}(this))),HDa=(new z).e("SHOW-LINK",J(function(){return function(){return(new Xq).b()}}(this))),IDa=(new z).e("SHOW-TURTLE",J(function(){return function(){return(new FO).b()}}(this))),JDa=(new z).e("SPROUT",J(function(){return function(){return(new xq).b()}}(this))),KDa=(new z).e("ST",J(function(){return function(){return(new FO).b()}}(this))),
LDa=(new z).e("STAMP",J(function(){return function(){return(new GO).b()}}(this))),MDa=(new z).e("STAMP-ERASE",J(function(){return function(){return(new HO).b()}}(this))),NDa=(new z).e("STOP",J(function(){return function(){return(new IO).b()}}(this))),ODa=(new z).e("STOP-INSPECTING",J(function(){return function(){return(new JO).b()}}(this))),PDa=(new z).e("STOP-INSPECTING-DEAD-AGENTS",J(function(){return function(){return(new KO).b()}}(this))),QDa=(new z).e("TICK",J(function(){return function(){return(new LO).b()}}(this))),
RDa=(new z).e("TICK-ADVANCE",J(function(){return function(){return(new MO).b()}}(this))),SDa=(new z).e("TIE",J(function(){return function(){return(new NO).b()}}(this))),TDa=(new z).e("TYPE",J(function(){return function(){return(new OO).b()}}(this))),UDa=(new z).e("UNTIE",J(function(){return function(){return(new PO).b()}}(this))),VDa=(new z).e("UPDATE-PLOTS",J(function(){return function(){return(new QO).b()}}(this))),WDa=(new z).e("UPHILL",J(function(){return function(){return(new Rq).b()}}(this))),
XDa=(new z).e("UPHILL4",J(function(){return function(){return(new Sq).b()}}(this))),YDa=(new z).e("USER-MESSAGE",J(function(){return function(){return(new RO).b()}}(this))),ZDa=(new z).e("WAIT",J(function(){return function(){return(new SO).b()}}(this))),$Da=(new z).e("WATCH",J(function(){return function(){return(new TO).b()}}(this))),aEa=(new z).e("WATCH-ME",J(function(){return function(){return(new UO).b()}}(this))),bEa=(new z).e("WHILE",J(function(){return function(){return(new mq).b()}}(this))),
cEa=(new z).e("WITH-LOCAL-RANDOMNESS",J(function(){return function(){return(new ar).b()}}(this))),dEa=(new z).e("WITHOUT-INTERRUPTION",J(function(){return function(){return(new VO).b()}}(this))),eEa=[uAa,vAa,wAa,xAa,yAa,zAa,AAa,BAa,CAa,DAa,EAa,FAa,GAa,HAa,IAa,JAa,KAa,LAa,MAa,NAa,OAa,PAa,QAa,RAa,SAa,TAa,UAa,VAa,WAa,XAa,YAa,ZAa,$Aa,aBa,bBa,cBa,dBa,eBa,fBa,gBa,hBa,iBa,jBa,kBa,lBa,mBa,nBa,oBa,pBa,qBa,rBa,sBa,tBa,uBa,vBa,wBa,xBa,yBa,zBa,ABa,BBa,CBa,DBa,EBa,FBa,GBa,HBa,IBa,JBa,KBa,LBa,MBa,NBa,OBa,PBa,QBa,
RBa,SBa,TBa,UBa,VBa,WBa,XBa,YBa,ZBa,$Ba,aCa,bCa,cCa,dCa,eCa,fCa,gCa,hCa,iCa,jCa,kCa,lCa,mCa,nCa,oCa,pCa,qCa,rCa,sCa,tCa,uCa,vCa,wCa,xCa,yCa,zCa,ACa,BCa,CCa,DCa,ECa,FCa,GCa,HCa,ICa,JCa,KCa,LCa,MCa,NCa,OCa,PCa,QCa,RCa,SCa,TCa,UCa,VCa,WCa,XCa,YCa,ZCa,$Ca,aDa,bDa,cDa,dDa,eDa,fDa,gDa,hDa,iDa,jDa,kDa,lDa,mDa,nDa,oDa,pDa,qDa,rDa,sDa,tDa,uDa,vDa,wDa,xDa,yDa,zDa,ADa,BDa,CDa,DDa,EDa,FDa,GDa,HDa,IDa,JDa,KDa,LDa,MDa,NDa,ODa,PDa,QDa,RDa,SDa,TDa,UDa,VDa,WDa,XDa,YDa,ZDa,$Da,aEa,bEa,cEa,dEa,(new z).e("WRITE",J(function(){return function(){return(new WO).b()}}(this)))];
this.ck=Jg(tAa,(new M).q(eEa));this.a=(4|this.a)<<24>>24;var fEa=Ke().Pk,gEa=H(r(),(new M).q(["__APPLY"])),hEa=(new z).e("etc._apply",gEa),iEa=H(r(),(new M).q(["__BENCH"])),jEa=(new z).e("etc._bench",iEa),kEa=H(r(),(new M).q(["__CHANGE-TOPOLOGY"])),lEa=(new z).e("etc._changetopology",kEa),mEa=H(r(),(new M).q(["__DONE"])),nEa=(new z).e("_done",mEa),oEa=H(r(),(new M).q(["__EXPERIMENTSTEPEND"])),pEa=(new z).e("etc._experimentstepend",oEa),qEa=H(r(),(new M).q(["__EXPORT-DRAWING"])),rEa=(new z).e("etc._exportdrawing",
qEa),sEa=H(r(),(new M).q(["__FOREVERBUTTONEND"])),tEa=(new z).e("etc._foreverbuttonend",sEa),uEa=H(r(),(new M).q(["__IGNORE"])),vEa=(new z).e("etc._ignore",uEa),wEa=H(r(),(new M).q(["__LET","LET"])),xEa=(new z).e("_let",wEa),yEa=H(r(),(new M).q(["__LINKCODE"])),zEa=(new z).e("etc._linkcode",yEa),AEa=H(r(),(new M).q(["__MKDIR"])),BEa=(new z).e("etc._mkdir",AEa),CEa=H(r(),(new M).q(["__OBSERVERCODE"])),DEa=(new z).e("etc._observercode",CEa),EEa=H(r(),(new M).q(["__PATCHCODE"])),FEa=(new z).e("etc._patchcode",
EEa),GEa=H(r(),(new M).q(["__PLOT-PEN-HIDE"])),HEa=(new z).e("etc._plotpenhide",GEa),IEa=H(r(),(new M).q(["__PLOT-PEN-SHOW"])),JEa=(new z).e("etc._plotpenshow",IEa),KEa=H(r(),(new M).q(["__PWD"])),LEa=(new z).e("etc._pwd",KEa),MEa=H(r(),(new M).q(["__RELOAD-EXTENSIONS"])),NEa=(new z).e("etc._reloadextensions",MEa),OEa=H(r(),(new M).q(["__SET-LINE-THICKNESS"])),PEa=(new z).e("etc._setlinethickness",OEa),QEa=H(r(),(new M).q(["__STDERR"])),REa=(new z).e("etc._stderr",QEa),SEa=H(r(),(new M).q(["__STDOUT"])),
TEa=(new z).e("etc._stdout",SEa),UEa=H(r(),(new M).q(["__THUNK-DID-FINISH"])),VEa=(new z).e("etc._thunkdidfinish",UEa),WEa=H(r(),(new M).q(["__TURTLECODE"])),XEa=(new z).e("etc._turtlecode",WEa),YEa=H(r(),(new M).q(["ASK"])),ZEa=(new z).e("_ask",YEa),$Ea=H(r(),(new M).q(["ASK-CONCURRENT"])),aFa=(new z).e("_askconcurrent",$Ea),bFa=H(r(),(new M).q(["AUTO-PLOT-OFF"])),cFa=(new z).e("etc._autoplotoff",bFa),dFa=H(r(),(new M).q(["AUTO-PLOT-ON"])),eFa=(new z).e("etc._autoploton",dFa),fFa=H(r(),(new M).q(["BACK",
"BK"])),gFa=(new z).e("_bk",fFa),hFa=H(r(),(new M).q(["BEEP"])),iFa=(new z).e("etc._beep",hFa),jFa=H(r(),(new M).q(["BACK","BK"])),kFa=(new z).e("_bk",jFa),lFa=H(r(),(new M).q(["CA","CLEAR-ALL"])),mFa=(new z).e("etc._clearall",lFa),nFa=H(r(),(new M).q(["CAREFULLY"])),oFa=(new z).e("_carefully",nFa),pFa=H(r(),(new M).q(["CD","CLEAR-DRAWING"])),qFa=(new z).e("etc._cleardrawing",pFa),rFa=H(r(),(new M).q(["CA","CLEAR-ALL"])),sFa=(new z).e("etc._clearall",rFa),tFa=H(r(),(new M).q(["CLEAR-ALL-PLOTS"])),
uFa=(new z).e("etc._clearallplots",tFa),vFa=H(r(),(new M).q(["CD","CLEAR-DRAWING"])),wFa=(new z).e("etc._cleardrawing",vFa),xFa=H(r(),(new M).q(["CLEAR-GLOBALS"])),yFa=(new z).e("etc._clearglobals",xFa),zFa=H(r(),(new M).q(["CLEAR-LINKS"])),AFa=(new z).e("etc._clearlinks",zFa),BFa=H(r(),(new M).q(["CLEAR-OUTPUT"])),CFa=(new z).e("etc._clearoutput",BFa),DFa=H(r(),(new M).q(["CLEAR-PATCHES","CP"])),EFa=(new z).e("etc._clearpatches",DFa),FFa=H(r(),(new M).q(["CLEAR-PLOT"])),GFa=(new z).e("etc._clearplot",
FFa),HFa=H(r(),(new M).q(["CLEAR-TICKS"])),IFa=(new z).e("etc._clearticks",HFa),JFa=H(r(),(new M).q(["CLEAR-TURTLES","CT"])),KFa=(new z).e("etc._clearturtles",JFa),LFa=H(r(),(new M).q(["CLEAR-PATCHES","CP"])),MFa=(new z).e("etc._clearpatches",LFa),NFa=H(r(),(new M).q(["CREATE-LINK-FROM"])),OFa=(new z).e("etc._createlinkfrom",NFa),PFa=H(r(),(new M).q(["CREATE-LINK-TO"])),QFa=(new z).e("etc._createlinkto",PFa),RFa=H(r(),(new M).q(["CREATE-LINK-WITH"])),SFa=(new z).e("etc._createlinkwith",RFa),TFa=H(r(),
(new M).q(["CREATE-LINKS-FROM"])),UFa=(new z).e("etc._createlinksfrom",TFa),VFa=H(r(),(new M).q(["CREATE-LINKS-TO"])),WFa=(new z).e("etc._createlinksto",VFa),XFa=H(r(),(new M).q(["CREATE-LINKS-WITH"])),YFa=(new z).e("etc._createlinkswith",XFa),ZFa=H(r(),(new M).q(["CREATE-ORDERED-TURTLES","CRO"])),$Fa=(new z).e("_createorderedturtles",ZFa),aGa=H(r(),(new M).q(["CREATE-TEMPORARY-PLOT-PEN"])),bGa=(new z).e("etc._createtemporaryplotpen",aGa),cGa=H(r(),(new M).q(["CREATE-TURTLES","CRT"])),dGa=(new z).e("_createturtles",
cGa),eGa=H(r(),(new M).q(["CREATE-ORDERED-TURTLES","CRO"])),fGa=(new z).e("_createorderedturtles",eGa),gGa=H(r(),(new M).q(["CREATE-TURTLES","CRT"])),hGa=(new z).e("_createturtles",gGa),iGa=H(r(),(new M).q(["CLEAR-TURTLES","CT"])),jGa=(new z).e("etc._clearturtles",iGa),kGa=H(r(),(new M).q(["DIE"])),lGa=(new z).e("etc._die",kGa),mGa=H(r(),(new M).q(["DIFFUSE"])),nGa=(new z).e("etc._diffuse",mGa),oGa=H(r(),(new M).q(["DIFFUSE4"])),pGa=(new z).e("etc._diffuse4",oGa),qGa=H(r(),(new M).q(["DISPLAY"])),
rGa=(new z).e("etc._display",qGa),sGa=H(r(),(new M).q(["DOWNHILL"])),tGa=(new z).e("etc._downhill",sGa),uGa=H(r(),(new M).q(["DOWNHILL4"])),vGa=(new z).e("etc._downhill4",uGa),wGa=H(r(),(new M).q(["ERROR"])),xGa=(new z).e("etc._error",wGa),yGa=H(r(),(new M).q(["EVERY"])),zGa=(new z).e("etc._every",yGa),AGa=H(r(),(new M).q(["EXPORT-ALL-PLOTS"])),BGa=(new z).e("etc._exportplots",AGa),CGa=H(r(),(new M).q(["EXPORT-INTERFACE"])),DGa=(new z).e("etc._exportinterface",CGa),EGa=H(r(),(new M).q(["EXPORT-OUTPUT"])),
FGa=(new z).e("etc._exportoutput",EGa),GGa=H(r(),(new M).q(["EXPORT-PLOT"])),HGa=(new z).e("etc._exportplot",GGa),IGa=H(r(),(new M).q(["EXPORT-VIEW"])),JGa=(new z).e("etc._exportview",IGa),KGa=H(r(),(new M).q(["EXPORT-WORLD"])),LGa=(new z).e("etc._exportworld",KGa),MGa=H(r(),(new M).q(["FACE"])),NGa=(new z).e("etc._face",MGa),OGa=H(r(),(new M).q(["FACEXY"])),PGa=(new z).e("etc._facexy",OGa),QGa=H(r(),(new M).q(["FD","FORWARD"])),RGa=(new z).e("_fd",QGa),SGa=H(r(),(new M).q(["FILE-CLOSE"])),TGa=(new z).e("etc._fileclose",
SGa),UGa=H(r(),(new M).q(["FILE-CLOSE-ALL"])),VGa=(new z).e("etc._filecloseall",UGa),WGa=H(r(),(new M).q(["FILE-DELETE"])),XGa=(new z).e("etc._filedelete",WGa),YGa=H(r(),(new M).q(["FILE-FLUSH"])),ZGa=(new z).e("etc._fileflush",YGa),$Ga=H(r(),(new M).q(["FILE-OPEN"])),aHa=(new z).e("etc._fileopen",$Ga),bHa=H(r(),(new M).q(["FILE-PRINT"])),cHa=(new z).e("etc._fileprint",bHa),dHa=H(r(),(new M).q(["FILE-SHOW"])),eHa=(new z).e("etc._fileshow",dHa),fHa=H(r(),(new M).q(["FILE-TYPE"])),gHa=(new z).e("etc._filetype",
fHa),hHa=H(r(),(new M).q(["FILE-WRITE"])),iHa=(new z).e("etc._filewrite",hHa),jHa=H(r(),(new M).q(["FOLLOW"])),kHa=(new z).e("etc._follow",jHa),lHa=H(r(),(new M).q(["FOLLOW-ME"])),mHa=(new z).e("etc._followme",lHa),nHa=H(r(),(new M).q(["FOREACH"])),oHa=(new z).e("etc._foreach",nHa),pHa=H(r(),(new M).q(["FD","FORWARD"])),qHa=(new z).e("_fd",pHa),rHa=H(r(),(new M).q(["HATCH"])),sHa=(new z).e("_hatch",rHa),tHa=H(r(),(new M).q(["HIDE-LINK"])),uHa=(new z).e("etc._hidelink",tHa),vHa=H(r(),(new M).q(["HIDE-TURTLE",
"HT"])),wHa=(new z).e("etc._hideturtle",vHa),xHa=H(r(),(new M).q(["HISTOGRAM"])),yHa=(new z).e("etc._histogram",xHa),zHa=H(r(),(new M).q(["HOME"])),AHa=(new z).e("etc._home",zHa),BHa=H(r(),(new M).q(["HIDE-TURTLE","HT"])),CHa=(new z).e("etc._hideturtle",BHa),DHa=H(r(),(new M).q(["HUBNET-BROADCAST"])),EHa=(new z).e("hubnet._hubnetbroadcast",DHa),FHa=H(r(),(new M).q(["HUBNET-BROADCAST-CLEAR-OUTPUT"])),GHa=(new z).e("hubnet._hubnetbroadcastclearoutput",FHa),HHa=H(r(),(new M).q(["HUBNET-BROADCAST-MESSAGE"])),
IHa=(new z).e("hubnet._hubnetbroadcastmessage",HHa),JHa=H(r(),(new M).q(["HUBNET-CLEAR-OVERRIDE"])),KHa=(new z).e("hubnet._hubnetclearoverride",JHa),LHa=H(r(),(new M).q(["HUBNET-CLEAR-OVERRIDES"])),MHa=(new z).e("hubnet._hubnetclearoverrides",LHa),NHa=H(r(),(new M).q(["HUBNET-FETCH-MESSAGE"])),OHa=(new z).e("hubnet._hubnetfetchmessage",NHa),PHa=H(r(),(new M).q(["HUBNET-KICK-ALL-CLIENTS"])),QHa=(new z).e("hubnet._hubnetkickallclients",PHa),RHa=H(r(),(new M).q(["HUBNET-KICK-CLIENT"])),SHa=(new z).e("hubnet._hubnetkickclient",
RHa),THa=H(r(),(new M).q(["HUBNET-RESET"])),UHa=(new z).e("hubnet._hubnetreset",THa),VHa=H(r(),(new M).q(["HUBNET-RESET-PERSPECTIVE"])),WHa=(new z).e("hubnet._hubnetresetperspective",VHa),XHa=H(r(),(new M).q(["HUBNET-SEND"])),YHa=(new z).e("hubnet._hubnetsend",XHa),ZHa=H(r(),(new M).q(["HUBNET-SEND-CLEAR-OUTPUT"])),$Ha=(new z).e("hubnet._hubnetsendclearoutput",ZHa),aIa=H(r(),(new M).q(["HUBNET-SEND-FOLLOW"])),bIa=(new z).e("hubnet._hubnetsendfollow",aIa),cIa=H(r(),(new M).q(["HUBNET-SEND-MESSAGE"])),
dIa=(new z).e("hubnet._hubnetsendmessage",cIa),eIa=H(r(),(new M).q(["HUBNET-SEND-OVERRIDE"])),fIa=(new z).e("hubnet._hubnetsendoverride",eIa),gIa=H(r(),(new M).q(["HUBNET-SEND-WATCH"])),hIa=(new z).e("hubnet._hubnetsendwatch",gIa),iIa=H(r(),(new M).q(["IF"])),jIa=(new z).e("etc._if",iIa),kIa=H(r(),(new M).q(["IF-ELSE","IFELSE"])),lIa=(new z).e("etc._ifelse",kIa),mIa=H(r(),(new M).q(["IF-ELSE","IFELSE"])),nIa=(new z).e("etc._ifelse",mIa),oIa=H(r(),(new M).q(["IMPORT-DRAWING"])),pIa=(new z).e("etc._importdrawing",
oIa),qIa=H(r(),(new M).q(["IMPORT-PCOLORS"])),rIa=(new z).e("etc._importpatchcolors",qIa),sIa=H(r(),(new M).q(["IMPORT-PCOLORS-RGB"])),tIa=(new z).e("etc._importpcolorsrgb",sIa),uIa=H(r(),(new M).q(["IMPORT-WORLD"])),vIa=(new z).e("etc._importworld",uIa),wIa=H(r(),(new M).q(["INSPECT"])),xIa=(new z).e("etc._inspect",wIa),yIa=H(r(),(new M).q(["JUMP"])),zIa=(new z).e("_jump",yIa),AIa=H(r(),(new M).q(["LAYOUT-CIRCLE"])),BIa=(new z).e("etc._layoutcircle",AIa),CIa=H(r(),(new M).q(["LAYOUT-RADIAL"])),DIa=
(new z).e("etc._layoutradial",CIa),EIa=H(r(),(new M).q(["LAYOUT-SPRING"])),FIa=(new z).e("etc._layoutspring",EIa),GIa=H(r(),(new M).q(["LAYOUT-TUTTE"])),HIa=(new z).e("etc._layouttutte",GIa),IIa=H(r(),(new M).q(["LEFT","LT"])),JIa=(new z).e("etc._left",IIa),KIa=H(r(),(new M).q(["__LET","LET"])),LIa=(new z).e("_let",KIa),MIa=H(r(),(new M).q(["LOOP"])),NIa=(new z).e("etc._loop",MIa),OIa=H(r(),(new M).q(["LEFT","LT"])),PIa=(new z).e("etc._left",OIa),QIa=H(r(),(new M).q(["MOVE-TO"])),RIa=(new z).e("etc._moveto",
QIa),SIa=H(r(),(new M).q(["NO-DISPLAY"])),TIa=(new z).e("etc._nodisplay",SIa),UIa=H(r(),(new M).q(["OUTPUT-PRINT"])),VIa=(new z).e("etc._outputprint",UIa),WIa=H(r(),(new M).q(["OUTPUT-SHOW"])),XIa=(new z).e("etc._outputshow",WIa),YIa=H(r(),(new M).q(["OUTPUT-TYPE"])),ZIa=(new z).e("etc._outputtype",YIa),$Ia=H(r(),(new M).q(["OUTPUT-WRITE"])),aJa=(new z).e("etc._outputwrite",$Ia),bJa=H(r(),(new M).q(["PD","PEN-DOWN","PENDOWN"])),cJa=(new z).e("etc._pendown",bJa),dJa=H(r(),(new M).q(["PE","PEN-ERASE"])),
eJa=(new z).e("etc._penerase",dJa),fJa=H(r(),(new M).q(["PD","PEN-DOWN","PENDOWN"])),gJa=(new z).e("etc._pendown",fJa),hJa=H(r(),(new M).q(["PE","PEN-ERASE"])),iJa=(new z).e("etc._penerase",hJa),jJa=H(r(),(new M).q(["PEN-UP","PENUP","PU"])),kJa=(new z).e("etc._penup",jJa),lJa=H(r(),(new M).q(["PD","PEN-DOWN","PENDOWN"])),mJa=(new z).e("etc._pendown",lJa),nJa=H(r(),(new M).q(["PEN-UP","PENUP","PU"])),oJa=(new z).e("etc._penup",nJa),pJa=H(r(),(new M).q(["PLOT"])),qJa=(new z).e("etc._plot",pJa),rJa=
H(r(),(new M).q(["PLOT-PEN-DOWN"])),sJa=(new z).e("etc._plotpendown",rJa),tJa=H(r(),(new M).q(["PLOT-PEN-RESET"])),uJa=(new z).e("etc._plotpenreset",tJa),vJa=H(r(),(new M).q(["PLOT-PEN-UP"])),wJa=(new z).e("etc._plotpenup",vJa),xJa=H(r(),(new M).q(["PLOTXY"])),yJa=(new z).e("etc._plotxy",xJa),zJa=H(r(),(new M).q(["PRINT"])),AJa=(new z).e("etc._print",zJa),BJa=H(r(),(new M).q(["PEN-UP","PENUP","PU"])),CJa=(new z).e("etc._penup",BJa),DJa=H(r(),(new M).q(["RANDOM-SEED"])),EJa=(new z).e("etc._randomseed",
DJa),FJa=H(r(),(new M).q(["REPEAT"])),GJa=(new z).e("_repeat",FJa),HJa=H(r(),(new M).q(["REPORT"])),IJa=(new z).e("_report",HJa),JJa=H(r(),(new M).q(["RESET-PERSPECTIVE","RP"])),KJa=(new z).e("etc._resetperspective",JJa),LJa=H(r(),(new M).q(["RESET-TICKS"])),MJa=(new z).e("etc._resetticks",LJa),NJa=H(r(),(new M).q(["RESET-TIMER"])),OJa=(new z).e("etc._resettimer",NJa),PJa=H(r(),(new M).q(["RESIZE-WORLD"])),QJa=(new z).e("etc._resizeworld",PJa),RJa=H(r(),(new M).q(["RIDE"])),SJa=(new z).e("etc._ride",
RJa),TJa=H(r(),(new M).q(["RIDE-ME"])),UJa=(new z).e("etc._rideme",TJa),VJa=H(r(),(new M).q(["RIGHT","RT"])),WJa=(new z).e("etc._right",VJa),XJa=H(r(),(new M).q(["RESET-PERSPECTIVE","RP"])),YJa=(new z).e("etc._resetperspective",XJa),ZJa=H(r(),(new M).q(["RIGHT","RT"])),$Ja=(new z).e("etc._right",ZJa),aKa=H(r(),(new M).q(["RUN"])),bKa=(new z).e("_run",aKa),cKa=H(r(),(new M).q(["SET"])),dKa=(new z).e("_set",cKa),eKa=H(r(),(new M).q(["SET-CURRENT-DIRECTORY"])),fKa=(new z).e("etc._setcurdir",eKa),gKa=
H(r(),(new M).q(["SET-CURRENT-PLOT"])),hKa=(new z).e("etc._setcurrentplot",gKa),iKa=H(r(),(new M).q(["SET-CURRENT-PLOT-PEN"])),jKa=(new z).e("etc._setcurrentplotpen",iKa),kKa=H(r(),(new M).q(["SET-DEFAULT-SHAPE"])),lKa=(new z).e("etc._setdefaultshape",kKa),mKa=H(r(),(new M).q(["SET-HISTOGRAM-NUM-BARS"])),nKa=(new z).e("etc._sethistogramnumbars",mKa),oKa=H(r(),(new M).q(["SET-PATCH-SIZE"])),pKa=(new z).e("etc._setpatchsize",oKa),qKa=H(r(),(new M).q(["SET-PLOT-PEN-COLOR"])),rKa=(new z).e("etc._setplotpencolor",
qKa),sKa=H(r(),(new M).q(["SET-PLOT-PEN-INTERVAL"])),tKa=(new z).e("etc._setplotpeninterval",sKa),uKa=H(r(),(new M).q(["SET-PLOT-PEN-MODE"])),vKa=(new z).e("etc._setplotpenmode",uKa),wKa=H(r(),(new M).q(["SET-PLOT-X-RANGE"])),xKa=(new z).e("etc._setplotxrange",wKa),yKa=H(r(),(new M).q(["SET-PLOT-Y-RANGE"])),zKa=(new z).e("etc._setplotyrange",yKa),AKa=H(r(),(new M).q(["SETUP-PLOTS"])),BKa=(new z).e("etc._setupplots",AKa),CKa=H(r(),(new M).q(["SETXY"])),DKa=(new z).e("etc._setxy",CKa),EKa=H(r(),(new M).q(["SHOW"])),
FKa=(new z).e("etc._show",EKa),GKa=H(r(),(new M).q(["SHOW-LINK"])),HKa=(new z).e("etc._showlink",GKa),IKa=H(r(),(new M).q(["SHOW-TURTLE","ST"])),JKa=(new z).e("etc._showturtle",IKa),KKa=H(r(),(new M).q(["SPROUT"])),LKa=(new z).e("_sprout",KKa),MKa=H(r(),(new M).q(["SHOW-TURTLE","ST"])),NKa=(new z).e("etc._showturtle",MKa),OKa=H(r(),(new M).q(["STAMP"])),PKa=(new z).e("etc._stamp",OKa),QKa=H(r(),(new M).q(["STAMP-ERASE"])),RKa=(new z).e("etc._stamperase",QKa),SKa=H(r(),(new M).q(["STOP"])),TKa=(new z).e("_stop",
SKa),UKa=H(r(),(new M).q(["STOP-INSPECTING"])),VKa=(new z).e("etc._stopinspecting",UKa),WKa=H(r(),(new M).q(["STOP-INSPECTING-DEAD-AGENTS"])),XKa=(new z).e("etc._stopinspectingdeadagents",WKa),YKa=H(r(),(new M).q(["TICK"])),ZKa=(new z).e("etc._tick",YKa),$Ka=H(r(),(new M).q(["TICK-ADVANCE"])),aLa=(new z).e("etc._tickadvance",$Ka),bLa=H(r(),(new M).q(["TIE"])),cLa=(new z).e("etc._tie",bLa),dLa=H(r(),(new M).q(["TYPE"])),eLa=(new z).e("etc._type",dLa),fLa=H(r(),(new M).q(["UNTIE"])),gLa=(new z).e("etc._untie",
fLa),hLa=H(r(),(new M).q(["UPDATE-PLOTS"])),iLa=(new z).e("etc._updateplots",hLa),jLa=H(r(),(new M).q(["UPHILL"])),kLa=(new z).e("etc._uphill",jLa),lLa=H(r(),(new M).q(["UPHILL4"])),mLa=(new z).e("etc._uphill4",lLa),nLa=H(r(),(new M).q(["USER-MESSAGE"])),oLa=(new z).e("etc._usermessage",nLa),pLa=H(r(),(new M).q(["WAIT"])),qLa=(new z).e("etc._wait",pLa),rLa=H(r(),(new M).q(["WATCH"])),sLa=(new z).e("etc._watch",rLa),tLa=H(r(),(new M).q(["WATCH-ME"])),uLa=(new z).e("etc._watchme",tLa),vLa=H(r(),(new M).q(["WHILE"])),
wLa=(new z).e("etc._while",vLa),xLa=H(r(),(new M).q(["WITH-LOCAL-RANDOMNESS"])),yLa=(new z).e("etc._withlocalrandomness",xLa),zLa=H(r(),(new M).q(["WITHOUT-INTERRUPTION"])),ALa=(new z).e("etc._withoutinterruption",zLa),BLa=H(r(),(new M).q(["WRITE"])),CLa=(new z).e("etc._write",BLa),DLa=H(r(),(new M).q(["!\x3d"])),ELa=(new z).e("_notequal",DLa),FLa=H(r(),(new M).q(["*"])),GLa=(new z).e("etc._mult",FLa),HLa=H(r(),(new M).q(["+"])),ILa=(new z).e("etc._plus",HLa),JLa=H(r(),(new M).q(["-"])),KLa=(new z).e("_minus",
JLa),LLa=H(r(),(new M).q(["/"])),MLa=(new z).e("etc._div",LLa),NLa=H(r(),(new M).q(["\x3c"])),OLa=(new z).e("_lessthan",NLa),PLa=H(r(),(new M).q(["\x3c\x3d"])),QLa=(new z).e("etc._lessorequal",PLa),RLa=H(r(),(new M).q(["\x3d"])),SLa=(new z).e("_equal",RLa),TLa=H(r(),(new M).q(["\x3e"])),ULa=(new z).e("_greaterthan",TLa),VLa=H(r(),(new M).q(["\x3e\x3d"])),WLa=(new z).e("etc._greaterorequal",VLa),XLa=H(r(),(new M).q(["^"])),YLa=(new z).e("etc._pow",XLa),ZLa=H(r(),(new M).q(["__APPLY-RESULT"])),$La=
(new z).e("etc._applyresult",ZLa),aMa=H(r(),(new M).q(["__BOOM"])),bMa=(new z).e("etc._boom",aMa),cMa=H(r(),(new M).q(["__BLOCK"])),dMa=(new z).e("etc._block",cMa),eMa=H(r(),(new M).q(["__CHECK-SYNTAX"])),fMa=(new z).e("etc._checksyntax",eMa),gMa=H(r(),(new M).q(["__CHECKSUM"])),hMa=(new z).e("etc._checksum",gMa),iMa=H(r(),(new M).q(["__DUMP"])),jMa=(new z).e("etc._dump",iMa),kMa=H(r(),(new M).q(["__DUMP-EXTENSION-PRIMS"])),lMa=(new z).e("etc._dumpextensionprims",kMa),mMa=H(r(),(new M).q(["__DUMP-EXTENSIONS"])),
nMa=(new z).e("etc._dumpextensions",mMa),oMa=H(r(),(new M).q(["__DUMP1"])),pMa=(new z).e("etc._dump1",oMa),qMa=H(r(),(new M).q(["__NANO-TIME"])),rMa=(new z).e("etc._nanotime",qMa),sMa=H(r(),(new M).q(["__PROCESSORS"])),tMa=(new z).e("etc._processors",sMa),uMa=H(r(),(new M).q(["__RANDOM-STATE"])),vMa=(new z).e("etc._randomstate",uMa),wMa=H(r(),(new M).q(["__REFERENCE"])),xMa=(new z).e("etc._reference",wMa),yMa=H(r(),(new M).q(["__STACK-TRACE"])),zMa=(new z).e("etc._stacktrace",yMa),AMa=H(r(),(new M).q(["__SYMBOL"])),
BMa=(new z).e("etc._symbolstring",AMa),CMa=H(r(),(new M).q(["__TO-STRING"])),DMa=(new z).e("etc._tostring",CMa),EMa=H(r(),(new M).q(["ABS"])),FMa=(new z).e("etc._abs",EMa),GMa=H(r(),(new M).q(["ACOS"])),HMa=(new z).e("etc._acos",GMa),IMa=H(r(),(new M).q(["ALL?"])),JMa=(new z).e("etc._all",IMa),KMa=H(r(),(new M).q(["AND"])),LMa=(new z).e("_and",KMa),MMa=H(r(),(new M).q(["ANY?"])),NMa=(new z).e("_any",MMa),OMa=H(r(),(new M).q(["APPROXIMATE-HSB"])),PMa=(new z).e("etc._approximatehsb",OMa),QMa=H(r(),
(new M).q(["APPROXIMATE-RGB"])),RMa=(new z).e("etc._approximatergb",QMa),SMa=H(r(),(new M).q(["ASIN"])),TMa=(new z).e("etc._asin",SMa),UMa=H(r(),(new M).q(["AT-POINTS"])),VMa=(new z).e("etc._atpoints",UMa),WMa=H(r(),(new M).q(["ATAN"])),XMa=(new z).e("etc._atan",WMa),YMa=H(r(),(new M).q(["AUTOPLOT?"])),ZMa=(new z).e("etc._autoplot",YMa),$Ma=H(r(),(new M).q(["BASE-COLORS"])),aNa=(new z).e("etc._basecolors",$Ma),bNa=H(r(),(new M).q(["BEHAVIORSPACE-EXPERIMENT-NAME"])),cNa=(new z).e("etc._behaviorspaceexperimentname",
bNa),dNa=H(r(),(new M).q(["BEHAVIORSPACE-RUN-NUMBER"])),eNa=(new z).e("etc._behaviorspacerunnumber",dNa),fNa=H(r(),(new M).q(["BF","BUT-FIRST","BUTFIRST"])),gNa=(new z).e("etc._butfirst",fNa),hNa=H(r(),(new M).q(["BL","BUT-LAST","BUTLAST"])),iNa=(new z).e("etc._butlast",hNa),jNa=H(r(),(new M).q(["BOTH-ENDS"])),kNa=(new z).e("etc._bothends",jNa),lNa=H(r(),(new M).q(["BF","BUT-FIRST","BUTFIRST"])),mNa=(new z).e("etc._butfirst",lNa),nNa=H(r(),(new M).q(["BL","BUT-LAST","BUTLAST"])),oNa=(new z).e("etc._butlast",
nNa),pNa=H(r(),(new M).q(["BF","BUT-FIRST","BUTFIRST"])),qNa=(new z).e("etc._butfirst",pNa),rNa=H(r(),(new M).q(["BL","BUT-LAST","BUTLAST"])),sNa=(new z).e("etc._butlast",rNa),tNa=H(r(),(new M).q(["CAN-MOVE?"])),uNa=(new z).e("etc._canmove",tNa),vNa=H(r(),(new M).q(["CEILING"])),wNa=(new z).e("etc._ceil",vNa),xNa=H(r(),(new M).q(["COS"])),yNa=(new z).e("etc._cos",xNa),zNa=H(r(),(new M).q(["COUNT"])),ANa=(new z).e("_count",zNa),BNa=H(r(),(new M).q(["DATE-AND-TIME"])),CNa=(new z).e("etc._dateandtime",
BNa),DNa=H(r(),(new M).q(["DISTANCE"])),ENa=(new z).e("etc._distance",DNa),FNa=H(r(),(new M).q(["DISTANCEXY"])),GNa=(new z).e("etc._distancexy",FNa),HNa=H(r(),(new M).q(["DX"])),INa=(new z).e("etc._dx",HNa),JNa=H(r(),(new M).q(["DY"])),KNa=(new z).e("etc._dy",JNa),LNa=H(r(),(new M).q(["EMPTY?"])),MNa=(new z).e("etc._empty",LNa),NNa=H(r(),(new M).q(["ERROR-MESSAGE"])),ONa=(new z).e("_errormessage",NNa),PNa=H(r(),(new M).q(["EXP"])),QNa=(new z).e("etc._exp",PNa),RNa=H(r(),(new M).q(["EXTRACT-HSB"])),
SNa=(new z).e("etc._extracthsb",RNa),TNa=H(r(),(new M).q(["EXTRACT-RGB"])),UNa=(new z).e("etc._extractrgb",TNa),VNa=H(r(),(new M).q(["FILE-AT-END?"])),WNa=(new z).e("etc._fileatend",VNa),XNa=H(r(),(new M).q(["FILE-EXISTS?"])),YNa=(new z).e("etc._fileexists",XNa),ZNa=H(r(),(new M).q(["FILE-READ"])),$Na=(new z).e("etc._fileread",ZNa),aOa=H(r(),(new M).q(["FILE-READ-CHARACTERS"])),bOa=(new z).e("etc._filereadchars",aOa),cOa=H(r(),(new M).q(["FILE-READ-LINE"])),dOa=(new z).e("etc._filereadline",cOa),
eOa=H(r(),(new M).q(["FILTER"])),fOa=(new z).e("etc._filter",eOa),gOa=H(r(),(new M).q(["FIRST"])),hOa=(new z).e("etc._first",gOa),iOa=H(r(),(new M).q(["FLOOR"])),jOa=(new z).e("etc._floor",iOa),kOa=H(r(),(new M).q(["FPUT"])),lOa=(new z).e("etc._fput",kOa),mOa=H(r(),(new M).q(["HSB"])),nOa=(new z).e("etc._hsb",mOa),oOa=H(r(),(new M).q(["HUBNET-CLIENTS-LIST"])),pOa=(new z).e("hubnet._hubnetclientslist",oOa),qOa=H(r(),(new M).q(["HUBNET-ENTER-MESSAGE?"])),rOa=(new z).e("hubnet._hubnetentermessage",qOa),
sOa=H(r(),(new M).q(["HUBNET-EXIT-MESSAGE?"])),tOa=(new z).e("hubnet._hubnetexitmessage",sOa),uOa=H(r(),(new M).q(["HUBNET-MESSAGE"])),vOa=(new z).e("hubnet._hubnetmessage",uOa),wOa=H(r(),(new M).q(["HUBNET-MESSAGE-SOURCE"])),xOa=(new z).e("hubnet._hubnetmessagesource",wOa),yOa=H(r(),(new M).q(["HUBNET-MESSAGE-TAG"])),zOa=(new z).e("hubnet._hubnetmessagetag",yOa),AOa=H(r(),(new M).q(["HUBNET-MESSAGE-WAITING?"])),BOa=(new z).e("hubnet._hubnetmessagewaiting",AOa),COa=H(r(),(new M).q(["IFELSE-VALUE"])),
DOa=(new z).e("etc._ifelsevalue",COa),EOa=H(r(),(new M).q(["IN-CONE"])),FOa=(new z).e("etc._incone",EOa),GOa=H(r(),(new M).q(["IN-LINK-FROM"])),HOa=(new z).e("etc._inlinkfrom",GOa),IOa=H(r(),(new M).q(["IN-LINK-NEIGHBOR?"])),JOa=(new z).e("etc._inlinkneighbor",IOa),KOa=H(r(),(new M).q(["IN-LINK-NEIGHBORS"])),LOa=(new z).e("etc._inlinkneighbors",KOa),MOa=H(r(),(new M).q(["IN-RADIUS"])),NOa=(new z).e("_inradius",MOa),OOa=H(r(),(new M).q(["INSERT-ITEM"])),POa=(new z).e("etc._insertitem",OOa),QOa=H(r(),
(new M).q(["INT"])),ROa=(new z).e("etc._int",QOa),SOa=H(r(),(new M).q(["IS-AGENT?"])),TOa=(new z).e("etc._isagent",SOa),UOa=H(r(),(new M).q(["IS-AGENTSET?"])),VOa=(new z).e("etc._isagentset",UOa),WOa=H(r(),(new M).q(["IS-ANONYMOUS-COMMAND?"])),XOa=(new z).e("etc._isanonymouscommand",WOa),YOa=H(r(),(new M).q(["IS-ANONYMOUS-REPORTER?"])),ZOa=(new z).e("etc._isanonymousreporter",YOa),$Oa=H(r(),(new M).q(["IS-BOOLEAN?"])),aPa=(new z).e("etc._isboolean",$Oa),bPa=H(r(),(new M).q(["IS-DIRECTED-LINK?"])),
cPa=(new z).e("etc._isdirectedlink",bPa),dPa=H(r(),(new M).q(["IS-LINK-SET?"])),ePa=(new z).e("etc._islinkset",dPa),fPa=H(r(),(new M).q(["IS-LINK?"])),gPa=(new z).e("etc._islink",fPa),hPa=H(r(),(new M).q(["IS-LIST?"])),iPa=(new z).e("etc._islist",hPa),jPa=H(r(),(new M).q(["IS-NUMBER?"])),kPa=(new z).e("etc._isnumber",jPa),lPa=H(r(),(new M).q(["IS-PATCH-SET?"])),mPa=(new z).e("etc._ispatchset",lPa),nPa=H(r(),(new M).q(["IS-PATCH?"])),oPa=(new z).e("etc._ispatch",nPa),pPa=H(r(),(new M).q(["IS-STRING?"])),
qPa=(new z).e("etc._isstring",pPa),rPa=H(r(),(new M).q(["IS-TURTLE-SET?"])),sPa=(new z).e("etc._isturtleset",rPa),tPa=H(r(),(new M).q(["IS-TURTLE?"])),uPa=(new z).e("etc._isturtle",tPa),vPa=H(r(),(new M).q(["IS-UNDIRECTED-LINK?"])),wPa=(new z).e("etc._isundirectedlink",vPa),xPa=H(r(),(new M).q(["ITEM"])),yPa=(new z).e("etc._item",xPa),zPa=H(r(),(new M).q(["LAST"])),APa=(new z).e("etc._last",zPa),BPa=H(r(),(new M).q(["LENGTH"])),CPa=(new z).e("etc._length",BPa),DPa=H(r(),(new M).q(["LINK"])),EPa=(new z).e("etc._link",
DPa),FPa=H(r(),(new M).q(["LINK-HEADING"])),GPa=(new z).e("etc._linkheading",FPa),HPa=H(r(),(new M).q(["LINK-LENGTH"])),IPa=(new z).e("etc._linklength",HPa),JPa=H(r(),(new M).q(["LINK-NEIGHBOR?"])),KPa=(new z).e("etc._linkneighbor",JPa),LPa=H(r(),(new M).q(["LINK-NEIGHBORS"])),MPa=(new z).e("etc._linkneighbors",LPa),NPa=H(r(),(new M).q(["LINK-SET"])),OPa=(new z).e("etc._linkset",NPa),PPa=H(r(),(new M).q(["LINK-SHAPES"])),QPa=(new z).e("etc._linkshapes",PPa),RPa=H(r(),(new M).q(["LINK-WITH"])),SPa=
(new z).e("etc._linkwith",RPa),TPa=H(r(),(new M).q(["LINKS"])),UPa=(new z).e("etc._links",TPa),VPa=H(r(),(new M).q(["LIST"])),WPa=(new z).e("_list",VPa),XPa=H(r(),(new M).q(["LN"])),YPa=(new z).e("etc._ln",XPa),ZPa=H(r(),(new M).q(["LOG"])),$Pa=(new z).e("etc._log",ZPa),aQa=H(r(),(new M).q(["LPUT"])),bQa=(new z).e("etc._lput",aQa),cQa=H(r(),(new M).q(["MAP"])),dQa=(new z).e("etc._map",cQa),eQa=H(r(),(new M).q(["MAX"])),fQa=(new z).e("etc._max",eQa),gQa=H(r(),(new M).q(["MAX-N-OF"])),hQa=(new z).e("etc._maxnof",
gQa),iQa=H(r(),(new M).q(["MAX-ONE-OF"])),jQa=(new z).e("etc._maxoneof",iQa),kQa=H(r(),(new M).q(["MAX-PXCOR"])),lQa=(new z).e("etc._maxpxcor",kQa),mQa=H(r(),(new M).q(["MAX-PYCOR"])),nQa=(new z).e("etc._maxpycor",mQa),oQa=H(r(),(new M).q(["MEAN"])),pQa=(new z).e("etc._mean",oQa),qQa=H(r(),(new M).q(["MEDIAN"])),rQa=(new z).e("etc._median",qQa),sQa=H(r(),(new M).q(["MEMBER?"])),tQa=(new z).e("etc._member",sQa),uQa=H(r(),(new M).q(["MIN"])),vQa=(new z).e("etc._min",uQa),wQa=H(r(),(new M).q(["MIN-N-OF"])),
xQa=(new z).e("etc._minnof",wQa),yQa=H(r(),(new M).q(["MIN-ONE-OF"])),zQa=(new z).e("etc._minoneof",yQa),AQa=H(r(),(new M).q(["MIN-PXCOR"])),BQa=(new z).e("etc._minpxcor",AQa),CQa=H(r(),(new M).q(["MIN-PYCOR"])),DQa=(new z).e("etc._minpycor",CQa),EQa=H(r(),(new M).q(["MOD"])),FQa=(new z).e("etc._mod",EQa),GQa=H(r(),(new M).q(["MODES"])),HQa=(new z).e("etc._modes",GQa),IQa=H(r(),(new M).q(["MOUSE-DOWN?"])),JQa=(new z).e("etc._mousedown",IQa),KQa=H(r(),(new M).q(["MOUSE-INSIDE?"])),LQa=(new z).e("etc._mouseinside",
KQa),MQa=H(r(),(new M).q(["MOUSE-XCOR"])),NQa=(new z).e("etc._mousexcor",MQa),OQa=H(r(),(new M).q(["MOUSE-YCOR"])),PQa=(new z).e("etc._mouseycor",OQa),QQa=H(r(),(new M).q(["MY-IN-LINKS"])),RQa=(new z).e("etc._myinlinks",QQa),SQa=H(r(),(new M).q(["MY-LINKS"])),TQa=(new z).e("etc._mylinks",SQa),UQa=H(r(),(new M).q(["MY-OUT-LINKS"])),VQa=(new z).e("etc._myoutlinks",UQa),WQa=H(r(),(new M).q(["MYSELF"])),XQa=(new z).e("etc._myself",WQa),YQa=H(r(),(new M).q(["N-OF"])),ZQa=(new z).e("etc._nof",YQa),$Qa=
H(r(),(new M).q(["N-VALUES"])),aRa=(new z).e("etc._nvalues",$Qa),bRa=H(r(),(new M).q(["NEIGHBORS"])),cRa=(new z).e("_neighbors",bRa),dRa=H(r(),(new M).q(["NEIGHBORS4"])),eRa=(new z).e("_neighbors4",dRa),fRa=H(r(),(new M).q(["NETLOGO-APPLET?"])),gRa=(new z).e("etc._netlogoapplet",fRa),hRa=H(r(),(new M).q(["NETLOGO-VERSION"])),iRa=(new z).e("etc._netlogoversion",hRa),jRa=H(r(),(new M).q(["NETLOGO-WEB?"])),kRa=(new z).e("etc._netlogoweb",jRa),lRa=H(r(),(new M).q(["NEW-SEED"])),mRa=(new z).e("etc._newseed",
lRa),nRa=H(r(),(new M).q(["NO-LINKS"])),oRa=(new z).e("etc._nolinks",nRa),pRa=H(r(),(new M).q(["NO-PATCHES"])),qRa=(new z).e("etc._nopatches",pRa),rRa=H(r(),(new M).q(["NO-TURTLES"])),sRa=(new z).e("etc._noturtles",rRa),tRa=H(r(),(new M).q(["NOT"])),uRa=(new z).e("_not",tRa),vRa=H(r(),(new M).q(["OF"])),wRa=(new z).e("_of",vRa),xRa=H(r(),(new M).q(["ONE-OF"])),yRa=(new z).e("_oneof",xRa),zRa=H(r(),(new M).q(["OR"])),ARa=(new z).e("_or",zRa),BRa=H(r(),(new M).q(["OTHER"])),CRa=(new z).e("_other",BRa),
DRa=H(r(),(new M).q(["OTHER-END"])),ERa=(new z).e("etc._otherend",DRa),FRa=H(r(),(new M).q(["OUT-LINK-NEIGHBOR?"])),GRa=(new z).e("etc._outlinkneighbor",FRa),HRa=H(r(),(new M).q(["OUT-LINK-NEIGHBORS"])),IRa=(new z).e("etc._outlinkneighbors",HRa),JRa=H(r(),(new M).q(["OUT-LINK-TO"])),KRa=(new z).e("etc._outlinkto",JRa),LRa=H(r(),(new M).q(["PATCH"])),MRa=(new z).e("etc._patch",LRa),NRa=H(r(),(new M).q(["PATCH-AHEAD"])),ORa=(new z).e("etc._patchahead",NRa),PRa=H(r(),(new M).q(["PATCH-AT"])),QRa=(new z).e("_patchat",
PRa),RRa=H(r(),(new M).q(["PATCH-AT-HEADING-AND-DISTANCE"])),SRa=(new z).e("etc._patchatheadinganddistance",RRa),TRa=H(r(),(new M).q(["PATCH-HERE"])),URa=(new z).e("etc._patchhere",TRa),VRa=H(r(),(new M).q(["PATCH-LEFT-AND-AHEAD"])),WRa=(new z).e("etc._patchleftandahead",VRa),XRa=H(r(),(new M).q(["PATCH-RIGHT-AND-AHEAD"])),YRa=(new z).e("etc._patchrightandahead",XRa),ZRa=H(r(),(new M).q(["PATCH-SET"])),$Ra=(new z).e("etc._patchset",ZRa),aSa=H(r(),(new M).q(["PATCH-SIZE"])),bSa=(new z).e("etc._patchsize",
aSa),cSa=H(r(),(new M).q(["PATCHES"])),dSa=(new z).e("_patches",cSa),eSa=H(r(),(new M).q(["PLOT-NAME"])),fSa=(new z).e("etc._plotname",eSa),gSa=H(r(),(new M).q(["PLOT-PEN-EXISTS?"])),hSa=(new z).e("etc._plotpenexists",gSa),iSa=H(r(),(new M).q(["PLOT-X-MAX"])),jSa=(new z).e("etc._plotxmax",iSa),kSa=H(r(),(new M).q(["PLOT-X-MIN"])),lSa=(new z).e("etc._plotxmin",kSa),mSa=H(r(),(new M).q(["PLOT-Y-MAX"])),nSa=(new z).e("etc._plotymax",mSa),oSa=H(r(),(new M).q(["PLOT-Y-MIN"])),pSa=(new z).e("etc._plotymin",
oSa),qSa=H(r(),(new M).q(["POSITION"])),rSa=(new z).e("etc._position",qSa),sSa=H(r(),(new M).q(["PRECISION"])),tSa=(new z).e("etc._precision",sSa),uSa=H(r(),(new M).q(["RANDOM"])),vSa=(new z).e("_random",uSa),wSa=H(r(),(new M).q(["RANDOM-EXPONENTIAL"])),xSa=(new z).e("etc._randomexponential",wSa),ySa=H(r(),(new M).q(["RANDOM-FLOAT"])),zSa=(new z).e("etc._randomfloat",ySa),ASa=H(r(),(new M).q(["RANDOM-GAMMA"])),BSa=(new z).e("etc._randomgamma",ASa),CSa=H(r(),(new M).q(["RANDOM-NORMAL"])),DSa=(new z).e("etc._randomnormal",
CSa),ESa=H(r(),(new M).q(["RANDOM-POISSON"])),FSa=(new z).e("etc._randompoisson",ESa),GSa=H(r(),(new M).q(["RANDOM-PXCOR"])),HSa=(new z).e("etc._randompxcor",GSa),ISa=H(r(),(new M).q(["RANDOM-PYCOR"])),JSa=(new z).e("etc._randompycor",ISa),KSa=H(r(),(new M).q(["RANDOM-XCOR"])),LSa=(new z).e("etc._randomxcor",KSa),MSa=H(r(),(new M).q(["RANDOM-YCOR"])),NSa=(new z).e("etc._randomycor",MSa),OSa=H(r(),(new M).q(["RANGE"])),PSa=(new z).e("etc._range",OSa),QSa=H(r(),(new M).q(["READ-FROM-STRING"])),RSa=
(new z).e("etc._readfromstring",QSa),SSa=H(r(),(new M).q(["REDUCE"])),TSa=(new z).e("etc._reduce",SSa),USa=H(r(),(new M).q(["REMAINDER"])),VSa=(new z).e("etc._remainder",USa),WSa=H(r(),(new M).q(["REMOVE"])),XSa=(new z).e("etc._remove",WSa),YSa=H(r(),(new M).q(["REMOVE-DUPLICATES"])),ZSa=(new z).e("etc._removeduplicates",YSa),$Sa=H(r(),(new M).q(["REMOVE-ITEM"])),aTa=(new z).e("etc._removeitem",$Sa),bTa=H(r(),(new M).q(["REPLACE-ITEM"])),cTa=(new z).e("etc._replaceitem",bTa),dTa=H(r(),(new M).q(["REVERSE"])),
eTa=(new z).e("etc._reverse",dTa),fTa=H(r(),(new M).q(["RGB"])),gTa=(new z).e("etc._rgb",fTa),hTa=H(r(),(new M).q(["ROUND"])),iTa=(new z).e("etc._round",hTa),jTa=H(r(),(new M).q(["RUN-RESULT","RUNRESULT"])),kTa=(new z).e("etc._runresult",jTa),lTa=H(r(),(new M).q(["RUN-RESULT","RUNRESULT"])),mTa=(new z).e("etc._runresult",lTa),nTa=H(r(),(new M).q(["SCALE-COLOR"])),oTa=(new z).e("etc._scalecolor",nTa),pTa=H(r(),(new M).q(["SE","SENTENCE"])),qTa=(new z).e("_sentence",pTa),rTa=H(r(),(new M).q(["SELF"])),
sTa=(new z).e("etc._self",rTa),tTa=H(r(),(new M).q(["SE","SENTENCE"])),uTa=(new z).e("_sentence",tTa),vTa=H(r(),(new M).q(["SHADE-OF?"])),wTa=(new z).e("etc._shadeof",vTa),xTa=H(r(),(new M).q(["SHAPES"])),yTa=(new z).e("etc._shapes",xTa),zTa=H(r(),(new M).q(["SHUFFLE"])),ATa=(new z).e("etc._shuffle",zTa),BTa=H(r(),(new M).q(["SIN"])),CTa=(new z).e("etc._sin",BTa),DTa=H(r(),(new M).q(["SORT"])),ETa=(new z).e("etc._sort",DTa),FTa=H(r(),(new M).q(["SORT-BY"])),GTa=(new z).e("etc._sortby",FTa),HTa=H(r(),
(new M).q(["SORT-ON"])),ITa=(new z).e("etc._sorton",HTa),JTa=H(r(),(new M).q(["SQRT"])),KTa=(new z).e("etc._sqrt",JTa),LTa=H(r(),(new M).q(["STANDARD-DEVIATION"])),MTa=(new z).e("etc._standarddeviation",LTa),NTa=H(r(),(new M).q(["SUBJECT"])),OTa=(new z).e("etc._subject",NTa),PTa=H(r(),(new M).q(["SUBLIST"])),QTa=(new z).e("etc._sublist",PTa),RTa=H(r(),(new M).q(["SUBSTRING"])),STa=(new z).e("etc._substring",RTa),TTa=H(r(),(new M).q(["SUBTRACT-HEADINGS"])),UTa=(new z).e("etc._subtractheadings",TTa),
VTa=H(r(),(new M).q(["SUM"])),WTa=(new z).e("_sum",VTa),XTa=H(r(),(new M).q(["TAN"])),YTa=(new z).e("etc._tan",XTa),ZTa=H(r(),(new M).q(["TICKS"])),$Ta=(new z).e("etc._ticks",ZTa),aUa=H(r(),(new M).q(["TIMER"])),bUa=(new z).e("etc._timer",aUa),cUa=H(r(),(new M).q(["TOWARDS"])),dUa=(new z).e("etc._towards",cUa),eUa=H(r(),(new M).q(["TOWARDSXY"])),fUa=(new z).e("etc._towardsxy",eUa),gUa=H(r(),(new M).q(["TURTLE"])),hUa=(new z).e("_turtle",gUa),iUa=H(r(),(new M).q(["TURTLE-SET"])),jUa=(new z).e("etc._turtleset",
iUa),kUa=H(r(),(new M).q(["TURTLES"])),lUa=(new z).e("_turtles",kUa),mUa=H(r(),(new M).q(["TURTLES-AT"])),nUa=(new z).e("etc._turtlesat",mUa),oUa=H(r(),(new M).q(["TURTLES-HERE"])),pUa=(new z).e("etc._turtleshere",oUa),qUa=H(r(),(new M).q(["TURTLES-ON"])),rUa=(new z).e("etc._turtleson",qUa),sUa=H(r(),(new M).q(["UP-TO-N-OF"])),tUa=(new z).e("etc._uptonof",sUa),uUa=H(r(),(new M).q(["USER-DIRECTORY"])),vUa=(new z).e("etc._userdirectory",uUa),wUa=H(r(),(new M).q(["USER-FILE"])),xUa=(new z).e("etc._userfile",
wUa),yUa=H(r(),(new M).q(["USER-INPUT"])),zUa=(new z).e("etc._userinput",yUa),AUa=H(r(),(new M).q(["USER-NEW-FILE"])),BUa=(new z).e("etc._usernewfile",AUa),CUa=H(r(),(new M).q(["USER-ONE-OF"])),DUa=(new z).e("etc._useroneof",CUa),EUa=H(r(),(new M).q(["USER-YES-OR-NO?"])),FUa=(new z).e("etc._useryesorno",EUa),GUa=H(r(),(new M).q(["VARIANCE"])),HUa=(new z).e("etc._variance",GUa),IUa=H(r(),(new M).q(["WITH"])),JUa=(new z).e("_with",IUa),KUa=H(r(),(new M).q(["WITH-MAX"])),LUa=(new z).e("etc._withmax",
KUa),MUa=H(r(),(new M).q(["WITH-MIN"])),NUa=(new z).e("etc._withmin",MUa),OUa=H(r(),(new M).q(["WORD"])),PUa=(new z).e("_word",OUa),QUa=H(r(),(new M).q(["WORLD-HEIGHT"])),RUa=(new z).e("etc._worldheight",QUa),SUa=H(r(),(new M).q(["WORLD-WIDTH"])),TUa=(new z).e("etc._worldwidth",SUa),UUa=H(r(),(new M).q(["WRAP-COLOR"])),VUa=(new z).e("etc._wrapcolor",UUa),WUa=H(r(),(new M).q(["XOR"])),XUa=[hEa,jEa,lEa,nEa,pEa,rEa,tEa,vEa,xEa,zEa,BEa,DEa,FEa,HEa,JEa,LEa,NEa,PEa,REa,TEa,VEa,XEa,ZEa,aFa,cFa,eFa,gFa,iFa,
kFa,mFa,oFa,qFa,sFa,uFa,wFa,yFa,AFa,CFa,EFa,GFa,IFa,KFa,MFa,OFa,QFa,SFa,UFa,WFa,YFa,$Fa,bGa,dGa,fGa,hGa,jGa,lGa,nGa,pGa,rGa,tGa,vGa,xGa,zGa,BGa,DGa,FGa,HGa,JGa,LGa,NGa,PGa,RGa,TGa,VGa,XGa,ZGa,aHa,cHa,eHa,gHa,iHa,kHa,mHa,oHa,qHa,sHa,uHa,wHa,yHa,AHa,CHa,EHa,GHa,IHa,KHa,MHa,OHa,QHa,SHa,UHa,WHa,YHa,$Ha,bIa,dIa,fIa,hIa,jIa,lIa,nIa,pIa,rIa,tIa,vIa,xIa,zIa,BIa,DIa,FIa,HIa,JIa,LIa,NIa,PIa,RIa,TIa,VIa,XIa,ZIa,aJa,cJa,eJa,gJa,iJa,kJa,mJa,oJa,qJa,sJa,uJa,wJa,yJa,AJa,CJa,EJa,GJa,IJa,KJa,MJa,OJa,QJa,SJa,UJa,WJa,
YJa,$Ja,bKa,dKa,fKa,hKa,jKa,lKa,nKa,pKa,rKa,tKa,vKa,xKa,zKa,BKa,DKa,FKa,HKa,JKa,LKa,NKa,PKa,RKa,TKa,VKa,XKa,ZKa,aLa,cLa,eLa,gLa,iLa,kLa,mLa,oLa,qLa,sLa,uLa,wLa,yLa,ALa,CLa,ELa,GLa,ILa,KLa,MLa,OLa,QLa,SLa,ULa,WLa,YLa,$La,bMa,dMa,fMa,hMa,jMa,lMa,nMa,pMa,rMa,tMa,vMa,xMa,zMa,BMa,DMa,FMa,HMa,JMa,LMa,NMa,PMa,RMa,TMa,VMa,XMa,ZMa,aNa,cNa,eNa,gNa,iNa,kNa,mNa,oNa,qNa,sNa,uNa,wNa,yNa,ANa,CNa,ENa,GNa,INa,KNa,MNa,ONa,QNa,SNa,UNa,WNa,YNa,$Na,bOa,dOa,fOa,hOa,jOa,lOa,nOa,pOa,rOa,tOa,vOa,xOa,zOa,BOa,DOa,FOa,HOa,JOa,
LOa,NOa,POa,ROa,TOa,VOa,XOa,ZOa,aPa,cPa,ePa,gPa,iPa,kPa,mPa,oPa,qPa,sPa,uPa,wPa,yPa,APa,CPa,EPa,GPa,IPa,KPa,MPa,OPa,QPa,SPa,UPa,WPa,YPa,$Pa,bQa,dQa,fQa,hQa,jQa,lQa,nQa,pQa,rQa,tQa,vQa,xQa,zQa,BQa,DQa,FQa,HQa,JQa,LQa,NQa,PQa,RQa,TQa,VQa,XQa,ZQa,aRa,cRa,eRa,gRa,iRa,kRa,mRa,oRa,qRa,sRa,uRa,wRa,yRa,ARa,CRa,ERa,GRa,IRa,KRa,MRa,ORa,QRa,SRa,URa,WRa,YRa,$Ra,bSa,dSa,fSa,hSa,jSa,lSa,nSa,pSa,rSa,tSa,vSa,xSa,zSa,BSa,DSa,FSa,HSa,JSa,LSa,NSa,PSa,RSa,TSa,VSa,XSa,ZSa,aTa,cTa,eTa,gTa,iTa,kTa,mTa,oTa,qTa,sTa,uTa,wTa,
yTa,ATa,CTa,ETa,GTa,ITa,KTa,MTa,OTa,QTa,STa,UTa,WTa,YTa,$Ta,bUa,dUa,fUa,hUa,jUa,lUa,nUa,pUa,rUa,tUa,vUa,xUa,zUa,BUa,DUa,FUa,HUa,JUa,LUa,NUa,PUa,RUa,TUa,VUa,(new z).e("etc._xor",WUa)];Jg(fEa,(new M).q(XUa));this.a=(8|this.a)<<24>>24;return this};function kea(a){if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/core/TokenMapper.scala: 20");return a.ck}
function lea(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-js/src/main/core/TokenMapper.scala: 18");return a.Dk}oI.prototype.$classData=h({HF:0},!1,"org.nlogo.core.TokenMapper",{HF:1,d:1,cP:1});function XO(){}XO.prototype=new m;XO.prototype.constructor=XO;function YO(){}YO.prototype=XO.prototype;
XO.prototype.rE=function(a){var b=Ol(a),d=this.Yh();if(b===Ol(d))b=!0;else{a:{b=0;for(d=ZO(this.Yh(),0);;)if(sd(d)){if(d.Y().Rh().aa())break a;b=1+b|0;d=d.X()}else break;b=-1}if(-1!==b){b=Ol(a);a:{d=0;for(var e=ZO(this.Yh(),0);;)if(sd(e)){if(e.Y().Rh().aa())break a;d=1+d|0;e=e.X()}else break;d=-1}b=b>=d}else b=!1}if(b){b=this.Yh();d=A().P;for(a=gv(b,a,d);!a.x();){b=a.Y();if(null===b)throw(new q).i(b);if(!b.ha().jj(b.la()))return!1;a=a.X()}return!0}return!1};
XO.prototype.uI=function(a){var b=this.Yh();a=this.tm(a);var d=A().P;a=gv(b,a,d);b=function(){return function(g){if(null!==g)return g.ha().ti(g.la());throw(new q).i(g);}}(this);d=A().P;if(d===A().P)if(a===v())b=v();else{d=a.Y();var e=d=K(b(d),v());for(a=a.X();a!==v();){var f=a.Y();f=K(b(f),v());e=e.Da=f;a=a.X()}b=d}else{for(d=Oc(a,d);!a.x();)e=a.Y(),d.Ka(b(e)),a=a.X();b=d.Ea()}return b.Jb("\n")};
XO.prototype.DK=function(a){var b=this.Yh(),d=A().P;b=$O(b,d);a=function(g,k){return function(l){if(null!==l){var n=l.ha();l=l.Qc();return l<Ol(k)?n.Ci(Rh(k,l)):n.Rh().Q()}throw(new q).i(l);}}(this,a);d=A().P;if(d===A().P)if(b===v())a=v();else{d=b.Y();var e=d=K(a(d),v());for(b=b.X();b!==v();){var f=b.Y();f=K(a(f),v());e=e.Da=f;b=b.X()}a=d}else{for(d=Oc(b,d);!b.x();)e=b.Y(),d.Ka(a(e)),b=b.X();a=d.Ea()}return this.um(a)};function aP(){this.po=null;this.a=this.wD=this.gD=0}aP.prototype=new m;
aP.prototype.constructor=aP;aP.prototype.mr=function(){this.po.mr();Lk(this,bP(this))};function Ik(a){Ila(a.po,bP(a));Lk(a,bP(a))}function Jla(a){var b=new aP;b.po=a;b.gD=65536;b.a=(1|b.a)<<24>>24;b.wD=0;b.a=(2|b.a)<<24>>24;return b}function Lk(a,b){a.wD=b;a.a=(2|a.a)<<24>>24}function Mk(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/lex/AutoGrowingBufferedReader.scala: 9");return a.wD}
function bP(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/lex/AutoGrowingBufferedReader.scala: 8");return a.gD}aP.prototype.Ry=function(){if(0===Mk(this)){this.po.mr();Ila(this.po,bP(this)<<1);var a=this.po,b=bP(this);a.hw((new Fa).fa(b,b>>31));Lk(this,bP(this));this.gD=bP(this)<<1;this.a=(1|this.a)<<24>>24}a=this.po.Ry();Lk(this,-1+Mk(this)|0);return a};
aP.prototype.$classData=h({NY:0},!1,"org.nlogo.lex.AutoGrowingBufferedReader",{NY:1,d:1,jma:1});function Zk(){this.Sk=null;this.Op=0;this.$a=null}Zk.prototype=new m;Zk.prototype.constructor=Zk;Zk.prototype.Eba=function(a,b){this.Sk=a;this.Op=0;this.$a=b};Zk.prototype.qa=function(){Ik(this.Sk);var a=-1!==this.Sk.Ry();this.Sk.mr();return a};Zk.prototype.XI=function(a,b){Zk.prototype.Eba.call(this,Jla(a),b);return this};function Cca(a){a=a.Sk.Ry();return-1===a?D():(new I).i(Le(65535&a))}
Zk.prototype.$classData=h({OY:0},!1,"org.nlogo.lex.BufferedInputWrapper",{OY:1,d:1,mma:1});function cP(){this.EJ=null;this.XJ=0;this.OH=null;this.a=0;this.ka=null}cP.prototype=new m;cP.prototype.constructor=cP;
function Ica(a){var b=new cP;if(null===a)throw jg(kg(),null);b.ka=a;b.EJ=D();b.a=(1|b.a)<<24>>24;b.XJ=0;b.a=(2|b.a)<<24>>24;b.OH=nk(tk(),(new z).e(Kla(b),Lla(b)),xb(function(){return function(d,e){e=null===e?0:e.W;if(null!==d){var f=d.ha(),g=d.Qc();if(D()===f&&0===g&&123===e)return(new z).e((new z).e((new I).i(Le(123)),0),kk())}return null!==d&&(f=d.Qc(),0>f)?(new z).e((new z).e(D(),f),qk()):null!==d&&(f=d.Qc(),13===e||10===e)?(new z).e((new z).e((new I).i(Le(e)),f),lk()):null!==d&&(g=d.ha(),f=d.Qc(),
g instanceof I&&(g=g.M,125===(null===g?0:g.W)&&1===f&&125===e))?(new z).e((new z).e(D(),0),lk()):null!==d&&(g=d.ha(),f=d.Qc(),g instanceof I&&(g=g.M,123===(null===g?0:g.W)&&123===e))?(new z).e((new z).e(D(),1+f|0),kk()):null!==d&&(g=d.ha(),f=d.Qc(),g instanceof I&&(g=g.M,125===(null===g?0:g.W)&&125===e))?(new z).e((new z).e(D(),-1+f|0),kk()):null!==d&&(g=d.ha(),f=d.Qc(),g instanceof I&&(g=g.M,g=null===g?0:g.W,0===f&&123!==g))?(new z).e((new z).e(D(),0),qk()):null!==d?(d=d.Qc(),(new z).e((new z).e((new I).i(Le(e)),
d),kk())):(new z).e((new z).e(D(),0),qk())}}(b)));b.a=(4|b.a)<<24>>24;return b}c=cP.prototype;c.w=function(a){a=null===a?0:a.W;return Mla(this).w(Le(a))};function Lla(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/lex/TokenLexer.scala: 48");return a.XJ}c.l=function(){return"\x3cfunction1\x3e"};c.Fa=function(a){a=a.W;return!!Mla(this).w(Le(a))};
function Mla(a){if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/lex/TokenLexer.scala: 49");return a.OH}function Kla(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/lex/TokenLexer.scala: 47");return a.EJ}c.ya=function(a){return vb(this,a)};c.$classData=h({VY:0},!1,"org.nlogo.lex.TokenLexer$DoubleBracePairMatcher",{VY:1,d:1,ca:1});function dP(){}dP.prototype=new m;
dP.prototype.constructor=dP;dP.prototype.b=function(){return this};function zo(a,b,d){var e=new eP;Nla||(Nla=(new fP).b());var f=Nla;Nca||(Nca=(new Vk).b());b=Ola(e,f,Kca(b,d));return(new ac).bg(b,p(function(){return function(g){return g.ha()}}(a)))}dP.prototype.$classData=h({WY:0},!1,"org.nlogo.lex.Tokenizer$",{WY:1,d:1,ima:1});var Pla=void 0;function gP(){this.ka=this.g=null}gP.prototype=new m;gP.prototype.constructor=gP;
function Qla(a){a:for(;;){var b=a.xe.A().nr;if(Ei(C())===b||Bi(C())===b)return"-T--";if(Fi(C())===b||Ci(C())===b)return"--P-";if(Gi(C())===b||Di(C())===b)return"---L";if(vi(C())===b||Ai(C())===b)if(a=a.ta,r(),a=(new I).i(a),null!==a.M&&0<=a.M.sb(1)&&(a=a.M.R(0),a instanceof zb))continue a;return"-TPL"}}
function Rla(a,b,d){d.ua(p(function(e,f,g){return function(k){if(k instanceof Ab||k instanceof Bb){if("?"!==f)var l=f;else a:{r();l=(new I).i(g);if(null!==l.M&&0<=l.M.sb(1)&&(l=l.M.R(0),l instanceof zb)){l=Qla(l);break a}l="-TPL"}l=al(e.ka,l)}else l=e;Mb(l,k)}}(a,b,d)))}gP.prototype.rM=function(a){var b=a.Od;this.g=Sla(b,this.g);a=a.ta;var d=b.A().Na,e=r();a=a.Re(d,e.P);d=new hP;e=r();a=a.ic(d,e.P);b.A().n.aa()?Rla(this,b.A().n.Q(),a):a.ua(p(function(f){return function(g){Mb(f,g)}}(this)));b.K(this.g)};
function Tla(a,b,d){var e=(new Sb).c(b);var f=Ke().rq;f=Oc(e,f);for(var g=0,k=e.U.length|0;g<k;){var l=e.R(g);l=null===l?0:l.W;l=45!==l&&-1!==Jx(Na(),d,l)?l:45;f.Ka(Le(l));g=1+g|0}e=f.Ea();"----"===e&&(f=a.E().Qb.toUpperCase(),Gg(),Na(),b=Ula(b),b=111===(65535&(b.charCodeAt(0)|0))?"an "+b:"a "+b,d="|You can't use "+f+" in "+b+" context,\n              | because "+f+" is "+Ula(d)+"-only.",d=(new Sb).c(d),d=Pb(0,jq(d),"\n",""),a=a.E().ja,Fg(d,a.Ya,a.Ra,a.$a));return e}
function al(a,b){var d=new gP;d.g=b;if(null===a)throw jg(kg(),null);d.ka=a;return d}function Sla(a,b){return a instanceof Yq?Tla(a,b,a.ii.H()):a instanceof Vt?Tla(a,b,a.ii.H()):Tla(a,b,a.H())}
gP.prototype.vE=function(a){var b=a.xe;this.g=Sla(b,this.g);if(Ul(b.A())){var d=b.A().Xa,e=b.A().Na,f=A();e=e.Fd(d,f.P)}else e=b.A().Na;a:{d=0;for(e=ZO(e,0);;)if(sd(e)){f=e.Y()|0;if(Wl(C(),ti(),f))break a;d=1+d|0;e=e.X()}else break;d=-1}e=a.ta;f=r();d=e.Pj(f.P).kg(p(function(g,k){return function(l){if(null!==l)return l.Qc()!==k;throw(new q).i(l);}}(this,d)));e=p(function(){return function(g){return g.ha()}}(this));f=r();e=d.xa(e,f.P);d=al(this.ka,"OTPL");b instanceof gm||b instanceof um?(a=a.ta.Y(),
Mb(d,a)):b.A().n.aa()?Rla(this,b.A().n.Q(),e):e.ua(p(function(g){return function(k){Mb(g,k)}}(this)));b instanceof gm||b instanceof um?b.L((new I).i(d.g)):b.K(this.g)};
function Ula(a){var b=(new z).e(Le(79),"observer"),d=(new z).e(Le(84),"turtle"),e=(new z).e(Le(80),"patch");b=[b,d,e,(new z).e(Le(76),"link")];d=(new dc).vb(ec());e=0;for(var f=b.length|0;e<f;)fc(d,b[e]),e=1+e|0;b=d.La;a=(new Sb).c(a);d=(new Jk).b();e=0;for(f=a.U.length|0;e<f;){var g=a.R(e);45!==(null===g?0:g.W)!==!1&&Vla(d,null===g?0:g.W);e=1+e|0}a=(new Sb).c(d.kc.ec);Ke();d=Oc(a,new ik);e=0;for(f=a.U.length|0;e<f;)g=a.R(e),d.Ka(b.w(Le(null===g?0:g.W))),e=1+e|0;return d.Ea().Jb("/")}
gP.prototype.$classData=h({aZ:0},!1,"org.nlogo.parse.AgentTypeChecker$AgentTypeCheckerVisitor",{aZ:1,d:1,WM:1});function Um(){this.mz=null;this.a=!1}Um.prototype=new m;Um.prototype.constructor=Um;c=Um.prototype;c.b=function(){this.mz=(A(),v());this.a=!0;return this};function iP(a){if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/CarefullyVisitor.scala: 15");return a.mz}
c.Pe=function(a){var b=a.Od;if(b instanceof sq){var d=a.ta.R(0);d=Cb(this,d);var e=iP(this);this.mz=K(b,e);this.a=!0;b=a.ta.R(1);b=Cb(this,b);this.mz=iP(this).X();this.a=!0;d=H(r(),(new M).q([d,b]));return(new Ib).xj(a.Od,d,a.ja)}return Hb(this,a)};
c.re=function(a){var b=a.xe;if(b instanceof Zt){if(iP(this).x()){Gg();var d=Ng(),e=[b.E().Qb],f=d.Dm.ci("compiler.CarefullyVisitor.badNesting",J(function(w,y){return function(){throw(new Pe).c("coding error, bad translation key: "+y+" for Errors");}}(d,"compiler.CarefullyVisitor.badNesting"))),g=e.length|0;if(0>=g)var k=0;else d=g>>31,k=(0===d?-1<(-2147483648^g):0<d)?-1:g;r();om();d=[];var l=0,n=e.length|0;0>k&&pm(qm(),0,g,1,!1);for(n=n<k?n:k;l<n;){var t=e[l],u=l;0>k&&pm(qm(),0,g,1,!1);if(0>u||u>=
k)throw(new Q).c(""+u);t=(new z).e(t,u);d.push(t);l=1+l|0}e=d.length|0;g=0;k=f;a:for(;;){if(g!==e){f=1+g|0;k=(new z).e(k,d[g]);b:{g=k.ub;n=k.Hb;if(null!==n&&(l=n.ha(),n=n.Qc(),og(l))){k=l;k=Pb(Na(),g,"\\{"+n+"\\}",k);break b}throw(new q).i(k);}g=f;continue a}break}d=a.ja;Fg(k,d.Ya,d.Ra,d.$a)}b=Wla(b,rd().ed(Sea(iP(this).Y())));return(new zb).Jc(b,a.ta,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({qZ:0},!1,"org.nlogo.parse.CarefullyVisitor",{qZ:1,d:1,Ge:1});
function jP(){this.DJ=null}jP.prototype=new m;jP.prototype.constructor=jP;function iaa(a,b,d){var e=b.xe;if(e instanceof Pp)return d.ah((new kP).Ws(e.fd));if(e instanceof Al){var f=e.pa;if(!a.DJ.hb(f))return d.ah((new lP).c(f))}return tc(e)&&(qca||(qca=(new Uj).b()),e=(new I).i((new $b).te(e.Nd.Qk(),e.Nd instanceof hm,e.Uk)),!e.x())?(a=e.Q().Ig,d.Tj(a)):kaa(a,b,d)}jP.prototype.Ca=function(a){this.DJ=a;return this};
jP.prototype.$classData=h({rZ:0},!1,"org.nlogo.parse.ClosedVariableFinder",{rZ:1,d:1,Tla:1});function Vm(){}Vm.prototype=new m;Vm.prototype.constructor=Vm;c=Vm.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=a.xe;if(b instanceof um){a=Jb(this,a);var d=(new jP).Ca(b.Nd.Qk()),e=a.ta.R(0),f=H(Ke().rm,v());d=yb(d,e,f);b=Xla(b,b.Nd,d,b.Fc);return(new zb).Jc(b,a.ta,a.ja)}return b instanceof gm?(a=Jb(this,a),d=(new jP).Ca(b.Nd.Qk()),e=a.ta.R(0),f=H(Ke().rm,v()),d=yb(d,e,f),b=Yla(b,b.Nd,d,b.Fc),(new zb).Jc(b,a.ta,a.ja)):Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({sZ:0},!1,"org.nlogo.parse.ClosureTagger",{sZ:1,d:1,Ge:1});function mP(){this.a=0}mP.prototype=new m;
mP.prototype.constructor=mP;mP.prototype.b=function(){Zla=this;var a=(new z).e(Le(38),"\x26amp;"),b=(new z).e(Le(60),"\x26lt;"),d=(new z).e(Le(62),"\x26gt;");a=[a,b,d,(new z).e(Le(34),"\x26quot;")];b=(new dc).vb(ec());d=0;for(var e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;this.a=(4|this.a)<<24>>24;return this};mP.prototype.$classData=h({tZ:0},!1,"org.nlogo.parse.Colorizer$",{tZ:1,d:1,hma:1});var Zla=void 0;function qn(){this.oB=this.KA=null;this.a=0}qn.prototype=new m;qn.prototype.constructor=qn;c=qn.prototype;
c.b=function(){this.oB=v();this.a=(16|this.a)<<24>>24;return this};
c.Pe=function(a){if(a.Od instanceof Zq||a.Od instanceof IO||a.Od instanceof br){var b=sP(this).Y().Yx(),d=sP(this).X();tP(this,K(b,d))}b=sP(this).Y();d=a.Od;if(b instanceof uP&&d instanceof IO){Gg();b=Ng();var e=["STOP"];d=b.Dm.ci("org.nlogo.prim.etc._stop.notAllowedInsideToReport",J(function(u,w){return function(){throw(new Pe).c("coding error, bad translation key: "+w+" for Errors");}}(b,"org.nlogo.prim.etc._stop.notAllowedInsideToReport")));var f=e.length|0;if(0>=f)var g=0;else b=f>>31,g=(0===
b?-1<(-2147483648^f):0<b)?-1:f;r();om();b=[];var k=0,l=e.length|0;0>g&&pm(qm(),0,f,1,!1);for(l=l<g?l:g;k<l;){var n=e[k],t=k;0>g&&pm(qm(),0,f,1,!1);if(0>t||t>=g)throw(new Q).c(""+t);n=(new z).e(n,t);b.push(n);k=1+k|0}e=b.length|0;f=0;g=d;a:for(;;){if(f!==e){d=1+f|0;g=(new z).e(g,b[f]);b:{f=g.ub;l=g.Hb;if(null!==l&&(k=l.ha(),l=l.Qc(),og(k))){g=k;g=Pb(Na(),f,"\\{"+l+"\\}",g);break b}throw(new q).i(g);}f=d;continue a}break}a=a.ja;Fg(g,a.Ya,a.Ra,a.$a)}else if(d instanceof Zq?(e=sP(this),e=Rl(e)instanceof
vP?!(sP(this).Y()instanceof wP):!1):e=!1,e){Gg();b=Ng();e=["REPORT"];d=b.Dm.ci("org.nlogo.prim._report.canOnlyUseInToReport",J(function(u,w){return function(){throw(new Pe).c("coding error, bad translation key: "+w+" for Errors");}}(b,"org.nlogo.prim._report.canOnlyUseInToReport")));f=e.length|0;0>=f?g=0:(b=f>>31,g=(0===b?-1<(-2147483648^f):0<b)?-1:f);r();om();b=[];k=0;l=e.length|0;0>g&&pm(qm(),0,f,1,!1);for(l=l<g?l:g;k<l;){n=e[k];t=k;0>g&&pm(qm(),0,f,1,!1);if(0>t||t>=g)throw(new Q).c(""+t);n=(new z).e(n,
t);b.push(n);k=1+k|0}e=b.length|0;f=0;g=d;a:for(;;){if(f!==e){d=1+f|0;g=(new z).e(g,b[f]);b:{f=g.ub;l=g.Hb;if(null!==l&&(k=l.ha(),l=l.Qc(),og(k))){g=k;g=Pb(Na(),f,"\\{"+l+"\\}",g);break b}throw(new q).i(g);}f=d;continue a}break}a=a.ja;Fg(g,a.Ya,a.Ra,a.$a)}else if((b instanceof xP||b instanceof vP)&&d instanceof Zq){Gg();b=Ng();e=["REPORT"];d=b.Dm.ci("org.nlogo.prim._report.mustImmediatelyBeUsedInToReport",J(function(u,w){return function(){throw(new Pe).c("coding error, bad translation key: "+w+" for Errors");
}}(b,"org.nlogo.prim._report.mustImmediatelyBeUsedInToReport")));f=e.length|0;0>=f?g=0:(b=f>>31,g=(0===b?-1<(-2147483648^f):0<b)?-1:f);r();om();b=[];k=0;l=e.length|0;0>g&&pm(qm(),0,f,1,!1);for(l=l<g?l:g;k<l;){n=e[k];t=k;0>g&&pm(qm(),0,f,1,!1);if(0>t||t>=g)throw(new Q).c(""+t);n=(new z).e(n,t);b.push(n);k=1+k|0}e=b.length|0;f=0;g=d;a:for(;;){if(f!==e){d=1+f|0;g=(new z).e(g,b[f]);b:{f=g.ub;l=g.Hb;if(null!==l&&(k=l.ha(),l=l.Qc(),og(k))){g=k;g=Pb(Na(),f,"\\{"+l+"\\}",g);break b}throw(new q).i(g);}f=d;
continue a}break}a=a.ja;Fg(g,a.Ya,a.Ra,a.$a)}else return a.Od.A().ft?(b=(new xP).$k(this,!1),d=sP(this),tP(this,K(b,d)),b=Hb(this,a),d=sP(this).Y(),tP(this,sP(this).X()),a=a.ta,d=p(function(u,w){return function(y){return y instanceof Ab?Db((new Gb).Zs(y.De.Hs,y.De.fg,w.$e),y.ja,y.Mj):y}}(this,d)),e=r(),a=a.xa(d,e.P),(new Ib).xj(b.Od,a,b.ja)):Hb(this,a)};function $la(a){if(null===a.KA&&null===a.KA){var b=new yP;if(null===a)throw jg(kg(),null);b.Ta=a;a.KA=b}}
c.re=function(a){if(a.xe instanceof gm){var b=(new wP).$k(this,!1),d=sP(this);tP(this,K(b,d));a=Jb(this,a);tP(this,sP(this).X());return a}return Jb(this,a)};function sP(a){if(0===(16&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/ControlFlowVerifier.scala: 31");return a.oB}function tP(a,b){a.oB=b;a.a=(16|a.a)<<24>>24}
c.Fe=function(a){if(a.aj.rt.Km){var b=(new uP).$k(this,($la(this),!0)),d=sP(this);b=K(b,d)}else b=(new vP).$k(this,!1),d=sP(this),b=K(b,d);tP(this,b);a=Kb(this,a);b=sP(this).Y();tP(this,sP(this).X());return Lb(a.aj,(new Gb).Zs(a.De.Hs,a.De.fg,b.$e),a.Sz)};c.$classData=h({xZ:0},!1,"org.nlogo.parse.ControlFlowVerifier",{xZ:1,d:1,Ge:1});function zP(){}zP.prototype=new m;zP.prototype.constructor=zP;zP.prototype.b=function(){return this};
function Eaa(a){return p(function(b){return function(d){return p(function(e,f){return function(g){return Wc(f,g)}}(b,d))}}(a))}
function dd(a,b,d,e){var f=e.zk.Cc(d);f.x()?f=D():(f=f.Q(),f=(new I).i(Vc(f,a,b,d,e)));if(f.x()){f=Wc(e.Mf,d);var g=(new z).e(Ul(b.xe.A()),b.xe),k=g.Hb;if(!0===!!g.ub){g=b.ta.Y();g=Pc(a,g,d,0,e);b=b.ta;var l=r();return b.Pj(l.P).X().Ub(Xc(Yc(g),""+f+e.Jm.w(k)),xb(function(t,u){return function(w,y){w=(new z).e(w,y);y=w.ub;var E=w.Hb;if(null!==E)return Pc(t,E.ha(),u,E.Qc(),y);throw(new q).i(w);}}(a,d)))}if(g.Hb instanceof Zl)return e=Xc(Yc(e),""+Wc(e.Mf,d)+ama(e.Mf,d)),Qc(a,b,d,e);k=g.Hb;if(!1===!!g.ub&&
k instanceof dm)return e=Xc(Yc(e),""+Wc(e.Mf,d)+ama(e.Mf,d)),Qc(a,b,d,e);k=g.Hb;if(!1===!!g.ub&&tc(k)){f=(new Sb).c(e.Qb);f=AP(f);f.x()?f=!0:(f=f.Q(),f=32===(null===f?0:f.W));f=f?"":" ";g=e.zk;l=e.Mf;Eda();g=Dda(Qm(),g,l);b=Qc(a,b,d,g).Qb;g=!1;l=null;var n=k.Nd;a:{if(n instanceof il&&(g=!0,l=n,!0===l.Or)){a="[ -\x3e";break a}if(g&&!1===l.Or)a="[";else if(n instanceof hm)a="";else if(n instanceof yl)a="[ "+n.gj.Qb+" -\x3e";else if(n instanceof dl)g=n.is,a=p(function(){return function(t){return t.Qb}}(a)),
l=r(),a="[ ["+g.xa(a,l.P).Jb(" ")+"] -\x3e";else throw(new q).i(n);}g=!Do(Na(),a,"\x3e")||0<=(b.length|0)&&" "===b.substring(0,1)?"":" ";l=fd(e.Mf,d);d=k.Nd instanceof hm?"":"]";k=(new Sb).c(b);AP(k).hb(Le(32))?(k=(new Sb).c(l),k=rj(k).hb(Le(32))):k=!1;k?(k=(new Sb).c(l),l=k.U.length|0,k=Ie(Je(),k.U,1,l)):k=l;return Xc(Yc(e),f+a+g+b+k+d)}k=g.Hb;if(!1===!!g.ub)return f=Xc(Yc(e),""+f+e.Jm.w(k)),d=Qc(a,b,d,f),Zc(d.Qb,d.zk,e.Jm,d.Mf);throw(new q).i(g);}return f.Q()}
function Faa(a){return p(function(b){return function(d){return p(function(e,f){return function(g){return fd(f,g)}}(b,d))}}(a))}zP.prototype.$classData=h({IZ:0},!1,"org.nlogo.parse.Formatter",{IZ:1,d:1,rma:1});function BP(){this.nz=null}BP.prototype=new m;BP.prototype.constructor=BP;function ama(a,b){a=bma(a.nz,b.gk);return a instanceof I&&(a=a.M,a instanceof zb)?(b=a.xe,b instanceof dm&&(a=b.W,a instanceof rg)?(b=Pm(),Zb(b,a,!0,!1)):b.E().Qb):""}
function fd(a,b){var d=!1,e=null,f=b.gk.Vn();return f instanceof I&&(d=!0,e=f,e.M instanceof ed)?(b=(new CP).Ca(b.gk.me(1)),a=bma(a.nz,b.gk),a instanceof I&&(a=a.M,a instanceof zb&&(a=th().Gb(a),!a.x()&&a.Q().Ia instanceof gm))?" ":" ]"):d&&e.M instanceof gd?" ]":" "}
function Wc(a,b){var d=!1,e=null,f=b.gk.Vn();return f instanceof I&&(d=!0,e=f,e.M instanceof Uc)||d&&e.M instanceof $c?" ":d&&(f=e.M,f instanceof ed)?(d=f.Ec,e=!1,f=null,b=(new CP).Ca(b.gk.me(1)),a=bma(a.nz,b.gk),a instanceof I&&(e=!0,f=a,a=f.M,a instanceof zb&&(a=th().Gb(a),!a.x()&&a.Q().Ia instanceof gm))||e&&(a=f.M,jI(a)&&(a=a.ta.R(d),a instanceof Ab&&a.Mj))?"":" ["):d&&e.M instanceof gd?" [":""}function cma(a){var b=new BP;b.nz=a;return b}
BP.prototype.$classData=h({MZ:0},!1,"org.nlogo.parse.LambdaWhitespace",{MZ:1,d:1,nma:1});function Ac(){}Ac.prototype=new m;Ac.prototype.constructor=Ac;Ac.prototype.b=function(){return this};Ac.prototype.eJ=function(){return!1};
Ac.prototype.aM=function(a,b){a:{b=!!b;if(null!==a){var d=a.tb;if(Gk()===d&&b){b=(new DP).b();d=Uf();a=(new z).e(Sg(a,b,a.Qb,d),!1);break a}}b:{if(null!==a&&(b=a.tb,d=a.W,Gk()===b&&"LET"===d)){b=!0;break b}if(null!==a&&(b=a.tb,d=a.W,Gk()===b&&"__LET"===d)){b=!0;break b}b=!1}a=b?(new z).e(a,!0):(new z).e(a,!1)}return a};Ac.prototype.$classData=h({NZ:0},!1,"org.nlogo.parse.LetNamer$",{NZ:1,d:1,R_:1});var zc=void 0;function Tm(){}Tm.prototype=new m;Tm.prototype.constructor=Tm;c=Tm.prototype;c.b=function(){return this};
c.Pe=function(a){if(a.Od instanceof rn){var b=a.ta.X();return Hb(this,(new Ib).xj(a.Od,b,a.ja))}return Hb(this,a)};c.re=function(a){return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({OZ:0},!1,"org.nlogo.parse.LetReducer",{OZ:1,d:1,Ge:1});function Xm(){this.Ox=null;this.a=!1}Xm.prototype=new m;Xm.prototype.constructor=Xm;Xm.prototype.b=function(){this.Ox=D();this.a=!0;return this};
Xm.prototype.rM=function(a){var b=a.Od;b instanceof rn?(this.Ox=b.fd,this.a=!0,maa(this,a),this.Ox=D(),this.a=!0):maa(this,a)};function dma(a){if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/LetVerifier.scala: 13");return a.Ox}
Xm.prototype.vE=function(a){var b=a.xe;if(b instanceof Pp){Gg();var d=dma(this).x()||dma(this).Q()!==b.fd,e=b.E();if(!d){d=Ng();var f=[b.E().Qb.toUpperCase()];d=d.Dm.ci("compiler.LetVariable.notDefined",J(function(w,y){return function(){throw(new Pe).c("coding error, bad translation key: "+y+" for Errors");}}(d,"compiler.LetVariable.notDefined")));var g=f.length|0;if(0>=g)var k=0;else b=g>>31,k=(0===b?-1<(-2147483648^g):0<b)?-1:g;r();om();b=[];var l=0,n=f.length|0;0>k&&pm(qm(),0,g,1,!1);for(n=n<k?
n:k;l<n;){var t=f[l],u=l;0>k&&pm(qm(),0,g,1,!1);if(0>u||u>=k)throw(new Q).c(""+u);t=(new z).e(t,u);b.push(t);l=1+l|0}f=b.length|0;g=0;k=d;a:for(;;){if(g!==f){d=1+g|0;k=(new z).e(k,b[g]);b:{g=k.ub;n=k.Hb;if(null!==n&&(l=n.ha(),n=n.Qc(),og(l))){k=l;k=Pb(Na(),g,"\\{"+n+"\\}",k);break b}throw(new q).i(k);}g=d;continue a}break}e=e.ja;Fg(k,e.Ya,e.Ra,e.$a)}}naa(this,a)};Xm.prototype.$classData=h({SZ:0},!1,"org.nlogo.parse.LetVerifier",{SZ:1,d:1,WM:1});
function Cc(){this.Qg=this.aj=this.ge=this.Zb=this.qk=null;this.va=!1}Cc.prototype=new m;Cc.prototype.constructor=Cc;
function yaa(a){var b=EP(a.aj),d=jc(a.aj),e=r();d.Fd(b,e.P).ua(p(function(f){return function(g){var k=ema(f,g);k.x()?k=D():(k=k.Q(),k=(new I).i(k.W));k=k.Q();var l=k instanceof Yq||k instanceof Vt||k instanceof eq;Gg();l||(k=k instanceof er?"an extension command":k instanceof Zu?"an extension reporter":"a "+vp(qa(k)),l=g.Qb.toUpperCase(),g=g.ja,Fg("There is already "+k+" called "+l,g.Ya,g.Ra,g.$a))}}(a)))}
function fma(a){if(!a.va){var b=r(),d=(new FP).iC(to(a.Zb.Pg)),e=(new GP).iC(to(a.Zb.Pg)),f=(new HP).eC(a.Zb),g=(new IP).eC(a.Zb),k=new JP;k.Qg=a.Qg;d=[d,e,f,g,k,(new KP).Ca(vc(a.aj)),(new LP).ac(a.ge)];a.qk=H(b,(new M).q(d));a.va=!0}a.ge=null;a.Qg=null;return a.qk}Cc.prototype.eJ=function(){};
function ema(a,b){var d=a.va?a.qk:fma(a);a=p(function(f,g){return function(k){return k.w(g).gb()}}(a,b));var e=r();d=d.Ti(a,e.P).zg();if(d.x())return D();a=d.Q();if(null!==a)d=a.la(),b=Nk(new Ok,b.Qb,a.ha(),d,b.ja),d.G(b);else throw(new q).i(a);return(new I).i(b)}Cc.prototype.aM=function(a){var b=a.tb;if(Gk()===b){b=ema(this,a);if(b.x()){b=(new xl).b();var d=Uf();a=Sg(a,b,a.Qb,d)}else a=b.Q();a=(new z).e(a,void 0)}else a=(new z).e(a,void 0);return a};
Cc.prototype.$classData=h({UZ:0},!1,"org.nlogo.parse.Namer",{UZ:1,d:1,R_:1});function MP(){}MP.prototype=new m;MP.prototype.constructor=MP;c=MP.prototype;c.b=function(){return this};c.w=function(a){return gma(a)};
function gma(a){var b=a.tb,d=Rk();if(null!==b&&b===d)throw(new pd).ag(a);Ug||(Ug=(new Tg).b());b=a.Qb;d=Ug;if(!d.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/core/Keywords.scala: 8");if(d.CJ.hb(b.toUpperCase())||Do(Na(),b.toUpperCase(),"-OWN"))b=NP(),a=Nk(new Ok,a.Qb,b,a.W,a.ja);else if(El||(El=(new Dl).b()),b=El.Os(a.Qb),b instanceof I)b=b.M,d=Sk(),a=Nk(new Ok,a.Qb,d,b,a.ja);else if(D()!==b)throw(new q).i(b);return a}c.l=function(){return"\x3cfunction1\x3e"};
c.Fa=function(a){return!!gma(a)};c.ya=function(a){return vb(this,a)};c.$classData=h({VZ:0},!1,"org.nlogo.parse.Namer0$",{VZ:1,d:1,ca:1});var hma=void 0;function Ao(){hma||(hma=(new MP).b());return hma}function OP(){this.dF=null;this.a=!1}OP.prototype=new m;OP.prototype.constructor=OP;OP.prototype.b=function(){this.dF="Can only have literal agents and agentsets if importing.";this.a=!0;return this};
function Jda(){var a=cm();if(!a.a)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/NullImportHandler.scala: 10");return a.dF}OP.prototype.$classData=h({WZ:0},!1,"org.nlogo.parse.NullImportHandler$",{WZ:1,d:1,ema:1});var ima=void 0;function cm(){ima||(ima=(new OP).b());return ima}function PP(){this.ta=this.g=this.pa=this.dH=this.VJ=this.rt=null;this.a=0}PP.prototype=new m;PP.prototype.constructor=PP;
PP.prototype.K=function(a){this.g=a;this.a=(8|this.a)<<24>>24};function waa(a,b){a.ta=b;a.a=(16|a.a)<<24>>24}function EP(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/RawProcedure.scala: 12");return a.VJ}function jc(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/RawProcedure.scala: 13");return a.dH}
PP.prototype.Ze=function(){if(0===(4&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/RawProcedure.scala: 21");return this.pa};function vc(a){if(0===(16&a.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/RawProcedure.scala: 9");return a.ta}
function jma(a){var b=new PP;b.rt=a;vaa(b);b.VJ=a.Gi.X().Y();b.a=(1|b.a)<<24>>24;var d=a.Mn,e=p(function(){return function(g){return g.f}}(b)),f=r();b.dH=d.xa(e,f.P);b.a=(2|b.a)<<24>>24;a=a.Mn;d=p(function(){return function(g){return g.pa}}(b));e=r();waa(b,a.xa(d,e.P).ug());b.pa=EP(b).W;b.a=(4|b.a)<<24>>24;return b}PP.prototype.H=function(){if(0===(8&this.a)<<24>>24)throw(new x).c("Uninitialized field: /home/el_ergo/Repositories/NetLogo/parser-core/src/main/parse/RawProcedure.scala: 9");return this.g};
PP.prototype.$classData=h({ZZ:0},!1,"org.nlogo.parse.RawProcedure",{ZZ:1,d:1,cma:1});function ve(){this.OB=this.fn=null}ve.prototype=new zka;ve.prototype.constructor=ve;function Uaa(a,b,d){a.fn=b;a.OB=d;return a}function QP(a){return a.fn.x()?kma(a,2147483647):kma(a,a.OB.w(a.fn.Y())|0)}ve.prototype.$classData=h({a_:0},!1,"org.nlogo.parse.SeqReader",{a_:1,tsa:1,d:1});function Wm(){}Wm.prototype=new m;Wm.prototype.constructor=Wm;Wm.prototype.Pe=function(a){return Hb(this,a)};
Wm.prototype.re=function(a){var b=a.xe;if(tc(b)){var d=Jb(this,a);a=dd((new zP).b(),d,(new CP).Ca(v()),Zc("",Jg(Ke().Pk,v()),p(function(){return function(e){return Om(Qm(),e)}}(this)),cma(a))).Qb.trim();if(b instanceof um)a=(new I).i(a),b=Xla(b,b.Nd,b.Uk,a);else{if(!(b instanceof gm))throw(new q).i(b);a=(new I).i(a);b=Yla(b,b.Nd,b.Uk,a)}return(new zb).Jc(b,d.ta,d.ja)}return Jb(this,a)};Wm.prototype.Fe=function(a){return Kb(this,a)};
Wm.prototype.$classData=h({d_:0},!1,"org.nlogo.parse.SourceTagger",{d_:1,d:1,Ge:1});function eo(){this.ox=this.oL=null;this.va=!1;this.a=0}eo.prototype=new m;eo.prototype.constructor=eo;function RP(a){return SP(TP(a,"identifier",Gk()),p(function(){return function(b){return lma(b.W,b)}}(a)))}eo.prototype.b=function(){return this};
function mma(a){return SP(UP(VP(a,"UNDIRECTED-LINK-BREED"),J(function(b){return function(){return nma(b,"UNDIRECTED-LINK-BREED")}}(a))),p(function(){return function(b){var d=b.Wa.am,e=b.Wa.eg;b.Wa;return oma(d,e,!0,!1)}}(a)))}function pma(a){return SP(UP(ue(a,"\x3cbreed\x3e-own",new WP),J(function(b){return function(){return XP(b)}}(a))),p(function(){return function(b){if(null!==b){var d=b.Ia,e=new Jn;d=lma(d.W,d);b=b.Wa;e.Tg=d;e.dg=b;return e}throw(new q).i(b);}}(a)))}
function nma(a,b){var d=SP(RP(a).Sr(J(function(e){return function(){return RP(e)}}(a))),p(function(){return function(e){if(null!==e)return oma(e.Ia,e.Wa,!1,!1);throw(new q).i(e);}}(a)));b=De(RP(a),p(function(e,f){return function(g){return te(e,"Breed declarations must have plural and singular. "+f+" ["+g.pa+"] has only one name.")}}(a,b)));return YP(qma(TP(a,"opening bracket",Ek()),J(function(e,f,g){return function(){return Be(f,J(function(k,l){return function(){return l}}(e,g)))}}(a,d,b))),J(function(e){return function(){return TP(e,
"closing bracket",Fk())}}(a)))}function rma(a){return qma(TP(a,"opening bracket",Ek()),J(function(b){return function(){return oe(b,J(function(d){return function(){return YP(Ae(d,J(function(e){return function(){return ue(e,"string",new ZP)}}(d))),J(function(e){return function(){return TP(e,"closing bracket",Fk())}}(d)))}}(b)))}}(a)))}function TP(a,b,d){var e=new $P;e.kE=d;return ue(a,b,e)}function bea(a){null===a.ox&&null===a.ox&&(a.ox=(new NE).Dp(a));return a.ox}
function VP(a,b){var d=new aQ;d.cr=b;return ue(a,b,d)}function $da(a){var b=Ae(a,J(function(d){return function(){return sma(d)}}(a))).Sr(J(function(d){return function(){return Be(tma(d),J(function(e){return function(){return uma(e)}}(d)))}}(a)));return SP(vma(a,b),p(function(){return function(d){if(null!==d){var e=d.Ia;d=d.Wa;var f=A();return e.oc(d,f.P)}throw(new q).i(d);}}(a)))}
function wma(a){return SP(UP(VP(a,"EXTENSIONS"),J(function(b){return function(){return XP(b)}}(a))),p(function(){return function(b){if(null!==b)return(new Kn).jC(b.Ia,b.Wa);throw(new q).i(b);}}(a)))}function xma(a){return SP(UP(ue(a,"BREED",new bQ),J(function(b){return function(){return nma(b,"BREED")}}(a))),p(function(){return function(b){return b.Wa}}(a)))}
function sma(a){return Be(Be(Be(Be(Be(Be(Be(Be(Be(yma(a),J(function(b){return function(){return wma(b)}}(a))),J(function(b){return function(){return xma(b)}}(a))),J(function(b){return function(){return zma(b)}}(a))),J(function(b){return function(){return mma(b)}}(a))),J(function(b){return function(){return cQ(b,"GLOBALS")}}(a))),J(function(b){return function(){return cQ(b,"TURTLES-OWN")}}(a))),J(function(b){return function(){return cQ(b,"PATCHES-OWN")}}(a))),J(function(b){return function(){return cQ(b,
"LINKS-OWN")}}(a))),J(function(b){return function(){return pma(b)}}(a)))}function tma(a){var b=J(function(d){return function(){return Ama(d)}}(a));return YP(Vaa(a,b,b),J(function(d){return function(){return Be(TP(d,"eof",Fc()),J(function(e){return function(){return te(e,"TO or TO-REPORT expected")}}(d)))}}(a)))}function dQ(a){a.va||a.va||(a.oL=(new oE).i(D()),a.va=!0);return a.oL}
function XP(a){return qma(TP(a,"opening bracket",Ek()),J(function(b){return function(){return oe(b,J(function(d){return function(){return YP(Ae(d,J(function(e){return function(){return RP(e)}}(d))),J(function(e){return function(){return TP(e,"closing bracket",Fk())}}(d)))}}(b)))}}(a)))}
function cQ(a,b){return SP(UP(VP(a,b),J(function(d){return function(){return XP(d)}}(a))),p(function(d,e){return function(f){if(null!==f){var g=new Jn,k=lma(e,f.Ia);f=f.Wa;g.Tg=k;g.dg=f;return g}throw(new q).i(f);}}(a,b)))}function yma(a){return SP(UP(VP(a,"__INCLUDES"),J(function(b){return function(){return rma(b)}}(a))),p(function(){return function(b){if(null!==b)return(new Ln).jC(b.Ia,b.Wa);throw(new q).i(b);}}(a)))}
function Ama(a){return SP(UP(Be(VP(a,"TO"),J(function(b){return function(){return VP(b,"TO-REPORT")}}(a))),J(function(b){return function(){return RP(b)}}(a))).Sr(J(function(b){return function(){return Be(SP(XP(b),p(function(){return function(d){return(new I).i(d)}}(b))),J(function(d){return function(){var e=D();return Taa(d,e)}}(b)))}}(a))).Sr(J(function(b){return function(){return Ae(b,J(function(d){return function(){return ue(d,"?",new eQ)}}(b)))}}(a))).Sr(J(function(b){return function(){return Be(VP(b,
"END"),J(function(d){return function(){return te(d,"END expected")}}(b)))}}(a))),p(function(){return function(b){if(null!==b){var d=b.Ia,e=b.Wa;if(null!==d){var f=d.Ia,g=d.Wa;if(null!==f&&(d=f.Ia,f=f.Wa,null!==d)){var k=d.Ia;b=d.Wa;d=k.W;d=null!==d&&Ia(d,"TO-REPORT");f=f.x()?H(r(),v()):f.Q();var l=b.f,n=A();g=g.Fd(l,n.P);l=A();k=g.Fd(k,l.P);l=A();g=new Mn;e=k.wc(e,l.P);g.pa=b;g.Km=d;g.Mn=f;g.Gi=e;return g}}}throw(new q).i(b);}}(a)))}
function zma(a){return SP(UP(VP(a,"DIRECTED-LINK-BREED"),J(function(b){return function(){return nma(b,"DIRECTED-LINK-BREED")}}(a))),p(function(){return function(b){var d=b.Wa.am,e=b.Wa.eg;b.Wa;return oma(d,e,!0,!0)}}(a)))}function uma(a){return Be(SP(TP(a,"eof",Fc()),p(function(){return function(){return H(r(),v())}}(a))),J(function(b){return function(){return te(b,"keyword expected")}}(a)))}eo.prototype.$classData=h({g_:0},!1,"org.nlogo.parse.StructureCombinators",{g_:1,d:1,qsa:1});
function Jm(){this.fj=null;this.Mr=0}Jm.prototype=new m;Jm.prototype.constructor=Jm;function Yda(a,b){return Im(new Jm,a.fj.ul(b.fj),a.Mr+b.Mr|0)}function Im(a,b,d){a.fj=b;a.Mr=d;return a}function Cl(a,b){a=a.fj;b=b.toUpperCase();return a.hb(b)}c=Jm.prototype;c.m=function(a){if(a instanceof Jm){a=a.fj;var b=this.fj;return null===a?null===b:a.m(b)}return this===a};c.l=function(){return bc(this.fj,"",", ","")};c.Do=function(a){return Im(new Jm,this.fj.kg(a),this.Mr)};c.ua=function(a){this.fj.ua(a)};
function Hda(a,b,d){var e=a.fj;b=b.toUpperCase();return Im(new Jm,e.Uj((new z).e(b,d)),a.Mr)}c.Os=function(a){return this.fj.Cc(a.toUpperCase())};function fl(a,b){return a.fj.w(b.toUpperCase())}function uc(a,b,d){var e=a.fj;d=p(function(g,k){return function(l){l=l.toUpperCase();return(new z).e(l,k)}}(a,d));var f=Nc();return Im(new Jm,e.ul(b.xa(d,f.P).Oe(Ke().jl)),a.Mr)}c.xa=function(a,b){b=b.wg();var d=this.fj,e=zw().P;b.bc(Mr(d,a,e));return b.Ea()};
c.$classData=h({v_:0},!1,"org.nlogo.parse.SymbolTable",{v_:1,d:1,fb:1});function fQ(){this.vH=null}fQ.prototype=new m;fQ.prototype.constructor=fQ;function tga(a){var b=new fQ;b.vH=a;return b}fQ.prototype.Af=function(){gQ();var a=this.vH;var b=new hQ;b.sM=a.kj;b=b.Af();a=a.hq;if(a instanceof R)a=a.ea,b=Bma(gQ(),b,a);else{if(!(a instanceof T))throw(new q).i(a);a=a.dc;b=Cma(gQ(),b,a)}return b};fQ.prototype.$classData=h({q0:0},!1,"org.nlogo.tortoise.compiler.CompiledWidget$$anon$1",{q0:1,d:1,nm:1});
function iQ(){this.UC=null}iQ.prototype=new m;iQ.prototype.constructor=iQ;iQ.prototype.yg=function(){var a=Jr(Gr(),(new Hr).Bg(this.UC),"name"),b=Ir();return Dd(a,b)};function Dma(a){try{var b=Jr(Gr(),(new Hr).Bg(a.UC),"prims"),d=Kr(),e=Dd(b,d).W,f=p(function(){return function(k){return xfa(Lr(),k)}}(a)),g=ij().pc;return Mr(e,f,g)}catch(k){a=vm(kg(),k);if(a instanceof Sr)throw jg(kg(),(new Sr).Ys("Problem parsing extension definition JSON.  "+a.Tf(),a));throw k;}}
iQ.prototype.Bg=function(a){this.UC=a;return this};iQ.prototype.$classData=h({F0:0},!1,"org.nlogo.tortoise.compiler.CreateExtension$$anon$1",{F0:1,d:1,uma:1});function ir(){this.Us=this.JK=this.hI=null;this.UD=!1;this.a=0}ir.prototype=new m;ir.prototype.constructor=ir;
ir.prototype.b=function(){var a=H(r(),(new M).q('{\n  "name": "array",\n  "prims": [\n    {\n      "name": "from-list",\n      "argTypes": ["list"],\n      "returnType": "wildcard"\n    }, {\n      "name": "to-list",\n      "argTypes": ["wildcard"],\n      "returnType": "list"\n    }, {\n      "name": "is-array?",\n      "argTypes": ["wildcard"],\n      "returnType": "boolean"\n    }, {\n      "name": "length",\n      "argTypes": ["wildcard"],\n      "returnType": "number"\n    }, {\n      "name": "item",\n      "argTypes": ["wildcard", "number"],\n      "returnType": "wildcard"\n    }, {\n      "name": "set",\n      "argTypes": ["wildcard", "number", "wildcard"],\n      "returnType": "unit"\n    }\n  ]\n}\n;{\n  "name": "codap",\n  "prims": [\n    {\n      "name":       "init",\n      "argTypes":   ["command"]\n    }, {\n      "name":       "call",\n      "argTypes":   ["wildcard"]\n    }\n  ]\n}\n;{\n  "name": "csv",\n  "prims": [\n    {\n      "name":            "from-string",\n      "argTypes":        [{ "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "list"\n    }, {\n      "name":            "from-row",\n      "argTypes":        [{ "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "list"\n    }, {\n      "name":            "from-file",\n      "argTypes":        ["string", { "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "list"\n    }, {\n      "name":            "to-string",\n      "argTypes":        ["list", { "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "string"\n    }, {\n      "name":            "to-row",\n      "argTypes":        ["list", { "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "string"\n    }, {\n      "name":            "to-file",\n      "argTypes":        ["string", "list", { "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 2,\n      "returnType":      "unit"\n    }\n  ]\n}\n;{\n  "name": "dialog",\n  "prims": [\n    {\n      "name":       "user-input",\n      "argTypes":   ["string", "command"],\n      "returnType": "unit"\n    }, {\n      "name":       "user-message",\n      "argTypes":   ["string", "command"],\n      "returnType": "unit"\n    }, {\n      "name":       "user-one-of",\n      "argTypes":   ["string", "list", "command"],\n      "returnType": "unit"\n    }, {\n      "name":       "user-yes-or-no?",\n      "argTypes":   ["string", "command"],\n      "returnType": "unit"\n    }\n  ]\n}\n;{\n  "name": "encode",\n  "prims": [\n    {\n      "name":       "base64-to-bytes",\n      "argTypes":   ["string"],\n      "returnType": "list"\n    }, {\n      "name":       "bytes-to-base64",\n      "argTypes":   ["list"],\n      "returnType": "string"\n    }, {\n      "name":       "bytes-to-string",\n      "argTypes":   ["list"],\n      "returnType": "string"\n    }, {\n      "name":       "string-to-bytes",\n      "argTypes":   ["string"],\n      "returnType": "list"\n    }\n  ]\n}\n;{\n  "name": "export-the",\n  "prims": [\n    {\n      "name":            "model",\n      "argTypes":        [],\n      "returnType":      "string"\n    }, {\n      "name":            "output",\n      "argTypes":        [],\n      "returnType":      "string"\n    }, {\n      "name":            "plot",\n      "argTypes":        ["string"],\n      "returnType":      "string"\n    }, {\n      "name":            "view",\n      "argTypes":        [],\n      "returnType":      "string"\n    }, {\n      "name":            "world",\n      "argTypes":        [],\n      "returnType":      "string"\n    }\n  ]\n}\n;{\n  "name": "fetch",\n  "prims": [\n    {\n      "name":       "file",\n      "argTypes":   ["string"],\n      "returnType": "string"\n    }, {\n      "name":       "file-async",\n      "argTypes":   ["string", "command"],\n      "returnType": "unit"\n    }, {\n      "name":       "url",\n      "argTypes":   ["string"],\n      "returnType": "string"\n    }, {\n      "name":       "url-async",\n      "argTypes":   ["string", "command"],\n      "returnType": "unit"\n    }, {\n      "name":       "user-file",\n      "argTypes":   [],\n      "returnType": "string"\n    }, {\n      "name":       "user-file-async",\n      "argTypes":   ["command"],\n      "returnType": "unit"\n    }\n  ]\n}\n;{\n  "name": "http-req",\n  "prims": [\n    {\n      "name":       "get",\n      "argTypes":   ["string"],\n      "returnType": "list"\n    }, {\n      "name":       "post",\n      "argTypes":   ["string", "string", "string"],\n      "returnType": "list"\n    }\n  ]\n}\n;{\n  "name": "import-a",\n  "prims": [\n    {\n      "name":            "drawing",\n      "argTypes":        ["string"],\n      "returnType":      "unit"\n    }, {\n      "name":            "pcolors",\n      "argTypes":        ["string"],\n      "returnType":      "unit"\n    }, {\n      "name":            "pcolors-rgb",\n      "argTypes":        ["string"],\n      "returnType":      "unit"\n    }, {\n      "name":            "world",\n      "argTypes":        ["string"],\n      "returnType":      "unit"\n    }\n  ]\n}\n;{\n  "name": "logging",\n  "prims": [\n    {\n      "name":       "all-logs",\n      "argTypes":   [],\n      "returnType": "list"\n    }, {\n      "name":       "clear-logs",\n      "argTypes":   [],\n      "returnType": "unit"\n    }, {\n      "name":       "log-globals",\n      "argTypes":   [{ "type": "string", "isRepeatable": true }],\n      "returnType": "unit"\n    }, {\n      "name":       "log-message",\n      "argTypes":   ["string"],\n      "returnType": "unit"\n    }\n  ]\n}\n;{\n  "name": "matrix",\n  "prims": [\n    {\n      "name": "IS-MATRIX?",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "boolean"\n    },\n    {\n      "name": "REGRESS",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "FORECAST-CONTINUOUS-GROWTH",\n      "argTypes": [\n        "list"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "FORECAST-COMPOUND-GROWTH",\n      "argTypes": [\n        "list"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "FORECAST-LINEAR-GROWTH",\n      "argTypes": [\n        "list"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "MAKE-CONSTANT",\n      "argTypes": [\n        "number",\n        "number",\n        "number"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "DIMENSIONS",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "DET",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "number"\n    },\n    {\n      "name": "RANK",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "number"\n    },\n    {\n      "name": "TRACE",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "number"\n    },\n    {\n      "name": "MAKE-IDENTITY",\n      "argTypes": [\n        "number"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "FROM-ROW-LIST",\n      "argTypes": [\n        "list"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "FROM-COLUMN-LIST",\n      "argTypes": [\n        "list"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "TO-ROW-LIST",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "TO-COLUMN-LIST",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "COPY",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "PRETTY-PRINT-TEXT",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "string"\n    },\n    {\n      "name": "SOLVE",\n      "argTypes": [\n        "wildcard",\n        "wildcard"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "GET",\n      "argTypes": [\n        "wildcard",\n        "number",\n        "number"\n      ],\n      "returnType": "number"\n    },\n    {\n      "name": "GET-ROW",\n      "argTypes": [\n        "wildcard",\n        "number"\n      ],\n      "returnType": "number"\n    },\n    {\n      "name": "GET-COLUMN",\n      "argTypes": [\n        "wildcard",\n        "number"\n      ],\n      "returnType": "number"\n    },\n    {\n      "name": "SET",\n      "argTypes": [\n        "wildcard",\n        "number",\n        "number",\n        "number"\n      ]\n    },\n    {\n      "name": "SET-ROW",\n      "argTypes": [\n        "wildcard",\n        "number",\n        "list"\n      ]\n    },\n    {\n      "name": "SET-COLUMN",\n      "argTypes": [\n        "wildcard",\n        "number",\n        "list"\n      ]\n    },\n    {\n      "name": "SWAP-ROWS",\n      "argTypes": [\n        "wildcard",\n        "number",\n        "number"\n      ],\n      "returnType": "unit"\n    },\n    {\n      "name": "SWAP-COLUMNS",\n      "argTypes": [\n        "wildcard",\n        "number",\n        "number"\n      ],\n      "returnType": "unit"\n    },\n    {\n      "name": "SET-AND-REPORT",\n      "argTypes": [\n        "wildcard",\n        "number",\n        "number",\n        "number"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "SUBMATRIX",\n      "argTypes": [\n        "wildcard",\n        "number",\n        "number",\n        "number",\n        "number"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "MAP",\n      "argTypes": [\n        "reporter",\n        {\n          "type": "wildcard",\n          "isRepeatable": true\n        }\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "TIMES-SCALAR",\n      "argTypes": [\n        "wildcard",\n        "number"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "TIMES",\n      "argTypes": [\n        "wildcard",\n        {\n          "type": "wildcard",\n          "isRepeatable": true\n        }\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "*",\n      "argTypes": [\n        "wildcard",\n        "wildcard"\n      ],\n      "returnType": "wildcard",\n      "isInfix": true,\n      "precedenceOffset": -2\n    },\n    {\n      "name": "TIMES-ELEMENT-WISE",\n      "argTypes": [\n        "wildcard",\n        {\n          "type": "wildcard",\n          "isRepeatable": true\n        }\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "PLUS-SCALAR",\n      "argTypes": [\n        "wildcard",\n        "number"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "PLUS",\n      "argTypes": [\n        "wildcard",\n        {\n          "type": "wildcard",\n          "isRepeatable": true\n        }\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "+",\n      "argTypes": [\n        "wildcard",\n        "wildcard"\n      ],\n      "returnType": "wildcard",\n      "isInfix": true,\n      "precedenceOffset": -3\n    },\n    {\n      "name": "MINUS",\n      "argTypes": [\n        "wildcard",\n        {\n          "type": "wildcard",\n          "isRepeatable": true\n        }\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "-",\n      "argTypes": [\n        "wildcard",\n        "wildcard"\n      ],\n      "returnType": "wildcard",\n      "isInfix": true,\n      "precedenceOffset": -3\n    },\n    {\n      "name": "INVERSE",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "TRANSPOSE",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "wildcard"\n    },\n    {\n      "name": "REAL-EIGENVALUES",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "IMAGINARY-EIGENVALUES",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "list"\n    },\n    {\n      "name": "EIGENVECTORS",\n      "argTypes": [\n        "wildcard"\n      ],\n      "returnType": "wildcard"\n    }\n  ]\n}\n;{\n  "name": "mini-csv",\n  "prims": [\n    {\n      "name":            "from-string",\n      "argTypes":        [{ "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "list"\n    }, {\n      "name":            "from-row",\n      "argTypes":        [{ "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "list"\n    }, {\n      "name":            "to-string",\n      "argTypes":        ["list", { "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "string"\n    }, {\n      "name":            "to-row",\n      "argTypes":        ["list", { "type": "string", "isRepeatable": true }],\n      "defaultArgCount": 1,\n      "returnType":      "string"\n    }, {\n      "name":             "__t-context-reporter",\n      "argTypes":         [],\n      "returnType":       "number",\n      "agentClassString": "-T--"\n    }, {\n      "name":             "__o-context-command",\n      "argTypes":         [],\n      "returnType":       "unit",\n      "agentClassString": "O---"\n    }\n  ]\n}\n;{\n  "name": "nlmap",\n  "prims": [\n    {\n      "name":       "from-list",\n      "argTypes":   ["list"],\n      "returnType": "wildcard"\n    }, {\n      "name":       "to-list",\n      "argTypes":   ["wildcard"],\n      "returnType": "list"\n    }, {\n      "name":       "is-map?",\n      "argTypes":   ["wildcard"],\n      "returnType": "boolean"\n    }, {\n      "name":       "get",\n      "argTypes":   ["wildcard", "string"],\n      "returnType": "wildcard"\n    }, {\n      "name":       "remove",\n      "argTypes":   ["wildcard", "string"],\n      "returnType": "wildcard"\n    }, {\n      "name":       "add",\n      "argTypes":   ["wildcard", "string", "wildcard"],\n      "returnType": "wildcard"\n    }, {\n      "name":       "to-json",\n      "argTypes":   ["wildcard"],\n      "returnType": "string"\n    }, {\n      "name":       "to-urlenc",\n      "argTypes":   ["wildcard"],\n      "returnType": "string"\n    }, {\n      "name":       "from-json",\n      "argTypes":   ["string"],\n      "returnType": "wildcard"\n    }\n  ]\n}\n;{\n  "name": "nt",\n  "prims": [\n    {\n      "name":            "get",\n      "argTypes":        ["string"],\n      "returnType":      "wildcard"\n    }, {\n      "name":            "set",\n      "argTypes":        ["string", "wildcard"],\n      "returnType":      "unit"\n    }\n  ]\n}\n;{\n  "name": "palette",\n  "prims": [\n    {\n      "name": "alpha-of",\n      "argTypes": [{ "types": ["list", "number"] }],\n      "returnType": "number"\n    }, {\n      "name": "transparency-of",\n      "argTypes": [{ "types": ["list", "number"] }],\n      "returnType": "number"\n    }, {\n      "name": "with-alpha",\n      "argTypes": [{ "types": ["list", "number"] }, "number"],\n      "returnType": "list",\n      "isInfix": true,\n      "precedenceOffset": -2\n    }, {\n      "name": "alpha",\n      "argTypes": [],\n      "returnType": "number"\n    }, {\n      "name": "transparency",\n      "argTypes": [],\n      "returnType": "number"\n    }, {\n      "name": "set-alpha",\n      "argTypes": ["number"],\n      "returnType": "unit"\n    }, {\n      "name": "set-transparency",\n      "argTypes": ["number"],\n      "returnType": "unit"\n    }, {\n      "name": "with-transparency",\n      "argTypes": [{ "types": ["list", "number"] }, "number"],\n      "returnType": "list",\n      "isInfix": true,\n      "precedenceOffset": -2\n    }, {\n      "name": "hue-of",\n      "argTypes": [{ "types": ["list", "number"] }],\n      "returnType": "number"\n    }, {\n      "name": "saturation-of",\n      "argTypes": [{ "types": ["list", "number"] }],\n      "returnType": "number"\n    }, {\n      "name": "brightness-of",\n      "argTypes": [{ "types": ["list", "number"] }],\n      "returnType": "number"\n    }, {\n      "name": "with-hue",\n      "argTypes": [{ "types": ["list", "number"] }, "number"],\n      "returnType": "list",\n      "isInfix": true,\n      "precedenceOffset": -2\n    }, {\n      "name": "with-saturation",\n      "argTypes": [{ "types": ["list", "number"] }, "number"],\n      "returnType": "list",\n      "isInfix": true,\n      "precedenceOffset": -2\n    }, {\n      "name": "with-brightness",\n      "argTypes": [{ "types": ["list", "number"] }, "number"],\n      "returnType": "list",\n      "isInfix": true,\n      "precedenceOffset": -2\n    }, {\n      "name": "hue",\n      "argTypes": [],\n      "returnType": "number"\n    }, {\n      "name": "saturation",\n      "argTypes": [],\n      "returnType": "number"\n    }, {\n      "name": "brightness",\n      "argTypes": [],\n      "returnType": "number"\n    }, {\n      "name": "set-hue",\n      "argTypes": ["number"],\n      "returnType": "unit"\n    }, {\n      "name": "set-saturation",\n      "argTypes": ["number"],\n      "returnType": "unit"\n    }, {\n      "name": "set-brightness",\n      "argTypes": ["number"],\n      "returnType": "unit"\n    }, {\n      "name": "R-of",\n      "argTypes": [{ "types": ["list", "number"] }],\n      "returnType": "number"\n    }, {\n      "name": "G-of",\n      "argTypes": [{ "types": ["list", "number"] }],\n      "returnType": "number"\n    }, {\n      "name": "B-of",\n      "argTypes": [{ "types": ["list", "number"] }],\n      "returnType": "number"\n    }, {\n      "name": "with-R",\n      "argTypes": [{ "types": ["list", "number"] }, "number"],\n      "returnType": "list",\n      "isInfix": true,\n      "precedenceOffset": -2\n    }, {\n      "name": "with-G",\n      "argTypes": [{ "types": ["list", "number"] }, "number"],\n      "returnType": "list",\n      "isInfix": true,\n      "precedenceOffset": -2\n    }, {\n      "name": "with-B",\n      "argTypes": [{ "types": ["list", "number"] }, "number"],\n      "returnType": "list",\n      "isInfix": true,\n      "precedenceOffset": -2\n    }, {\n      "name": "R",\n      "argTypes": [],\n      "returnType": "number"\n    }, {\n      "name": "G",\n      "argTypes": [],\n      "returnType": "number"\n    }, {\n      "name": "B",\n      "argTypes": [],\n      "returnType": "number"\n    }, {\n      "name": "set-R",\n      "argTypes": ["number"],\n      "returnType": "unit"\n    }, {\n      "name": "set-G",\n      "argTypes": ["number"],\n      "returnType": "unit"\n    }, {\n      "name": "set-B",\n      "argTypes": ["number"],\n      "returnType": "unit"\n    }, {\n      "name": "scale-gradient-hsb",\n      "argTypes": ["list", "number", "number", "number"],\n      "returnType": "list"\n    }, {\n      "name": "scale-gradient",\n      "argTypes": ["list", "number", "number", "number"],\n      "returnType": "list"\n    }, {\n      "name": "scale-scheme",\n      "argTypes": ["string", "string", "number", "number", "number", "number"],\n      "returnType": "list"\n    }, {\n      "name": "scheme-colors",\n      "argTypes": ["string", "string", "number"],\n      "returnType": "list"\n    }\n  ]\n}\n;{\n  "name": "send-to",\n  "prims": [\n    {\n      "name":       "file",\n      "argTypes":   ["string", "string"],\n      "returnType": "unit"\n    }\n  ]\n}\n;{\n  "name": "sound",\n  "prims": [\n\t{\n      "name" :       "play-tone",\n      "argTypes" :   ["string", "number", "number"],\n      "returnType" : "unit"\n\t}\n  ]\n}\n;{\n  "name": "store",\n  "prims": [\n    {\n      "name":       "list-stores",\n      "argTypes":   ["command"],\n      "returnType":  "unit"\n    },\n    {\n      "name":       "switch-store",\n      "argTypes":   ["string"],\n      "returnType": "unit"\n    },\n    {\n      "name":       "delete-store",\n      "argTypes":   ["string"],\n      "returnType": "unit"\n    },\n    {\n      "name":       "put",\n      "argTypes":   ["string", "string", { "type": "commandblock", "isOptional": true }],\n      "returnType": "unit"\n    },\n    {\n      "name":       "get",\n      "argTypes":   ["string", "command"],\n      "returnType": "unit"\n    },\n    {\n      "name":       "get-keys",\n      "argTypes":   ["command"],\n      "returnType": "unit"\n    },\n    {\n      "name":       "has-key",\n      "argTypes":   ["string", "command"],\n      "returnType": "unit"\n    },\n    {\n      "name":       "remove",\n      "argTypes":   ["string", { "type": "commandblock", "isOptional": true }],\n      "returnType": "unit"\n    },\n    {\n      "name":       "clear",\n      "argTypes":   [{ "type": "commandblock", "isOptional": true }],\n      "returnType": "unit"\n    }\n  ]\n}\n;{\n  "name": "table",\n  "prims": [\n    {\n      "name": "is-table?",\n      "argTypes": ["wildcard"],\n      "returnType": "boolean"\n    },\n    {\n      "name": "clear",\n      "argTypes": ["wildcard"],\n      "returnType": "unit"\n    }, {\n      "name": "counts",\n      "argTypes": ["list"],\n      "returnType": "wildcard"\n    }, {\n      "name": "group-agents",\n      "argTypes": ["agentset", "reporter"],\n      "returnType": "wildcard"\n    }, {\n      "name": "group-items",\n      "argTypes": ["list", "reporter"],\n      "returnType": "wildcard"\n    }, {\n      "name": "from-list",\n      "argTypes": ["list"],\n      "returnType": "wildcard"\n    }, {\n      "name": "get",\n      "argTypes": ["wildcard", "wildcard"],\n      "returnType": "wildcard"\n    }, {\n      "name": "get-or-default",\n      "argTypes": ["list", "wildcard", "wildcard"],\n      "returnType": "wildcard"\n    }, {\n      "name": "has-key?",\n      "argTypes": ["wildcard", "wildcard"],\n      "returnType": "boolean"\n    }, {\n      "name": "keys",\n      "argTypes": ["wildcard"],\n      "returnType": "list"\n    }, {\n      "name": "length",\n      "argTypes": ["wildcard"],\n      "returnType": "number"\n    }, {\n      "name": "make",\n      "argTypes": [],\n      "returnType": "wildcard"\n    }, {\n      "name": "put",\n      "argTypes": ["wildcard", "wildcard", "wildcard"],\n      "returnType": "unit"\n    }, {\n      "name": "remove",\n      "argTypes": ["wildcard", "wildcard"],\n      "returnType": "unit"\n    }, {\n      "name": "to-list",\n      "argTypes": ["wildcard"],\n      "returnType": "list"\n    }, {\n      "name": "values",\n      "argTypes": ["wildcard"],\n      "returnType": "list"\n    }\n  ]\n}\n'.split(";"))),b=
p(function(){return function(e){Lr();var f=Wha();e=uy(f,ba.JSON.parse(e));return(new iQ).Bg(e)}}(this)),d=r();a=a.xa(b,d.P);b=p(function(){return function(e){return(new z).e(e.yg(),e)}}(this));d=r();this.hI=a.xa(b,d.P).Oe(Ke().jl);this.a=(1|this.a)<<24>>24;this.JK=Jg(Rw(),v());this.a=(2|this.a)<<24>>24;jQ||(jQ=(new kQ).b());this.Us=H(jQ,v());this.a=(4|this.a)<<24>>24;this.UD=!1;this.a=(8|this.a)<<24>>24;return this};
function rea(a){if(0===(8&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/NLWExtensionManager.scala: 219");a.UD?vfa(a,!1):Ema(a).xn()}function Ema(a){if(0===(2&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/NLWExtensionManager.scala: 188");return a.JK}function vfa(a,b){a.UD=b;a.a=(8|a.a)<<24>>24}
function nfa(a){if(0===(4&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/NLWExtensionManager.scala: 190");return a.Us}function Fma(a){if(0===(1&a.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/NLWExtensionManager.scala: 187");return a.hI}
function sea(a,b){var d=Fma(a).ci(b,J(function(g,k){return function(){var l="No such extension: "+k,n=Qk().ja.Ya,t=Qk().ja.Ra,u=Qk();throw(new pd).Xs(l,n,t,u.ja.$a);}}(a,b))),e=Dma(d);d=p(function(g,k){return function(l){return(new z).e(k.yg(),l)}}(a,d));var f=r();e=e.xa(d,f.P);d=p(function(){return function(g){if(null!==g){var k=g.ha(),l=g.la();if(null!==l)return g=l.Qv,(new z).e((k+":"+l.pa).toUpperCase(),g)}throw(new q).i(g);}}(a));f=r();e=e.xa(d,f.P);d=Ema(a);sF(d,e);nfa(a).VA(b)}
ir.prototype.$classData=h({a1:0},!1,"org.nlogo.tortoise.compiler.NLWExtensionManager",{a1:1,d:1,ama:1});function Us(){}Us.prototype=new m;Us.prototype.constructor=Us;c=Us.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof TI&&(r(),d=(new I).i(b),null!==d.M&&0===d.M.sb(1)&&(d=d.M.R(0),d instanceof zb&&(b=th().Gb(d),!b.x()&&(d=b.Q().Ia,b=b.Q().Wa,d instanceof QK)))))return d=(new lQ).b(),(new zb).Jc(d,b,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({G1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$AnyOtherTransformer$",{G1:1,d:1,Ge:1});var Ts=void 0;function Ss(){}Ss.prototype=new m;
Ss.prototype.constructor=Ss;c=Ss.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof TI&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(1)&&(b=b.M.R(0),b instanceof zb&&(d=th().Gb(b),!d.x()&&(b=d.Q().Wa,d.Q().Ia instanceof nu)))))return d=(new ou).b(),(new zb).Jc(d,b,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};
c.$classData=h({H1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$AnyOtherWithTransformer$",{H1:1,d:1,Ge:1});var Rs=void 0;function dt(){}dt.prototype=new m;dt.prototype.constructor=dt;c=dt.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof TI&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(1)&&(b=b.M.R(0),b instanceof zb&&(d=th().Gb(b),!d.x()&&(b=d.Q().Wa,d.Q().Ia instanceof iu)))))return d=(new qu).b(),(new zb).Jc(d,b,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({I1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$AnyWith1Transformer$",{I1:1,d:1,Ge:1});var ct=void 0;function ft(){}ft.prototype=new m;ft.prototype.constructor=ft;
c=ft.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof sI&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(2)&&(d=b.M.R(0),b=b.M.R(1),d instanceof zb&&(d=th().Gb(d),!d.x())))){var e=d.Q().Wa;if(d.Q().Ia instanceof gJ&&(r(),d=(new I).i(e),null!==d.M&&0===d.M.sb(1)&&(d=d.M.R(0),d instanceof zb&&(e=th().Gb(d),!e.x()&&(d=e.Q().Wa,e.Q().Ia instanceof iu&&b instanceof zb&&(b=th().Gb(b),!b.x()&&(b=b.Q().Ia,b instanceof dm&&Jl(Kl(),b.W,0))))))))return b=(new qu).b(),(new zb).Jc(b,d,
a.ja)}}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({J1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$AnyWith2Transformer$",{J1:1,d:1,Ge:1});var et=void 0;function ht(){}ht.prototype=new m;ht.prototype.constructor=ht;c=ht.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof yI&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(2)&&(d=b.M.R(0),b=b.M.R(1),d instanceof zb&&(d=th().Gb(d),!d.x())))){var e=d.Q().Wa;if(d.Q().Ia instanceof gJ&&(r(),d=(new I).i(e),null!==d.M&&0===d.M.sb(1)&&(d=d.M.R(0),d instanceof zb&&(e=th().Gb(d),!e.x()&&(d=e.Q().Wa,e.Q().Ia instanceof iu&&b instanceof zb&&(b=th().Gb(b),!b.x()&&(b=b.Q().Ia,b instanceof dm&&Jl(Kl(),b.W,0))))))))return b=(new qu).b(),(new zb).Jc(b,d,
a.ja)}}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({K1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$AnyWith3Transformer$",{K1:1,d:1,Ge:1});var gt=void 0;function jt(){}jt.prototype=new m;jt.prototype.constructor=jt;c=jt.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof wI&&(r(),d=(new I).i(d),null!==d.M&&0===d.M.sb(2)&&(b=d.M.R(0),d=d.M.R(1),b instanceof zb&&(b=th().Gb(b),!b.x()&&(b=b.Q().Ia,b instanceof dm&&d instanceof zb&&(d=th().Gb(d),!d.x())))))){var e=d.Q().Wa;if(d.Q().Ia instanceof gJ&&(r(),d=(new I).i(e),null!==d.M&&0===d.M.sb(1)&&(d=d.M.R(0),d instanceof zb&&(e=th().Gb(d),!e.x()&&(d=e.Q().Wa,e.Q().Ia instanceof iu&&Jl(Kl(),b.W,0))))))return b=(new qu).b(),(new zb).Jc(b,d,
a.ja)}}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({L1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$AnyWith4Transformer$",{L1:1,d:1,Ge:1});var it=void 0;function lt(){}lt.prototype=new m;lt.prototype.constructor=lt;c=lt.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof st&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(2)&&(d=b.M.R(0),b=b.M.R(1),d instanceof zb&&(d=th().Gb(d),!d.x())))){var e=d.Q().Wa;if(d.Q().Ia instanceof gJ&&(r(),d=(new I).i(e),null!==d.M&&0===d.M.sb(1)&&(d=d.M.R(0),d instanceof zb&&(e=th().Gb(d),!e.x()&&(d=e.Q().Wa,e.Q().Ia instanceof iu&&b instanceof zb&&(b=th().Gb(b),!b.x()&&(b=b.Q().Ia,b instanceof dm&&Jl(Kl(),b.W,0)))))))){b=(new OK).b();e=r();var f=(new qu).b();
d=H(e,(new M).q([(new zb).Jc(f,d,a.ja)]));return(new zb).Jc(b,d,a.ja)}}}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({M1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$AnyWith5Transformer$",{M1:1,d:1,Ge:1});var kt=void 0;function $s(){}$s.prototype=new m;$s.prototype.constructor=$s;c=$s.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof gJ&&(r(),d=(new I).i(b),null!==d.M&&0===d.M.sb(1)&&(d=d.M.R(0),d instanceof zb&&(b=th().Gb(d),!b.x()&&(d=b.Q().Ia,b=b.Q().Wa,d instanceof QK)))))return d=(new mQ).b(),(new zb).Jc(d,b,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({N1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$CountOtherTransformer$",{N1:1,d:1,Ge:1});var Zs=void 0;function Ys(){}Ys.prototype=new m;
Ys.prototype.constructor=Ys;c=Ys.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof gJ&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(1)&&(b=b.M.R(0),b instanceof zb&&(d=th().Gb(b),!d.x()&&(b=d.Q().Wa,d.Q().Ia instanceof nu)))))return d=(new lu).b(),(new zb).Jc(d,b,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};
c.$classData=h({O1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$CountOtherWithTransformer$",{O1:1,d:1,Ge:1});var Xs=void 0;function bt(){}bt.prototype=new m;bt.prototype.constructor=bt;c=bt.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof gJ&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(1)&&(b=b.M.R(0),b instanceof zb&&(d=th().Gb(b),!d.x()&&(b=d.Q().Wa,d.Q().Ia instanceof iu)))))return d=(new mu).b(),(new zb).Jc(d,b,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({P1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$CountWithTransformer$",{P1:1,d:1,Ge:1});var at=void 0;function Cs(){}Cs.prototype=new m;Cs.prototype.constructor=Cs;
c=Cs.prototype;c.b=function(){return this};c.Pe=function(a){var b=ji(li(),a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof uq&&(r(),b=(new I).i(b),null!==b.M&&0===b.M.sb(2)&&(b=b.M.R(1),b instanceof Ab&&b.De.fg.x())))return d=(new wq).c(d.ia),(new Ib).xj(d,a.ta,a.ja)}return Hb(this,a)};c.re=function(a){return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({Q1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$CroFastTransformer$",{Q1:1,d:1,Ge:1});var Bs=void 0;function As(){}
As.prototype=new m;As.prototype.constructor=As;c=As.prototype;c.b=function(){return this};c.Pe=function(a){var b=ji(li(),a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof tq&&(r(),b=(new I).i(b),null!==b.M&&0===b.M.sb(2)&&(b=b.M.R(1),b instanceof Ab&&b.De.fg.x())))return d=(new vq).c(d.ia),(new Ib).xj(d,a.ta,a.ja)}return Hb(this,a)};c.re=function(a){return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};
c.$classData=h({R1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$CrtFastTransformer$",{R1:1,d:1,Ge:1});var zs=void 0;function us(){}us.prototype=new m;us.prototype.constructor=us;c=us.prototype;c.b=function(){return this};
c.Pe=function(a){var b=ji(li(),a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof hN&&(r(),d=(new I).i(b),null!==d.M&&0===d.M.sb(1)&&(d=d.M.R(0),d instanceof zb&&(d=th().Gb(d),!d.x()&&(d=d.Q().Ia,d instanceof dm&&Jl(Kl(),d.W,1))))))return d=(new nQ).b(),b=H(r(),v()),(new Ib).xj(d,b,a.ja)}return Hb(this,a)};c.re=function(a){return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({S1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$Fd1Transformer$",{S1:1,d:1,Ge:1});var ts=void 0;
function ws(){}ws.prototype=new m;ws.prototype.constructor=ws;c=ws.prototype;c.b=function(){return this};c.Pe=function(a){var b=ji(li(),a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof hN&&(r(),d=(new I).i(b),null!==d.M&&0===d.M.sb(1)&&(d=d.M.R(0),d instanceof zb&&(d=th().Gb(d),!d.x()&&(d=d.Q().Ia,d instanceof dm&&(d=d.W,"number"===typeof d&&-1<+d&&1>+d))))))return d=(new oQ).b(),(new Ib).xj(d,a.ta,a.ja)}return Hb(this,a)};c.re=function(a){return Jb(this,a)};
c.Fe=function(a){return Kb(this,a)};c.$classData=h({T1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$FdLessThan1Transformer$",{T1:1,d:1,Ge:1});var vs=void 0;function Gs(){}Gs.prototype=new m;Gs.prototype.constructor=Gs;c=Gs.prototype;c.b=function(){return this};
c.Pe=function(a){var b=ji(li(),a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof Kq&&(r(),b=(new I).i(b),null!==b.M&&0===b.M.sb(2)&&(b=b.M.R(1),b instanceof Ab&&b.De.fg.x())))return d=(new Lq).c(d.ia),(new Ib).xj(d,a.ta,a.ja)}return Hb(this,a)};c.re=function(a){return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({U1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$HatchFastTransformer$",{U1:1,d:1,Ge:1});var Fs=void 0;function pQ(){}pQ.prototype=new m;pQ.prototype.constructor=pQ;
function Gma(){}Gma.prototype=pQ.prototype;pQ.prototype.Pe=function(a){return Hb(this,a)};pQ.prototype.Fe=function(a){return Kb(this,a)};function Os(){}Os.prototype=new m;Os.prototype.constructor=Os;c=Os.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof PK&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(1)&&(b=b.M.R(0),b instanceof zb&&(d=th().Gb(b),!d.x()&&(b=d.Q().Wa,d.Q().Ia instanceof iu)))))return d=(new pu).b(),(new zb).Jc(d,b,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({Y1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$OneOfWithTransformer$",{Y1:1,d:1,Ge:1});var Ns=void 0;function nt(){}nt.prototype=new m;nt.prototype.constructor=nt;
c=nt.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof sI&&(r(),d=(new I).i(d),null!==d.M&&0===d.M.sb(2)&&(b=d.M.R(0),d=d.M.R(1),b instanceof zb))){var e=th().Gb(b);if(!e.x()&&(b=e.Q().Wa,e.Q().Ia instanceof gJ&&d instanceof zb&&(d=th().Gb(d),!d.x()&&(d=d.Q().Ia,d instanceof dm))))return d=qQ("(a, b) \x3d\x3e a !\x3d\x3d b",+d.W),(new zb).Jc(d,b,a.ja)}}b=th().Gb(a);if(!b.x()&&(d=b.Q().Wa,b.Q().Ia instanceof yI&&(r(),d=(new I).i(d),null!==d.M&&0===d.M.sb(2)&&(b=d.M.R(0),
d=d.M.R(1),b instanceof zb&&(e=th().Gb(b),!e.x()&&(b=e.Q().Wa,e.Q().Ia instanceof gJ&&d instanceof zb&&(d=th().Gb(d),!d.x()&&(d=d.Q().Ia,d instanceof dm))))))))return d=qQ("(a, b) \x3d\x3e a \x3e b",+d.W),(new zb).Jc(d,b,a.ja);b=th().Gb(a);if(!b.x()&&(d=b.Q().Wa,b.Q().Ia instanceof wI&&(r(),d=(new I).i(d),null!==d.M&&0===d.M.sb(2)&&(b=d.M.R(0),d=d.M.R(1),b instanceof zb&&(e=th().Gb(b),!e.x()&&(b=e.Q().Wa,e.Q().Ia instanceof gJ&&d instanceof zb&&(d=th().Gb(d),!d.x()&&(d=d.Q().Ia,d instanceof dm))))))))return d=
qQ("(a, b) \x3d\x3e a \x3c b",+d.W),(new zb).Jc(d,b,a.ja);b=th().Gb(a);return!b.x()&&(d=b.Q().Wa,b.Q().Ia instanceof st&&(r(),d=(new I).i(d),null!==d.M&&0===d.M.sb(2)&&(b=d.M.R(0),d=d.M.R(1),b instanceof zb&&(e=th().Gb(b),!e.x()&&(b=e.Q().Wa,e.Q().Ia instanceof gJ&&d instanceof zb&&(d=th().Gb(d),!d.x()&&(d=d.Q().Ia,d instanceof dm)))))))?(d=qQ("(a, b) \x3d\x3e a \x3d\x3d\x3d b",+d.W),(new zb).Jc(d,b,a.ja)):Jb(this,a)};c.Fe=function(a){return Kb(this,a)};
c.$classData=h({Z1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$OptimizeCountTransformer$",{Z1:1,d:1,Ge:1});var mt=void 0;function Qs(){}Qs.prototype=new m;Qs.prototype.constructor=Qs;c=Qs.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof QK&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(1)&&(b=b.M.R(0),b instanceof zb&&(d=th().Gb(b),!d.x()&&(b=d.Q().Wa,d.Q().Ia instanceof iu)))))return d=(new nu).b(),(new zb).Jc(d,b,a.ja)}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({$1:0},!1,"org.nlogo.tortoise.compiler.Optimizer$OtherWithTransformer$",{$1:1,d:1,Ge:1});var Ps=void 0;function Es(){}Es.prototype=new m;Es.prototype.constructor=Es;
c=Es.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof UK&&(r(),d=(new I).i(b),null!==d.M&&0===d.M.sb(2)&&(b=d.M.R(0),d=d.M.R(1),b instanceof zb&&(b=th().Gb(b),!b.x()&&(b=b.Q().Ia,b instanceof dm&&(b=b.W,"number"===typeof b&&d instanceof zb&&(d=th().Gb(d),!d.x()&&(d=d.Q().Ia,d instanceof dm&&(d=d.W,"number"===typeof d))))))))){if(TH(Kl(),b,0)&&TH(Kl(),d,0))return d=(new uu).b(),(new zb).Jc(d,a.ta,a.ja);if(TH(Kl(),b,0)&&TH(Kl(),d,-1))return d=(new xu).b(),(new zb).Jc(d,
a.ta,a.ja);if(TH(Kl(),b,0)&&TH(Kl(),d,1))return d=(new vu).b(),(new zb).Jc(d,a.ta,a.ja);if(TH(Kl(),b,-1)&&TH(Kl(),d,0))return d=(new yu).b(),(new zb).Jc(d,a.ta,a.ja);if(TH(Kl(),b,-1)&&TH(Kl(),d,-1))return d=(new Bu).b(),(new zb).Jc(d,a.ta,a.ja);if(TH(Kl(),b,-1)&&TH(Kl(),d,1))return d=(new Cu).b(),(new zb).Jc(d,a.ta,a.ja);if(TH(Kl(),b,1)&&TH(Kl(),d,0))return d=(new wu).b(),(new zb).Jc(d,a.ta,a.ja);if(TH(Kl(),b,1)&&TH(Kl(),d,-1))return d=(new Au).b(),(new zb).Jc(d,a.ta,a.ja);if(TH(Kl(),b,1)&&TH(Kl(),
d,1))return d=(new zu).b(),(new zb).Jc(d,a.ta,a.ja)}}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({a2:0},!1,"org.nlogo.tortoise.compiler.Optimizer$PatchAtTransformer$",{a2:1,d:1,Ge:1});var Ds=void 0;function pt(){}pt.prototype=new m;pt.prototype.constructor=pt;c=pt.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof jL&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(1)&&(b=b.M.R(0),b instanceof zb&&(b=th().Gb(b),!b.x()&&(b=b.Q().Ia,b instanceof dm&&(b=b.W,"number"===typeof b)))))){if(0<+b){Kl();d=Wa();var e=cI(d,+b);d=TH(0,b,(new Fa).fa(e,d.Pb))}else d=!1;if(d&&9007199254740992>=+b)return b=(new rQ).b(),(new zb).Jc(b,a.ta,a.ja)}}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};
c.$classData=h({b2:0},!1,"org.nlogo.tortoise.compiler.Optimizer$RandomConstTransformer$",{b2:1,d:1,Ge:1});var ot=void 0;function Is(){}Is.prototype=new m;Is.prototype.constructor=Is;c=Is.prototype;c.b=function(){return this};c.Pe=function(a){var b=ji(li(),a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof xq&&(r(),b=(new I).i(b),null!==b.M&&0===b.M.sb(2)&&(b=b.M.R(1),b instanceof Ab&&b.De.fg.x())))return d=(new yq).c(d.ia),(new Ib).xj(d,a.ta,a.ja)}return Hb(this,a)};
c.re=function(a){return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({c2:0},!1,"org.nlogo.tortoise.compiler.Optimizer$SproutFastTransformer$",{c2:1,d:1,Ge:1});var Hs=void 0;function Ws(){}Ws.prototype=new m;Ws.prototype.constructor=Ws;c=Ws.prototype;c.b=function(){return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Wa;if(b.Q().Ia instanceof iu&&(r(),b=(new I).i(d),null!==b.M&&0===b.M.sb(2)&&(d=b.M.R(0),b=b.M.R(1),d instanceof zb))){var e=th().Gb(d);if(!e.x()&&(d=e.Q().Wa,e.Q().Ia instanceof QK)){e=(new nu).b();var f=r();b=d.wc(b,f.P);return(new zb).Jc(e,b,a.ja)}}}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({d2:0},!1,"org.nlogo.tortoise.compiler.Optimizer$WithOtherTransformer$",{d2:1,d:1,Ge:1});var Vs=void 0;
function ys(){this.a=this.OK=this.NK=0}ys.prototype=new m;ys.prototype.constructor=ys;function Hma(a){var b=th().Gb(a);if(!b.x()&&b.Q().Ia instanceof dm)return!0;b=th().Gb(a);if(!b.x()&&b.Q().Ia instanceof sQ)return!0;a=th().Gb(a);return!a.x()&&a.Q().Ia instanceof eq?!0:!1}c=ys.prototype;
c.b=function(){xs=this;var a=hI(wQ(xQ()));a=(new Kc).Gd(a);var b=A().P;a=Bg(a,b);this.NK=yQ(a,"PXCOR",0);this.a=(1|this.a)<<24>>24;a=hI(wQ(xQ()));a=(new Kc).Gd(a);b=A().P;a=Bg(a,b);this.OK=yQ(a,"PYCOR",0);this.a=(2|this.a)<<24>>24;return this};c.Pe=function(a){return Hb(this,a)};
c.re=function(a){var b=th().Gb(a);if(!b.x()){var d=b.Q().Ia;b=b.Q().Wa;if(d instanceof iu&&(r(),b=(new I).i(b),null!==b.M&&0===b.M.sb(2)&&(d=b.M.R(0),b=b.M.R(1),d instanceof zb&&(d=th().Gb(d),!d.x()&&d.Q().Ia instanceof aL&&b instanceof Bb&&(d=vh(xh(),b),!d.x()&&(d=d.Q().ha(),tt||(tt=(new rt).b()),d=tt.Gb(d),!d.x())))))){b=d.Q().ha();d=d.Q().la();b=b.ke;if(0===(1&this.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/Optimizer.scala: 387");
if(this.NK===b&&Hma(d))b=(new zQ).b(),d=H(r(),(new M).q([d])),a=(new zb).Jc(b,d,a.ja);else{if(0===(2&this.a)<<24>>24)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/Optimizer.scala: 388");this.OK===b&&Hma(d)?(b=(new AQ).b(),d=H(r(),(new M).q([d])),a=(new zb).Jc(b,d,a.ja)):a=Jb(this,a)}return a}}return Jb(this,a)};c.Fe=function(a){return Kb(this,a)};c.$classData=h({e2:0},!1,"org.nlogo.tortoise.compiler.Optimizer$WithTransformer$",{e2:1,d:1,Ge:1});
var xs=void 0;function BQ(){this.ka=null}BQ.prototype=new m;BQ.prototype.constructor=BQ;BQ.prototype.pE=function(a){a=Jaa(a,"get");if(a.x())return D();a=a.Q();a:{if(null!==a){var b=a.ha(),d=a.la();if(null!==b&&null!==d){a=b+"("+hd(id(),d)+")";break a}}throw(new q).i(a);}return(new I).i(a)};BQ.prototype.lC=function(a){if(null===a)throw jg(kg(),null);this.ka=a;return this};BQ.prototype.$classData=h({r2:0},!1,"org.nlogo.tortoise.compiler.PrimUtils$VariableReporter$",{r2:1,d:1,p2:1});
function fq(){this.ka=null}fq.prototype=new m;fq.prototype.constructor=fq;fq.prototype.pE=function(a){a=Jaa(a,"set");if(a.x())return D();a=a.Q();a:{if(null!==a){var b=a.ha(),d=a.la();if(null!==b&&null!==d){a=p(function(e,f,g){return function(k){return f+"("+hd(id(),g)+", "+k+");"}}(this,b,d));break a}}throw(new q).i(a);}return(new I).i(a)};fq.prototype.lC=function(a){if(null===a)throw jg(kg(),null);this.ka=a;return this};
fq.prototype.$classData=h({s2:0},!1,"org.nlogo.tortoise.compiler.PrimUtils$VariableSetter$",{s2:1,d:1,p2:1});function CQ(a){var b=(new fp).c(a.zw());b=(new z).e("type",b);var d=a.mi.Bb;d=(new fp).c("rgba("+d.kr+", "+d.Nq+", "+d.Aq+", "+d.vq/255+")");d=(new z).e("color",d);var e=(new Jp).md(a.mi.Jl());e=(new z).e("filled",e);a=(new Jp).md(a.mi.fc);a=[b,d,e,(new z).e("marked",a)];Kg();b=(new dc).vb(rp());d=0;for(e=a.length|0;d<e;)fc(b,a[d]),d=1+d|0;return(new sp).ac(b.La)}
function DQ(){this.Az=this.Bz=this.Cz=this.zz=this.xz=this.yz=this.Hx=null;this.a=0}DQ.prototype=new m;DQ.prototype.constructor=DQ;DQ.prototype.b=function(){return this};function EQ(){var a=up();null===up().Hx&&null===up().Hx&&(up().Hx=(new FQ).sk(a));return up().Hx}function kp(){var a=up();null===up().Bz&&null===up().Bz&&(up().Bz=(new GQ).sk(a));return up().Bz}function HQ(){var a=up();null===up().yz&&null===up().yz&&(up().yz=(new IQ).sk(a));return up().yz}
function JQ(){var a=up();null===up().xz&&null===up().xz&&(up().xz=(new KQ).sk(a));return up().xz}function Gea(){var a=up();null===up().Az&&null===up().Az&&(up().Az=(new LQ).sk(a));return up().Az}function MQ(a,b,d,e){return e.Pc(d,b.nh.Cc(d))}function tp(a){null===up().zz&&null===up().zz&&(up().zz=(new NQ).sk(a));return up().zz}DQ.prototype.$classData=h({D3:0},!1,"org.nlogo.tortoise.compiler.json.JsonReader$",{D3:1,d:1,zma:1});var Ima=void 0;function up(){Ima||(Ima=(new DQ).b());return Ima}
function OQ(a,b){a=a.Ez().w(b);if(a instanceof R)return(new R).i((new I).i(a.ea));if(a instanceof T)return a;throw(new q).i(a);}function PQ(a,b){b.x()?a=D():(b=b.Q(),a=(new I).i(OQ(a,b)));return a.x()?(bp(),a=D(),wp().w(a)):a.Q()}function QQ(){this.Gx=this.Sx=this.ny=this.oz=null;this.a=0}QQ.prototype=new m;QQ.prototype.constructor=QQ;QQ.prototype.b=function(){return this};function RQ(){SQ();null===SQ().Gx&&null===SQ().Gx&&(SQ().Gx=new TQ);return SQ().Gx}
function UQ(){SQ();null===SQ().Sx&&null===SQ().Sx&&(SQ().Sx=new VQ);return SQ().Sx}function WQ(){SQ();null===SQ().oz&&null===SQ().oz&&(SQ().oz=new XQ);return SQ().oz}function YQ(){SQ();null===SQ().ny&&null===SQ().ny&&(SQ().ny=new ZQ);return SQ().ny}QQ.prototype.$classData=h({K3:0},!1,"org.nlogo.tortoise.compiler.json.JsonWriter$",{K3:1,d:1,Ama:1});var Jma=void 0;function SQ(){Jma||(Jma=(new QQ).b());return Jma}function $Q(){this.UL=this.fI=null}$Q.prototype=new m;$Q.prototype.constructor=$Q;
function op(a,b){var d=new $Q;d.fI=a;d.UL=b;return d}$Q.prototype.Af=function(){return this.fI.Bc(this.UL)};$Q.prototype.$classData=h({L3:0},!1,"org.nlogo.tortoise.compiler.json.JsonWriter$$anon$1",{L3:1,d:1,nm:1});function aR(){this.YL=null;this.a=!1}aR.prototype=new m;aR.prototype.constructor=aR;
function Kma(a){var b=new aR,d=(new bw).rk(a.xE());d=(new z).e("x-offset",d);var e=(new Jp).md(a.OC());e=(new z).e("is-visible",e);a=a.sB();var f=p(function(){return function(k){return(new bw).rk(+k)}}(b)),g=r();a=(new ip).Ca(a.xa(f,g.P));d=[d,e,(new z).e("dash-pattern",a)];Kg();e=(new dc).vb(rp());a=0;for(f=d.length|0;a<f;)fc(e,d[a]),a=1+a|0;b.YL=(new sp).ac(e.La);b.a=!0;return b}
aR.prototype.Af=function(){if(!this.a)throw(new x).c("Uninitialized field: /mnt/d/Repositories/Tortoise/compiler/shared/src/main/scala/json/ShapeToJsonConverters.scala: 36");return this.YL};aR.prototype.$classData=h({a4:0},!1,"org.nlogo.tortoise.compiler.json.ShapeToJsonConverters$$anon$1",{a4:1,d:1,nm:1});function hQ(){this.sM=null}hQ.prototype=new m;hQ.prototype.constructor=hQ;
hQ.prototype.Af=function(){var a=this.sM;if(a instanceof Cv){var b=(new we).b();if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new bR)}return cR(a)}if(a instanceof dR){b=(new we).b();if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new eR)}return fR(a)}if(a instanceof gR){b=(new we).b();if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new hR)}return iR(a)}if(a instanceof Ev){b=(new we).b();if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new jR)}return kR(a)}if(a instanceof lR){b=(new we).b();
if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new mR)}return nR(a)}if(a instanceof oR)return b=(new we).b(),(b.Aa?b.Oa:Lma(b)).Dh(a);if(a instanceof wv){b=(new we).b();if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new pR)}return qR(a)}if(a instanceof Fv){b=(new we).b();if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new rR)}return sR(a)}if(a instanceof tR){b=(new we).b();if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new uR)}return vR(a)}if(a instanceof wR){b=(new we).b();if(!b.Aa){if(null===
b)throw(new xe).b();b.Aa||ye(b,new xR)}return yR(a)}if(!(a instanceof zR))throw(new q).i(a);b=(new we).b();if(!b.Aa){if(null===b)throw(new xe).b();b.Aa||ye(b,new AR)}return BR(a)};function Lma(a){if(null===a)throw(new xe).b();return a.Aa?a.Oa:ye(a,new CR)}hQ.prototype.$classData=h({S4:0},!1,"org.nlogo.tortoise.compiler.json.WidgetToJson$$anon$1",{S4:1,d:1,nm:1});function DR(a,b){if(b.x())return D();b=b.Q();b=(new I).i(b);return(new I).i(a.iu(b))}function ER(){this.pH=null}ER.prototype=new m;
ER.prototype.constructor=ER;ER.prototype.b=function(){FR=this;this.pH=Mma(ba);return this};function Nma(a,b){return!!b.Ub(!0,xb(function(){return function(d,e){return!!d&&!!e}}(a)))}
function Oma(a,b,d){d=p(function(f,g){return function(k){k=Pma(f,k,g);var l=p(function(){return function(t){return null!==t}}(f)),n=ZC();return k.LB(l,n).Kl(p(function(t,u){return function(w){if(null!==w){var y=!!w.ha();w=w.la();return Oma(t,mv(Ke(),w),u).gi(p(function(E,L){return function(S){return L&&!!S}}(t,y)),ZC())}throw(new q).i(w);}}(f,g)),ZC())}}(a,d));var e=r();b=b.xa(d,e.P);d=CB();e=r();return eD(d,b,e.P,ZC()).gi(p(function(f){return function(g){return Nma(f,g)}}(a)),ZC())}
function Qma(a,b,d,e){var f=v(),g=Ol(f);g=ma(ab(sa),[g]);var k=0;k=0;for(f=zr(f);f.qa();){var l=f.ma();g.j[k]=l;k=1+k|0}l=v();k=Ol(l);k=ma(ab(sa),[k]);f=f=0;for(l=zr(l);l.qa();){var n=l.ma();k.j[f]=n;f=1+f|0}g=Rma(b,g,a.pH);d=Sma(g,d.Ne((new Dm).Cg(ra(Tma))));return Oma(a,mv(Ke(),d),e).gi(p(function(t,u,w,y){return function(E){E=!!E;var L=y.Qx(),S=(new Sb).c(L);sd(S)&&(S=w.lo,L=bx((new cx).Ca((new M).q([""," reported ",""])),(new M).q(["utest",L])),Ww(S.dh,L,Vw(E)));return E}}(a,b,e,g)),ZC())}
function Uma(a){var b=(new Sb).c(ba.document.location.search),d=Vma(b),e=!1;b=null;d=GH(Na(),d,"\x26");var f=null;f=[];for(var g=0,k=d.j.length;g<k;){var l=ba.decodeURIComponent(d.j[g]);f.push(null===l?null:l);g=1+g|0}d=la(ab(sa),f);f=-1+d.j.length|0;for(g=v();0<=f;)g=K(d.j[f],g),f=-1+f|0;d=g;a:{if(d instanceof Ih&&(e=!0,b=d,d=b.Da,"i"===b.Ib&&d instanceof Ih)){b=d.Ib;e=d.Da;d=gk().$b;e=Bg(e,d);e=p(function(n,t){return function(u){return t.hb(u.Nk)}}(a,e));b=(new Sb).c(b);d=Jh();d=(new I).i(Lh(d,
b.U,10));b=e;e=d;break a}if(e&&(e=b.Da,"e"===b.Ib)){b=gk().$b;b=Bg(e,b);b=p(function(n,t){return function(u){return!t.hb(u.Nk)}}(a,b));e=D();break a}b=p(function(){return function(){return!0}}(a));e=D()}d=e;f=Aha();e=p(function(){return function(n){return n.la().za()}}(a));g=r();e=f.xa(e,g.P).tg(ax())|0;g=p(function(n,t){return function(u){return u.la().Ef(t)}}(a,b));k=r();g=f.Ti(g,k.P);e=wha(g,e);(d.x()?0:(d.Q()|0)!==Wma(a,g))&&sha(e);d=f.Do(p(function(){return function(n){return null!==n}}(a)));
b=p(function(n,t,u){return function(w){if(null!==w)return Qma(n,w.ha(),w.la().Xk(t,!1),u);throw(new q).i(w);}}(a,b,e));f=r();b=d.xa(b,f.P);d=CB();f=r();eD(d,b,f.P,ZC()).gi(p(function(n){return function(t){return Nma(n,t)}}(a)),ZC()).Qp(p(function(n,t){return function(u){t.yB(u)}}(a,e)),ZC())}function Wma(a,b){X();a=p(function(){return function(e){return e.Nk}}(a));var d=r();return GE(0,b.xa(a,d.P).td())}
function Pma(a,b,d){d=uha(d,b.qw.Nk);var e=(new GR).b(),f=(new HR).b();b=BB(CB(),J(function(g,k,l,n,t){return function(){var u=(new M).q([l.vy]),w=u.wa.length|0;w=ma(ab(Maa),[w]);var y=0;y=0;for(u=wg(u,0,u.wa.length|0);u.qa();){var E=u.ma();w.j[y]=E;y=1+y|0}Xma(k,n,w,p(function(L,S){return function(ia){ia=(new Cx).i(ia);ie(S,ia)}}(g,t)))}}(a,b,d,e,f)),(new lH).b()).Kl(p(function(g,k,l){return function(){return l.gi(p(function(n,t){return function(u){return(new z).e(!t.Nw,u)}}(g,k)),ZC())}}(a,e,f)),
ZC());b.gi(p(function(){return function(g){return!!g.ha()}}(a)),ZC()).Qp(p(function(g,k){return function(l){k.yB(l)}}(a,d)),ZC());return b.tt((new IR).b(),ZC())}ER.prototype.main=function(){Uma(this)};ER.prototype.$classData=h({H5:0},!1,"org.scalajs.testinterface.HTMLRunner$",{H5:1,d:1,Psa:1});var FR=void 0;function GR(){this.Nw=!1}GR.prototype=new m;GR.prototype.constructor=GR;GR.prototype.b=function(){this.Nw=!1;return this};
GR.prototype.GI=function(a){a=a.YD;this.Nw=this.Nw?!0:Tw().sK.hb(a);Tw().yu.Nr(a,1+(Tw().yu.w(a)|0)|0)};GR.prototype.$classData=h({K5:0},!1,"org.scalajs.testinterface.HTMLRunner$EventCounter$Handler",{K5:1,d:1,X6:1});function JR(){this.ka=this.uK=this.hr=null}JR.prototype=new m;JR.prototype.constructor=JR;JR.prototype.fw=function(a){this.hr.fw(a)};
function xha(a){var b=new JR;if(null===a)throw jg(kg(),null);b.ka=a;var d=a.oD.za();b.hr=(new ix).dv(a,bx((new cx).Ca((new M).q(["Excluded Test Suites (",")"])),(new M).q([d])));b.uK=vha(a,a.Kv,b.hr.qi);b.hr.qi.checked=!1;b.hr.qi.onclick=tha(a,a.Kv,b.hr.qi);a.oD.ua(p(function(e){return function(f){return e.ka.Kv.Rj(Yma(e,f.Nk))}}(b)));return b}JR.prototype.$classData=h({M5:0},!1,"org.scalajs.testinterface.HTMLRunner$UI$ExcludedTestBox",{M5:1,d:1,QF:1});
function KR(){this.ka=this.qi=this.dD=this.Ct=null}KR.prototype=new m;KR.prototype.constructor=KR;KR.prototype.nI=function(){return!1};KR.prototype.IL=function(a){this.qi.checked=a};KR.prototype.hz=function(){return!!this.qi.checked};function Yma(a,b){var d=new KR;d.Ct=b;if(null===a)throw jg(kg(),null);d.ka=a;d.dD=Ww(a.hr,"","info");d.qi=yha(Yw(),d.dD,!1);d.qi.onclick=a.uK;Xw(Yw(),d.dD," "+b);return d}
KR.prototype.$classData=h({N5:0},!1,"org.scalajs.testinterface.HTMLRunner$UI$ExcludedTestBox$ExcludedTest",{N5:1,d:1,R5:1});function hx(){this.ka=this.iM=this.qB=this.dh=null}hx.prototype=new m;hx.prototype.constructor=hx;hx.prototype.fw=function(a){this.dh.fw(a)};
function Zma(a,b){var d=a.ka.Lv,e=a.ka.Kv,f=Gc().P;d=qv(d,e,f).Zi(b);if(null===d)throw(new q).i(d);b=d.ha();d=d.la();b.za()<d.za()?(X(),e=p(function(){return function(g){return g.Ct}}(a)),f=Gc().P,d=""+GE(0,Mr(d,e,f).td()),d=H(r(),(new M).q(["i",d])),e=p(function(){return function(g){return g.Ct}}(a)),f=Gc().P,b=Mr(b,e,f),e=r(),b=d.oc(b,e.P)):(b=p(function(){return function(g){return g.Ct}}(a)),e=Gc().P,b=Mr(d,b,e),d=Gc(),b=b.Fd("e",d.P));a=p(function(){return function(g){return ba.encodeURIComponent(g)}}(a));
d=r();return b.xa(a,d.P).od("?","\x26","")}hx.prototype.Rx=function(a){this.dh.Rx(a);this.qB.className="log "+Vw(a);var b=Ww(this.dh,"Next: ",Vw(a));a||(Zw(Yw(),b,Zma(this,p(function(){return function(d){return d.nI()}}(this))),"Run failed"),Xw(Yw(),b," | "));Zw(Yw(),b,"#","Run selected").onclick=function(d){return function(){return $ma(d)}}(this);Xw(Yw(),b," | ");Zw(Yw(),b,"?","Run all")};
function $ma(a){ba.document.location.search=Zma(a,p(function(){return function(b){return b.hz()}}(a)));return!1}hx.prototype.$classData=h({O5:0},!1,"org.scalajs.testinterface.HTMLRunner$UI$RootBox",{O5:1,d:1,QF:1});function LR(){this.ka=null}LR.prototype=new m;LR.prototype.constructor=LR;LR.prototype.FB=function(a){Ww(this.ka.Yl,a,"error");jx(this.ka.Yl)};LR.prototype.lE=function(a){this.FB(a.l())};LR.prototype.aC=function(a){Ww(this.ka.Yl,a,"info")};
LR.prototype.$classData=h({Q5:0},!1,"org.scalajs.testinterface.HTMLRunner$UI$RunningTest$$anon$1",{Q5:1,d:1,sA:1});function ix(){this.Mg=this.qi=this.WB=this.IB=this.Qs=this.dh=null;this.Es=!1;this.ka=null}ix.prototype=new m;ix.prototype.constructor=ix;ix.prototype.fw=function(a){this.dh.insertAdjacentElement("afterend",a.dh)};function ana(a){a.Es=!a.Es;a.IB.textContent=a.Es?"[-]":"[+]";a.Mg.style.display=a.Es?"block":"none"}function jx(a){a.Es||ana(a)}
ix.prototype.Rx=function(a){this.Qs.className=this.Qs.className+" "+Vw(a);this.WB.textContent+=a?" - Passed":" - Failed"};
ix.prototype.dv=function(a,b){if(null===a)throw jg(kg(),null);this.ka=a;a=a.tK;a=this.dh=gx(Yw(),a,"test-box","","div");this.Qs=gx(Yw(),a,"test-box-header","","div");this.IB=Zw(Yw(),this.Qs,"#","[+]");this.IB.onclick=function(d){return function(){ana(d);return!1}}(this);this.WB=Xw(Yw(),this.Qs," "+b);this.qi=yha(Yw(),this.Qs,!0);b=this.dh;this.Mg=gx(Yw(),b,"test-box-body","","div");this.Es=!1;return this};
function Ww(a,b,d){return gx(Yw(),a.Mg,bx((new cx).Ca((new M).q(["log ",""])),(new M).q([d])),b,"pre")}ix.prototype.$classData=h({S5:0},!1,"org.scalajs.testinterface.HTMLRunner$UI$TestBox",{S5:1,d:1,QF:1});function yx(){this.WJ=null}yx.prototype=new qja;yx.prototype.constructor=yx;function Mma(a){var b=new yx;b.WJ=a;return b}yx.prototype.$classData=h({U5:0},!1,"org.scalajs.testinterface.ScalaJSClassLoader",{U5:1,Ara:1,d:1});function MR(){this.hl=this.Su=null}MR.prototype=new Ax;
MR.prototype.constructor=MR;MR.prototype.sy=function(a){return ba.JSON.parse(pe(a))};
MR.prototype.FI=function(a,b){if("newRunner"===a){a:{var d=this.sy(b),e=d.args,f=e.length|0;f=ma(ab(sa),[f]);a=f.j.length;var g=0,k=0;b=e.length|0;a=b<a?b:a;b=f.j.length;for(a=a<b?a:b;g<a;)f.j[k]=e[g],g=1+g|0,k=1+k|0;d=d.remoteArgs;e=d.length|0;e=ma(ab(sa),[e]);a=e.j.length;k=g=0;b=d.length|0;a=b<a?b:a;b=e.j.length;for(a=a<b?a:b;g<a;)e.j[k]=d[g],g=1+g|0,k=1+k|0;d=Mma(aa.exportsNamespace);try{this.hl=Rma(this.Su,f,d);var l=(new Cx).i(void 0)}catch(t){l=vm(kg(),t);if(null!==l){f=Kx(Lx(),l);if(!f.x()){l=
f.Q();l=(new Dx).Vd(l);break a}throw jg(kg(),l);}throw t;}}Bx(l)}else if("runnerDone"===a){NR(this);try{var n=(new Cx).i(this.hl.Qx())}catch(t){if(l=vm(kg(),t),null!==l){f=Kx(Lx(),l);if(f.x())throw jg(kg(),l);l=f.Q();n=(new Dx).Vd(l)}else throw t;}this.hl=null;Bx(n)}else if("tasks"===a){a:{e=this.sy(b);NR(this);l=[];g=0;for(k=e.length|0;g<k;)a=e[g],a=tx(ux(),a),l.push(a),g=1+g|0;e=l.length|0;e=ma(ab(Tma),[e]);a=e.j.length;k=g=0;b=l.length|0;a=b<a?b:a;b=e.j.length;for(a=a<b?a:b;g<a;)e.j[k]=l[g],g=
1+g|0,k=1+k|0;try{d=Sma(this.hl,e),f=(new Cx).i(ba.JSON.stringify(Iha(d)))}catch(t){l=vm(kg(),t);if(null!==l){f=Kx(Lx(),l);if(!f.x()){l=f.Q();f=(new Dx).Vd(l);break a}throw jg(kg(),l);}throw t;}}Bx(f)}else if("msg"===a){a:{l=pe(b);NR(this);try{g=this.hl.vD(l),k=g.x()?":n":":s:"+g.Q(),e=(new Cx).i(k)}catch(t){l=vm(kg(),t);if(null!==l){f=Kx(Lx(),l);if(!f.x()){l=f.Q();e=(new Dx).Vd(l);break a}throw jg(kg(),l);}throw t;}}Bx(e)}else throw(new Pe).c(bx((new cx).Ca((new M).q(["Unknown command: ",""])),(new M).q([a])));
};function NR(a){if(null===a.hl)throw(new je).c("No runner created");}MR.prototype.c=function(a){zx.prototype.c.call(this,a);return this};MR.prototype.$classData=h({g6:0},!1,"org.scalajs.testinterface.internal.Master",{g6:1,Z5:1,d:1});function OR(){this.UK=this.fH=this.Su=null;this.pu=!1;this.hl=this.Ay=null}OR.prototype=new Ax;OR.prototype.constructor=OR;OR.prototype.sy=function(a){return ba.JSON.parse(pe(a))};
OR.prototype.FI=function(a,b){try{for(this.pu=!0;!this.Ay.x();){var d=this.Ay;if(d.x())throw(new dw).c("queue empty");var e=d.xg.uj;d.xg=d.xg.Bi;var f=d;f.yi=-1+f.yi|0;0===f.yi&&(f.vk=f.xg);bna(this,e)}if("newRunner"===a)Bx(cna(this));else if("execute"===a)dna(this,this.sy(b));else if("stopSlave"===a){NR(this);try{var g=(new Cx).i((this.hl.Qx(),void 0))}catch(L){var k=vm(kg(),L);if(null!==k){var l=Kx(Lx(),k);if(l.x())throw jg(kg(),k);var n=l.Q();g=(new Dx).Vd(n)}else throw L;}this.hl=null;Bx(g)}else if("msg"===
a){a:{var t=pe(b);NR(this);try{var u=(new Cx).i((this.hl.vD(t),void 0))}catch(L){var w=vm(kg(),L);if(null!==w){var y=Kx(Lx(),w);if(!y.x()){var E=y.Q();u=(new Dx).Vd(E);break a}throw jg(kg(),w);}throw L;}}u.KC()&&Bx(u)}else throw(new Pe).c(bx((new cx).Ca((new M).q(["Unknown command: ",""])),(new M).q([a])));}finally{this.pu=!1}};function bna(a,b){im(Ke(),a.pu);ba.scalajsCom.send(bx((new cx).Ca((new M).q(["msg:",""])),(new M).q([b])))}
function cna(a){var b=Mma(aa.exportsNamespace);try{var d=a.Su,e=a.fH,f=e.length|0,g=ma(ab(sa),[f]),k=g.j.length,l=f=0,n=e.length|0;k=n<k?n:k;var t=g.j.length;for(t=k<t?k:t;f<t;)g.j[l]=e[f],f=1+f|0,l=1+l|0;var u=a.UK,w=u.length|0,y=ma(ab(sa),[w]),E=y.j.length;w=e=0;var L=u.length|0;E=L<E?L:E;var S=y.j.length;for(S=E<S?E:S;e<S;)y.j[w]=u[e],e=1+e|0,w=1+w|0;a.hl=ena(d,g,b,p(function(ia){return function(na){if(ia.pu)bna(ia,na);else{var pa=ia.Ay;na=[na];for(var ua=0,Ka=na.length|0;ua<Ka;)fna(pa,na[ua]),
ua=1+ua|0}}}(a)));return(new Cx).i(void 0)}catch(ia){a=vm(kg(),ia);if(null!==a){b=Kx(Lx(),a);if(!b.x())return a=b.Q(),(new Dx).Vd(a);throw jg(kg(),a);}throw ia;}}OR.prototype.Fba=function(a,b,d){this.fH=b;this.UK=d;zx.prototype.c.call(this,a);this.pu=!1;this.Ay=gna().Va().Ea()};
function dna(a,b){NR(a);var d=b.serializedTask;d=hna(a.hl,tx(ux(),ba.JSON.parse(d)));var e=(new PR).ky(a);b=b.loggerColorSupport;for(var f=[],g=b.length|0,k=0;k<g;){var l=(new z).e(b[k],k);f.push(l);k=1+k|0}b=Xb(new Yb,(new os).q(f),p(function(){return function(L){return null!==L}}(a)));f=p(function(L){return function(S){if(null!==S){var ia=new QR;ia.vf=S.Qc();dy.prototype.ky.call(ia,L);return ia}throw(new q).i(S);}}(a));g=(new os).b();b.ka.ua(p(function(L,S,ia){return function(na){return L.Zl.w(na)?
S.Ka(ia.w(na)):void 0}}(b,g,f)));b=g.kf;try{var n=b.length|0,t=ma(ab(Maa),[n]),u=t.j.length;f=n=0;var w=b.length|0;u=w<u?w:u;var y=t.j.length;for(y=u<y?u:y;n<y;)t.j[f]=b[n],n=1+n|0,f=1+f|0;Xma(d,e,t,p(function(L,S,ia){return function(na){try{var pa=(new Cx).i(ba.JSON.stringify(Iha(na)))}catch(Ka){if(pa=vm(kg(),Ka),null!==pa){na=Kx(Lx(),pa);if(na.x())throw jg(kg(),pa);pa=na.Q();pa=(new Dx).Vd(pa)}else throw Ka;}S.Kz=!1;na=0;for(var ua=ia.length|0;na<ua;)ia[na].Kz=!1,na=1+na|0;Bx(pa)}}(a,e,b)));var E=
(new Cx).i(void 0)}catch(L){if(a=vm(kg(),L),null!==a){t=Kx(Lx(),a);if(t.x())throw jg(kg(),a);a=t.Q();E=(new Dx).Vd(a)}else throw L;}E.KC()&&Bx(E)}OR.prototype.$classData=h({i6:0},!1,"org.scalajs.testinterface.internal.Slave",{i6:1,Z5:1,d:1});
function ina(a){RR();a.zba=(new SR).Jn(p(function(){return function(b){if(b instanceof Tr){b=b.W;var d=jna();try{var e=sc();0===(1&e.va)<<24>>24&&0===(1&e.va)<<24>>24&&(e.JE=vy(),e.va=(1|e.va)<<24>>24);var f=e.JE;var g=(new TR).c(b),k=(new I).i(UR(new VR,WR(g,f.jk)))}catch(n){var l=vm(kg(),n);if(null!==l){if(d.Xy.w(l))throw jg(kg(),l);if(d.$l.Sa(l))k=d.$l.w(l);else throw jg(kg(),l);}else throw n;}finally{f=d.cy,f.x()||f.Q().Mba()}return k.x()?oy(py(),qy("error.expected.numberformatexception")):k.Q()}return b instanceof
xy?(k=b.W,f=vy(),UR(new VR,WR(k.Rc,f.jk))):oy(py(),qy("error.expected.jsnumberorjsstring"))}}(a)));RR();a.Nba=(new SR).Jn(p(function(){return function(b){if(b instanceof Tr){b=b.W;var d=jna();try{var e=(new I).i(UR(new VR,(new TR).c(b)))}catch(g){var f=vm(kg(),g);if(null!==f){if(d.Xy.w(f))throw jg(kg(),f);if(d.$l.Sa(f))e=d.$l.w(f);else throw jg(kg(),f);}else throw g;}finally{f=d.cy,f.x()||f.Q().Mba()}return e.x()?oy(py(),qy("error.expected.numberformatexception")):e.Q()}return b instanceof xy?UR(new VR,
b.W.Rc):oy(py(),qy("error.expected.jsnumberorjsstring"))}}(a)));a.Mla=kna(a)}function YR(){}YR.prototype=new m;YR.prototype.constructor=YR;YR.prototype.gl=function(a){if(a instanceof ZR)return a=!!(new I).i(a.W).M,UR(new VR,a);a=r();var b=$R(),d=H(r(),(new M).q([qy("error.expected.jsboolean")]));return(new aS).Ca(H(a,(new M).q([(new z).e(b,d)])))};YR.prototype.$classData=h({p6:0},!1,"play.api.libs.json.DefaultReads$BooleanReads$",{p6:1,d:1,Rt:1});function bS(){}bS.prototype=new m;
bS.prototype.constructor=bS;bS.prototype.gl=function(a){var b=!1;return a instanceof xy&&(b=!0,a=a.W,a.tv())?UR(new VR,a.Rc.Wi()):b?lna("error.expected.int"):lna("error.expected.jsnumber")};bS.prototype.$classData=h({q6:0},!1,"play.api.libs.json.DefaultReads$IntReads$",{q6:1,d:1,Rt:1});function cS(){}cS.prototype=new m;cS.prototype.constructor=cS;
cS.prototype.gl=function(a){if(a instanceof Ay)return UR(new VR,a);a=r();var b=$R(),d=H(r(),(new M).q([qy("error.expected.jsarray")]));return(new aS).Ca(H(a,(new M).q([(new z).e(b,d)])))};cS.prototype.$classData=h({r6:0},!1,"play.api.libs.json.DefaultReads$JsArrayReads$",{r6:1,d:1,Rt:1});function dS(){}dS.prototype=new m;dS.prototype.constructor=dS;
dS.prototype.gl=function(a){if(a instanceof Tr)return UR(new VR,a.W);a=r();var b=$R(),d=H(r(),(new M).q([qy("error.expected.jsstring")]));return(new aS).Ca(H(a,(new M).q([(new z).e(b,d)])))};dS.prototype.$classData=h({s6:0},!1,"play.api.libs.json.DefaultReads$StringReads$",{s6:1,d:1,Rt:1});function eS(){this.mH=!1;this.ka=null}eS.prototype=new m;eS.prototype.constructor=eS;
eS.prototype.gl=function(a){if(a instanceof Tr){a=a.W;try{var b=(new Cx).i(mna(nna(),a))}catch(e){if(b=vm(kg(),e),null!==b){var d=Kx(Lx(),b);if(d.x())throw jg(kg(),b);b=d.Q();b=(new Dx).Vd(b)}else throw e;}b=b.ZL();this.mH?(b.x()?a=!0:(d=b.Q(),a=null!==d&&a===d.l()),a=a?b:D()):a=b;a.x()?a=D():(a=a.Q(),a=(new I).i(UR(new VR,a)));return a.x()?(a=r(),b=$R(),d=H(r(),(new M).q([qy("error.expected.uuid")])),(new aS).Ca(H(a,(new M).q([(new z).e(b,d)])))):a.Q()}a=r();b=$R();d=H(r(),(new M).q([qy("error.expected.uuid")]));
return(new aS).Ca(H(a,(new M).q([(new z).e(b,d)])))};function kna(a){var b=new eS;b.mH=!1;if(null===a)throw jg(kg(),null);b.ka=a;return b}eS.prototype.$classData=h({t6:0},!1,"play.api.libs.json.DefaultReads$UUIDReader",{t6:1,d:1,Rt:1});function SR(){this.wj=null}SR.prototype=new m;SR.prototype.constructor=SR;SR.prototype.gl=function(a){return this.wj.w(a)};SR.prototype.Jn=function(a){this.wj=a;return this};SR.prototype.$classData=h({S6:0},!1,"play.api.libs.json.Reads$$anon$8",{S6:1,d:1,Rt:1});
function fS(){}fS.prototype=new m;fS.prototype.constructor=fS;fS.prototype.b=function(){return this};fS.prototype.$classData=h({T6:0},!1,"play.api.libs.json.Reads$JsArrayMonoid$",{T6:1,d:1,o6:1});var ona=void 0;function gS(){}gS.prototype=new m;gS.prototype.constructor=gS;gS.prototype.b=function(){return this};gS.prototype.$classData=h({U6:0},!1,"play.api.libs.json.Reads$JsObjectMonoid$",{U6:1,d:1,o6:1});var pna=void 0;function gy(){this.iq=this.Nk=null;this.Ur=!1;this.Vr=null}gy.prototype=new m;
gy.prototype.constructor=gy;gy.prototype.m=function(a){return a instanceof gy?this.Nk===a.Nk&&this.iq===a.iq&&this.Ur===a.Ur?hC(mC(),this.Vr,a.Vr):!1:!1};gy.prototype.l=function(){return"TaskDef("+this.Nk+", "+this.iq+", "+this.Ur+", "+bc((new Gl).Vi(this.Vr),"[",", ","]")+")"};
gy.
